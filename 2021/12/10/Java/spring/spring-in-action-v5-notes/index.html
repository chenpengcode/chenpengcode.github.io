<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"chenpeng.pages.dev","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Spring 5 çš„ä¸»è¦ç‰¹ç‚¹æ˜¯å¯¹å“åº”å¼ç¼–ç¨‹çš„æ”¯æŒï¼ŒåŒ…æ‹¬ Spring WebFluxï¼Œè¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„å“åº”å¼ web æ¡†æ¶ï¼Œå®ƒå€Ÿé‰´äº† Spring MVC çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå…è®¸å¼€å‘äººå‘˜åˆ›å»ºå¯æ›´å¥½åœ°æ‰©å±•å’Œä½¿ç”¨æ›´å°‘çº¿ç¨‹çš„ web åº”ç”¨ç¨‹åºã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€Šspring å®æˆ˜ã€‹ç¬¬ 5 ç‰ˆ è¯»ä¹¦ç¬”è®°">
<meta property="og:url" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/index.html">
<meta property="og:site_name" content="é™ˆé¹çš„åšå®¢">
<meta property="og:description" content="Spring 5 çš„ä¸»è¦ç‰¹ç‚¹æ˜¯å¯¹å“åº”å¼ç¼–ç¨‹çš„æ”¯æŒï¼ŒåŒ…æ‹¬ Spring WebFluxï¼Œè¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„å“åº”å¼ web æ¡†æ¶ï¼Œå®ƒå€Ÿé‰´äº† Spring MVC çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå…è®¸å¼€å‘äººå‘˜åˆ›å»ºå¯æ›´å¥½åœ°æ‰©å±•å’Œä½¿ç”¨æ›´å°‘çº¿ç¨‹çš„ web åº”ç”¨ç¨‹åºã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrmRp6POrfan2ad79jr%252F-LrmSA7-88Rnb9GljVSL%252F%E5%9B%BE%201.2%20%E4%BD%BF%E7%94%A8%20Spring%20Tool%20Suite%20%E7%9A%84%20Initialzr%20%E5%88%9B%E5%BB%BA%E6%96%B0%E9%A1%B9%E7%9B%AE.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrmRp6POrfan2ad79jr%252F-LrmSQ_0c-AWLPD_ndG_%252F%E5%9B%BE%201.3%20%E5%A1%AB%E5%86%99%20Taco%20Cloud%20%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%A1%B9%E7%9B%AE%E4%BF%A1%E6%81%AF.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrmRp6POrfan2ad79jr%252F-LrmSsBcUkuk8bY0qvq-%252F%E5%9B%BE%201.5%20%E6%8C%87%E5%AE%9A%E5%A4%87%E7%94%A8%20Initializr%20%E5%9C%B0%E5%9D%80%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrmRp6POrfan2ad79jr%252F-LrmT3VxI0jBGAUEIKuu%252F%E5%9B%BE%201.6%20Spring%20Tool%20Suite%20%E4%B8%AD%E7%9A%84%20Spring%20%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrmV4WtkpHywscz5eP1%252F-LrmW3ggDtgd4Qz0WKBn%252F%E5%9B%BE%201.8%20Taco%20Cloud%20%E4%B8%BB%E9%A1%B5.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrrHUSWPNj-nSrbj4RX%252F-LrrHfAkLFP0S97Nswva%252F%E5%9B%BE%202.1%20%E5%85%B8%E5%9E%8B%20Spring%20MVC%20%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrrIg6xvwtBazaF316X%252F-LrrKhltr1lMyDwSXXEJ%252F%E5%9B%BE%202.2%20%E5%91%88%E7%8E%B0%E7%9A%84%E7%8E%89%E7%B1%B3%E9%A5%BC%E8%AE%BE%E8%AE%A1%E9%A1%B5%E9%9D%A2.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252Fsync%252Fde21b3cc9e3a0a1bf60756ea2fc917b7a92d1288.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrrLuVZVpAhCVOcIsxB%252F-LrrMfVVuP588-sEFJpn%252F%E5%9B%BE%202.4%20%E5%9C%A8%E8%AE%A2%E5%8D%95%E8%A1%A8%E5%8D%95%E4%B8%8A%E6%98%BE%E7%A4%BA%E9%AA%8C%E8%AF%81%E9%94%99%E8%AF%AF.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-Lrx2AjbkGPWURrJJ17z%252F-Lrx3036m2z0FC9UYTmW%252F%E5%9B%BE%203.1%20Taco%20Cloud%20%E6%95%B0%E6%8D%AE%E8%A1%A8.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-Lrx45VtnV-WCQ6BGPcV%252F-Lrx4s9aWepQvbvNLzld%252F%E5%9B%BE%203.2.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LsGNzDutAWQQM7I5YA9%252F-LsGOVe8G3_9gL4zbf6R%252F%E5%9B%BE%204.2%20Spring%20Security%20%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E4%B8%AA%E5%85%8D%E8%B4%B9%E7%9A%84%E6%99%AE%E9%80%9A%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LsZbNhMfEZCDnmKnlU8%252F-LsZbaZRvtlohkr6FK1u%252F%E5%9B%BE%205.1.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LsZcjYMLbnPglDaJI0e%252F-LsZdKbRL_XIZXJgxNwu%252F%E5%9B%BE%205.2%20%E7%BC%BA%E5%B0%91%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%85%83%E6%95%B0%E6%8D%AE%E5%87%BA%E7%8E%B0%E7%9A%84%E8%AD%A6%E5%91%8A.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LsZcjYMLbnPglDaJI0e%252F-LsZdP8-rb6FCt_n0avb%252F%E5%9B%BE%205.3%20%E5%9C%A8%20Spring%20Tool%20Suite%20%E4%B8%AD%E6%82%AC%E5%81%9C%E6%98%BE%E7%A4%BA%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E6%96%87%E6%A1%A3.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LsZcjYMLbnPglDaJI0e%252F-LsZdVr9E9-80kOiQnqZ%252F%E5%9B%BE%205.4%20%E5%9C%A8%20Spring%20Tool%20Suite%20%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%BF%AB%E9%80%9F%E5%BC%B9%E5%87%BA%E6%96%B9%E5%BC%8F%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%85%83%E6%95%B0%E6%8D%AE.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LsZcjYMLbnPglDaJI0e%252F-LsZdg6iY-cefGQE_L7A%252F%E5%9B%BE%205.5%20%E6%82%AC%E5%81%9C%E6%98%BE%E7%A4%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%B8%AE%E5%8A%A9.jpg">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LsZcjYMLbnPglDaJI0e%252F-LsZdkjiPqqxVdb6YAfr%252F%E5%9B%BE%205.6%20%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%85%83%E6%95%B0%E6%8D%AE%E8%AE%A9%E5%B1%9E%E6%80%A7%E5%80%BC%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85.jpg">
<meta property="article:published_time" content="2021-12-10T02:26:02.000Z">
<meta property="article:modified_time" content="2022-04-14T04:23:46.958Z">
<meta property="article:author" content="CHENPENGBLOG">
<meta property="article:tag" content="spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrmRp6POrfan2ad79jr%252F-LrmSA7-88Rnb9GljVSL%252F%E5%9B%BE%201.2%20%E4%BD%BF%E7%94%A8%20Spring%20Tool%20Suite%20%E7%9A%84%20Initialzr%20%E5%88%9B%E5%BB%BA%E6%96%B0%E9%A1%B9%E7%9B%AE.jpg">

<link rel="canonical" href="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>ã€Šspring å®æˆ˜ã€‹ç¬¬ 5 ç‰ˆ è¯»ä¹¦ç¬”è®° | é™ˆé¹çš„åšå®¢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">é™ˆé¹çš„åšå®¢</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ğŸ˜‰</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://chenpeng.pages.dev/2021/12/10/Java/spring/spring-in-action-v5-notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CHENPENGBLOG">
      <meta itemprop="description" content="å…¨æ ˆæèµ·æ¥ï¼">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é™ˆé¹çš„åšå®¢">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ã€Šspring å®æˆ˜ã€‹ç¬¬ 5 ç‰ˆ è¯»ä¹¦ç¬”è®°
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-12-10 10:26:02" itemprop="dateCreated datePublished" datetime="2021-12-10T10:26:02+08:00">2021-12-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-04-14 12:23:46" itemprop="dateModified" datetime="2022-04-14T12:23:46+08:00">2022-04-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Spring 5 çš„ä¸»è¦ç‰¹ç‚¹æ˜¯å¯¹å“åº”å¼ç¼–ç¨‹çš„æ”¯æŒï¼ŒåŒ…æ‹¬ Spring WebFluxï¼Œè¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„å“åº”å¼ web æ¡†æ¶ï¼Œå®ƒå€Ÿé‰´äº† Spring MVC çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå…è®¸å¼€å‘äººå‘˜åˆ›å»ºå¯æ›´å¥½åœ°æ‰©å±•å’Œä½¿ç”¨æ›´å°‘çº¿ç¨‹çš„ web åº”ç”¨ç¨‹åºã€‚</p>
<span id="more"></span>

<h1 id="ç¬¬ä¸€éƒ¨åˆ†-Spring-åŸºç¡€"><a href="#ç¬¬ä¸€éƒ¨åˆ†-Spring-åŸºç¡€" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ† Spring åŸºç¡€"></a>ç¬¬ä¸€éƒ¨åˆ† Spring åŸºç¡€</h1><p>ç¬¬ä¸€ç« ä¸­ï¼Œå¿«é€Ÿæ¦‚è¿° Spring å’Œ Spring Boot çš„è¦ç‚¹ï¼Œå¹¶å±•ç¤ºå¦‚ä½•åœ¨ Taco Cloud ä¸Šåˆå§‹åŒ–ç¬¬ä¸€ä¸ª Spring é¡¹ç›®ã€‚</p>
<p>ç¬¬äºŒç« ä¸­ï¼Œæ·±å…¥ç ”ç©¶ Spring MVCï¼Œå¹¶äº†è§£å¦‚ä½•åœ¨æµè§ˆå™¨ä¸­å‘ˆç°æ¨¡å‹æ•°æ®ä»¥åŠå¦‚ä½•å¤„ç†å¹¶éªŒè¯è¡¨å•è¾“å…¥ï¼Œè¿˜å°†è·å¾—é€‰æ‹©è§†å›¾æ¨¡æ¿åº“çš„ä¸€äº›æç¤ºã€‚</p>
<p>ç¬¬ä¸‰ç« ä¸­ï¼Œå°†åœ¨ Taco Cloud åº”ç”¨ç¨‹åºä¸­æ·»åŠ æ•°æ®æŒä¹…æ€§ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä½¿ç”¨ Spring çš„ JDBC æ¨¡æ¿ï¼Œå¦‚ä½•æ’å…¥æ•°æ®ä»¥åŠå¦‚ä½•ä½¿ç”¨ Spring Data å£°æ˜ JPA å­˜å‚¨åº“ã€‚</p>
<p>ç¬¬å››ç« ä¸­ï¼Œä»‹ç»äº† Spring åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ï¼ŒåŒ…æ‹¬è‡ªåŠ¨é…ç½® Spring Securityï¼Œå®šä¹‰è‡ªå®šä¹‰ç”¨æˆ·å­˜å‚¨ï¼Œè‡ªå®šä¹‰ç™»å½•é¡µé¢å¹¶é˜²æ­¢è·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰æ”»å‡»ã€‚</p>
<p>ç¬¬äº”ç« ä¸­ï¼Œä»‹ç»é…ç½®å±æ€§ï¼Œå°†å­¦ä¹ å¦‚ä½•å¾®è°ƒè‡ªåŠ¨é…ç½®çš„ bean å’Œåº”ç”¨é…ç½®å±æ€§åˆ°åº”ç”¨ç¨‹åºç»„ä»¶ï¼Œå¹¶ä¸ Spring çš„ profile æ–‡ä»¶ä¸€èµ·ä½¿ç”¨ã€‚</p>
<h2 id="ç¬¬-1-ç« -Spring-å…¥é—¨"><a href="#ç¬¬-1-ç« -Spring-å…¥é—¨" class="headerlink" title="ç¬¬ 1 ç«  Spring å…¥é—¨"></a>ç¬¬ 1 ç«  Spring å…¥é—¨</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>Spring å’Œ Spring Boot æ¦‚è¿°</li>
<li>åˆå§‹åŒ–ä¸€ä¸ª Spring é¡¹ç›®</li>
<li>çºµè§ˆ Spring</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯-Springï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Springï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯  Springï¼Ÿ"></a>ä»€ä¹ˆæ˜¯  Springï¼Ÿ</h3><p>Spring çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé€šå¸¸ç§°ä¸º Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç†åº”ç”¨ç¨‹åºç»„ä»¶ã€‚</p>
<p>å°† bean è¿æ¥åœ¨ä¸€èµ·çš„è¡Œä¸ºæ˜¯åŸºäºä¸€ç§ç§°ä¸ºä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰çš„æ¨¡å¼ã€‚å®¹å™¨åˆ›å»ºå’Œç»´æŠ¤æ‰€æœ‰ç»„ä»¶ï¼Œå¹¶å°†è¿™äº›ç»„ä»¶æ³¨å…¥éœ€è¦å®ƒä»¬çš„ beanã€‚é€šå¸¸é€šè¿‡æ„é€ å‡½æ•°å‚æ•°æˆ–å±æ€§è®¿é—®å™¨æ–¹æ³•å®Œæˆæ­¤æ“ä½œã€‚</p>
<p>åŸºäº XML æ–‡ä»¶é…ç½®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;inventoryService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.InventoryService&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;productService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.ProductService&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;inventoryService&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åŸºäº Java çš„é…ç½®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> InventoryService <span class="title">inventoryService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> InventoryService();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProductService <span class="title">productService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ProductService(inventoryService());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>@Configuration</code> æ³¨è§£è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œå®ƒå°†ä¸º Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æä¾› beansã€‚</li>
<li> å¸¦æœ‰ <code>@Bean</code> æ³¨è§£çš„ç±»æ–¹æ³•ï¼ŒæŒ‡ç¤ºè¿”å›çš„å¯¹è±¡ä½œä¸º beans æ·»åŠ åˆ°åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬å„è‡ªçš„ bean IDs å°†ä¸å®šä¹‰å®ƒä»¬çš„æ–¹æ³•çš„åç§°ç›¸åŒï¼‰ã€‚</li>
</ol>
<p>ä»…å½“ Spring æ— æ³•è‡ªåŠ¨é…ç½®ç»„ä»¶æ—¶ï¼Œæ‰éœ€è¦ä½¿ç”¨ Java æˆ– XML è¿›è¡Œæ˜¾å¼é…ç½®ã€‚</p>
<p>è‡ªåŠ¨é…ç½®èµ·æºäº Spring æŠ€æœ¯ï¼Œå³ è‡ªåŠ¨è£…é… å’Œ ç»„ä»¶æ‰«æã€‚</p>
<ul>
<li>å€ŸåŠ©ç»„ä»¶æ‰«æï¼ŒSpring å¯ä»¥è‡ªåŠ¨ä»åº”ç”¨ç¨‹åºçš„ç±»è·¯å¾„ä¸­å‘ç°ç»„ä»¶ï¼Œå¹¶å°†å…¶åˆ›å»ºä¸º Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­çš„ beanã€‚</li>
<li>é€šè¿‡è‡ªåŠ¨è£…é…ï¼ŒSpring ä¼šè‡ªåŠ¨å°†ç»„ä»¶ä¸å®ƒä»¬ä¾èµ–çš„å…¶ä»– bean ä¸€èµ·æ³¨å…¥ã€‚</li>
</ul>
<p>Spring Boot ç›¸å¯¹äº Spring æ¡†æ¶æä¾›çš„æœ€è‘—åçš„å¢å¼ºåŠŸèƒ½æ˜¯ è‡ªåŠ¨é…ç½®ï¼Œåœ¨è¿™ç§é…ç½®ä¸­ï¼ŒSpring Boot å¯ä»¥æ ¹æ®ç±»è·¯å¾„ä¸­çš„æ¡ç›®ã€ç¯å¢ƒå˜é‡å’Œå…¶ä»–å› ç´ ï¼Œåˆç†åœ°çŒœæµ‹éœ€è¦é…ç½®å“ªäº›ç»„ä»¶ï¼Œå¹¶å°†å®ƒä»¬è¿æ¥åœ¨ä¸€èµ·ã€‚</p>
<h3 id="åˆå§‹åŒ–-Spring-åº”ç”¨ç¨‹åº"><a href="#åˆå§‹åŒ–-Spring-åº”ç”¨ç¨‹åº" class="headerlink" title="åˆå§‹åŒ– Spring åº”ç”¨ç¨‹åº"></a>åˆå§‹åŒ– Spring åº”ç”¨ç¨‹åº</h3><p>Spring Initializr æ—¢æ˜¯ä¸€ä¸ªåŸºäºæµè§ˆå™¨çš„ Web åº”ç”¨ç¨‹åºï¼Œåˆæ˜¯ä¸€ä¸ª REST APIï¼Œå®ƒä»¬å¯ä»¥ç”Ÿæˆä¸€ä¸ªåŸºæœ¬çš„ Spring é¡¹ç›®ç»“æ„ï¼Œå¯ä»¥ä½¿ç”¨æ‰€éœ€çš„ä»»ä½•åŠŸèƒ½å……å®è‡ªå·±ã€‚ ä½¿ç”¨ Spring Initializr çš„å‡ ç§æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä» Web åº”ç”¨ç¨‹åº <a target="_blank" rel="noopener" href="http://start.spring.io/">http://start.spring.io</a> åˆ›å»º</li>
<li>ä½¿ç”¨ <code>curl</code> å‘½ä»¤ä»å‘½ä»¤è¡Œåˆ›å»º</li>
<li>ä½¿ç”¨ Spring Boot å‘½ä»¤è¡Œæ¥å£ä»å‘½ä»¤è¡Œåˆ›å»º</li>
<li>ä½¿ç”¨ Spring Tool Suite åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®çš„æ—¶å€™</li>
<li>ä½¿ç”¨ IntelliJ IDEA åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®çš„æ—¶å€™</li>
<li>ä½¿ç”¨ NetBeans åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®çš„æ—¶å€™</li>
</ul>
<h4 id="ä½¿ç”¨-Spring-Tool-Suite-åˆå§‹åŒ–-Spring-é¡¹ç›®"><a href="#ä½¿ç”¨-Spring-Tool-Suite-åˆå§‹åŒ–-Spring-é¡¹ç›®" class="headerlink" title="ä½¿ç”¨ Spring Tool Suite åˆå§‹åŒ– Spring é¡¹ç›®"></a>ä½¿ç”¨ Spring Tool Suite åˆå§‹åŒ– Spring é¡¹ç›®</h4><p>è½¬åˆ° â€œæ–‡ä»¶â€ èœå•å¹¶é€‰æ‹© â€œæ–°å»ºâ€ï¼Œç„¶åé€‰æ‹© â€œSpring Starter Projectâ€ã€‚</p>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrmRp6POrfan2ad79jr%252F-LrmSA7-88Rnb9GljVSL%252F%E5%9B%BE%201.2%20%E4%BD%BF%E7%94%A8%20Spring%20Tool%20Suite%20%E7%9A%84%20Initialzr%20%E5%88%9B%E5%BB%BA%E6%96%B0%E9%A1%B9%E7%9B%AE.jpg" alt="img"></p>
<center>å›¾ 1.2 ä½¿ç”¨ Spring Tool Suite çš„ Initializr åˆ›å»ºæ–°é¡¹ç›®</center>

<p>å‘å¯¼çš„ç¬¬ä¸€é¡µè¦æ±‚æä¾›ä¸€äº›å¸¸è§„é¡¹ç›®ä¿¡æ¯ï¼Œä¾‹å¦‚é¡¹ç›®åç§°ã€æè¿°å’Œå…¶ä»–åŸºæœ¬ä¿¡æ¯ã€‚</p>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrmRp6POrfan2ad79jr%252F-LrmSQ_0c-AWLPD_ndG_%252F%E5%9B%BE%201.3%20%E5%A1%AB%E5%86%99%20Taco%20Cloud%20%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%A1%B9%E7%9B%AE%E4%BF%A1%E6%81%AF.jpg" alt="img"></p>
<center>å›¾ 1.4 é€‰æ‹©ä¾èµ–</center>

<p>é€‰æ‹©è¦æ·»åŠ åˆ°é¡¹ç›®ä¸­çš„ä¾èµ–é¡¹ã€‚æ­¤æ—¶ï¼Œå¯ä»¥å•å‡»å®Œæˆä»¥ç”Ÿæˆé¡¹ç›®å¹¶å°†å…¶æ·»åŠ åˆ°å·¥ä½œåŒºã€‚å¦‚æœæ„Ÿåˆ°æœ‰ç‚¹å±é™©ï¼Œè¯·å†æ¬¡å•å‡» â€œä¸‹ä¸€æ­¥â€ï¼Œä»¥æŸ¥çœ‹æ–°çš„ starter é¡¹ç›®å‘å¯¼çš„æœ€åä¸€é¡µã€‚</p>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrmRp6POrfan2ad79jr%252F-LrmSsBcUkuk8bY0qvq-%252F%E5%9B%BE%201.5%20%E6%8C%87%E5%AE%9A%E5%A4%87%E7%94%A8%20Initializr%20%E5%9C%B0%E5%9D%80%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89.jpg" alt="img"></p>
<center>å›¾ 1.5 æŒ‡å®šå¤‡ç”¨ Initializr åœ°å€ï¼ˆå¯é€‰ï¼‰</center>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°é¡¹ç›®å‘å¯¼åœ¨ <a target="_blank" rel="noopener" href="http://start.spring.io/">http://start.spring.io</a> ä¸Šè°ƒç”¨ Spring Initializr ä»¥ç”Ÿæˆé¡¹ç›®ã€‚</p>
<h4 id="æ£€æŸ¥-Spring-é¡¹ç›®ç»“æ„"><a href="#æ£€æŸ¥-Spring-é¡¹ç›®ç»“æ„" class="headerlink" title="æ£€æŸ¥ Spring é¡¹ç›®ç»“æ„"></a>æ£€æŸ¥ Spring é¡¹ç›®ç»“æ„</h4><p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrmRp6POrfan2ad79jr%252F-LrmT3VxI0jBGAUEIKuu%252F%E5%9B%BE%201.6%20Spring%20Tool%20Suite%20%E4%B8%AD%E7%9A%84%20Spring%20%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.jpg" alt="img"></p>
<center>å›¾ 1.6 Spring Tool Suite ä¸­çš„ Spring é¡¹ç›®ç»“æ„</center>

<p>åœ¨è¯¥é¡¹ç›®ç»“æ„ä¸­ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹äº‹é¡¹ï¼š</p>
<ul>
<li><code>mvnw</code> å’Œ <code>mvnw.cmd</code> â€”â€” è¿™äº›æ˜¯ Maven åŒ…è£…å™¨è„šæœ¬ã€‚å³ä½¿ä½ çš„è®¡ç®—æœºä¸Šæ²¡æœ‰å®‰è£… Mavenï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿™äº›è„šæœ¬æ„å»ºé¡¹ç›®ã€‚</li>
<li><code>pom.xml</code> â€”â€” è¿™æ˜¯ Maven æ„å»ºè§„èŒƒã€‚</li>
<li><code>TacoCloudApplication.java</code> â€”â€” è¿™æ˜¯å¼•å¯¼é¡¹ç›®çš„ Spring Boot ä¸»ç±»ã€‚</li>
<li><code>application.properties</code> â€”â€” è¯¥æ–‡ä»¶æœ€åˆä¸ºç©ºï¼Œä½†æä¾›äº†ä¸€ä¸ªå¯ä»¥æŒ‡å®šé…ç½®å±æ€§çš„åœ°æ–¹ã€‚</li>
<li><code>static</code> â€”â€” åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­ï¼Œå¯ä»¥æ”¾ç½®è¦æä¾›ç»™æµè§ˆå™¨çš„ä»»ä½•é™æ€å†…å®¹ï¼ˆå›¾åƒã€æ ·å¼è¡¨ã€JavaScript ç­‰ï¼‰ï¼Œæœ€åˆä¸ºç©ºã€‚</li>
<li><code>templates</code> â€”â€” åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­ï¼Œæ”¾ç½®ç”¨äºå‘æµè§ˆå™¨å‘ˆç°å†…å®¹çš„æ¨¡æ¿æ–‡ä»¶ã€‚æœ€åˆä¸ºç©ºï¼Œä½†å¾ˆå¿«ä¼šæ·»åŠ  Thymeleaf æ¨¡æ¿ã€‚</li>
<li><code>TacoCloudApplicationTests.java</code> â€”â€” è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æµ‹è¯•ç±»ï¼Œå¯ç¡®ä¿æˆåŠŸåŠ è½½ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ã€‚</li>
</ul>
<p><strong>æ¢ç´¢æ„å»ºè§„èŒƒ</strong></p>
<p>å¡«å†™ Initializr è¡¨å•æ—¶ï¼ŒæŒ‡å®šåº”ä½¿ç”¨ Maven æ„å»ºé¡¹ç›®ã€‚å› æ­¤ï¼ŒSpring Initializr ç»™äº†ä½ ä¸€ä¸ª pom.xml æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å·²ç»å¡«å……äº†ä½ æ‰€åšçš„é€‰æ‹©ã€‚</p>
<center>ç¨‹åºæ¸…å• 1.1 åˆå§‹åŒ– Maven æ„å»ºè§„èŒƒ</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>sia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>taco-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>taco-cloud<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Taco Cloud Example<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.seleniumhq.selenium<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>selenium-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.seleniumhq.selenium<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>htmlunit-driver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> <code>&lt;packaging&gt;</code> å…ƒç´ å°†åº”ç”¨ç¨‹åºæ„å»ºä¸ºå¯æ‰§è¡Œçš„ JAR æ–‡ä»¶ã€‚Spring Initializr é»˜è®¤ä¸º JAR æ‰“åŒ…ã€‚</p>
<p> <code>&lt;parent&gt;</code> å…ƒç´ æŒ‡å®šé¡¹ç›®å°† <code>spring-boot-starter-parent</code> ä½œä¸ºå®ƒçš„çˆ¶ POMã€‚</p>
<p> <code>&lt;dependencies&gt;</code> å…ƒç´ ä¸‹ä¾èµ–é¡¹çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºï¼Œå®ƒä»¬æœ¬èº«é€šå¸¸æ²¡æœ‰ä»»ä½•åº“ä»£ç ï¼Œè€Œæ˜¯é—´æ¥åœ°å¼•å…¥å…¶ä»–åº“ã€‚è¿™äº› starter ä¾èµ–æä¾›äº†ä¸‰ä¸ªä¸»è¦çš„å¥½å¤„ï¼š</p>
<ul>
<li>æ„å»ºçš„æ–‡ä»¶å°†ä¼šå°å¾—å¤šï¼Œä¹Ÿæ›´å®¹æ˜“ç®¡ç†ï¼Œå› ä¸ºä¸éœ€è¦å¯¹æ¯ä¸€ä¸ªå¯èƒ½éœ€è¦çš„åº“éƒ½å£°æ˜ä¸€ä¸ªä¾èµ–é¡¹ã€‚</li>
<li>å¯ä»¥æ ¹æ®å®ƒä»¬æä¾›çš„åŠŸèƒ½æ¥è€ƒè™‘éœ€è¦çš„ä¾èµ–å…³ç³»ï¼Œè€Œä¸æ˜¯æ ¹æ®åº“åæ¥è€ƒè™‘ã€‚</li>
<li>ä¸ç”¨æ‹…å¿ƒ library ç‰ˆæœ¬é—®é¢˜ã€‚</li>
</ul>
<p>æœ€åï¼Œæ„å»ºè§„èŒƒä»¥ Spring Boot æ’ä»¶ç»“æŸã€‚è¿™ä¸ªæ’ä»¶æ‰§è¡Œä¸€äº›é‡è¦çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>æä¾›äº†ä¸€ä¸ª Maven ç¼–è¯‘ç›®æ ‡ï¼Œè®©ä½ èƒ½å¤Ÿä½¿ç”¨ Maven è¿è¡Œåº”ç”¨ç¨‹åºã€‚</li>
<li>ç¡®ä¿æ‰€æœ‰çš„ä¾èµ–åº“éƒ½åŒ…å«åœ¨å¯æ‰§è¡Œçš„ JAR æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”åœ¨è¿è¡Œæ—¶ç±»è·¯å¾„ä¸­å¯ç”¨ã€‚</li>
<li>åœ¨ JAR æ–‡ä»¶ä¸­ç”Ÿæˆä¸€ä¸ª manifest æ–‡ä»¶ï¼Œè¡¨ç¤ºå¼•å¯¼ç±»ï¼ˆåœ¨æœ¬ä¹¦ä¾‹å­ä¸­æ˜¯ <code>TacoCloudApplication</code>ï¼‰æ˜¯å¯æ‰§è¡Œ JAR çš„ä¸»ç±»ã€‚</li>
</ul>
<p><strong>å¼•å¯¼åº”ç”¨ç¨‹åº</strong></p>
<center>ç¨‹åºæ¸…å• 1.2 Taco Cloud å¼•å¯¼ç±»</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TacoCloudApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(TacoCloudApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@SpringBootApplication</code> æ³¨é‡Šè¡¨æ˜è¿™æ˜¯ä¸€ä¸ª Spring å¼•å¯¼åº”ç”¨ç¨‹åºã€‚<code>@SpringBootApplication</code> æ˜¯ä¸€ä¸ªç»„åˆäº†å…¶ä»–ä¸‰ä¸ªæ³¨é‡Šçš„å¤åˆåº”ç”¨ç¨‹åºï¼š</p>
<ul>
<li><code>@SpringBootConfiguration</code> â€”â€” æŒ‡å®šè¿™ä¸ªç±»ä¸ºé…ç½®ç±»ã€‚</li>
<li><code>@EnableAutoConfiguration</code> â€”â€” å¯ç”¨ Spring è‡ªåŠ¨é…ç½®ã€‚</li>
<li><code>@ComponentScan</code> â€”â€” å¯ç”¨ç»„ä»¶æ‰«æã€‚è¿™å…è®¸ä½ å£°æ˜å…¶ä»–å¸¦æœ‰ <code>@Component</code>ã€<code>@Controller</code>ã€<code>@Service</code> ç­‰æ³¨é‡Šçš„ç±»ï¼Œä»¥ä¾¿è®© Spring è‡ªåŠ¨å‘ç°å®ƒä»¬å¹¶å°†å®ƒä»¬æ³¨å†Œä¸º Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­çš„ç»„ä»¶ã€‚</li>
</ul>
<p><code>TacoCloudApplication</code> çš„å¦ä¸€ä¸ªé‡è¦éƒ¨åˆ†æ˜¯ <code>main()</code> æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å°†åœ¨æ‰§è¡Œ JAR æ–‡ä»¶æ—¶è¿è¡Œã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•æ˜¯æ ·æ¿ä»£ç ï¼›ç¼–å†™çš„æ¯ä¸ª Spring å¼•å¯¼åº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªç±»ä¼¼æˆ–ç›¸åŒçš„æ–¹æ³•ï¼ˆå°½ç®¡ç±»åä¸åŒï¼‰ã€‚</p>
<p><code>main()</code> æ–¹æ³•è°ƒç”¨ SpringApplication ç±»ä¸Šçš„é™æ€ <code>run()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ‰§è¡Œåº”ç”¨ç¨‹åºçš„å®é™…å¼•å¯¼ï¼Œåˆ›å»º<code>Spring</code> åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ã€‚ä¼ é€’ç»™ <code>run()</code> æ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªé…ç½®ç±»å’Œå‘½ä»¤è¡Œå‚æ•°ã€‚è™½ç„¶ä¼ é€’ç»™ <code>run()</code> çš„é…ç½®ç±»ä¸å¿…ä¸å¼•å¯¼ç±»ç›¸åŒï¼Œä½†è¿™æ˜¯æœ€æ–¹ä¾¿ã€æœ€å…¸å‹çš„é€‰æ‹©ã€‚</p>
<p><strong>æµ‹è¯•åº”ç”¨ç¨‹åº</strong></p>
<center>ç¨‹åºæ¸…å• 1.3 åŸºå‡†åº”ç”¨æµ‹è¯•</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TacoCloudApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæµ‹è¯•ç±»æ‰§è¡Œäº†å¿…è¦çš„æ£€æŸ¥ï¼Œä»¥ç¡®ä¿ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡èƒ½å¤ŸæˆåŠŸåŠ è½½ã€‚</p>
<p><code>@RunWith</code> æ˜¯ä¸€ä¸ª JUnit æ³¨é‡Šï¼Œæä¾›äº†ä¸€ä¸ªæµ‹è¯•è¿è¡Œå™¨æ¥å¼•å¯¼ JUnit è¿è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒJUnit è¢«èµ‹äºˆäº† SpringRunnerï¼Œè¿™æ˜¯ä¸€ä¸ªç”± Spring æä¾›çš„æµ‹è¯•è¿è¡Œç¨‹åºï¼Œå®ƒæä¾›äº†åˆ›å»ºä¸€ä¸ª Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„åŠŸèƒ½ï¼Œä»¥ä¾›æµ‹è¯•è¿è¡Œã€‚</p>
<p><strong>å…¶ä»–åå­—çš„æµ‹è¯•è¿è¡Œå™¨</strong></p>
<p><code>SpringRunner</code> æ˜¯ <code>SpringJUnit4ClassRunner</code> çš„åˆ«åï¼Œå®ƒæ˜¯åœ¨ Spring 4.3 ä¸­å¼•å…¥çš„ï¼Œç”¨äºåˆ é™¤ä¸ç‰¹å®šç‰ˆæœ¬çš„ JUnit ï¼ˆä¾‹å¦‚ï¼ŒJUnit4ï¼‰çš„å…³è”ã€‚</p>
<p><code>@SpringBootTest</code> å‘Šè¯‰ JUnit ä½¿ç”¨ Spring å¼•å¯¼åŠŸèƒ½å¼•å¯¼æµ‹è¯•ã€‚ç°åœ¨ï¼ŒæŠŠå®ƒçœ‹ä½œæ˜¯åœ¨ <code>main()</code> æ–¹æ³•ä¸­è°ƒç”¨ <code>SpringApplication.run()</code> çš„æµ‹è¯•ç±»å°±è¶³å¤Ÿäº†ã€‚</p>
<h3 id="ç¼–å†™-Spring-åº”ç”¨ç¨‹åº"><a href="#ç¼–å†™-Spring-åº”ç”¨ç¨‹åº" class="headerlink" title="ç¼–å†™ Spring åº”ç”¨ç¨‹åº"></a>ç¼–å†™ Spring åº”ç”¨ç¨‹åº</h3><p>åœ¨åˆšåˆšå¼€å§‹çš„æ—¶å€™ï¼Œæ·»åŠ åˆ° Taco Cloud åº”ç”¨ç¨‹åºçš„ç¬¬ä¸€ä¸ªåŠŸèƒ½æ˜¯ä¸»é¡µã€‚å½“ä½ æ·»åŠ ä¸»é¡µï¼Œä½ å°†åˆ›å»ºä¸¤ä¸ªä»£ç æ„ä»¶ï¼š</p>
<ul>
<li>ä¸€ä¸ªå¤„ç†ä¸»é¡µè¯·æ±‚çš„æ§åˆ¶å™¨ç±»</li>
<li>ä¸€ä¸ªè§†å›¾æ¨¡æ¿ï¼Œå®šä¹‰äº†ä¸»é¡µçš„å¤–è§‚</li>
</ul>
<h4 id="å¤„ç†-web-è¯·æ±‚"><a href="#å¤„ç†-web-è¯·æ±‚" class="headerlink" title="å¤„ç† web è¯·æ±‚"></a>å¤„ç† web è¯·æ±‚</h4><p>Spring MVC çš„æ ¸å¿ƒæ˜¯æ§åˆ¶å™¨çš„æ¦‚å¿µï¼Œè¿™æ˜¯ä¸€ä¸ªå¤„ç†è¯·æ±‚å¹¶ä½¿ç”¨æŸç§ä¿¡æ¯è¿›è¡Œå“åº”çš„ç±»ã€‚å¯¹äºé¢å‘æµè§ˆå™¨çš„åº”ç”¨ç¨‹åºï¼Œæ§åˆ¶å™¨çš„å“åº”æ–¹å¼æ˜¯å¯é€‰åœ°å¡«å……æ¨¡å‹æ•°æ®å¹¶å°†è¯·æ±‚ä¼ é€’ç»™è§†å›¾ï¼Œä»¥ç”Ÿæˆè¿”å›ç»™æµè§ˆå™¨çš„ HTMLã€‚</p>
<center>ç¨‹åºæ¸…å• 1.4 ä¸»é¡µæ§åˆ¶å™¨</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;home&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@Controller</code> çš„ä¸»è¦ç›®çš„æ˜¯å°†è¯¥ç±»è¯†åˆ«ä¸ºç»„ä»¶æ‰«æçš„ç»„ä»¶ã€‚</p>
<p><code>home()</code> æ–¹æ³•ä½¿ç”¨ <code>@GetMapping</code> è¿›è¡Œæ³¨é‡Šï¼Œå¦‚æœæ¥æ”¶åˆ°æ ¹è·¯å¾„ <code>/</code> çš„ HTTP GET è¯·æ±‚ï¼Œåˆ™æ­¤æ–¹æ³•åº”è¯¥å¤„ç†è¯¥è¯·æ±‚ã€‚è¿”å› <code>home</code> çš„ <code>String</code> å€¼è¢«è§£é‡Šä¸ºè§†å›¾çš„é€»è¾‘åç§°ã€‚</p>
<p>æ¨¡æ¿åç§°ç”±é€»è¾‘è§†å›¾åç§°æ´¾ç”Ÿè€Œæ¥ï¼Œå®ƒçš„å‰ç¼€æ˜¯ /templates/ï¼Œåç¼€æ˜¯ .htmlã€‚æ¨¡æ¿çš„ç»“æœè·¯å¾„æ˜¯ /templates/home.htmlã€‚å› æ­¤ï¼Œéœ€è¦å°†æ¨¡æ¿æ”¾åœ¨é¡¹ç›®çš„ /src/main/resources/templates/home.html ä¸­ã€‚</p>
<h4 id="å®šä¹‰è§†å›¾"><a href="#å®šä¹‰è§†å›¾" class="headerlink" title="å®šä¹‰è§†å›¾"></a>å®šä¹‰è§†å›¾</h4><center>ç¨‹åºæ¸…å• 1.5 Taco Cloud ä¸»é¡µæ¨¡æ¿</center>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Taco Cloud<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to...<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/images/TacoCloud.png&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;img&gt;</code> æ ‡è®°ä½¿ç”¨ä¸€ä¸ª Thymeleaf çš„ <code>th:src</code> å±æ€§å’Œä¸€ä¸ª <code>@&#123;â€¦&#125;</code> è¡¨è¾¾å¼å¼•ç”¨å…·æœ‰ä¸Šä¸‹æ–‡ç›¸å¯¹è·¯å¾„çš„å›¾ç‰‡ã€‚é™¤å»è¿™äº›ï¼Œå®ƒåªæ˜¯ä¸€ä¸ª Hello World é¡µé¢ã€‚</p>
<p>è¯¥å›¾ç‰‡æ˜¯é€šè¿‡ä¸Šä¸‹æ–‡ç›¸å¯¹è·¯å¾„ /images/TacoCloud.png è¿›è¡Œå¼•ç”¨çš„ã€‚</p>
<h4 id="æµ‹è¯•æ§åˆ¶å™¨"><a href="#æµ‹è¯•æ§åˆ¶å™¨" class="headerlink" title="æµ‹è¯•æ§åˆ¶å™¨"></a>æµ‹è¯•æ§åˆ¶å™¨</h4><p>æµ‹è¯•å°†å¯¹æ ¹è·¯å¾„ <code>/</code> æ‰§è¡Œä¸€ä¸ª HTTP GET è¯·æ±‚å¹¶æœŸæœ›å¾—åˆ°ä¸€ä¸ªæˆåŠŸçš„ç»“æœï¼Œå…¶ä¸­è§†å›¾åç§°ä¸º homeï¼Œç»“æœå†…å®¹åŒ…å«çŸ­è¯­ â€œWelcome toâ€¦â€ã€‚</p>
<center>ç¨‹åºæ¸…å• 1.6 ä¸»é¡µæ§åˆ¶å™¨æµ‹è¯•</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.Matchers.containsString;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.view;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@WebMvcTest(HomeController.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeControllerTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHomePage</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        mockMvc.perform(get(<span class="string">&quot;/&quot;</span>))</span><br><span class="line">            .andExpect(status().isOk())</span><br><span class="line">            .andExpect(view().name(<span class="string">&quot;home&quot;</span>))</span><br><span class="line">            .andExpect(content().string(containsString(<span class="string">&quot;Welcome to...&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@WebMvcTest</code> æ³¨é‡Šæ˜¯ Spring Boot æä¾›çš„ä¸€ä¸ªç‰¹æ®Šæµ‹è¯•æ³¨é‡Šï¼Œå®ƒå®‰æ’æµ‹è¯•åœ¨ Spring MVC åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚æµ‹è¯•ç±»è¢«æ³¨å…¥äº†ä¸€ä¸ª <code>MockMvc</code> å¯¹è±¡ä¸­ï¼Œä»¥æ­¤ç”¨æ¥æµ‹è¯•æ¥é©±åŠ¨æ¨¡å‹ã€‚</p>
<p><code>testHomePage()</code> æ–¹æ³•å®šä¹‰äº†è¦å¯¹ä¸»é¡µæ‰§è¡Œçš„æµ‹è¯•ã€‚å®ƒä» <code>MockMvc</code> å¯¹è±¡å¼€å§‹ï¼Œæ‰§è¡Œé’ˆå¯¹ <code>/</code>ï¼ˆæ ¹è·¯å¾„ï¼‰çš„ HTTP GET è¯·æ±‚ã€‚è¯¥è¯·æ±‚è§„å®šäº†ä¸‹åˆ—æœŸæœ›å€¼ï¼š</p>
<ul>
<li>å“åº”åº”è¯¥æœ‰ä¸€ä¸ªHTTP 200ï¼ˆOKï¼‰çŠ¶æ€ã€‚</li>
<li>è§†å›¾åº”è¯¥æœ‰ä¸€ä¸ªåˆç†ä¸»é¡µåç§°ã€‚</li>
<li>å‘ˆç°çš„è§†å›¾åº”è¯¥åŒ…å« â€œWelcome toâ€¦â€</li>
</ul>
<h4 id="æ„å»ºå¹¶è¿è¡Œåº”ç”¨ç¨‹åº"><a href="#æ„å»ºå¹¶è¿è¡Œåº”ç”¨ç¨‹åº" class="headerlink" title="æ„å»ºå¹¶è¿è¡Œåº”ç”¨ç¨‹åº"></a>æ„å»ºå¹¶è¿è¡Œåº”ç”¨ç¨‹åº</h4><p>ç°åœ¨åº”ç”¨ç¨‹åºå·²ç»å¯åŠ¨ï¼Œå°† web æµè§ˆå™¨æŒ‡å‘ <a href="http://localhost:8080ï¼ˆæˆ–å•å‡»">http://localhost:8080ï¼ˆæˆ–å•å‡»</a> Spring Boot Dashboard ä¸­åœ°çƒä»ªæ ·å­çš„æŒ‰é’®)ï¼Œåº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼å›¾ 1.8 æ‰€ç¤ºçš„å†…å®¹ã€‚</p>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrmV4WtkpHywscz5eP1%252F-LrmW3ggDtgd4Qz0WKBn%252F%E5%9B%BE%201.8%20Taco%20Cloud%20%E4%B8%BB%E9%A1%B5.jpg" alt="img"></p>
<center>å›¾ 1.8 Taco Cloud ä¸»é¡µ</center>

<h4 id="äº†è§£-Spring-Boot-DevTools"><a href="#äº†è§£-Spring-Boot-DevTools" class="headerlink" title="äº†è§£ Spring Boot DevTools"></a>äº†è§£ Spring Boot DevTools</h4><p>DevTools ä¸º Spring å¼€å‘äººå‘˜æä¾›äº†ä¸€äº›æ–¹ä¾¿çš„å¼€å‘åŒæ­¥å·¥å…·ã€‚è¿™äº›æ˜¯ï¼š</p>
<ul>
<li>å½“ä»£ç æ›´æ”¹æ—¶è‡ªåŠ¨é‡å¯åº”ç”¨ç¨‹åº</li>
<li>å½“ä»¥æµè§ˆå™¨ä¸ºç›®æ ‡çš„èµ„æºï¼ˆå¦‚æ¨¡æ¿ã€JavaScriptã€æ ·å¼è¡¨ç­‰ï¼‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åˆ·æ–°</li>
<li>è‡ªåŠ¨ç¦ç”¨æ¨¡æ¿ç¼“å­˜</li>
<li>å¦‚æœ H2 æ•°æ®åº“æ­£åœ¨ä½¿ç”¨ï¼Œåˆ™åœ¨ H2 æ§åˆ¶å°ä¸­æ„å»º</li>
</ul>
<p>DevTools ä¸æ˜¯ IDE æ’ä»¶ã€‚ä»…ç”¨äºå¼€å‘ç›®çš„ï¼Œåœ¨éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒæ—¶ç¦ç”¨ã€‚</p>
<p><strong>è‡ªåŠ¨é‡å¯åº”ç”¨ç¨‹åº</strong></p>
<p>å½“ DevTools èµ·ä½œç”¨æ—¶ï¼Œåº”ç”¨ç¨‹åºè¢«åŠ è½½åˆ° Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­çš„ä¸¤ä¸ªå•ç‹¬çš„ç±»åŠ è½½å™¨ä¸­ã€‚ä¸€ä¸ªç±»è£…å…¥å™¨è£…å…¥ Java ä»£ç ã€å±æ€§æ–‡ä»¶ä»¥åŠé¡¹ç›®çš„ src/main/path ä¸­çš„å‡ ä¹æ‰€æœ‰ä¸œè¥¿ã€‚è¿™äº›é¡¹ç›®å¯èƒ½ä¼šé¢‘ç¹æ›´æ”¹ã€‚å¦ä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½äº†ä¾èµ–åº“ï¼Œå®ƒä»¬ä¸å¤ªå¯èƒ½ç»å¸¸æ›´æ”¹ã€‚</p>
<p>å½“æ£€æµ‹åˆ°æ›´æ”¹æ—¶ï¼ŒDevTools åªé‡æ–°åŠ è½½åŒ…å«é¡¹ç›®ä»£ç çš„ç±»åŠ è½½å™¨ï¼Œå¹¶é‡æ–°å¯åŠ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œä½†ä¸å½±å“å…¶ä»–ç±»åŠ è½½å™¨å’Œ JVMã€‚</p>
<p><strong>è‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨å’Œç¦ç”¨æ¨¡æ¿ç¼“å­˜</strong></p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡æ¿é€‰é¡¹ï¼ˆå¦‚ Thymeleaf å’Œ FreeMarkerï¼‰è¢«é…ç½®ä¸ºç¼“å­˜æ¨¡æ¿è§£æçš„ç»“æœï¼Œè¿™æ ·æ¨¡æ¿å°±ä¸éœ€è¦å¯¹å®ƒä»¬æ‰€æœåŠ¡çš„æ¯ä¸ªè¯·æ±‚è¿›è¡Œä¿®å¤ã€‚è¿™åœ¨ç”Ÿäº§ä¸­éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸¦æ¥ä¸€äº›æ€§èƒ½ä¸Šçš„å¥½å¤„ã€‚</p>
<p>ä½†æ˜¯ï¼Œç¼“å­˜çš„æ¨¡æ¿åœ¨å¼€å‘æ—¶ä¸æ˜¯å¾ˆå¥½ã€‚DevTools é€šè¿‡è‡ªåŠ¨ç¦ç”¨æ‰€æœ‰æ¨¡æ¿ç¼“å­˜æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><strong>åœ¨ H2 æ§åˆ¶å°ä¸­æ„å»º</strong></p>
<p>å¦‚æœé€‰æ‹©ä½¿ç”¨ H2 æ•°æ®åº“è¿›è¡Œå¼€å‘ï¼ŒDevTools è¿˜å°†è‡ªåŠ¨å¯ç”¨ä¸€ä¸ª H2 æ§åˆ¶å°ï¼Œä½ å¯ä»¥ä» web æµè§ˆå™¨è®¿é—®è¯¥æ§åˆ¶å°ã€‚åªéœ€å°† web æµè§ˆå™¨æŒ‡å‘ <a target="_blank" rel="noopener" href="http://localhost:8080/h2-console%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%AD%A3%E5%9C%A8%E5%A4%84%E7%90%86%E7%9A%84%E6%95%B0%E6%8D%AE%E3%80%82">http://localhost:8080/h2-consoleï¼Œå°±å¯ä»¥æ·±å…¥äº†è§£åº”ç”¨ç¨‹åºæ­£åœ¨å¤„ç†çš„æ•°æ®ã€‚</a></p>
<h4 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h4><p>ä»¥ä¸‹æ˜¯æ„å»ºåŸºäº Spring çš„ Taco Cloud åº”ç”¨ç¨‹åºçš„æ­¥éª¤ï¼š</p>
<ul>
<li>ä½¿ç”¨ Spring Initializr åˆ›å»ºäº†ä¸€ä¸ªåˆå§‹é¡¹ç›®ç»“æ„ã€‚</li>
<li>å†™äº†ä¸€ä¸ªæ§åˆ¶å™¨ç±»æ¥å¤„ç†ä¸»é¡µè¯·æ±‚ã€‚</li>
<li>å®šä¹‰äº†ä¸€ä¸ªè§†å›¾æ¨¡æ¿æ¥å‘ˆç°ä¸»é¡µã€‚</li>
<li>å†™äº†ä¸€ä¸ªç®€å•çš„æµ‹è¯•ç±»æ¥æ£€éªŒä¸Šè¯‰å·¥ä½œã€‚</li>
</ul>
<p>ä¸ºäº†ç†è§£ Spring åœ¨åšä»€ä¹ˆï¼Œè®©æˆ‘ä»¬ä»æ„å»ºè§„èŒƒå¼€å§‹ã€‚</p>
<p>åœ¨ pom.xml æ–‡ä»¶ä¸­ï¼Œå£°æ˜äº†å¯¹ Web å’Œ Thymeleaf å¯åŠ¨å™¨çš„ä¾èµ–ã€‚è¿™ä¸¤ä¸ªä¾èµ–å…³ç³»å¸¦æ¥äº†ä¸€äº›å…¶ä»–çš„ä¾èµ–å…³ç³»ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>Spring MVC æ¡†æ¶</li>
<li>åµŒå…¥å¼ Tomcat</li>
<li>Thymeleaf å’Œ Thymeleaf å¸ƒå±€æ–¹è¨€</li>
</ul>
<p>å®ƒè¿˜å¸¦æ¥äº† Spring Boot çš„è‡ªåŠ¨é…ç½®åº“ã€‚å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼ŒSpring Boot è‡ªåŠ¨é…ç½®è‡ªåŠ¨æ£€æµ‹è¿™äº›åº“å¹¶è‡ªåŠ¨æ‰§è¡Œï¼š</p>
<ul>
<li>åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­é…ç½® bean ä»¥å¯ç”¨ Spring MVC</li>
<li>å°†åµŒå…¥å¼ Tomcat æœåŠ¡å™¨é…ç½®åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­</li>
<li>ä¸ºä½¿ç”¨ Thymeleaf æ¨¡æ¿å‘ˆç° Spring MV Cè§†å›¾ï¼Œé…ç½®äº†ä¸€ä¸ª Thymeleaf è§†å›¾è§£æå™¨</li>
</ul>
<p>ç®€è€Œè¨€ä¹‹ï¼Œè‡ªåŠ¨é…ç½®å®Œæˆäº†æ‰€æœ‰ç¹é‡çš„å·¥ä½œï¼Œè®©ä½ ä¸“æ³¨äºç¼–å†™å®ç°åº”ç”¨ç¨‹åºåŠŸèƒ½çš„ä»£ç ã€‚</p>
<h3 id="ä¿¯ç°-Spring-é£æ™¯çº¿"><a href="#ä¿¯ç°-Spring-é£æ™¯çº¿" class="headerlink" title="ä¿¯ç° Spring é£æ™¯çº¿"></a>ä¿¯ç° Spring é£æ™¯çº¿</h3><p>è¦äº†è§£ Spring çš„é£æ™¯çº¿ï¼Œåªéœ€æŸ¥çœ‹å®Œæ•´ç‰ˆ Spring Initializr web è¡¨å•ä¸Šçš„å¤§é‡å¤é€‰æ¡†åˆ—è¡¨å³å¯ã€‚</p>
<h4 id="Spring-æ ¸å¿ƒæ¡†æ¶"><a href="#Spring-æ ¸å¿ƒæ¡†æ¶" class="headerlink" title="Spring æ ¸å¿ƒæ¡†æ¶"></a>Spring æ ¸å¿ƒæ¡†æ¶</h4><p>Spring æ ¸å¿ƒæ¡†æ¶æ˜¯ Spring é¢†åŸŸä¸­å…¶ä»–ä¸€åˆ‡çš„åŸºç¡€ã€‚å®ƒæä¾›äº†æ ¸å¿ƒå®¹å™¨å’Œä¾èµ–æ³¨å…¥æ¡†æ¶ã€‚ä½†å®ƒä¹Ÿæä¾›äº†ä¸€äº›å…¶ä»–çš„åŸºæœ¬ç‰¹æ€§ã€‚</p>
<p>å…¶ä¸­åŒ…æ‹¬ Spring MVC å’Œ Spring web æ¡†æ¶ã€‚å·²ç»äº†è§£äº†å¦‚ä½•ä½¿ç”¨ Spring MVC ç¼–å†™æ§åˆ¶å™¨ç±»æ¥å¤„ç† web è¯·æ±‚ã€‚ä½†æ˜¯ï¼Œæ‚¨è¿˜æ²¡æœ‰çœ‹åˆ°çš„æ˜¯ï¼ŒSpring MVC ä¹Ÿå¯ä»¥ç”¨äºåˆ›å»ºäº§ç”Ÿé HTML è¾“å‡ºçš„ REST APIã€‚</p>
<p>Spring æ ¸å¿ƒæ¡†æ¶è¿˜æä¾›äº†ä¸€äº›åŸºæœ¬æ•°æ®æŒä¹…æ€§æ”¯æŒï¼Œç‰¹åˆ«æ˜¯åŸºäºæ¨¡æ¿çš„ JDBC æ”¯æŒã€‚</p>
<p>åœ¨ Spring çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆ5.0.8ï¼‰ä¸­ï¼Œæ·»åŠ äº†å¯¹å“åº”å¼ç¼–ç¨‹çš„æ”¯æŒï¼ŒåŒ…æ‹¬ä¸€ä¸ªæ–°çš„å“åº”å¼ web æ¡†æ¶ â€”â€” Spring WebFluxï¼Œå®ƒå¤§é‡å€Ÿé‰´äº† Spring MVCã€‚</p>
<h4 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h4><p>Spring Boot çš„å¥½å¤„åŒ…æ‹¬å¯åŠ¨ä¾èµ–é¡¹å’Œè‡ªåŠ¨é…ç½®ã€‚è¿˜æä¾›äº†ä¸€äº›å…¶ä»–æœ‰ç”¨çš„ç‰¹æ€§ï¼š</p>
<ul>
<li>Actuator æä¾›äº†å¯¹åº”ç”¨ç¨‹åºå†…éƒ¨å·¥ä½œæ–¹å¼çš„è¿è¡Œæ—¶ç›‘æ§ï¼ŒåŒ…æ‹¬ç«¯ç‚¹ã€çº¿ç¨‹ dump ä¿¡æ¯ã€åº”ç”¨ç¨‹åºå¥åº·çŠ¶å†µå’Œåº”ç”¨ç¨‹åºå¯ç”¨çš„ç¯å¢ƒå±æ€§ã€‚</li>
<li>çµæ´»çš„ç¯å¢ƒå±æ€§è§„èŒƒã€‚</li>
<li>åœ¨æ ¸å¿ƒæ¡†æ¶çš„æµ‹è¯•è¾…åŠ©ä¹‹å¤–ï¼Œè¿˜æœ‰é¢å¤–çš„æµ‹è¯•æ”¯æŒã€‚</li>
</ul>
<p>æ­¤å¤–ï¼ŒSpring Boot æä¾›äº†ä¸€ç§åŸºäº Groovy è„šæœ¬çš„æ›¿ä»£ç¼–ç¨‹æ¨¡å‹ï¼Œç§°ä¸º Spring Boot CLIï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰ã€‚ä½¿ç”¨ Spring Boot CLIï¼Œå¯ä»¥å°†æ•´ä¸ªåº”ç”¨ç¨‹åºç¼–å†™ä¸º Groovy è„šæœ¬çš„é›†åˆï¼Œå¹¶ä»å‘½ä»¤è¡Œè¿è¡Œå®ƒä»¬ã€‚</p>
<h4 id="Spring-Data"><a href="#Spring-Data" class="headerlink" title="Spring Data"></a>Spring Data</h4><p>Spring Data æä¾›äº†ä¸€äº›éå¸¸æƒŠäººçš„åŠŸèƒ½ï¼šå°†åº”ç”¨ç¨‹åºçš„æ•°æ®å­˜å‚¨åº“æŠ½è±¡ä¸ºç®€å•çš„ Java æ¥å£ï¼ŒåŒæ—¶å½“å®šä¹‰æ–¹æ³•ç”¨äºå¦‚ä½•é©±åŠ¨æ•°æ®è¿›è¡Œå­˜å‚¨å’Œæ£€ç´¢çš„é—®é¢˜æ—¶ï¼Œå¯¹æ–¹æ³•ä½¿ç”¨äº†å‘½åçº¦å®šã€‚</p>
<p>Spring Data èƒ½å¤Ÿå¤„ç†å‡ ç§ä¸åŒç±»å‹çš„æ•°æ®åº“ï¼ŒåŒ…æ‹¬å…³ç³»å‹ï¼ˆJPAï¼‰ã€æ–‡æ¡£å‹ï¼ˆMongoï¼‰ã€å›¾å‹ï¼ˆNeo4jï¼‰ç­‰ã€‚</p>
<h4 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h4><p>Spring Security è§£å†³äº†å¹¿æ³›çš„åº”ç”¨ç¨‹åºå®‰å…¨æ€§éœ€æ±‚ï¼ŒåŒ…æ‹¬èº«ä»½éªŒè¯ã€æˆæƒå’Œ API å®‰å…¨æ€§ã€‚</p>
<h4 id="Spring-Integration-å’Œ-Spring-Batch"><a href="#Spring-Integration-å’Œ-Spring-Batch" class="headerlink" title="Spring Integration å’Œ Spring Batch"></a>Spring Integration å’Œ Spring Batch</h4><p>Spring Integration è§£å†³äº†å®æ—¶é›†æˆï¼Œå³æ•°æ®åœ¨å¯ç”¨æ—¶è¿›è¡Œå¤„ç†ã€‚ç›¸åï¼ŒSpring Batch è§£å†³äº†æ‰¹é‡é›†æˆçš„é—®é¢˜ï¼Œå…è®¸åœ¨ä¸€æ®µæ—¶é—´å†…æ”¶é›†æ•°æ®ï¼Œç›´åˆ°æŸä¸ªè§¦å‘å™¨ï¼ˆå¯èƒ½æ˜¯ä¸€ä¸ªæ—¶é—´è§¦å‘å™¨ï¼‰å‘å‡ºä¿¡å·ï¼Œè¡¨ç¤ºè¯¥å¤„ç†ä¸€æ‰¹æ•°æ®äº†ã€‚</p>
<h4 id="Spring-Cloud"><a href="#Spring-Cloud" class="headerlink" title="Spring Cloud"></a>Spring Cloud</h4><p>å¾®æœåŠ¡æ˜¯ä¸€ä¸ªçƒ­é—¨è¯é¢˜ï¼Œè§£å†³äº†å‡ ä¸ªå®é™…çš„å¼€å‘å’Œè¿è¡Œæ—¶é—®é¢˜ã€‚ç„¶è€Œï¼Œåœ¨è¿™æ ·åšçš„åŒæ—¶ï¼Œä»–ä»¬ä¹Ÿå¸¦æ¥äº†è‡ªå·±çš„æŒ‘æˆ˜ã€‚è¿™äº›æŒ‘æˆ˜éƒ½å°†ç”± Spring Cloud ç›´æ¥é¢å¯¹ï¼ŒSpring Cloud æ˜¯ä¸€ç»„ç”¨ Spring å¼€å‘äº‘æœ¬åœ°åº”ç”¨ç¨‹åºçš„é¡¹ç›®ã€‚</p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ul>
<li>Spring çš„ç›®æ ‡æ˜¯è®©å¼€å‘äººå‘˜è½»æ¾åº”å¯¹æŒ‘æˆ˜ï¼Œæ¯”å¦‚åˆ›å»º web åº”ç”¨ç¨‹åºã€ä½¿ç”¨æ•°æ®åº“ã€ä¿æŠ¤åº”ç”¨ç¨‹åºå’Œä½¿ç”¨å¾®æœåŠ¡ã€‚</li>
<li>Spring Boot æ„å»ºåœ¨ Spring ä¹‹ä¸Šï¼Œç®€åŒ–äº†ä¾èµ–ç®¡ç†ã€è‡ªåŠ¨é…ç½®å’Œè¿è¡Œæ—¶ç›‘æ§ï¼Œè®© Spring å˜å¾—æ›´åŠ ç®€å•ã€‚</li>
<li>Spring åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ Spring Initializr è¿›è¡Œåˆå§‹åŒ–ï¼Œå®ƒæ˜¯åŸºäº web çš„ï¼Œå¹¶ä¸”åœ¨å¤§å¤šæ•° Java å¼€å‘ç¯å¢ƒä¸­éƒ½æ”¯æŒå®ƒã€‚</li>
<li>åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ï¼Œç»„ä»¶ï¼ˆé€šå¸¸ç§°ä¸º beanï¼‰å¯ä»¥ç”¨ Java æˆ– XML æ˜¾å¼åœ°å£°æ˜ï¼Œå¯ä»¥é€šè¿‡ç»„ä»¶æ‰«æè¿›è¡Œå‘ç°ï¼Œä¹Ÿå¯ä»¥ç”¨ Spring Boot è¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚</li>
</ul>
<h2 id="ç¬¬-2-ç« -å¼€å‘-Web-åº”ç”¨ç¨‹åº"><a href="#ç¬¬-2-ç« -å¼€å‘-Web-åº”ç”¨ç¨‹åº" class="headerlink" title="ç¬¬ 2 ç«  å¼€å‘ Web åº”ç”¨ç¨‹åº"></a>ç¬¬ 2 ç«  å¼€å‘ Web åº”ç”¨ç¨‹åº</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>åœ¨æµè§ˆå™¨ä¸­å±•ç¤ºæ¨¡å‹æ•°æ®</li>
<li>å¤„ç†å’ŒéªŒè¯è¡¨å•è¾“å…¥</li>
<li>é€‰æ‹©è§†å›¾æ¨¡æ¿åº“</li>
</ul>
<h3 id="å±•ç¤ºä¿¡æ¯"><a href="#å±•ç¤ºä¿¡æ¯" class="headerlink" title="å±•ç¤ºä¿¡æ¯"></a>å±•ç¤ºä¿¡æ¯</h3><p>åœ¨ Spring web åº”ç”¨ç¨‹åºä¸­ï¼Œè·å–å’Œå¤„ç†æ•°æ®æ˜¯æ§åˆ¶å™¨çš„å·¥ä½œã€‚è§†å›¾çš„å·¥ä½œæ˜¯å°†æ•°æ®æ¸²æŸ“æˆ HTML å¹¶æ˜¾ç¤ºåœ¨æµè§ˆå™¨ä¸­ã€‚å°†åˆ›å»ºä»¥ä¸‹ç»„ä»¶æ¥æ”¯æŒ Taco åˆ›å»ºé¡µé¢ï¼š</p>
<ul>
<li>ä¸€ä¸ªå®šä¹‰ç‰ç±³å·æˆåˆ†ç‰¹æ€§çš„é¢†åŸŸç±»</li>
<li>ä¸€ä¸ª Spring MVC æ§åˆ¶å™¨ç±»ï¼Œå®ƒè·å–æˆåˆ†ä¿¡æ¯å¹¶å°†å…¶ä¼ é€’ç»™è§†å›¾</li>
<li>ä¸€ä¸ªè§†å›¾æ¨¡æ¿ï¼Œåœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­å‘ˆç°ä¸€ä¸ªæˆåˆ†åˆ—è¡¨</li>
</ul>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrrHUSWPNj-nSrbj4RX%252F-LrrHfAkLFP0S97Nswva%252F%E5%9B%BE%202.1%20%E5%85%B8%E5%9E%8B%20Spring%20MVC%20%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B.jpg" alt="img"></p>
<center>å›¾ 2.1 å…¸å‹ Spring MVC è¯·æ±‚æµç¨‹</center>

<h4 id="å»ºç«‹åŸŸ"><a href="#å»ºç«‹åŸŸ" class="headerlink" title="å»ºç«‹åŸŸ"></a>å»ºç«‹åŸŸ</h4><p>åº”ç”¨ç¨‹åºçš„åŸŸæ˜¯å®ƒæ‰€å¤„ç†çš„ä¸»é¢˜é¢†åŸŸ â€”â€” å½±å“åº”ç”¨ç¨‹åºç†è§£çš„æ€æƒ³å’Œæ¦‚å¿µã€‚</p>
<p>åœ¨é¢†åŸŸä¸­ï¼Œç‰ç±³é¥¼é…æ–™æ˜¯ç›¸å½“ç®€å•çš„å¯¹è±¡ã€‚æ¯ä¸€ç§éƒ½æœ‰ä¸€ä¸ªåç§°å’Œä¸€ä¸ªç±»å‹ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è§†è§‰ä¸Šå¯¹å…¶è¿›è¡Œåˆ†ç±»ï¼ˆè›‹ç™½è´¨ã€å¥¶é…ªã€é…±æ±ç­‰ï¼‰ã€‚æ¯ä¸€ä¸ªéƒ½æœ‰ä¸€ä¸ª IDï¼Œé€šè¿‡è¿™ä¸ª ID å¯ä»¥è½»æ¾ã€æ˜ç¡®åœ°å¼•ç”¨å®ƒã€‚ä¸‹é¢çš„æˆåˆ†ç±»å®šä¹‰äº†éœ€è¦çš„åŸŸå¯¹è±¡ã€‚</p>
<center>ç¨‹åºæ¸…å• 2.1 å®šä¹‰ç‰ç±³é¥¼çš„é…æ–™</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ingredient</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Type type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">enum</span> <span class="title">Type</span> </span>&#123;</span><br><span class="line">        WRAP, PROTEIN, VEGGIES, CHEESE, SAUCE</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„ Java åŸŸç±»ï¼Œå®šä¹‰äº†æè¿°ä¸€ä¸ªæˆåˆ†æ‰€éœ€çš„ä¸‰ä¸ªå±æ€§ã€‚</p>
<h4 id="åˆ›å»ºæ§åˆ¶å™¨ç±»"><a href="#åˆ›å»ºæ§åˆ¶å™¨ç±»" class="headerlink" title="åˆ›å»ºæ§åˆ¶å™¨ç±»"></a>åˆ›å»ºæ§åˆ¶å™¨ç±»</h4><p>æ§åˆ¶å™¨æ˜¯ Spring MVC æ¡†æ¶çš„ä¸»è¦å‚ä¸è€…ã€‚å®ƒä»¬çš„ä¸»è¦å·¥ä½œæ˜¯å¤„ç† HTTP è¯·æ±‚ï¼Œæˆ–è€…å°†è¯·æ±‚ä¼ é€’ç»™è§†å›¾ä»¥å‘ˆç° HTMLï¼ˆæµè§ˆå™¨æ˜¾ç¤ºï¼‰ï¼Œæˆ–è€…ç›´æ¥å°†æ•°æ®å†™å…¥å“åº”ä½“ï¼ˆRESTfulï¼‰ã€‚</p>
<p>å¯¹äº Taco Cloud åº”ç”¨ç¨‹åºï¼Œéœ€è¦ä¸€ä¸ªç®€å•çš„æ§åˆ¶å™¨æ¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>å¤„ç†è¯·æ±‚è·¯å¾„ä¸º <code>/design</code> çš„ HTTP GET è¯·æ±‚</li>
<li>æ„å»ºæˆåˆ†åˆ—è¡¨</li>
<li>å°†è¯·æ±‚å’Œæˆåˆ†æ•°æ®æäº¤ç»™è§†å›¾æ¨¡æ¿ï¼Œä»¥ HTML çš„å½¢å¼å‘ˆç°å¹¶å‘é€ç»™è¯·æ±‚çš„ web æµè§ˆå™¨</li>
</ul>
<p>ä¸‹é¢çš„ DesignTacoController ç±»å¤„ç†è¿™äº›éœ€æ±‚ã€‚</p>
<center>ç¨‹åºæ¸…å• 2.2 Spring æ§åˆ¶å™¨ç±»çš„å¼€å§‹</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.Errors;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tacos.Taco;</span><br><span class="line"><span class="keyword">import</span> tacos.Ingredient;</span><br><span class="line"><span class="keyword">import</span> tacos.Ingredient.Type;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/design&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DesignTacoController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">showDesignForm</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        List&lt;Ingredient&gt; ingredients = Arrays.asList(</span><br><span class="line">            <span class="keyword">new</span> Ingredient(<span class="string">&quot;FLTO&quot;</span>, <span class="string">&quot;Flour Tortilla&quot;</span>, Type.WRAP),</span><br><span class="line">            <span class="keyword">new</span> Ingredient(<span class="string">&quot;COTO&quot;</span>, <span class="string">&quot;Corn Tortilla&quot;</span>, Type.WRAP),</span><br><span class="line">            <span class="keyword">new</span> Ingredient(<span class="string">&quot;GRBF&quot;</span>, <span class="string">&quot;Ground Beef&quot;</span>, Type.PROTEIN),</span><br><span class="line">            <span class="keyword">new</span> Ingredient(<span class="string">&quot;CARN&quot;</span>, <span class="string">&quot;Carnitas&quot;</span>, Type.PROTEIN),</span><br><span class="line">            <span class="keyword">new</span> Ingredient(<span class="string">&quot;TMTO&quot;</span>, <span class="string">&quot;Diced Tomatoes&quot;</span>, Type.VEGGIES),</span><br><span class="line">            <span class="keyword">new</span> Ingredient(<span class="string">&quot;LETC&quot;</span>, <span class="string">&quot;Lettuce&quot;</span>, Type.VEGGIES),</span><br><span class="line">            <span class="keyword">new</span> Ingredient(<span class="string">&quot;CHED&quot;</span>, <span class="string">&quot;Cheddar&quot;</span>, Type.CHEESE),</span><br><span class="line">            <span class="keyword">new</span> Ingredient(<span class="string">&quot;JACK&quot;</span>, <span class="string">&quot;Monterrey Jack&quot;</span>, Type.CHEESE),</span><br><span class="line">            <span class="keyword">new</span> Ingredient(<span class="string">&quot;SLSA&quot;</span>, <span class="string">&quot;Salsa&quot;</span>, Type.SAUCE),</span><br><span class="line">            <span class="keyword">new</span> Ingredient(<span class="string">&quot;SRCR&quot;</span>, <span class="string">&quot;Sour Cream&quot;</span>, Type.SAUCE)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        Type[] types = Ingredient.Type.values();</span><br><span class="line">        <span class="keyword">for</span> (Type type : types) &#123;</span><br><span class="line">            model.addAttribute(type.toString().toLowerCase(),</span><br><span class="line">                filterByType(ingredients, type));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">&quot;design&quot;</span>, <span class="keyword">new</span> Taco());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;design&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// provided by &#x27;aexiaosong&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;Ingredient&gt; <span class="title">filterByType</span><span class="params">(List&lt;Ingredient&gt; ingredients, Type type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ingredients.stream().filter(x -&gt; x.getType().equals(type)).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Slf4j æ˜¯ Lombok æä¾›çš„æ³¨é‡Šï¼Œåœ¨è¿è¡Œæ—¶å°†è‡ªåŠ¨ç”Ÿæˆç±»ä¸­çš„ SLF4Jï¼ˆJava çš„ç®€å•æ—¥å¿—é—¨é¢ï¼Œ<a target="_blank" rel="noopener" href="https://www.slf4j.org/">https://www.slf4j.org/</a>ï¼‰è®°å½•å™¨ã€‚è¿™ä¸ªé€‚å½“çš„æ³¨é‡Šå…·æœ‰ä¸æ˜¾å¼åœ°åœ¨ç±»ä¸­æ·»åŠ ä»¥ä¸‹è¡Œç›¸åŒçš„æ•ˆæœï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> org.slf4j.Logger log = org.slf4j.LoggerFactory.getLogger(DesignTacoController.class);</span><br></pre></td></tr></table></figure>

<p> @Controller æ³¨é‡Šç”¨äºå°†è¯¥ç±»æ ‡è¯†ä¸ºæ§åˆ¶å™¨å¹¶å°†å…¶æ ‡è®°ä¸ºç»„ä»¶æ‰«æçš„å€™é€‰å¯¹è±¡ï¼Œä»¥ä¾¿ Spring å°†å‘ç°è¯¥ç±»å¹¶åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è‡ªåŠ¨åˆ›å»º DesignTacoController å®ä¾‹ä½œä¸º beanã€‚</p>
<p>@RequestMapping æ³¨é‡Šåœ¨ç±»çº§åº”ç”¨æ—¶ï¼ŒæŒ‡å®šè¯¥æ§åˆ¶å™¨å¤„ç†çš„è¯·æ±‚çš„ç±»å‹ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒæŒ‡å®š DesignTacoController å°†å¤„ç†è·¯å¾„ä»¥ <code>/design</code> å¼€å¤´çš„è¯·æ±‚ã€‚</p>
<p><strong>å¤„ç† GET è¯·æ±‚</strong></p>
<p>ç±»çº§åˆ«çš„ @RequestMapping æ³¨é‡Šç”¨äº showDesignForm() æ–¹æ³•æ—¶ï¼Œå¯ä»¥ç”¨ @GetMapping æ³¨é‡Šè¿›è¡Œæ”¹è¿›ã€‚@GetMapping ä¸ç±»çº§åˆ«çš„ @RequestMapping é…å¯¹ä½¿ç”¨ï¼ŒæŒ‡å®šä½•æ—¶æ¥æ”¶ <code>/design</code> çš„ HTTP GET è¯·æ±‚ï¼ŒshowDesignForm() å°†ç”¨æ¥å¤„ç†è¯·æ±‚ã€‚</p>
<p>@GetMapping æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°çš„æ³¨é‡Šï¼Œæ˜¯åœ¨ Spring 4.3 ä¸­å¼•å…¥çš„ã€‚åœ¨ Spring 4.3 ä¹‹å‰ï¼Œå¯èƒ½ä½¿ç”¨äº†ä¸€ä¸ªæ–¹æ³•çº§åˆ«çš„ @RequestMapping æ³¨é‡Šï¼š</p>
<center>è¡¨ 2.1 Spring MVC è¯·æ±‚æ˜ å°„æ³¨é‡Š</center>

<table>
<thead>
<tr>
<th>æ³¨é‡Š</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>@RequestMapping</td>
<td>é€šç”¨è¯·æ±‚å¤„ç†</td>
</tr>
<tr>
<td>@GetMapping</td>
<td>å¤„ç† HTTP GET è¯·æ±‚</td>
</tr>
<tr>
<td>@PostMapping</td>
<td>å¤„ç† HTTP POST è¯·æ±‚</td>
</tr>
<tr>
<td>@PutMapping</td>
<td>å¤„ç† HTTP PUT è¯·æ±‚</td>
</tr>
<tr>
<td>@DeleteMapping</td>
<td>å¤„ç† HTTP DELETE è¯·æ±‚</td>
</tr>
<tr>
<td>@PatchMapping</td>
<td>å¤„ç† HTTP PATCH è¯·æ±‚</td>
</tr>
</tbody></table>
<p>ä¸€æ—¦å‡†å¤‡å¥½äº†åŸæ–™åˆ—è¡¨ï¼Œæ¥ä¸‹æ¥çš„å‡ è¡Œ showDesignForm() å°†æ ¹æ®åŸæ–™ç±»å‹è¿‡æ»¤è¯¥åˆ—è¡¨ã€‚ç„¶åå°†æˆåˆ†ç±»å‹åˆ—è¡¨ä½œä¸ºå±æ€§æ·»åŠ åˆ°ä¼ é€’åˆ° showDesignForm() çš„ Model å¯¹è±¡ã€‚Model æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåœ¨æ§åˆ¶å™¨å’Œè´Ÿè´£å‘ˆç°æ•°æ®çš„è§†å›¾ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚æœ€åï¼Œæ”¾ç½®åœ¨ Model ç±»å±æ€§ä¸­çš„æ•°æ®è¢«å¤åˆ¶åˆ° servlet å“åº”å±æ€§ä¸­ï¼Œè§†å›¾å¯ä»¥åœ¨å…¶ä¸­æ‰¾åˆ°å®ƒä»¬ã€‚showDesignForm() æ–¹æ³•æœ€åè¿”å› â€œdesignâ€ï¼Œè¿™æ˜¯å°†ç”¨äºå‘æµè§ˆå™¨å‘ˆç° Model çš„è§†å›¾çš„é€»è¾‘åç§°ã€‚</p>
<h4 id="è®¾è®¡è§†å›¾"><a href="#è®¾è®¡è§†å›¾" class="headerlink" title="è®¾è®¡è§†å›¾"></a>è®¾è®¡è§†å›¾</h4><p>ä¸‹é¢çš„ <code>&lt;dependency&gt;</code> æ¡ç›®ä½¿ç”¨äº† Spring Boot çš„ Thymeleaf starterï¼Œä½¿ Thymeleaf æ¸²æŸ“è¦åˆ›å»ºçš„è§†å›¾ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿è¡Œæ—¶ï¼ŒSpring Boot è‡ªåŠ¨é…ç½®å°†çœ‹åˆ° Thymeleaf ä½äºç±»è·¯å¾„ä¸­ï¼Œå¹¶å°†è‡ªåŠ¨åˆ›å»ºæ”¯æŒ Spring MVC çš„ Thymeleaf è§†å›¾çš„ beanã€‚</p>
<p>åƒ Thymeleaf è¿™æ ·çš„è§†å›¾åº“è¢«è®¾è®¡æˆä¸ä»»ä½•ç‰¹å®šçš„ web æ¡†æ¶è§£è€¦ã€‚å› æ­¤ï¼Œä»–ä»¬ä¸çŸ¥é“ Spring çš„æ¨¡å‹æŠ½è±¡ï¼Œå¹¶ä¸”æ— æ³•å¤„ç†æ§åˆ¶å™¨æ”¾ç½®åœ¨æ¨¡å‹ä¸­çš„æ•°æ®ã€‚ä½†æ˜¯å®ƒä»¬å¯ä»¥å¤„ç† servlet è¯·æ±‚å±æ€§ã€‚å› æ­¤ï¼Œåœ¨ Spring å°†è¯·æ±‚æäº¤ç»™è§†å›¾ä¹‹å‰ï¼Œå®ƒå°†æ¨¡å‹æ•°æ®å¤åˆ¶åˆ°è¯·æ±‚å±æ€§ä¸­ï¼Œè€Œ Thymeleaf å’Œå…¶ä»–è§†å›¾æ¨¡æ¿é€‰é¡¹å¯ä»¥éšæ—¶è®¿é—®è¿™äº›å±æ€§ã€‚</p>
<p>Thymeleaf æ¨¡æ¿åªæ˜¯ HTML ä¸ä¸€äº›é¢å¤–çš„å…ƒç´ å±æ€§ï¼ŒæŒ‡å¯¼æ¨¡æ¿åœ¨æ¸²æŸ“è¯·æ±‚æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªè¯·æ±‚å±æ€§ï¼Œå®ƒçš„é”®æ˜¯ â€œmessageâ€ï¼Œä½ å¸Œæœ›å®ƒè¢« Thymeleaf æ¸²æŸ“æˆä¸€ä¸ª HTML <code>&lt;p&gt;</code> æ ‡ç­¾ï¼Œä½ å¯ä»¥åœ¨ä½ çš„ Thymeleaf æ¨¡æ¿ä¸­å†™ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;message&#125;&quot;</span>&gt;</span>placeholder message<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“æ¨¡æ¿è¢«å‘ˆç°ä¸º HTML æ—¶ï¼Œ<code>&lt;p&gt;</code> å…ƒç´ çš„ä¸»ä½“å°†è¢« servlet è¯·æ±‚å±æ€§çš„å€¼æ›¿æ¢ï¼Œå…¶é”®å€¼ä¸º â€œmessageâ€ã€‚<code>th:text</code> æ˜¯ä¸€ä¸ª Thymeleaf çš„å‘½åç©ºé—´å±æ€§ï¼Œç”¨äºéœ€è¦æ‰§è¡Œæ›¿æ¢çš„åœ°æ–¹ã€‚<code>$&#123;&#125;</code> æ“ä½œç¬¦å‘Šè¯‰å®ƒä½¿ç”¨è¯·æ±‚å±æ€§çš„å€¼ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º â€œmessageâ€ï¼‰ã€‚</p>
<p>Thymeleaf è¿˜æä¾›äº†å¦ä¸€ä¸ªå±æ€§ <code>th:each</code>ï¼Œå®ƒéå†å…ƒç´ é›†åˆï¼Œä¸ºé›†åˆä¸­çš„æ¯ä¸ªé¡¹ç›®å‘ˆç°ä¸€æ¬¡ HTMLã€‚ä¾‹å¦‚ï¼Œè¦å‘ˆç° â€œwrapâ€ é…æ–™åˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ HTML ç‰‡æ®µï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>Designate your wrap:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">&quot;ingredient : $&#123;wrap&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;ingredients&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;ingredient.id&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;ingredient.name&#125;&quot;</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åœ¨ <code>&lt;div&gt;</code> æ ‡ç­¾ä¸­å¡«å…… <code>th:each</code> å±æ€§ï¼Œç”¨æ¥å¯¹å‘ç°äº <code>wrap</code> è¯·æ±‚å±æ€§ä¸­çš„é›†åˆä¸­çš„æ¯ä¸€ä¸ªé¡¹ç›®è¿›è¡Œé‡å¤å‘ˆç°ã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæˆåˆ†é¡¹éƒ½ç»‘å®šåˆ°ä¸€ä¸ªåä¸º <code>ingredient</code> çš„ Thymeleaf å˜é‡ä¸­ã€‚</p>
<p>åœ¨ <code>&lt;div&gt;</code> å…ƒç´ å†…éƒ¨ï¼Œæœ‰ä¸€ä¸ªå¤é€‰æ¡† <code>&lt;input&gt;</code> å…ƒç´ å’Œä¸€ä¸ª <code>&lt;span&gt;</code> å…ƒç´ ï¼Œç”¨äºä¸ºå¤é€‰æ¡†æä¾›æ ‡ç­¾ã€‚å¤é€‰æ¡†ä½¿ç”¨ Thymeleaf çš„ <code>th:value</code> å…ƒç´ ï¼Œå®ƒå°†æŠŠ <code>&lt;iuput&gt;</code> å…ƒç´ çš„ <code>value</code> å±æ€§å‘ˆç°ä¸ºåœ¨æˆåˆ† <code>id</code> å±æ€§ä¸­æ‰¾åˆ°çš„å€¼ã€‚<code>&lt;span&gt;</code> å…ƒç´ ä½¿ç”¨ <code>th:text</code> å±æ€§æŠŠ â€œINGREDIENTâ€ å ä½ç¬¦æ›¿æ¢ä¸ºæˆåˆ† <code>name</code> å±æ€§çš„å€¼ã€‚</p>
<p>å½“ä½¿ç”¨å®é™…çš„æ¨¡å‹æ•°æ®å‘ˆç°æ—¶ï¼Œè¿™ä¸ª <code>&lt;div&gt;</code> å¾ªç¯è¿­ä»£ä¸€æ¬¡å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;ingredients&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;FLTO&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>Flour Tortilla<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œå‰é¢çš„ Thymeleaf ç‰‡æ®µåªæ˜¯ä¸€ä¸ªæ›´å¤§çš„ HTML è¡¨å•çš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡å®ƒï¼Œç‰ç±³é¥¼è‰ºæœ¯å®¶ç”¨æˆ·å°†æäº¤ä»–ä»¬ç¾å‘³çš„ä½œå“ã€‚å®Œæ•´çš„ Thymeleaf æ¨¡æ¿ï¼ˆåŒ…æ‹¬æ‰€æœ‰æˆåˆ†ç±»å‹å’Œè¡¨å•ï¼‰å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<center>ç¨‹åºæ¸…å• 2.3 å®Œæ•´çš„ design-a-taco é¡µé¢</center>

<!DOCTYPE html

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Taco Cloud<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/styles.css&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Design your taco!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/images/TacoCloud.png&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;design&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;grid&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ingredient-group&quot;</span> <span class="attr">id</span>=<span class="string">&quot;wraps&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Designate your wrap:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">&quot;ingredient : $&#123;wrap&#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;ingredients&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;ingredient.id&#125;&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;ingredient.name&#125;&quot;</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ingredient-group&quot;</span> <span class="attr">id</span>=<span class="string">&quot;proteins&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Pick your protein:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">&quot;ingredient : $&#123;protein&#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;ingredients&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;ingredient.id&#125;&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;ingredient.name&#125;&quot;</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ingredient-group&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cheeses&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Choose your cheese:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">&quot;ingredient : $&#123;cheese&#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;ingredients&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;ingredient.id&#125;&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;ingredient.name&#125;&quot;</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ingredient-group&quot;</span> <span class="attr">id</span>=<span class="string">&quot;veggies&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Determine your veggies:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">&quot;ingredient : $&#123;veggies&#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;ingredients&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;ingredient.id&#125;&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;ingredient.name&#125;&quot;</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ingredient-group&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sauces&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Select your sauce:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">&quot;ingredient : $&#123;sauce&#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;ingredients&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;ingredient.id&#125;&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;ingredient.name&#125;&quot;</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Name your taco creation:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;name&#125;&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span>&gt;</span>Submit your taco<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table>

<p>å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºæ¯ç§ç±»å‹çš„é…æ–™ï¼Œéƒ½è¦é‡å¤ <code>&lt;div&gt;</code> ç‰‡æ®µã€‚è¿˜åŒ…æ‹¬ä¸€ä¸ªæäº¤æŒ‰é’®å’Œä¸€ä¸ªå­—æ®µï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­å‘½åä»–ä»¬çš„åˆ›å»ºã€‚</p>
<p>å¯åŠ¨ Taco Cloud åº”ç”¨ç¨‹åºä½¿ç”¨æµè§ˆå™¨è®¿é—® <a target="_blank" rel="noopener" href="http://localhost:8080/design%E3%80%82%E5%BA%94%E8%AF%A5%E7%9C%8B%E5%88%B0%E7%B1%BB%E4%BC%BC%E5%9B%BE">http://localhost:8080/designã€‚åº”è¯¥çœ‹åˆ°ç±»ä¼¼å›¾</a> 2.2 çš„é¡µé¢ã€‚</p>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrrIg6xvwtBazaF316X%252F-LrrKhltr1lMyDwSXXEJ%252F%E5%9B%BE%202.2%20%E5%91%88%E7%8E%B0%E7%9A%84%E7%8E%89%E7%B1%B3%E9%A5%BC%E8%AE%BE%E8%AE%A1%E9%A1%B5%E9%9D%A2.jpg" alt="img"></p>
<center>å›¾ 2.2 å‘ˆç°çš„ç‰ç±³å·è®¾è®¡é¡µé¢</center>

<h3 id="å¤„ç†è¡¨å•æäº¤"><a href="#å¤„ç†è¡¨å•æäº¤" class="headerlink" title="å¤„ç†è¡¨å•æäº¤"></a>å¤„ç†è¡¨å•æäº¤</h3><p> <code>&lt;form&gt;</code> æ ‡ç­¾çš„ <code>method</code> å±æ€§è¢«è®¾ç½®ä¸º POSTã€‚è€Œä¸”ï¼Œ<code>&lt;form&gt;</code> æ²¡æœ‰å£°æ˜ action å±æ€§ã€‚è¿™æ„å‘³ç€åœ¨æäº¤è¡¨å•æ—¶ï¼Œæµè§ˆå™¨å°†æ”¶é›†è¡¨å•ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œå¹¶é€šè¿‡ HTTP POST è¯·æ±‚å°†å…¶å‘é€åˆ°æœåŠ¡å™¨ï¼Œå‘é€åˆ°æ˜¾ç¤ºè¡¨å•çš„ GET è¯·æ±‚çš„åŒä¸€è·¯å¾„ â€”â€” <code>/design</code> è·¯å¾„ã€‚</p>
<p>å› æ­¤ï¼Œéœ€è¦åœ¨è¯¥ POST è¯·æ±‚çš„æ¥æ”¶ç«¯ä¸Šæœ‰ä¸€ä¸ªæ§åˆ¶å™¨å¤„ç†ç¨‹åºæ–¹æ³•ã€‚</p>
<p>ä½¿ç”¨ @PostMapping å¤„ç† POST è¯·æ±‚ã€‚</p>
<center>ç¨‹åºæ¸…å• 2.4 ä½¿ç”¨ @PostMapping å¤„ç† POST è¯·æ±‚</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">processDesign</span><span class="params">(Taco design)</span> </span>&#123;    <span class="comment">// Save the taco design...    // We&#x27;ll do this in chapter 3</span></span><br><span class="line">    log.info(<span class="string">&quot;Processing design: &quot;</span> + design);   </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/orders/current&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æäº¤è¡¨å•æ—¶ï¼Œè¡¨å•ä¸­çš„å­—æ®µè¢«ç»‘å®šåˆ° Taco å¯¹è±¡çš„å±æ€§ï¼Œè¯¥å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™ processDesign()ã€‚</p>
<center>ç¨‹åºæ¸…å• 2.5 åŸŸå¯¹è±¡å®šä¹‰ç‰ç±³é¥¼è®¾è®¡</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Taco</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name; </span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; ingredients;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Taco æ˜¯ä¸€ä¸ªç®€å•çš„ Java åŸŸå¯¹è±¡ï¼Œå…·æœ‰ä¸¤ä¸ªå±æ€§ã€‚</p>
<p>ä» processDesign() è¿”å›çš„å€¼çš„å‰ç¼€æ˜¯ â€œredirect:â€ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé‡å®šå‘è§†å›¾ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œå®ƒè¡¨æ˜åœ¨ processDesign() å®Œæˆä¹‹åï¼Œç”¨æˆ·çš„æµè§ˆå™¨åº”è¯¥è¢«é‡å®šå‘åˆ°ç›¸å¯¹è·¯å¾„ /order/currentã€‚</p>
<center>ç¨‹åºæ¸…å• 2.6 å±•ç°ç‰ç±³é¥¼è®¢å•è¡¨å•çš„æ§åˆ¶å™¨</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.web;</span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.Errors;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> tacos.Order;</span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/orders&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123; </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/current&quot;)</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">orderForm</span><span class="params">(Model model)</span> </span>&#123; </span><br><span class="line">        model.addAttribute(<span class="string">&quot;order&quot;</span>, <span class="keyword">new</span> Order()); </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;orderForm&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>orderForm è§†å›¾ç”±ä¸€ä¸ªåä¸º orderForm.html çš„ Thymeleaf æ¨¡æ¿æä¾›ï¼Œå¦‚ä¸‹é¢æ˜¾ç¤ºçš„ã€‚</p>
<center>ç¨‹åºæ¸…å• 2.7 taco è®¢å•è¡¨å•è§†å›¾</center>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Taco Cloud<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/styles.css&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/orders&#125;&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;order&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Order your taco creations!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/images/TacoCloud.png&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/design&#125;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;another&quot;</span>&gt;</span>Design another taco<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#fields.hasErrors()&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;validationError&quot;</span>&gt;</span></span><br><span class="line">                    Please correct the problems below and resubmit.</span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Deliver my taco masterpieces to...<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;name&quot;</span>&gt;</span>Name: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;name&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;street&quot;</span>&gt;</span>Street address: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;street&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;city&quot;</span>&gt;</span>City: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;city&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;state&quot;</span>&gt;</span>State: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;state&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;zip&quot;</span>&gt;</span>Zip code: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;zip&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Here&#x27;s how I&#x27;ll pay...<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;ccNumber&quot;</span>&gt;</span>Credit Card #: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;ccNumber&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;ccExpiration&quot;</span>&gt;</span>Expiration: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;ccExpiration&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;ccCVV&quot;</span>&gt;</span>CVV: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;ccCVV&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit order&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> <code>&lt;form&gt;</code> å…ƒç´ æŒ‡å®šäº†ä¸€ä¸ªè¡¨å•æ“ä½œã€‚æŒ‡å®šè¡¨å•åº”è¯¥æäº¤åˆ° /ordersï¼ˆä½¿ç”¨ Thymeleaf çš„ <code>@&#123;â€¦&#125;</code> æ“ä½œç¬¦ä½œä¸ºä¸Šä¸‹æ–‡ç›¸å…³è·¯å¾„ï¼‰ã€‚</p>
<center>ç¨‹åºæ¸…å• 2.8 å¤„ç† taco è®¢å•æäº¤</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">processOrder</span><span class="params">(Order order)</span> </span>&#123; </span><br><span class="line">    log.info(<span class="string">&quot;Order submitted: &quot;</span> + order);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“è°ƒç”¨ processOrder() æ–¹æ³•æ¥å¤„ç†æäº¤çš„è®¢å•æ—¶ï¼Œå®ƒå°†è·å¾—ä¸€ä¸ª order å¯¹è±¡ï¼Œå…¶å±æ€§ç»‘å®šåˆ°æäº¤çš„è¡¨å•å­—æ®µã€‚</p>
<center>ç¨‹åºæ¸…å• 2.9 taco è®¢å•åŸŸå¯¹è±¡</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Digits;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Pattern;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.CreditCardNumber;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String street;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line">    <span class="keyword">private</span> String zip;</span><br><span class="line">    <span class="keyword">private</span> String ccNumber;</span><br><span class="line">    <span class="keyword">private</span> String ccExpiration;</span><br><span class="line">    <span class="keyword">private</span> String ccCVV;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰“å¼€æµè§ˆå™¨è®¿é—® <a target="_blank" rel="noopener" href="http://localhost:8080/design%EF%BC%8C%E4%B8%BA%E4%BD%A0%E7%9A%84%E7%8E%89%E7%B1%B3%E9%A5%BC%E9%80%89%E6%8B%A9%E4%B8%80%E4%BA%9B%E5%8E%9F%E6%96%99%EF%BC%8C%E7%84%B6%E5%90%8E%E7%82%B9%E5%87%BB">http://localhost:8080/designï¼Œä¸ºä½ çš„ç‰ç±³é¥¼é€‰æ‹©ä¸€äº›åŸæ–™ï¼Œç„¶åç‚¹å‡»</a> <code>Submit Your Taco</code> æŒ‰é’®ã€‚åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼äºå›¾ 2.3 æ‰€ç¤ºçš„è¡¨å•ã€‚</p>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252Fsync%252Fde21b3cc9e3a0a1bf60756ea2fc917b7a92d1288.jpg" alt="img"></p>
<center>å›¾ 2.3 taco è®¢å•è¡¨å•</center>

<p>åœ¨è¡¨å•ä¸­å¡«å†™ä¸€äº›å­—æ®µï¼Œç„¶åæŒ‰ <code>Submit Order</code> æŒ‰é’®ã€‚æ—¥å¿—æ¡ç›®çœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆé‡æ–°æ ¼å¼åŒ–ä»¥é€‚åº”è¿™ä¸ªé¡µé¢çš„å®½åº¦ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Order submitted: Order(name=Craig Walls,street1=1234 7th Street, city=Somewhere, state=Who knows?, zip=zipzap, ccNumber=Who can guess?,ccExpiration=Some day, ccCVV=See-vee-vee)</span><br></pre></td></tr></table></figure>

<p>è¡¨å•ä¸­çš„å¤§å¤šæ•°å­—æ®µåŒ…å«çš„æ•°æ®å¯èƒ½æ˜¯ä¸æ­£ç¡®çš„ã€‚éœ€è¦æ·»åŠ ä¸€äº›éªŒè¯ï¼Œä»¥ç¡®ä¿æä¾›çš„æ•°æ®è‡³å°‘ä¸æ‰€éœ€çš„ä¿¡æ¯ç±»å‹ç›¸ä¼¼ã€‚</p>
<h3 id="éªŒè¯è¡¨å•è¾“å…¥"><a href="#éªŒè¯è¡¨å•è¾“å…¥" class="headerlink" title="éªŒè¯è¡¨å•è¾“å…¥"></a>éªŒè¯è¡¨å•è¾“å…¥</h3><p>æ‰§è¡Œè¡¨å•éªŒè¯çš„ä¸€ç§æ–¹æ³•æ˜¯åœ¨ processDesign() å’Œ processOrder() æ–¹æ³•ä¸­åŠ å…¥ä¸€å † if/then å—ï¼Œæ£€æŸ¥æ¯ä¸ªå­—æ®µä»¥ç¡®ä¿å®ƒæ»¡è¶³é€‚å½“çš„éªŒè¯è§„åˆ™ã€‚ä½†æ˜¯è¿™æ ·åšä¼šå¾ˆéº»çƒ¦ï¼Œå¹¶ä¸”éš¾äºé˜…è¯»å’Œè°ƒè¯•ã€‚</p>
<p>Spring æ”¯æŒ Javaâ€™s Bean Validation APIï¼ˆä¹Ÿç§°ä¸º JSR-303ï¼›<a target="_blank" rel="noopener" href="https://jcp.org/en/jsr/detail?id=303%EF%BC%89%E3%80%82">https://jcp.org/en/jsr/detail?id=303ï¼‰ã€‚</a></p>
<ul>
<li>å¯¹è¦éªŒè¯çš„ç±»å£°æ˜éªŒè¯è§„åˆ™ï¼šç‰¹åˆ«æ˜¯ Taco ç±»ã€‚</li>
<li>æŒ‡å®šéªŒè¯åº”è¯¥åœ¨éœ€è¦éªŒè¯çš„æ§åˆ¶å™¨æ–¹æ³•ä¸­æ‰§è¡Œï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ï¼šDesignTacoController çš„ processDesign() æ–¹æ³•å’Œ OrderController çš„ processOrder() æ–¹æ³•ã€‚</li>
<li>ä¿®æ”¹è¡¨å•è§†å›¾ä»¥æ˜¾ç¤ºéªŒè¯é”™è¯¯ã€‚</li>
</ul>
<h4 id="å£°æ˜éªŒè¯è§„åˆ™"><a href="#å£°æ˜éªŒè¯è§„åˆ™" class="headerlink" title="å£°æ˜éªŒè¯è§„åˆ™"></a>å£°æ˜éªŒè¯è§„åˆ™</h4><p>ä¸‹é¢çš„ç¨‹åºæ¸…å•æ˜¾ç¤ºäº†ä¸€ä¸ªæ›´æ–°åçš„ Taco ç±»ï¼Œå®ƒä½¿ç”¨ @NotNull å’Œ @Size æ¥å£°æ˜è¿™äº›éªŒè¯è§„åˆ™ã€‚</p>
<center>ç¨‹åºæ¸…å• 2.10 ä¸º Taco åŸŸç±»æ·»åŠ éªŒè¯</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Taco</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Size(min=5, message=&quot;Name must be at least 5 characters long&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Size(min=1, message=&quot;You must choose at least 1 ingredient&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; ingredients;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½ ä¼šå‘ç°ï¼Œé™¤äº†è¦æ±‚ name å±æ€§ä¸ä¸º nullï¼ŒåŒæ—¶ä½ å£°æ˜å®ƒåº”è¯¥æœ‰ä¸€ä¸ªå€¼æ˜¯è‡³å°‘ 5 ä¸ªå­—ç¬¦çš„é•¿åº¦ã€‚</p>
<p>ä¸‹é¢ç¨‹åºæ¸…å•åˆ—å‡ºäº†éªŒè¯ Order ç±»æ‰€éœ€è¦çš„æ”¹å˜ã€‚</p>
<center>ç¨‹åºæ¸…å• 2.11 éªŒè¯ Order å­—æ®µ</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Digits;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Pattern;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.CreditCardNumber;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message=&quot;Name is required&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message=&quot;Street is required&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String street;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message=&quot;City is required&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message=&quot;State is required&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message=&quot;Zip code is required&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String zip;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@CreditCardNumber(message=&quot;Not a valid credit card number&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String ccNumber;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Pattern(regexp=&quot;^(0[1-9]|1[0-2])([\\/])([1-9][0-9])$&quot;, message=&quot;Must be formatted MM/YY&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String ccExpiration;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Digits(integer=3, fraction=0, message=&quot;Invalid CVV&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String ccCVV;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºåœ°å€çš„å±æ€§ï¼Œåªéœ€è¦ç¡®ä¿ç”¨æˆ·æ²¡æœ‰ç•™ä¸‹ä»»ä½•ç©ºç™½å­—æ®µã€‚å¯¹äºè¿™ä¸€ç‚¹ï¼Œå°†ä½¿ç”¨ Hibernate Validator çš„ @NotBlank æ³¨è§£ã€‚</p>
<p>æ”¯ä»˜é¢†åŸŸçš„éªŒè¯éœ€è¦ç¡®ä¿ ccNumber å±æ€§ä¸ä¸ºç©ºï¼Œè¿˜è¦ç¡®ä¿å®ƒåŒ…å«çš„æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ä¿¡ç”¨å¡å·ç çš„å€¼ã€‚è¯¥ ccExpiration å±æ€§å¿…é¡»ç¬¦åˆ MM/YYï¼ˆä¸¤ä½æ•°çš„å¹´/æœˆï¼‰æ ¼å¼ã€‚è€Œ ccCVV å±æ€§å¿…é¡»æ˜¯ä¸€ä¸ªä¸‰ä½çš„æ•°å­—ã€‚ä¸ºäº†å®ç°è¿™ç§éªŒè¯ï¼Œéœ€è¦ä½¿ç”¨ä¸€äº›å…¶ä»–çš„ Java Bean Validation API æ³¨é‡Šï¼ŒåŒæ—¶éœ€è¦ä» Hibernate Validator é›†åˆä¸­å€Ÿç”¨ä¸€äº›éªŒè¯æ³¨è§£ã€‚</p>
<p>ccNumber å±æ€§ç”¨ @CreditCardNumber è¿›è¡Œäº†æ³¨é‡Šã€‚è¯¥æ³¨é‡Šå£°æ˜å±æ€§çš„å€¼å¿…é¡»æ˜¯é€šè¿‡ Luhn ç®—æ³•ï¼ˆ<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Luhn_algorithm%EF%BC%89%E6%A3%80%E6%9F%A5%E8%BF%87%E7%9A%84%E6%9C%89%E6%95%88%E4%BF%A1%E7%94%A8%E5%8D%A1%E5%8F%B7%E3%80%82%E8%BF%99%E5%8F%AF%E4%BB%A5%E9%98%B2%E6%AD%A2%E7%94%A8%E6%88%B7%E5%87%BA%E9%94%99%E7%9A%84%E6%95%B0%E6%8D%AE%E5%92%8C%E6%95%85%E6%84%8F%E9%94%99%E8%AF%AF%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%BD%86%E4%B8%8D%E8%83%BD%E4%BF%9D%E8%AF%81%E4%BF%A1%E7%94%A8%E5%8D%A1%E5%8F%B7%E7%A0%81%E5%AE%9E%E9%99%85%E4%B8%8A%E8%A2%AB%E5%88%86%E9%85%8D%E5%88%B0%E4%B8%80%E4%B8%AA%E5%B8%90%E6%88%B7%EF%BC%8C%E6%88%96%E8%AF%A5%E5%B8%90%E6%88%B7%E5%8F%AF%E4%BB%A5%E7%94%A8%E4%BA%8E%E4%BA%A4%E6%98%93%E3%80%82">https://en.wikipedia.org/wiki/Luhn_algorithmï¼‰æ£€æŸ¥è¿‡çš„æœ‰æ•ˆä¿¡ç”¨å¡å·ã€‚è¿™å¯ä»¥é˜²æ­¢ç”¨æˆ·å‡ºé”™çš„æ•°æ®å’Œæ•…æ„é”™è¯¯çš„æ•°æ®ï¼Œä½†ä¸èƒ½ä¿è¯ä¿¡ç”¨å¡å·ç å®é™…ä¸Šè¢«åˆ†é…åˆ°ä¸€ä¸ªå¸æˆ·ï¼Œæˆ–è¯¥å¸æˆ·å¯ä»¥ç”¨äºäº¤æ˜“ã€‚</a></p>
<p>æ²¡æœ‰ç°æˆçš„æ³¨é‡Šæ¥éªŒè¯ ccExpiration å±æ€§çš„ MM/YY æ ¼å¼ã€‚ @Pattern æ³¨é‡Šæä¾›äº†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œä»¥ç¡®ä¿å±æ€§å€¼ç¬¦åˆæ‰€éœ€çš„æ ¼å¼ã€‚</p>
<p> @Digits æ³¨é‡Š ccCVV å±æ€§ï¼Œä»¥ç¡®ä¿å€¼æ°å¥½åŒ…å«ä¸‰ä¸ªæ•°å­—ã€‚</p>
<p>æ‰€æœ‰çš„éªŒè¯æ³¨é‡Šéƒ½åŒ…å«ä¸€ä¸ªæ¶ˆæ¯å±æ€§ï¼Œè¯¥å±æ€§å®šä¹‰äº†å¦‚æœç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯ä¸ç¬¦åˆå£°æ˜çš„éªŒè¯è§„åˆ™çš„è¦æ±‚æ—¶å°†æ˜¾ç¤ºç»™ç”¨æˆ·çš„æ¶ˆæ¯ã€‚</p>
<h4 id="åœ¨è¡¨å•ç»‘å®šæ—¶æ‰§è¡ŒéªŒè¯"><a href="#åœ¨è¡¨å•ç»‘å®šæ—¶æ‰§è¡ŒéªŒè¯" class="headerlink" title="åœ¨è¡¨å•ç»‘å®šæ—¶æ‰§è¡ŒéªŒè¯"></a>åœ¨è¡¨å•ç»‘å®šæ—¶æ‰§è¡ŒéªŒè¯</h4><p>è¦éªŒè¯æäº¤çš„ Tacoï¼Œéœ€è¦å°† Java Bean Validation API çš„ @Valid æ³¨é‡Šæ·»åŠ åˆ° DesignTacoController çš„ processDesign() æ–¹æ³•çš„ Taco å‚æ•°ä¸­ã€‚</p>
<center>ç¨‹åºæ¸…å• 2.12 éªŒè¯ POST æ¥çš„ Taco</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">processDesign</span><span class="params">(<span class="meta">@Valid</span> Taco design, Errors errors)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (errors.hasErrors()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;design&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Save the taco design...</span></span><br><span class="line">    <span class="comment">// We&#x27;ll do this in chapter 3</span></span><br><span class="line">    log.info(<span class="string">&quot;Processing design: &quot;</span> + design);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/orders/current&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Valid æ³¨è§£å‘Šè¯‰ Spring MVC åœ¨æäº¤çš„ Taco å¯¹è±¡ç»‘å®šåˆ°æäº¤çš„è¡¨å•æ•°æ®ä¹‹åï¼Œä»¥åŠè°ƒç”¨ processDesign() æ–¹æ³•ä¹‹å‰ï¼Œå¯¹æäº¤çš„ Taco å¯¹è±¡æ‰§è¡ŒéªŒè¯ã€‚å¦‚æœå­˜åœ¨ä»»ä½•éªŒè¯é”™è¯¯ï¼Œè¿™äº›é”™è¯¯çš„è¯¦ç»†ä¿¡æ¯å°†åœ¨ä¼ é€’åˆ° processDesign() çš„é”™è¯¯å¯¹è±¡ä¸­æ•è·ã€‚processDesign() çš„å‰å‡ è¡ŒæŸ¥è¯¢ Errors å¯¹è±¡ï¼Œè¯¢é—®å®ƒçš„ hasErrors() æ–¹æ³•æ˜¯å¦å­˜åœ¨ä»»ä½•éªŒè¯é”™è¯¯ã€‚å¦‚æœæœ‰ï¼Œè¯¥æ–¹æ³•ç»“æŸæ—¶ä¸å¤„ç† Tacoï¼Œå¹¶è¿”å› â€œdesignâ€ è§†å›¾åï¼Œä»¥ä¾¿é‡æ–°æ˜¾ç¤ºè¡¨å•ã€‚</p>
<center>ç¨‹åºæ¸…å• 2.13 éªŒè¯ POST æ¥çš„ Order</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">processOrder</span><span class="params">(<span class="meta">@Valid</span> Order order, Errors errors)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (errors.hasErrors()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;orderForm&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    log.info(<span class="string">&quot;Order submitted: &quot;</span> + order);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰éªŒè¯é”™è¯¯ï¼Œåˆ™å…è®¸è¯¥æ–¹æ³•å¤„ç†æäº¤çš„æ•°æ®ã€‚å¦‚æœå­˜åœ¨éªŒè¯é”™è¯¯ï¼Œåˆ™è¯·æ±‚å°†è¢«è½¬å‘åˆ°è¡¨å•è§†å›¾ï¼Œä»¥ä¾¿ç”¨æˆ·æœ‰æœºä¼šçº æ­£å…¶é”™è¯¯ã€‚</p>
<h4 id="æ˜¾ç¤ºéªŒè¯é”™è¯¯"><a href="#æ˜¾ç¤ºéªŒè¯é”™è¯¯" class="headerlink" title="æ˜¾ç¤ºéªŒè¯é”™è¯¯"></a>æ˜¾ç¤ºéªŒè¯é”™è¯¯</h4><p>Thymeleaf é€šè¿‡ fields å±æ€§åŠå…¶ <code>th:errors</code> å±æ€§æä¾›äº†å¯¹ Errors å¯¹è±¡çš„ä¾¿æ·è®¿é—®ã€‚ä¾‹å¦‚ï¼Œè¦åœ¨ä¿¡ç”¨å¡å·å­—æ®µä¸Šæ˜¾ç¤ºéªŒè¯é”™è¯¯ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ª <code>&lt;span&gt;</code> å…ƒç´ ï¼Œè¯¥å…ƒç´ å°†è¿™äº›é”™è¯¯å¼•ç”¨ç”¨äºè®¢å•æ¨¡æ¿ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<center>ç¨‹åºæ¸…å• 2.14 æ˜¾ç¤ºéªŒè¯é”™è¯¯</center>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;ccNumber&quot;</span>&gt;</span>Credit Card #: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;ccNumber&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;validationError&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#fields.hasErrors(&#x27;ccNumber&#x27;)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">th:errors</span>=<span class="string">&quot;*&#123;ccNumber&#125;&quot;</span>&gt;</span>CC Num Error<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é™¤äº†å¯ä»¥ç”¨æ¥è®¾ç½®é”™è¯¯æ ·å¼ä»¥å¼•èµ·ç”¨æˆ·æ³¨æ„çš„ class å±æ€§å¤–ï¼Œ<code>&lt;span&gt;</code> å…ƒç´ è¿˜ä½¿ç”¨ <code>th:if</code> å±æ€§æ¥å†³å®šæ˜¯å¦æ˜¾ç¤º <code>&lt;span&gt;</code>ã€‚fields å±æ€§çš„ hasErrors() æ–¹æ³•æ£€æŸ¥ ccNumber å­—æ®µä¸­æ˜¯å¦æœ‰ä»»ä½•é”™è¯¯ã€‚å¦‚æœæœ‰é”™è¯¯ï¼Œ<code>&lt;span&gt;</code> å°†è¢«æ¸²æŸ“ã€‚</p>
<p><code>th:errors</code> å±æ€§å¼•ç”¨ ccNumber å­—æ®µï¼Œå¹¶ä¸”å‡è®¾è¯¥å­—æ®µå­˜åœ¨é”™è¯¯ï¼Œå®ƒå°†ç”¨éªŒè¯æ¶ˆæ¯æ›¿æ¢ <span> å…ƒç´ çš„å ä½ç¬¦å†…å®¹ã€‚</span></p>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LrrLuVZVpAhCVOcIsxB%252F-LrrMfVVuP588-sEFJpn%252F%E5%9B%BE%202.4%20%E5%9C%A8%E8%AE%A2%E5%8D%95%E8%A1%A8%E5%8D%95%E4%B8%8A%E6%98%BE%E7%A4%BA%E9%AA%8C%E8%AF%81%E9%94%99%E8%AF%AF.jpg" alt="img"></p>
<center>å›¾ 2.4 åœ¨è®¢å•è¡¨å•ä¸Šæ˜¾ç¤ºéªŒè¯é”™è¯¯</center>

<h3 id="ä½¿ç”¨è§†å›¾æ§åˆ¶å™¨"><a href="#ä½¿ç”¨è§†å›¾æ§åˆ¶å™¨" class="headerlink" title="ä½¿ç”¨è§†å›¾æ§åˆ¶å™¨"></a>ä½¿ç”¨è§†å›¾æ§åˆ¶å™¨</h3><p>å°½ç®¡æ¯ä¸ªæ§åˆ¶å™¨åœ¨åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ä¸Šéƒ½æœ‰ä¸åŒçš„ç”¨é€”ï¼Œä½†å®ƒä»¬å‡ ä¹éƒ½éµå¾ªç›¸åŒçš„ç¼–ç¨‹æ¨¡å‹ï¼š</p>
<ul>
<li>å®ƒä»¬éƒ½ç”¨ @Controller è¿›è¡Œäº†æ³¨è§£ï¼Œä»¥è¡¨æ˜å®ƒä»¬æ˜¯æ§åˆ¶å™¨ç±»ï¼Œåº”è¯¥ç”± Spring ç»„ä»¶æ‰«æè‡ªåŠ¨å‘ç°ï¼Œå¹¶åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ä½œä¸º bean è¿›è¡Œå®ä¾‹åŒ–ã€‚</li>
<li>é™¤äº† HomeController ä¹‹å¤–ï¼Œæ‰€æœ‰çš„æ§åˆ¶å™¨éƒ½åœ¨ç±»çº§åˆ«ä¸Šä½¿ç”¨ @RequestMapping è¿›è¡Œæ³¨é‡Šï¼Œä»¥å®šä¹‰æ§åˆ¶å™¨å°†å¤„ç†çš„åŸºæœ¬è¯·æ±‚æ¨¡å¼ã€‚</li>
<li>å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•éƒ½ç”¨ @GetMapping æˆ– @PostMapping è¿›è¡Œäº†æ³¨é‡Šï¼Œä»¥æä¾›å…³äºå“ªäº›æ–¹æ³•åº”è¯¥å¤„ç†å“ªäº›è¯·æ±‚çš„ç»†èŠ‚ã€‚</li>
</ul>
<p>å³å°†ç¼–å†™çš„å¤§å¤šæ•°æ§åˆ¶å™¨éƒ½å°†éµå¾ªè¿™ç§æ¨¡å¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªæ§åˆ¶å™¨è¶³å¤Ÿç®€å•ï¼Œä¸å¡«å……æ¨¡å‹æˆ–æµç¨‹è¾“å…¥ï¼ˆå°±åƒ HomeController ä¸€æ ·ï¼‰ï¼Œé‚£ä¹ˆè¿˜æœ‰å¦ä¸€ç§å®šä¹‰æ§åˆ¶å™¨çš„æ–¹æ³•ã€‚è¯·æŸ¥çœ‹ä¸‹ä¸€ä¸ªç¨‹åºæ¸…å•ï¼Œäº†è§£å¦‚ä½•å£°æ˜è§†å›¾æ§åˆ¶å™¨ â€”â€” ä¸€ä¸ªåªå°†è¯·æ±‚è½¬å‘ç»™è§†å›¾çš„æ§åˆ¶å™¨ã€‚</p>
<center>ç¨‹åºæ¸…å• 2.15 å£°æ˜è§†å›¾æ§åˆ¶å™¨</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ViewControllerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;home&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…³äº @WebConfig æœ€å€¼å¾—æ³¨æ„çš„æ˜¯å®ƒå®ç°äº† WebMvcConfigurer æ¥å£ã€‚WebMvcConfigurer å®šä¹‰äº†å‡ ä¸ªé…ç½® Spring MVC çš„æ–¹æ³•ã€‚å°½ç®¡å®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œä½†å®ƒæä¾›äº†æ‰€æœ‰æ–¹æ³•çš„é»˜è®¤å®ç°ï¼Œå› æ­¤åªéœ€è¦†ç›–æ‰€éœ€çš„æ–¹æ³•ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¦†ç›–äº† addViewControllers() æ–¹æ³•ã€‚</p>
<p>addViewControllers() æ–¹æ³•æä¾›äº†ä¸€ä¸ª ViewControllerRegistryï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥æ³¨å†Œä¸€ä¸ªæˆ–å¤šä¸ªè§†å›¾æ§åˆ¶å™¨ã€‚åœ¨è¿™é‡Œï¼Œåœ¨æ³¨å†Œè¡¨ä¸Šè°ƒç”¨ addViewController()ï¼Œä¼ å…¥ â€œ/â€ï¼Œè¿™æ˜¯è§†å›¾æ§åˆ¶å™¨å¤„ç† GET è¯·æ±‚çš„è·¯å¾„ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª ViewControllerRegistration å¯¹è±¡ï¼Œåœ¨è¯¥å¯¹è±¡ä¸Šç«‹å³è°ƒç”¨ setViewName() æ¥æŒ‡å®š home ä½œä¸ºåº”è¯¥è½¬å‘ â€œ/â€ è¯·æ±‚çš„è§†å›¾ã€‚</p>
<p>å°±åƒè¿™æ ·ï¼Œå·²ç»èƒ½å¤Ÿç”¨é…ç½®ç±»ä¸­çš„å‡ è¡Œä»£ç æ›¿æ¢ HomeControllerã€‚ç°åœ¨å¯ä»¥åˆ é™¤ HomeControllerï¼Œåº”ç”¨ç¨‹åºçš„è¡Œä¸ºåº”è¯¥ä¸ä»¥å‰ä¸€æ ·ã€‚</p>
<p>è¿™é‡Œï¼Œå·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ WebConfig é…ç½®ç±»æ¥å­˜æ”¾è§†å›¾æ§åˆ¶å™¨å£°æ˜ã€‚ä½†æ˜¯ä»»ä½•é…ç½®ç±»éƒ½å¯ä»¥å®ç° WebMvcConfigurer å¹¶è¦†ç›– addViewController() æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†ç›¸åŒçš„è§†å›¾æ§åˆ¶å™¨å£°æ˜æ·»åŠ åˆ°å¼•å¯¼ TacoCloudApplication ç±»ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TacoCloudApplication</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(TacoCloudApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;home&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ‰©å±•ç°æœ‰çš„é…ç½®ç±»ï¼Œå¯ä»¥é¿å…åˆ›å»ºæ–°çš„é…ç½®ç±»ï¼Œä»è€Œé™ä½é¡¹ç›®å·¥ä»¶æ•°é‡ã€‚ä½†æ˜¯æˆ‘å€¾å‘äºä¸ºæ¯ç§é…ç½®ï¼ˆwebã€æ•°æ®ã€å®‰å…¨æ€§ç­‰ç­‰ï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„é…ç½®ç±»ï¼Œä¿æŒåº”ç”¨ç¨‹åºå¼•å¯¼é…ç½®çš„ç®€æ´ã€‚</p>
<h3 id="é€‰æ‹©è§†å›¾æ¨¡æ¿åº“"><a href="#é€‰æ‹©è§†å›¾æ¨¡æ¿åº“" class="headerlink" title="é€‰æ‹©è§†å›¾æ¨¡æ¿åº“"></a>é€‰æ‹©è§†å›¾æ¨¡æ¿åº“</h3><p>è¡¨ 2.2 åˆ—å‡ºäº† Spring Boot è‡ªåŠ¨é…ç½®æ”¯æŒçš„æ¨¡æ¿é€‰é¡¹ã€‚</p>
<center>è¡¨ 2.2 æ”¯æŒçš„æ¨¡æ¿é€‰é¡¹</center>

<table>
<thead>
<tr>
<th>æ¨¡æ¿</th>
<th>Spring Boot starter ä¾èµ–</th>
</tr>
</thead>
<tbody><tr>
<td>FreeMarker</td>
<td>spring-boot-starter-freemarker</td>
</tr>
<tr>
<td>Groovy Templates</td>
<td>spring-boot-starter-groovy-templates</td>
</tr>
<tr>
<td>JavaServer Page(JSP)</td>
<td>None (provided by Tomcat or Jetty)</td>
</tr>
<tr>
<td>Mustache</td>
<td>spring-boot-starter-mustache</td>
</tr>
<tr>
<td>Thymeleaf</td>
<td>spring-boot-starter-thymeleaf</td>
</tr>
</tbody></table>
<p>å¦‚æœå¸Œæœ›ä½¿ç”¨ä¸åŒçš„æ¨¡æ¿åº“ï¼Œåªéœ€åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶é€‰æ‹©å®ƒï¼Œæˆ–è€…ç¼–è¾‘ç°æœ‰çš„é¡¹ç›®æ„å»ºä»¥åŒ…å«æ–°é€‰æ‹©çš„æ¨¡æ¿åº“ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æƒ³ä½¿ç”¨ Mustache è€Œä¸æ˜¯ Thymeleafã€‚æ²¡æœ‰é—®é¢˜ã€‚åªéœ€è®¿é—®é¡¹ç›® pom.xml æ–‡ä»¶ï¼Œå°†ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ›¿æ¢ä¸ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mustache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œéœ€è¦ç¡®ä¿ä½¿ç”¨ Mustache è¯­æ³•è€Œä¸æ˜¯ Thymeleaf æ ‡ç­¾æ¥ç¼–å†™æ‰€æœ‰æ¨¡æ¿ã€‚</p>
<p>åœ¨è¡¨ 2.2 ä¸­è¯·æ³¨æ„ï¼ŒJSP åœ¨æ„å»ºä¸­ä¸éœ€è¦ä»»ä½•ç‰¹æ®Šçš„ä¾èµ–å…³ç³»ã€‚è¿™æ˜¯å› ä¸º servlet å®¹å™¨æœ¬èº«ï¼ˆé»˜è®¤ Tomcatï¼‰å®ç°äº† JSP è§„èŒƒï¼Œå› æ­¤ä¸éœ€è¦è¿›ä¸€æ­¥çš„ä¾èµ–å…³ç³»ã€‚</p>
<p>ä½†æ˜¯å¦‚æœé€‰æ‹©ä½¿ç”¨ JSPï¼Œå°±ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ã€‚äº‹å®è¯æ˜ï¼ŒJava servlet å®¹å™¨ â€”â€” åŒ…æ‹¬åµŒå…¥å¼ Tomcat å’Œ Jetty å®¹å™¨ â€”â€” é€šå¸¸åœ¨ /WEB-INF ä¸‹å¯»æ‰¾ jspã€‚ä½†æ˜¯å¦‚æœå°†åº”ç”¨ç¨‹åºæ„å»ºä¸ºä¸€ä¸ªå¯æ‰§è¡Œçš„ JAR æ–‡ä»¶ï¼Œå°±æ²¡æœ‰åŠæ³•æ»¡è¶³è¿™ä¸ªéœ€æ±‚ã€‚å› æ­¤ï¼Œå¦‚æœå°†åº”ç”¨ç¨‹åºæ„å»ºä¸º WAR æ–‡ä»¶å¹¶å°†å…¶éƒ¨ç½²åœ¨ä¼ ç»Ÿçš„ servlet å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆ JSP åªæ˜¯ä¸€ä¸ªé€‰é¡¹ã€‚å¦‚æœæ­£åœ¨æ„å»ºä¸€ä¸ªå¯æ‰§è¡Œçš„ JAR æ–‡ä»¶ï¼Œå¿…é¡»é€‰æ‹© Thymeleafã€FreeMarker æˆ–è¡¨ 2.2 ä¸­çš„å…¶ä»–é€‰é¡¹ä¹‹ä¸€ã€‚</p>
<h4 id="ç¼“å­˜æ¨¡æ¿"><a href="#ç¼“å­˜æ¨¡æ¿" class="headerlink" title="ç¼“å­˜æ¨¡æ¿"></a>ç¼“å­˜æ¨¡æ¿</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡æ¿åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶åªè§£æä¸€æ¬¡ï¼Œè§£æçš„ç»“æœè¢«ç¼“å­˜ä»¥ä¾›åç»­ä½¿ç”¨ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§ï¼Œå› ä¸ºå®ƒå¯ä»¥é˜²æ­¢å¯¹æ¯ä¸ªè¯·æ±‚è¿›è¡Œå†—ä½™çš„æ¨¡æ¿è§£æï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨å¼€å‘æ—¶ï¼Œè¿™ä¸ªç‰¹æ€§å¹¶ä¸é‚£ä¹ˆå¥½ã€‚å‡è®¾å¯åŠ¨äº†åº”ç”¨ç¨‹åºå¹¶ç‚¹å‡»äº†ç‰ç±³é¥¼è®¾è®¡é¡µé¢ï¼Œå¹¶å†³å®šå¯¹å…¶è¿›è¡Œä¸€äº›æ›´æ”¹ã€‚å½“åˆ·æ–° web æµè§ˆå™¨æ—¶ï¼Œä»ç„¶ä¼šæ˜¾ç¤ºåŸå§‹ç‰ˆæœ¬ã€‚æŸ¥çœ‹æ›´æ”¹çš„æƒŸä¸€æ–¹æ³•æ˜¯é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œè¿™éå¸¸ä¸æ–¹ä¾¿ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ç¦ç”¨ç¼“å­˜ã€‚åªéœ€å°† templateappropriate é«˜é€Ÿç¼“å­˜å±æ€§è®¾ç½®ä¸º falseã€‚è¡¨ 2.3 åˆ—å‡ºäº†æ¯ä¸ªæ”¯æŒçš„æ¨¡æ¿åº“çš„ç¼“å­˜å±æ€§ã€‚</p>
<center>è¡¨ 2.3 å¯ç”¨/ç¦ç”¨æ¨¡æ¿ç¼“å­˜çš„å±æ€§</center>

<table>
<thead>
<tr>
<th>æ¨¡æ¿</th>
<th>ç¼“å­˜ä½¿èƒ½å±æ€§</th>
</tr>
</thead>
<tbody><tr>
<td>Freemarker</td>
<td>spring.freemarker.cache</td>
</tr>
<tr>
<td>Groovy Templates</td>
<td>spring.groovy.template.cache</td>
</tr>
<tr>
<td>Mustache</td>
<td>spring.mustache.cache</td>
</tr>
<tr>
<td>Thymeleaf</td>
<td>spring.thymeleaf.cache</td>
</tr>
</tbody></table>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è¿™äº›å±æ€§éƒ½è®¾ç½®ä¸º true ä»¥å¯ç”¨ç¼“å­˜ã€‚å¯ä»¥é€šè¿‡å°†å…¶ç¼“å­˜å±æ€§è®¾ç½®ä¸º false æ¥ç¦ç”¨æ‰€é€‰æ¨¡æ¿å¼•æ“çš„ç¼“å­˜ã€‚ä¾‹å¦‚ï¼Œè¦ç¦ç”¨ Thymeleaf ç¼“å­˜ï¼Œè¯·åœ¨ application.properties ä¸­æ·»åŠ ä»¥ä¸‹è¡Œï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.thymeleaf.cache</span> = <span class="string">false</span></span><br></pre></td></tr></table></figure>

<p>æƒŸä¸€çš„é—®é¢˜æ˜¯ï¼Œåœ¨å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰ï¼Œä¸€å®šè¦åˆ é™¤è¿™ä¸€è¡Œ(æˆ–å°†å…¶è®¾ç½®ä¸º true)ã€‚ä¸€ç§é€‰æ‹©æ˜¯åœ¨ profile æ–‡ä»¶ä¸­è®¾ç½®å±æ€§ã€‚</p>
<p>ä¸€ä¸ªæ›´ç®€å•çš„é€‰æ‹©æ˜¯ä½¿ç”¨ Spring Boot çš„ DevToolsã€‚åœ¨ DevTools æä¾›çš„è®¸å¤šæœ‰ç”¨çš„å¼€å‘æ—¶å¸®åŠ©ä¸­ï¼Œå®ƒå°†ç¦ç”¨æ‰€æœ‰æ¨¡æ¿åº“çš„ç¼“å­˜ï¼Œä½†åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶å°†ç¦ç”¨è‡ªèº«ï¼ˆä»è€Œé‡æ–°å¯ç”¨æ¨¡æ¿ç¼“å­˜ï¼‰ã€‚</p>
<h3 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ul>
<li>Spring æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„ web æ¡†æ¶ï¼Œç§°ä¸º Spring MVCï¼Œå¯ä»¥ç”¨äºå¼€å‘ Spring åº”ç”¨ç¨‹åºçš„ web å‰ç«¯ã€‚</li>
<li>Spring MVC æ˜¯åŸºäºæ³¨è§£çš„ï¼Œå¯ä»¥ä½¿ç”¨ @RequestMappingã€@GetMapping å’Œ @PostMapping ç­‰æ³¨è§£æ¥å£°æ˜è¯·æ±‚å¤„ç†æ–¹æ³•ã€‚</li>
<li>å¤§å¤šæ•°è¯·æ±‚å¤„ç†æ–¹æ³•é€šè¿‡è¿”å›è§†å›¾çš„é€»è¾‘åç§°æ¥ç»“æŸï¼Œä¾‹å¦‚ä¸€ä¸ª Thymeleaf æ¨¡æ¿ï¼Œè¯·æ±‚ï¼ˆä»¥åŠä»»ä½•æ¨¡å‹æ•°æ®ï¼‰è¢«è½¬å‘åˆ°è¯¥æ¨¡æ¿ã€‚</li>
<li>Spring MVC é€šè¿‡ Java Bean Validation API å’Œ Hibernate Validator ç­‰éªŒè¯ API çš„å®ç°æ¥æ”¯æŒéªŒè¯ã€‚</li>
<li>è§†å›¾æ§åˆ¶å™¨å¯ä»¥ç”¨æ¥å¤„ç†ä¸éœ€è¦æ¨¡å‹æ•°æ®æˆ–å¤„ç†çš„ HTTP GET è¯·æ±‚ã€‚</li>
<li>é™¤äº† Thymeleafï¼ŒSpring è¿˜æ”¯æŒå¤šç§è§†å›¾é€‰é¡¹ï¼ŒåŒ…æ‹¬ FreeMarkerã€Groovy Templates å’Œ Mustacheã€‚</li>
</ul>
<h2 id="ç¬¬-3-ç« -å¤„ç†æ•°æ®"><a href="#ç¬¬-3-ç« -å¤„ç†æ•°æ®" class="headerlink" title="ç¬¬ 3 ç«  å¤„ç†æ•°æ®"></a>ç¬¬ 3 ç«  å¤„ç†æ•°æ®</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>ä½¿ç”¨ Spring JdbcTemplate</li>
<li>ä½¿ç”¨ SimpleJdbcInsert æ’å…¥æ•°æ®</li>
<li>ä½¿ç”¨ Spring Data å£°æ˜ JPA repositories</li>
</ul>
<h3 id="ä½¿ç”¨-JDBC-è¯»å†™æ•°æ®"><a href="#ä½¿ç”¨-JDBC-è¯»å†™æ•°æ®" class="headerlink" title="ä½¿ç”¨ JDBC è¯»å†™æ•°æ®"></a>ä½¿ç”¨ JDBC è¯»å†™æ•°æ®</h3><p>åœ¨å¤„ç†å…³ç³»æ•°æ®æ—¶ï¼ŒJava å¼€å‘äººå‘˜æœ‰å¤šä¸ªé€‰æ‹©ã€‚ä¸¤ä¸ªæœ€å¸¸è§çš„é€‰æ‹©æ˜¯ JDBC å’Œ JPAã€‚</p>
<p>Spring JDBC æ”¯æŒèµ·æºäº JdbcTemplate ç±»ã€‚JdbcTemplate æä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡è¿™ç§æ–¹æ³•ï¼Œå¼€å‘äººå‘˜å¯ä»¥å¯¹å…³ç³»æ•°æ®åº“æ‰§è¡Œ SQL æ“ä½œï¼Œä¸é€šå¸¸ä½¿ç”¨ JDBC ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œä¸éœ€è¦æ»¡è¶³æ‰€æœ‰çš„æ¡ä»¶å’Œæ ·æ¿ä»£ç ã€‚</p>
<center>ç¨‹åºæ¸…å• 3.1 ä¸ä½¿ç”¨ JdbcTemplate æŸ¥è¯¢æ•°æ®åº“</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Ingredient <span class="title">findOne</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    Connection connection = <span class="keyword">null</span>;</span><br><span class="line">    PreparedStatement statement = <span class="keyword">null</span>;</span><br><span class="line">    ResultSet resultSet = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        connection = dataSource.getConnection();</span><br><span class="line">        statement = connection.prepareStatement(</span><br><span class="line">            <span class="string">&quot;select id, name, type from Ingredient&quot;</span>);</span><br><span class="line">        statement.setString(<span class="number">1</span>, id);</span><br><span class="line">        resultSet = statement.executeQuery();</span><br><span class="line">        Ingredient ingredient = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(resultSet.next()) &#123;</span><br><span class="line">            ingredient = <span class="keyword">new</span> Ingredient(</span><br><span class="line">                resultSet.getString(<span class="string">&quot;id&quot;</span>),</span><br><span class="line">                resultSet.getString(<span class="string">&quot;name&quot;</span>),</span><br><span class="line">                Ingredient.Type.valueOf(resultSet.getString(<span class="string">&quot;type&quot;</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ingredient;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        <span class="comment">// ??? What should be done here ???</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resultSet != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                resultSet.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (statement != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                statement.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (connection != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾ˆéš¾åœ¨ JDBC çš„æ··ä¹±ä»£ç ä¸­æ‰¾åˆ°æŸ¥è¯¢æŒ‡é’ˆã€‚å®ƒè¢«åˆ›å»ºè¿æ¥ã€åˆ›å»ºè¯­å¥å’Œé€šè¿‡å…³é—­è¿æ¥ã€è¯­å¥å’Œç»“æœé›†æ¥æ¸…ç†çš„ä»£ç æ‰€åŒ…å›´ã€‚</p>
<p>æ›´ç³Ÿç³•çš„æ˜¯ï¼Œåœ¨åˆ›å»ºè¿æ¥æˆ–è¯­å¥æˆ–æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°è®¸å¤šé—®é¢˜ã€‚è¿™è¦æ±‚æ•è·ä¸€ä¸ª SQLExceptionï¼Œè¿™å¯èƒ½æœ‰åŠ©äºï¼ˆä¹Ÿå¯èƒ½æ— åŠ©äºï¼‰æ‰¾å‡ºé—®é¢˜å‡ºåœ¨å“ªé‡Œæˆ–å¦‚ä½•è§£å†³é—®é¢˜ã€‚</p>
<p>SQLException æ˜¯ä¸€ä¸ªè¢«æ£€æŸ¥çš„å¼‚å¸¸ï¼Œå®ƒéœ€è¦åœ¨ catch å—ä¸­è¿›è¡Œå¤„ç†ã€‚ä½†æ˜¯æœ€å¸¸è§çš„é—®é¢˜ï¼Œå¦‚æœªèƒ½åˆ›å»ºåˆ°æ•°æ®åº“çš„è¿æ¥æˆ–è¾“å…¥é”™è¯¯çš„æŸ¥è¯¢ï¼Œä¸å¯èƒ½åœ¨ catch å—ä¸­å¾—åˆ°è§£å†³ï¼Œå¯èƒ½ä¼šé‡æ–°å‘ä¸ŠæŠ›å‡ºä»¥æ±‚å¤„ç†ã€‚ç›¸åï¼Œè¦æ˜¯è€ƒè™‘ä½¿ç”¨ JdbcTemplate çš„æ–¹æ³•ã€‚</p>
<center>ç¨‹åºæ¸…å• 3.2 ä½¿ç”¨ JdbcTemplate æŸ¥è¯¢æ•°æ®åº“</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> JdbcTemplate jdbc;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Ingredient <span class="title">findOne</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> jdbc.queryForObject(</span><br><span class="line">        <span class="string">&quot;select id, name, type from Ingredient where id=?&quot;</span>,</span><br><span class="line">        <span class="keyword">this</span>::mapRowToIngredient, id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Ingredient <span class="title">mapRowToIngredient</span><span class="params">(ResultSet rs, <span class="keyword">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Ingredient(</span><br><span class="line">        rs.getString(<span class="string">&quot;id&quot;</span>),</span><br><span class="line">        rs.getString(<span class="string">&quot;name&quot;</span>),</span><br><span class="line">        Ingredient.Type.valueOf(rs.getString(<span class="string">&quot;type&quot;</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºæ¸…å• 3.2 ä¸­çš„ä»£ç æ˜¾ç„¶æ¯”ç¨‹åºæ¸…å• 3.1 ä¸­çš„åŸå§‹ JDBC ç¤ºä¾‹ç®€å•å¾—å¤šï¼›æ²¡æœ‰åˆ›å»ºä»»ä½•è¯­å¥æˆ–è¿æ¥ã€‚è€Œä¸”ï¼Œåœ¨æ–¹æ³•å®Œæˆä¹‹åï¼Œä¸ä¼šå¯¹é‚£äº›å¯¹è±¡è¿›è¡Œä»»ä½•æ¸…ç†ã€‚æœ€åï¼Œè¿™æ ·åšä¸ä¼šå­˜åœ¨ä»»ä½•åœ¨ catch å—ä¸­ä¸èƒ½å¤„ç†çš„å¼‚å¸¸ã€‚å‰©ä¸‹çš„ä»£ç åªä¸“æ³¨äºæ‰§è¡ŒæŸ¥è¯¢ï¼ˆè°ƒç”¨ JdbcTemplate çš„ queryForObject() æ–¹æ³•ï¼‰å¹¶å°†ç»“æœæ˜ å°„åˆ° Ingredient å¯¹è±¡ï¼ˆåœ¨ mapRowToIngredient() æ–¹æ³•ä¸­ï¼‰ã€‚</p>
<h4 id="ä¸ºåŸŸé€‚é…æŒä¹…åŒ–"><a href="#ä¸ºåŸŸé€‚é…æŒä¹…åŒ–" class="headerlink" title="ä¸ºåŸŸé€‚é…æŒä¹…åŒ–"></a>ä¸ºåŸŸé€‚é…æŒä¹…åŒ–</h4><p>åœ¨å°†å¯¹è±¡æŒä¹…åŒ–åˆ°æ•°æ®åº“æ—¶ï¼Œé€šå¸¸æœ€å¥½æœ‰ä¸€ä¸ªæƒŸä¸€æ ‡è¯†å¯¹è±¡çš„å­—æ®µã€‚Ingredient ç±»å·²ç»æœ‰ä¸€ä¸ª id å­—æ®µï¼Œä½†æ˜¯éœ€è¦å‘ Taco å’Œ Order æ·»åŠ  id å­—æ®µã€‚</p>
<center>ç¨‹åºæ¸…å• 3.3 å‘ Taco ç±»æ·»åŠ  id å’Œ timestamp å­—æ®µ</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Taco</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Date createdAt;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Order ç±»ä¹Ÿéœ€è¦åšç±»ä¼¼çš„ä¿®æ”¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Date placedAt;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŸŸç±»ç°åœ¨å·²ç»ä¸ºæŒä¹…åŒ–åšå¥½äº†å‡†å¤‡ã€‚</p>
<h4 id="ä½¿ç”¨-JdbcTemplate"><a href="#ä½¿ç”¨-JdbcTemplate" class="headerlink" title="ä½¿ç”¨ JdbcTemplate"></a>ä½¿ç”¨ JdbcTemplate</h4><p>åœ¨å¼€å§‹ä½¿ç”¨ JdbcTemplate ä¹‹å‰ï¼Œéœ€è¦å°†å®ƒæ·»åŠ åˆ°é¡¹ç›®ç±»è·¯å¾„ä¸­ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿˜éœ€è¦ä¸€ä¸ªå­˜å‚¨æ•°æ®çš„æ•°æ®åº“ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>å®šä¹‰ JDBC å­˜å‚¨åº“</strong></p>
<p>Ingredient repository éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>æŸ¥è¯¢æ‰€æœ‰çš„ Ingredient ä½¿ä¹‹å˜æˆä¸€ä¸ª Ingredient çš„é›†åˆå¯¹è±¡</li>
<li>é€šè¿‡å®ƒçš„ id æŸ¥è¯¢å•ä¸ª Ingredient</li>
<li>ä¿å­˜ä¸€ä¸ª Ingredient å¯¹è±¡</li>
</ul>
<p>ä»¥ä¸‹ IngredientRepository æ¥å£å°†è¿™ä¸‰ç§æ“ä½œå®šä¹‰ä¸ºæ–¹æ³•å£°æ˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tacos.Ingredient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IngredientRepository</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Iterable&lt;Ingredient&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Ingredient <span class="title">findOne</span><span class="params">(String id)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Ingredient <span class="title">save</span><span class="params">(Ingredient ingredient)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°½ç®¡è¯¥æ¥å£ä½“ç°äº†éœ€è¦ Ingredient repository åšçš„äº‹æƒ…çš„æœ¬è´¨ï¼Œä½†æ˜¯ä»ç„¶éœ€è¦ç¼–å†™ä¸€ä¸ªä½¿ç”¨ JdbcTemplate æ¥æŸ¥è¯¢æ•°æ®åº“çš„ IngredientRepository çš„å®ç°ã€‚</p>
<center>ç¨‹åºæ¸…å• 3.4 ä½¿ç”¨ JdbcTemplate å¼€å§‹ç¼–å†™ Ingredient repository</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.RowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tacos.Ingredient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcIngredientRepository</span> <span class="keyword">implements</span> <span class="title">IngredientRepository</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbc;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JdbcIngredientRepository</span><span class="params">(JdbcTemplate jdbc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.jdbc = jdbc;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä½¿ç”¨ @Repository å¯¹ JdbcIngredientRepository è¿›è¡Œæ³¨è§£ï¼Œè¿™æ ·å®ƒå°±ä¼šç”± Spring ç»„ä»¶åœ¨æ‰«ææ—¶è‡ªåŠ¨å‘ç°ï¼Œå¹¶åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ç”Ÿæˆ bean å®ä¾‹ã€‚</p>
<p>å½“ Spring åˆ›å»º JdbcIngredientRepository bean æ—¶ï¼Œé€šè¿‡ @Autowired æ³¨è§£å°† JdbcTemplate æ³¨å…¥åˆ° bean ä¸­ã€‚æ„é€ å‡½æ•°å°† JdbcTemplate åˆ†é…ç»™ä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œè¯¥å˜é‡å°†åœ¨å…¶ä»–æ–¹æ³•ä¸­ç”¨äºæŸ¥è¯¢å’Œæ’å…¥æ•°æ®åº“ã€‚</p>
<center>ç¨‹åºæ¸…å• 3.5 ä½¿ç”¨ JdbcTemplate æŸ¥è¯¢æ•°æ®åº“</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Iterable&lt;Ingredient&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> jdbc.query(<span class="string">&quot;select id, name, type from Ingredient&quot;</span>,</span><br><span class="line">              <span class="keyword">this</span>::mapRowToIngredient);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Ingredient <span class="title">findOne</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> jdbc.queryForObject(</span><br><span class="line">        <span class="string">&quot;select id, name, type from Ingredient where id=?&quot;</span>,</span><br><span class="line">        <span class="keyword">this</span>::mapRowToIngredient, id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Ingredient <span class="title">mapRowToIngredient</span><span class="params">(ResultSet rs, <span class="keyword">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Ingredient(</span><br><span class="line">        rs.getString(<span class="string">&quot;id&quot;</span>),</span><br><span class="line">        rs.getString(<span class="string">&quot;name&quot;</span>),</span><br><span class="line">        Ingredient.Type.valueOf(rs.getString(<span class="string">&quot;type&quot;</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>findAll() å’Œ findById() éƒ½ä»¥ç±»ä¼¼çš„æ–¹å¼ä½¿ç”¨ JdbcTemplateã€‚æœŸæœ›è¿”å›å¯¹è±¡é›†åˆçš„ findAll() æ–¹æ³•ä½¿ç”¨äº† JdbcTemplate çš„ query() æ–¹æ³•ã€‚query() æ–¹æ³•æ¥å—æŸ¥è¯¢çš„ SQL ä»¥åŠ Spring çš„ RowMapper å®ç°ï¼Œä»¥ä¾¿å°†ç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œæ˜ å°„åˆ°ä¸€ä¸ªå¯¹è±¡ã€‚findAll() è¿˜æ¥å—æŸ¥è¯¢ä¸­æ‰€éœ€çš„æ‰€æœ‰å‚æ•°çš„åˆ—è¡¨ä½œä¸ºå®ƒçš„æœ€åä¸€ä¸ªå‚æ•°ã€‚ä½†æ˜¯ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæ²¡æœ‰ä»»ä½•å¿…éœ€çš„å‚æ•°ã€‚</p>
<p>findById() æ–¹æ³•åªæœŸæœ›è¿”å›å•ä¸ªæˆåˆ†å¯¹è±¡ï¼Œå› æ­¤å®ƒä½¿ç”¨ JdbcTemplate çš„ queryForObject() æ–¹æ³•è€Œä¸æ˜¯ query()ã€‚queryForObject() çš„å·¥ä½œåŸç†ä¸ query() éå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯å®ƒè¿”å›çš„æ˜¯å•ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯å¯¹è±¡åˆ—è¡¨ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒç»™å‡ºäº†è¦æ‰§è¡Œçš„æŸ¥è¯¢ã€ä¸€ä¸ª RowMapper å’Œè¦è·å–çš„ Ingredient çš„ idï¼Œåè€…ç”¨äºä»£æ›¿æŸ¥è¯¢ SQL ä¸­ çš„ <code>?</code>ã€‚</p>
<p>å¦‚ç¨‹åºæ¸…å• 3.5 æ‰€ç¤ºï¼ŒfindAll() å’Œ findById() çš„ RowMapper å‚æ•°ä½œä¸º mapRowToIngredient() æ–¹æ³•çš„æ–¹æ³•å¼•ç”¨ã€‚å½“ä½¿ç”¨ JdbcTemplate ä½œä¸ºæ˜¾å¼ RowMapper å®ç°çš„æ›¿ä»£æ–¹æ¡ˆæ—¶ï¼Œä½¿ç”¨ Java 8 çš„æ–¹æ³•å¼•ç”¨å’Œ lambda éå¸¸æ–¹ä¾¿ã€‚ä½†æ˜¯ï¼Œå¦‚æœå‡ºäºæŸç§åŸå› ï¼Œæƒ³è¦æˆ–æ˜¯éœ€è¦ä¸€ä¸ªæ˜¾å¼çš„ RowMapperï¼Œé‚£ä¹ˆ findAll() çš„ä»¥ä¸‹å®ç°å°†å±•ç¤ºå¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Ingredient <span class="title">findOne</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> jdbc.queryForObject(</span><br><span class="line">        <span class="string">&quot;select id, name, type from Ingredient where id=?&quot;</span>,</span><br><span class="line">        <span class="keyword">new</span> RowMapper&lt;Ingredient&gt;() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> Ingredient <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> rowNum)</span></span></span><br><span class="line"><span class="function">                <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Ingredient(</span><br><span class="line">                    rs.getString(<span class="string">&quot;id&quot;</span>),</span><br><span class="line">                    rs.getString(<span class="string">&quot;name&quot;</span>),</span><br><span class="line">                    Ingredient.Type.valueOf(rs.getString(<span class="string">&quot;type&quot;</span>)));</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;, id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»æ•°æ®åº“è¯»å–æ•°æ®åªæ˜¯é—®é¢˜çš„ä¸€éƒ¨åˆ†ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¿…é¡»å°†æ•°æ®å†™å…¥æ•°æ®åº“ä»¥ä¾¿èƒ½å¤Ÿè¯»å–ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å®ç° save() æ–¹æ³•ã€‚</p>
<p><strong>æ’å…¥ä¸€è¡Œ</strong></p>
<p>JdbcTemplate çš„ update() æ–¹æ³•å¯ç”¨äºåœ¨æ•°æ®åº“ä¸­å†™å…¥æˆ–æ›´æ–°æ•°æ®çš„ä»»ä½•æŸ¥è¯¢ã€‚å¹¶ä¸”ï¼Œå¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºï¼Œå®ƒå¯ä»¥ç”¨æ¥å°†æ•°æ®æ’å…¥æ•°æ®åº“ã€‚</p>
<center>ç¨‹åºæ¸…å• 3.6 ä½¿ç”¨ JdbcTemplate æ’å…¥æ•°æ®</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Ingredient <span class="title">save</span><span class="params">(Ingredient ingredient)</span> </span>&#123;</span><br><span class="line">    jdbc.update(</span><br><span class="line">        <span class="string">&quot;insert into Ingredient (id, name, type) values (?, ?, ?)&quot;</span>,</span><br><span class="line">        ingredient.getId(),</span><br><span class="line">        ingredient.getName(),</span><br><span class="line">        ingredient.getType().toString());</span><br><span class="line">    <span class="keyword">return</span> ingredient;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæ²¡æœ‰å¿…è¦å°† ResultSet æ•°æ®æ˜ å°„åˆ°å¯¹è±¡ï¼Œæ‰€ä»¥ update() æ–¹æ³•è¦æ¯” query() æˆ– queryForObject() ç®€å•å¾—å¤šã€‚å®ƒåªéœ€è¦ä¸€ä¸ªåŒ…å« SQL çš„å­—ç¬¦ä¸²æ¥æ‰§è¡Œï¼Œä»¥åŠä¸ºä»»ä½•æŸ¥è¯¢å‚æ•°èµ‹å€¼ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒæŸ¥è¯¢æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå®ƒä»¬å¯¹åº”äº save() æ–¹æ³•çš„æœ€åä¸‰ä¸ªå‚æ•°ï¼Œæä¾›äº† Ingredient çš„ idã€name å’Œ typeã€‚</p>
<p>å®Œæˆäº† JdbcIngredientRepositoryåï¼Œç°åœ¨å¯ä»¥å°†å…¶æ³¨å…¥åˆ° DesignTacoController ä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥æä¾›ä¸€ä¸ª Ingredient å¯¹è±¡åˆ—è¡¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç¡¬ç¼–ç çš„å€¼ï¼ˆæ­£å¦‚ç¬¬ 2 ç« ä¸­æ‰€åšçš„é‚£æ ·ï¼‰ã€‚DesignTacoController çš„å˜åŒ–å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<center>ç¨‹åºæ¸…å• 3.7 åœ¨æ§åˆ¶å™¨ä¸­æ³¨å…¥å¹¶ä½¿ç”¨ repository</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/design&quot;)</span></span><br><span class="line"><span class="meta">@SessionAttributes(&quot;order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DesignTacoController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IngredientRepository ingredientRepo;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DesignTacoController</span><span class="params">(IngredientRepository ingredientRepo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ingredientRepo = ingredientRepo;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">showDesignForm</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        List&lt;Ingredient&gt; ingredients = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        ingredientRepo.findAll().forEach(i -&gt; ingredients.add(i));</span><br><span class="line">        Type[] types = Ingredient.Type.values();</span><br><span class="line">        <span class="keyword">for</span> (Type type : types) &#123;</span><br><span class="line">            model.addAttribute(type.toString().toLowerCase(),</span><br><span class="line">                               filterByType(ingredients, type));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;design&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯·æ³¨æ„ï¼ŒshowDesignForm() æ–¹æ³•çš„ç¬¬ 2 è¡Œç°åœ¨è°ƒç”¨äº†æ³¨å…¥çš„ IngredientRepository çš„ findAll() æ–¹æ³•ã€‚findAll() æ–¹æ³•ä»æ•°æ®åº“ä¸­æå–æ‰€æœ‰ Ingredientï¼Œç„¶åå°†å®ƒä»¬å¯¹åº”åˆ°åˆ°æ¨¡å‹çš„ä¸åŒç±»å‹ä¸­ã€‚</p>
<h4 id="å®šä¹‰æ¨¡å¼å¹¶é¢„åŠ è½½æ•°æ®"><a href="#å®šä¹‰æ¨¡å¼å¹¶é¢„åŠ è½½æ•°æ®" class="headerlink" title="å®šä¹‰æ¨¡å¼å¹¶é¢„åŠ è½½æ•°æ®"></a>å®šä¹‰æ¨¡å¼å¹¶é¢„åŠ è½½æ•°æ®</h4><p>é™¤äº† Ingredient è¡¨ä¹‹å¤–ï¼Œè¿˜éœ€è¦ä¸€äº›ä¿å­˜è®¢å•å’Œè®¾è®¡ä¿¡æ¯çš„è¡¨ã€‚å›¾ 3.1 è¯´æ˜äº†éœ€è¦çš„è¡¨ä»¥åŠè¿™äº›è¡¨ä¹‹é—´çš„å…³ç³»ã€‚</p>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-Lrx2AjbkGPWURrJJ17z%252F-Lrx3036m2z0FC9UYTmW%252F%E5%9B%BE%203.1%20Taco%20Cloud%20%E6%95%B0%E6%8D%AE%E8%A1%A8.jpg" alt="img"></p>
<center>å›¾ 3.1 Taco Cloud æ•°æ®è¡¨</center>

<p>å›¾ 3.1ä¸­çš„è¡¨æœ‰ä»¥ä¸‹ç”¨é€”ï¼š</p>
<ul>
<li>Ingredient - ä¿å­˜ç€åŸæ–™ä¿¡æ¯</li>
<li>Taco - ä¿å­˜ç€å…³äº taco è®¾è®¡çš„é‡è¦ä¿¡æ¯</li>
<li>Taco_Ingredient - åŒ…å« Taco è¡¨ä¸­æ¯ä¸€è¡Œçš„ä¸€ä¸ªæˆ–å¤šè¡Œæ•°æ®ï¼Œå°† Taco æ˜ å°„åˆ°è¯¥ Taco çš„ Ingredient</li>
<li>Taco_Order - ä¿å­˜ç€é‡è¦çš„è®¢å•ç»†èŠ‚</li>
<li>Taco_Order_Tacos - åŒ…å« Taco_Order è¡¨ä¸­çš„æ¯ä¸€è¡Œçš„ä¸€ä¸ªæˆ–å¤šè¡Œæ•°æ®ï¼Œå°† Order æ˜ å°„åˆ° Order ä¸­çš„Tacos</li>
</ul>
<center>ç¨‹åºæ¸…å• 3.8 å®šä¹‰ Taco Cloud æ¨¡å¼</center>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> Ingredient (</span><br><span class="line">    id <span class="type">varchar</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">25</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    type <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> Taco (</span><br><span class="line">    id <span class="keyword">identity</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    createdAt <span class="type">timestamp</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> Taco_Ingredients (</span><br><span class="line">    taco <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    ingredient <span class="type">varchar</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> Taco_Ingredients <span class="keyword">add</span> <span class="keyword">foreign</span> key (taco) <span class="keyword">references</span> Taco(id);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> Taco_Ingredients <span class="keyword">add</span> <span class="keyword">foreign</span> key (ingredient) <span class="keyword">references</span> Ingredient(id);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> Taco_Order (</span><br><span class="line">    id <span class="keyword">identity</span>,</span><br><span class="line">    deliveryName <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    deliveryStreet <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    deliveryCity <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    deliveryState <span class="type">varchar</span>(<span class="number">2</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    deliveryZip <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    ccNumber <span class="type">varchar</span>(<span class="number">16</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    ccExpiration <span class="type">varchar</span>(<span class="number">5</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    ccCVV <span class="type">varchar</span>(<span class="number">3</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    placedAt <span class="type">timestamp</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> Taco_Order_Tacos (</span><br><span class="line">    tacoOrder <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    taco <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> Taco_Order_Tacos <span class="keyword">add</span> <span class="keyword">foreign</span> key (tacoOrder) <span class="keyword">references</span> Taco_Order(id);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> Taco_Order_Tacos <span class="keyword">add</span> <span class="keyword">foreign</span> key (taco) <span class="keyword">references</span> Taco(id);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæœ‰ä¸€ä¸ªåä¸º schema.sql çš„æ–‡ä»¶ã€‚åœ¨åº”ç”¨ç¨‹åºçš„ç±»è·¯å¾„æ ¹ç›®å½•ä¸‹æ‰§è¡Œ sqlï¼Œç„¶ååœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶å¯¹æ•°æ®åº“æ‰§è¡Œè¯¥æ–‡ä»¶ä¸­çš„ SQLã€‚å› æ­¤ï¼Œåº”è¯¥å°†ç¨‹åºæ¸…å• 3.8 çš„å†…å®¹å†™å…¥ä¸€ä¸ªåä¸º schema.sql çš„æ–‡ä»¶ä¸­ï¼Œç„¶åæ”¾åœ¨é¡¹ç›®çš„ src/main/resources æ–‡ä»¶å¤¹ä¸‹ã€‚</p>
<p>è¿˜éœ€è¦ç”¨ä¸€äº› Ingredient æ•°æ®æ¥é¢„åŠ è½½æ•°æ®åº“ã€‚å¹¸è¿çš„æ˜¯ï¼ŒSpring Boot è¿˜å°†æ‰§è¡Œä¸€ä¸ªåä¸º data.sql çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä½äºæ ¹è·¯å¾„ä¸‹ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨ src/main/resources/data.sql ä¸­çš„ä¸‹é¢ç¨‹åºæ¸…å•ä¸­çš„ insert è¯­å¥æ¥åŠ è½½åŒ…å« Ingredient æ•°æ®çš„æ•°æ®åº“ã€‚</p>
<center>ç¨‹åºæ¸…å• 3.9 é¢„åŠ è½½æ•°æ®åº“</center>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> Taco_Order_Tacos;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> Taco_Ingredients;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> Taco;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> Taco_Order;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> Ingredient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;FLTO&#x27;</span>, <span class="string">&#x27;Flour Tortilla&#x27;</span>, <span class="string">&#x27;WRAP&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;COTO&#x27;</span>, <span class="string">&#x27;Corn Tortilla&#x27;</span>, <span class="string">&#x27;WRAP&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;GRBF&#x27;</span>, <span class="string">&#x27;Ground Beef&#x27;</span>, <span class="string">&#x27;PROTEIN&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;CARN&#x27;</span>, <span class="string">&#x27;Carnitas&#x27;</span>, <span class="string">&#x27;PROTEIN&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;TMTO&#x27;</span>, <span class="string">&#x27;Diced Tomatoes&#x27;</span>, <span class="string">&#x27;VEGGIES&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;LETC&#x27;</span>, <span class="string">&#x27;Lettuce&#x27;</span>, <span class="string">&#x27;VEGGIES&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;CHED&#x27;</span>, <span class="string">&#x27;Cheddar&#x27;</span>, <span class="string">&#x27;CHEESE&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;JACK&#x27;</span>, <span class="string">&#x27;Monterrey Jack&#x27;</span>, <span class="string">&#x27;CHEESE&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;SLSA&#x27;</span>, <span class="string">&#x27;Salsa&#x27;</span>, <span class="string">&#x27;SAUCE&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;SRCR&#x27;</span>, <span class="string">&#x27;Sour Cream&#x27;</span>, <span class="string">&#x27;SAUCE&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>å³ä½¿åªå¼€å‘äº† Ingredient æ•°æ®çš„å­˜å‚¨åº“ï¼Œä¹Ÿå¯ä»¥å¯åŠ¨ Taco Cloud åº”ç”¨ç¨‹åºå¹¶è®¿é—®è®¾è®¡é¡µé¢ï¼ŒæŸ¥çœ‹JdbcIngredientRepository çš„è¿è¡Œæƒ…å†µã€‚</p>
<h4 id="æ’å…¥æ•°æ®"><a href="#æ’å…¥æ•°æ®" class="headerlink" title="æ’å…¥æ•°æ®"></a>æ’å…¥æ•°æ®</h4><p>åˆ°æ­¤ï¼Œå·²ç»äº†è§£äº†å¦‚ä½•ä½¿ç”¨ JdbcTemplate å‘æ•°æ®åº“å†™å…¥æ•°æ®ã€‚JdbcIngredientRepository ä¸­çš„ save() æ–¹æ³•ä½¿ç”¨ JdbcTemplate çš„ update() æ–¹æ³•å°† Ingredient å¯¹è±¡ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</p>
<p>è™½ç„¶è¿™æ˜¯ç¬¬ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œä½†æ˜¯å®ƒå¯èƒ½æœ‰ç‚¹å¤ªç®€å•äº†ã€‚ä¿å­˜æ•°æ®å¯èƒ½æ¯” JdbcIngredientRepository æ‰€éœ€è¦çš„æ›´å¤æ‚ã€‚ä½¿ç”¨ JdbcTemplate ä¿å­˜æ•°æ®çš„ä¸¤ç§æ–¹æ³•åŒ…æ‹¬ï¼š</p>
<ul>
<li>ç›´æ¥ä½¿ç”¨ update() æ–¹æ³•</li>
<li>ä½¿ç”¨ SimpleJdbcInsert åŒ…è£…ç±»</li>
</ul>
<p>è®©æˆ‘ä»¬é¦–å…ˆçœ‹çœ‹ï¼Œå½“æŒä¹…è¯éœ€æ±‚æ¯”ä¿å­˜ä¸€ä¸ª Ingredient æ‰€éœ€è¦çš„æ›´å¤æ‚æ—¶ï¼Œå¦‚ä½•ä½¿ç”¨ update() æ–¹æ³•ã€‚</p>
<p><strong>ä½¿ç”¨ JdbcTemplate ä¿å­˜æ•°æ®</strong></p>
<p>ç›®å‰ï¼ŒTaco å’Œ Order å­˜å‚¨åº“éœ€è¦åšçš„æƒŸä¸€ä¸€ä»¶äº‹æ˜¯ä¿å­˜å®ƒä»¬å„è‡ªçš„å¯¹è±¡ã€‚ä¸ºäº†ä¿å­˜ Taco å¯¹è±¡ï¼ŒTacoRepository å£°æ˜äº†ä¸€ä¸ª save() æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tacos.Taco;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TacoRepository</span> </span>&#123;</span><br><span class="line">    <span class="function">Taco <span class="title">save</span><span class="params">(Taco design)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼åœ°ï¼ŒOrderRepository ä¹Ÿå£°æ˜äº†ä¸€ä¸ª save() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tacos.Order;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderRepository</span> </span>&#123;</span><br><span class="line">    <span class="function">Order <span class="title">save</span><span class="params">(Order order)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿å­˜ä¸€ä¸ª Taco è®¾è®¡éœ€è¦å°†ä¸è¯¥ Taco å…³è”çš„ Ingredient ä¿å­˜åˆ° Taco_Ingredient è¡¨ä¸­ã€‚åŒæ ·ï¼Œä¿å­˜ Order ä¹Ÿéœ€è¦å°†ä¸ Order å…³è”çš„ Taco ä¿å­˜åˆ° Taco_Order_Tacos è¡¨ä¸­ã€‚è¿™ä½¿å¾—ä¿å­˜ Taco å’Œ Order æ¯” ä¿å­˜ Ingredient æ›´æœ‰æŒ‘æˆ˜æ€§ã€‚</p>
<p>è¦å®ç° TacoRepositoryï¼Œéœ€è¦ä¸€ä¸ª save() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é¦–å…ˆä¿å­˜åŸºæœ¬çš„ Taco è®¾è®¡ç»†èŠ‚ï¼ˆä¾‹å¦‚ï¼Œåç§°å’Œåˆ›å»ºæ—¶é—´ï¼‰ï¼Œç„¶åä¸º Taco å¯¹è±¡ä¸­çš„æ¯ä¸ª Ingredient åœ¨ Taco_Ingredients ä¸­æ’å…¥ä¸€è¡Œã€‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ˜¾ç¤ºäº†å®Œæ•´çš„ JdbcTacoRepository ç±»ã€‚</p>
<center>ç¨‹åºæ¸…å• 3.10 ä½¿ç”¨ JdbcTemplate å®ç° TacoRepository</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Timestamp;</span><br><span class="line"><span class="keyword">import</span> java.sql.Types;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.PreparedStatementCreator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.PreparedStatementCreatorFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.support.GeneratedKeyHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.support.KeyHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tacos.Ingredient;</span><br><span class="line"><span class="keyword">import</span> tacos.Taco;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcTacoRepository</span> <span class="keyword">implements</span> <span class="title">TacoRepository</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbc;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JdbcTacoRepository</span><span class="params">(JdbcTemplate jdbc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.jdbc = jdbc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Taco <span class="title">save</span><span class="params">(Taco taco)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> tacoId = saveTacoInfo(taco);</span><br><span class="line">        taco.setId(tacoId);</span><br><span class="line">        <span class="keyword">for</span> (Ingredient ingredient : taco.getIngredients()) &#123;</span><br><span class="line">            saveIngredientToTaco(ingredient, tacoId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> taco;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">long</span> <span class="title">saveTacoInfo</span><span class="params">(Taco taco)</span> </span>&#123;</span><br><span class="line">        taco.setCreatedAt(<span class="keyword">new</span> Date());</span><br><span class="line">        PreparedStatementCreator psc = <span class="keyword">new</span> PreparedStatementCreatorFactory(</span><br><span class="line">            <span class="string">&quot;insert into Taco (name, createdAt) values (?, ?)&quot;</span>,</span><br><span class="line">            Types.VARCHAR, Types.TIMESTAMP</span><br><span class="line">        ).newPreparedStatementCreator(</span><br><span class="line">            Arrays.asList(</span><br><span class="line">                taco.getName(),</span><br><span class="line">                <span class="keyword">new</span> Timestamp(taco.getCreatedAt().getTime())));</span><br><span class="line"></span><br><span class="line">        KeyHolder keyHolder = <span class="keyword">new</span> GeneratedKeyHolder();</span><br><span class="line">        jdbc.update(psc, keyHolder);</span><br><span class="line">        <span class="keyword">return</span> keyHolder.getKey().longValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveIngredientToTaco</span><span class="params">(Ingredient ingredient, <span class="keyword">long</span> tacoId)</span> </span>&#123;</span><br><span class="line">        jdbc.update(</span><br><span class="line">            <span class="string">&quot;insert into Taco_Ingredients (taco, ingredient) &quot;</span> +<span class="string">&quot;values (?, ?)&quot;</span>,</span><br><span class="line">            tacoId, ingredient.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>save() æ–¹æ³•é¦–å…ˆè°ƒç”¨ç§æœ‰çš„ saveTacoInfo() æ–¹æ³•ï¼Œç„¶åä½¿ç”¨è¯¥æ–¹æ³•è¿”å›çš„ Taco id è°ƒç”¨ saveIngredientToTaco()ï¼Œå®ƒä¿å­˜æ¯ä¸ªæˆåˆ†ã€‚å…³é”®åœ¨äº saveTacoInfo() çš„ç»†èŠ‚ã€‚</p>
<p>åœ¨ Taco ä¸­æ’å…¥ä¸€è¡Œæ—¶ï¼Œéœ€è¦çŸ¥é“æ•°æ®åº“ç”Ÿæˆçš„ idï¼Œä»¥ä¾¿åœ¨æ¯ä¸ª Ingredient ä¸­å¼•ç”¨å®ƒã€‚ä¿å­˜ Ingredient æ•°æ®æ—¶ä½¿ç”¨çš„ update() æ–¹æ³•ä¸èƒ½è·å¾—ç”Ÿæˆçš„ idï¼Œå› æ­¤è¿™é‡Œéœ€è¦ä¸€ä¸ªä¸åŒçš„ update() æ–¹æ³•ã€‚</p>
<p>éœ€è¦çš„ update() æ–¹æ³•æ¥å— PreparedStatementCreator å’Œ KeyHolderã€‚KeyHolder å°†æä¾›ç”Ÿæˆçš„ Taco idï¼Œä½†æ˜¯ä¸ºäº†ä½¿ç”¨å®ƒï¼Œè¿˜å¿…é¡»åˆ›å»ºä¸€ä¸ª PreparedStatementCreatorã€‚</p>
<p>å¦‚ç¨‹åºæ¸…å• 3.10 æ‰€ç¤ºï¼Œåˆ›å»º PreparedStatementCreator éå¸¸é‡è¦ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ª PreparedStatementCreatorFactoryï¼Œä¸ºå®ƒæä¾›æƒ³è¦æ‰§è¡Œçš„ SQLï¼Œä»¥åŠæ¯ä¸ªæŸ¥è¯¢å‚æ•°çš„ç±»å‹ã€‚ç„¶ååœ¨è¯¥å·¥å‚ä¸Šè°ƒç”¨ newPreparedStatementCreator()ï¼Œåœ¨æŸ¥è¯¢å‚æ•°ä¸­ä¼ é€’æ‰€éœ€çš„å€¼ä»¥ç”Ÿæˆ PreparedStatementCreatorã€‚</p>
<p>é€šè¿‡ä½¿ç”¨ PreparedStatementCreatorï¼Œå¯ä»¥è°ƒç”¨ update()ï¼Œä¼ å…¥ PreparedStatementCreator å’Œ KeyHolderï¼ˆåœ¨æœ¬ä¾‹ä¸­æ˜¯ GeneratedKeyHolder å®ä¾‹ï¼‰ã€‚update() å®Œæˆåï¼Œå¯ä»¥é€šè¿‡è¿”å› keyHolder.getKey().longValue() æ¥è¿”å› Taco idã€‚</p>
<p>å›åˆ° save() æ–¹æ³•ï¼Œå¾ªç¯éå† Taco ä¸­çš„æ¯ä¸ªæˆåˆ†ï¼Œè°ƒç”¨ saveIngredientToTaco() æ–¹æ³•ã€‚saveIngredientToTaco() æ–¹æ³•ä½¿ç”¨æ›´ç®€å•çš„ update() å½¢å¼æ¥ä¿å­˜å¯¹ Taco_Ingredient è¡¨å¼•ç”¨ã€‚</p>
<p>TacoRepository å‰©ä¸‹æ‰€è¦åšçš„å°±æ˜¯å°†å®ƒæ³¨å…¥åˆ° DesignTacoController ä¸­ï¼Œå¹¶åœ¨ä¿å­˜ Taco æ—¶ä½¿ç”¨å®ƒã€‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ˜¾ç¤ºäº†æ³¨å…¥å­˜å‚¨åº“æ‰€éœ€çš„æ”¹å˜ã€‚</p>
<center>ç¨‹åºæ¸…å• 3.11 æ³¨å…¥å¹¶ä½¿ç”¨ TacoRepository</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/design&quot;)</span></span><br><span class="line"><span class="meta">@SessionAttributes(&quot;order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DesignTacoController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IngredientRepository ingredientRepo;</span><br><span class="line">    <span class="keyword">private</span> TacoRepository designRepo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DesignTacoController</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        IngredientRepository ingredientRepo,</span></span></span><br><span class="line"><span class="params"><span class="function">        TacoRepository designRepo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ingredientRepo = ingredientRepo;</span><br><span class="line">        <span class="keyword">this</span>.designRepo = designRepo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ„é€ å‡½æ•°åŒ…å«ä¸€ä¸ª IngredientRepository å’Œä¸€ä¸ªTacoRepositoryã€‚å®ƒå°†è¿™ä¸¤ä¸ªå˜é‡éƒ½èµ‹å€¼ç»™å®ä¾‹å˜é‡ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥åœ¨ showDesignForm() å’Œ processDesign() æ–¹æ³•ä¸­ä½¿ç”¨ã€‚</p>
<p>è¯´åˆ° processDesign() æ–¹æ³•ï¼Œå®ƒçš„æ›´æ”¹æ¯” showDesignForm() æ‰€åšçš„æ›´æ”¹è¦å¹¿æ³›ä¸€äº›ã€‚ä¸‹ä¸€ä¸ªç¨‹åºæ¸…å•æ˜¾ç¤ºäº†æ–°çš„ processDesign() æ–¹æ³•ã€‚</p>
<center>ç¨‹åºæ¸…å• 3.12 ä¿å­˜ Taco è®¾è®¡å¹¶é“¾æ¥åˆ° Order</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/design&quot;)</span></span><br><span class="line"><span class="meta">@SessionAttributes(&quot;order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DesignTacoController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ModelAttribute(name = &quot;order&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Order <span class="title">order</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Order();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ModelAttribute(name = &quot;taco&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Taco <span class="title">taco</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Taco();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">processDesign</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="meta">@Valid</span> Taco design, Errors errors,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="meta">@ModelAttribute</span> Order order)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (errors.hasErrors()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;design&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Taco saved = designRepo.save(design);</span><br><span class="line">        order.addDesign(saved);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/orders/current&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ taco() æ–¹æ³•ä¸€æ ·ï¼Œorder() æ–¹æ³•ä¸Šçš„ @ModelAttribute æ³¨è§£ç¡®ä¿åœ¨æ¨¡å‹ä¸­èƒ½å¤Ÿåˆ›å»º Order å¯¹è±¡ã€‚</p>
<p>ç±»çº§åˆ«çš„ @SessionAttributes æ³¨è§£æŒ‡å®šäº†ä»»ä½•æ¨¡å‹å¯¹è±¡ï¼Œæ¯”å¦‚åº”è¯¥ä¿å­˜åœ¨ä¼šè¯ä¸­çš„ order å±æ€§ï¼Œå¹¶ä¸”å¯ä»¥è·¨å¤šä¸ªè¯·æ±‚ä½¿ç”¨ã€‚</p>
<p>taco è®¾è®¡çš„å®é™…å¤„ç†å‘ç”Ÿåœ¨ processDesign() æ–¹æ³•ä¸­ï¼Œé™¤äº† Taco å’Œ Errors å¯¹è±¡å¤–ï¼Œè¯¥æ–¹æ³•ç°åœ¨è¿˜æ¥å— Order å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚Order å‚æ•°ä½¿ç”¨ @ModelAttribute è¿›è¡Œæ³¨è§£ï¼Œä»¥æŒ‡ç¤ºå…¶å€¼åº”è¯¥æ¥è‡ªæ¨¡å‹ï¼Œè€Œ Spring MVC ä¸åº”è¯¥è¯•å›¾ç»™å®ƒç»‘å®šè¯·æ±‚å‚æ•°ã€‚</p>
<p>åœ¨æ£€æŸ¥éªŒè¯é”™è¯¯ä¹‹åï¼ŒprocessDesign() ä½¿ç”¨æ³¨å…¥çš„ TacoRepository æ¥ä¿å­˜ Tacoã€‚ç„¶åï¼Œå®ƒå°† Taco å¯¹è±¡æ·»åŠ åˆ°ä¿å­˜äº session ä¸­ Order å¯¹è±¡ä¸­ã€‚</p>
<p>å®é™…ä¸Šï¼ŒOrder å¯¹è±¡ä»ç„¶ä¿ç•™åœ¨ session ä¸­ï¼Œç›´åˆ°ç”¨æˆ·å®Œæˆå¹¶æäº¤ Order è¡¨å•æ‰ä¼šä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚æ­¤æ—¶ï¼ŒOrderController éœ€è¦è°ƒç”¨ OrderRepository çš„å®ç°æ¥ä¿å­˜è®¢å•ã€‚æˆ‘ä»¬æ¥å†™ä¸€ä¸‹è¿™ä¸ªå®ç°ã€‚</p>
<p><strong>ä½¿ç”¨ SimpleJdbcInsert æ’å…¥æ•°æ®</strong></p>
<p>ä¿å­˜ä¸€ä¸ª taco ä¸ä»…è¦å°† taco çš„åç§°å’Œåˆ›å»ºæ—¶é—´ä¿å­˜åˆ° Taco è¡¨ä¸­ï¼Œè¿˜è¦å°†ä¸ taco ç›¸å…³çš„é…æ–™çš„å¼•ç”¨ä¿å­˜åˆ° Taco_Ingredient è¡¨ä¸­ã€‚å¯¹äºè¿™ä¸ªæ“ä½œè¿˜éœ€è¦çŸ¥é“ Taco çš„ idï¼Œè¿™æ˜¯ä½¿ç”¨ KeyHolder å’Œ PreparedStatementCreator æ¥è·å¾—çš„ã€‚</p>
<p>åœ¨ä¿å­˜è®¢å•æ–¹é¢ï¼Œä¹Ÿå­˜åœ¨ç±»ä¼¼çš„æƒ…å†µã€‚ä¸ä»…å¿…é¡»å°†è®¢å•æ•°æ®ä¿å­˜åˆ° Taco_Order è¡¨ä¸­ï¼Œè¿˜å¿…é¡»å¼•ç”¨ Taco_Order_Tacos è¡¨ä¸­çš„æ¯ä¸ª tacoã€‚ä½†æ˜¯ä¸æ˜¯ä½¿ç”¨ç¹ççš„ PreparedStatementCreator, è€Œæ˜¯ä½¿ç”¨ SimpleJdbcInsertï¼Œ SimpleJdbcInsert æ˜¯ä¸€ä¸ªåŒ…è£…äº† JdbcTemplate çš„å¯¹è±¡ï¼Œå®ƒè®©å‘è¡¨æ’å…¥æ•°æ®çš„æ“ä½œå˜å¾—æ›´å®¹æ˜“ã€‚</p>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª JdbcOrderRepositoryï¼Œå®ƒæ˜¯ OrderRepository çš„ä¸€ä¸ªå®ç°ã€‚ä½†æ˜¯åœ¨ç¼–å†™ save() æ–¹æ³•å®ç°ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå…³æ³¨æ„é€ å‡½æ•°ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­ï¼Œå°†åˆ›å»ºä¸¤ä¸ª SimpleJdbcInsert å®ä¾‹ï¼Œç”¨äºå°†å€¼æ’å…¥ Taco_Order å’Œ Taco_Order_Tacos è¡¨ä¸­ã€‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ˜¾ç¤ºäº† JdbcOrderRepositoryï¼ˆæ²¡æœ‰ save() æ–¹æ³•ï¼‰ã€‚</p>
<center>ç¨‹åºæ¸…å• 3.13 ä» JdbcTemplate åˆ›å»ºä¸€ä¸ª SimpleJdbcTemplate</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.simple.SimpleJdbcInsert;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tacos.Taco;</span><br><span class="line"><span class="keyword">import</span> tacos.Order;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcOrderRepository</span> <span class="keyword">implements</span> <span class="title">OrderRepository</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SimpleJdbcInsert orderInserter;</span><br><span class="line">    <span class="keyword">private</span> SimpleJdbcInsert orderTacoInserter;</span><br><span class="line">    <span class="keyword">private</span> ObjectMapper objectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JdbcOrderRepository</span><span class="params">(JdbcTemplate jdbc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderInserter = <span class="keyword">new</span> SimpleJdbcInsert(jdbc)</span><br><span class="line">            .withTableName(<span class="string">&quot;Taco_Order&quot;</span>)</span><br><span class="line">            .usingGeneratedKeyColumns(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.orderTacoInserter = <span class="keyword">new</span> SimpleJdbcInsert(jdbc)</span><br><span class="line">            .withTableName(<span class="string">&quot;Taco_Order_Tacos&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ JdbcTacoRepository ä¸€æ ·ï¼ŒJdbcOrderRepository ä¹Ÿé€šè¿‡å…¶æ„é€ å‡½æ•°æ³¨å…¥äº† JdbcTemplateã€‚ä½†æ˜¯ï¼Œæ„é€ å‡½æ•°å¹¶æ²¡æœ‰å°† JdbcTemplate ç›´æ¥åˆ†é…ç»™ä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œè€Œæ˜¯ä½¿ç”¨å®ƒæ¥æ„é€ ä¸¤ä¸ª SimpleJdbcInsert å®ä¾‹ã€‚</p>
<p>ç¬¬ä¸€ä¸ªå®ä¾‹è¢«åˆ†é…ç»™ orderInserter å®ä¾‹å˜é‡ï¼Œå®ƒè¢«é…ç½®ä¸ºä½¿ç”¨ Taco_Order è¡¨ï¼Œå¹¶å‡å®š id å±æ€§å°†ç”±æ•°æ®åº“æä¾›æˆ–ç”Ÿæˆã€‚åˆ†é…ç»™ orderTacoInserter çš„ç¬¬äºŒä¸ªå®ä¾‹è¢«é…ç½®ä¸ºä½¿ç”¨ Taco_Order_Tacos è¡¨ï¼Œä½†æ˜¯æ²¡æœ‰å£°æ˜å¦‚ä½•åœ¨è¯¥è¡¨ä¸­ç”Ÿæˆä»»ä½• idã€‚</p>
<p>æ„é€ å‡½æ•°è¿˜åˆ›å»º ObjectMapper å®ä¾‹ï¼Œå¹¶å°†å…¶åˆ†é…ç»™å®ä¾‹å˜é‡ã€‚å°½ç®¡ Jackson ç”¨äº JSON å¤„ç†ï¼Œä½†ç¨åå°†çœ‹åˆ°å¦‚ä½•é‡æ–°ä½¿ç”¨å®ƒæ¥å¸®åŠ©ä¿å­˜è®¢å•åŠå…¶å…³è”çš„ tacosã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ save() æ–¹æ³•å¦‚ä½•ä½¿ç”¨ SimpleJdbcInsert å®ä¾‹ã€‚ä¸‹ä¸€ä¸ªç¨‹åºæ¸…å•æ˜¾ç¤ºäº† save() æ–¹æ³•ï¼Œä»¥åŠå‡ ä¸ªç”¨äºå®é™…å·¥ä½œçš„ save() å§”æ‰˜çš„ç§æœ‰æ–¹æ³•ã€‚</p>
<center>ç¨‹åºæ¸…å• 3.14 ä½¿ç”¨ SimpleJdbcInsert æ’å…¥æ•°æ®</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Order <span class="title">save</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">    order.setPlacedAt(<span class="keyword">new</span> Date());</span><br><span class="line">    <span class="keyword">long</span> orderId = saveOrderDetails(order);</span><br><span class="line">    order.setId(orderId);</span><br><span class="line"></span><br><span class="line">    List&lt;Taco&gt; tacos = order.getTacos();</span><br><span class="line">    <span class="keyword">for</span> (Taco taco : tacos) &#123;</span><br><span class="line">        saveTacoToOrder(taco, orderId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> order;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">long</span> <span class="title">saveOrderDetails</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    Map&lt;String, Object&gt; values = objectMapper.convertValue(order, Map.class);</span><br><span class="line">    values.put(<span class="string">&quot;placedAt&quot;</span>, order.getPlacedAt());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> orderId = orderInserter.executeAndReturnKey(values).longValue();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> orderId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveTacoToOrder</span><span class="params">(Taco taco, <span class="keyword">long</span> orderId)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; values = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    values.put(<span class="string">&quot;tacoOrder&quot;</span>, orderId);</span><br><span class="line">    values.put(<span class="string">&quot;taco&quot;</span>, taco.getId());</span><br><span class="line"></span><br><span class="line">    orderTacoInserter.execute(values);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>save() æ–¹æ³•å®é™…ä¸Šå¹¶ä¸ä¿å­˜ä»»ä½•ä¸œè¥¿ã€‚å®ƒå®šä¹‰äº†ä¿å­˜è®¢å•åŠå…¶å…³è” Taco å¯¹è±¡çš„æµï¼Œå¹¶å°†æŒä¹…æ€§å·¥ä½œå§”æ‰˜ç»™ saveOrderDetails() å’Œ saveTacoToOrder()ã€‚</p>
<p>SimpleJdbcInsert æœ‰ä¸¤ä¸ªæ‰§è¡Œæ’å…¥çš„æœ‰ç”¨æ–¹æ³•ï¼šexecute() å’Œ executeAndReturnKey()ã€‚ä¸¤è€…éƒ½æ¥å— Map&lt;String, Object&gt;ï¼Œå…¶ä¸­ Map é”®å¯¹åº”äºæ•°æ®æ’å…¥çš„è¡¨ä¸­çš„åˆ—åï¼Œæ˜ å°„çš„å€¼è¢«æ’å…¥åˆ°è¿™äº›åˆ—ä¸­ã€‚</p>
<p>é€šè¿‡å°† Order ä¸­çš„å€¼å¤åˆ¶åˆ° Map çš„æ¡ç›®ä¸­ï¼Œå¾ˆå®¹æ˜“åˆ›å»ºè¿™æ ·çš„ Mapã€‚ä½†æ˜¯ Order æœ‰å‡ ä¸ªå±æ€§ï¼Œè¿™äº›å±æ€§å’Œå®ƒä»¬è¦è¿›å…¥çš„åˆ—æœ‰ç›¸åŒçš„åå­—ã€‚å› æ­¤ï¼Œåœ¨ saveOrderDetails() ä¸­ï¼Œæˆ‘å†³å®šä½¿ç”¨ Jackson çš„ ObjectMapper åŠå…¶ convertValue() æ–¹æ³•å°† Order è½¬æ¢ä¸º Mapã€‚è¿™æ˜¯å¿…è¦çš„ï¼Œå¦åˆ™ ObjectMapper ä¼šå°† Date å±æ€§è½¬æ¢ä¸º longï¼Œè¿™ä¸ Taco_Order è¡¨ä¸­çš„ placedAt å­—æ®µä¸å…¼å®¹ã€‚</p>
<p>éšç€ Map ä¸­å¡«å……å®Œæˆè®¢å•æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ orderInserter ä¸Šè°ƒç”¨ executeAndReturnKey() æ–¹æ³•äº†ã€‚è¿™ä¼šå°†è®¢å•ä¿¡æ¯ä¿å­˜åˆ° Taco_Order è¡¨ä¸­ï¼Œå¹¶å°†æ•°æ®åº“ç”Ÿæˆçš„ id ä½œä¸ºä¸€ä¸ª Number å¯¹è±¡è¿”å›ï¼Œè°ƒç”¨ longValue() æ–¹æ³•å°†å…¶è½¬æ¢ä¸ºä»æ–¹æ³•è¿”å›çš„ long å€¼ã€‚</p>
<p>saveTacoToOrder() æ–¹æ³•è¦ç®€å•å¾—å¤šã€‚ä¸æ˜¯ä½¿ç”¨ ObjectMapper å°†å¯¹è±¡è½¬æ¢ä¸º Mapï¼Œè€Œæ˜¯åˆ›å»º Map å¹¶è®¾ç½®é€‚å½“çš„å€¼ã€‚åŒæ ·ï¼Œæ˜ å°„é”®å¯¹åº”äºè¡¨ä¸­çš„åˆ—åã€‚å¯¹ orderTacoInserter çš„ execute() æ–¹æ³•çš„ç®€å•è°ƒç”¨å°±èƒ½æ‰§è¡Œæ’å…¥æ“ä½œã€‚</p>
<p>ç°åœ¨å¯ä»¥å°† OrderRepository æ³¨å…¥åˆ° OrderController ä¸­å¹¶å¼€å§‹ä½¿ç”¨å®ƒã€‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ˜¾ç¤ºäº†å®Œæ•´çš„ OrderControllerï¼ŒåŒ…æ‹¬å› ä½¿ç”¨æ³¨å…¥çš„ OrderRepository è€Œåšçš„æ›´æ”¹ã€‚</p>
<center>ç¨‹åºæ¸…å• 3.15 åœ¨ OrderController ä¸­ä½¿ç”¨ OrderRepository</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.Errors;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.SessionAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.support.SessionStatus;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tacos.Order;</span><br><span class="line"><span class="keyword">import</span> tacos.data.OrderRepository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/orders&quot;)</span></span><br><span class="line"><span class="meta">@SessionAttributes(&quot;order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> OrderRepository orderRepo;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OrderController</span><span class="params">(OrderRepository orderRepo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderRepo = orderRepo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/current&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">orderForm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;orderForm&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">processOrder</span><span class="params">(<span class="meta">@Valid</span> Order order, Errors errors,</span></span></span><br><span class="line"><span class="params"><span class="function">                               SessionStatus sessionStatus)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (errors.hasErrors()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;orderForm&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        orderRepo.save(order);</span><br><span class="line">        sessionStatus.setComplete();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†å°† OrderRepository æ³¨å…¥æ§åˆ¶å™¨ä¹‹å¤–ï¼ŒOrderController ä¸­æƒŸä¸€é‡è¦çš„æ›´æ”¹æ˜¯ processOrder() æ–¹æ³•ã€‚åœ¨è¿™é‡Œï¼Œè¡¨å•ä¸­æäº¤çš„ Order å¯¹è±¡ï¼ˆæ°å¥½ä¹Ÿæ˜¯åœ¨ session ä¸­ç»´æŠ¤çš„ Order å¯¹è±¡ï¼‰é€šè¿‡æ³¨å…¥çš„ OrderRepository ä¸Šçš„ save() æ–¹æ³•ä¿å­˜ã€‚</p>
<p>ä¸€æ—¦è®¢å•è¢«ä¿å­˜ï¼Œå°±ä¸å†éœ€è¦å®ƒå­˜åœ¨äº session ä¸­äº†ã€‚äº‹å®ä¸Šï¼Œå¦‚æœä¸æ¸…é™¤å®ƒï¼Œè®¢å•å°†ä¿æŒåœ¨ session ä¸­ï¼ŒåŒ…æ‹¬å…¶å…³è”çš„ tacosï¼Œä¸‹ä¸€ä¸ªè®¢å•å°†ä»æ—§è®¢å•ä¸­åŒ…å«çš„ä»»ä½• tacos å¼€å§‹ã€‚å› æ­¤éœ€è¦ processOrder() æ–¹æ³•è¯·æ±‚ SessionStatus å‚æ•°å¹¶è°ƒç”¨å…¶ setComplete() æ–¹æ³•æ¥é‡ç½®ä¼šè¯ã€‚</p>
<p>æ‰€æœ‰çš„ JDBC æŒä¹…åŒ–ä»£ç éƒ½å‡†å¤‡å¥½äº†ã€‚ç°åœ¨ï¼Œå¯ä»¥å¯åŠ¨ Taco Cloud åº”ç”¨ç¨‹åºå¹¶è¿›è¡Œæµ‹è¯•ã€‚ä½ æƒ³è¦å¤šå°‘ tacos å’Œå¤šå°‘ orders éƒ½å¯ä»¥ã€‚</p>
<p>å¯èƒ½è¿˜ä¼šå‘ç°åœ¨æ•°æ®åº“ä¸­è¿›è¡ŒæŒ–æ˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚å› ä¸ºä½¿ç”¨ H2 ä½œä¸ºåµŒå…¥å¼æ•°æ®åº“ï¼Œè€Œä¸” Spring Boot DevTools å·²ç»å°±ä½ï¼Œæ‰€ä»¥åº”è¯¥èƒ½å¤Ÿç”¨æµè§ˆå™¨è®¿é—® <a target="_blank" rel="noopener" href="http://localhost:8080/h2-console">http://localhost:8080/h2-console</a> æ¥æŸ¥çœ‹ H2 æ§åˆ¶å°ã€‚è™½ç„¶éœ€è¦ç¡®ä¿ JDBC URL å­—æ®µè¢«è®¾ç½®ä¸º JDBC:h2:mem:testdbï¼Œä½†æ˜¯é»˜è®¤çš„å‡­è¯åº”è¯¥å¯ä»¥è®©ä½ è¿›å…¥ã€‚ç™»å½•åï¼Œåº”è¯¥èƒ½å¤Ÿå¯¹ Taco Cloud æ¨¡å¼ä¸­çš„è¡¨å‘èµ·æŸ¥è¯¢ã€‚</p>
<p>Spring çš„ JdbcTemplate å’Œ SimpleJdbcInsert ä½¿å¾—ä½¿ç”¨å…³ç³»æ•°æ®åº“æ¯”æ™®é€š JDBC ç®€å•å¾—å¤šã€‚ä½†æ˜¯å¯èƒ½ä¼šå‘ç° JPA ä½¿å®ƒæ›´åŠ ç®€å•ã€‚è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ä¹‹å‰çš„å·¥ä½œï¼Œçœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Spring æ•°æ®ä½¿æ•°æ®æŒä¹…åŒ–æ›´åŠ å®¹æ˜“ã€‚</p>
<h3 id="ä½¿ç”¨-Spring-Data-JPA-æŒä¹…åŒ–æ•°æ®"><a href="#ä½¿ç”¨-Spring-Data-JPA-æŒä¹…åŒ–æ•°æ®" class="headerlink" title="ä½¿ç”¨ Spring Data JPA æŒä¹…åŒ–æ•°æ®"></a>ä½¿ç”¨ Spring Data JPA æŒä¹…åŒ–æ•°æ®</h3><p>Spring Data é¡¹ç›®æ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„ä¼å½¢é¡¹ç›®ï¼Œå‡ ä¸ªå­é¡¹ç›®ç»„æˆï¼Œå…¶ä¸­å¤§å¤šæ•°å­é¡¹ç›®å…³æ³¨äºå…·æœ‰å„ç§ä¸åŒæ•°æ®åº“ç±»å‹çš„æ•°æ®æŒä¹…åŒ–ã€‚ä¸€äº›æœ€æµè¡Œçš„ Spring æ•°æ®é¡¹ç›®åŒ…æ‹¬ï¼š</p>
<ul>
<li><em>Spring Data JPA</em> - é’ˆå¯¹å…³ç³»æ•°æ®åº“çš„æŒä¹…åŒ–</li>
<li><em>Spring Data Mongo</em> - é’ˆå¯¹ Mongo æ–‡æ¡£æ•°æ®åº“çš„æŒä¹…åŒ–</li>
<li><em>Spring Data Neo4j</em> - é’ˆå¯¹ Neo4j å›¾å½¢æ•°æ®åº“çš„æŒä¹…åŒ–</li>
<li><em>Spring Data Redis</em> - é’ˆå¯¹ Redis é”®å€¼å­˜å‚¨çš„æŒä¹…åŒ–</li>
<li><em>Spring Data Cassandra</em> - é’ˆå¯¹ Cassandra æ•°æ®åº“çš„æŒä¹…åŒ–</li>
</ul>
<p>Spring Data ä¸ºæ‰€æœ‰è¿™äº›é¡¹ç›®æä¾›çš„æœ€æœ‰æ„æ€å’Œæœ€æœ‰ç”¨çš„ç‰¹æ€§ä¹‹ä¸€æ˜¯èƒ½å¤ŸåŸºäºå­˜å‚¨åº“è§„èŒƒæ¥å£è‡ªåŠ¨åˆ›å»ºå­˜å‚¨åº“ã€‚</p>
<h4 id="æ·»åŠ -Spring-Data-JPA-åˆ°æ•°æ®åº“ä¸­"><a href="#æ·»åŠ -Spring-Data-JPA-åˆ°æ•°æ®åº“ä¸­" class="headerlink" title="æ·»åŠ  Spring Data JPA åˆ°æ•°æ®åº“ä¸­"></a>æ·»åŠ  Spring Data JPA åˆ°æ•°æ®åº“ä¸­</h4><p>Spring Data JPA å¯ç”¨äºå…·æœ‰ JPA starter çš„ Spring Boot åº”ç”¨ç¨‹åºã€‚è¿™ä¸ª starter ä¾èµ–ä¸ä»…å¸¦æ¥äº† Spring Data JPAï¼Œè¿˜åŒ…æ‹¬ Hibernate ä½œä¸º JPA çš„å®ç°ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³ä½¿ç”¨ä¸åŒçš„ JPA å®ç°ï¼Œé‚£ä¹ˆè‡³å°‘éœ€è¦æ’é™¤ Hibernate ä¾èµ–ï¼Œå¹¶åŒ…å«æ‰€é€‰æ‹©çš„ JPA åº“ã€‚ä¾‹å¦‚ï¼Œè¦ä½¿ç”¨ EclipseLink è€Œä¸æ˜¯ Hibernateï¼Œéœ€è¦æŒ‰å¦‚ä¸‹æ–¹å¼æ›´æ”¹æ„å»ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-entitymanager<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.eclipse.persistence<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>eclipselink<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¯·æ³¨æ„ï¼Œæ ¹æ®å¯¹ JPA å®ç°çš„é€‰æ‹©ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œå…¶ä»–æ›´æ”¹ã€‚è¯¦ç»†ä¿¡æ¯è¯·å‚é˜…é€‰æ‹©çš„ JPA å®ç°çš„æ–‡æ¡£ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬é‡æ–°æŸ¥çœ‹åŸŸå¯¹è±¡å¹¶å¯¹å®ƒä»¬è¿›è¡Œæ³¨è§£ä»¥å®ç° JPA æŒä¹…åŒ–ã€‚</p>
<h4 id="æ³¨è§£åŸŸä½œä¸ºå®ä½“"><a href="#æ³¨è§£åŸŸä½œä¸ºå®ä½“" class="headerlink" title="æ³¨è§£åŸŸä½œä¸ºå®ä½“"></a>æ³¨è§£åŸŸä½œä¸ºå®ä½“</h4><center>ç¨‹åºæ¸…å• 3.16 ä¸º JPA æŒä¹…åŒ–æ³¨è§£ Ingredient</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> lombok.AccessLevel;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor(access=AccessLevel.PRIVATE, force=true)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ingredient</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Type type;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">enum</span> <span class="title">Type</span> </span>&#123;</span><br><span class="line">        WRAP, PROTEIN, VEGGIES, CHEESE, SAUCE</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†å°†å…¶å£°æ˜ä¸º JPA å®ä½“ï¼Œå¿…é¡»ä½¿ç”¨ @Entity æ³¨è§£ã€‚å®ƒçš„ id å±æ€§å¿…é¡»ä½¿ç”¨ @Id è¿›è¡Œæ³¨è§£ï¼Œä»¥ä¾¿å°†å…¶æŒ‡å®šä¸ºæƒŸä¸€æ ‡è¯†æ•°æ®åº“ä¸­å®ä½“çš„å±æ€§ã€‚</p>
<p>JPA è¦æ±‚å®ä½“æœ‰ä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥ Lombok çš„ @NoArgsConstructor å®ç°äº†è¿™ä¸€ç‚¹ã€‚ä½†æ˜¯è¦æ˜¯ä¸å¸Œæœ›ä½¿ç”¨å®ƒï¼Œå¯ä»¥é€šè¿‡å°† access å±æ€§è®¾ç½®ä¸º AccessLevel.PRIVATE æ¥å°†å…¶è®¾ç½®ä¸ºç§æœ‰ã€‚å› ä¸ºå¿…é¡»è®¾ç½® final å±æ€§ï¼Œæ‰€ä»¥è¿˜è¦å°† force å±æ€§è®¾ç½®ä¸º trueï¼Œè¿™å°†å¯¼è‡´ Lombok ç”Ÿæˆçš„æ„é€ å‡½æ•°å°†å®ƒä»¬è®¾ç½®ä¸º nullã€‚</p>
<p>@Data éšå¼åœ°æ·»åŠ äº†ä¸€ä¸ªå¿…éœ€çš„æœ‰å‚æ„é€ å‡½æ•°ï¼Œä½†æ˜¯å½“ä½¿ç”¨ @NoArgsConstructor æ—¶ï¼Œè¯¥æ„é€ å‡½æ•°å°†è¢«åˆ é™¤ã€‚æ˜¾å¼çš„ @RequiredArgsConstructor ç¡®ä¿é™¤äº†ç§æœ‰æ— å‚æ•°æ„é€ å‡½æ•°å¤–ï¼Œä»ç„¶æœ‰ä¸€ä¸ªå¿…éœ€æœ‰å‚æ„é€ å‡½æ•°ã€‚</p>
<center>ç¨‹åºæ¸…å• 3.17 æŠŠ Taco æ³¨è§£ä¸ºå®ä½“</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.ManyToMany;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.OneToMany;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.PrePersist;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Taco</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy=GenerationType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Size(min=5, message=&quot;Name must be at least 5 characters long&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Date createdAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ManyToMany(targetEntity=Ingredient.class)</span></span><br><span class="line">    <span class="meta">@Size(min=1, message=&quot;You must choose at least 1 ingredient&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Ingredient&gt; ingredients;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PrePersist</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">createdAt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createdAt = <span class="keyword">new</span> Date();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ Ingredient ä¸€æ ·ï¼ŒTaco ç±»ç°åœ¨ä½¿ç”¨ @Entity æ³¨è§£ï¼Œå…¶ id å±æ€§ä½¿ç”¨ @Id æ³¨è§£ã€‚å› ä¸ºä¾èµ–äºæ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆ id å€¼ï¼Œæ‰€ä»¥è¿˜ä½¿ç”¨ @GeneratedValue æ³¨è§£ id å±æ€§ï¼ŒæŒ‡å®šè‡ªåŠ¨ç­–ç•¥ã€‚</p>
<p>è¦å£°æ˜ Taco åŠå…¶ç›¸å…³ Ingredient åˆ—è¡¨ä¹‹é—´çš„å…³ç³»ï¼Œå¯ä»¥ä½¿ç”¨ @ManyToMany æ³¨è§£ ingredient å±æ€§ã€‚ä¸€ä¸ª Taco å¯ä»¥æœ‰å¾ˆå¤š Ingredientï¼Œä¸€ä¸ª Ingredient å¯ä»¥æ˜¯å¾ˆå¤š Taco çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªæ–°æ–¹æ³• createdAt()ï¼Œå®ƒç”¨ @PrePersist æ³¨è§£ã€‚å°†ä½¿ç”¨å®ƒå°† createdAt å±æ€§è®¾ç½®ä¸ºä¿å­˜ Taco ä¹‹å‰çš„å½“å‰æ—¥æœŸå’Œæ—¶é—´ã€‚</p>
<center>ç¨‹åºæ¸…å• 3.18 æŠŠ Order æ³¨è§£ä¸º JPA å®ä½“</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.ManyToMany;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.OneToMany;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.PrePersist;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Digits;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Pattern;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.CreditCardNumber;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name=&quot;Taco_Order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy=GenerationType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Date placedAt;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ManyToMany(targetEntity=Taco.class)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Taco&gt; tacos = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addDesign</span><span class="params">(Taco design)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tacos.add(design);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PrePersist</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">placedAt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.placedAt = <span class="keyword">new</span> Date();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Tableæ³¨è§£æŒ‡å®šè®¢å•å®ä½“åº”è¯¥æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­åä¸º Taco_Order çš„è¡¨ä¸­ã€‚å°½ç®¡å¯ä»¥åœ¨ä»»ä½•å®ä½“ä¸Šä½¿ç”¨è¿™ä¸ªæ³¨è§£ï¼Œä½†å®ƒå¯¹äº Order æ˜¯å¿…éœ€çš„ã€‚æ²¡æœ‰å®ƒï¼ŒJPA å°†é»˜è®¤å°†å®ä½“æŒä¹…åŒ–åˆ°ä¸€ä¸ªåä¸º Order çš„è¡¨ä¸­ï¼Œä½†æ˜¯ Order åœ¨ SQL ä¸­æ˜¯ä¸€ä¸ªä¿ç•™å­—ï¼Œä¼šå¯¼è‡´é—®é¢˜ã€‚ç°åœ¨å®ä½“å·²ç»å¾—åˆ°äº†æ­£ç¡®çš„æ³¨è§£ï¼Œè¯¥ç¼–å†™ repository äº†ã€‚</p>
<h4 id="å£°æ˜-JPA-repository"><a href="#å£°æ˜-JPA-repository" class="headerlink" title="å£°æ˜ JPA repository"></a>å£°æ˜ JPA repository</h4><p>åœ¨å­˜å‚¨åº“çš„ JDBC ç‰ˆæœ¬ä¸­ï¼Œæ˜¾å¼åœ°å£°æ˜äº†å¸Œæœ› repository æä¾›çš„æ–¹æ³•ã€‚ä½†æ˜¯ä½¿ç”¨ Spring Dataï¼Œæ‰©å±• CrudRepository æ¥å£ã€‚ä¾‹å¦‚ï¼Œè¿™æ˜¯ä¸€ä¸ªæ–°çš„ IngredientRepository æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.CrudRepository;</span><br><span class="line"><span class="keyword">import</span> tacos.Ingredient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IngredientRepository</span> <span class="keyword">extends</span> <span class="title">CrudRepository</span>&lt;<span class="title">Ingredient</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CrudRepository ä¸º CRUDï¼ˆåˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ï¼‰æ“ä½œå£°æ˜äº†åå‡ ä¸ªæ–¹æ³•ã€‚æ³¨æ„ï¼Œå®ƒæ˜¯å‚æ•°åŒ–çš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­˜å‚¨åº“è¦æŒä¹…åŒ–çš„å®ä½“ç±»å‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å®ä½“ id å±æ€§çš„ç±»å‹ã€‚å¯¹äº IngredientRepositoryï¼Œå‚æ•°åº”è¯¥æ˜¯ Ingredient å’Œ String ç±»å‹ã€‚</p>
<p>ä¹Ÿå¯ä»¥è¿™æ ·å®šä¹‰ TacoRepositoryï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.CrudRepository;</span><br><span class="line"><span class="keyword">import</span> tacos.Taco;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TacoRepository</span> <span class="keyword">extends</span> <span class="title">CrudRepository</span>&lt;<span class="title">Taco</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>IngredientRepository å’Œ TacoRepository ä¹‹é—´å”¯ä¸€æ˜¾è‘—çš„åŒºåˆ«æ˜¯å¯¹äº CrudRepository çš„å‚æ•°ä¸åŒã€‚åœ¨è¿™é‡Œï¼Œå®ƒä»¬è¢«è®¾ç½®ä¸º Taco å’Œ Long å»æŒ‡å®š Taco å®ä½“ï¼ˆåŠå…¶ id ç±»å‹ï¼‰ä½œä¸ºè¿™ä¸ª respository æ¥å£çš„æŒä¹…åŒ–å•å…ƒã€‚æœ€åï¼ŒåŒæ ·çš„æ›´æ”¹å¯ä»¥åº”ç”¨åˆ° OrderRepositoryï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.CrudRepository;</span><br><span class="line"><span class="keyword">import</span> tacos.Order;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderRepository</span> <span class="keyword">extends</span> <span class="title">CrudRepository</span>&lt;<span class="title">Order</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æœ‰äº†è¿™ä¸‰ä¸ª repositoryï¼Œå¯èƒ½è®¤ä¸ºéœ€è¦ä¸ºè¿™ä¸‰ä¸ª repository ç¼–å†™å®ç°ï¼Œè¿˜åŒ…æ‹¬æ¯ç§å®ç°çš„åå‡ ä¸ªæ–¹æ³•ã€‚ä½†è¿™å°±æ˜¯ Spring Data JPA ä¼˜ç§€çš„åœ°æ–¹ â€”â€” ä¸éœ€è¦ç¼–å†™å®ç°ï¼å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼ŒSpring Data JPA ä¼šåŠ¨æ€åœ°è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå®ç°ã€‚è¿™æ„å‘³ç€ repository å¯ä»¥ä»ä¸€å¼€å§‹å°±ä½¿ç”¨ã€‚åªéœ€å°†å®ƒä»¬æ³¨å…¥åˆ°æ§åˆ¶å™¨ä¸­ï¼Œå°±åƒåœ¨åŸºäº JDBC çš„å®ç°ä¸­æ‰€åšçš„é‚£æ ·ã€‚</p>
<p>CrudRepository æä¾›çš„æ–¹æ³•éå¸¸é€‚åˆç”¨äºå®ä½“çš„é€šç”¨æŒä¹…åŒ–ã€‚ä½†æ˜¯å¦‚æœæœ‰ä¸€äº›åŸºæœ¬æŒä¹…åŒ–ä¹‹å¤–çš„éœ€æ±‚å‘¢ï¼Ÿè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•è‡ªå®šä¹‰ repository æ¥æ‰§è¡ŒåŸŸç‰¹æœ‰çš„æŸ¥è¯¢ã€‚</p>
<h4 id="è‡ªå®šä¹‰-JPA-repository"><a href="#è‡ªå®šä¹‰-JPA-repository" class="headerlink" title="è‡ªå®šä¹‰ JPA repository"></a>è‡ªå®šä¹‰ JPA repository</h4><p>æƒ³è±¡ä¸€ä¸‹ï¼Œé™¤äº† CrudRepository æä¾›çš„åŸºæœ¬ CRUD æ“ä½œä¹‹å¤–ï¼Œè¿˜éœ€è¦è·å–æŠ•é€’ç»™æŒ‡å®šé‚®æ”¿ç¼–ç çš„æ‰€æœ‰è®¢å•ã€‚äº‹å®è¯æ˜ï¼Œé€šè¿‡åœ¨ OrderRepository ä¸­æ·»åŠ ä»¥ä¸‹æ–¹æ³•å£°æ˜å¯ä»¥å¾ˆå®¹æ˜“åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Order&gt; <span class="title">findByDeliveryZip</span><span class="params">(String deliveryZip)</span></span>;</span><br></pre></td></tr></table></figure>

<p>åœ¨ç”Ÿæˆ repository å®ç°æ—¶ï¼ŒSpring Data æ£€æŸ¥å­˜å‚¨åº“æ¥å£ä¸­çš„ä»»ä½•æ–¹æ³•ï¼Œè§£ææ–¹æ³•åç§°ï¼Œå¹¶å°è¯•åœ¨æŒä¹…åŒ–å¯¹è±¡çš„ä¸Šä¸‹æ–‡ä¸­ç†è§£æ–¹æ³•çš„ç”¨é€”ï¼ˆåœ¨æœ¬ä¾‹ä¸­æ˜¯ Orderï¼‰ã€‚æœ¬è´¨ä¸Šï¼ŒSpring Data å®šä¹‰äº†ä¸€ç§å°å‹çš„é¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆDSLï¼‰ï¼Œå…¶ä¸­æŒä¹…åŒ–ç»†èŠ‚ç”¨ repository ä¸­çš„æ–¹æ³•ç­¾åè¡¨ç¤ºã€‚</p>
<p>Spring Data çŸ¥é“è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥æŸ¥æ‰¾è®¢å•çš„ï¼Œå› ä¸ºå·²ç»ç”¨ Order å‚æ•°åŒ–äº† CrudRepositoryã€‚æ–¹æ³•å findByDeliveryZip() è¡¨æ˜ï¼Œè¯¥æ–¹æ³•åº”è¯¥é€šè¿‡å°†å…¶ deliveryZip å±æ€§ä¸ä½œä¸ºå‚æ•°ï¼Œä¼ é€’ç»™åŒ¹é…çš„æ–¹æ³•æ¥æŸ¥æ‰¾æ‰€æœ‰è®¢å•å®ä½“ã€‚</p>
<p>findByDeliveryZip() æ–¹æ³•éå¸¸ç®€å•ï¼Œä½†æ˜¯ Spring Data ä¹Ÿå¯ä»¥å¤„ç†æ›´æœ‰è¶£çš„æ–¹æ³•åã€‚repository çš„æ–¹æ³•ç”±ä¸€ä¸ªåŠ¨è¯ã€ä¸€ä¸ªå¯é€‰çš„ä¸»è¯­ã€å•è¯ <em>by</em> å’Œä¸€ä¸ªè°“è¯ç»„æˆã€‚åœ¨ findByDeliveryZip() ä¸­ï¼ŒåŠ¨è¯æ˜¯ <em>find</em>ï¼Œè°“è¯æ˜¯ <em>DeliveryZip</em>ï¼Œä¸»è¯­æ²¡æœ‰æŒ‡å®šï¼Œæš—ç¤ºæ˜¯ä¸€ä¸ª Orderã€‚</p>
<p>è®©æˆ‘ä»¬è€ƒè™‘å¦ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­ã€‚å‡è®¾éœ€è¦æŸ¥è¯¢åœ¨ç»™å®šæ—¥æœŸèŒƒå›´å†…æŠ•é€’ç»™æŒ‡å®šé‚®æ”¿ç¼–ç çš„æ‰€æœ‰è®¢å•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“æ·»åŠ åˆ° OrderRepository æ—¶ï¼Œä¸‹é¢çš„æ–¹æ³•å¯èƒ½ä¼šè¢«è¯æ˜æ˜¯æœ‰ç”¨çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Order&gt; <span class="title">readOrdersByDeliveryZipAndPlacedAtBetween</span><span class="params">(String deliveryZip, Date startDate, Date endDate)</span></span>;</span><br></pre></td></tr></table></figure>

<p>å›¾ 3.2 è¯´æ˜äº†åœ¨ç”Ÿæˆ respository å®ç°æ—¶ï¼ŒSpring Data å¦‚ä½•è§£æå’Œç†è§£ readOrdersByDeliveryZipAndPlacedAtBetween() æ–¹æ³•ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒreadOrdersByDeliveryZipAndPlacedAtBetween() ä¸­çš„åŠ¨è¯æ˜¯ readã€‚Spring Data è¿˜å°† findã€read å’Œ get ç†è§£ä¸ºè·å–ä¸€ä¸ªæˆ–å¤šä¸ªå®ä½“çš„åŒä¹‰è¯ã€‚å¦å¤–ï¼Œå¦‚æœåªå¸Œæœ›æ–¹æ³•è¿”å›ä¸€ä¸ªå¸¦æœ‰åŒ¹é…å®ä½“è®¡æ•°çš„ intï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ count ä½œä¸ºåŠ¨è¯ã€‚</p>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-Lrx45VtnV-WCQ6BGPcV%252F-Lrx4s9aWepQvbvNLzld%252F%E5%9B%BE%203.2.jpg" alt="img"></p>
<center>å›¾ 3.2 Spring Data è§£æ repository æ–¹æ³•ç‰¹å¾æ¥ç¡®å®šå¦‚ä½•è¿è¡ŒæŸ¥è¯¢è¯­å¥</center>

<p>å°½ç®¡è¯¥æ–¹æ³•çš„ä¸»è¯­æ˜¯å¯é€‰çš„ï¼Œä½†åœ¨è¿™é‡Œå®ƒè¡¨ç¤º Orderã€‚Spring Data ä¼šå¿½ç•¥ä¸»é¢˜ä¸­çš„å¤§å¤šæ•°å•è¯ï¼Œå› æ­¤å¯ä»¥å°†æ–¹æ³•å‘½åä¸º readPuppiesByâ€¦å®ƒä»ç„¶å¯ä»¥æ‰¾åˆ° Order å®ä½“ï¼Œå› ä¸ºè¿™æ˜¯ CrudRepository å‚æ•°åŒ–çš„ç±»å‹ã€‚</p>
<p>è°“è¯è·Ÿåœ¨æ–¹æ³•åä¸­çš„ By åé¢ï¼Œæ˜¯æ–¹æ³•ç­¾åä¸­æœ€æœ‰è¶£çš„éƒ¨åˆ†ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè°“è¯å¼•ç”¨ä¸¤ä¸ª Orderå±æ€§ï¼šdeliveryZip å’Œ placedAtã€‚deliveryZip å±æ€§å¿…é¡»ä¸ä¼ é€’ç»™æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ä¸€è‡´ã€‚Between å…³é”®å­—è¡¨ç¤º deliveryZip çš„å€¼å¿…é¡»ä½äºä¼ å…¥æ–¹æ³•æœ€åä¸¤ä¸ªå‚æ•°çš„å€¼ä¹‹é—´ã€‚</p>
<p>é™¤äº†ä¸€ä¸ªéšå¼çš„ Equals æ“ä½œå’Œ Between æ“ä½œå¤–ï¼ŒSpring Data æ–¹æ³•ç­¾åè¿˜å¯ä»¥åŒ…æ‹¬ä»¥ä¸‹ä»»ä½•æ“ä½œï¼š</p>
<ul>
<li>IsAfter, After, IsGreaterThan, GreaterThan</li>
<li>IsGreaterThanEqual, GreaterThanEqual</li>
<li>IsBefore, Before, IsLessThan, LessThan</li>
<li>IsLessThanEqual, LessThanEqual</li>
<li>IsBetween, Between</li>
<li>IsNull, Null</li>
<li>IsNotNull, NotNull</li>
<li>IsIn, In</li>
<li>IsNotIn, NotIn</li>
<li>IsStartingWith, StartingWith, StartsWith</li>
<li>IsEndingWith, EndingWith, EndsWith</li>
<li>IsContaining, Containing, Contains</li>
<li>IsLike, Like</li>
<li>IsNotLike, NotLike</li>
<li>IsTrue, True</li>
<li>IsFalse, False</li>
<li>Is, Equals</li>
<li>IsNot, Not</li>
<li>IgnoringCase, IgnoresCase</li>
</ul>
<p>ä½œä¸º IgnoringCase å’Œ IgnoresCase çš„æ›¿ä»£æ–¹æ³•ï¼Œå¯ä»¥åœ¨æ–¹æ³•ä¸Šæ”¾ç½® AllIgnoringCase æˆ– AllIgnoresCase æ¥å¿½ç•¥æ‰€æœ‰ String æ¯”è¾ƒçš„å¤§å°å†™ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Order&gt; <span class="title">findByDeliveryToAndDeliveryCityAllIgnoresCase</span><span class="params">(String deliveryTo, String deliveryCity)</span></span>;</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œè¿˜å¯ä»¥å°† OrderBy æ”¾åœ¨æ–¹æ³•åçš„æœ«å°¾ï¼Œä»¥ä¾¿æ ¹æ®æŒ‡å®šçš„åˆ—å¯¹ç»“æœè¿›è¡Œæ’åºã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ deliveryTo å±æ€§æ¥è®¢è´­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Order&gt; <span class="title">findByDeliveryCityOrderByDeliveryTo</span><span class="params">(String city)</span></span>;</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶å‘½åçº¦å®šå¯¹äºç›¸å¯¹ç®€å•çš„æŸ¥è¯¢å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯å¯¹äºæ›´å¤æ‚çš„æŸ¥è¯¢ï¼Œä¸éœ€è¦å¤ªå¤šçš„æƒ³è±¡å°±å¯ä»¥çœ‹å‡ºæ–¹æ³•åç§°å¯èƒ½ä¼šå¤±æ§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥éšæ„å°†æ–¹æ³•å‘½åä¸ºä»»ä½•æƒ³è¦çš„åç§°ï¼Œå¹¶ä½¿ç”¨ @Query å¯¹å…¶è¿›è¡Œæ³¨è§£ï¼Œä»¥æ˜¾å¼åœ°æŒ‡å®šè°ƒç”¨æ–¹æ³•æ—¶è¦æ‰§è¡Œçš„æŸ¥è¯¢ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;Order o where o.deliveryCity=&#x27;Seattle&#x27;&quot;)</span></span><br><span class="line"><span class="function">List&lt;Order&gt; <span class="title">readOrdersDeliveredInSeattle</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ª @Query çš„ç®€å•ç”¨æ³•ä¸­ï¼Œè¯·æ±‚åœ¨è¥¿é›…å›¾äº¤ä»˜çš„æ‰€æœ‰è®¢å•ã€‚ä½†æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨ @Query æ¥æ‰§è¡Œå‡ ä¹ä»»ä½•æƒ³è¦çš„æŸ¥è¯¢ï¼Œå³ä½¿é€šè¿‡éµå¾ªå‘½åçº¦å®šæ¥å®ç°æŸ¥è¯¢å¾ˆå›°éš¾æˆ–ä¸å¯èƒ½ã€‚</p>
<h3 id="å°ç»“-2"><a href="#å°ç»“-2" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ul>
<li>JdbcTemplate å¤§å¤§ç®€åŒ–äº† JDBC çš„å·¥ä½œã€‚</li>
<li>å½“éœ€è¦çŸ¥é“æ•°æ®åº“ç”Ÿæˆçš„ id æ—¶ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨ PreparedStatementCreator å’Œ KeyHolderã€‚</li>
<li>ä¸ºäº†æ–¹ä¾¿æ‰§è¡Œæ•°æ®æ’å…¥ï¼Œä½¿ç”¨ SimpleJdbcInsertã€‚</li>
<li>Spring Data JPA ä½¿å¾— JPA æŒä¹…åŒ–å°±åƒç¼–å†™å­˜å‚¨åº“æ¥å£ä¸€æ ·ç®€å•ã€‚</li>
</ul>
<h2 id="ç¬¬-4-ç« -Spring-å®‰å…¨"><a href="#ç¬¬-4-ç« -Spring-å®‰å…¨" class="headerlink" title="ç¬¬ 4 ç«  Spring å®‰å…¨"></a>ç¬¬ 4 ç«  Spring å®‰å…¨</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>è‡ªåŠ¨é…ç½® Spring Security</li>
<li>è‡ªå®šä¹‰ç”¨æˆ·å­˜å‚¨</li>
<li>è‡ªå®šä¹‰ç™»å½•é¡µé¢</li>
<li>é˜²å¾¡ CSRF æ”»å‡»</li>
<li>äº†è§£ä½ çš„ç”¨æˆ·</li>
</ul>
<h3 id="å¯ç”¨-Spring-Security"><a href="#å¯ç”¨-Spring-Security" class="headerlink" title="å¯ç”¨ Spring Security"></a>å¯ç”¨ Spring Security</h3><p>ä¿æŠ¤ Spring åº”ç”¨ç¨‹åºçš„ç¬¬ä¸€æ­¥æ˜¯å°† Spring Boot security starter ä¾èµ–é¡¹æ·»åŠ åˆ°æ„å»ºä¸­ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨åº”ç”¨ç¨‹åºå¹¶è®¿é—®ä¸»é¡µï¼ˆæˆ–ä»»ä½•é¡µé¢ï¼‰ã€‚å°†æç¤ºä½¿ç”¨ HTTP åŸºæœ¬èº«ä»½éªŒè¯å¯¹è¯æ¡†è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¦æƒ³é€šè¿‡è®¤è¯ï¼Œéœ€è¦æä¾›ç”¨æˆ·åå’Œå¯†ç ã€‚ç”¨æˆ·åæ˜¯ <em>user</em>ã€‚å¯†ç æ˜¯éšæœºç”Ÿæˆå¹¶å†™å…¥äº†åº”ç”¨ç¨‹åºæ—¥å¿—æ–‡ä»¶ã€‚æ—¥å¿—æ¡ç›®åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Using default security password: 087cfc6a-027d-44bc-95d7-cbb3a798a1ea</span><br></pre></td></tr></table></figure>

<p>å‡è®¾æ­£ç¡®åœ°è¾“å…¥äº†ç”¨æˆ·åå’Œå¯†ç ï¼Œå°†è¢«æˆäºˆå¯¹åº”ç”¨ç¨‹åºçš„è®¿é—®æƒã€‚</p>
<p>åœ¨é¡¹ç›®æ„å»ºä¸­æ·»åŠ  security starterï¼Œå°±å¯ä»¥è·å¾—ä»¥ä¸‹å®‰å…¨ç‰¹æ€§ï¼š</p>
<ul>
<li>æ‰€æœ‰çš„ HTTP è¯·æ±‚è·¯å¾„éƒ½éœ€è¦è®¤è¯ã€‚</li>
<li>ä¸éœ€è¦ç‰¹å®šçš„è§’è‰²æˆ–æƒé™ã€‚</li>
<li>æ²¡æœ‰ç™»å½•é¡µé¢ã€‚</li>
<li>èº«ä»½éªŒè¯ç”± HTTP åŸºæœ¬èº«ä»½éªŒè¯æä¾›ã€‚</li>
<li>åªæœ‰ä¸€ä¸ªç”¨æˆ·ï¼›ç”¨æˆ·åæ˜¯ <em>user</em>ã€‚</li>
</ul>
<p>å¦‚æœè¦æ­£ç¡®åœ°ä¿æŠ¤ Taco Cloud åº”ç”¨ç¨‹åºï¼Œè¿˜æœ‰æ›´å¤šçš„å·¥ä½œè¦åšã€‚è‡³å°‘éœ€è¦é…ç½® Spring Security æ¥å®Œæˆä»¥ä¸‹å·¥ä½œï¼š</p>
<ul>
<li>æç¤ºä½¿ç”¨ç™»å½•é¡µé¢è¿›è¡Œèº«ä»½éªŒè¯ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ HTTP åŸºæœ¬å¯¹è¯æ¡†ã€‚</li>
<li>ä¸ºå¤šä¸ªç”¨æˆ·æä¾›æ³¨å†Œé¡µé¢ï¼Œè®©æ–°çš„ Taco Cloud ç”¨æˆ·å¯ä»¥æ³¨å†Œã€‚</li>
<li>ä¸ºä¸åŒçš„è¯·æ±‚è·¯å¾„åº”ç”¨ä¸åŒçš„å®‰å…¨è§„åˆ™ã€‚ä¾‹å¦‚ï¼Œä¸»é¡µå’Œæ³¨å†Œé¡µé¢æ ¹æœ¬ä¸éœ€è¦èº«ä»½éªŒè¯ã€‚</li>
</ul>
<h3 id="é…ç½®-Spring-Security"><a href="#é…ç½®-Spring-Security" class="headerlink" title="é…ç½® Spring Security"></a>é…ç½® Spring Security</h3><center>ç¨‹åºæ¸…å• 4.1 ä¸€ä¸ªåŸºæœ¬çš„ Spring Security é…ç½®ç±»</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå†æ¬¡å°è¯•è®¿é—® Taco Cloud ä¸»é¡µï¼Œä»ç„¶ä¼šæç¤ºéœ€è¦ç™»å½•ã€‚ä½†æ˜¯ï¼Œå°†çœ‹åˆ°ä¸€ä¸ªç±»ä¼¼äºå›¾ 4.2 çš„ç™»å½•è¡¨å•ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª HTTP åŸºæœ¬èº«ä»½éªŒè¯å¯¹è¯æ¡†æç¤ºã€‚</p>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LsGNzDutAWQQM7I5YA9%252F-LsGOVe8G3_9gL4zbf6R%252F%E5%9B%BE%204.2%20Spring%20Security%20%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E4%B8%AA%E5%85%8D%E8%B4%B9%E7%9A%84%E6%99%AE%E9%80%9A%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2.jpg" alt="img"></p>
<center>å›¾ 4.2 Spring Security æä¾›äº†ä¸€ä¸ªå…è´¹çš„æ™®é€šç™»å½•é¡µé¢</center>

<p>Spring Security ä¸ºé…ç½®ç”¨æˆ·å­˜å‚¨æä¾›äº†å‡ ä¸ªé€‰é¡¹ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>ä¸€ä¸ªå†…å­˜ç”¨æˆ·å­˜å‚¨</li>
<li>åŸºäº JDBC çš„ç”¨æˆ·å­˜å‚¨</li>
<li>ç”± LDAP æ”¯æŒçš„ç”¨æˆ·å­˜å‚¨</li>
<li>å®šåˆ¶ç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡</li>
</ul>
<p>æ— è®ºé€‰æ‹©å“ªä¸ªç”¨æˆ·å­˜å‚¨ï¼Œéƒ½å¯ä»¥é€šè¿‡é‡å†™ WebSecurityConfigurerAdapter é…ç½®åŸºç±»ä¸­å®šä¹‰çš„ configure() æ–¹æ³•æ¥é…ç½®å®ƒã€‚é¦–å…ˆï¼Œä½ éœ€è¦åœ¨ SecurityConfig ç±»ä¸­æ·»åŠ ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œåªéœ€è¦ä½¿ç”¨ä½¿ç”¨ç»™å®š AuthenticationManagerBuilder çš„ä»£ç æ¥æ›¿æ¢è¿™äº›çœç•¥å·ï¼Œä»¥æŒ‡å®šåœ¨èº«ä»½éªŒè¯æœŸé—´å¦‚ä½•æŸ¥æ‰¾ç”¨æˆ·ã€‚</p>
<h4 id="å†…å­˜ç”¨æˆ·å­˜å‚¨"><a href="#å†…å­˜ç”¨æˆ·å­˜å‚¨" class="headerlink" title="å†…å­˜ç”¨æˆ·å­˜å‚¨"></a>å†…å­˜ç”¨æˆ·å­˜å‚¨</h4><p>ç”¨æˆ·ä¿¡æ¯å¯ä»¥ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚å‡è®¾åªæœ‰å°‘æ•°å‡ ä¸ªç”¨æˆ·ï¼Œè¿™äº›ç”¨æˆ·éƒ½ä¸å¯èƒ½æ”¹å˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†è¿™äº›ç”¨æˆ·å®šä¹‰ä¸ºå®‰å…¨é…ç½®çš„ä¸€éƒ¨åˆ†å¯èƒ½éå¸¸ç®€å•ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸‹ä¸€ä¸ªæ¸…å•æ˜¾ç¤ºäº†å¦‚ä½•åœ¨å†…å­˜ç”¨æˆ·å­˜å‚¨ä¸­é…ç½®ä¸¤ä¸ªç”¨æˆ· â€œbuzzâ€ å’Œ â€œwoodyâ€ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.2 åœ¨å†…å­˜ç”¨æˆ·å­˜å‚¨ä¸­å®šä¹‰ç”¨æˆ·</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth</span><br><span class="line">        .inMemoryAuthentication()</span><br><span class="line">            .withUser(<span class="string">&quot;buzz&quot;</span>)</span><br><span class="line">                .password(<span class="string">&quot;infinity&quot;</span>)</span><br><span class="line">                .authorities(<span class="string">&quot;ROLE_USER&quot;</span>)</span><br><span class="line">            .and()</span><br><span class="line">            .withUser(<span class="string">&quot;woody&quot;</span>)</span><br><span class="line">                .password(<span class="string">&quot;bullseye&quot;</span>)</span><br><span class="line">                .authorities(<span class="string">&quot;ROLE_USER&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AuthenticationManagerBuilder ä½¿ç”¨æ„é€ å™¨é£æ ¼çš„ API æ¥é…ç½®èº«ä»½éªŒè¯ç»†èŠ‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹ inMemoryAuthentication() æ–¹æ³•çš„è°ƒç”¨ï¼Œå¯ä»¥ç›´æ¥åœ¨å®‰å…¨é…ç½®æœ¬èº«ä¸­æŒ‡å®šç”¨æˆ·ä¿¡æ¯ã€‚</p>
<p>ç»™ withUser() çš„å€¼æ˜¯ç”¨æˆ·åï¼Œè€Œå¯†ç å’Œæˆäºˆçš„æƒé™æ˜¯ç”¨ password() å’Œ authority() æ–¹æ³•æŒ‡å®šçš„ã€‚</p>
<p>å†…å­˜ä¸­çš„ç”¨æˆ·å­˜å‚¨åº”ç”¨äºæµ‹è¯•æˆ–éå¸¸ç®€å•çš„åº”ç”¨ç¨‹åºæ—¶éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯å®ƒä¸å…è®¸å¯¹ç”¨æˆ·è¿›è¡Œç®€å•çš„ç¼–è¾‘ã€‚å¦‚æœéœ€è¦æ·»åŠ ã€åˆ é™¤æˆ–æ›´æ”¹ç”¨æˆ·ï¼Œåˆ™å¿…é¡»è¿›è¡Œå¿…è¦çš„æ›´æ”¹ï¼Œç„¶åé‡æ–°æ„å»ºã€éƒ¨ç½²åº”ç”¨ç¨‹åºã€‚</p>
<h4 id="åŸºäº-JDBC-çš„ç”¨æˆ·å­˜å‚¨"><a href="#åŸºäº-JDBC-çš„ç”¨æˆ·å­˜å‚¨" class="headerlink" title="åŸºäº JDBC çš„ç”¨æˆ·å­˜å‚¨"></a>åŸºäº JDBC çš„ç”¨æˆ·å­˜å‚¨</h4><p>ä¸‹é¢çš„ç¨‹åºæ¸…å•æ˜¾ç¤ºäº†å¦‚ä½•é…ç½® Spring Securityï¼Œå¹¶å°†ç”¨æˆ·ä¿¡æ¯é€šè¿‡ JDBC ä¿å­˜åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œæ¥è¿›è¡Œèº«ä»½è®¤è¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">DataSource dataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth</span><br><span class="line">        .jdbcAuthentication()</span><br><span class="line">        .dataSource(dataSource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>configure() çš„è¿™ä¸ªå®ç°åœ¨ç»™å®šçš„ AuthenticationManagerBuilder ä¸Šè°ƒç”¨ jdbcAuthentication()ã€‚ç„¶åï¼Œå¿…é¡»è®¾ç½® DataSourceï¼Œä»¥ä¾¿å®ƒçŸ¥é“å¦‚ä½•è®¿é—®æ•°æ®åº“ã€‚è¿™é‡Œä½¿ç”¨çš„æ•°æ®æºæ˜¯ç”±è‡ªåŠ¨è£…é…æä¾›çš„ã€‚</p>
<p><strong>é‡å†™é»˜è®¤ç”¨æˆ·æŸ¥è¯¢</strong></p>
<p>è™½ç„¶è¿™ä¸ªæœ€å°é…ç½®å¯ä»¥å·¥ä½œï¼Œä½†å®ƒå¯¹æ•°æ®åº“æ¨¡å¼åšäº†ä¸€äº›å‡è®¾ã€‚å®ƒæœŸæœ›å·²ç»å­˜åœ¨æŸäº›è¡¨ï¼Œç”¨æˆ·æ•°æ®å°†ä¿å­˜åœ¨è¿™äº›è¡¨ä¸­ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œä»¥ä¸‹æ¥è‡ª Spring Security å†…éƒ¨çš„ä»£ç ç‰‡æ®µæ˜¾ç¤ºäº†åœ¨æŸ¥æ‰¾ç”¨æˆ·è¯¦ç»†ä¿¡æ¯æ—¶å°†æ‰§è¡Œçš„ SQL æŸ¥è¯¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEF_USERS_BY_USERNAME_QUERY = </span><br><span class="line">    <span class="string">&quot;select username,password,enabled &quot;</span> +</span><br><span class="line">    <span class="string">&quot;from users &quot;</span> +</span><br><span class="line">    <span class="string">&quot;where username = ?&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEF_AUTHORITIES_BY_USERNAME_QUERY =</span><br><span class="line">    <span class="string">&quot;select username,authority &quot;</span> +</span><br><span class="line">    <span class="string">&quot;from authorities &quot;</span> +</span><br><span class="line">    <span class="string">&quot;where username = ?&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEF_GROUP_AUTHORITIES_BY_USERNAME_QUERY =</span><br><span class="line">    <span class="string">&quot;select g.id, g.group_name, ga.authority &quot;</span> +</span><br><span class="line">    <span class="string">&quot;from groups g, group_members gm, group_authorities ga &quot;</span> +</span><br><span class="line">    <span class="string">&quot;where gm.username = ? &quot;</span> +</span><br><span class="line">    <span class="string">&quot;and g.id = ga.group_id &quot;</span> +</span><br><span class="line">    <span class="string">&quot;and g.id = gm.group_id&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªæŸ¥è¯¢æ£€ç´¢ç”¨æˆ·çš„ç”¨æˆ·åã€å¯†ç ä»¥åŠæ˜¯å¦å¯ç”¨å®ƒä»¬ï¼Œæ­¤ä¿¡æ¯ç”¨äºå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ï¼›ä¸‹ä¸€ä¸ªæŸ¥è¯¢æŸ¥è¯¢ç”¨æˆ·æˆäºˆçš„æƒé™ï¼Œä»¥è¿›è¡Œæˆæƒï¼›æœ€åä¸€ä¸ªæŸ¥è¯¢æŸ¥è¯¢ä½œä¸ºç»„çš„æˆå‘˜æˆäºˆç”¨æˆ·çš„æƒé™ã€‚</p>
<p>å¦‚æœå¯ä»¥åœ¨æ•°æ®åº“ä¸­å®šä¹‰å’Œå¡«å……æ»¡è¶³è¿™äº›æŸ¥è¯¢çš„è¡¨ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰ä»€ä¹ˆå…¶ä»–è¦åšçš„äº†ã€‚ä½†æ˜¯ï¼Œæ•°æ®åº“å¾ˆå¯èƒ½ä¸æ˜¯è¿™æ ·çš„ï¼Œéœ€è¦å¯¹æŸ¥è¯¢è¿›è¡Œæ›´å¤šçš„æ§åˆ¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é…ç½®è‡ªå·±çš„æŸ¥è¯¢ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.4 è‡ªå®šä¹‰ç”¨æˆ·è¯¦æƒ…æŸ¥è¯¢</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth</span><br><span class="line">        .jdbcAuthentication()</span><br><span class="line">            .dataSource(dataSource)</span><br><span class="line">            .usersByUsernameQuery(</span><br><span class="line">                <span class="string">&quot;select username, password, enabled from Users &quot;</span> +</span><br><span class="line">                <span class="string">&quot;where username=?&quot;</span>)</span><br><span class="line">            .authoritiesByUsernameQuery(</span><br><span class="line">                <span class="string">&quot;select username, authority from UserAuthorities &quot;</span> +</span><br><span class="line">                <span class="string">&quot;where username=?&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œä»…é‡å†™äº†èº«ä»½éªŒè¯å’ŒåŸºæœ¬æˆæƒæŸ¥è¯¢ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨è‡ªå®šä¹‰æŸ¥è¯¢è°ƒç”¨ groupAuthoritiesByUsername() æ¥é‡å†™ç»„æƒé™æŸ¥è¯¢ã€‚</p>
<p>åœ¨å°†é»˜è®¤ SQL æŸ¥è¯¢æ›¿æ¢ä¸ºè‡ªå·±è®¾è®¡çš„æŸ¥è¯¢æ—¶ï¼Œä¸€å®šè¦éµå®ˆæŸ¥è¯¢çš„åŸºæœ¬çº¦å®šã€‚å®ƒä»¬éƒ½ä»¥ç”¨æˆ·åä½œä¸ºå”¯ä¸€å‚æ•°ã€‚èº«ä»½éªŒè¯æŸ¥è¯¢é€‰æ‹©ç”¨æˆ·åã€å¯†ç å’Œå¯ç”¨çŠ¶æ€ï¼›æˆæƒæŸ¥è¯¢é€‰æ‹©åŒ…å«ç”¨æˆ·åå’Œæˆäºˆçš„æƒé™çš„é›¶ä¸ªæˆ–å¤šä¸ªè¡Œçš„æ•°æ®ï¼›ç»„æƒé™æŸ¥è¯¢é€‰æ‹©é›¶ä¸ªæˆ–å¤šä¸ªè¡Œæ•°æ®ï¼Œæ¯ä¸ªè¡Œæœ‰ä¸€ä¸ª group idã€ä¸€ä¸ªç»„åå’Œä¸€ä¸ªæƒé™ã€‚</p>
<p><strong>ä½¿ç”¨ç¼–ç å¯†ç </strong></p>
<p>å¦‚æœå¯†ç ä»¥çº¯æ–‡æœ¬å½¢å¼å­˜å‚¨ï¼Œå°±ä¼šå—åˆ°é»‘å®¢çš„çª¥æ¢ã€‚ä½†æ˜¯å¦‚æœåœ¨æ•°æ®åº“ä¸­å¯¹å¯†ç è¿›è¡Œç¼–ç ï¼Œèº«ä»½éªŒè¯å°†å¤±è´¥ï¼Œå› ä¸ºå®ƒä¸ç”¨æˆ·æäº¤çš„æ˜æ–‡å¯†ç ä¸åŒ¹é…ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ éœ€è¦é€šè¿‡è°ƒç”¨ passwordEncoder() æ–¹æ³•æŒ‡å®šä¸€ä¸ªå¯†ç ç¼–ç å™¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth</span><br><span class="line">        .jdbcAuthentication()</span><br><span class="line">        .dataSource(dataSource)</span><br><span class="line">        .usersByUsernameQuery(<span class="string">&quot;select username, password, enabled from Users &quot;</span> +</span><br><span class="line">                              <span class="string">&quot;where username=?&quot;</span>)</span><br><span class="line">        .authoritiesByUsernameQuery(<span class="string">&quot;select username, authority from UserAuthorities &quot;</span> +</span><br><span class="line">                                    <span class="string">&quot;where username=?&quot;</span>)</span><br><span class="line">        .passwordEncoder(<span class="keyword">new</span> StandardPasswordEncoder(<span class="string">&quot;53cr3t&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>passwordEncoder() æ–¹æ³•æ¥å— Spring Security çš„ passwordEncoder æ¥å£çš„ä»»ä½•å®ç°ã€‚Spring Security çš„åŠ å¯†æ¨¡å—åŒ…æ‹¬å‡ ä¸ªè¿™æ ·çš„å®ç°ï¼š</p>
<ul>
<li>BCryptPasswordEncoder â€”â€” é‡‡ç”¨ bcrypt å¼ºå“ˆå¸ŒåŠ å¯†</li>
<li>NoOpPasswordEncoder â€”â€” ä¸åº”ç”¨ä»»ä½•ç¼–ç </li>
<li>Pbkdf2PasswordEncoder â€”â€” åº”ç”¨ PBKDF2 åŠ å¯†</li>
<li>SCryptPasswordEncoder â€”â€” åº”ç”¨äº† scrypt æ•£åˆ—åŠ å¯†</li>
<li>StandardPasswordEncoder â€”â€” åº”ç”¨ SHA-256 æ•£åˆ—åŠ å¯†</li>
</ul>
<p>ä¸Šè¿°ä»£ç ä½¿ç”¨äº† StandardPasswordEncoderã€‚ä½†æ˜¯ï¼Œå¦‚æœæ²¡æœ‰ç°æˆçš„å®ç°æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œä½ å¯ä»¥é€‰æ‹©ä»»ä½•å…¶ä»–å®ç°ï¼Œç”šè‡³å¯ä»¥æä¾›ä½ è‡ªå·±çš„è‡ªå®šä¹‰å®ç°ã€‚PasswordEncoder æ¥å£ç›¸å½“ç®€å•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PasswordEncoder</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">encode</span><span class="params">(CharSequence rawPassword)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(CharSequence rawPassword, String encodedPassword)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ— è®ºä½¿ç”¨å“ªç§å¯†ç ç¼–ç å™¨ï¼Œé‡è¦çš„æ˜¯è¦ç†è§£æ•°æ®åº“ä¸­çš„å¯†ç æ°¸è¿œä¸ä¼šè¢«è§£ç ã€‚ç›¸åï¼Œç”¨æˆ·åœ¨ç™»å½•æ—¶è¾“å…¥çš„å¯†ç ä½¿ç”¨ç›¸åŒçš„ç®—æ³•è¿›è¡Œç¼–ç ï¼Œç„¶åå°†å…¶ä¸æ•°æ®åº“ä¸­ç¼–ç çš„å¯†ç è¿›è¡Œæ¯”è¾ƒã€‚æ¯”è¾ƒæ˜¯åœ¨ PasswordEncoder çš„ matches() æ–¹æ³•ä¸­æ‰§è¡Œçš„ã€‚</p>
<p>æœ€åï¼Œå°†åœ¨æ•°æ®åº“ä¸­ç»´æŠ¤ Taco Cloud ç”¨æˆ·æ•°æ®ã€‚ä½†æ˜¯ï¼Œæˆ‘æ²¡æœ‰ä½¿ç”¨ jdbcAuthentication()ï¼Œè€Œæ˜¯æƒ³åˆ°äº†å¦ä¸€ä¸ªèº«ä»½éªŒè¯é€‰é¡¹ã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹çœ‹å¦‚ä½•é…ç½® Spring Security ä»¥ä¾èµ–äºå¦ä¸€ä¸ªå¸¸è§çš„ç”¨æˆ·æ•°æ®æºï¼šä½¿ç”¨ LDAPï¼ˆè½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼‰æ¥å…¥çš„ç”¨æˆ·å­˜å‚¨ã€‚</p>
<h4 id="LDAP-æ”¯æŒçš„ç”¨æˆ·å­˜å‚¨"><a href="#LDAP-æ”¯æŒçš„ç”¨æˆ·å­˜å‚¨" class="headerlink" title="LDAP æ”¯æŒçš„ç”¨æˆ·å­˜å‚¨"></a>LDAP æ”¯æŒçš„ç”¨æˆ·å­˜å‚¨</h4><p>è¦ä¸ºåŸºäº LDAP çš„èº«ä»½éªŒè¯é…ç½® Spring Securityï¼Œå¯ä»¥ä½¿ç”¨ ldapAuthentication() æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¸ jdbcAuthentication() ç±»ä¼¼ã€‚ä¸‹é¢çš„ configure() æ–¹æ³•æ¼”ç¤ºäº†ç”¨äº LDAP èº«ä»½éªŒè¯çš„ç®€å•é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth</span><br><span class="line">        .ldapAuthentication()</span><br><span class="line">        .userSearchFilter(<span class="string">&quot;(uid=&#123;0&#125;)&quot;</span>)</span><br><span class="line">        .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>userSearchFilter() å’Œ groupSearchFilter() æ–¹æ³•ç”¨äºä¸ºåŸºæœ¬ LDAP æŸ¥è¯¢æä¾›è¿‡æ»¤å™¨ï¼Œè¿™äº›æŸ¥è¯¢ç”¨äºæœç´¢ç”¨æˆ·å’Œç»„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨æˆ·å’Œç»„çš„åŸºæœ¬æŸ¥è¯¢éƒ½æ˜¯ç©ºçš„ï¼Œè¿™è¡¨ç¤ºå°†ä» LDAP å±‚æ¬¡ç»“æ„çš„æ ¹ç›®å½•è¿›è¡Œæœç´¢ã€‚ä½†ä½ å¯ä»¥é€šè¿‡æŒ‡å®šä¸€ä¸ªæŸ¥è¯¢åŸºæ•°æ¥æ”¹å˜è¿™ç§æƒ…å†µï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth</span><br><span class="line">        .ldapAuthentication()</span><br><span class="line">        .userSearchBase(<span class="string">&quot;ou=people&quot;</span>)</span><br><span class="line">        .userSearchFilter(<span class="string">&quot;(uid=&#123;0&#125;)&quot;</span>)</span><br><span class="line">        .groupSearchBase(<span class="string">&quot;ou=groups&quot;</span>)</span><br><span class="line">        .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>userSearchBase() æ–¹æ³•æä¾›äº†æŸ¥æ‰¾ç”¨æˆ·çš„åŸºæœ¬æŸ¥è¯¢ã€‚åŒæ ·ï¼ŒgroupSearchBase() æ–¹æ³•æŒ‡å®šæŸ¥æ‰¾ç»„çš„åŸºæœ¬æŸ¥è¯¢ã€‚è¿™ä¸ªç¤ºä¾‹ä¸æ˜¯ä»æ ¹ç›®å½•è¿›è¡Œæœç´¢ï¼Œè€Œæ˜¯æŒ‡å®šè¦æœç´¢ç”¨æˆ·æ‰€åœ¨çš„ç»„ç»‡å•å…ƒæ˜¯ peopleï¼Œç»„åº”è¯¥æœç´¢ç»„ç»‡å•å…ƒæ‰€åœ¨çš„ groupã€‚</p>
<p><strong>é…ç½®å¯†ç æ¯”è¾ƒ</strong></p>
<p>é’ˆå¯¹ LDAP è¿›è¡Œèº«ä»½éªŒè¯çš„é»˜è®¤ç­–ç•¥æ˜¯æ‰§è¡Œç»‘å®šæ“ä½œï¼Œå°†ç”¨æˆ·é€šè¿‡ LDAP æœåŠ¡å™¨ç›´æ¥è¿›è¡ŒéªŒè¯ã€‚å¦ä¸€ç§é€‰æ‹©æ˜¯æ‰§è¡Œæ¯”è¾ƒæ“ä½œï¼Œè¿™åŒ…æ‹¬å°†è¾“å…¥çš„å¯†ç å‘é€åˆ° LDAP ç›®å½•ï¼Œå¹¶è¦æ±‚æœåŠ¡å™¨å°†å¯†ç ä¸ç”¨æˆ·çš„å¯†ç å±æ€§è¿›è¡Œæ¯”è¾ƒã€‚å› ä¸ºæ¯”è¾ƒæ˜¯åœ¨ LDAP æœåŠ¡å™¨ä¸­è¿›è¡Œçš„ï¼Œæ‰€ä»¥å®é™…çš„å¯†ç æ˜¯ä¿å¯†çš„ã€‚</p>
<p>å¦‚æœå¸Œæœ›é€šè¿‡å¯†ç æ¯”è¾ƒè¿›è¡Œèº«ä»½éªŒè¯ï¼Œå¯ä»¥ä½¿ç”¨ passwordCompare() æ–¹æ³•è¿›è¡Œå£°æ˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth</span><br><span class="line">        .ldapAuthentication()</span><br><span class="line">        .userSearchBase(<span class="string">&quot;ou=people&quot;</span>)</span><br><span class="line">        .userSearchFilter(<span class="string">&quot;(uid=&#123;0&#125;)&quot;</span>)</span><br><span class="line">        .groupSearchBase(<span class="string">&quot;ou=groups&quot;</span>)</span><br><span class="line">        .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>)</span><br><span class="line">        .passwordCompare();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç™»å½•è¡¨å•ä¸­ç»™å‡ºçš„å¯†ç å°†ä¸ç”¨æˆ· LDAP æ¡ç›®ä¸­çš„ userPassword å±æ€§å€¼è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå¯†ç ä¿å­˜åœ¨ä¸åŒçš„å±æ€§ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ passwordAttribute() æŒ‡å®šå¯†ç å±æ€§çš„åç§°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth</span><br><span class="line">        .ldapAuthentication()</span><br><span class="line">            .userSearchBase(<span class="string">&quot;ou=people&quot;</span>)</span><br><span class="line">            .userSearchFilter(<span class="string">&quot;(uid=&#123;0&#125;)&quot;</span>)</span><br><span class="line">            .groupSearchBase(<span class="string">&quot;ou=groups&quot;</span>)</span><br><span class="line">            .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>)</span><br><span class="line">            .passwordCompare()</span><br><span class="line">            .passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder())</span><br><span class="line">            .passwordAttribute(<span class="string">&quot;passcode&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼ŒæŒ‡å®šå¯†ç å±æ€§åº”è¯¥ä¸ç»™å®šçš„å¯†ç è¿›è¡Œæ¯”è¾ƒã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®šå¯†ç ç¼–ç å™¨ï¼Œåœ¨è¿›è¡ŒæœåŠ¡å™¨ç«¯å¯†ç æ¯”è¾ƒæ—¶ï¼Œæœ€å¥½åœ¨æœåŠ¡å™¨ç«¯å¯¹å®é™…å¯†ç åŠ å¯†ã€‚ä½†æ˜¯å°è¯•çš„å¯†ç ä»ç„¶ä¼šé€šè¿‡ç½‘ç»œä¼ é€’åˆ° LDAP æœåŠ¡å™¨ï¼Œå¹¶ä¸”å¯èƒ½è¢«é»‘å®¢æˆªè·ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ passwordEncoder() æ–¹æ³•æ¥æŒ‡å®šåŠ å¯†ç­–ç•¥ã€‚</p>
<p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ bcrypt å¯†ç æ•£åˆ—å‡½æ•°å¯¹å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œè¿™é‡Œçš„å‰ææ˜¯å¯†ç åœ¨ LDAP æœåŠ¡å™¨ä¸­ä¹Ÿæ˜¯ä½¿ç”¨ bcrypt åŠ å¯†çš„ã€‚</p>
<p><strong>å¼•ç”¨è¿œç¨‹ LDAP æœåŠ¡å™¨</strong></p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¿½ç•¥äº† LDAP æœåŠ¡å™¨å’Œæ•°æ®å®é™…é©»ç•™çš„ä½ç½®ï¼Œè™½ç„¶å·²ç»å°† Spring é…ç½®ä¸ºæ ¹æ® LDAP æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä½†æ˜¯è¯¥æœåŠ¡å™¨åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Security çš„ LDAP èº«ä»½éªŒè¯å‡è®¾ LDAP æœåŠ¡å™¨æ­£åœ¨æœ¬åœ°ä¸»æœºä¸Šç›‘å¬ç«¯å£ 33389ã€‚ä½†æ˜¯ï¼Œå¦‚æœ LDAP æœåŠ¡å™¨ä½äºå¦ä¸€å°æœºå™¨ä¸Šï¼Œåˆ™å¯ä»¥ä½¿ç”¨ contextSource() æ–¹æ³•æ¥é…ç½®ä½ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth</span><br><span class="line">        .ldapAuthentication()</span><br><span class="line">        .userSearchBase(<span class="string">&quot;ou=people&quot;</span>)</span><br><span class="line">        .userSearchFilter(<span class="string">&quot;(uid=&#123;0&#125;)&quot;</span>)</span><br><span class="line">        .groupSearchBase(<span class="string">&quot;ou=groups&quot;</span>)</span><br><span class="line">        .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>)</span><br><span class="line">        .passwordCompare()</span><br><span class="line">        .passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder())</span><br><span class="line">        .passwordAttribute(<span class="string">&quot;passcode&quot;</span>)</span><br><span class="line">        .contextSource()</span><br><span class="line">        .url(<span class="string">&quot;ldap://tacocloud.com:389/dc=tacocloud,dc=com&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>contextSource() æ–¹æ³•è¿”å› ContextSourceBuilderï¼Œå…¶ä¸­æä¾›äº† url() æ–¹æ³•ï¼Œå®ƒå…è®¸æŒ‡å®š LDAP æœåŠ¡å™¨çš„ä½ç½®ã€‚</p>
<p><strong>é…ç½®åµŒå…¥å¼ LDAP æœåŠ¡å™¨</strong></p>
<p>å¦‚æœæ²¡æœ‰ LDAP æœåŠ¡å™¨å»åšèº«ä»½éªŒè¯ï¼ŒSpring Security å¯æä¾›ä¸€ä¸ªåµŒå…¥å¼ LDAP æœåŠ¡å™¨ã€‚å¯ä»¥é€šè¿‡ root() æ–¹æ³•ä¸ºåµŒå…¥å¼æœåŠ¡å™¨æŒ‡å®šæ ¹åç¼€ï¼Œè€Œä¸æ˜¯å°† URL è®¾ç½®ä¸ºè¿œç¨‹ LDAP æœåŠ¡å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth</span><br><span class="line">        .ldapAuthentication()</span><br><span class="line">        .userSearchBase(<span class="string">&quot;ou=people&quot;</span>)</span><br><span class="line">        .userSearchFilter(<span class="string">&quot;(uid=&#123;0&#125;)&quot;</span>)</span><br><span class="line">        .groupSearchBase(<span class="string">&quot;ou=groups&quot;</span>)</span><br><span class="line">        .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>)</span><br><span class="line">        .passwordCompare()</span><br><span class="line">        .passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder())</span><br><span class="line">        .passwordAttribute(<span class="string">&quot;passcode&quot;</span>)</span><br><span class="line">        .contextSource()</span><br><span class="line">        .root(<span class="string">&quot;dc=tacocloud,dc=com&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ LDAP æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå®ƒå°†å°è¯•ä»ç±»è·¯å¾„ä¸­æ‰¾åˆ°çš„ä»»ä½• LDIF æ–‡ä»¶è¿›è¡Œæ•°æ®åŠ è½½ã€‚LDIFï¼ˆLDAP æ•°æ®äº¤æ¢æ ¼å¼ï¼‰æ˜¯åœ¨çº¯æ–‡æœ¬æ–‡ä»¶ä¸­è¡¨ç¤º LDAP æ•°æ®çš„æ ‡å‡†æ–¹æ³•ï¼Œæ¯ä¸ªè®°å½•ç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¡Œç»„æˆï¼Œæ¯ä¸ªè¡ŒåŒ…å«ä¸€ä¸ª name:value å¯¹ï¼Œè®°å½•ä¹‹é—´ç”¨ç©ºè¡Œåˆ†éš”ã€‚</p>
<p>å¦‚æœä¸å¸Œæœ› Spring åœ¨ç±»è·¯å¾„ä¸­å¯»æ‰¾å®ƒèƒ½æ‰¾åˆ°çš„ LDIF æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ ldif() æ–¹æ³•æ¥æ›´æ˜ç¡®åœ°çŸ¥é“åŠ è½½çš„æ˜¯å“ªä¸ª LDIF æ–‡ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth</span><br><span class="line">        .ldapAuthentication()</span><br><span class="line">        .userSearchBase(<span class="string">&quot;ou=people&quot;</span>)</span><br><span class="line">        .userSearchFilter(<span class="string">&quot;(uid=&#123;0&#125;)&quot;</span>)</span><br><span class="line">        .groupSearchBase(<span class="string">&quot;ou=groups&quot;</span>)</span><br><span class="line">        .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>)</span><br><span class="line">        .passwordCompare()</span><br><span class="line">        .passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder())</span><br><span class="line">        .passwordAttribute(<span class="string">&quot;passcode&quot;</span>)</span><br><span class="line">        .contextSource()</span><br><span class="line">            .root(<span class="string">&quot;dc=tacocloud,dc=com&quot;</span>)</span><br><span class="line">            .ldif(<span class="string">&quot;classpath:users.ldif&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œï¼Œç‰¹åˆ«è¦æ±‚ LDAP æœåŠ¡å™¨ä»ä½äºæ ¹è·¯å¾„ä¸‹çš„ users.ldif æ–‡ä»¶ä¸­åŠ è½½æ•°æ®ã€‚å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªLDIF æ–‡ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥åŠ è½½å†…åµŒ LDAP æœåŠ¡å™¨çš„ç”¨æˆ·æ•°æ®ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dn</span>: <span class="string">ou=groups,dc=tacocloud,dc=com</span></span><br><span class="line"><span class="attr">objectclass</span>: <span class="string">top</span></span><br><span class="line"><span class="attr">objectclass</span>: <span class="string">organizationalUnit</span></span><br><span class="line"><span class="attr">ou</span>: <span class="string">groups</span></span><br><span class="line"><span class="attr">dn</span>: <span class="string">ou=people,dc=tacocloud,dc=com</span></span><br><span class="line"><span class="attr">objectclass</span>: <span class="string">top</span></span><br><span class="line"><span class="attr">objectclass</span>: <span class="string">organizationalUnit</span></span><br><span class="line"><span class="attr">ou</span>: <span class="string">people</span></span><br><span class="line"><span class="attr">dn</span>: <span class="string">uid=buzz,ou=people,dc=tacocloud,dc=com</span></span><br><span class="line"><span class="attr">objectclass</span>: <span class="string">top</span></span><br><span class="line"><span class="attr">objectclass</span>: <span class="string">person</span></span><br><span class="line"><span class="attr">objectclass</span>: <span class="string">organizationalPerson</span></span><br><span class="line"><span class="attr">objectclass</span>: <span class="string">inetOrgPerson</span></span><br><span class="line"><span class="attr">cn</span>: <span class="string">Buzz Lightyear</span></span><br><span class="line"><span class="attr">sn</span>: <span class="string">Lightyear</span></span><br><span class="line"><span class="attr">uid</span>: <span class="string">buzz</span></span><br><span class="line"><span class="attr">userPassword</span>: <span class="string">password</span></span><br><span class="line"><span class="attr">dn</span>: <span class="string">cn=tacocloud,ou=groups,dc=tacocloud,dc=com</span></span><br><span class="line"><span class="attr">objectclass</span>: <span class="string">top</span></span><br><span class="line"><span class="attr">objectclass</span>: <span class="string">groupOfNames</span></span><br><span class="line"><span class="attr">cn</span>: <span class="string">tacocloud</span></span><br><span class="line"><span class="attr">member</span>: <span class="string">uid=buzz,ou=people,dc=tacocloud,dc=com</span></span><br></pre></td></tr></table></figure>

<p>Spring Security çš„å†…ç½®ç”¨æˆ·å­˜å‚¨éå¸¸æ–¹ä¾¿ï¼Œæ¶µç›–äº†ä¸€äº›å¸¸è§çš„ç”¨ä¾‹ã€‚ä½†æ˜¯ Taco Cloud åº”ç”¨ç¨‹åºéœ€è¦ä¸€äº›ç‰¹æ®Šçš„ä¸œè¥¿ã€‚å½“å¼€ç®±å³ç”¨çš„ç”¨æˆ·å­˜å‚¨ä¸èƒ½æ»¡è¶³éœ€æ±‚æ—¶ï¼Œéœ€è¦åˆ›å»ºå¹¶é…ç½®ä¸€ä¸ªå®šåˆ¶çš„ç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡ã€‚</p>
<h4 id="è‡ªå®šä¹‰ç”¨æˆ·èº«ä»½éªŒè¯"><a href="#è‡ªå®šä¹‰ç”¨æˆ·èº«ä»½éªŒè¯" class="headerlink" title="è‡ªå®šä¹‰ç”¨æˆ·èº«ä»½éªŒè¯"></a>è‡ªå®šä¹‰ç”¨æˆ·èº«ä»½éªŒè¯</h4><p>åœ¨ä¸Šä¸€ç« ä¸­ï¼Œå†³å®šäº†ä½¿ç”¨ Spring Data JPA ä½œä¸ºæ‰€æœ‰ tacoã€é…æ–™å’Œè®¢å•æ•°æ®çš„æŒä¹…åŒ–é€‰é¡¹ã€‚å› æ­¤ï¼Œä»¥åŒæ ·çš„æ–¹å¼æŒä¹…åŒ–ç”¨æˆ·æ•°æ®æ˜¯æœ‰æ„ä¹‰çš„ï¼Œè¿™æ ·åšçš„è¯ï¼Œæ•°æ®æœ€ç»ˆå°†é©»ç•™åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨åŸºäº JDBC çš„èº«ä»½éªŒè¯ã€‚ä½†æ˜¯æ›´å¥½çš„æ–¹æ³•æ˜¯åˆ©ç”¨ Spring Data å­˜å‚¨åº“æ¥å­˜å‚¨ç”¨æˆ·ã€‚</p>
<p>ä¸è¿‡ï¼Œè¿˜æ˜¯è¦å…ˆåšé‡è¦çš„äº‹æƒ…ï¼Œè®©æˆ‘ä»¬åˆ›å»ºè¡¨ç¤ºå’ŒæŒä¹…å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„åŸŸå¯¹è±¡å’Œå­˜å‚¨åº“æ¥å£ã€‚</p>
<p>å½“ Taco Cloud ç”¨æˆ·æ³¨å†Œåº”ç”¨ç¨‹åºæ—¶ï¼Œä»–ä»¬éœ€è¦æä¾›çš„ä¸ä»…ä»…æ˜¯ç”¨æˆ·åå’Œå¯†ç ã€‚ä»–ä»¬è¿˜ä¼šå‘Šè¯‰ä½ ï¼Œä»–ä»¬çš„å…¨åã€åœ°å€å’Œç”µè¯å·ç ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥ç”¨äºå„ç§ç›®çš„ï¼Œä¸é™äºé‡æ–°å¡«å……è®¢å•ï¼ˆæ›´ä¸ç”¨è¯´æ½œåœ¨çš„è¥é”€æœºä¼šï¼‰ã€‚</p>
<p>ä¸ºäº†æ•è·æ‰€æœ‰è¿™äº›ä¿¡æ¯ï¼Œå°†åˆ›å»ºä¸€ä¸ª User ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ç¨‹åºæ¸…å• 4.5 å®šä¹‰ç”¨æˆ·å®ä½“</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> lombok.AccessLevel;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor(access=AccessLevel.PRIVATE, force=true)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">UserDetails</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy=GenerationType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String username;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String fullname;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String street;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String city;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String state;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String zip;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String phoneNumber;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.asList(<span class="keyword">new</span> SimpleGrantedAuthority(<span class="string">&quot;ROLE_USER&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonExpired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCredentialsNonExpired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯«æ— ç–‘é—®ï¼Œä½ å·²ç»æ³¨æ„åˆ° User ç±»æ¯”ç¬¬ 3 ç« ä¸­å®šä¹‰çš„ä»»ä½•å…¶ä»–å®ä½“éƒ½æ›´åŠ å¤æ‚ã€‚é™¤äº†å®šä¹‰ä¸€äº›å±æ€§å¤–ï¼ŒUser è¿˜å®ç°äº†æ¥è‡ª Spring Security çš„ UserDetails æ¥å£ã€‚</p>
<p>UserDetails çš„å®ç°å°†å‘æ¡†æ¶æä¾›ä¸€äº›åŸºæœ¬çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæ¯”å¦‚æˆäºˆç”¨æˆ·ä»€ä¹ˆæƒé™ä»¥åŠç”¨æˆ·çš„å¸æˆ·æ˜¯å¦å¯ç”¨ã€‚</p>
<p>getAuthorities() æ–¹æ³•åº”è¯¥è¿”å›æˆäºˆç”¨æˆ·çš„æƒé™é›†åˆã€‚å„ç§ isXXXexpired() æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºç”¨æˆ·çš„å¸æˆ·æ˜¯å¦å·²å¯ç”¨æˆ–è¿‡æœŸã€‚</p>
<p>å¯¹äº User å®ä½“ï¼ŒgetAuthorities() æ–¹æ³•ä»…è¿”å›ä¸€ä¸ªé›†åˆï¼Œè¯¥é›†åˆæŒ‡ç¤ºæ‰€æœ‰ç”¨æˆ·å°†è¢«æˆäºˆ ROLE_USER æƒé™ã€‚è€Œä¸”ï¼Œè‡³å°‘ç°åœ¨ï¼ŒTaco Cloud è¿˜ä¸éœ€è¦ç¦ç”¨ç”¨æˆ·ï¼Œæ‰€ä»¥æ‰€æœ‰çš„ isXXXexpired() æ–¹æ³•éƒ½è¿”å› true æ¥è¡¨ç¤ºç”¨æˆ·å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚</p>
<p>å®šä¹‰äº† User å®ä½“åï¼Œç°åœ¨å¯ä»¥å®šä¹‰å­˜å‚¨åº“æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.CrudRepository;</span><br><span class="line"><span class="keyword">import</span> tacos.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> <span class="keyword">extends</span> <span class="title">CrudRepository</span>&lt;<span class="title">User</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">User <span class="title">findByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†é€šè¿‡æ‰©å±• CrudRepository æä¾›çš„ CRUD æ“ä½œä¹‹å¤–ï¼ŒUserRepository è¿˜å®šä¹‰äº†ä¸€ä¸ª findByUsername() æ–¹æ³•ï¼Œå°†åœ¨ç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡ä¸­ä½¿ç”¨è¯¥æ–¹æ³•æ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾ Userã€‚</p>
<p>å¦‚ç¬¬ 3 ç« æ‰€è¿°ï¼ŒSpring Data JPA å°†åœ¨è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆè¯¥æ¥å£çš„å®ç°ã€‚å› æ­¤ï¼Œç°åœ¨å¯ä»¥ç¼–å†™ä½¿ç”¨æ­¤å­˜å‚¨åº“çš„è‡ªå®šä¹‰ç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡äº†ã€‚</p>
<p><strong>åˆ›å»ºç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡</strong></p>
<p>Spring Security çš„ UserDetailsService æ˜¯ä¸€ä¸ªç›¸å½“ç®€å•çš„æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDetailsService</span> </span>&#123;</span><br><span class="line">    <span class="function">UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ¥å£çš„å®ç°æ˜¯ç»™å®šä¸€ä¸ªç”¨æˆ·çš„ç”¨æˆ·åï¼ŒæœŸæœ›è¿”å›ä¸€ä¸ª UserDetails å¯¹è±¡ï¼Œå¦‚æœç»™å®šçš„ç”¨æˆ·åæ²¡æœ‰æ˜¾ç¤ºä»»ä½•ç»“æœï¼Œåˆ™æŠ›å‡ºä¸€ä¸ª UsernameNotFoundExceptionã€‚</p>
<p>ç”±äº User ç±»å®ç°äº† UserDetailsï¼ŒåŒæ—¶ UserRepository æä¾›äº†ä¸€ä¸ª findByUsername() æ–¹æ³•ï¼Œå› æ­¤å®ƒä»¬éå¸¸é€‚åˆåœ¨è‡ªå®šä¹‰ UserDetailsService å®ç°ä¸­ä½¿ç”¨ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.6 å®šä¹‰ç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> tacos.User;</span><br><span class="line"><span class="keyword">import</span> tacos.data.UserRepository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRepositoryUserDetailsService</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepo;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserRepositoryUserDetailsService</span><span class="params">(UserRepository userRepo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userRepo = userRepo;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line">        User user = userRepo.findByUsername(username);</span><br><span class="line">        <span class="keyword">if</span> (user != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">&quot;User &#x27;&quot;</span> + username + <span class="string">&quot;&#x27; not found&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserRepositoryUserDetailsService é€šè¿‡ UserRepository å®ä¾‹çš„æ„é€ å™¨è¿›è¡Œæ³¨å…¥ã€‚ç„¶åï¼Œåœ¨å®ƒçš„ loadByUsername() æ–¹æ³•ä¸­ï¼Œå®ƒè°ƒç”¨ UserRepository ä¸­çš„ findByUsername() æ–¹æ³•å»æŸ¥æ‰¾ Userï¼›</p>
<p>loadByUsername() æ–¹æ³•åªæœ‰ä¸€ä¸ªç®€å•çš„è§„åˆ™ï¼šä¸å…è®¸è¿”å› nullã€‚å› æ­¤å¦‚æœè°ƒç”¨ findByUsername() è¿”å› nullï¼ŒloadByUsername() å°†ä¼šæŠ›å‡ºä¸€ä¸ª UsernameNotFoundExcepitionã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¢«æ‰¾åˆ°çš„ User å°†ä¼šè¢«è¿”å›ã€‚</p>
<p> @Service æ³¨è§£æ˜¯ Spring çš„å¦ä¸€ç§æ„é€ å‹æ³¨é‡Šï¼Œå®ƒå°†è¯¥ç±»æ ‡è®°ä¸ºåŒ…å«åœ¨ Spring çš„ç»„ä»¶æ‰«æä¸­ï¼Œå› æ­¤ä¸éœ€è¦æ˜¾å¼åœ°å°†è¯¥ç±»å£°æ˜ä¸º beanã€‚Spring å°†è‡ªåŠ¨å‘ç°å®ƒå¹¶å°†å…¶å®ä¾‹åŒ–ä¸º beanã€‚</p>
<p>ä½†æ˜¯ï¼Œä»ç„¶éœ€è¦ä½¿ç”¨ Spring Security é…ç½®è‡ªå®šä¹‰ç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡ã€‚å› æ­¤ï¼Œå°†å†æ¬¡è¿”å›åˆ° configure() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth</span><br><span class="line">        .userDetailsService(userDetailsService);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ¬¡ï¼Œåªéœ€è°ƒç”¨ userDetailsService() æ–¹æ³•ï¼Œå°†è‡ªåŠ¨ç”Ÿæˆçš„ userDetailsService å®ä¾‹ä¼ é€’ç»™ SecurityConfigã€‚</p>
<p>ä¸åŸºäº JDBC çš„èº«ä»½éªŒè¯ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ï¼ˆè€Œä¸”åº”è¯¥ï¼‰é…ç½®å¯†ç ç¼–ç å™¨ï¼Œä»¥ä¾¿å¯ä»¥åœ¨æ•°æ®åº“ä¸­å¯¹å¯†ç è¿›è¡Œç¼–ç ã€‚ä¸ºæ­¤ï¼Œé¦–å…ˆå£°æ˜ä¸€ä¸ª PasswordEncoder ç±»å‹çš„beanï¼Œç„¶åé€šè¿‡è°ƒç”¨ PasswordEncoder() å°†å…¶æ³¨å…¥åˆ°ç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡é…ç½®ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PasswordEncoder <span class="title">encoder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> StandardPasswordEncoder(<span class="string">&quot;53cr3t&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth</span><br><span class="line">        .userDetailsService(userDetailsService)</span><br><span class="line">        .passwordEncoder(encoder());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¿…é¡»è®¨è®º configure() æ–¹æ³•ä¸­çš„æœ€åä¸€è¡Œï¼Œå®ƒå‡ºç°äº†è°ƒç”¨ encoder() æ–¹æ³•å¹¶å°†å…¶è¿”å›å€¼ä¼ é€’ç»™ passwordEncoder()ã€‚ä½†å®é™…ä¸Šï¼Œå› ä¸º encoder() æ–¹æ³•æ˜¯ç”¨ @Bean æ³¨é‡Šçš„ï¼Œæ‰€ä»¥å®ƒå°†è¢«ç”¨äºåœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­å£°æ˜ä¸€ä¸ª PasswordEncoder beanï¼Œç„¶åæ‹¦æˆªå¯¹ encoder() çš„ä»»ä½•è°ƒç”¨ï¼Œä»¥ä»åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è¿”å› bean å®ä¾‹ã€‚</p>
<p>æ—¢ç„¶å·²ç»æœ‰äº†ä¸€ä¸ªé€šè¿‡ JPA å­˜å‚¨åº“è¯»å–ç”¨æˆ·ä¿¡æ¯çš„è‡ªå®šä¹‰ç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡ï¼Œé‚£ä¹ˆé¦–å…ˆéœ€è¦çš„å°±æ˜¯ä¸€ç§è®©ç”¨æˆ·è¿›å…¥æ•°æ®åº“çš„æ–¹æ³•ã€‚éœ€è¦ä¸º Taco Cloud ç”¨æˆ·åˆ›å»ºä¸€ä¸ªæ³¨å†Œé¡µé¢ï¼Œä»¥ä¾¿æ³¨å†Œè¯¥åº”ç”¨ç¨‹åºã€‚</p>
<p><strong>ç”¨æˆ·æ³¨å†Œ</strong></p>
<p>å°½ç®¡ Spring Security å¤„ç†å®‰å…¨æ€§çš„å¾ˆå¤šæ–¹é¢ï¼Œä½†å®ƒå®é™…ä¸Šå¹¶ä¸ç›´æ¥æ¶‰åŠç”¨æˆ·æ³¨å†Œè¿‡ç¨‹ï¼Œå› æ­¤å°†ä¾èµ–äº Spring MVC æ¥å¤„ç†è¯¥ä»»åŠ¡ã€‚ä¸‹é¢ç¨‹åºæ¸…å•ä¸­çš„ RegistrationController ç±»å±•ç¤ºå¹¶å¤„ç†æ³¨å†Œè¡¨å•ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.7 ç”¨æˆ·æ³¨å†Œæ§åˆ¶å™¨</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> tacos.data.UserRepository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/register&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegistrationController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepo;</span><br><span class="line">    <span class="keyword">private</span> PasswordEncoder passwordEncoder;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RegistrationController</span><span class="params">(UserRepository userRepo, PasswordEncoder passwordEncoder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userRepo = userRepo;</span><br><span class="line">        <span class="keyword">this</span>.passwordEncoder = passwordEncoder;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">registerForm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;registration&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">processRegistration</span><span class="params">(RegistrationForm form)</span> </span>&#123;</span><br><span class="line">        userRepo.save(form.toUser(passwordEncoder));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/login&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ @RequestMapping è¿›è¡Œæ³¨è§£ï¼Œä»¥ä¾¿å¤„ç†è·¯å¾„ä¸º /register çš„è¯·æ±‚ã€‚</p>
<p>æ›´å…·ä½“åœ°è¯´ï¼ŒregisterForm() æ–¹æ³•å°†å¤„ç† /register çš„ GET è¯·æ±‚ï¼Œå®ƒåªè¿”å›æ³¨å†Œçš„é€»è¾‘è§†å›¾åã€‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ˜¾ç¤ºäº†å®šä¹‰æ³¨å†Œè§†å›¾çš„ Thymeleaf æ¨¡æ¿ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.8 Thymeleaf æ³¨å†Œè¡¨å•è§†å›¾</center>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Taco Cloud<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Register<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/images/TacoCloud.png&#125;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/register&#125;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;registerForm&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>Username: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>Password: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;confirm&quot;</span>&gt;</span>Confirm password: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;confirm&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;fullname&quot;</span>&gt;</span>Full name: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fullname&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;street&quot;</span>&gt;</span>Street: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;street&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;city&quot;</span>&gt;</span>City: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;city&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;state&quot;</span>&gt;</span>State: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;state&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;zip&quot;</span>&gt;</span>Zip: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;zip&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;phone&quot;</span>&gt;</span>Phone: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;phone&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Register&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æäº¤è¡¨å•æ—¶ï¼ŒHTTP POST è¯·æ±‚å°†ç”± processRegistration() æ–¹æ³•å¤„ç†ã€‚processRegistration() çš„ RegistrationForm å¯¹è±¡ç»‘å®šåˆ°è¯·æ±‚æ•°æ®ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹ç±»å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> tacos.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegistrationForm</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String fullname;</span><br><span class="line">    <span class="keyword">private</span> String street;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line">    <span class="keyword">private</span> String zip;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">toUser</span><span class="params">(PasswordEncoder passwordEncoder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(</span><br><span class="line">            username, passwordEncoder.encode(password),</span><br><span class="line">            fullname, street, city, state, zip, phone);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒRegistrationForm åªæ˜¯ä¸€ä¸ªæ”¯æŒ Lombok çš„åŸºæœ¬ç±»ï¼Œåªæœ‰å°‘é‡å±æ€§ã€‚ä½†æ˜¯ toUser() æ–¹æ³•ä½¿ç”¨è¿™äº›å±æ€§åˆ›å»ºä¸€ä¸ªæ–°çš„ User å¯¹è±¡ï¼ŒprocessRegistration() å°†ä½¿ç”¨æ³¨å…¥çš„ UserRepository ä¿å­˜è¿™ä¸ªå¯¹è±¡ã€‚</p>
<p>æ¯«æ— ç–‘é—®ï¼ŒRegistrationController è¢«æ³¨å…¥äº†ä¸€ä¸ªå¯†ç ç¼–ç å™¨ã€‚è¿™ä¸ä¹‹å‰å£°æ˜çš„ PasswordEncoder bean å®Œå…¨ç›¸åŒã€‚åœ¨å¤„ç†è¡¨å•æäº¤æ—¶ï¼ŒRegistrationController å°†å…¶ä¼ é€’ç»™ toUser() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨å®ƒå¯¹å¯†ç è¿›è¡Œç¼–ç ï¼Œç„¶åå°†å…¶ä¿å­˜åˆ°æ•°æ®åº“ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæäº¤çš„å¯†ç ä»¥ç¼–ç çš„å½¢å¼å†™å…¥ï¼Œç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡å°†èƒ½å¤Ÿæ ¹æ®ç¼–ç çš„å¯†ç è¿›è¡Œèº«ä»½éªŒè¯ã€‚</p>
<p>ç°åœ¨ Taco Cloud åº”ç”¨ç¨‹åºæ‹¥æœ‰å®Œæ•´çš„ç”¨æˆ·æ³¨å†Œå’Œèº«ä»½éªŒè¯æ”¯æŒã€‚ä½†æ˜¯å¦‚æœåœ¨æ­¤æ—¶å¯åŠ¨å®ƒï¼Œä½ ä¼šæ³¨æ„åˆ°ï¼Œå¦‚æœä¸æ˜¯æç¤ºä½ ç™»å½•ï¼Œä½ ç”šè‡³æ— æ³•è¿›å…¥æ³¨å†Œé¡µé¢ã€‚è¿™æ˜¯å› ä¸ºï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦èº«ä»½éªŒè¯ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ web è¯·æ±‚æ˜¯å¦‚ä½•è¢«æ‹¦æˆªå’Œä¿æŠ¤çš„ï¼Œä»¥ä¾¿å¯ä»¥ä¿®å¤è¿™ç§å¥‡æ€ªçš„å…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹çš„æƒ…å†µã€‚</p>
<h3 id="ä¿æŠ¤-web-è¯·æ±‚"><a href="#ä¿æŠ¤-web-è¯·æ±‚" class="headerlink" title="ä¿æŠ¤ web è¯·æ±‚"></a>ä¿æŠ¤ web è¯·æ±‚</h3><p>Taco Cloud çš„å®‰å…¨éœ€æ±‚åº”è¯¥è¦æ±‚ç”¨æˆ·åœ¨è®¾è®¡ tacos æˆ–ä¸‹è®¢å•ä¹‹å‰è¿›è¡Œèº«ä»½éªŒè¯ã€‚ä½†æ˜¯ä¸»é¡µã€ç™»å½•é¡µé¢å’Œæ³¨å†Œé¡µé¢åº”è¯¥å¯¹æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·å¯ç”¨ã€‚</p>
<p>è¦é…ç½®è¿™äº›å®‰å…¨è§„åˆ™ï¼Œéœ€è¦ä»‹ç»ä¸€ä¸‹ WebSecurityConfigurerAdapter çš„å¦ä¸€ä¸ª configure() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª configure() æ–¹æ³•æ¥å— HttpSecurity å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨è¯¥å¯¹è±¡æ¥é…ç½®å¦‚ä½•åœ¨ web çº§åˆ«å¤„ç†å®‰å…¨æ€§ã€‚å¯ä»¥é…ç½® HttpSecurity çš„å±æ€§åŒ…æ‹¬ï¼š</p>
<ul>
<li>åœ¨å…è®¸æœåŠ¡è¯·æ±‚ä¹‹å‰ï¼Œéœ€è¦æ»¡è¶³ç‰¹å®šçš„å®‰å…¨æ¡ä»¶</li>
<li>é…ç½®è‡ªå®šä¹‰ç™»å½•é¡µé¢</li>
<li>ä½¿ç”¨æˆ·èƒ½å¤Ÿé€€å‡ºåº”ç”¨ç¨‹åº</li>
<li>é…ç½®è·¨ç«™è¯·æ±‚ä¼ªé€ ä¿æŠ¤</li>
</ul>
<p>æ‹¦æˆªè¯·æ±‚ä»¥ç¡®ä¿ç”¨æˆ·æ‹¥æœ‰é€‚å½“çš„æƒé™æ˜¯é…ç½® HttpSecurity è¦åšçš„æœ€å¸¸è§çš„äº‹æƒ…ä¹‹ä¸€ã€‚è®©æˆ‘ä»¬ç¡®ä¿ Taco Cloud çš„å®¢æˆ·æ»¡è¶³è¿™äº›è¦æ±‚ã€‚</p>
<h4 id="ä¿æŠ¤è¯·æ±‚"><a href="#ä¿æŠ¤è¯·æ±‚" class="headerlink" title="ä¿æŠ¤è¯·æ±‚"></a>ä¿æŠ¤è¯·æ±‚</h4><p>éœ€è¦ç¡®ä¿ /design å’Œ /orders çš„è¯·æ±‚ä»…å¯¹ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·å¯ç”¨ï¼›åº”è¯¥å…è®¸æ‰€æœ‰ç”¨æˆ·å‘å‡ºæ‰€æœ‰å…¶ä»–è¯·æ±‚ã€‚ä¸‹é¢çš„ configure() å®ç°å°±æ˜¯è¿™æ ·åšçš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http</span><br><span class="line">        .authorizeRequests()</span><br><span class="line">            .antMatchers(<span class="string">&quot;/design&quot;</span>, <span class="string">&quot;/orders&quot;</span>)</span><br><span class="line">                .hasRole(<span class="string">&quot;ROLE_USER&quot;</span>)</span><br><span class="line">            .antMatchers(â€œ/â€, <span class="string">&quot;/**&quot;</span>).permitAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹ authorizeRequests() çš„è°ƒç”¨è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ˆExpressionInterceptUrlRegistryï¼‰ï¼Œå¯ä»¥åœ¨è¯¥å¯¹è±¡ä¸ŠæŒ‡å®š URL è·¯å¾„å’Œæ¨¡å¼ä»¥åŠè¿™äº›è·¯å¾„çš„å®‰å…¨éœ€æ±‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæŒ‡å®šä¸¤ä¸ªå®‰å…¨è§„åˆ™ï¼š</p>
<ul>
<li>å¯¹äº /design å’Œ /orders çš„è¯·æ±‚åº”è¯¥æ˜¯æˆäºˆ ROLE_USER æƒé™çš„ç”¨æˆ·çš„è¯·æ±‚ã€‚</li>
<li>æ‰€æœ‰çš„è¯·æ±‚éƒ½åº”è¯¥è¢«å…è®¸ç»™æ‰€æœ‰çš„ç”¨æˆ·ã€‚</li>
</ul>
<p>è¿™äº›è§„åˆ™çš„é¡ºåºå¾ˆé‡è¦ã€‚é¦–å…ˆå£°æ˜çš„å®‰å…¨è§„åˆ™ä¼˜å…ˆäºè¾ƒä½çº§åˆ«å£°æ˜çš„å®‰å…¨è§„åˆ™ã€‚å¦‚æœäº¤æ¢è¿™ä¸¤ä¸ªå®‰å…¨è§„åˆ™çš„é¡ºåºï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å°†åº”ç”¨ permitAll()ï¼Œé‚£ä¹ˆå…³äº /design å’Œ /orders è¯·æ±‚çš„è§„åˆ™å°†ä¸èµ·ä½œç”¨ã€‚</p>
<p>hasRole() å’Œ permitAll() æ–¹æ³•åªæ˜¯å£°æ˜è¯·æ±‚è·¯å¾„å®‰å…¨éœ€æ±‚çš„ä¸¤ä¸ªæ–¹æ³•ã€‚è¡¨ 4.1 æè¿°äº†æ‰€æœ‰å¯ç”¨çš„æ–¹æ³•ã€‚</p>
<center>è¡¨ 4.1 å®šä¹‰è¢«ä¿æŠ¤è·¯å¾„çš„é…ç½®æ–¹æ³•</center>

<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>åšäº†ä»€ä¹ˆ</th>
</tr>
</thead>
<tbody><tr>
<td>access(String)</td>
<td>å¦‚æœ SpEL è¡¨è¾¾å¼çš„å€¼ä¸º trueï¼Œåˆ™å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>anonymous()</td>
<td>é»˜è®¤ç”¨æˆ·å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>authenticated()</td>
<td>è®¤è¯ç”¨æˆ·å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>denyAll()</td>
<td>æ— æ¡ä»¶æ‹’ç»æ‰€æœ‰è®¿é—®</td>
</tr>
<tr>
<td>fullyAuthenticated()</td>
<td>å¦‚æœç”¨æˆ·æ˜¯å®Œå…¨æˆæƒçš„ï¼ˆä¸æ˜¯è®°ä½ç”¨æˆ·ï¼‰ï¼Œåˆ™å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>hasAnyAuthority(Stringâ€¦)</td>
<td>å¦‚æœç”¨æˆ·æœ‰ä»»æ„ç»™å®šçš„æƒé™ï¼Œåˆ™å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>hasAnyRole(Stringâ€¦)</td>
<td>å¦‚æœç”¨æˆ·æœ‰ä»»æ„ç»™å®šçš„è§’è‰²ï¼Œåˆ™å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>hasAuthority(String)</td>
<td>å¦‚æœç”¨æˆ·æœ‰ç»™å®šçš„æƒé™ï¼Œåˆ™å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>hasIpAddress(String)</td>
<td>æ¥è‡ªç»™å®š IP åœ°å€çš„è¯·æ±‚å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>hasRole(String)</td>
<td>å¦‚æœç”¨æˆ·æœ‰ç»™å®šçš„è§’è‰²ï¼Œåˆ™å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>not()</td>
<td>æ‹’ç»ä»»ä½•å…¶ä»–è®¿é—®æ–¹æ³•</td>
</tr>
<tr>
<td>permitAll()</td>
<td>æ— æ¡ä»¶å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>rememberMe()</td>
<td>å…è®¸è®¤è¯äº†çš„åŒæ—¶æ ‡è®°äº†è®°ä½æˆ‘çš„ç”¨æˆ·è®¿é—®</td>
</tr>
</tbody></table>
<p>è¡¨ 4.1 ä¸­çš„å¤§å¤šæ•°æ–¹æ³•ä¸ºè¯·æ±‚å¤„ç†æä¾›äº†åŸºæœ¬çš„å®‰å…¨è§„åˆ™ï¼Œä½†æ˜¯å®ƒä»¬æ˜¯è‡ªæˆ‘é™åˆ¶çš„ï¼Œåªæ”¯æŒé‚£äº›æ–¹æ³•å®šä¹‰çš„å®‰å…¨è§„åˆ™ã€‚æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨ access() æ–¹æ³•æä¾› SpEL è¡¨è¾¾å¼æ¥å£°æ˜æ›´ä¸°å¯Œçš„å®‰å…¨è§„åˆ™ã€‚Spring Security æ‰©å±•äº† SpELï¼ŒåŒ…æ‹¬å‡ ä¸ªç‰¹å®šäºå®‰å…¨æ€§çš„å€¼å’Œå‡½æ•°ï¼Œå¦‚è¡¨ 4.2 æ‰€ç¤ºã€‚</p>
<center>è¡¨ 4.2 Spring Security å¯¹ SpEL çš„æ‰©å±•</center>

<table>
<thead>
<tr>
<th>Security è¡¨è¾¾å¼</th>
<th>æ„æŒ‡ä»€ä¹ˆ</th>
</tr>
</thead>
<tbody><tr>
<td>authentication</td>
<td>ç”¨æˆ·è®¤è¯å¯¹è±¡</td>
</tr>
<tr>
<td>denyAll</td>
<td>é€šå¸¸å€¼ä¸º false</td>
</tr>
<tr>
<td>hasAnyRole(list of roles)</td>
<td>å¦‚æœç”¨æˆ·æœ‰ä»»ä½•ç»™å®šçš„è§’è‰²ï¼Œåˆ™ä¸º true</td>
</tr>
<tr>
<td>hasRole(role)</td>
<td>å¦‚æœç”¨æˆ·æœ‰ç»™å®šçš„è§’è‰²ï¼Œåˆ™ä¸º true</td>
</tr>
<tr>
<td>hasIpAddress(IP Address)</td>
<td>å¦‚æœè¯·æ±‚æ¥è‡ªç»™å®š IP åœ°å€ï¼Œåˆ™ä¸º true</td>
</tr>
<tr>
<td>isAnonymous()</td>
<td>å¦‚æœç”¨æˆ·æ˜¯é»˜è®¤ç”¨æˆ·ï¼Œåˆ™ä¸º true</td>
</tr>
<tr>
<td>isAuthenticated()</td>
<td>å¦‚æœç”¨æˆ·æ˜¯è®¤è¯äº†çš„ï¼Œåˆ™ä¸º true</td>
</tr>
<tr>
<td>isFullyAuthenticated()</td>
<td>å¦‚æœç”¨æˆ·è¢«å®Œå…¨è®¤è¯äº†çš„ï¼ˆä¸æ˜¯ä½¿ç”¨è®°ä½æˆ‘è¿›è¡Œè®¤è¯ï¼‰ï¼Œåˆ™ä¸º true</td>
</tr>
<tr>
<td>isRememberMe()</td>
<td>å¦‚æœç”¨æˆ·è¢«æ ‡è®°ä¸ºè®°ä½æˆ‘åè®¤è¯äº†ï¼Œåˆ™ä¸º true</td>
</tr>
<tr>
<td>permitAll()</td>
<td>é€šå¸¸å€¼ä¸º true</td>
</tr>
<tr>
<td>principal</td>
<td>ç”¨æˆ· pricipal å¯¹è±¡</td>
</tr>
</tbody></table>
<p>è¡¨ 4.2 ä¸­çš„å¤§å¤šæ•°å®‰å…¨è¡¨è¾¾å¼æ‰©å±•å¯¹åº”äºè¡¨ 4.1 ä¸­çš„ç±»ä¼¼æ–¹æ³•ã€‚å®é™…ä¸Šï¼Œä½¿ç”¨ access() æ–¹æ³•ä»¥åŠ hasRole() å’Œ permitAll è¡¨è¾¾å¼ï¼Œå¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼é‡å†™ configure()ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.9 ä½¿ç”¨ Spring è¡¨è¾¾å¼å®šä¹‰è®¤è¯è§„åˆ™</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http</span><br><span class="line">        .authorizeRequests()</span><br><span class="line">        .antMatchers(<span class="string">&quot;/design&quot;</span>, <span class="string">&quot;/orders&quot;</span>)</span><br><span class="line">            .access(<span class="string">&quot;hasRole(&#x27;ROLE_USER&#x27;)&quot;</span>)</span><br><span class="line">        .antMatchers(â€œ/â€, <span class="string">&quot;/**&quot;</span>).access(<span class="string">&quot;permitAll&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹ä¸€çœ‹ï¼Œè¿™ä¼¼ä¹æ²¡ä»€ä¹ˆå¤§ä¸äº†çš„ã€‚æ¯•ç«Ÿï¼Œè¿™äº›è¡¨è¾¾å¼åªåæ˜ äº†å·²ç»å¯¹æ–¹æ³•è°ƒç”¨æ‰€åšçš„å·¥ä½œã€‚ä½†æ˜¯è¡¨è¾¾å¼å¯ä»¥çµæ´»å¾—å¤šã€‚ä¾‹å¦‚ï¼Œå‡è®¾ï¼ˆå‡ºäºæŸç§ç–¯ç‹‚çš„åŸå› ï¼‰åªæƒ³å…è®¸å…·æœ‰ ROLE_USER æƒé™çš„ç”¨æˆ·åœ¨å‘¨äºŒï¼ˆä¾‹å¦‚ï¼Œåœ¨å‘¨äºŒï¼‰åˆ›å»ºæ–°çš„ Tacoï¼›ä½ å¯ä»¥é‡å†™è¡¨è¾¾å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http</span><br><span class="line">        .authorizeRequests()</span><br><span class="line">        .antMatchers(<span class="string">&quot;/design&quot;</span>, <span class="string">&quot;/orders&quot;</span>)</span><br><span class="line">        .access(<span class="string">&quot;hasRole(&#x27;ROLE_USER&#x27;) &amp;&amp; &quot;</span> +</span><br><span class="line">                <span class="string">&quot;T(java.util.Calendar).getInstance().get(&quot;</span>+</span><br><span class="line">                <span class="string">&quot;T(java.util.Calendar).DAY_OF_WEEK) == &quot;</span> +</span><br><span class="line">                <span class="string">&quot;T(java.util.Calendar).TUESDAY&quot;</span>)</span><br><span class="line">        .antMatchers(â€œ/â€, <span class="string">&quot;/**&quot;</span>).access(<span class="string">&quot;permitAll&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨åŸºäº SpEL çš„å®‰å…¨çº¦æŸï¼Œè¿™ç§å¯èƒ½æ€§å®é™…ä¸Šæ˜¯æ— é™çš„ã€‚æˆ‘æ•¢æ‰“èµŒï¼Œä½ å·²ç»åœ¨æ„æ€åŸºäº SpEL çš„æœ‰è¶£çš„å®‰å…¨çº¦æŸäº†ã€‚</p>
<p>åªéœ€ä½¿ç”¨ access() å’Œç¨‹åºæ¸…å• 4.9 ä¸­çš„ SpEL è¡¨è¾¾å¼ï¼Œå°±å¯ä»¥æ»¡è¶³ Taco Cloud åº”ç”¨ç¨‹åºçš„æˆæƒéœ€æ±‚ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å®šåˆ¶ç™»å½•é¡µé¢æ¥é€‚åº” Taco Cloud åº”ç”¨ç¨‹åºçš„å¤–è§‚ã€‚</p>
<h4 id="åˆ›å»ºç”¨æˆ·ç™»å½•é¡µé¢"><a href="#åˆ›å»ºç”¨æˆ·ç™»å½•é¡µé¢" class="headerlink" title="åˆ›å»ºç”¨æˆ·ç™»å½•é¡µé¢"></a>åˆ›å»ºç”¨æˆ·ç™»å½•é¡µé¢</h4><p>é»˜è®¤çš„ç™»å½•é¡µé¢æ¯”ä½ å¼€å§‹æ—¶ä½¿ç”¨çš„ç¬¨æ‹™çš„ HTTP åŸºæœ¬å¯¹è¯æ¡†è¦å¥½å¾—å¤šï¼Œä½†å®ƒä»ç„¶ç›¸å½“ç®€å•ï¼Œä¸å¤ªé€‚åˆ Taco Cloud åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†ã€‚</p>
<p>è¦æ›¿æ¢å†…ç½®çš„ç™»å½•é¡µé¢ï¼Œé¦–å…ˆéœ€è¦å‘Šè¯‰ Spring Security è‡ªå®šä¹‰ç™»å½•é¡µé¢çš„è·¯å¾„ã€‚è¿™å¯ä»¥é€šè¿‡è°ƒç”¨ä¼ é€’ç»™ configure() çš„ HttpSecurity å¯¹è±¡ä¸Šçš„ formLogin() æ¥å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http</span><br><span class="line">        .authorizeRequests()</span><br><span class="line">        .antMatchers(<span class="string">&quot;/design&quot;</span>, <span class="string">&quot;/orders&quot;</span>)</span><br><span class="line">        .access(<span class="string">&quot;hasRole(&#x27;ROLE_USER&#x27;)&quot;</span>)</span><br><span class="line">        .antMatchers(â€œ/â€, <span class="string">&quot;/**&quot;</span>).access(<span class="string">&quot;permitAll&quot;</span>)</span><br><span class="line">        .and()</span><br><span class="line">        .formLogin()</span><br><span class="line">        .loginPage(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯·æ³¨æ„ï¼Œåœ¨è°ƒç”¨ formLogin() ä¹‹å‰ï¼Œéœ€è¦ä½¿ç”¨å¯¹ and() çš„è°ƒç”¨æ¥è¿æ¥è¿™ä¸€éƒ¨åˆ†çš„é…ç½®å’Œå‰é¢çš„éƒ¨åˆ†ã€‚and() æ–¹æ³•è¡¨ç¤ºå·²ç»å®Œæˆäº†æˆæƒé…ç½®ï¼Œå¹¶å‡†å¤‡åº”ç”¨ä¸€äº›é¢å¤–çš„ HTTP é…ç½®ã€‚åœ¨å¼€å§‹æ–°çš„é…ç½®éƒ¨åˆ†æ—¶ï¼Œå°†å¤šæ¬¡ä½¿ç”¨ and()ã€‚</p>
<p>è¿æ¥ä¹‹åï¼Œè°ƒç”¨ formLogin() å¼€å§‹é…ç½®è‡ªå®šä¹‰ç™»å½•è¡¨å•ã€‚ä¹‹åå¯¹ loginPage() çš„è°ƒç”¨æŒ‡å®šäº†å°†æä¾›è‡ªå®šä¹‰ç™»å½•é¡µé¢çš„è·¯å¾„ã€‚å½“ Spring Security ç¡®å®šç”¨æˆ·æœªç»èº«ä»½éªŒè¯å¹¶ä¸”éœ€è¦ç™»å½•æ—¶ï¼Œå®ƒå°†æŠŠç”¨æˆ·é‡å®šå‘åˆ°æ­¤è·¯å¾„ã€‚</p>
<p>ç°åœ¨éœ€è¦æä¾›ä¸€ä¸ªæ§åˆ¶å™¨æ¥å¤„ç†è¯¥è·¯å¾„ä¸Šçš„è¯·æ±‚ã€‚å› ä¸ºä½ çš„ç™»å½•é¡µé¢éå¸¸ç®€å• â€”â€” é™¤äº†ä¸€ä¸ªè§†å›¾ä»€ä¹ˆéƒ½æ²¡æœ‰ â€”â€” åœ¨ WebConfig ä¸­å£°æ˜å®ƒä¸ºä¸€ä¸ªè§†å›¾æ§åˆ¶å™¨æ˜¯å¾ˆå®¹æ˜“çš„ã€‚ä¸‹é¢çš„ addViewControllers() æ–¹æ³•åœ¨å°† â€œ/â€ æ˜ å°„åˆ°ä¸»æ§åˆ¶å™¨çš„è§†å›¾æ§åˆ¶å™¨æ—è¾¹è®¾ç½®ç™»å½•é¡µé¢è§†å›¾æ§åˆ¶å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">    registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;home&quot;</span>);</span><br><span class="line">    registry.addViewController(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œéœ€è¦å®šä¹‰ login é¡µé¢è§†å›¾æœ¬èº«ï¼Œå› ä¸ºä½¿ç”¨ Thymeleaf ä½œä¸ºæ¨¡æ¿å¼•æ“ï¼Œä¸‹é¢çš„ Thymeleaf æ¨¡æ¿åº”è¯¥åšå¾—å¾ˆå¥½ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Taco Cloud<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/images/TacoCloud.png&#125;&quot;</span>/&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;error&#125;&quot;</span>&gt;</span></span><br><span class="line">            Unable to login. Check your username and password.</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>New here? Click<span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/register&#125;&quot;</span>&gt;</span>here<span class="tag">&lt;/<span class="name">a</span>&gt;</span> to register.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- tag::thAction[] --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/login&#125;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;loginForm&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- end::thAction[] --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>Username: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>Password: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Login&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å…³äºè¿™ä¸ªç™»å½•é¡µé¢éœ€è¦æ³¨æ„çš„å…³é”®äº‹æƒ…æ˜¯ï¼Œå®ƒå‘å¸ƒåˆ°çš„è·¯å¾„ä»¥åŠç”¨æˆ·åå’Œå¯†ç å­—æ®µçš„åç§°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Security åœ¨ /login ç›‘å¬ç™»å½•è¯·æ±‚ï¼Œå¹¶æœŸæœ›ç”¨æˆ·åå’Œå¯†ç å­—æ®µå‘½åä¸º username å’Œ passwordã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯å¯é…ç½®çš„ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹é…ç½®è‡ªå®šä¹‰è·¯å¾„å’Œå­—æ®µåï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.and()</span><br><span class="line">    .formLogin()</span><br><span class="line">        .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">        .loginProcessingUrl(<span class="string">&quot;/authenticate&quot;</span>)</span><br><span class="line">        .usernameParameter(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">        .passwordParameter(<span class="string">&quot;pwd&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œï¼ŒæŒ‡å®š Spring Security åº”è¯¥ç›‘å¬è¯·æ±‚ /authenticate è¯·æ±‚ä»¥å¤„ç†ç™»å½•æäº¤ã€‚æ­¤å¤–ï¼Œç”¨æˆ·åå’Œå¯†ç å­—æ®µç°åœ¨åº”è¯¥å‘½åä¸º user å’Œ pwdã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ Spring Security ç¡®å®šç”¨æˆ·éœ€è¦ç™»å½•æ—¶ï¼ŒæˆåŠŸçš„ç™»å½•å°†ç›´æ¥å°†ç”¨æˆ·å¸¦åˆ°ä»–ä»¬æ‰€å¯¼èˆªåˆ°çš„é¡µé¢ã€‚å¦‚æœç”¨æˆ·è¦ç›´æ¥å¯¼èˆªåˆ°ç™»å½•é¡µé¢ï¼ŒæˆåŠŸçš„ç™»å½•å°†æŠŠä»–ä»¬å¸¦åˆ°æ ¹è·¯å¾„ï¼ˆä¾‹å¦‚ï¼Œä¸»é¡µï¼‰ã€‚ä½†ä½ å¯ä»¥é€šè¿‡æŒ‡å®šä¸€ä¸ªé»˜è®¤çš„æˆåŠŸé¡µé¢æ¥æ”¹å˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.and()</span><br><span class="line">    .formLogin()</span><br><span class="line">        .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">        .defaultSuccessUrl(<span class="string">&quot;/design&quot;</span>)</span><br></pre></td></tr></table></figure>



<p>æŒ‰ç…§è¿™é‡Œçš„é…ç½®ï¼Œå¦‚æœç”¨æˆ·åœ¨ç›´æ¥è¿›å…¥ç™»å½•é¡µé¢åæˆåŠŸç™»å½•ï¼Œé‚£ä¹ˆä»–ä»¬å°†è¢«å¼•å¯¼åˆ° /design é¡µé¢ã€‚</p>
<p>å¦å¤–ï¼Œå¯ä»¥å¼ºåˆ¶ç”¨æˆ·åœ¨ç™»å½•åè¿›å…¥è®¾è®¡é¡µé¢ï¼Œå³ä½¿ä»–ä»¬åœ¨ç™»å½•ä¹‹å‰å·²ç»åœ¨å…¶ä»–åœ°æ–¹å¯¼èˆªï¼Œæ–¹æ³•æ˜¯å°† true ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™ defaultSuccessUrlï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.and()</span><br><span class="line">    .formLogin()</span><br><span class="line">        .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">        .defaultSuccessUrl(<span class="string">&quot;/design&quot;</span>, <span class="keyword">true</span>)</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å·²ç»å¤„ç†äº†è‡ªå®šä¹‰ç™»å½•é¡µé¢ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹èº«ä»½éªŒè¯çš„å¦ä¸€é¢ â€”â€” å¦‚ä½•è®©ç”¨æˆ·ç™»å‡ºã€‚</p>
<h4 id="ç™»å‡º"><a href="#ç™»å‡º" class="headerlink" title="ç™»å‡º"></a>ç™»å‡º</h4><p>ä¸ç™»å½•åº”ç”¨ç¨‹åºåŒæ ·é‡è¦çš„æ˜¯ç™»å‡ºã€‚è¦å¯ç”¨ç™»å‡ºåŠŸèƒ½ï¼Œåªéœ€è°ƒç”¨ HttpSecurity å¯¹è±¡ä¸Šçš„ logoutï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.and()</span><br><span class="line">    .logout()</span><br><span class="line">        .logoutSuccessUrl(<span class="string">&quot;/&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™å°†è®¾ç½®ä¸€ä¸ªå®‰å…¨ç­›é€‰å™¨æ¥æ‹¦æˆªå‘é€åˆ° /logout çš„è¯·æ±‚ã€‚å› æ­¤ï¼Œè¦æä¾›ç™»å‡ºåŠŸèƒ½ï¼Œåªéœ€åœ¨åº”ç”¨ç¨‹åºçš„è§†å›¾ä¸­æ·»åŠ ç™»å‡ºè¡¨å•å’ŒæŒ‰é’®ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/logout&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Logout&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ç”¨æˆ·å•å‡»æŒ‰é’®æ—¶ï¼Œä»–ä»¬çš„ session å°†è¢«æ¸…é™¤ï¼Œä»–ä»¬å°†é€€å‡ºåº”ç”¨ç¨‹åºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬å°†è¢«é‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼Œåœ¨é‚£é‡Œå®ƒä»¬å¯ä»¥å†æ¬¡ç™»å½•ã€‚ä½†æ˜¯ï¼Œå¦‚æœå¸Œæœ›å®ƒä»¬è¢«å‘é€åˆ°å¦ä¸€ä¸ªé¡µé¢ï¼Œå¯ä»¥è°ƒç”¨ logoutSucessFilter() æ¥æŒ‡å®šä¸€ä¸ªä¸åŒçš„ç™»å‡ºåçš„ç™»å½•é¡µé¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.and()</span><br><span class="line">    .logout()</span><br><span class="line">        .logoutSuccessUrl(<span class="string">&quot;/&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”¨æˆ·åœ¨ç™»å‡ºåå°†è¢«è·³è½¬åˆ°ä¸»é¡µã€‚</p>
<h4 id="é˜»æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»"><a href="#é˜»æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»" class="headerlink" title="é˜»æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»"></a>é˜»æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»</h4><p>è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰æ˜¯ä¸€ç§å¸¸è§çš„å®‰å…¨æ”»å‡»ã€‚å®ƒæ¶‰åŠåˆ°è®©ç”¨æˆ·åœ¨ä¸€ä¸ªæ¶æ„è®¾è®¡çš„ web é¡µé¢ä¸Šç¼–å†™ä»£ç ï¼Œè¿™ä¸ªé¡µé¢ä¼šè‡ªåŠ¨ï¼ˆé€šå¸¸æ˜¯ç§˜å¯†åœ°ï¼‰ä»£è¡¨ç»å¸¸é­å—æ”»å‡»çš„ç”¨æˆ·å‘å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºæäº¤ä¸€ä¸ªè¡¨å•ã€‚ä¾‹å¦‚ï¼Œåœ¨æ”»å‡»è€…çš„ç½‘ç«™ä¸Šï¼Œå¯èƒ½ä¼šå‘ç”¨æˆ·æ˜¾ç¤ºä¸€ä¸ªè¡¨å•ï¼Œè¯¥è¡¨å•ä¼šè‡ªåŠ¨å‘ç”¨æˆ·é“¶è¡Œç½‘ç«™ä¸Šçš„ä¸€ä¸ª URL å‘é€æ¶ˆæ¯ï¼ˆè¯¥ç½‘ç«™çš„è®¾è®¡å¯èƒ½å¾ˆç³Ÿç³•ï¼Œå¾ˆå®¹æ˜“å—åˆ°è¿™ç§æ”»å‡»ï¼‰ï¼Œä»¥è½¬ç§»èµ„é‡‘ã€‚ç”¨æˆ·ç”šè‡³å¯èƒ½ä¸çŸ¥é“æ”»å‡»å‘ç”Ÿäº†ï¼Œç›´åˆ°ä»–ä»¬æ³¨æ„åˆ°ä»–ä»¬çš„å¸æˆ·ä¸­å°‘äº†é’±ã€‚</p>
<p>ä¸ºäº†é˜²æ­¢æ­¤ç±»æ”»å‡»ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åœ¨æ˜¾ç¤ºè¡¨å•æ—¶ç”Ÿæˆ CSRF tokenï¼Œå°†è¯¥ token æ”¾åœ¨éšè—å­—æ®µä¸­ï¼Œç„¶åå°†å…¶å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šä¾›ä»¥åä½¿ç”¨ã€‚æäº¤è¡¨å•æ—¶ï¼Œtoken å°†ä¸å…¶ä»–è¡¨å•æ•°æ®ä¸€èµ·å‘é€å›æœåŠ¡å™¨ã€‚ç„¶åæœåŠ¡å™¨æ‹¦æˆªè¯·æ±‚ï¼Œå¹¶ä¸æœ€åˆç”Ÿæˆçš„ token è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœ token åŒ¹é…ï¼Œåˆ™å…è®¸ç»§ç»­æ‰§è¡Œè¯·æ±‚ã€‚å¦åˆ™ï¼Œè¡¨å•ä¸€å®šæ˜¯ç”±ä¸€ä¸ªä¸çŸ¥é“æœåŠ¡å™¨ç”Ÿæˆçš„ tokençš„æ¶æ„ç½‘ç«™å‘ˆç°çš„ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼ŒSpring Security æœ‰å†…ç½®çš„ CSRF ä¿æŠ¤ã€‚æ›´å¹¸è¿çš„æ˜¯ï¼Œå®ƒæ˜¯é»˜è®¤å¯ç”¨çš„ï¼Œä¸éœ€è¦æ˜¾å¼åœ°é…ç½®å®ƒã€‚åªéœ€ç¡®ä¿åº”ç”¨ç¨‹åºæäº¤çš„ä»»ä½•è¡¨å•éƒ½åŒ…å«ä¸€ä¸ªåä¸º _csrf çš„å­—æ®µï¼Œè¯¥å­—æ®µåŒ…å« CSRF tokenã€‚</p>
<p>Spring Security ç”šè‡³å¯ä»¥é€šè¿‡å°† CSRF token æ”¾åœ¨åä¸º _csrf çš„è¯·æ±‚å±æ€§ä¸­æ¥ç®€åŒ–è¿™ä¸€è¿‡ç¨‹ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼Œåœ¨ Thymeleaf æ¨¡æ¿çš„ä¸€ä¸ªéšè—å­—æ®µä¸­å‘ˆç° CSRF tokenï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_csrf&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;_csrf.token&#125;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½¿ç”¨ Spring MVC çš„ JSP æ ‡ç­¾åº“æˆ–å¸¦æœ‰ Spring å®‰å…¨æ–¹è¨€çš„ Thymeleafï¼Œé‚£ä¹ˆç”šè‡³ä¸éœ€è¦æ˜¾å¼åœ°åŒ…å«ä¸€ä¸ªéšè—å­—æ®µï¼Œéšè—å­—æ®µå°†è‡ªåŠ¨å‘ˆç°ã€‚</p>
<p>åœ¨ Thymeleaf ä¸­ï¼Œåªéœ€ç¡®ä¿ <code>&lt;form&gt; </code>å…ƒç´ çš„ä¸€ä¸ªå±æ€§è¢«å‰ç¼€ä¸º Thymeleaf å±æ€§ã€‚å› ä¸ºè®© Thymeleaf å°†è·¯å¾„å‘ˆç°ä¸ºä¸Šä¸‹æ–‡ç›¸å…³æ˜¯å¾ˆå¸¸è§çš„ï¼Œæ‰€ä»¥è¿™é€šå¸¸ä¸æ˜¯é—®é¢˜ã€‚ä¾‹å¦‚ï¼ŒThymeleaf æ¸²æŸ“éšè—å­—æ®µæ‰€éœ€è¦çš„ä»…ä»…æ˜¯ th:action å±æ€§ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/login&#125;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;loginForm&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ä¹Ÿå¯ä»¥ç¦ç”¨ CSRF æ”¯æŒï¼Œä½†æˆ‘ä¸å¤ªæ„¿æ„å±•ç¤ºå¦‚ä½•ç¦ç”¨ã€‚CSRF ä¿æŠ¤å¾ˆé‡è¦ï¼Œè€Œä¸”åœ¨è¡¨å•ä¸­å¾ˆå®¹æ˜“å¤„ç†ï¼Œæ‰€ä»¥æ²¡æœ‰ç†ç”±ç¦ç”¨å®ƒï¼Œä½†å¦‚æœä½ åšæŒç¦ç”¨å®ƒï¼Œä½ å¯ä»¥è¿™æ ·è°ƒç”¨ disable()ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.and()</span><br><span class="line">    .csrf()</span><br><span class="line">        .disable()</span><br></pre></td></tr></table></figure>

<p>æˆ‘å†æ¬¡æé†’ä½ ä¸è¦ç¦ç”¨ CSRF ä¿æŠ¤ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç”Ÿäº§ç¯å¢ƒä¸­çš„åº”ç”¨ç¨‹åºã€‚</p>
<p>æ‰€æœ‰ web å±‚å®‰å…¨æ€§ç°åœ¨éƒ½é…ç½®åˆ° Taco Cloud äº†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç°åœ¨æœ‰äº†ä¸€ä¸ªè‡ªå®šä¹‰ç™»å½•é¡µé¢ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ ¹æ® JPA æ”¯æŒçš„ç”¨æˆ·å­˜å‚¨åº“å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•è·å–æœ‰å…³ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ã€‚</p>
<h3 id="äº†è§£ä½ çš„ç”¨æˆ·"><a href="#äº†è§£ä½ çš„ç”¨æˆ·" class="headerlink" title="äº†è§£ä½ çš„ç”¨æˆ·"></a>äº†è§£ä½ çš„ç”¨æˆ·</h3><p>é€šå¸¸ï¼Œä»…ä»…çŸ¥é“ç”¨æˆ·å·²ç»ç™»å½•æ˜¯ä¸å¤Ÿçš„ã€‚é€šå¸¸é‡è¦çš„æ˜¯è¦çŸ¥é“ä»–ä»¬æ˜¯è°ï¼Œè¿™æ ·æ‰èƒ½è°ƒæ•´ä»–ä»¬çš„ä½“éªŒã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ OrderController ä¸­ï¼Œå½“æœ€åˆåˆ›å»ºç»‘å®šåˆ°è®¢å•è¡¨å•çš„è®¢å•å¯¹è±¡æ—¶ï¼Œå¦‚æœèƒ½å¤Ÿç”¨ç”¨æˆ·åå’Œåœ°å€é¢„å…ˆå¡«å……è®¢å•å°±æ›´å¥½äº†ï¼Œè¿™æ ·ä»–ä»¬å°±ä¸å¿…ä¸ºæ¯ä¸ªè®¢å•é‡æ–°è¾“å…¥å®ƒã€‚ä¹Ÿè®¸æ›´é‡è¦çš„æ˜¯ï¼Œåœ¨ä¿å­˜è®¢å•æ—¶ï¼Œåº”è¯¥å°†è®¢å•å®ä½“ä¸åˆ›å»ºè®¢å•çš„ç”¨æˆ·å…³è”èµ·æ¥ã€‚</p>
<p>ä¸ºäº†åœ¨ Order å®ä½“å’Œ User å®ä½“ä¹‹é—´å®ç°æ‰€éœ€çš„è¿æ¥ï¼Œéœ€è¦å‘ Order ç±»æ·»åŠ ä¸€ä¸ªæ–°å±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name=&quot;Taco_Order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤å±æ€§ä¸Šçš„ @ManyToOne æ³¨è§£è¡¨æ˜ä¸€ä¸ªè®¢å•å±äºå•ä¸ªç”¨æˆ·ï¼Œç›¸åï¼Œä¸€ä¸ªç”¨æˆ·å¯èƒ½æœ‰å¤šä¸ªè®¢å•ã€‚</p>
<p>åœ¨ OrderController ä¸­ï¼ŒprocessOrder() æ–¹æ³•è´Ÿè´£ä¿å­˜è®¢å•ã€‚éœ€è¦å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥ç¡®å®šç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ˜¯è°ï¼Œå¹¶è°ƒç”¨ Order å¯¹è±¡ä¸Šçš„ setUser() ä»¥å°† Order ä¸è¯¥ç”¨æˆ·è¿æ¥èµ·æ¥ã€‚</p>
<p>æœ‰å‡ ç§æ–¹æ³•å¯ä»¥ç¡®å®šç”¨æˆ·æ˜¯è°ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æœ€å¸¸è§çš„æ–¹æ³•ï¼š</p>
<ul>
<li>å°†ä¸»ä½“å¯¹è±¡æ³¨å…¥æ§åˆ¶å™¨æ–¹æ³•</li>
<li>å°†èº«ä»½éªŒè¯å¯¹è±¡æ³¨å…¥æ§åˆ¶å™¨æ–¹æ³•</li>
<li>ä½¿ç”¨ SecurityContext è·å–å®‰å…¨ä¸Šä¸‹æ–‡</li>
<li>ä½¿ç”¨ @AuthenticationPrincipal æ³¨è§£çš„æ–¹æ³•</li>
</ul>
<p>ä¾‹å¦‚ï¼Œå¯ä»¥ä¿®æ”¹ processOrder() æ¥æ¥å— java.security.Principal ä½œä¸ºå‚æ•°ã€‚ç„¶åå¯ä»¥ä½¿ç”¨ä¸»ä½“åä» UserRepository æŸ¥æ‰¾ç”¨æˆ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">processOrder</span><span class="params">(<span class="meta">@Valid</span> Order order, Errors errors,</span></span></span><br><span class="line"><span class="params"><span class="function">                           SessionStatus sessionStatus,</span></span></span><br><span class="line"><span class="params"><span class="function">                           Principal principal)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    User user = userRepository.findByUsername(principal.getName());</span><br><span class="line">    order.setUser(user);</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™å¯ä»¥å¾ˆå¥½åœ°å·¥ä½œï¼Œä½†æ˜¯å®ƒä¼šå°†ä¸å®‰å…¨æ€§æ— å…³çš„ä»£ç ä¸å®‰å…¨ä»£ç ä¸€èµ·ä¸¢å¼ƒã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹ processOrder() æ¥å‡å°‘ä¸€äº›ç‰¹å®šäºå®‰å…¨çš„ä»£ç ï¼Œä»¥æ¥å— Authentication å¯¹è±¡ä½œä¸ºå‚æ•°è€Œä¸æ˜¯ Principalï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">processOrder</span><span class="params">(<span class="meta">@Valid</span> Order order, Errors errors,</span></span></span><br><span class="line"><span class="params"><span class="function">                           SessionStatus sessionStatus,</span></span></span><br><span class="line"><span class="params"><span class="function">                           Authentication authentication)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">    User user = (User) authentication.getPrincipal();</span><br><span class="line">    order.setUser(user);</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰äº†èº«ä»½éªŒè¯ï¼Œå¯ä»¥è°ƒç”¨ getPrincipal() æ¥è·å–ä¸»ä½“å¯¹è±¡ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œè¯¥å¯¹è±¡æ˜¯ä¸€ä¸ªç”¨æˆ·ã€‚æ³¨æ„ï¼ŒgetPrincipal() è¿”å›ä¸€ä¸ª java.util.Objectï¼Œå› æ­¤éœ€è¦å°†å…¶è½¬æ¢ä¸º Userã€‚</p>
<p>ç„¶è€Œï¼Œä¹Ÿè®¸æœ€å¹²å‡€çš„è§£å†³æ–¹æ¡ˆæ˜¯ç®€å•åœ°æ¥å— processOrder() ä¸­çš„ç”¨æˆ·å¯¹è±¡ï¼Œä½†æ˜¯ä½¿ç”¨ @AuthenticationPrincipal å¯¹å…¶è¿›è¡Œæ³¨è§£ï¼Œä»¥ä¾¿å®ƒæˆä¸ºèº«ä»½éªŒè¯çš„ä¸»ä½“ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">processOrder</span><span class="params">(<span class="meta">@Valid</span> Order order, Errors errors,</span></span></span><br><span class="line"><span class="params"><span class="function">                           SessionStatus sessionStatus,</span></span></span><br><span class="line"><span class="params"><span class="function">                           <span class="meta">@AuthenticationPrincipal</span> User user)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (errors.hasErrors()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;orderForm&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    order.setUser(user);</span><br><span class="line">    </span><br><span class="line">    orderRepo.save(order);</span><br><span class="line">    sessionStatus.setComplete();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@AuthenticationPrincipal çš„ä¼˜ç‚¹åœ¨äºå®ƒä¸éœ€è¦å¼ºåˆ¶è½¬æ¢ï¼ˆä¸èº«ä»½éªŒè¯ä¸€æ ·ï¼‰ï¼Œå¹¶ä¸”å°†ç‰¹å®šäºå®‰å…¨æ€§çš„ä»£ç é™åˆ¶ä¸ºæ³¨é‡Šæœ¬èº«ã€‚å½“åœ¨ processOrder() ä¸­è·å¾— User å¯¹è±¡æ—¶ï¼Œå®ƒå·²ç»å‡†å¤‡å¥½è¢«ä½¿ç”¨å¹¶åˆ†é…ç»™è®¢å•äº†ã€‚</p>
<p>è¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è¯†åˆ«é€šè¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ˜¯è°ï¼Œå°½ç®¡è¿™ç§æ–¹æ³•æœ‰ç‚¹éº»çƒ¦ï¼Œå› ä¸ºå®ƒåŒ…å«äº†å¤§é‡ä¸å®‰å…¨ç›¸å…³çš„ä»£ç ã€‚ä½ å¯ä»¥ä»å®‰å…¨ä¸Šä¸‹æ–‡è·å–ä¸€ä¸ªè®¤è¯å¯¹è±¡ï¼Œç„¶ååƒè¿™æ ·è¯·æ±‚å®ƒçš„ä¸»ä½“ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Authentication authentication =</span><br><span class="line">    SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">User user = (User) authentication.getPrincipal();</span><br></pre></td></tr></table></figure>

<p>å°½ç®¡è¿™ä¸ªä»£ç æ®µå……æ»¡äº†ä¸å®‰å…¨ç›¸å…³çš„ä»£ç ï¼Œä½†æ˜¯å®ƒä¸æ‰€æè¿°çš„å…¶ä»–æ–¹æ³•ç›¸æ¯”æœ‰ä¸€ä¸ªä¼˜ç‚¹ï¼šå®ƒå¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨æ§åˆ¶å™¨çš„å¤„ç†ç¨‹åºæ–¹æ³•ä¸­ï¼Œè¿™ä½¿å¾—å®ƒé€‚åˆåœ¨è¾ƒä½çº§åˆ«çš„ä»£ç ä¸­ä½¿ç”¨ã€‚</p>
<h3 id="å°ç»“-3"><a href="#å°ç»“-3" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ul>
<li>Spring Security è‡ªåŠ¨é…ç½®æ˜¯ä¸€ç§å¾ˆå¥½çš„å¼€å§‹å­¦ä¹ å®‰å…¨çš„æ–¹å¼ï¼Œä½†å¤§å¤šæ•°åº”ç”¨ç¨‹åºéœ€è¦æ˜ç¡®åœ°é…ç½®å®‰å…¨ï¼Œä»¥æ»¡è¶³å…¶ç‹¬ç‰¹çš„å®‰å…¨éœ€æ±‚ã€‚</li>
<li>ç”¨æˆ·ç»†èŠ‚å¯ä»¥åœ¨å…³ç³»æ•°æ®åº“ã€LDAP æˆ–å®Œå…¨è‡ªå®šä¹‰å®ç°æ”¯æŒçš„ç”¨æˆ·å­˜å‚¨ä¸­è¿›è¡Œç®¡ç†ã€‚</li>
<li>Spring Security è‡ªåŠ¨é˜²å¾¡ CSRF æ”»å‡»ã€‚</li>
<li>é€šè¿‡ SecurityContext å¯¹è±¡ï¼ˆä» SecurityContextHolder. getcontext() ä¸­è¿”å›ï¼‰æˆ–ä½¿ç”¨ @AuthenticationPrincipal æ³¨å…¥æ§åˆ¶å™¨ä¸­ï¼Œå¯ä»¥è·å¾—è®¤è¯ç”¨æˆ·çš„ä¿¡æ¯ã€‚</li>
</ul>
<h2 id="ç¬¬-5-ç« -ä½¿ç”¨é…ç½®å±æ€§"><a href="#ç¬¬-5-ç« -ä½¿ç”¨é…ç½®å±æ€§" class="headerlink" title="ç¬¬ 5 ç«  ä½¿ç”¨é…ç½®å±æ€§"></a>ç¬¬ 5 ç«  ä½¿ç”¨é…ç½®å±æ€§</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>å¾®è°ƒè‡ªåŠ¨é…ç½® bean</li>
<li>å°†é…ç½®å±æ€§åº”ç”¨äºåº”ç”¨ç¨‹åºç»„ä»¶</li>
<li>ä½¿ç”¨ Spring é…ç½®æ–‡ä»¶</li>
</ul>
<h3 id="å¾®è°ƒè‡ªåŠ¨é…ç½®"><a href="#å¾®è°ƒè‡ªåŠ¨é…ç½®" class="headerlink" title="å¾®è°ƒè‡ªåŠ¨é…ç½®"></a>å¾®è°ƒè‡ªåŠ¨é…ç½®</h3><p>åœ¨æˆ‘ä»¬æ·±å…¥ç ”ç©¶é…ç½®å±æ€§ä¹‹å‰ï¼Œæœ‰å¿…è¦ç¡®å®šåœ¨ Spring ä¸­æœ‰ä¸¤ç§ä¸åŒï¼ˆä½†ç›¸å…³ï¼‰çš„é…ç½®</p>
<ul>
<li><em>Bean wiring</em> â€”â€” å®ƒå£°æ˜åº”ç”¨ç¨‹åºç»„ä»¶å°†åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ä½œä¸º bean åˆ›å»ºï¼Œä»¥åŠå®ƒä»¬åº”è¯¥å¦‚ä½•ç›¸äº’æ³¨å…¥ã€‚</li>
<li><em>Property injection</em> â€”â€” åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è®¾ç½® bean çš„å€¼ã€‚</li>
</ul>
<p>ä¸‹é¢çš„ @Bean æ–¹æ³•ï¼Œå®ƒä¸ºåµŒå…¥å¼ H2 æ•°æ®åº“å£°æ˜äº†ä¸€ä¸ªæ•°æ®æºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedDataSourceBuilder()</span><br><span class="line">        .setType(H2)</span><br><span class="line">        .addScript(<span class="string">&quot;taco_schema.sql&quot;</span>)</span><br><span class="line">        .addScripts(<span class="string">&quot;user_data.sql&quot;</span>, <span class="string">&quot;ingredient_data.sql&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ addScript() å’Œ addScripts() æ–¹æ³•è®¾ç½®äº†ä¸€äº›å¸¦æœ‰ SQL è„šæœ¬åç§°çš„å­—ç¬¦ä¸²å±æ€§ï¼Œè¿™äº› SQL è„šæœ¬åº”è¯¥åœ¨æ•°æ®æºå‡†å¤‡å¥½ååº”ç”¨åˆ°æ•°æ®åº“ä¸­ã€‚å¦‚æœä¸ä½¿ç”¨ Spring Bootï¼Œé‚£ä¹ˆè¿™å°±æ˜¯é…ç½® DataSource bean çš„æ–¹å¼ï¼Œè€Œè‡ªåŠ¨é…ç½®ä½¿æ­¤æ–¹æ³•å®Œå…¨æ²¡æœ‰å¿…è¦ã€‚</p>
<p>å¦‚æœ H2 ä¾èµ–é¡¹åœ¨è¿è¡Œæ—¶ç±»è·¯å¾„ä¸­å¯ç”¨ï¼Œé‚£ä¹ˆ Spring Boot å°†åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è‡ªåŠ¨åˆ›å»ºé€‚å½“çš„æ•°æ®æº beanã€‚bean åº”ç”¨äº schema.sql å’Œ data.sql è„šæœ¬çš„è¯»å–ã€‚</p>
<h4 id="ç†è§£-Spring-ç¯å¢ƒæŠ½è±¡"><a href="#ç†è§£-Spring-ç¯å¢ƒæŠ½è±¡" class="headerlink" title="ç†è§£ Spring ç¯å¢ƒæŠ½è±¡"></a>ç†è§£ Spring ç¯å¢ƒæŠ½è±¡</h4><p>Spring ç¯å¢ƒæŠ½è±¡æ˜¯ä»»ä½•å¯é…ç½®å±æ€§çš„ä¸€ç«™å¼å•†åº—ã€‚å®ƒæŠ½è±¡äº†å±æ€§çš„èµ·æºï¼Œä»¥ä¾¿éœ€è¦è¿™äº›å±æ€§çš„ bean å¯ä»¥ä» Spring æœ¬èº«ä½¿ç”¨å®ƒä»¬ã€‚Spring ç¯å¢ƒæ¥è‡ªå‡ ä¸ªå±æ€§æºï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>JVM ç³»ç»Ÿå±æ€§</li>
<li>æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡</li>
<li>å‘½ä»¤è¡Œå‚æ•°</li>
<li>åº”ç”¨ç¨‹åºå±æ€§é…ç½®æ–‡ä»¶</li>
</ul>
<p>ç„¶åï¼Œå®ƒå°†è¿™äº›å±æ€§èšåˆåˆ°å•ä¸€çš„æºä¸­ï¼Œä»è¿™ä¸ªæºä¸­å¯ä»¥æ³¨å…¥ Spring beanã€‚å›¾ 5.1 æ¼”ç¤ºäº†æ¥è‡ªå±æ€§æºçš„å±æ€§æ˜¯å¦‚ä½•é€šè¿‡ Spring ç¯å¢ƒæŠ½è±¡æµåˆ° Spring bean ä¸­çš„ã€‚</p>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LsZbNhMfEZCDnmKnlU8%252F-LsZbaZRvtlohkr6FK1u%252F%E5%9B%BE%205.1.jpg" alt="img"></p>
<p>é€šè¿‡ Spring Boot è‡ªåŠ¨é…ç½®çš„ bean éƒ½å¯ä»¥é€šè¿‡ä» Spring ç¯å¢ƒä¸­æå–çš„å±æ€§è¿›è¡Œé…ç½®ã€‚ä½œä¸ºä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡è®¾å¸Œæœ›åº”ç”¨ç¨‹åºçš„åº•å±‚ servlet å®¹å™¨ä¾¦å¬æŸäº›ç«¯å£ä¸Šçš„è¯·æ±‚ï¼Œè€Œä¸æ˜¯é»˜è®¤ç«¯å£ 8080ã€‚ä¸ºæ­¤ï¼Œé€šè¿‡åœ¨ src/main/resources/application.properties æ–‡ä»¶ä¸­çš„ server.port å±æ€§æ¥æŒ‡å®šä¸€ä¸ªä¸åŒçš„æ¥å£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">9090</span></span><br></pre></td></tr></table></figure>

<p>å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘æ›´å–œæ¬¢åœ¨è®¾ç½®é…ç½®å±æ€§æ—¶ä½¿ç”¨ YAMLã€‚å› æ­¤ï¼Œæˆ‘å¯èƒ½è®¾ç½®åœ¨ /src/main/resources/application.yml æ–‡ä»¶ä¸­çš„ server.port çš„å€¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ application.properties æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:  port:</span> <span class="number">9090</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå¸Œæœ›åœ¨å¤–éƒ¨é…ç½®è¯¥å±æ€§ï¼Œè¿˜å¯ä»¥åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šç«¯å£ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar tacocloud-0.0.5-SNAPSHOT.jar --server.port=9090</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³è®©åº”ç”¨ç¨‹åºæ€»æ˜¯åœ¨ä¸€ä¸ªç‰¹å®šçš„ç«¯å£ä¸Šå¯åŠ¨ï¼Œå¯ä»¥æŠŠå®ƒè®¾ç½®ä¸ºä¸€ä¸ªæ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> SERVER_PORT=9090</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œåœ¨å°†å±æ€§è®¾ç½®ä¸ºç¯å¢ƒå˜é‡æ—¶ï¼Œå‘½åé£æ ¼ç•¥æœ‰ä¸åŒï¼Œä»¥é€‚åº”æ“ä½œç³»ç»Ÿå¯¹ç¯å¢ƒå˜é‡åç§°çš„é™åˆ¶ã€‚Spring èƒ½å¤Ÿå°†å…¶åˆ†ç±»å¹¶å°† SERVER_PORT è½¬è¯‘ä¸º server.portã€‚</p>
<h4 id="é…ç½®æ•°æ®æº"><a href="#é…ç½®æ•°æ®æº" class="headerlink" title="é…ç½®æ•°æ®æº"></a>é…ç½®æ•°æ®æº</h4><p>è™½ç„¶å¯ä»¥æ˜¾å¼åœ°é…ç½® DataSource beanï¼Œä½†è¿™é€šå¸¸æ˜¯ä¸å¿…è¦çš„ã€‚ç›¸åï¼Œé€šè¿‡é…ç½®å±æ€§ä¸ºæ•°æ®åº“é…ç½® URL å’Œå‡­æ®æ›´ç®€å•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‰“ç®—å¼€å§‹ä½¿ç”¨ MySQL æ•°æ®åº“ï¼Œå¯ä»¥å°†ä»¥ä¸‹é…ç½®å±æ€§æ·»åŠ åˆ° application.ymlï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost/tacocloud</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">tacodb</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">tacopassword</span></span><br></pre></td></tr></table></figure>

<p>è™½ç„¶éœ€è¦å°†é€‚å½“çš„ JDBC é©±åŠ¨ç¨‹åºæ·»åŠ åˆ°æ„å»ºä¸­ï¼Œä½†é€šå¸¸ä¸éœ€è¦æŒ‡å®š JDBC é©±åŠ¨ç¨‹åºç±»ï¼›Spring Boot å¯ä»¥ä»æ•°æ®åº“ URL çš„ç»“æ„ä¸­æ‰¾åˆ°å®ƒã€‚ä½†å¦‚æœæœ‰é—®é¢˜ï¼Œå¯ä»¥è¯•ç€è®¾ç½® spring.datasource.schema å’Œ spring.datasource.data å±æ€§ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">order-schema.sql</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ingredient-schema.sql</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tao-schema.sql</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">user-schema.sql</span></span><br><span class="line">    <span class="attr">data:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ingredients.sql</span></span><br></pre></td></tr></table></figure>

<p>å¯èƒ½æ˜¾å¼æ•°æ®æºé…ç½®ä¸æ˜¯ä½ çš„é£æ ¼ã€‚ç›¸åï¼Œä½ å¯èƒ½æ›´å–œæ¬¢åœ¨ JNDI ä¸­é…ç½®æ•°æ®æºï¼Œå¹¶è®© Spring ä»é‚£é‡ŒæŸ¥æ‰¾å®ƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡é…ç½® spring.datasource.jndi-name æ¥è®¾ç½®æ•°æ®æºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">  <span class="attr">datasource:</span>   </span><br><span class="line">    <span class="attr">jndi-name:</span> <span class="string">java:/comp/env/jdbc/tacoCloudDS</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœè®¾ç½®äº† spring.datasource.jndi-name å±æ€§ï¼Œé‚£ä¹ˆå…¶ä»–æ•°æ®æºçš„è¿æ¥å±æ€§ï¼ˆå¦‚æœè®¾ç½®äº†ï¼‰ä¼šè¢«å¿½ç•¥ã€‚</p>
<h4 id="é…ç½®åµŒå…¥å¼æœåŠ¡å™¨"><a href="#é…ç½®åµŒå…¥å¼æœåŠ¡å™¨" class="headerlink" title="é…ç½®åµŒå…¥å¼æœåŠ¡å™¨"></a>é…ç½®åµŒå…¥å¼æœåŠ¡å™¨</h4><p>å¦‚æœæŠŠ server.port è®¾ç½®ä¸º 0 ä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:  port:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>å°½ç®¡æ­£åœ¨æ˜¾å¼åœ°è®¾ç½® server.port ä¸º 0ï¼Œä½†æ˜¯æœåŠ¡å™¨ä¸ä¼šåœ¨ç«¯å£ 0 ä¸Šå¯åŠ¨ã€‚ç›¸åï¼Œå®ƒå°†ä»éšæœºé€‰æ‹©çš„å¯ç”¨ç«¯å£å¯åŠ¨ã€‚è¿™åœ¨è¿è¡Œè‡ªåŠ¨åŒ–é›†æˆæµ‹è¯•ä»¥ç¡®ä¿ä»»ä½•å¹¶å‘è¿è¡Œçš„æµ‹è¯•ä¸ä¼šåœ¨ç¡¬ç¼–ç ç«¯å£å·ä¸Šå‘ç”Ÿå†²çªæ—¶éå¸¸æœ‰ç”¨ã€‚</p>
<p>ä½†æ˜¯åº•å±‚æœåŠ¡å™¨ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç«¯å£ã€‚éœ€è¦å¯¹åº•å±‚å®¹å™¨åšçš„æœ€å¸¸è§çš„äº‹æƒ…ä¹‹ä¸€æ˜¯å°†å…¶è®¾ç½®ä¸ºå¤„ç† HTTPS è¯·æ±‚ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ å¿…é¡»åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯é€šè¿‡ä½¿ç”¨ JDK çš„ keytool å‘½ä»¤è¡Œå·¥å…·åˆ›å»ºä¸€ä¸ªå¯†é’¥å­˜å‚¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ keytool -keystore mykeys.jks -genkey -<span class="built_in">alias</span> tomcat -keyalg RSA</span><br></pre></td></tr></table></figure>

<p>ä½ å°†ä¼šè¢«é—®åˆ°å‡ ä¸ªå…³äºä½ çš„åå­—å’Œå…¬å¸çš„é—®é¢˜ï¼Œè¿™äº›é—®é¢˜å¤§éƒ¨åˆ†éƒ½æ˜¯æ— å…³ç´§è¦çš„ã€‚ä½†å½“è¢«è¦æ±‚è¾“å…¥å¯†ç æ—¶ï¼Œè®°ä½ä½ çš„å¯†ç ã€‚å¯¹äºæœ¬ä¾‹ï¼Œæˆ‘é€‰æ‹© letmein ä½œä¸ºå¯†ç ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œéœ€è¦è®¾ç½®ä¸€äº›å±æ€§ï¼Œç”¨äºåœ¨åµŒå…¥å¼æœåŠ¡å™¨ä¸­å¯ç”¨ HTTPSã€‚å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šå®ƒä»¬ï¼Œä½†æ˜¯é‚£æ ·ä¼šéå¸¸ä¸æ–¹ä¾¿ã€‚ç›¸åï¼Œå¯èƒ½ä¼šåœ¨ application.properties æˆ– application.yml æ–‡ä»¶ä¸­è®¾ç½®å®ƒä»¬ã€‚åœ¨ application.yml ä¸­ï¼Œå±æ€§å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8443</span></span><br><span class="line">	<span class="attr">ssl:</span>    </span><br><span class="line">        <span class="attr">key-store:</span> <span class="string">file:///path/to/mykeys.jks</span>  </span><br><span class="line">        <span class="attr">key-store-password:</span> <span class="string">letmein</span>   </span><br><span class="line">        <span class="attr">key-password:</span> <span class="string">letmein</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œ server.port å±æ€§è®¾ç½®ä¸º 8443ï¼Œè¿™æ˜¯å¼€å‘ HTTPS æœåŠ¡å™¨çš„å¸¸ç”¨é€‰æ‹©ã€‚server.ssl.key-store å±æ€§è®¾ç½®ä¸ºåˆ›å»ºå¯†é’¥å­˜å‚¨åº“æ–‡ä»¶çš„è·¯å¾„ã€‚è¿™é‡Œæ˜¾ç¤ºäº†ä¸€ä¸ª <code>file://</code> URL æ¥ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½å®ƒï¼Œä½†æ˜¯å¦‚æœå°†å®ƒæ‰“åŒ…åˆ°åº”ç”¨ç¨‹åº JAR æ–‡ä»¶ä¸­ï¼Œå°†ä½¿ç”¨ä¸€ä¸ª <code>classpath:</code> URLæ¥å¼•ç”¨å®ƒã€‚åŒæ—¶ server.ssl.key-store-password å’Œ server.ssl.key-password å±æ€§éƒ½è¢«è®¾ç½®ä¸ºåˆ›å»ºå¯†é’¥å­˜å‚¨æ—¶æŒ‡å®šçš„å¯†ç å€¼ã€‚</p>
<p>æœ‰äº†è¿™äº›å±æ€§ï¼Œåº”ç”¨ç¨‹åºåº”è¯¥ä¾¦å¬ç«¯å£ 8443 ä¸Šçš„ HTTPS è¯·æ±‚ã€‚æ ¹æ®ä½¿ç”¨çš„æµè§ˆå™¨ï¼Œå¯èƒ½ä¼šé‡åˆ°æœåŠ¡å™¨æ— æ³•éªŒè¯å…¶èº«ä»½çš„è­¦å‘Šã€‚åœ¨å¼€å‘æœŸé—´ä»æœ¬åœ°ä¸»æœºæä¾›æœåŠ¡æ—¶ï¼Œè¿™æ²¡æœ‰ä»€ä¹ˆå¯æ‹…å¿ƒçš„ã€‚</p>
<h4 id="é…ç½®æ—¥å¿—"><a href="#é…ç½®æ—¥å¿—" class="headerlink" title="é…ç½®æ—¥å¿—"></a>é…ç½®æ—¥å¿—</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot é€šè¿‡ <a target="_blank" rel="noopener" href="http://logback.qos.ch/">Logback</a> é…ç½®æ—¥å¿—ï¼Œé»˜è®¤ä¸º INFO çº§åˆ«ï¼Œç„¶åå†™å…¥æ§åˆ¶å°ã€‚åœ¨è¿è¡Œåº”ç”¨ç¨‹åºå’Œå…¶ä»–ç¤ºä¾‹æ—¶ï¼Œå¯èƒ½å·²ç»åœ¨åº”ç”¨ç¨‹åºæ—¥å¿—ä¸­çœ‹åˆ°äº†å¤§é‡çš„ INFO çº§åˆ«çš„æ—¥å¿—æ¡ç›®ã€‚</p>
<p>è¦å®Œå…¨æ§åˆ¶æ—¥å¿—é…ç½®ï¼Œå¯ä»¥åœ¨ç±»è·¯å¾„çš„æ ¹ç›®å½•ï¼ˆåœ¨ src/main/resources ä¸­ï¼‰åˆ›å»º log .xml æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ log .xml æ–‡ä»¶çš„ä¾‹å­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span>      </span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span>         </span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>     </span><br><span class="line">                %d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n   </span><br><span class="line">            <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span>     </span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;root&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span>     </span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é™¤äº†ç”¨äºæ—¥å¿—çš„æ¨¡å¼å¤–ï¼ŒLogback é…ç½®æˆ–å¤šæˆ–å°‘ä¸æ²¡æœ‰ log .xml æ–‡ä»¶æ—¶å¾—åˆ°çš„é»˜è®¤é…ç½®ç›¸åŒã€‚ä½†æ˜¯é€šè¿‡ç¼–è¾‘ logback.xmlï¼Œå¯ä»¥å®Œå…¨æ§åˆ¶åº”ç”¨ç¨‹åºçš„æ—¥å¿—æ–‡ä»¶ã€‚</p>
<p>å¯¹æ—¥å¿—é…ç½®æœ€å¸¸è§çš„æ›´æ”¹æ˜¯æ›´æ”¹æ—¥å¿—çº§åˆ«ï¼Œå¯èƒ½è¿˜ä¼šæŒ‡å®šåº”è¯¥å†™å…¥æ—¥å¿—çš„æ–‡ä»¶ã€‚ä½¿ç”¨ Spring Boot é…ç½®å±æ€§ï¼Œå¯ä»¥åœ¨ä¸åˆ›å»º log .xml æ–‡ä»¶çš„æƒ…å†µä¸‹è¿›è¡Œè¿™äº›æ›´æ”¹ã€‚</p>
<p>è¦è®¾ç½®æ—¥å¿—è®°å½•çº§åˆ«ï¼Œéœ€è¦åˆ›å»ºä»¥ logging.level ä¸ºå‰ç¼€çš„å±æ€§ï¼Œåé¢æ¥ä¸Šè¦ä¸ºå…¶è®¾ç½®æ—¥å¿—çº§åˆ«çš„æ—¥å¿—è®°å½•å™¨çš„åç§°ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æƒ³å°† root æ—¥å¿—çº§åˆ«è®¾ç½®ä¸º WARNï¼Œä½†æ˜¯å°† Spring å®‰å…¨æ—¥å¿—è®¾ç½®ä¸º DEBUG çº§åˆ«ã€‚å¯ä»¥åƒä¸‹é¢è¿™æ ·è®¾ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">WARN</span></span><br><span class="line">    <span class="attr">org:</span></span><br><span class="line">      <span class="attr">springframework:</span></span><br><span class="line">        <span class="attr">security:</span> <span class="string">DEBUG</span></span><br></pre></td></tr></table></figure>

<p>å¦å¤–ï¼Œå¯ä»¥å°† Spring Security åŒ…çš„åç§°æŠ˜å æˆä¸€è¡Œï¼Œä»¥ä¾¿äºé˜…è¯»ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">WARN</span></span><br><span class="line">    <span class="attr">org:</span></span><br><span class="line">      <span class="attr">springframework.security:</span> <span class="string">DEBUG</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œå‡è®¾å¸Œæœ›å°†æ—¥å¿—æ¡ç›®å†™å…¥ä½äº /var/logs/ æ–‡ä»¶å¤¹ä¸‹çš„ TacoCloud.log æ–‡ä»¶ã€‚loggin.path å’Œ logging.file å±æ€§å¯ä»¥å¸®åŠ©å®ç°è¿™ä¸€ç‚¹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">/var/logs/</span></span><br><span class="line">  <span class="attr">file:</span> <span class="string">TacoCloud.log</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">WARN</span></span><br><span class="line">    <span class="attr">org:</span></span><br><span class="line">      <span class="attr">springframework:</span></span><br><span class="line">        <span class="attr">security:</span> <span class="string">DEBUG</span></span><br></pre></td></tr></table></figure>

<p>å‡è®¾åº”ç”¨ç¨‹åºå¯¹ /var/logs/ æ–‡ä»¶å¤¹æœ‰å†™æƒé™ï¼Œé‚£ä¹ˆæ—¥å¿—å°†è¢«å†™åˆ° /var/logs/TacoCloud.log æ–‡ä»¶ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ—¥å¿—æ–‡ä»¶åœ¨å¤§å°è¾¾åˆ° 10 MB æ—¶å°±ä¼šè¿›è¡Œå¾ªç¯å†™å…¥ã€‚</p>
<h4 id="ä½¿ç”¨ç‰¹æ®Šçš„å±æ€§å€¼"><a href="#ä½¿ç”¨ç‰¹æ®Šçš„å±æ€§å€¼" class="headerlink" title="ä½¿ç”¨ç‰¹æ®Šçš„å±æ€§å€¼"></a>ä½¿ç”¨ç‰¹æ®Šçš„å±æ€§å€¼</h4><p>åœ¨è®¾ç½®å±æ€§æ—¶ï¼Œä¸é™äºå°†å®ƒä»¬çš„å€¼å£°æ˜ä¸ºç¡¬ç¼–ç çš„å­—ç¬¦ä¸²å’Œæ•°å€¼ã€‚ç›¸åï¼Œå¯ä»¥ä»å…¶ä»–é…ç½®å±æ€§æ´¾ç”Ÿå®ƒä»¬çš„å€¼ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾ï¼ˆä¸ç®¡å‡ºäºä»€ä¹ˆåŸå› ï¼‰æƒ³è¦è®¾ç½®ä¸€ä¸ªåä¸º greeting.welcome çš„å±æ€§ï¼Œç”¨äºè¿”å›å¦ä¸€ä¸ªåä¸º spring.application.name çš„å±æ€§çš„å€¼ã€‚ä¸ºæ­¤ï¼Œåœ¨è®¾ç½® greeting.welcome æ—¶å¯ä»¥ä½¿ç”¨ <code>$&#123;&#125;</code> å ä½ç¬¦æ ‡è®°ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">greeting:</span></span><br><span class="line">  <span class="attr">welcome:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä½ ç”šè‡³å¯ä»¥æŠŠè¿™ä¸ªå ä½ç¬¦åµŒå…¥åˆ°å…¶ä»–æ–‡æœ¬ä¸­ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">greeting:</span></span><br><span class="line">  <span class="attr">welcome:</span> <span class="string">You</span> <span class="string">are</span> <span class="string">using</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œä½¿ç”¨é…ç½®å±æ€§é…ç½® Spring è‡ªå·±çš„ç»„ä»¶å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†å€¼æ³¨å…¥è¿™äº›ç»„ä»¶çš„å±æ€§å¹¶è°ƒæ•´è‡ªåŠ¨é…ç½®ã€‚é…ç½®å±æ€§å¹¶ä¸ä¸“å±äº Spring åˆ›å»ºçš„ beanã€‚åªéœ€ç¨åŠ åŠªåŠ›ï¼Œå°±å¯ä»¥åˆ©ç”¨ä½ è‡ªå·±çš„ bean ä¸­çš„é…ç½®å±æ€§ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆåšã€‚</p>
<h3 id="åˆ›å»ºè‡ªå·±çš„é…ç½®å±æ€§"><a href="#åˆ›å»ºè‡ªå·±çš„é…ç½®å±æ€§" class="headerlink" title="åˆ›å»ºè‡ªå·±çš„é…ç½®å±æ€§"></a>åˆ›å»ºè‡ªå·±çš„é…ç½®å±æ€§</h3><p>æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œé…ç½®å±æ€§åªä¸è¿‡æ˜¯æŒ‡å®šæ¥æ¥å— Spring ç¯å¢ƒæŠ½è±¡é…ç½®çš„ bean çš„å±æ€§ã€‚æ²¡æœ‰æåˆ°çš„æ˜¯å¦‚ä½•æŒ‡å®šè¿™äº› bean æ¥ä½¿ç”¨è¿™äº›é…ç½®ã€‚</p>
<p>ä¸ºäº†æ”¯æŒé…ç½®å±æ€§çš„å±æ€§æ³¨å…¥ï¼ŒSpring Boot æä¾›äº†@ConfigurationProperties æ³¨é‡Šã€‚å½“æ”¾ç½®åœ¨ä»»ä½• Spring bean ä¸Šæ—¶ï¼Œå®ƒæŒ‡å®šå¯ä»¥ä» Spring ç¯å¢ƒä¸­çš„å±æ€§æ³¨å…¥åˆ°è¯¥ bean çš„å±æ€§ã€‚</p>
<p>ä¸ºäº†æ¼”ç¤º @ConfigurationProperties æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå‡è®¾å·²ç»å°†ä»¥ä¸‹æ–¹æ³•æ·»åŠ åˆ° OrderController ä¸­ï¼Œä»¥åˆ—å‡ºç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ä¹‹å‰çš„è®¢å•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">ordersForUser</span><span class="params">(<span class="meta">@AuthenticationPrincipal</span> User user, Model model)</span> </span>&#123;</span><br><span class="line">    model.addAttribute(<span class="string">&quot;orders&quot;</span>, orderRepo.findByUserOrderByPlaceAtDesc(user));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;orderList&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦å‘ OrderRepository æ·»åŠ äº†å¿…è¦çš„ findByUser() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Order&gt; <span class="title">findByUserOrderByPlaceAtDesc</span><span class="params">(User user)</span></span>;</span><br></pre></td></tr></table></figure>

<p>è¯·æ³¨æ„ï¼Œæ­¤å­˜å‚¨åº“æ–¹æ³•æ˜¯ç”¨ OrderByPlacedAtDesc å­å¥å‘½åçš„ã€‚OrderBy éƒ¨åˆ†æŒ‡å®šä¸€ä¸ªå±æ€§ï¼Œé€šè¿‡è¯¥å±æ€§å¯¹ç»“æœæ’åº â€”â€” åœ¨æœ¬ä¾‹ä¸­æ˜¯ placedAt å±æ€§ã€‚æœ€åçš„ Desc è®©æ’åºæŒ‰é™åºè¿›è¡Œã€‚å› æ­¤ï¼Œè¿”å›çš„è®¢å•åˆ—è¡¨å°†æŒ‰æ—¶é—´å€’åºæ’åºã€‚</p>
<p>å¦‚å‰æ‰€è¿°ï¼Œåœ¨ç”¨æˆ·ä¸‹äº†ä¸€äº›è®¢å•ä¹‹åï¼Œè¿™ä¸ªæ§åˆ¶å™¨æ–¹æ³•å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚ä½†å¯¹äºæœ€ç‹‚çƒ­çš„ taco é‰´èµå®¶æ¥è¯´ï¼Œå®ƒå¯èƒ½ä¼šå˜å¾—æœ‰ç‚¹ç¬¨æ‹™ã€‚åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºçš„ä¸€äº›å‘½ä»¤æ˜¯æœ‰ç”¨çš„ï¼›ä¸€é•¿ä¸²æ²¡å®Œæ²¡äº†çš„è®¢å•åªæ˜¯å™ªéŸ³ã€‚å‡è®¾å¸Œæœ›å°†æ˜¾ç¤ºçš„è®¢å•æ•°é‡é™åˆ¶ä¸ºæœ€è¿‘çš„ 20 ä¸ªè®¢å•ï¼Œå¯ä»¥æ›´æ”¹ ordersForUser()ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">ordersForUser</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@AuthenticationPrincipal</span> User user, Model model)</span> </span>&#123;</span><br><span class="line">    Pageable pageable = PageRequest.of(<span class="number">0</span>, <span class="number">20</span>);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;orders&quot;</span>,</span><br><span class="line">        orderRepo.findByUserOrderByPlaceAtDesc(user));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;orderList&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éšç€è¿™ä¸ªæ”¹å˜ï¼ŒOrderRepository è·Ÿç€éœ€è¦å˜ä¸ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Order&gt; <span class="title">findByUserOrderByPlaceAtDesc</span><span class="params">(User user, Pageable pageable)</span></span>;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œï¼Œå·²ç»æ›´æ”¹äº† findByUserOrderByPlacedAtDesc() æ–¹æ³•çš„ç­¾åï¼Œä»¥æ¥å—å¯åˆ†é¡µçš„å‚æ•°ã€‚å¯åˆ†é¡µæ˜¯ Spring Data é€šè¿‡é¡µç å’Œé¡µé¢å¤§å°é€‰æ‹©ç»“æœå­é›†çš„æ–¹å¼ã€‚åœ¨ ordersForUser() æ§åˆ¶å™¨æ–¹æ³•ä¸­ï¼Œæ„å»ºäº†ä¸€ä¸ª PageRequest å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å®ç°äº† Pageable æ¥è¯·æ±‚ç¬¬ä¸€ä¸ªé¡µé¢ï¼ˆpage zeroï¼‰ï¼Œé¡µé¢å¤§å°ä¸º 20ï¼Œä»¥ä¾¿ä¸ºç”¨æˆ·è·å¾—æœ€å¤š 20 ä¸ªæœ€è¿‘ä¸‹çš„è®¢å•ã€‚</p>
<p>è™½ç„¶è¿™å·¥ä½œå¾—éå¸¸å¥½ï¼Œä½†å®ƒè®©æˆ‘æ„Ÿåˆ°æœ‰ç‚¹ä¸å®‰ï¼Œå› ä¸ºå·²ç»ç¡¬ç¼–ç äº†é¡µé¢å¤§å°ã€‚å¦‚æœåæ¥å‘ç° 20 ä¸ªè®¢å•å¤ªå¤šï¼Œè€Œå†³å®šå°†å…¶æ›´æ”¹ä¸º 10 ä¸ªè®¢å•ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿå› ä¸ºå®ƒæ˜¯ç¡¬ç¼–ç çš„ï¼Œæ‰€ä»¥å¿…é¡»é‡æ–°æ„å»ºå’Œé‡æ–°éƒ¨ç½²åº”ç”¨ç¨‹åºã€‚</p>
<p>å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰é…ç½®å±æ€§æ¥è®¾ç½®é¡µé¢å¤§å°ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç é¡µé¢å¤§å°ã€‚é¦–å…ˆï¼Œéœ€è¦å‘ OrderController æ·»åŠ ä¸€ä¸ªåä¸º pageSize çš„æ–°å±æ€§ï¼Œç„¶ååœ¨ OrderController ä¸Šä½¿ç”¨ @ConfigurationProperties æ³¨è§£ ï¼Œå¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºã€‚</p>
<center>ç¨‹åºæ¸…å• 5.1 åœ¨ OrderController ä¸­ä½¿ç”¨é…ç½®å±æ€§</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/orders&quot;)</span></span><br><span class="line"><span class="meta">@SessionAttributes(&quot;order&quot;)</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;taco.orders&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pageSize = <span class="number">20</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageSize</span><span class="params">(<span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pageSize = pageSize;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">ordersForUser</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="meta">@AuthenticationPrincipal</span> User user, Model model)</span> </span>&#123;</span><br><span class="line">        Pageable pageable = PageRequest.of(<span class="number">0</span>, pageSize);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;orders&quot;</span>,</span><br><span class="line">            orderRepo.findByUserOrderByPlacedAtDesc(user, pageable));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;orderList&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºæ¸…å• 5.1 ä¸­æœ€é‡è¦çš„å˜åŒ–æ˜¯å¢åŠ äº† @ConfigurationProperties æ³¨è§£ã€‚å…¶ prefix å±æ€§è®¾ç½®ä¸º tacoã€‚è¿™æ„å‘³ç€åœ¨è®¾ç½® pageSize å±æ€§æ—¶ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªåä¸º taco.orders.pageSize çš„é…ç½®å±æ€§ã€‚</p>
<p>æ–°çš„ pageSize å±æ€§é»˜è®¤ä¸º 20ã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡è®¾ç½® taco.orders.pageSize å±æ€§è½»æ¾åœ°å°†å…¶æ›´æ”¹ä¸ºæƒ³è¦çš„ä»»ä½•å€¼ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ application.yml ä¸­è®¾ç½®æ­¤å±æ€§ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">taco:</span></span><br><span class="line">  <span class="attr">orders:</span></span><br><span class="line">    <span class="attr">pageSize:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼Œå¦‚æœéœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œå¿«é€Ÿæ›´æ”¹ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® taco.orders.pageSize å±æ€§ä½œä¸ºç¯å¢ƒå˜é‡æ¥é‡æ–°æ„å»ºå’Œé‡æ–°éƒ¨ç½²åº”ç”¨ç¨‹åºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> TACO_ORDERS_PAGESIZE=10</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è®¾ç½®é…ç½®å±æ€§çš„ä»»ä½•æ–¹æ³•ï¼Œéƒ½å¯ä»¥ç”¨æ¥è°ƒæ•´æœ€è¿‘è®¢å•é¡µé¢çš„å¤§å°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç ”ç©¶å¦‚ä½•åœ¨å±æ€§æŒæœ‰è€…ä¸­è®¾ç½®é…ç½®æ•°æ®ã€‚</p>
<h4 id="å®šä¹‰é…ç½®å±æ€§æŒæœ‰è€…"><a href="#å®šä¹‰é…ç½®å±æ€§æŒæœ‰è€…" class="headerlink" title="å®šä¹‰é…ç½®å±æ€§æŒæœ‰è€…"></a>å®šä¹‰é…ç½®å±æ€§æŒæœ‰è€…</h4><p>è¿™é‡Œæ²¡æœ‰è¯´ @ConfigurationProperties å¿…é¡»è®¾ç½®åœ¨æ§åˆ¶å™¨æˆ–ä»»ä½•å…¶ä»–ç‰¹å®šç±»å‹çš„ bean ä¸Šï¼Œ@ConfigurationProperties å®é™…ä¸Šç»å¸¸æ”¾åœ¨ bean ä¸Šã€‚åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™äº› bean çš„æƒŸä¸€ç›®çš„æ˜¯ä½œä¸ºé…ç½®æ•°æ®çš„æŒæœ‰è€…ï¼Œè¿™ä½¿æ§åˆ¶å™¨å’Œå…¶ä»–åº”ç”¨ç¨‹åºç±»ä¸æ¶‰åŠç‰¹å®šäºé…ç½®çš„ç»†èŠ‚ï¼Œå®ƒè¿˜ä½¿å¾—åœ¨å‡ ä¸ªå¯èƒ½ä½¿ç”¨è¯¥ä¿¡æ¯çš„ bean ä¹‹é—´å…±äº«å…¬å…±é…ç½®å±æ€§å˜å¾—å¾ˆå®¹æ˜“ã€‚</p>
<p>å¯¹äº OrderController ä¸­çš„ pageSize å±æ€§ï¼Œå¯ä»¥å°†å…¶æå–åˆ°ä¸€ä¸ªå•ç‹¬çš„ç±»ä¸­ã€‚ä¸‹é¢çš„ç¨‹åºæ¸…å•ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨äº† OrderProps ç±»ã€‚</p>
<center>ç¨‹åºæ¸…å• 5.2 æå– pageSize åˆ°æŒæœ‰è€…ç±»</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.web;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;taco.orders&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderProps</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pageSize = <span class="number">20</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚åœ¨ OrderController ä¸­æ‰€åšçš„ï¼ŒpageSize å±æ€§é»˜è®¤ä¸º 20ï¼ŒåŒæ—¶ OrderProps ä½¿ç”¨ @ConfigurationProperties è¿›è¡Œæ³¨è§£ï¼Œä»¥å…·æœ‰ taco.orders å‰ç¼€ã€‚</p>
<p>å®ƒè¿˜å¸¦æœ‰ @Component æ³¨è§£ï¼Œå› æ­¤ Spring ç»„ä»¶æ‰«ææ—¶å°†è‡ªåŠ¨å‘ç°å®ƒå¹¶åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­å°†å…¶åˆ›å»ºä¸º beanã€‚è¿™å¾ˆé‡è¦ï¼Œå› ä¸ºä¸‹ä¸€æ­¥æ˜¯å°† OrderProps bean æ³¨å…¥åˆ° OrderController ä¸­ã€‚</p>
<p>å…³äºé…ç½®å±æ€§æŒæœ‰è€…ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ã€‚å®ƒä»¬æ˜¯ä» Spring ç¯å¢ƒä¸­æ³¨å…¥å±æ€§çš„ beanã€‚å®ƒä»¬å¯ä»¥è¢«æ³¨å…¥åˆ°ä»»ä½•éœ€è¦è¿™äº›å±æ€§çš„å…¶ä»– bean ä¸­ã€‚å¯¹äº OrderControllerï¼Œè¿™æ„å‘³ç€ä» OrderController ä¸­åˆ é™¤ pageSize å±æ€§ï¼Œè€Œä¸æ˜¯æ³¨å…¥å¹¶ä½¿ç”¨ OrderProps beanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/orders&quot;)</span></span><br><span class="line"><span class="meta">@SessionAttributes(&quot;order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> OrderRepository orderRepo;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> OrderProps props;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OrderController</span><span class="params">(OrderRepository orderRepo,</span></span></span><br><span class="line"><span class="params"><span class="function">             OrderProps props)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderRepo = orderRepo;</span><br><span class="line">        <span class="keyword">this</span>.props = props;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">ordersForUser</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="meta">@AuthenticationPrincipal</span> User user, Model model)</span> </span>&#123;</span><br><span class="line">        Pageable pageable = PageRequest.of(<span class="number">0</span>, props.getPageSize());</span><br><span class="line">        model.addAttribute(<span class="string">&quot;orders&quot;</span>,</span><br><span class="line">            orderRepo.findByUserOrderByPlacedAtDesc(user, pageable));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;orderList&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ OrderController ä¸å†è´Ÿè´£å¤„ç†å®ƒè‡ªå·±çš„é…ç½®å±æ€§ã€‚è¿™ä½¿å¾— OrderController ä¸­çš„ä»£ç ç¨å¾®æ•´æ´ä¸€äº›ï¼Œå¹¶å…è®¸åœ¨ä»»ä½•å…¶ä»–éœ€è¦å®ƒä»¬çš„ bean ä¸­é‡ç”¨ OrderProps ä¸­çš„å±æ€§ã€‚æ­¤å¤–ï¼Œæ­£åœ¨æ”¶é›†ä¸ä¸€ä¸ªåœ°æ–¹çš„è®¢å•ç›¸å…³çš„é…ç½®å±æ€§ï¼šOrderProps ç±»ã€‚å¦‚æœéœ€è¦æ·»åŠ ã€åˆ é™¤ã€é‡å‘½åæˆ–ä»¥å…¶ä»–æ–¹å¼æ›´æ”¹å…¶ä¸­çš„å±æ€§ï¼Œåªéœ€è¦åœ¨ OrderProps ä¸­åº”ç”¨è¿™äº›æ›´æ”¹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾åœ¨å…¶ä»–å‡ ä¸ª bean ä¸­ä½¿ç”¨ pageSize å±æ€§ï¼Œè¿™æ—¶æœ€å¥½å¯¹è¯¥å±æ€§åº”ç”¨ä¸€äº›éªŒè¯ï¼Œä»¥å°†å…¶å€¼é™åˆ¶ä¸ºä¸å°äº 5 å’Œä¸å¤§äº 25ã€‚å¦‚æœæ²¡æœ‰æŒæœ‰è€… beanï¼Œå°†ä¸å¾—ä¸å¯¹ OrderControllerã€pageSize å±æ€§ä»¥åŠä½¿ç”¨è¯¥å±æ€§çš„æ‰€æœ‰å…¶ä»–ç±»åº”ç”¨éªŒè¯æ³¨è§£ã€‚ä½†æ˜¯å› ä¸ºå·²ç»å°† pageSize æå–åˆ° OrderProps ä¸­ï¼Œæ‰€ä»¥åªéœ€è¦æ›´æ”¹ OrderPropsï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Max;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Min;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.</span><br><span class="line">ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.annotation.Validated;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;taco.orders&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderProps</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Min(value=5, message=&quot;must be between 5 and 25&quot;)</span></span><br><span class="line">    <span class="meta">@Max(value=25, message=&quot;must be between 5 and 25&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pageSize = <span class="number">20</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//end::validated[]</span></span><br></pre></td></tr></table></figure>

<p>å°½ç®¡å¯ä»¥å¾ˆå®¹æ˜“åœ°å°† @Validatedã€@Min å’Œ @Max æ³¨è§£åº”ç”¨åˆ° OrderControllerï¼ˆä»¥åŠå¯ä»¥æ³¨å…¥ OrderProps çš„ä»»ä½•å…¶ä»– beanï¼‰ï¼Œä½†è¿™åªä¼šä½¿ OrderController æ›´åŠ æ··ä¹±ã€‚é€šè¿‡ä½¿ç”¨é…ç½®å±æ€§æŒæœ‰è€… beanï¼Œå°±åœ¨åœ¨ä¸€ä¸ªåœ°æ–¹æ”¶é›†äº†é…ç½®å±æ€§çš„ç»†èŠ‚ï¼Œä½¿å¾—éœ€è¦è¿™äº›å±æ€§çš„ç±»ç›¸å¯¹å¹²å‡€ã€‚</p>
<h4 id="å£°æ˜é…ç½®å±æ€§å…ƒæ•°æ®"><a href="#å£°æ˜é…ç½®å±æ€§å…ƒæ•°æ®" class="headerlink" title="å£°æ˜é…ç½®å±æ€§å…ƒæ•°æ®"></a>å£°æ˜é…ç½®å±æ€§å…ƒæ•°æ®</h4><p>æ ¹æ® IDE çš„æƒ…å†µï¼Œä½ å¯èƒ½å·²ç»æ³¨æ„åˆ° application.ymlï¼ˆæˆ–æ˜¯ appication.propertiesï¼‰ä¸­çš„ taco.orders.pageSize å±æ€§æœ‰ä¸€ä¸ªè­¦å‘Šï¼Œè¯´ç±»ä¼¼æœªçŸ¥å±æ€§ â€˜tacoâ€™ ä¹‹ç±»çš„ä¸œè¥¿ã€‚å‡ºç°æ­¤è­¦å‘Šæ˜¯å› ä¸ºç¼ºå°‘å…³äºåˆšåˆšåˆ›å»ºçš„é…ç½®å±æ€§çš„å…ƒæ•°æ®ã€‚å›¾ 5.2 æ˜¾ç¤ºäº†æˆ‘å°†é¼ æ ‡æ‚¬åœåœ¨ Spring Tool Suite ä¸­ taco å±æ€§æ—¶çš„æ•ˆæœã€‚</p>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LsZcjYMLbnPglDaJI0e%252F-LsZdKbRL_XIZXJgxNwu%252F%E5%9B%BE%205.2%20%E7%BC%BA%E5%B0%91%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%85%83%E6%95%B0%E6%8D%AE%E5%87%BA%E7%8E%B0%E7%9A%84%E8%AD%A6%E5%91%8A.jpg" alt="img"></p>
<center>å›¾ 5.2 ç¼ºå°‘é…ç½®å±æ€§å…ƒæ•°æ®å‡ºç°çš„è­¦å‘Š</center>

<p>é…ç½®å±æ€§å…ƒæ•°æ®æ˜¯å®Œå…¨å¯é€‰çš„ï¼Œå¹¶ä¸ä¼šé˜»æ­¢é…ç½®å±æ€§çš„å·¥ä½œã€‚ä½†æ˜¯å…ƒæ•°æ®å¯¹äºæä¾›æœ‰å…³é…ç½®å±æ€§çš„æœ€å°æ–‡æ¡£éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨ IDE ä¸­ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå½“æˆ‘å°†é¼ æ ‡æ‚¬åœåœ¨ security.user.password å±æ€§ä¸Šæ—¶ï¼Œå¦‚å›¾5.3æ‰€ç¤ºï¼Œè™½ç„¶æ‚¬åœå¸®åŠ©ä½ è·å¾—çš„æ˜¯æœ€å°çš„ï¼Œä½†å®ƒè¶³ä»¥å¸®åŠ©ä½ äº†è§£å±æ€§çš„ç”¨é€”ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒã€‚</p>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LsZcjYMLbnPglDaJI0e%252F-LsZdP8-rb6FCt_n0avb%252F%E5%9B%BE%205.3%20%E5%9C%A8%20Spring%20Tool%20Suite%20%E4%B8%AD%E6%82%AC%E5%81%9C%E6%98%BE%E7%A4%BA%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E6%96%87%E6%A1%A3.jpg" alt="img"></p>
<center>å›¾ 5.3 åœ¨ Spring Tool Suite ä¸­æ‚¬åœæ˜¾ç¤ºé…ç½®å±æ€§æ–‡æ¡£</center>

<p>ä¸ºäº†å¸®åŠ©é‚£äº›å¯èƒ½ä½¿ç”¨ä½ å®šä¹‰çš„é…ç½®å±æ€§ï¼ˆç”šè‡³å¯èƒ½æ˜¯ä½ è‡ªå·±å®šä¹‰çš„ï¼‰çš„äººï¼Œé€šå¸¸æœ€å¥½æ˜¯å›´ç»•è¿™äº›å±æ€§åˆ›å»ºä¸€äº›å…ƒæ•°æ®ï¼Œè‡³å°‘å®ƒæ¶ˆé™¤äº† IDE ä¸­é‚£äº›æ¼äººçš„é»„è‰²è­¦å‘Šã€‚</p>
<p>è¦ä¸ºè‡ªå®šä¹‰é…ç½®å±æ€§åˆ›å»ºå…ƒæ•°æ®ï¼Œéœ€è¦åœ¨ META-INFï¼ˆä¾‹å¦‚ï¼Œåœ¨é¡¹ç›®ä¸‹çš„ src/main/resources/META-INF ä¸­ï¼‰ä¸­åˆ›å»ºä¸€ä¸ªåä¸º addition-spring-configuration-metadata.json çš„æ–‡ä»¶ã€‚</p>
<p>å¿«é€Ÿä¿®å¤ç¼ºå¤±çš„å…ƒæ•°æ®ã€‚</p>
<p>å¦‚æœæ­£åœ¨ä½¿ç”¨ Spring Tool Suiteï¼Œåˆ™æœ‰ä¸€ä¸ªç”¨äºåˆ›å»ºä¸¢å¤±çš„å±æ€§å…ƒæ•°æ®çš„å¿«é€Ÿä¿®å¤é€‰é¡¹ã€‚å°†å…‰æ ‡æ”¾åœ¨ç¼ºå°‘å…ƒæ•°æ®è­¦å‘Šçš„è¡Œä¸Šï¼Œç„¶åæŒ‰ä¸‹ Mac ä¸Šçš„ CMD-1 æˆ– Windows å’Œ Linux ä¸Šçš„ Ctrl-1 å¼¹å‡ºçš„å¿«é€Ÿä¿®å¤ï¼ˆå‚è§å›¾ 5.4ï¼‰ã€‚</p>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LsZcjYMLbnPglDaJI0e%252F-LsZdVr9E9-80kOiQnqZ%252F%E5%9B%BE%205.4%20%E5%9C%A8%20Spring%20Tool%20Suite%20%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%BF%AB%E9%80%9F%E5%BC%B9%E5%87%BA%E6%96%B9%E5%BC%8F%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%85%83%E6%95%B0%E6%8D%AE.jpg" alt="img"></p>
<p>ç„¶åé€‰æ‹© <code>Create Metadata forâ€¦</code> é€‰é¡¹æ¥ä¸ºå±æ€§æ·»åŠ ä¸€äº›å…ƒæ•°æ®ï¼ˆåœ¨ additional-spring-configuration-metadata ä¸­)ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¯¥æ–‡ä»¶ã€‚</p>
<p>å¯¹äº taco.orders.pageSize å±æ€§ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹ JSON è®¾ç½®å…ƒæ•°æ®ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;taco.orders.page-size&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;java.lang.String&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;description&quot;</span>:<span class="string">&quot;Sets the maximum number of orders to display in a list.&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œå…ƒæ•°æ®ä¸­å¼•ç”¨çš„å±æ€§åæ˜¯ taco.orders.pagesizeã€‚Spring Boot çµæ´»çš„å±æ€§å‘½åå…è®¸å±æ€§åçš„å˜åŒ–ï¼Œæ¯”å¦‚ taco.orders.page-size ç›¸å½“äº taco.orders.pageSizeã€‚</p>
<p>æœ‰äº†è¿™äº›å…ƒæ•°æ®ï¼Œè­¦å‘Šå°±åº”è¯¥æ¶ˆå¤±äº†ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå¦‚æœä½ æ‚¬åœåœ¨ taco.orders.pageSize å±æ€§ï¼Œä½ å°†çœ‹åˆ°å¦‚å›¾ 5.5 æ‰€ç¤ºçš„æè¿°ã€‚</p>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LsZcjYMLbnPglDaJI0e%252F-LsZdg6iY-cefGQE_L7A%252F%E5%9B%BE%205.5%20%E6%82%AC%E5%81%9C%E6%98%BE%E7%A4%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%B8%AE%E5%8A%A9.jpg" alt="img"></p>
<center>å›¾ 5.5 æ‚¬åœæ˜¾ç¤ºè‡ªå®šä¹‰é…ç½®å±æ€§å¸®åŠ©</center>

<p>å¦å¤–ï¼Œå¦‚å›¾ 5.6 æ‰€ç¤ºï¼Œå¯ä»¥ä» IDE è·å¾—è‡ªåŠ¨å®Œæˆå¸®åŠ©ï¼Œå°±åƒ Springprovided çš„é…ç½®å±æ€§ä¸€æ ·ã€‚</p>
<p><img src="/2021/12/10/Java/spring/spring-in-action-v5-notes/assets%252F-LrmLE3NwQoVJk02Q_BX%252F-LsZcjYMLbnPglDaJI0e%252F-LsZdkjiPqqxVdb6YAfr%252F%E5%9B%BE%205.6%20%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%85%83%E6%95%B0%E6%8D%AE%E8%AE%A9%E5%B1%9E%E6%80%A7%E5%80%BC%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85.jpg" alt="img"></p>
<center>å›¾ 5.6 é…ç½®å±æ€§å…ƒæ•°æ®è®©å±æ€§å€¼è‡ªåŠ¨å¡«å……</center>

<p>é…ç½®å±æ€§å¯¹äºè°ƒæ•´è‡ªåŠ¨é…ç½®çš„ç»„ä»¶å’Œæ³¨å…¥åˆ°åº”ç”¨ç¨‹åº bean ä¸­çš„ç»†èŠ‚éå¸¸æœ‰ç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœéœ€è¦ä¸ºä¸åŒçš„éƒ¨ç½²ç¯å¢ƒé…ç½®ä¸åŒçš„å±æ€§å‘¢ï¼Ÿè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Spring é…ç½®æ–‡ä»¶æ¥è®¾ç½®ç‰¹å®šäºç¯å¢ƒçš„é…ç½®ã€‚</p>
<h3 id="ä½¿ç”¨-profile-æ–‡ä»¶è¿›è¡Œé…ç½®"><a href="#ä½¿ç”¨-profile-æ–‡ä»¶è¿›è¡Œé…ç½®" class="headerlink" title="ä½¿ç”¨ profile æ–‡ä»¶è¿›è¡Œé…ç½®"></a>ä½¿ç”¨ profile æ–‡ä»¶è¿›è¡Œé…ç½®</h3><p>å½“åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°ä¸åŒçš„è¿è¡Œæ—¶ç¯å¢ƒæ—¶ï¼Œé€šå¸¸ä¼šæœ‰ä¸€äº›é…ç½®ç»†èŠ‚ä¸åŒã€‚ä¾‹å¦‚ï¼Œæ•°æ®åº“è¿æ¥çš„ç»†èŠ‚åœ¨å¼€å‘ç¯å¢ƒä¸­å¯èƒ½ä¸åœ¨ QA ç¯å¢ƒä¸­ä¸ä¸€æ ·ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½è¿˜ä¸ä¸€æ ·ã€‚åœ¨ä¸€ä¸ªç¯å¢ƒä¸­å”¯ä¸€é…ç½®å±æ€§çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥æŒ‡å®šé…ç½®å±æ€§ï¼Œè€Œä¸æ˜¯åœ¨ application.properties æˆ– application.yml ä¸­å®šä¹‰å®ƒä»¬ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨å¼€å‘æœŸé—´ï¼Œå¯ä»¥ä¾èµ–äºè‡ªåŠ¨é…ç½®çš„åµŒå…¥å¼ H2 æ•°æ®åº“ã€‚ä½†åœ¨ç”Ÿäº§ä¸­ï¼Œå¯ä»¥å°†æ•°æ®åº“é…ç½®å±æ€§è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span> <span class="string">export SPRING_DATASOURCE_URL=jdbc:mysql://localhost/tacocloud</span></span><br><span class="line"><span class="meta">%</span> <span class="string">export SPRING_DATASOURCE_USERNAME=tacouser</span></span><br><span class="line"><span class="meta">%</span> <span class="string">export SPRING_DATASOURCE_PASSWORD=tacopassword</span></span><br></pre></td></tr></table></figure>

<p>å°½ç®¡è¿™æ ·åšæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å°†ä¸€ä¸¤ä¸ªä»¥ä¸Šçš„é…ç½®å±æ€§æŒ‡å®šä¸ºç¯å¢ƒå˜é‡å°±ä¼šå˜å¾—æœ‰ç‚¹éº»çƒ¦ã€‚æ­¤å¤–ï¼Œæ²¡æœ‰è·Ÿè¸ªç¯å¢ƒå˜é‡æ›´æ”¹çš„å¥½æ–¹æ³•ï¼Œä¹Ÿæ²¡æœ‰åœ¨å‡ºç°é”™è¯¯æ—¶è½»æ¾å›æ»šæ›´æ”¹çš„å¥½æ–¹æ³•ã€‚</p>
<p>ç›¸åï¼Œæˆ‘æ›´å–œæ¬¢åˆ©ç”¨ Spring profile æ–‡ä»¶ã€‚profile æ–‡ä»¶æ˜¯ä¸€ç§æ¡ä»¶é…ç½®ç±»å‹ï¼Œå…¶ä¸­æ ¹æ®è¿è¡Œæ—¶æ¿€æ´»çš„ profile æ–‡ä»¶åº”ç”¨æˆ–å¿½ç•¥ä¸åŒçš„ beanã€é…ç½®ç±»å’Œé…ç½®å±æ€§ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾å‡ºäºå¼€å‘å’Œè°ƒè¯•çš„ç›®çš„ï¼Œå¸Œæœ›ä½¿ç”¨åµŒå…¥å¼ H2 æ•°æ®åº“ï¼Œå¹¶ä¸”å¸Œæœ›å°† Taco Cloud ä»£ç çš„æ—¥å¿—çº§åˆ«è®¾ç½®ä¸º DEBUGã€‚ä½†æ˜¯åœ¨ç”Ÿäº§ä¸­ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨ MySQL æ•°æ®åº“ï¼Œå¹¶å°†æ—¥å¿—è®°å½•çº§åˆ«è®¾ç½®ä¸º WARNã€‚åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œå¾ˆå®¹æ˜“ä¸è®¾ç½®ä»»ä½•æ•°æ®æºå±æ€§å¹¶è·å¾—è‡ªåŠ¨é…ç½®çš„ H2 æ•°æ®åº“ã€‚è‡³äº DEBUG çº§åˆ«çš„æ—¥å¿—è®°å½•ï¼Œå¯ä»¥åœ¨ application.yml ä¸­è®¾ç½® logging.level.tacos å±æ€§ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">tacos:</span> <span class="string">DEBUG</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ­£æ˜¯å¼€å‘ç›®çš„æ‰€éœ€è¦çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦å°†æ­¤åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè€Œä¸éœ€è¦å¯¹ application.yml è¿›è¡Œè¿›ä¸€æ­¥æ›´æ”¹ï¼Œä»ç„¶å¯ä»¥è·å¾—å¯¹äº tacos åŒ…çš„è°ƒè¯•æ—¥å¿—å’ŒåµŒå…¥å¼ H2 æ•°æ®åº“ã€‚éœ€è¦çš„æ˜¯å®šä¹‰ä¸€ä¸ªå…·æœ‰é€‚åˆç”Ÿäº§çš„å±æ€§çš„ profile æ–‡ä»¶ã€‚</p>
<h4 id="å®šä¹‰ç‰¹å®š-profile-çš„å±æ€§"><a href="#å®šä¹‰ç‰¹å®š-profile-çš„å±æ€§" class="headerlink" title="å®šä¹‰ç‰¹å®š profile çš„å±æ€§"></a>å®šä¹‰ç‰¹å®š profile çš„å±æ€§</h4><p>å®šä¹‰ç‰¹å®š profile æ–‡ä»¶çš„å±æ€§çš„ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºå¦ä¸€ä¸ªä»…åŒ…å«ç”¨äºç”Ÿäº§çš„å±æ€§çš„ YAML æˆ–å±æ€§æ–‡ä»¶ã€‚æ–‡ä»¶çš„åç§°åº”è¯¥éµå¾ªè¿™ä¸ªçº¦å®šï¼šapplication-{profile åç§°}.yml æˆ– application-{profile åç§°}.propertiesã€‚ç„¶åå¯ä»¥æŒ‡å®šé€‚åˆè¯¥é…ç½®æ–‡ä»¶çš„é…ç½®å±æ€§ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º application-prod.yml çš„æ–°æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost/tacocloud</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">tacouser</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">tacopassword</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">tacos:</span> <span class="string">WARN</span></span><br></pre></td></tr></table></figure>

<p>å¦ä¸€ç§æŒ‡å®šç‰¹å®š profile æ–‡ä»¶çš„å±æ€§çš„æ–¹æ³•åªé€‚ç”¨äº YAML é…ç½®ã€‚å®ƒæ¶‰åŠåœ¨åº”ç”¨ç¨‹åºä¸­å°†ç‰¹å®š profile çš„å±æ€§ä¸é profile çš„å±æ€§ä¸€èµ·æ”¾åœ¨ application.yml ä¸­ï¼Œç”±ä¸‰ä¸ªè¿å­—ç¬¦åˆ†éš”ã€‚å°†ç”Ÿäº§å±æ€§åº”ç”¨äº application.yml æ—¶ï¼Œæ•´ä¸ª application.yml åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">tacos:</span> <span class="string">DEBUG</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">prod</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost/tacocloud</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">tacouser</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">tacopassword</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">tacos:</span> <span class="string">WARN</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª application.yml æ–‡ä»¶ç”±ä¸€ç»„ä¸‰é‡è¿å­—ç¬¦ï¼ˆâ€”ï¼‰åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ã€‚ç¬¬äºŒéƒ¨åˆ†ä¸º spring.profiles æŒ‡å®šä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼æŒ‡ç¤ºäº†éšååº”ç”¨äº prod é…ç½®æ–‡ä»¶çš„å±æ€§ã€‚å¦ä¸€æ–¹é¢ï¼Œç¬¬ä¸€éƒ¨åˆ†æ²¡æœ‰ä¸º spring.profiles æŒ‡å®šå€¼ã€‚å› æ­¤ï¼Œå®ƒçš„å±æ€§å¯¹äºæ‰€æœ‰ profile æ–‡ä»¶éƒ½æ˜¯é€šç”¨çš„ï¼Œæˆ–è€…å¦‚æœæŒ‡å®šçš„ profile æ–‡ä»¶æ²¡æœ‰è®¾ç½®å…¶ä»–å±æ€§ï¼Œå®ƒå°±æ˜¯é»˜è®¤çš„ã€‚</p>
<p>æ— è®ºåº”ç”¨ç¨‹åºè¿è¡Œæ—¶å“ªä¸ªé…ç½®æ–‡ä»¶å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œtacos åŒ…çš„æ—¥å¿—çº§åˆ«éƒ½å°†é€šè¿‡é»˜è®¤é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§è®¾ç½®ä¸º DEBUGã€‚ä½†æ˜¯ï¼Œå¦‚æœåä¸º prod çš„é…ç½®æ–‡ä»¶æ˜¯æ´»åŠ¨çš„ï¼Œé‚£ä¹ˆ logging.level.tacos å±æ€§å°†ä¼šè¢«é‡å†™ä¸º WARNã€‚åŒæ ·ï¼Œå¦‚æœ prod é…ç½®æ–‡ä»¶æ˜¯æ´»åŠ¨çš„ï¼Œé‚£ä¹ˆæ•°æ®æºå±æ€§å°†è®¾ç½®ä¸ºä½¿ç”¨å¤–éƒ¨ MySQL æ•°æ®åº“ã€‚</p>
<p>é€šè¿‡åˆ›å»ºä½¿ç”¨ application-{profile åç§°}.yml æˆ– application-{profile åç§°}.properties è¿™ç§æ¨¡å¼å‘½åçš„å…¶ä»– YAML æˆ– properties æ–‡ä»¶ï¼Œå¯ä»¥ä¸ºä»»æ„æ•°é‡çš„ profile æ–‡ä»¶å®šä¹‰å±æ€§ã€‚æˆ–è€…åœ¨ application.yml ä¸­å†è¾“å…¥ä¸‰ä¸ªç ´æŠ˜å·é€šè¿‡ spring.profiles æ¥æŒ‡å®šé…ç½®æ–‡ä»¶åç§°ã€‚ç„¶åæ·»åŠ éœ€è¦çš„æ‰€æœ‰ç‰¹å®š profile æ–‡ä»¶çš„å±æ€§ã€‚</p>
<h4 id="æ¿€æ´»-profile-æ–‡ä»¶"><a href="#æ¿€æ´»-profile-æ–‡ä»¶" class="headerlink" title="æ¿€æ´» profile æ–‡ä»¶"></a>æ¿€æ´» profile æ–‡ä»¶</h4><p>è®¾ç½®ç‰¹å®š profile å±æ€§æ²¡æœ‰ä»€ä¹ˆæ„æ€ï¼Œé™¤éè¿™äº› profile å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚ä½†æ˜¯è¦å¦‚ä½•æ¿€æ´»ä¸€ä¸ª profile æ–‡ä»¶å‘¢ï¼Ÿè®©ä¸€ä¸ª profile æ–‡ä»¶å¤„äºæ¿€æ´»çŠ¶æ€éœ€è¦åšçš„åªæ˜¯å°† spring.profiles.active å±æ€§çš„å€¼æŒ‡å®šä¸ºéœ€è¦æ¿€æ´»çš„ profile çš„åç§°ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·è®¾ç½® application.yml ä¸­çš„è¿™ä¸ªå±æ€§ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">prod</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™å¯èƒ½æ˜¯è®¾å®šä¸€ä¸ªæ´»åŠ¨ profile æœ€ç³Ÿç³•çš„æ–¹å¼äº†ã€‚å¦‚æœåœ¨ application.yml ä¸­è®¾ç½®äº†æ¿€æ´»çš„ profileï¼Œç„¶åé‚£ä¸ª profile æ–‡ä»¶å°±å˜æˆäº†é»˜è®¤ profile æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰è¾¾åˆ°ç”Ÿäº§ç¯å¢ƒç‰¹å®šå±æ€§ä¸å¼€å‘ç¯å¢ƒç‰¹å®šå±æ€§åˆ†ç¦»çš„ç›®çš„ã€‚ç›¸åï¼Œæˆ‘æ¨èä½¿ç”¨ç¯å¢ƒå˜é‡è®¾ç½®æ¿€æ´»çš„ profileã€‚åœ¨ç”Ÿäº§ç¯å¢ƒï¼Œåƒä¸‹é¢è¿™æ ·è®¾ç½® SPRING_PROFILES_ACTIVEï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% <span class="built_in">export</span> SPRING_PROFILES_ACTIVE=prod</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·è®¾ç½®å®Œæˆåï¼Œéƒ¨ç½²äºé‚£å°æœºå™¨çš„ä»»ä½•åº”ç”¨ç¨‹åºå°†ä¼šä½¿ç”¨ prod profileï¼ŒåŒæ—¶ç›¸åº”çš„é…ç½®å±æ€§å°†ä¼˜å…ˆäºé»˜è®¤é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§ã€‚</p>
<p>å¦‚æœä½¿ç”¨å¯æ‰§è¡Œçš„ JAR æ–‡ä»¶æ¥è¿è¡Œåº”ç”¨ç¨‹åºï¼Œä½ å¯èƒ½ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œè®¾ç½®æ¿€æ´»çš„ profile æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% java -jar taco-cloud.jar --spring.profiles.active=prod</span><br></pre></td></tr></table></figure>

<p>è¯·æ³¨æ„ spring.profiles.active å±æ€§ååŒ…å«çš„æ˜¯å¤æ•°å•è¯ profilesã€‚è¿™æ„å‘³ç€å¯ä»¥æŒ‡å®šå¤šä¸ªæ´»åŠ¨ profiles æ–‡ä»¶ã€‚é€šå¸¸ï¼Œè¿™æ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„åˆ—è¡¨ï¼Œå½“å®ƒè®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% <span class="built_in">export</span> SPRING_PROFILES_ACTIVE=prod,audit,ha</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯åœ¨ YAML ä¸­ï¼Œéœ€è¦åƒä¸‹é¢è¿™æ ·æŒ‡å®šå®ƒï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">prod</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">audit</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ha</span></span><br></pre></td></tr></table></figure>

<p>åŒæ ·å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå°† Spring åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Cloud Foundry ä¸­ï¼Œä¸€ä¸ªåä¸º cloud çš„é…ç½®æ–‡ä»¶ä¼šè‡ªåŠ¨æ¿€æ´»ã€‚å¦‚æœ Cloud Foundry æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œé‚£ä¹ˆéœ€è¦ç¡®ä¿åœ¨ cloud profile æ–‡ä»¶ä¸­æŒ‡å®šäº†ç‰¹å®šäºç”Ÿäº§ç¯å¢ƒçš„å±æ€§ã€‚</p>
<p>äº‹å®è¯æ˜ï¼Œé…ç½®æ–‡ä»¶åªå¯¹åœ¨ Spring åº”ç”¨ç¨‹åºä¸­æœ‰æ¡ä»¶åœ°è®¾ç½®é…ç½®å±æ€§æœ‰ç”¨ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å£°æ˜ç‰¹å®šæ´»åŠ¨ profile æ–‡ä»¶çš„ beanã€‚</p>
<h4 id="æœ‰æ¡ä»¶åœ°ä½¿ç”¨-profile-æ–‡ä»¶åˆ›å»º-bean"><a href="#æœ‰æ¡ä»¶åœ°ä½¿ç”¨-profile-æ–‡ä»¶åˆ›å»º-bean" class="headerlink" title="æœ‰æ¡ä»¶åœ°ä½¿ç”¨ profile æ–‡ä»¶åˆ›å»º bean"></a>æœ‰æ¡ä»¶åœ°ä½¿ç”¨ profile æ–‡ä»¶åˆ›å»º bean</h4><p>æœ‰æ—¶å€™ï¼Œä¸ºä¸åŒçš„é…ç½®æ–‡ä»¶æä¾›ä¸€ç»„æƒŸä¸€çš„ bean æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚é€šå¸¸ï¼Œä¸ç®¡å“ªä¸ª profile æ–‡ä»¶æ˜¯æ´»åŠ¨çš„ï¼ŒJava é…ç½®ç±»ä¸­å£°æ˜çš„ä»»ä½• bean éƒ½ä¼šè¢«åˆ›å»ºã€‚ä½†æ˜¯ï¼Œå‡è®¾åªæœ‰åœ¨æŸä¸ªé…ç½®æ–‡ä»¶å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶æ‰éœ€è¦åˆ›å»ºä¸€äº› beanï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ@Profile æ³¨è§£å¯ä»¥å°† bean æŒ‡å®šä¸ºåªé€‚ç”¨äºç»™å®šçš„ profile æ–‡ä»¶ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ TacoCloudApplication ä¸­å£°æ˜äº†ä¸€ä¸ª CommandLineRunner beanï¼Œç”¨äºåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶åŠ è½½åµŒå…¥å¼æ•°æ®åº“ä¸­çš„æˆåˆ†æ•°æ®ã€‚è¿™å¯¹äºå¼€å‘æ¥è¯´å¾ˆå¥½ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§åº”ç”¨ç¨‹åºä¸­æ˜¯ä¸å¿…è¦çš„ï¼ˆä¹Ÿæ˜¯ä¸å—æ¬¢è¿çš„ï¼‰ã€‚ä¸ºäº†é˜²æ­¢åœ¨æ¯æ¬¡åº”ç”¨ç¨‹åºåœ¨ç”Ÿäº§éƒ¨ç½²ä¸­å¯åŠ¨æ—¶åŠ è½½æˆåˆ†æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ @Profile åƒä¸‹é¢è¿™æ ·æ³¨è§£ CommandLineRunner bean æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Profile(&quot;dev&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CommandLineRunner <span class="title">dataLoader</span><span class="params">(IngredientRepository repo,</span></span></span><br><span class="line"><span class="params"><span class="function">     UserRepository userRepo, PasswordEncoder encoder)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–æ˜¯å‡è®¾éœ€è¦åœ¨ dev profile æˆ–æ˜¯ qa profile è¢«æ¿€æ´»æ—¶åˆ›å»º CommandLineRunnerï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ—å‡ºéœ€è¦çš„ profileï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Profile(&#123;&quot;dev&quot;, &quot;qa&quot;&#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CommandLineRunner <span class="title">dataLoader</span><span class="params">(IngredientRepository repo,</span></span></span><br><span class="line"><span class="params"><span class="function">     UserRepository userRepo, PasswordEncoder encoder)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æˆåˆ†æ•°æ®åªä¼šåœ¨ dev æˆ–æ˜¯ qa profile æ–‡ä»¶è¢«æ¿€æ´»æ—¶æ‰ä¼šè¢«åŠ è½½ã€‚è¿™å°±æ„å‘³ç€éœ€è¦åœ¨å¼€å‘ç¯å¢ƒè¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼Œå°† dev profile æ¿€æ´»ã€‚å¦‚æœè¿™ä¸ª CommandLineRunner bean æ€»æ˜¯è¢«åˆ›å»ºï¼Œé™¤é prod é…ç½®æ–‡ä»¶æ˜¯æ´»åŠ¨çš„ï¼Œé‚£å°±æ›´æ–¹ä¾¿äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥åƒè¿™æ ·åº”ç”¨ @Profileï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Profile(&quot;!prod&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CommandLineRunner <span class="title">dataLoader</span><span class="params">(IngredientRepository repo, </span></span></span><br><span class="line"><span class="params"><span class="function">      UserRepository userRepo, PasswordEncoder encoder)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæ„Ÿå¹å· <code>!</code>å¦å®šäº†é…ç½®æ–‡ä»¶åç§°ã€‚å®é™…ä¸Šï¼Œå®ƒå£°æ˜å¦‚æœ prod é…ç½®æ–‡ä»¶ä¸æ˜¯æ´»åŠ¨çš„ï¼Œå°±ä¼šåˆ›å»º CommandLineRunner beanã€‚</p>
<p>ä¹Ÿå¯ä»¥åœ¨æ•´ä¸ª @Configuration æ³¨è§£çš„ç±»ä¸Šä½¿ç”¨ @Profileã€‚ä¾‹å¦‚ï¼Œå‡è®¾è¦å°† CommandLineRunner bean æå–åˆ°ä¸€ä¸ªåä¸º DevelopmentConfig çš„å•ç‹¬é…ç½®ç±»ä¸­ã€‚ç„¶åä½ å¯ä»¥ç”¨ @Profile æ¥æ³¨è§£ DevelopmentConfigï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Profile(&#123;&quot;!prod&quot;, &quot;!qa&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DevelopmentConfig</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommandLineRunner <span class="title">dataLoader</span><span class="params">(IngredientRepository repo,</span></span></span><br><span class="line"><span class="params"><span class="function">          UserRepository userRepo, PasswordEncoder encoder)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼ŒCommandLineRunner beanï¼ˆä»¥åŠåœ¨ DevelopmentConfig ä¸­å®šä¹‰çš„ä»»ä½•å…¶ä»– beanï¼‰ä»…åœ¨ prod å’Œ qa é…ç½®æ–‡ä»¶éƒ½ä¸æ´»åŠ¨çš„æƒ…å†µä¸‹æ‰ä¼šè¢«åˆ›å»ºã€‚</p>
<p>å°ç»“</p>
<ul>
<li>å¯ä»¥ä½¿ç”¨ @ConfigurationProperties æ³¨è§£ Spring beanï¼Œä»¥æ”¯æŒä»å‡ ä¸ªå±æ€§æºä¹‹ä¸€æ³¨å…¥å€¼ã€‚</li>
<li>å¯ä»¥åœ¨å‘½ä»¤è¡Œå‚æ•°ã€ç¯å¢ƒå˜é‡ã€JVM ç³»ç»Ÿå±æ€§ã€å±æ€§æ–‡ä»¶æˆ– YAML æ–‡ä»¶ç­‰é€‰é¡¹ä¸­è®¾ç½®é…ç½®å±æ€§ã€‚</li>
<li>é…ç½®å±æ€§å¯ç”¨äºè¦†ç›–è‡ªåŠ¨é…ç½®è®¾ç½®ï¼ŒåŒ…æ‹¬æŒ‡å®šæ•°æ®æº URL å’Œæ—¥å¿—çº§åˆ«çš„èƒ½åŠ›ã€‚</li>
<li>Spring profile æ–‡ä»¶å¯ä»¥ä¸å±æ€§æºä¸€èµ·ä½¿ç”¨ï¼Œæ ¹æ®æ´»åŠ¨é…ç½®æ–‡ä»¶æœ‰æ¡ä»¶åœ°è®¾ç½®é…ç½®å±æ€§ã€‚</li>
</ul>
<h1 id="ç¬¬äºŒéƒ¨åˆ†-é›†æˆ-Spring"><a href="#ç¬¬äºŒéƒ¨åˆ†-é›†æˆ-Spring" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ† é›†æˆ Spring"></a>ç¬¬äºŒéƒ¨åˆ† é›†æˆ Spring</h1><p>ç¬¬ 2 éƒ¨åˆ†çš„ç« èŠ‚ä»‹ç»äº†ä¸€äº›æœ‰åŠ©äºå°† Spring åº”ç”¨ç¨‹åºä¸å…¶ä»–åº”ç”¨ç¨‹åºé›†æˆåœ¨ä¸€èµ·çš„ä¸»é¢˜ã€‚</p>
<h2 id="ç¬¬-6-ç« -åˆ›å»º-REST-æœåŠ¡"><a href="#ç¬¬-6-ç« -åˆ›å»º-REST-æœåŠ¡" class="headerlink" title="ç¬¬ 6 ç«  åˆ›å»º REST æœåŠ¡"></a>ç¬¬ 6 ç«  åˆ›å»º REST æœåŠ¡</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>åœ¨ Spring MVC ä¸­å®šä¹‰ REST ç«¯ç‚¹</li>
<li>å¯ç”¨è¶…é“¾æ¥ REST èµ„æº</li>
<li>è‡ªåŠ¨ç”ŸæˆåŸºäºå­˜å‚¨åº“çš„ REST ç«¯ç‚¹</li>
</ul>
<p>è®¸å¤šåº”ç”¨ç¨‹åºé‡‡ç”¨äº†ä¸€ç§å¸¸è§çš„è®¾è®¡ï¼šå°†ç”¨æˆ·ç•Œé¢æ¨è¿‘å®¢æˆ·ç«¯ï¼Œè€ŒæœåŠ¡å™¨å…¬å¼€ä¸€ä¸ª APIï¼Œé€šè¿‡è¯¥ APIï¼Œæ‰€æœ‰ç±»å‹çš„å®¢æˆ·ç«¯éƒ½å¯ä»¥ä¸åç«¯è¿›è¡Œäº¤äº’ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œå°†ä½¿ç”¨ Spring ä¸º Taco Cloud åº”ç”¨ç¨‹åºæä¾› REST APIã€‚</p>
<h3 id="ç¼–å†™-RESTful-æ§åˆ¶å™¨"><a href="#ç¼–å†™-RESTful-æ§åˆ¶å™¨" class="headerlink" title="ç¼–å†™ RESTful æ§åˆ¶å™¨"></a>ç¼–å†™ RESTful æ§åˆ¶å™¨</h3><p>Spring MVC ä¸ºå„ç§ç±»å‹çš„ HTTP è¯·æ±‚æ”¯æŒå°‘é‡å…¶ä»–æ³¨è§£ï¼Œå¦‚è¡¨ 6.1 æ‰€ç¤ºã€‚</p>
<center>è¡¨ 6.1 Spring MVC HTTP è¯·æ±‚å¤„ç†æ³¨è§£</center>

<table>
<thead>
<tr>
<th>æ³¨è§£</th>
<th>HTTP æ–¹æ³•</th>
<th>å…¸å‹ç”¨æ³•</th>
</tr>
</thead>
<tbody><tr>
<td>@GetMapping</td>
<td>HTTP GET è¯·æ±‚</td>
<td>è¯»å–èµ„æºæ•°æ®</td>
</tr>
<tr>
<td>@PostMapping</td>
<td>HTTP POST è¯·æ±‚</td>
<td>åˆ›å»ºèµ„æº</td>
</tr>
<tr>
<td>@PutMapping</td>
<td>HTTP PUT è¯·æ±‚</td>
<td>æ›´æ–°èµ„æº</td>
</tr>
<tr>
<td>@PatchMapping</td>
<td>HTTP PATCH è¯·æ±‚</td>
<td>æ›´æ–°èµ„æº</td>
</tr>
<tr>
<td>@DeleteMapping</td>
<td>HTTP DELETE è¯·æ±‚</td>
<td>åˆ é™¤èµ„æº</td>
</tr>
<tr>
<td>@RequestMapping</td>
<td>é€šç”¨è¯·æ±‚å¤„ç†</td>
<td></td>
</tr>
</tbody></table>
<h4 id="ä»æœåŠ¡å™¨è·å–æ•°æ®"><a href="#ä»æœåŠ¡å™¨è·å–æ•°æ®" class="headerlink" title="ä»æœåŠ¡å™¨è·å–æ•°æ®"></a>ä»æœåŠ¡å™¨è·å–æ•°æ®</h4><p>å¤„ç† <code>/design/recent</code> æ¥å£çš„ GET è¯·æ±‚ ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªæœ€æ–°è®¾è®¡çš„ taco åˆ—è¡¨è¿›è¡Œå“åº”ã€‚</p>
<center>ç¨‹åºæ¸…å• 6.2 taco è®¾è®¡ API è¯·æ±‚çš„ RESTful æ§åˆ¶å™¨</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.web.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.PageRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Sort;</span><br><span class="line"><span class="keyword">import</span> org.springframework.hateoas.EntityLinks;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.CrossOrigin;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tacos.Taco;</span><br><span class="line"><span class="keyword">import</span> tacos.data.TacoRepository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(path=&quot;/design&quot;, produces=&quot;application/json&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin(origins=&quot;*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DesignTacoController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> TacoRepository tacoRepo;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    EntityLinks entityLinks;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DesignTacoController</span><span class="params">(TacoRepository tacoRepo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tacoRepo = tacoRepo;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/recent&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterable&lt;Taco&gt; <span class="title">recentTacos</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PageRequest page = PageRequest.of(<span class="number">0</span>, <span class="number">12</span>, Sort.by(<span class="string">&quot;createdAt&quot;</span>).descending());</span><br><span class="line">        <span class="keyword">return</span> tacoRepo.findAll(page).getContent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@RestController æ³¨è§£æœ‰ä¸¤ä¸ªç”¨é€”ã€‚é¦–å…ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸå‹æ³¨è§£ï¼Œé€šè¿‡ç»„ä»¶æ‰«ææ¥æ ‡è®°ä¸€ä¸ªç±»ã€‚ä¸ REST çš„è®¨è®ºæœ€ç›¸å…³çš„æ˜¯ï¼Œ@RestController æ³¨è§£å‘Šè¯‰ Springï¼Œæ§åˆ¶å™¨ä¸­çš„æ‰€æœ‰å¤„ç†ç¨‹åºæ–¹æ³•éƒ½åº”è¯¥å°†å®ƒä»¬çš„è¿”å›å€¼ç›´æ¥å†™å…¥å“åº”ä½“ï¼Œè€Œä¸æ˜¯åœ¨æ¨¡å‹ä¸­è¢«å¸¦åˆ°è§†å›¾ä¸­è¿›è¡Œå‘ˆç°ã€‚</p>
<p>æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨ @Controller æ¥æ³¨è§£ DesignTacoControllerï¼Œå°±åƒä½¿ç”¨ä»»ä½• Spring MVC æ§åˆ¶å™¨ä¸€æ ·ã€‚ä½†æ˜¯ï¼Œè¿˜éœ€è¦ä½¿ç”¨ @ResponseBody æ³¨è§£æ‰€æœ‰å¤„ç†ç¨‹åºæ–¹æ³•ï¼Œä»¥è·å¾—ç›¸åŒçš„ç»“æœã€‚å¦ä¸€ä¸ªé€‰é¡¹æ˜¯è¿”å›ä¸€ä¸ª ResponseEntity å¯¹è±¡ã€‚</p>
<p>ç±»çº§åˆ«çš„ @RequestMapping æ³¨è§£ä¸ recentTacos() æ–¹æ³•ä¸Šçš„ @GetMapping æ³¨è§£ä¸€èµ·å·¥ä½œï¼Œä»¥æŒ‡å®š recentTacos() æ–¹æ³•è´Ÿè´£å¤„ç† <code>/design/recent</code> æ¥å£çš„ GET è¯·æ±‚ã€‚</p>
<p>æ³¨æ„ï¼Œ@RequestMapping æ³¨è§£è¿˜è®¾ç½®äº†ä¸€ä¸ª produces å±æ€§ã€‚è¿™æŒ‡å®šäº† DesignTacoController ä¸­çš„ä»»ä½•å¤„ç†ç¨‹åºæ–¹æ³•åªåœ¨è¯·æ±‚çš„ Accept å¤´åŒ…å« â€œapplication/jsonâ€ æ—¶æ‰å¤„ç†è¯·æ±‚ã€‚è¿™ä¸ä»…é™åˆ¶äº† API åªç”Ÿæˆ JSON ç»“æœï¼Œè¿˜å…è®¸å¦ä¸€ä¸ªæ§åˆ¶å™¨ï¼ˆå¯èƒ½æ˜¯ç¬¬ 2 ç« ä¸­çš„ DesignTacoControllerï¼‰å¤„ç†å…·æœ‰ç›¸åŒè·¯å¾„çš„è¯·æ±‚ï¼Œåªè¦è¿™äº›è¯·æ±‚ä¸éœ€è¦ JSON è¾“å‡ºã€‚</p>
<p>åœ¨ç¨‹åºæ¸…å• 6.2 ä¸­å¯èƒ½æ³¨æ„åˆ°çš„å¦ä¸€ä»¶äº‹æ˜¯ï¼Œè¯¥ç±»æ˜¯ç”¨ @CrossOrigin æ³¨è§£äº†çš„ã€‚ç”±äºåº”ç”¨ç¨‹åºçš„ Angular éƒ¨åˆ†å°†è¿è¡Œåœ¨ç‹¬ç«‹äº API çš„ä¸»æœºæˆ–ç«¯å£ä¸Šï¼ˆè‡³å°‘ç›®å‰æ˜¯è¿™æ ·ï¼‰ï¼Œweb æµè§ˆå™¨å°†é˜»æ­¢ Angular å®¢æˆ·ç«¯ä½¿ç”¨ APIã€‚è¿™ä¸ªé™åˆ¶å¯ä»¥é€šè¿‡åœ¨æœåŠ¡å™¨å“åº”ä¸­åŒ…å« CORSï¼ˆè·¨æºèµ„æºå…±äº«ï¼‰å¤´æ¥å…‹æœã€‚Spring ä½¿å¾—ä½¿ç”¨ @CrossOrigin æ³¨è§£åº”ç”¨ CORS å˜å¾—å¾ˆå®¹æ˜“ã€‚æ­£å¦‚è¿™é‡Œæ‰€åº”ç”¨çš„ï¼Œ@CrossOrigin å…è®¸æ¥è‡ªä»»ä½•åŸŸçš„å®¢æˆ·ç«¯ä½¿ç”¨ APIã€‚</p>
<p>recentTacos() æ–¹æ³•ä¸­çš„é€»è¾‘ç›¸å½“ç®€å•ã€‚å®ƒæ„é€ äº†ä¸€ä¸ª PageRequest å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æŒ‡å®šåªæƒ³è¦åŒ…å« 12 ä¸ªç»“æœçš„ç¬¬ä¸€ä¸ªï¼ˆç¬¬ 0 ä¸ªï¼‰é¡µé¢ï¼Œç»“æœæŒ‰ç…§ taco çš„åˆ›å»ºæ—¥æœŸé™åºæ’åºã€‚ç®€è€Œè¨€ä¹‹å°±æ˜¯ä½ æƒ³è¦ä¸€æ‰“æœ€æ–°è®¾è®¡çš„ tacosã€‚PageRequest è¢«ä¼ é€’åˆ° TacoRepository çš„ findAll() æ–¹æ³•çš„è°ƒç”¨ä¸­ï¼Œç»“æœé¡µé¢çš„å†…å®¹è¢«è¿”å›ç»™å®¢æˆ·æœºï¼ˆå¦‚ç¨‹åºæ¸…å• 6.1 æ‰€ç¤ºï¼Œå®ƒå°†ä½œä¸ºæ¨¡å‹æ•°æ®æ˜¾ç¤ºç»™ç”¨æˆ·ï¼‰ã€‚</p>
<p>ç°åœ¨ï¼Œå‡è®¾éœ€è¦æä¾›ä¸€ä¸ªç«¯ç‚¹ï¼Œè¯¥ç«¯ç‚¹é€šè¿‡å…¶ ID è·å–å•ä¸ª tacoã€‚é€šè¿‡åœ¨å¤„ç†ç¨‹åºæ–¹æ³•çš„è·¯å¾„ä¸­ä½¿ç”¨å ä½ç¬¦å˜é‡å¹¶æ¥å— path å˜é‡çš„æ–¹æ³•ï¼Œå¯ä»¥æ•è·è¯¥ ID å¹¶ä½¿ç”¨å®ƒé€šè¿‡å­˜å‚¨åº“æŸ¥æ‰¾ taco å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Taco <span class="title">tacoById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> </span>&#123;</span><br><span class="line">    Optional&lt;Taco&gt; optTaco = tacoRepo.findById(id);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (optTaco.isPresent()) &#123;</span><br><span class="line">        <span class="keyword">return</span> optTaco.get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ§åˆ¶å™¨æ–¹æ³•å¤„ç† <code>/design/&#123;id&#125;</code> çš„ GET è¯·æ±‚ï¼Œå…¶ä¸­è·¯å¾„çš„ <code>&#123;id&#125;</code> éƒ¨åˆ†æ˜¯å ä½ç¬¦ã€‚è¯·æ±‚ä¸­çš„å®é™…å€¼æŒ‡å®šç»™ id å‚æ•°ï¼Œè¯¥å‚æ•°é€šè¿‡ @PathVariable æ˜ å°„åˆ° <code>&#123;id&#125;</code>å ä½ç¬¦ã€‚</p>
<p>åœ¨ tacoById() å†…éƒ¨ï¼Œå°† id å‚æ•°ä¼ é€’ç»™å­˜å‚¨åº“çš„ findById() æ–¹æ³•æ¥è·å– Tacoã€‚findById() è¿”å›ä¸€ä¸ªå¯é€‰çš„ <Taco>ï¼Œå› ä¸ºå¯èƒ½æ²¡æœ‰å…·æœ‰ç»™å®š ID çš„ Tacoã€‚å¦‚æœåŒ¹é…ï¼Œåˆ™åœ¨å¯é€‰çš„ <Taco> å¯¹è±¡ä¸Šè°ƒç”¨ get() ä»¥è¿”å›å®é™…çš„ Tacoã€‚</Taco></Taco></p>
<p>å¦‚æœ ID ä¸åŒ¹é…ä»»ä½•å·²çŸ¥çš„ tacoï¼Œåˆ™è¿”å› nullï¼Œç„¶è€Œï¼Œè¿™å¹¶ä¸ç†æƒ³ã€‚é€šè¿‡è¿”å› nullï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°ä¸€ä¸ªç©ºä½“å“åº”å’Œä¸€ä¸ª HTTP çŠ¶æ€ç ä¸º 200ï¼ˆOKï¼‰çš„å“åº”ã€‚å®¢æˆ·ç«¯ä¼šæ”¶åˆ°ä¸€ä¸ªä¸èƒ½ä½¿ç”¨çš„å“åº”ï¼Œä½†æ˜¯çŠ¶æ€ä»£ç è¡¨æ˜ä¸€åˆ‡æ­£å¸¸ã€‚æ›´å¥½çš„æ–¹æ³•æ˜¯è¿”å›ä¸€ä¸ªå¸¦æœ‰ HTTP 404ï¼ˆNOT FOUNDï¼‰çŠ¶æ€çš„å“åº”ã€‚</p>
<p>æ­£å¦‚å®ƒç›®å‰æ‰€å†™çš„ï¼Œæ²¡æœ‰ç®€å•çš„æ–¹æ³•å¯ä»¥ä» tacoById() è¿”å› 404 çŠ¶æ€ä»£ç ã€‚ä½†å¦‚æœä½ åšä¸€äº›å°çš„è°ƒæ•´ï¼Œä½ å¯ä»¥è®¾ç½®é€‚å½“çš„çŠ¶æ€ä»£ç ï¼š</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/spring/" rel="tag"># spring</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/12/09/Java/basis/java-core/" rel="prev" title="java æ ¸å¿ƒæŠ€æœ¯">
      <i class="fa fa-chevron-left"></i> java æ ¸å¿ƒæŠ€æœ¯
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/12/20/js/vue-in-action/" rel="next" title="vue.js å®æˆ˜">
      vue.js å®æˆ˜ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86-Spring-%E5%9F%BA%E7%A1%80"><span class="nav-number">1.</span> <span class="nav-text">ç¬¬ä¸€éƒ¨åˆ† Spring åŸºç¡€</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-1-%E7%AB%A0-Spring-%E5%85%A5%E9%97%A8"><span class="nav-number">1.1.</span> <span class="nav-text">ç¬¬ 1 ç«  Spring å…¥é—¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-Spring%EF%BC%9F"><span class="nav-number">1.1.1.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯  Springï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96-Spring-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.1.2.</span> <span class="nav-text">åˆå§‹åŒ– Spring åº”ç”¨ç¨‹åº</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Spring-Tool-Suite-%E5%88%9D%E5%A7%8B%E5%8C%96-Spring-%E9%A1%B9%E7%9B%AE"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">ä½¿ç”¨ Spring Tool Suite åˆå§‹åŒ– Spring é¡¹ç›®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5-Spring-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">æ£€æŸ¥ Spring é¡¹ç›®ç»“æ„</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E5%86%99-Spring-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.1.3.</span> <span class="nav-text">ç¼–å†™ Spring åº”ç”¨ç¨‹åº</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%84%E7%90%86-web-%E8%AF%B7%E6%B1%82"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">å¤„ç† web è¯·æ±‚</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E8%A7%86%E5%9B%BE"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">å®šä¹‰è§†å›¾</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">1.1.3.3.</span> <span class="nav-text">æµ‹è¯•æ§åˆ¶å™¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E5%B9%B6%E8%BF%90%E8%A1%8C%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.1.3.4.</span> <span class="nav-text">æ„å»ºå¹¶è¿è¡Œåº”ç”¨ç¨‹åº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%86%E8%A7%A3-Spring-Boot-DevTools"><span class="nav-number">1.1.3.5.</span> <span class="nav-text">äº†è§£ Spring Boot DevTools</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9E%E9%A1%BE"><span class="nav-number">1.1.3.6.</span> <span class="nav-text">å›é¡¾</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AF%E7%9E%B0-Spring-%E9%A3%8E%E6%99%AF%E7%BA%BF"><span class="nav-number">1.1.4.</span> <span class="nav-text">ä¿¯ç° Spring é£æ™¯çº¿</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-%E6%A0%B8%E5%BF%83%E6%A1%86%E6%9E%B6"><span class="nav-number">1.1.4.1.</span> <span class="nav-text">Spring æ ¸å¿ƒæ¡†æ¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-Boot"><span class="nav-number">1.1.4.2.</span> <span class="nav-text">Spring Boot</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-Data"><span class="nav-number">1.1.4.3.</span> <span class="nav-text">Spring Data</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-Security"><span class="nav-number">1.1.4.4.</span> <span class="nav-text">Spring Security</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-Integration-%E5%92%8C-Spring-Batch"><span class="nav-number">1.1.4.5.</span> <span class="nav-text">Spring Integration å’Œ Spring Batch</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-Cloud"><span class="nav-number">1.1.4.6.</span> <span class="nav-text">Spring Cloud</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">1.1.5.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-2-%E7%AB%A0-%E5%BC%80%E5%8F%91-Web-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.2.</span> <span class="nav-text">ç¬¬ 2 ç«  å¼€å‘ Web åº”ç”¨ç¨‹åº</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%95%E7%A4%BA%E4%BF%A1%E6%81%AF"><span class="nav-number">1.2.1.</span> <span class="nav-text">å±•ç¤ºä¿¡æ¯</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E5%9F%9F"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">å»ºç«‹åŸŸ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E7%B1%BB"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">åˆ›å»ºæ§åˆ¶å™¨ç±»</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E8%A7%86%E5%9B%BE"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">è®¾è®¡è§†å›¾</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4"><span class="nav-number">1.2.2.</span> <span class="nav-text">å¤„ç†è¡¨å•æäº¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E8%A1%A8%E5%8D%95%E8%BE%93%E5%85%A5"><span class="nav-number">1.2.3.</span> <span class="nav-text">éªŒè¯è¡¨å•è¾“å…¥</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A3%B0%E6%98%8E%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%99"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">å£°æ˜éªŒè¯è§„åˆ™</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E8%A1%A8%E5%8D%95%E7%BB%91%E5%AE%9A%E6%97%B6%E6%89%A7%E8%A1%8C%E9%AA%8C%E8%AF%81"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">åœ¨è¡¨å•ç»‘å®šæ—¶æ‰§è¡ŒéªŒè¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%98%BE%E7%A4%BA%E9%AA%8C%E8%AF%81%E9%94%99%E8%AF%AF"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">æ˜¾ç¤ºéªŒè¯é”™è¯¯</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">1.2.4.</span> <span class="nav-text">ä½¿ç”¨è§†å›¾æ§åˆ¶å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E8%A7%86%E5%9B%BE%E6%A8%A1%E6%9D%BF%E5%BA%93"><span class="nav-number">1.2.5.</span> <span class="nav-text">é€‰æ‹©è§†å›¾æ¨¡æ¿åº“</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E6%A8%A1%E6%9D%BF"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">ç¼“å­˜æ¨¡æ¿</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-1"><span class="nav-number">1.2.6.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-3-%E7%AB%A0-%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE"><span class="nav-number">1.3.</span> <span class="nav-text">ç¬¬ 3 ç«  å¤„ç†æ•°æ®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-JDBC-%E8%AF%BB%E5%86%99%E6%95%B0%E6%8D%AE"><span class="nav-number">1.3.1.</span> <span class="nav-text">ä½¿ç”¨ JDBC è¯»å†™æ•°æ®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E5%9F%9F%E9%80%82%E9%85%8D%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">ä¸ºåŸŸé€‚é…æŒä¹…åŒ–</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-JdbcTemplate"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">ä½¿ç”¨ JdbcTemplate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%BC%8F%E5%B9%B6%E9%A2%84%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">å®šä¹‰æ¨¡å¼å¹¶é¢„åŠ è½½æ•°æ®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="nav-number">1.3.1.4.</span> <span class="nav-text">æ’å…¥æ•°æ®</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Spring-Data-JPA-%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE"><span class="nav-number">1.3.2.</span> <span class="nav-text">ä½¿ç”¨ Spring Data JPA æŒä¹…åŒ–æ•°æ®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0-Spring-Data-JPA-%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">æ·»åŠ  Spring Data JPA åˆ°æ•°æ®åº“ä¸­</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E5%9F%9F%E4%BD%9C%E4%B8%BA%E5%AE%9E%E4%BD%93"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">æ³¨è§£åŸŸä½œä¸ºå®ä½“</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A3%B0%E6%98%8E-JPA-repository"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">å£°æ˜ JPA repository</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-JPA-repository"><span class="nav-number">1.3.2.4.</span> <span class="nav-text">è‡ªå®šä¹‰ JPA repository</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-2"><span class="nav-number">1.3.3.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-4-%E7%AB%A0-Spring-%E5%AE%89%E5%85%A8"><span class="nav-number">1.4.</span> <span class="nav-text">ç¬¬ 4 ç«  Spring å®‰å…¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E7%94%A8-Spring-Security"><span class="nav-number">1.4.1.</span> <span class="nav-text">å¯ç”¨ Spring Security</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-Spring-Security"><span class="nav-number">1.4.2.</span> <span class="nav-text">é…ç½® Spring Security</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E7%94%A8%E6%88%B7%E5%AD%98%E5%82%A8"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">å†…å­˜ç”¨æˆ·å­˜å‚¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E-JDBC-%E7%9A%84%E7%94%A8%E6%88%B7%E5%AD%98%E5%82%A8"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">åŸºäº JDBC çš„ç”¨æˆ·å­˜å‚¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LDAP-%E6%94%AF%E6%8C%81%E7%9A%84%E7%94%A8%E6%88%B7%E5%AD%98%E5%82%A8"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">LDAP æ”¯æŒçš„ç”¨æˆ·å­˜å‚¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%94%A8%E6%88%B7%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="nav-number">1.4.2.4.</span> <span class="nav-text">è‡ªå®šä¹‰ç”¨æˆ·èº«ä»½éªŒè¯</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%9D%E6%8A%A4-web-%E8%AF%B7%E6%B1%82"><span class="nav-number">1.4.3.</span> <span class="nav-text">ä¿æŠ¤ web è¯·æ±‚</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%9D%E6%8A%A4%E8%AF%B7%E6%B1%82"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">ä¿æŠ¤è¯·æ±‚</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">åˆ›å»ºç”¨æˆ·ç™»å½•é¡µé¢</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%99%BB%E5%87%BA"><span class="nav-number">1.4.3.3.</span> <span class="nav-text">ç™»å‡º</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%98%BB%E6%AD%A2%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%E6%94%BB%E5%87%BB"><span class="nav-number">1.4.3.4.</span> <span class="nav-text">é˜»æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%86%E8%A7%A3%E4%BD%A0%E7%9A%84%E7%94%A8%E6%88%B7"><span class="nav-number">1.4.4.</span> <span class="nav-text">äº†è§£ä½ çš„ç”¨æˆ·</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-3"><span class="nav-number">1.4.5.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-5-%E7%AB%A0-%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7"><span class="nav-number">1.5.</span> <span class="nav-text">ç¬¬ 5 ç«  ä½¿ç”¨é…ç½®å±æ€§</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AE%E8%B0%83%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">1.5.1.</span> <span class="nav-text">å¾®è°ƒè‡ªåŠ¨é…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%90%86%E8%A7%A3-Spring-%E7%8E%AF%E5%A2%83%E6%8A%BD%E8%B1%A1"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">ç†è§£ Spring ç¯å¢ƒæŠ½è±¡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">é…ç½®æ•°æ®æº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">1.5.1.3.</span> <span class="nav-text">é…ç½®åµŒå…¥å¼æœåŠ¡å™¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%97%A5%E5%BF%97"><span class="nav-number">1.5.1.4.</span> <span class="nav-text">é…ç½®æ—¥å¿—</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%89%B9%E6%AE%8A%E7%9A%84%E5%B1%9E%E6%80%A7%E5%80%BC"><span class="nav-number">1.5.1.5.</span> <span class="nav-text">ä½¿ç”¨ç‰¹æ®Šçš„å±æ€§å€¼</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7"><span class="nav-number">1.5.2.</span> <span class="nav-text">åˆ›å»ºè‡ªå·±çš„é…ç½®å±æ€§</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E6%8C%81%E6%9C%89%E8%80%85"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">å®šä¹‰é…ç½®å±æ€§æŒæœ‰è€…</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A3%B0%E6%98%8E%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%85%83%E6%95%B0%E6%8D%AE"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">å£°æ˜é…ç½®å±æ€§å…ƒæ•°æ®</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-profile-%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE"><span class="nav-number">1.5.3.</span> <span class="nav-text">ä½¿ç”¨ profile æ–‡ä»¶è¿›è¡Œé…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E7%89%B9%E5%AE%9A-profile-%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="nav-number">1.5.3.1.</span> <span class="nav-text">å®šä¹‰ç‰¹å®š profile çš„å±æ€§</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BF%80%E6%B4%BB-profile-%E6%96%87%E4%BB%B6"><span class="nav-number">1.5.3.2.</span> <span class="nav-text">æ¿€æ´» profile æ–‡ä»¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%89%E6%9D%A1%E4%BB%B6%E5%9C%B0%E4%BD%BF%E7%94%A8-profile-%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA-bean"><span class="nav-number">1.5.3.3.</span> <span class="nav-text">æœ‰æ¡ä»¶åœ°ä½¿ç”¨ profile æ–‡ä»¶åˆ›å»º bean</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86-%E9%9B%86%E6%88%90-Spring"><span class="nav-number">2.</span> <span class="nav-text">ç¬¬äºŒéƒ¨åˆ† é›†æˆ Spring</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-6-%E7%AB%A0-%E5%88%9B%E5%BB%BA-REST-%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.1.</span> <span class="nav-text">ç¬¬ 6 ç«  åˆ›å»º REST æœåŠ¡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E5%86%99-RESTful-%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">2.1.1.</span> <span class="nav-text">ç¼–å†™ RESTful æ§åˆ¶å™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="nav-number">2.1.1.1.</span> <span class="nav-text">ä»æœåŠ¡å™¨è·å–æ•°æ®</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="CHENPENGBLOG"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">CHENPENGBLOG</p>
  <div class="site-description" itemprop="description">å…¨æ ˆæèµ·æ¥ï¼</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">97</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yourname" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yourname@gmail.com" title="E-Mail â†’ mailto:yourname@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/yourname" title="Weibo â†’ https:&#x2F;&#x2F;weibo.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/yourname" title="StackOverflow â†’ https:&#x2F;&#x2F;stackoverflow.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CHENPENGBLOG</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
