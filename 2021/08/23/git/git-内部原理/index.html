<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"chenpeng.pages.dev","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="ä»æ ¹æœ¬ä¸Šæ¥è®² Git æ˜¯ä¸€å¥—å†…å®¹å¯»å€ (content-addressable) æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨æ­¤ä¹‹ä¸Šæä¾›äº†ä¸€ä¸ª VCS ç”¨æˆ·ç•Œé¢ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="git-å†…éƒ¨åŸç†">
<meta property="og:url" content="https://chenpeng.pages.dev/2021/08/23/git/git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/index.html">
<meta property="og:site_name" content="é™ˆé¹çš„åšå®¢">
<meta property="og:description" content="ä»æ ¹æœ¬ä¸Šæ¥è®² Git æ˜¯ä¸€å¥—å†…å®¹å¯»å€ (content-addressable) æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨æ­¤ä¹‹ä¸Šæä¾›äº†ä¸€ä¸ª VCS ç”¨æˆ·ç•Œé¢ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/08/23/git/git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/18333fig0901-tn.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/08/23/git/git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/18333fig0902-tn.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/08/23/git/git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/18333fig0903-tn.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2021/08/23/git/git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/18333fig0904-tn.png">
<meta property="article:published_time" content="2021-08-22T16:10:29.000Z">
<meta property="article:modified_time" content="2022-04-14T04:23:47.237Z">
<meta property="article:author" content="CHENPENGBLOG">
<meta property="article:tag" content="git">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://chenpeng.pages.dev/2021/08/23/git/git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/18333fig0901-tn.png">

<link rel="canonical" href="https://chenpeng.pages.dev/2021/08/23/git/git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>git-å†…éƒ¨åŸç† | é™ˆé¹çš„åšå®¢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">é™ˆé¹çš„åšå®¢</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ğŸ˜‰</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://chenpeng.pages.dev/2021/08/23/git/git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CHENPENGBLOG">
      <meta itemprop="description" content="å…¨æ ˆæèµ·æ¥ï¼">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é™ˆé¹çš„åšå®¢">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          git-å†…éƒ¨åŸç†
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-08-23 00:10:29" itemprop="dateCreated datePublished" datetime="2021-08-23T00:10:29+08:00">2021-08-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-04-14 12:23:47" itemprop="dateModified" datetime="2022-04-14T12:23:47+08:00">2022-04-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>ä»æ ¹æœ¬ä¸Šæ¥è®² Git æ˜¯ä¸€å¥—å†…å®¹å¯»å€ (content-addressable) æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨æ­¤ä¹‹ä¸Šæä¾›äº†ä¸€ä¸ª VCS ç”¨æˆ·ç•Œé¢ã€‚</p>
<span id="more"></span>

<h2 id="åº•å±‚å‘½ä»¤-Plumbing-å’Œé«˜å±‚å‘½ä»¤-Porcelain"><a href="#åº•å±‚å‘½ä»¤-Plumbing-å’Œé«˜å±‚å‘½ä»¤-Porcelain" class="headerlink" title="åº•å±‚å‘½ä»¤ (Plumbing) å’Œé«˜å±‚å‘½ä»¤ (Porcelain)"></a>åº•å±‚å‘½ä»¤ (Plumbing) å’Œé«˜å±‚å‘½ä»¤ (Porcelain)</h2><p>æœ¬ä¹¦è®²è§£äº†ä½¿ç”¨ <code>checkout</code>, <code>branch</code>, <code>remote</code> ç­‰å…±çº¦ 30 ä¸ª Git å‘½ä»¤ã€‚ç„¶è€Œç”±äº Git ä¸€å¼€å§‹è¢«è®¾è®¡æˆä¾› VCS ä½¿ç”¨çš„å·¥å…·é›†è€Œä¸æ˜¯ä¸€æ•´å¥—ç”¨æˆ·å‹å¥½çš„ VCSï¼Œå®ƒè¿˜åŒ…å«äº†è®¸å¤šåº•å±‚å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤ç”¨äºä»¥ UNIX é£æ ¼ä½¿ç”¨æˆ–ç”±è„šæœ¬è°ƒç”¨ã€‚è¿™äº›å‘½ä»¤ä¸€èˆ¬è¢«ç§°ä¸º â€œplumbingâ€ å‘½ä»¤ï¼ˆåº•å±‚å‘½ä»¤ï¼‰ï¼Œå…¶ä»–çš„æ›´å‹å¥½çš„å‘½ä»¤åˆ™è¢«ç§°ä¸º â€œporcelainâ€ å‘½ä»¤ï¼ˆé«˜å±‚å‘½ä»¤ï¼‰ã€‚</p>
<p>æœ¬ä¹¦å‰å…«ç« ä¸»è¦ä¸“é—¨è®¨è®ºé«˜å±‚å‘½ä»¤ã€‚æœ¬ç« å°†ä¸»è¦è®¨è®ºåº•å±‚å‘½ä»¤ä»¥ç†è§£ Git çš„å†…éƒ¨å·¥ä½œæœºåˆ¶ã€æ¼”ç¤º Git å¦‚ä½•åŠä¸ºä½•è¦ä»¥è¿™ç§æ–¹å¼å·¥ä½œã€‚è¿™äº›å‘½ä»¤ä¸»è¦ä¸æ˜¯ç”¨æ¥ä»å‘½ä»¤è¡Œæ‰‹å·¥ä½¿ç”¨çš„ï¼Œæ›´å¤šçš„æ˜¯ç”¨æ¥ä¸ºå…¶ä»–å·¥å…·å’Œè‡ªå®šä¹‰è„šæœ¬æœåŠ¡çš„ã€‚</p>
<p>å½“ä½ åœ¨ä¸€ä¸ªæ–°ç›®å½•æˆ–å·²æœ‰ç›®å½•å†…æ‰§è¡Œ <code>git init</code> æ—¶ï¼ŒGit ä¼šåˆ›å»ºä¸€ä¸ª <code>.git</code> ç›®å½•ï¼Œå‡ ä¹æ‰€æœ‰ Git å­˜å‚¨å’Œæ“ä½œçš„å†…å®¹éƒ½ä½äºè¯¥ç›®å½•ä¸‹ã€‚å¦‚æœä½ è¦å¤‡ä»½æˆ–å¤åˆ¶ä¸€ä¸ªåº“ï¼ŒåŸºæœ¬ä¸Šå°†è¿™ä¸€ç›®å½•æ‹·è´è‡³å…¶ä»–åœ°æ–¹å°±å¯ä»¥äº†ã€‚æœ¬ç« åŸºæœ¬ä¸Šéƒ½è®¨è®ºè¯¥ç›®å½•ä¸‹çš„å†…å®¹ã€‚è¯¥ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">HEAD</span><br><span class="line">branches/</span><br><span class="line">config</span><br><span class="line">description</span><br><span class="line">hooks/</span><br><span class="line">index</span><br><span class="line">info/</span><br><span class="line">objects/</span><br><span class="line">refs/</span><br></pre></td></tr></table></figure>

<p>è¯¥ç›®å½•ä¸‹æœ‰å¯èƒ½è¿˜æœ‰å…¶ä»–æ–‡ä»¶ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„ <code>git init</code> ç”Ÿæˆçš„åº“ï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µä¸‹è¿™äº›å°±æ˜¯ä½ èƒ½çœ‹åˆ°çš„ç»“æ„ã€‚æ–°ç‰ˆæœ¬çš„ Git ä¸å†ä½¿ç”¨ <code>branches</code> ç›®å½•ï¼Œ<code>description</code> æ–‡ä»¶ä»…ä¾› GitWeb ç¨‹åºä½¿ç”¨ï¼Œæ‰€ä»¥ä¸ç”¨å…³å¿ƒè¿™äº›å†…å®¹ã€‚<code>config</code> æ–‡ä»¶åŒ…å«äº†é¡¹ç›®ç‰¹æœ‰çš„é…ç½®é€‰é¡¹ï¼Œ<code>info</code> ç›®å½•ä¿å­˜äº†ä¸€ä»½ä¸å¸Œæœ›åœ¨ <code>.gitignore</code> æ–‡ä»¶ä¸­ç®¡ç†çš„å¿½ç•¥æ¨¡å¼ (ignored patterns) çš„å…¨å±€å¯æ‰§è¡Œæ–‡ä»¶ã€‚<code>hooks</code> ç›®å½•ä¿å­˜äº†ç¬¬ä¸ƒç« è¯¦ç»†ä»‹ç»äº†çš„å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯é’©å­è„šæœ¬ã€‚</p>
<p>å¦å¤–è¿˜æœ‰å››ä¸ªé‡è¦çš„æ–‡ä»¶æˆ–ç›®å½•ï¼š<code>HEAD</code> åŠ <code>index</code> æ–‡ä»¶ï¼Œ<code>objects</code> åŠ <code>refs</code> ç›®å½•ã€‚è¿™äº›æ˜¯ Git çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚<code>objects</code> ç›®å½•å­˜å‚¨æ‰€æœ‰æ•°æ®å†…å®¹ï¼Œ<code>refs</code> ç›®å½•å­˜å‚¨æŒ‡å‘æ•°æ® (åˆ†æ”¯) çš„æäº¤å¯¹è±¡çš„æŒ‡é’ˆï¼Œ<code>HEAD</code> æ–‡ä»¶æŒ‡å‘å½“å‰åˆ†æ”¯ï¼Œ<code>index</code> æ–‡ä»¶ä¿å­˜äº†æš‚å­˜åŒºåŸŸä¿¡æ¯ã€‚é©¬ä¸Šä½ å°†è¯¦ç»†äº†è§£ Git æ˜¯å¦‚ä½•æ“çºµè¿™äº›å†…å®¹çš„ã€‚</p>
<h2 id="Git-å¯¹è±¡"><a href="#Git-å¯¹è±¡" class="headerlink" title="Git å¯¹è±¡"></a>Git å¯¹è±¡</h2><p>Git æ˜¯ä¸€å¥—å†…å®¹å¯»å€æ–‡ä»¶ç³»ç»Ÿã€‚å¾ˆä¸é”™ã€‚ä¸è¿‡è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ è¿™ç§è¯´æ³•çš„æ„æ€æ˜¯ï¼ŒGit ä»æ ¸å¿ƒä¸Šæ¥çœ‹ä¸è¿‡æ˜¯ç®€å•åœ°å­˜å‚¨é”®å€¼å¯¹ï¼ˆkey-valueï¼‰ã€‚å®ƒå…è®¸æ’å…¥ä»»æ„ç±»å‹çš„å†…å®¹ï¼Œå¹¶ä¼šè¿”å›ä¸€ä¸ªé”®å€¼ï¼Œé€šè¿‡è¯¥é”®å€¼å¯ä»¥åœ¨ä»»ä½•æ—¶å€™å†å–å‡ºè¯¥å†…å®¹ã€‚å¯ä»¥é€šè¿‡åº•å±‚å‘½ä»¤ <code>hash-object</code> æ¥ç¤ºèŒƒè¿™ç‚¹ï¼Œä¼ ä¸€äº›æ•°æ®ç»™è¯¥å‘½ä»¤ï¼Œå®ƒä¼šå°†æ•°æ®ä¿å­˜åœ¨ <code>.git</code> ç›®å½•å¹¶è¿”å›è¡¨ç¤ºè¿™äº›æ•°æ®çš„é”®å€¼ã€‚é¦–å…ˆåˆä½¿åŒ–ä¸€ä¸ª Git ä»“åº“å¹¶ç¡®è®¤ <code>objects</code> ç›®å½•æ˜¯ç©ºçš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir test</span><br><span class="line">$ cd test</span><br><span class="line">$ git init</span><br><span class="line">Initialized empty Git repository in /tmp/test/.git/</span><br><span class="line">$ find .git/objects</span><br><span class="line">.git/objects</span><br><span class="line">.git/objects/info</span><br><span class="line">.git/objects/pack</span><br><span class="line">$ find .git/objects -type f</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<p>Git åˆå§‹åŒ–äº† <code>objects</code> ç›®å½•ï¼ŒåŒæ—¶åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºäº† <code>pack</code> å’Œ <code>info</code> å­ç›®å½•ï¼Œä½†æ˜¯è¯¥ç›®å½•ä¸‹æ²¡æœ‰å…¶ä»–å¸¸è§„æ–‡ä»¶ã€‚æˆ‘ä»¬å¾€è¿™ä¸ª Git æ•°æ®åº“é‡Œå­˜å‚¨ä¸€äº›æ–‡æœ¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ echo &#x27;test content&#x27; | git hash-object -w --stdin</span><br><span class="line">d670460b4b4aece5915caf5c68d12f560a9fe3e4</span><br></pre></td></tr></table></figure>

<p>å‚æ•° <code>-w</code> æŒ‡ç¤º <code>hash-object</code> å‘½ä»¤å­˜å‚¨ (æ•°æ®) å¯¹è±¡ï¼Œè‹¥ä¸æŒ‡å®šè¿™ä¸ªå‚æ•°è¯¥å‘½ä»¤ä»…ä»…è¿”å›é”®å€¼ã€‚<code>--stdin</code> æŒ‡å®šä»æ ‡å‡†è¾“å…¥è®¾å¤‡ (stdin) æ¥è¯»å–å†…å®¹ï¼Œè‹¥ä¸æŒ‡å®šè¿™ä¸ªå‚æ•°åˆ™éœ€æŒ‡å®šä¸€ä¸ªè¦å­˜å‚¨çš„æ–‡ä»¶çš„è·¯å¾„ã€‚è¯¥å‘½ä»¤è¾“å‡ºé•¿åº¦ä¸º 40 ä¸ªå­—ç¬¦çš„æ ¡éªŒå’Œã€‚è¿™æ˜¯ä¸ª SHA-1 å“ˆå¸Œå€¼â”€â”€å…¶å€¼ä¸ºè¦å­˜å‚¨çš„æ•°æ®åŠ ä¸Šä½ é©¬ä¸Šä¼šäº†è§£åˆ°çš„ä¸€ç§å¤´ä¿¡æ¯çš„æ ¡éªŒå’Œã€‚ç°åœ¨å¯ä»¥æŸ¥çœ‹åˆ° Git å·²ç»å­˜å‚¨äº†æ•°æ®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects -type f</span><br><span class="line">.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥åœ¨ <code>objects</code> ç›®å½•ä¸‹çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™ä¾¿æ˜¯ Git å­˜å‚¨æ•°æ®å†…å®¹çš„æ–¹å¼â”€â”€ä¸ºæ¯ä»½å†…å®¹ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œå–å¾—è¯¥å†…å®¹ä¸å¤´ä¿¡æ¯çš„ SHA-1 æ ¡éªŒå’Œï¼Œåˆ›å»ºä»¥è¯¥æ ¡éªŒå’Œå‰ä¸¤ä¸ªå­—ç¬¦ä¸ºåç§°çš„å­ç›®å½•ï¼Œå¹¶ä»¥ (æ ¡éªŒå’Œ) å‰©ä¸‹ 38 ä¸ªå­—ç¬¦ä¸ºæ–‡ä»¶å‘½å (ä¿å­˜è‡³å­ç›®å½•ä¸‹)ã€‚</p>
<p>é€šè¿‡ <code>cat-file</code> å‘½ä»¤å¯ä»¥å°†æ•°æ®å†…å®¹å–å›ã€‚è¯¥å‘½ä»¤æ˜¯æŸ¥çœ‹ Git å¯¹è±¡çš„ç‘å£«å†›åˆ€ã€‚ä¼ å…¥ <code>-p</code> å‚æ•°å¯ä»¥è®©è¯¥å‘½ä»¤è¾“å‡ºæ•°æ®å†…å®¹çš„ç±»å‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p d670460b4b4aece5915caf5c68d12f560a9fe3e4</span><br><span class="line">test content</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å¾€ Git ä¸­æ·»åŠ æ›´å¤šå†…å®¹å¹¶å–å›äº†ã€‚ä¹Ÿå¯ä»¥ç›´æ¥æ·»åŠ æ–‡ä»¶ã€‚æ¯”æ–¹è¯´å¯ä»¥å¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œç®€å•çš„ç‰ˆæœ¬æ§åˆ¶ã€‚é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå¹¶æŠŠæ–‡ä»¶å†…å®¹å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ echo &#x27;version 1&#x27; &gt; test.txt</span><br><span class="line">$ git hash-object -w test.txt</span><br><span class="line">83baae61804e65cc73a7201a7252750c76066a30</span><br></pre></td></tr></table></figure>

<p>æ¥ç€å¾€è¯¥æ–‡ä»¶ä¸­å†™å…¥ä¸€äº›æ–°å†…å®¹å¹¶å†æ¬¡ä¿å­˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ echo &#x27;version 2&#x27; &gt; test.txt</span><br><span class="line">$ git hash-object -w test.txt</span><br><span class="line">1f7a7a472abf3dd9643fd615f6da379c4acb3e3a</span><br></pre></td></tr></table></figure>

<p>æ•°æ®åº“ä¸­å·²ç»å°†æ–‡ä»¶çš„ä¸¤ä¸ªæ–°ç‰ˆæœ¬è¿åŒä¸€å¼€å§‹çš„å†…å®¹ä¿å­˜ä¸‹æ¥äº†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects -type f</span><br><span class="line">.git/objects/1f/7a7a472abf3dd9643fd615f6da379c4acb3e3a</span><br><span class="line">.git/objects/83/baae61804e65cc73a7201a7252750c76066a30</span><br><span class="line">.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4</span><br></pre></td></tr></table></figure>

<p>å†å°†æ–‡ä»¶æ¢å¤åˆ°ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 83baae61804e65cc73a7201a7252750c76066a30 &gt; test.txt</span><br><span class="line">$ cat test.txt</span><br><span class="line">version 1</span><br></pre></td></tr></table></figure>

<p>æˆ–æ¢å¤åˆ°ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a &gt; test.txt</span><br><span class="line">$ cat test.txt</span><br><span class="line">version 2</span><br></pre></td></tr></table></figure>

<p>éœ€è¦è®°ä½çš„æ˜¯å‡ ä¸ªç‰ˆæœ¬çš„æ–‡ä»¶ SHA-1 å€¼å¯èƒ½ä¸å®é™…çš„å€¼ä¸åŒï¼Œå…¶æ¬¡ï¼Œå­˜å‚¨çš„å¹¶ä¸æ˜¯æ–‡ä»¶åè€Œä»…ä»…æ˜¯æ–‡ä»¶å†…å®¹ã€‚è¿™ç§å¯¹è±¡ç±»å‹ç§°ä¸º blob ã€‚é€šè¿‡ä¼ é€’ SHA-1 å€¼ç»™ <code>cat-file -t</code> å‘½ä»¤å¯ä»¥è®© Git è¿”å›ä»»ä½•å¯¹è±¡çš„ç±»å‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -t 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a</span><br><span class="line">blob</span><br></pre></td></tr></table></figure>

<h3 id="tree-æ ‘-å¯¹è±¡"><a href="#tree-æ ‘-å¯¹è±¡" class="headerlink" title="tree (æ ‘) å¯¹è±¡"></a>tree (æ ‘) å¯¹è±¡</h3><p>æ¥ä¸‹å»æ¥çœ‹ tree å¯¹è±¡ï¼Œtree å¯¹è±¡å¯ä»¥å­˜å‚¨æ–‡ä»¶åï¼ŒåŒæ—¶ä¹Ÿå…è®¸å­˜å‚¨ä¸€ç»„æ–‡ä»¶ã€‚Git ä»¥ä¸€ç§ç±»ä¼¼ UNIX æ–‡ä»¶ç³»ç»Ÿä½†æ›´ç®€å•çš„æ–¹å¼æ¥å­˜å‚¨å†…å®¹ã€‚æ‰€æœ‰å†…å®¹ä»¥ tree æˆ– blob å¯¹è±¡å­˜å‚¨ï¼Œå…¶ä¸­ tree å¯¹è±¡å¯¹åº”äº UNIX ä¸­çš„ç›®å½•ï¼Œblob å¯¹è±¡åˆ™å¤§è‡´å¯¹åº”äº inodes æˆ–æ–‡ä»¶å†…å®¹ã€‚ä¸€ä¸ªå•ç‹¬çš„ tree å¯¹è±¡åŒ…å«ä¸€æ¡æˆ–å¤šæ¡ tree è®°å½•ï¼Œæ¯ä¸€æ¡è®°å½•å«æœ‰ä¸€ä¸ªæŒ‡å‘ blob æˆ–å­ tree å¯¹è±¡çš„ SHA-1 æŒ‡é’ˆï¼Œå¹¶é™„æœ‰è¯¥å¯¹è±¡çš„æƒé™æ¨¡å¼ (mode)ã€ç±»å‹å’Œæ–‡ä»¶åä¿¡æ¯ã€‚ä»¥ simplegit é¡¹ç›®ä¸ºä¾‹ï¼Œæœ€æ–°çš„ tree å¯èƒ½æ˜¯è¿™ä¸ªæ ·å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p master^&#123;tree&#125;</span><br><span class="line">100644 blob a906cb2a4a904a152e80877d4088654daad0c859      README</span><br><span class="line">100644 blob 8f94139338f9404f26296befa88755fc2598c289      Rakefile</span><br><span class="line">040000 tree 99f1a6d12cb4b6f19c8655fca46c3ecf317074e0      lib</span><br></pre></td></tr></table></figure>

<p><code>master^&#123;tree&#125;</code> è¡¨ç¤º <code>master</code> åˆ†æ”¯ä¸Šæœ€æ–°æäº¤æŒ‡å‘çš„ tree å¯¹è±¡ã€‚è¯·æ³¨æ„ <code>lib</code> å­ç›®å½•å¹¶éä¸€ä¸ª blob å¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ä¸ªæŒ‡å‘å¦ä¸€ä¸ª tree å¯¹è±¡çš„æŒ‡é’ˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 99f1a6d12cb4b6f19c8655fca46c3ecf317074e0</span><br><span class="line">100644 blob 47c6340d6459e05787f644c2447d2595f5d3a54b      simplegit.rb</span><br></pre></td></tr></table></figure>

<p>ä»æ¦‚å¿µä¸Šæ¥è®²ï¼ŒGit ä¿å­˜çš„æ•°æ®å¦‚å›¾ 9-1 æ‰€ç¤ºã€‚</p>
<p><img src="/2021/08/23/git/git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/18333fig0901-tn.png" alt="img"><br>å›¾ 9-1. Git å¯¹è±¡æ¨¡å‹çš„ç®€åŒ–ç‰ˆ</p>
<p>ä½ å¯ä»¥è‡ªå·±åˆ›å»º tree ã€‚é€šå¸¸ Git æ ¹æ®ä½ çš„æš‚å­˜åŒºåŸŸæˆ– index æ¥åˆ›å»ºå¹¶å†™å…¥ä¸€ä¸ª tree ã€‚å› æ­¤è¦åˆ›å»ºä¸€ä¸ª tree å¯¹è±¡çš„è¯é¦–å…ˆè¦é€šè¿‡å°†ä¸€äº›æ–‡ä»¶æš‚å­˜ä»è€Œåˆ›å»ºä¸€ä¸ª index ã€‚å¯ä»¥ä½¿ç”¨ plumbing å‘½ä»¤ <code>update-index</code> ä¸ºä¸€ä¸ªå•ç‹¬æ–‡ä»¶ â”€â”€ test.txt æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ â”€â”€ã€€åˆ›å»ºä¸€ä¸ª indexã€€ã€‚é€šè¿‡è¯¥å‘½ä»¤äººä¸ºçš„å°† test.txt æ–‡ä»¶çš„é¦–ä¸ªç‰ˆæœ¬åŠ å…¥åˆ°äº†ä¸€ä¸ªæ–°çš„æš‚å­˜åŒºåŸŸä¸­ã€‚ç”±äºè¯¥æ–‡ä»¶åŸå…ˆå¹¶ä¸åœ¨æš‚å­˜åŒºåŸŸä¸­ (ç”šè‡³å°±è¿æš‚å­˜åŒºåŸŸä¹Ÿè¿˜æ²¡è¢«åˆ›å»ºå‡ºæ¥å‘¢) ï¼Œå¿…é¡»ä¼ å…¥ <code>--add</code> å‚æ•°;ç”±äºè¦æ·»åŠ çš„æ–‡ä»¶å¹¶ä¸åœ¨å½“å‰ç›®å½•ä¸‹è€Œæ˜¯åœ¨æ•°æ®åº“ä¸­ï¼Œå¿…é¡»ä¼ å…¥ <code>--cacheinfo</code> å‚æ•°ã€‚åŒæ—¶æŒ‡å®šäº†æ–‡ä»¶æ¨¡å¼ï¼ŒSHA-1 å€¼å’Œæ–‡ä»¶åï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git update-index --add --cacheinfo 100644 \</span><br><span class="line">  83baae61804e65cc73a7201a7252750c76066a30 test.txt</span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼ŒæŒ‡å®šäº†æ–‡ä»¶æ¨¡å¼ä¸º <code>100644</code>ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ã€‚å…¶ä»–å¯ç”¨çš„æ¨¡å¼æœ‰ï¼š<code>100755</code> è¡¨ç¤ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œ<code>120000</code> è¡¨ç¤ºç¬¦å·é“¾æ¥ã€‚æ–‡ä»¶æ¨¡å¼æ˜¯ä»å¸¸è§„çš„ UNIX æ–‡ä»¶æ¨¡å¼ä¸­å‚è€ƒæ¥çš„ï¼Œä½†æ˜¯æ²¡æœ‰é‚£ä¹ˆçµæ´» â”€â”€ ä¸Šè¿°ä¸‰ç§æ¨¡å¼ä»…å¯¹ Git ä¸­çš„æ–‡ä»¶ (blobs) æœ‰æ•ˆ (è™½ç„¶ä¹Ÿæœ‰å…¶ä»–æ¨¡å¼ç”¨äºç›®å½•å’Œå­æ¨¡å—)ã€‚</p>
<p>ç°åœ¨å¯ä»¥ç”¨ <code>write-tree</code> å‘½ä»¤å°†æš‚å­˜åŒºåŸŸçš„å†…å®¹å†™åˆ°ä¸€ä¸ª tree å¯¹è±¡äº†ã€‚æ— éœ€ <code>-w</code> å‚æ•° â”€â”€ å¦‚æœç›®æ ‡ tree ä¸å­˜åœ¨ï¼Œè°ƒç”¨ <code>write-tree</code> ä¼šè‡ªåŠ¨æ ¹æ® index çŠ¶æ€åˆ›å»ºä¸€ä¸ª tree å¯¹è±¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git write-tree</span><br><span class="line">d8329fc1cc938780ffdd9f94e0d364e0ea74f579</span><br><span class="line">$ git cat-file -p d8329fc1cc938780ffdd9f94e0d364e0ea74f579</span><br><span class="line">100644 blob 83baae61804e65cc73a7201a7252750c76066a30      test.txt</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è¿™æ ·éªŒè¯è¿™ç¡®å®æ˜¯ä¸€ä¸ª tree å¯¹è±¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -t d8329fc1cc938780ffdd9f94e0d364e0ea74f579</span><br><span class="line">tree</span><br></pre></td></tr></table></figure>

<p>å†æ ¹æ® test.txt çš„ç¬¬äºŒä¸ªç‰ˆæœ¬ä»¥åŠä¸€ä¸ªæ–°æ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ–° tree å¯¹è±¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ echo &#x27;new file&#x27; &gt; new.txt</span><br><span class="line">$ git update-index test.txt</span><br><span class="line">$ git update-index --add new.txt</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶æš‚å­˜åŒºåŸŸä¸­åŒ…å«äº† test.txt çš„æ–°ç‰ˆæœ¬åŠä¸€ä¸ªæ–°æ–‡ä»¶ new.txt ã€‚åˆ›å»º (å†™) è¯¥ tree å¯¹è±¡ (å°†æš‚å­˜åŒºåŸŸæˆ– index çŠ¶æ€å†™å…¥åˆ°ä¸€ä¸ª tree å¯¹è±¡)ï¼Œç„¶åç§ç§å®ƒçš„æ ·å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git write-tree</span><br><span class="line">0155eb4229851634a0f03eb265b69f5a2d56f341</span><br><span class="line">$ git cat-file -p 0155eb4229851634a0f03eb265b69f5a2d56f341</span><br><span class="line">100644 blob fa49b077972391ad58037050f2a75f74e3671e92      new.txt</span><br><span class="line">100644 blob 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a      test.txt</span><br></pre></td></tr></table></figure>

<p>è¯·æ³¨æ„è¯¥ tree å¯¹è±¡åŒ…å«äº†ä¸¤ä¸ªæ–‡ä»¶è®°å½•ï¼Œä¸” test.txt çš„ SHA å€¼æ˜¯æ—©å…ˆå€¼çš„ â€œç¬¬äºŒç‰ˆâ€ (<code>1f7a7a</code>)ã€‚æ¥ç‚¹æ›´æœ‰è¶£çš„ï¼Œä½ å°†æŠŠç¬¬ä¸€ä¸ª tree å¯¹è±¡ä½œä¸ºä¸€ä¸ªå­ç›®å½•åŠ è¿›è¯¥ tree ä¸­ã€‚å¯ä»¥ç”¨ <code>read-tree</code> å‘½ä»¤å°† tree å¯¹è±¡è¯»åˆ°æš‚å­˜åŒºåŸŸä¸­å»ã€‚åœ¨è¿™æ—¶ï¼Œé€šè¿‡ä¼ ä¸€ä¸ª <code>--prefix</code> å‚æ•°ç»™ <code>read-tree</code>ï¼Œå°†ä¸€ä¸ªå·²æœ‰çš„ tree å¯¹è±¡ä½œä¸ºä¸€ä¸ªå­ tree è¯»åˆ°æš‚å­˜åŒºåŸŸä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git read-tree --prefix=bak d8329fc1cc938780ffdd9f94e0d364e0ea74f579</span><br><span class="line">$ git write-tree</span><br><span class="line">3c4e9cd789d88d8d89c1073707c3585e41b0e614</span><br><span class="line">$ git cat-file -p 3c4e9cd789d88d8d89c1073707c3585e41b0e614</span><br><span class="line">040000 tree d8329fc1cc938780ffdd9f94e0d364e0ea74f579      bak</span><br><span class="line">100644 blob fa49b077972391ad58037050f2a75f74e3671e92      new.txt</span><br><span class="line">100644 blob 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a      test.txt</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä»åˆšå†™å…¥çš„æ–° tree å¯¹è±¡åˆ›å»ºä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œå°†å¾—åˆ°ä½äºå·¥ä½œç›®å½•é¡¶çº§çš„ä¸¤ä¸ªæ–‡ä»¶å’Œä¸€ä¸ªåä¸º <code>bak</code> çš„å­ç›®å½•ï¼Œè¯¥å­ç›®å½•åŒ…å«äº† test.txt æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ã€‚å¯ä»¥å°† Git ç”¨æ¥åŒ…å«è¿™äº›å†…å®¹çš„æ•°æ®æƒ³è±¡æˆå¦‚å›¾ 9-2 æ‰€ç¤ºçš„æ ·å­ã€‚</p>
<p><img src="/2021/08/23/git/git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/18333fig0902-tn.png" alt="img"><br>å›¾ 9-2. å½“å‰ Git æ•°æ®çš„å†…å®¹ç»“æ„</p>
<h3 id="commit-æäº¤-å¯¹è±¡"><a href="#commit-æäº¤-å¯¹è±¡" class="headerlink" title="commit (æäº¤) å¯¹è±¡"></a>commit (æäº¤) å¯¹è±¡</h3><p>ä½ ç°åœ¨æœ‰ä¸‰ä¸ª tree å¯¹è±¡ï¼Œå®ƒä»¬æŒ‡å‘äº†ä½ è¦è·Ÿè¸ªçš„é¡¹ç›®çš„ä¸åŒå¿«ç…§ï¼Œå¯æ˜¯å…ˆå‰çš„é—®é¢˜ä¾ç„¶å­˜åœ¨ï¼šå¿…é¡»è®°å¾€ä¸‰ä¸ª SHA-1 å€¼ä»¥è·å¾—è¿™äº›å¿«ç…§ã€‚ä½ ä¹Ÿæ²¡æœ‰å…³äºè°ã€ä½•æ—¶ä»¥åŠä¸ºä½•ä¿å­˜äº†è¿™äº›å¿«ç…§çš„ä¿¡æ¯ã€‚commit å¯¹è±¡ä¸ºä½ ä¿å­˜äº†è¿™äº›åŸºæœ¬ä¿¡æ¯ã€‚</p>
<p>è¦åˆ›å»ºä¸€ä¸ª commit å¯¹è±¡ï¼Œä½¿ç”¨ <code>commit-tree</code> å‘½ä»¤ï¼ŒæŒ‡å®šä¸€ä¸ª tree çš„ SHA-1ï¼Œå¦‚æœæœ‰ä»»ä½•å‰ç»§æäº¤å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šã€‚ä»ä½ å†™çš„ç¬¬ä¸€ä¸ª tree å¼€å§‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ echo &#x27;first commit&#x27; | git commit-tree d8329f</span><br><span class="line">fdf4fc3344e67ab068f836878b6c4951e3b15f3d</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ <code>cat-file</code> æŸ¥çœ‹è¿™ä¸ªæ–° commit å¯¹è±¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p fdf4fc3</span><br><span class="line">tree d8329fc1cc938780ffdd9f94e0d364e0ea74f579</span><br><span class="line">author Scott Chacon &lt;schacon@gmail.com&gt; 1243040974 -0700</span><br><span class="line">committer Scott Chacon &lt;schacon@gmail.com&gt; 1243040974 -0700</span><br><span class="line"></span><br><span class="line">first commit</span><br></pre></td></tr></table></figure>

<p>commit å¯¹è±¡æœ‰æ ¼å¼å¾ˆç®€å•ï¼šæŒ‡æ˜äº†è¯¥æ—¶é—´ç‚¹é¡¹ç›®å¿«ç…§çš„é¡¶å±‚æ ‘å¯¹è±¡ã€ä½œè€…/æäº¤è€…ä¿¡æ¯ï¼ˆä» Git è®¾ç½®çš„ <code>user.name</code> å’Œ <code>user.email</code>ä¸­è·å¾—)ä»¥åŠå½“å‰æ—¶é—´æˆ³ã€ä¸€ä¸ªç©ºè¡Œï¼Œä»¥åŠæäº¤æ³¨é‡Šä¿¡æ¯ã€‚</p>
<p>æ¥ç€å†å†™å…¥å¦å¤–ä¸¤ä¸ª commit å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªéƒ½æŒ‡å®šå…¶ä¹‹å‰çš„é‚£ä¸ª commit å¯¹è±¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ echo &#x27;second commit&#x27; | git commit-tree 0155eb -p fdf4fc3</span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d</span><br><span class="line">$ echo &#x27;third commit&#x27;  | git commit-tree 3c4e9c -p cac0cab</span><br><span class="line">1a410efbd13591db07496601ebc7a059dd55cfe9</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸€ä¸ª commit å¯¹è±¡éƒ½æŒ‡å‘äº†ä½ åˆ›å»ºçš„æ ‘å¯¹è±¡å¿«ç…§ã€‚å‡ºä¹æ„æ–™çš„æ˜¯ï¼Œç°åœ¨å·²ç»æœ‰äº†çœŸå®çš„ Git å†å²äº†ï¼Œæ‰€ä»¥å¦‚æœè¿è¡Œ <code>git log</code> å‘½ä»¤å¹¶æŒ‡å®šæœ€åé‚£ä¸ª commit å¯¹è±¡çš„ SHA-1 ä¾¿å¯ä»¥æŸ¥çœ‹å†å²ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ git log --stat 1a410e</span><br><span class="line">commit 1a410efbd13591db07496601ebc7a059dd55cfe9</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Fri May 22 18:15:24 2009 -0700</span><br><span class="line"></span><br><span class="line">    third commit</span><br><span class="line"></span><br><span class="line"> bak/test.txt |    1 +</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br><span class="line"></span><br><span class="line">commit cac0cab538b970a37ea1e769cbbde608743bc96d</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Fri May 22 18:14:29 2009 -0700</span><br><span class="line"></span><br><span class="line">    second commit</span><br><span class="line"></span><br><span class="line"> new.txt  |    1 +</span><br><span class="line"> test.txt |    2 +-</span><br><span class="line"> 2 files changed, 2 insertions(+), 1 deletions(-)</span><br><span class="line"></span><br><span class="line">commit fdf4fc3344e67ab068f836878b6c4951e3b15f3d</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Fri May 22 18:09:34 2009 -0700</span><br><span class="line"></span><br><span class="line">    first commit</span><br><span class="line"></span><br><span class="line"> test.txt |    1 +</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br></pre></td></tr></table></figure>

<p>çœŸæ£’ã€‚ä½ åˆšåˆšé€šè¿‡ä½¿ç”¨ä½çº§æ“ä½œè€Œä¸æ˜¯é‚£äº›æ™®é€šå‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ª Git å†å²ã€‚è¿™åŸºæœ¬ä¸Šå°±æ˜¯è¿è¡Œã€€<code>git add</code> å’Œ <code>git commit</code> å‘½ä»¤æ—¶ Git è¿›è¡Œçš„å·¥ä½œã€€â”€â”€ä¿å­˜ä¿®æ”¹äº†çš„æ–‡ä»¶çš„ blobï¼Œæ›´æ–°ç´¢å¼•ï¼Œåˆ›å»º tree å¯¹è±¡ï¼Œæœ€ååˆ›å»º commit å¯¹è±¡ï¼Œè¿™äº› commit å¯¹è±¡æŒ‡å‘äº†é¡¶å±‚ tree å¯¹è±¡ä»¥åŠå…ˆå‰çš„ commit å¯¹è±¡ã€‚è¿™ä¸‰ç±» Git å¯¹è±¡ â”€â”€ blobï¼Œtree ä»¥åŠ commit â”€â”€ éƒ½å„è‡ªä»¥æ–‡ä»¶çš„æ–¹å¼ä¿å­˜åœ¨ <code>.git/objects</code> ç›®å½•ä¸‹ã€‚ä»¥ä¸‹æ‰€åˆ—æ˜¯ç›®å‰ä¸ºæ­¢æ ·ä¾‹ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡åé¢çš„æ³¨é‡Šé‡Œæ ‡æ˜äº†å®ƒä»¬ä¿å­˜çš„å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects -type f</span><br><span class="line">.git/objects/01/55eb4229851634a0f03eb265b69f5a2d56f341 # tree 2</span><br><span class="line">.git/objects/1a/410efbd13591db07496601ebc7a059dd55cfe9 # commit 3</span><br><span class="line">.git/objects/1f/7a7a472abf3dd9643fd615f6da379c4acb3e3a # test.txt v2</span><br><span class="line">.git/objects/3c/4e9cd789d88d8d89c1073707c3585e41b0e614 # tree 3</span><br><span class="line">.git/objects/83/baae61804e65cc73a7201a7252750c76066a30 # test.txt v1</span><br><span class="line">.git/objects/ca/c0cab538b970a37ea1e769cbbde608743bc96d # commit 2</span><br><span class="line">.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4 # &#x27;test content&#x27;</span><br><span class="line">.git/objects/d8/329fc1cc938780ffdd9f94e0d364e0ea74f579 # tree 1</span><br><span class="line">.git/objects/fa/49b077972391ad58037050f2a75f74e3671e92 # new.txt</span><br><span class="line">.git/objects/fd/f4fc3344e67ab068f836878b6c4951e3b15f3d # commit 1</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æŒ‰ç…§ä»¥ä¸Šæè¿°è¿›è¡Œäº†æ“ä½œï¼Œå¯ä»¥å¾—åˆ°å¦‚å›¾ 9-3 æ‰€ç¤ºçš„å¯¹è±¡å›¾ã€‚</p>
<p><img src="/2021/08/23/git/git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/18333fig0903-tn.png" alt="img"><br>å›¾ 9-3. Git ç›®å½•ä¸‹çš„æ‰€æœ‰å¯¹è±¡</p>
<h3 id="å¯¹è±¡å­˜å‚¨"><a href="#å¯¹è±¡å­˜å‚¨" class="headerlink" title="å¯¹è±¡å­˜å‚¨"></a>å¯¹è±¡å­˜å‚¨</h3><p>ä¹‹å‰æˆ‘æåˆ°å½“å­˜å‚¨æ•°æ®å†…å®¹æ—¶ï¼ŒåŒæ—¶ä¼šæœ‰ä¸€ä¸ªæ–‡ä»¶å¤´è¢«å­˜å‚¨èµ·æ¥ã€‚æˆ‘ä»¬èŠ±äº›æ—¶é—´æ¥çœ‹çœ‹ Git æ˜¯å¦‚ä½•å­˜å‚¨å¯¹è±¡çš„ã€‚ä½ å°†çœ‹æ¥å¦‚ä½•é€šè¿‡ Ruby è„šæœ¬è¯­è¨€å­˜å‚¨ä¸€ä¸ª blob å¯¹è±¡ (è¿™é‡Œä»¥å­—ç¬¦ä¸² â€œwhat is up, doc?â€ ä¸ºä¾‹) ã€‚ä½¿ç”¨ <code>irb</code> å‘½ä»¤è¿›å…¥ Ruby äº¤äº’å¼æ¨¡å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ irb</span><br><span class="line">&gt;&gt; content = &quot;what is up, doc?&quot;</span><br><span class="line">=&gt; &quot;what is up, doc?&quot;</span><br></pre></td></tr></table></figure>

<p>Git ä»¥å¯¹è±¡ç±»å‹ä¸ºèµ·å§‹å†…å®¹æ„é€ ä¸€ä¸ªæ–‡ä»¶å¤´ï¼Œæœ¬ä¾‹ä¸­æ˜¯ä¸€ä¸ª blobã€‚ç„¶åæ·»åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œæ¥ç€æ˜¯æ•°æ®å†…å®¹çš„é•¿åº¦ï¼Œæœ€åæ˜¯ä¸€ä¸ªç©ºå­—èŠ‚ (null byte)ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; header = &quot;blob #&#123;content.length&#125;\0&quot;</span><br><span class="line">=&gt; &quot;blob 16\000&quot;</span><br></pre></td></tr></table></figure>

<p>Git å°†æ–‡ä»¶å¤´ä¸åŸå§‹æ•°æ®å†…å®¹æ‹¼æ¥èµ·æ¥ï¼Œå¹¶è®¡ç®—æ‹¼æ¥åçš„æ–°å†…å®¹çš„ SHA-1 æ ¡éªŒå’Œã€‚å¯ä»¥åœ¨ Ruby ä¸­ä½¿ç”¨ <code>require</code> è¯­å¥å¯¼å…¥ SHA1 digest åº“ï¼Œç„¶åè°ƒç”¨ <code>Digest::SHA1.hexdigest()</code> æ–¹æ³•è®¡ç®—å­—ç¬¦ä¸²çš„ SHA-1 å€¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; store = header + content</span><br><span class="line">=&gt; &quot;blob 16\000what is up, doc?&quot;</span><br><span class="line">&gt;&gt; require &#x27;digest/sha1&#x27;</span><br><span class="line">=&gt; true</span><br><span class="line">&gt;&gt; sha1 = Digest::SHA1.hexdigest(store)</span><br><span class="line">=&gt; &quot;bd9dbf5aae1a3862dd1526723246b20206e5fc37&quot;</span><br></pre></td></tr></table></figure>

<p>Git ç”¨ zlib å¯¹æ•°æ®å†…å®¹è¿›è¡Œå‹ç¼©ï¼Œåœ¨ Ruby ä¸­å¯ä»¥ç”¨ zlib åº“æ¥å®ç°ã€‚é¦–å…ˆéœ€è¦å¯¼å…¥è¯¥åº“ï¼Œç„¶åç”¨ <code>Zlib::Deflate.deflate()</code> å¯¹æ•°æ®è¿›è¡Œå‹ç¼©ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; require &#x27;zlib&#x27;</span><br><span class="line">=&gt; true</span><br><span class="line">&gt;&gt; zlib_content = Zlib::Deflate.deflate(store)</span><br><span class="line">=&gt; &quot;x\234K\312\311OR04c(\317H,Q\310,V(-\320QH\311O\266\a\000_\034\a\235&quot;</span><br></pre></td></tr></table></figure>

<p>æœ€åå°†ç”¨ zlib å‹ç¼©åçš„å†…å®¹å†™å…¥ç£ç›˜ã€‚éœ€è¦æŒ‡å®šä¿å­˜å¯¹è±¡çš„è·¯å¾„ (SHA-1 å€¼çš„å¤´ä¸¤ä¸ªå­—ç¬¦ä½œä¸ºå­ç›®å½•åç§°ï¼Œå‰©ä½™ 38 ä¸ªå­—ç¬¦ä½œä¸ºæ–‡ä»¶åä¿å­˜è‡³è¯¥å­ç›®å½•ä¸­)ã€‚åœ¨ Ruby ä¸­ï¼Œå¦‚æœå­ç›®å½•ä¸å­˜åœ¨å¯ä»¥ç”¨ <code>FileUtils.mkdir_p()</code> å‡½æ•°åˆ›å»ºå®ƒã€‚æ¥ç€ç”¨ <code>File.open</code> æ–¹æ³•æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ç”¨ <code>write()</code> æ–¹æ³•å°†ä¹‹å‰å‹ç¼©çš„å†…å®¹å†™å…¥è¯¥æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; path = &#x27;.git/objects/&#x27; + sha1[0,2] + &#x27;/&#x27; + sha1[2,38]</span><br><span class="line">=&gt; &quot;.git/objects/bd/9dbf5aae1a3862dd1526723246b20206e5fc37&quot;</span><br><span class="line">&gt;&gt; require &#x27;fileutils&#x27;</span><br><span class="line">=&gt; true</span><br><span class="line">&gt;&gt; FileUtils.mkdir_p(File.dirname(path))</span><br><span class="line">=&gt; &quot;.git/objects/bd&quot;</span><br><span class="line">&gt;&gt; File.open(path, &#x27;w&#x27;) &#123; |f| f.write zlib_content &#125;</span><br><span class="line">=&gt; 32</span><br></pre></td></tr></table></figure>

<p>è¿™å°±è¡Œäº† â”€â”€ ä½ å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ­£ç¡®çš„ blob å¯¹è±¡ã€‚æ‰€æœ‰çš„ Git å¯¹è±¡éƒ½ä»¥è¿™ç§æ–¹å¼å­˜å‚¨ï¼ŒæƒŸä¸€çš„åŒºåˆ«æ˜¯ç±»å‹ä¸åŒ â”€â”€ é™¤äº†å­—ç¬¦ä¸² blobï¼Œæ–‡ä»¶å¤´èµ·å§‹å†…å®¹è¿˜å¯ä»¥æ˜¯ commit æˆ– tree ã€‚ä¸è¿‡è™½ç„¶ blob å‡ ä¹å¯ä»¥æ˜¯ä»»æ„å†…å®¹ï¼Œcommit å’Œ tree çš„æ•°æ®å´æ˜¯æœ‰å›ºå®šæ ¼å¼çš„ã€‚</p>
<h2 id="Git-References"><a href="#Git-References" class="headerlink" title="Git References"></a>Git References</h2><p>ä½ å¯ä»¥æ‰§è¡Œåƒ <code>git log 1a410e</code> è¿™æ ·çš„å‘½ä»¤æ¥æŸ¥çœ‹å®Œæ•´çš„å†å²ï¼Œä½†æ˜¯è¿™æ ·ä½ å°±è¦è®°å¾— <code>1a410e</code> æ˜¯ä½ æœ€åä¸€æ¬¡æäº¤ï¼Œè¿™æ ·æ‰èƒ½åœ¨æäº¤å†å²ä¸­æ‰¾åˆ°è¿™äº›å¯¹è±¡ã€‚ä½ éœ€è¦ä¸€ä¸ªæ–‡ä»¶æ¥ç”¨ä¸€ä¸ªç®€å•çš„åå­—æ¥è®°å½•è¿™äº› SHA-1 å€¼ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ç”¨è¿™äº›æŒ‡é’ˆè€Œä¸æ˜¯åŸæ¥çš„ SHA-1 å€¼å»æ£€ç´¢äº†ã€‚</p>
<p>åœ¨ Git ä¸­ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œå¼•ç”¨â€ï¼ˆreferences æˆ–è€… refsï¼Œè¯‘è€…æ³¨ï¼‰ã€‚ä½ å¯ä»¥åœ¨ <code>.git/refs</code> ç›®å½•ä¸‹é¢æ‰¾åˆ°è¿™äº›åŒ…å« SHA-1 å€¼çš„æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªé¡¹ç›®é‡Œï¼Œè¿™ä¸ªç›®å½•è¿˜æ²¡ä¸åŒ…å«ä»»ä½•æ–‡ä»¶ï¼Œä½†æ˜¯åŒ…å«è¿™æ ·ä¸€ä¸ªç®€å•çš„ç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/refs</span><br><span class="line">.git/refs</span><br><span class="line">.git/refs/heads</span><br><span class="line">.git/refs/tags</span><br><span class="line">$ find .git/refs -type f</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¼•ç”¨å¸®åŠ©ä½ è®°ä½æœ€åä¸€æ¬¡æäº¤ï¼ŒæŠ€æœ¯ä¸Šä½ å¯ä»¥è¿™æ ·åšï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ echo &quot;1a410efbd13591db07496601ebc7a059dd55cfe9&quot; &gt; .git/refs/heads/master</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œä½ å°±å¯ä»¥åœ¨ Git å‘½ä»¤ä¸­ä½¿ç”¨ä½ åˆšæ‰åˆ›å»ºçš„å¼•ç”¨è€Œä¸æ˜¯ SHA-1 å€¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git log --pretty=oneline  master</span><br><span class="line">1a410efbd13591db07496601ebc7a059dd55cfe9 third commit</span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d second commit</span><br><span class="line">fdf4fc3344e67ab068f836878b6c4951e3b15f3d first commit</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œæˆ‘ä»¬å¹¶ä¸é¼“åŠ±ä½ ç›´æ¥ä¿®æ”¹è¿™äº›å¼•ç”¨æ–‡ä»¶ã€‚å¦‚æœä½ ç¡®å®éœ€è¦æ›´æ–°ä¸€ä¸ªå¼•ç”¨ï¼ŒGit æä¾›äº†ä¸€ä¸ªå®‰å…¨çš„å‘½ä»¤ <code>update-ref</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git update-ref refs/heads/master 1a410efbd13591db07496601ebc7a059dd55cfe9</span><br></pre></td></tr></table></figure>

<p>åŸºæœ¬ä¸Š Git ä¸­çš„ä¸€ä¸ªåˆ†æ”¯å…¶å®å°±æ˜¯ä¸€ä¸ªæŒ‡å‘æŸä¸ªå·¥ä½œç‰ˆæœ¬ä¸€æ¡ HEAD è®°å½•çš„æŒ‡é’ˆæˆ–å¼•ç”¨ã€‚ä½ å¯ä»¥ç”¨è¿™æ¡å‘½ä»¤åˆ›å»ºä¸€ä¸ªæŒ‡å‘ç¬¬äºŒæ¬¡æäº¤çš„åˆ†æ”¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git update-ref refs/heads/test cac0ca</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä½ çš„åˆ†æ”¯å°†ä¼šåªåŒ…å«é‚£æ¬¡æäº¤ä»¥åŠä¹‹å‰çš„å·¥ä½œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git log --pretty=oneline test</span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d second commit</span><br><span class="line">fdf4fc3344e67ab068f836878b6c4951e3b15f3d first commit</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œä½ çš„ Git æ•°æ®åº“åº”è¯¥çœ‹èµ·æ¥åƒå›¾ 9-4 ä¸€æ ·ã€‚</p>
<p><img src="/2021/08/23/git/git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/18333fig0904-tn.png" alt="img"><br>å›¾ 9-4. åŒ…å«åˆ†æ”¯å¼•ç”¨çš„ Git ç›®å½•å¯¹è±¡</p>
<p>æ¯å½“ä½ æ‰§è¡Œ <code>git branch (åˆ†æ”¯åç§°)</code> è¿™æ ·çš„å‘½ä»¤ï¼ŒGit åŸºæœ¬ä¸Šå°±æ˜¯æ‰§è¡Œ <code>update-ref</code> å‘½ä»¤ï¼ŒæŠŠä½ ç°åœ¨æ‰€åœ¨åˆ†æ”¯ä¸­æœ€åä¸€æ¬¡æäº¤çš„ SHA-1 å€¼ï¼Œæ·»åŠ åˆ°ä½ è¦åˆ›å»ºçš„åˆ†æ”¯çš„å¼•ç”¨ã€‚</p>
<h3 id="HEAD-æ ‡è®°"><a href="#HEAD-æ ‡è®°" class="headerlink" title="HEAD æ ‡è®°"></a>HEAD æ ‡è®°</h3><p>ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œå½“ä½ æ‰§è¡Œ <code>git branch (åˆ†æ”¯åç§°)</code> è¿™æ¡å‘½ä»¤çš„æ—¶å€™ï¼ŒGit æ€ä¹ˆçŸ¥é“æœ€åä¸€æ¬¡æäº¤çš„ SHA-1 å€¼å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ HEAD æ–‡ä»¶ã€‚HEAD æ–‡ä»¶æ˜¯ä¸€ä¸ªæŒ‡å‘ä½ å½“å‰æ‰€åœ¨åˆ†æ”¯çš„å¼•ç”¨æ ‡è¯†ç¬¦ã€‚è¿™æ ·çš„å¼•ç”¨æ ‡è¯†ç¬¦â€”â€”å®ƒçœ‹èµ·æ¥å¹¶ä¸åƒä¸€ä¸ªæ™®é€šçš„å¼•ç”¨â€”â€”å…¶å®å¹¶ä¸åŒ…å« SHA-1 å€¼ï¼Œè€Œæ˜¯ä¸€ä¸ªæŒ‡å‘å¦å¤–ä¸€ä¸ªå¼•ç”¨çš„æŒ‡é’ˆã€‚å¦‚æœä½ çœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼Œé€šå¸¸ä½ å°†ä¼šçœ‹åˆ°è¿™æ ·çš„å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/HEAD</span><br><span class="line">ref: refs/heads/master</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æ‰§è¡Œ <code>git checkout test</code>ï¼ŒGit å°±ä¼šæ›´æ–°è¿™ä¸ªæ–‡ä»¶ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/HEAD</span><br><span class="line">ref: refs/heads/test</span><br></pre></td></tr></table></figure>

<p>å½“ä½ å†æ‰§è¡Œ <code>git commit</code> å‘½ä»¤ï¼Œå®ƒå°±åˆ›å»ºäº†ä¸€ä¸ª commit å¯¹è±¡ï¼ŒæŠŠè¿™ä¸ª commit å¯¹è±¡çš„çˆ¶çº§è®¾ç½®ä¸º HEAD æŒ‡å‘çš„å¼•ç”¨çš„ SHA-1 å€¼ã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯åŒæ ·æœ‰ä¸€ä¸ªæ›´å®‰å…¨çš„æ–¹æ³•å¯ä»¥è¿™æ ·åšï¼š<code>symbolic-ref</code>ã€‚ä½ å¯ä»¥ç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤è¯»å– HEAD çš„å€¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git symbolic-ref HEAD</span><br><span class="line">refs/heads/master</span><br></pre></td></tr></table></figure>

<p>ä½ ä¹Ÿå¯ä»¥è®¾ç½® HEAD çš„å€¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git symbolic-ref HEAD refs/heads/test</span><br><span class="line">$ cat .git/HEAD</span><br><span class="line">ref: refs/heads/test</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ä½ ä¸èƒ½è®¾ç½®æˆ refs ä»¥å¤–çš„å½¢å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git symbolic-ref HEAD test</span><br><span class="line">fatal: Refusing to point HEAD outside of refs/</span><br></pre></td></tr></table></figure>

<h3 id="Tags"><a href="#Tags" class="headerlink" title="Tags"></a>Tags</h3><p>ä½ åˆšåˆšå·²ç»é‡æ¸©è¿‡äº† Git çš„ä¸‰ä¸ªä¸»è¦å¯¹è±¡ç±»å‹ï¼Œç°åœ¨è¿™æ˜¯ç¬¬å››ç§ã€‚Tag å¯¹è±¡éå¸¸åƒä¸€ä¸ª commit å¯¹è±¡â€”â€”åŒ…å«ä¸€ä¸ªæ ‡ç­¾ï¼Œä¸€ç»„æ•°æ®ï¼Œä¸€ä¸ªæ¶ˆæ¯å’Œä¸€ä¸ªæŒ‡é’ˆã€‚æœ€ä¸»è¦çš„åŒºåˆ«å°±æ˜¯ Tag å¯¹è±¡æŒ‡å‘ä¸€ä¸ª commit è€Œä¸æ˜¯ä¸€ä¸ª treeã€‚å®ƒå°±åƒæ˜¯ä¸€ä¸ªåˆ†æ”¯å¼•ç”¨ï¼Œä½†æ˜¯ä¸ä¼šå˜åŒ–â€”â€”æ°¸è¿œæŒ‡å‘åŒä¸€ä¸ª commitï¼Œä»…ä»…æ˜¯æä¾›ä¸€ä¸ªæ›´åŠ å‹å¥½çš„åå­—ã€‚</p>
<p>æ­£å¦‚æˆ‘ä»¬åœ¨ç¬¬äºŒç« æ‰€è®¨è®ºçš„ï¼ŒTag æœ‰ä¸¤ç§ç±»å‹ï¼šannotated å’Œ lightweight ã€‚ä½ å¯ä»¥ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„å‘½ä»¤å»ºç«‹ä¸€ä¸ª lightweight tagï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git update-ref refs/tags/v1.0 cac0cab538b970a37ea1e769cbbde608743bc96d</span><br></pre></td></tr></table></figure>

<p>è¿™å°±æ˜¯ lightweight tag çš„å…¨éƒ¨ â€”â€” ä¸€ä¸ªæ°¸è¿œä¸ä¼šå‘ç”Ÿå˜åŒ–çš„åˆ†æ”¯ã€‚ annotated tag è¦æ›´å¤æ‚ä¸€ç‚¹ã€‚å¦‚æœä½ åˆ›å»ºä¸€ä¸ª annotated tagï¼ŒGit ä¼šåˆ›å»ºä¸€ä¸ª tag å¯¹è±¡ï¼Œç„¶åå†™å…¥ä¸€ä¸ªæŒ‡å‘æŒ‡å‘å®ƒè€Œä¸æ˜¯ç›´æ¥æŒ‡å‘ commit çš„ referenceã€‚ä½ å¯ä»¥è¿™æ ·åˆ›å»ºä¸€ä¸ª annotated tagï¼ˆ<code>-a</code> å‚æ•°è¡¨æ˜è¿™æ˜¯ä¸€ä¸ª annotated tagï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -a v1.1 1a410efbd13591db07496601ebc7a059dd55cfe9 -m &#x27;test tag&#x27;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯æ‰€åˆ›å»ºå¯¹è±¡çš„ SHA-1 å€¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/refs/tags/v1.1</span><br><span class="line">9585191f37f7b0fb9444f35a9bf50de191beadc2</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ä½ å¯ä»¥è¿è¡Œ <code>cat-file</code> å‘½ä»¤æ£€æŸ¥è¿™ä¸ª SHA-1 å€¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 9585191f37f7b0fb9444f35a9bf50de191beadc2</span><br><span class="line">object 1a410efbd13591db07496601ebc7a059dd55cfe9</span><br><span class="line">type commit</span><br><span class="line">tag v1.1</span><br><span class="line">tagger Scott Chacon &lt;schacon@gmail.com&gt; Sat May 23 16:48:58 2009 -0700</span><br><span class="line"></span><br><span class="line">test tag</span><br></pre></td></tr></table></figure>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯è¿™ä¸ªå¯¹è±¡æŒ‡å‘ä½ æ‰€æ ‡è®°çš„ commit å¯¹è±¡çš„ SHA-1 å€¼ã€‚åŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯å®ƒå¹¶ä¸æ˜¯å¿…é¡»è¦æŒ‡å‘ä¸€ä¸ª commit å¯¹è±¡ï¼›ä½ å¯ä»¥æ ‡è®°ä»»ä½• Git å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œåœ¨ Git çš„æºä»£ç é‡Œï¼Œç®¡ç†è€…æ·»åŠ äº†ä¸€ä¸ª GPG å…¬é’¥ï¼ˆè¿™æ˜¯ä¸€ä¸ª blob å¯¹è±¡ï¼‰å¯¹å®ƒåšäº†ä¸€ä¸ªæ ‡ç­¾ã€‚ä½ å°±å¯ä»¥è¿è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file blob junio-gpg-pub</span><br></pre></td></tr></table></figure>

<p>æ¥æŸ¥çœ‹ Git æºä»£ç ä»“åº“ä¸­çš„å…¬é’¥. Linux kernel ä¹Ÿæœ‰ä¸€ä¸ªä¸æ˜¯æŒ‡å‘ commit å¯¹è±¡çš„ tag â€”â€” ç¬¬ä¸€ä¸ª tag æ˜¯åœ¨å¯¼å…¥æºä»£ç çš„æ—¶å€™åˆ›å»ºçš„ï¼Œå®ƒæŒ‡å‘åˆå§‹ tree ï¼ˆinitial treeï¼Œè¯‘è€…æ³¨ï¼‰ã€‚</p>
<h3 id="Remotes"><a href="#Remotes" class="headerlink" title="Remotes"></a>Remotes</h3><p>ä½ å°†ä¼šçœ‹åˆ°çš„ç¬¬å››ç§ reference æ˜¯ remote referenceï¼ˆè¿œç¨‹å¼•ç”¨ï¼Œè¯‘è€…æ³¨ï¼‰ã€‚å¦‚æœä½ æ·»åŠ äº†ä¸€ä¸ª remote ç„¶åæ¨é€ä»£ç è¿‡å»ï¼ŒGit ä¼šæŠŠä½ æœ€åä¸€æ¬¡æ¨é€åˆ°è¿™ä¸ª remote çš„æ¯ä¸ªåˆ†æ”¯çš„å€¼éƒ½è®°å½•åœ¨ <code>refs/remotes</code> ç›®å½•ä¸‹ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªå«åš <code>origin</code> çš„ remote ç„¶åæŠŠä½ çš„ <code>master</code> åˆ†æ”¯æ¨é€ä¸Šå»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin git@github.com:schacon/simplegit-progit.git</span><br><span class="line">$ git push origin master</span><br><span class="line">Counting objects: 11, done.</span><br><span class="line">Compressing objects: 100% (5/5), done.</span><br><span class="line">Writing objects: 100% (7/7), 716 bytes, done.</span><br><span class="line">Total 7 (delta 2), reused 4 (delta 1)</span><br><span class="line">To git@github.com:schacon/simplegit-progit.git</span><br><span class="line">   a11bef0..ca82a6d  master -&gt; master</span><br></pre></td></tr></table></figure>

<p>ç„¶åæŸ¥çœ‹ <code>refs/remotes/origin/master</code> è¿™ä¸ªæ–‡ä»¶ï¼Œä½ å°±ä¼šå‘ç° <code>origin</code> remote ä¸­çš„ <code>master</code> åˆ†æ”¯å°±æ˜¯ä½ æœ€åä¸€æ¬¡å’ŒæœåŠ¡å™¨çš„é€šä¿¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/refs/remotes/origin/master</span><br><span class="line">ca82a6dff817ec66f44342007202690a93763949</span><br></pre></td></tr></table></figure>

<p>Remote å¼•ç”¨å’Œåˆ†æ”¯ä¸»è¦åŒºåˆ«åœ¨äºä»–ä»¬æ˜¯ä¸èƒ½è¢« check out çš„ã€‚Git æŠŠä»–ä»¬å½“ä½œæ˜¯æ ‡è®°äº†è¿™äº›åˆ†æ”¯åœ¨æœåŠ¡å™¨ä¸Šæœ€åçŠ¶æ€çš„ä¸€ç§ä¹¦ç­¾ã€‚</p>
<h2 id="Packfiles"><a href="#Packfiles" class="headerlink" title="Packfiles"></a>Packfiles</h2><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ test Git ä»“åº“ã€‚ç›®å‰ä¸ºæ­¢ï¼Œæœ‰ 11 ä¸ªå¯¹è±¡ â”€â”€ 4 ä¸ª blobï¼Œ3 ä¸ª treeï¼Œ3 ä¸ª commit ä»¥åŠä¸€ä¸ª tagï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects -type f</span><br><span class="line">.git/objects/01/55eb4229851634a0f03eb265b69f5a2d56f341 # tree 2</span><br><span class="line">.git/objects/1a/410efbd13591db07496601ebc7a059dd55cfe9 # commit 3</span><br><span class="line">.git/objects/1f/7a7a472abf3dd9643fd615f6da379c4acb3e3a # test.txt v2</span><br><span class="line">.git/objects/3c/4e9cd789d88d8d89c1073707c3585e41b0e614 # tree 3</span><br><span class="line">.git/objects/83/baae61804e65cc73a7201a7252750c76066a30 # test.txt v1</span><br><span class="line">.git/objects/95/85191f37f7b0fb9444f35a9bf50de191beadc2 # tag</span><br><span class="line">.git/objects/ca/c0cab538b970a37ea1e769cbbde608743bc96d # commit 2</span><br><span class="line">.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4 # &#x27;test content&#x27;</span><br><span class="line">.git/objects/d8/329fc1cc938780ffdd9f94e0d364e0ea74f579 # tree 1</span><br><span class="line">.git/objects/fa/49b077972391ad58037050f2a75f74e3671e92 # new.txt</span><br><span class="line">.git/objects/fd/f4fc3344e67ab068f836878b6c4951e3b15f3d # commit 1</span><br></pre></td></tr></table></figure>

<p>Git ç”¨ zlib å‹ç¼©æ–‡ä»¶å†…å®¹ï¼Œå› æ­¤è¿™äº›æ–‡ä»¶å¹¶æ²¡æœ‰å ç”¨å¤ªå¤šç©ºé—´ï¼Œæ‰€æœ‰æ–‡ä»¶åŠ èµ·æ¥æ€»å…±ä»…ç”¨äº† 925 å­—èŠ‚ã€‚æ¥ä¸‹å»ä½ ä¼šæ·»åŠ ä¸€äº›å¤§æ–‡ä»¶ä»¥æ¼”ç¤º Git çš„ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„åŠŸèƒ½ã€‚å°†ä½ ä¹‹å‰ç”¨åˆ°è¿‡çš„ Grit åº“ä¸­çš„ repo.rb æ–‡ä»¶åŠ è¿›å» â”€â”€ è¿™ä¸ªæºä»£ç æ–‡ä»¶å¤§å°çº¦ä¸º 12Kï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://github.com/mojombo/grit/raw/master/lib/grit/repo.rb &gt; repo.rb</span><br><span class="line">$ git add repo.rb</span><br><span class="line">$ git commit -m &#x27;added repo.rb&#x27;</span><br><span class="line">[master 484a592] added repo.rb</span><br><span class="line"> 3 files changed, 459 insertions(+), 2 deletions(-)</span><br><span class="line"> delete mode 100644 bak/test.txt</span><br><span class="line"> create mode 100644 repo.rb</span><br><span class="line"> rewrite test.txt (100%)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæŸ¥çœ‹ä¸€ä¸‹ç”Ÿæˆçš„ treeï¼Œå¯ä»¥çœ‹åˆ° repo.rb æ–‡ä»¶çš„ blob å¯¹è±¡çš„ SHA-1 å€¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p master^&#123;tree&#125;</span><br><span class="line">100644 blob fa49b077972391ad58037050f2a75f74e3671e92      new.txt</span><br><span class="line">100644 blob 9bc1dc421dcd51b4ac296e3e5b6e2a99cf44391e      repo.rb</span><br><span class="line">100644 blob e3f094f522629ae358806b17daf78246c27c007b      test.txt</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯ä»¥ç”¨ <code>git cat-file</code> å‘½ä»¤æŸ¥çœ‹è¿™ä¸ªå¯¹è±¡æœ‰å¤šå¤§ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ du -b .git/objects/9b/c1dc421dcd51b4ac296e3e5b6e2a99cf44391e</span><br><span class="line">4102	.git/objects/9b/c1dc421dcd51b4ac296e3e5b6e2a99cf44391e</span><br></pre></td></tr></table></figure>

<p>ç¨å¾®ä¿®æ”¹ä¸€ä¸‹äº›æ–‡ä»¶ï¼Œçœ‹ä¼šå‘ç”Ÿäº›ä»€ä¹ˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ echo &#x27;# testing&#x27; &gt;&gt; repo.rb</span><br><span class="line">$ git commit -am &#x27;modified repo a bit&#x27;</span><br><span class="line">[master ab1afef] modified repo a bit</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹è¿™ä¸ª commit ç”Ÿæˆçš„ treeï¼Œå¯ä»¥çœ‹åˆ°ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p master^&#123;tree&#125;</span><br><span class="line">100644 blob fa49b077972391ad58037050f2a75f74e3671e92      new.txt</span><br><span class="line">100644 blob 05408d195263d853f09dca71d55116663690c27c      repo.rb</span><br><span class="line">100644 blob e3f094f522629ae358806b17daf78246c27c007b      test.txt</span><br></pre></td></tr></table></figure>

<p>blob å¯¹è±¡ä¸ä¹‹å‰çš„å·²ç»ä¸åŒäº†ã€‚è¿™è¯´æ˜è™½ç„¶åªæ˜¯å¾€ä¸€ä¸ª 400 è¡Œçš„æ–‡ä»¶æœ€ååŠ å…¥äº†ä¸€è¡Œå†…å®¹ï¼ŒGit å´ç”¨ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡æ¥ä¿å­˜æ–°çš„æ–‡ä»¶å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ du -b .git/objects/05/408d195263d853f09dca71d55116663690c27c</span><br><span class="line">4109	.git/objects/05/408d195263d853f09dca71d55116663690c27c</span><br></pre></td></tr></table></figure>

<p>ä½ çš„ç£ç›˜ä¸Šæœ‰äº†ä¸¤ä¸ªå‡ ä¹å®Œå…¨ç›¸åŒçš„ 12K çš„å¯¹è±¡ã€‚å¦‚æœ Git åªå®Œæ•´ä¿å­˜å…¶ä¸­ä¸€ä¸ªï¼Œå¹¶ä¿å­˜å¦ä¸€ä¸ªå¯¹è±¡çš„å·®å¼‚å†…å®¹ï¼Œå²‚ä¸æ›´å¥½ï¼Ÿ</p>
<p>äº‹å®ä¸Š Git å¯ä»¥é‚£æ ·åšã€‚Git å¾€ç£ç›˜ä¿å­˜å¯¹è±¡æ—¶é»˜è®¤ä½¿ç”¨çš„æ ¼å¼å«æ¾æ•£å¯¹è±¡ (loose object) æ ¼å¼ã€‚Git æ—¶ä¸æ—¶åœ°å°†è¿™äº›å¯¹è±¡æ‰“åŒ…è‡³ä¸€ä¸ªå« packfile çš„äºŒè¿›åˆ¶æ–‡ä»¶ä»¥èŠ‚çœç©ºé—´å¹¶æé«˜æ•ˆç‡ã€‚å½“ä»“åº“ä¸­æœ‰å¤ªå¤šçš„æ¾æ•£å¯¹è±¡ï¼Œæˆ–æ˜¯æ‰‹å·¥è°ƒç”¨ <code>git gc</code> å‘½ä»¤ï¼Œæˆ–æ¨é€è‡³è¿œç¨‹æœåŠ¡å™¨æ—¶ï¼ŒGit éƒ½ä¼šè¿™æ ·åšã€‚æ‰‹å·¥è°ƒç”¨ <code>git gc</code> å‘½ä»¤è®© Git å°†åº“ä¸­å¯¹è±¡æ‰“åŒ…å¹¶çœ‹ä¼šå‘ç”Ÿäº›ä»€ä¹ˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git gc</span><br><span class="line">Counting objects: 17, done.</span><br><span class="line">Delta compression using 2 threads.</span><br><span class="line">Compressing objects: 100% (13/13), done.</span><br><span class="line">Writing objects: 100% (17/17), done.</span><br><span class="line">Total 17 (delta 1), reused 10 (delta 0)</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ä¸€ä¸‹ objects ç›®å½•ï¼Œä¼šå‘ç°å¤§éƒ¨åˆ†å¯¹è±¡éƒ½ä¸åœ¨äº†ï¼Œä¸æ­¤åŒæ—¶å‡ºç°äº†ä¸¤ä¸ªæ–°æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects -type f</span><br><span class="line">.git/objects/71/08f7ecb345ee9d0084193f147cdad4d2998293</span><br><span class="line">.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4</span><br><span class="line">.git/objects/info/packs</span><br><span class="line">.git/objects/pack/pack-7a16e4488ae40c7d2bc56ea2bd43e25212a66c45.idx</span><br><span class="line">.git/objects/pack/pack-7a16e4488ae40c7d2bc56ea2bd43e25212a66c45.pack</span><br></pre></td></tr></table></figure>

<p>ä»ä¿ç•™ç€çš„å‡ ä¸ªå¯¹è±¡æ˜¯æœªè¢«ä»»ä½• commit å¼•ç”¨çš„ blob â”€â”€ åœ¨æ­¤ä¾‹ä¸­æ˜¯ä½ ä¹‹å‰åˆ›å»ºçš„ â€œwhat is up, doc?â€ å’Œ â€œtest contentâ€ è¿™ä¸¤ä¸ªç¤ºä¾‹ blobã€‚ä½ ä»æ²¡å°†ä»–ä»¬æ·»åŠ è‡³ä»»ä½• commitï¼Œæ‰€ä»¥ Git è®¤ä¸ºå®ƒä»¬æ˜¯ â€œæ‚¬ç©ºâ€ çš„ï¼Œä¸ä¼šå°†å®ƒä»¬æ‰“åŒ…è¿› packfile ã€‚</p>
<p>å‰©ä¸‹çš„æ–‡ä»¶æ˜¯æ–°åˆ›å»ºçš„ packfile ä»¥åŠä¸€ä¸ªç´¢å¼•ã€‚packfile æ–‡ä»¶åŒ…å«äº†åˆšæ‰ä»æ–‡ä»¶ç³»ç»Ÿä¸­ç§»é™¤çš„æ‰€æœ‰å¯¹è±¡ã€‚ç´¢å¼•æ–‡ä»¶åŒ…å«äº† packfile çš„åç§»ä¿¡æ¯ï¼Œè¿™æ ·å°±å¯ä»¥å¿«é€Ÿå®šä½ä»»æ„ä¸€ä¸ªæŒ‡å®šå¯¹è±¡ã€‚æœ‰æ„æ€çš„æ˜¯è¿è¡Œ <code>gc</code> å‘½ä»¤å‰ç£ç›˜ä¸Šçš„å¯¹è±¡å¤§å°çº¦ä¸º 12K ï¼Œè€Œè¿™ä¸ªæ–°ç”Ÿæˆçš„ packfile ä»…ä¸º 6K å¤§å°ã€‚é€šè¿‡æ‰“åŒ…å¯¹è±¡å‡å°‘äº†ä¸€åŠç£ç›˜ä½¿ç”¨ç©ºé—´ã€‚</p>
<p>Git æ˜¯å¦‚ä½•åšåˆ°è¿™ç‚¹çš„ï¼ŸGit æ‰“åŒ…å¯¹è±¡æ—¶ï¼Œä¼šæŸ¥æ‰¾å‘½ååŠå°ºå¯¸ç›¸è¿‘çš„æ–‡ä»¶ï¼Œå¹¶åªä¿å­˜æ–‡ä»¶ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚å†…å®¹ã€‚å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ packfile ï¼Œè§‚å¯Ÿå®ƒæ˜¯å¦‚ä½•èŠ‚çœç©ºé—´çš„ã€‚<code>git verify-pack</code> å‘½ä»¤ç”¨äºæ˜¾ç¤ºå·²æ‰“åŒ…çš„å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ git verify-pack -v \</span><br><span class="line">  .git/objects/pack/pack-7a16e4488ae40c7d2bc56ea2bd43e25212a66c45.idx</span><br><span class="line">0155eb4229851634a0f03eb265b69f5a2d56f341 tree   71 76 5400</span><br><span class="line">05408d195263d853f09dca71d55116663690c27c blob   12908 3478 874</span><br><span class="line">09f01cea547666f58d6a8d809583841a7c6f0130 tree   106 107 5086</span><br><span class="line">1a410efbd13591db07496601ebc7a059dd55cfe9 commit 225 151 322</span><br><span class="line">1f7a7a472abf3dd9643fd615f6da379c4acb3e3a blob   10 19 5381</span><br><span class="line">3c4e9cd789d88d8d89c1073707c3585e41b0e614 tree   101 105 5211</span><br><span class="line">484a59275031909e19aadb7c92262719cfcdf19a commit 226 153 169</span><br><span class="line">83baae61804e65cc73a7201a7252750c76066a30 blob   10 19 5362</span><br><span class="line">9585191f37f7b0fb9444f35a9bf50de191beadc2 tag    136 127 5476</span><br><span class="line">9bc1dc421dcd51b4ac296e3e5b6e2a99cf44391e blob   7 18 5193 1 \</span><br><span class="line">  05408d195263d853f09dca71d55116663690c27c</span><br><span class="line">ab1afef80fac8e34258ff41fc1b867c702daa24b commit 232 157 12</span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d commit 226 154 473</span><br><span class="line">d8329fc1cc938780ffdd9f94e0d364e0ea74f579 tree   36 46 5316</span><br><span class="line">e3f094f522629ae358806b17daf78246c27c007b blob   1486 734 4352</span><br><span class="line">f8f51d7d8a1760462eca26eebafde32087499533 tree   106 107 749</span><br><span class="line">fa49b077972391ad58037050f2a75f74e3671e92 blob   9 18 856</span><br><span class="line">fdf4fc3344e67ab068f836878b6c4951e3b15f3d commit 177 122 627</span><br><span class="line">chain length = 1: 1 object</span><br><span class="line">pack-7a16e4488ae40c7d2bc56ea2bd43e25212a66c45.pack: ok</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ è¿˜è®°å¾—çš„è¯, <code>9bc1d</code> è¿™ä¸ª blob æ˜¯ repo.rb æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œè¿™ä¸ª blob å¼•ç”¨äº† <code>05408</code> è¿™ä¸ª blobï¼Œå³è¯¥æ–‡ä»¶çš„ç¬¬äºŒä¸ªç‰ˆæœ¬ã€‚å‘½ä»¤è¾“å‡ºå†…å®¹çš„ç¬¬ä¸‰åˆ—æ˜¾ç¤ºçš„æ˜¯å¯¹è±¡å¤§å°ï¼Œå¯ä»¥çœ‹åˆ° <code>05408</code> å ç”¨äº† 12K ç©ºé—´ï¼Œè€Œ <code>9bc1d</code> ä»…ä¸º 7 å­—èŠ‚ã€‚éå¸¸æœ‰è¶£çš„æ˜¯ç¬¬äºŒä¸ªç‰ˆæœ¬æ‰æ˜¯å®Œæ•´ä¿å­˜æ–‡ä»¶å†…å®¹çš„å¯¹è±¡ï¼Œè€Œç¬¬ä¸€ä¸ªç‰ˆæœ¬æ˜¯ä»¥å·®å¼‚æ–¹å¼ä¿å­˜çš„ â”€â”€ è¿™æ˜¯å› ä¸ºå¤§éƒ¨åˆ†æƒ…å†µä¸‹éœ€è¦å¿«é€Ÿè®¿é—®æ–‡ä»¶çš„æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<p>æœ€å¦™çš„æ˜¯å¯ä»¥éšæ—¶è¿›è¡Œé‡æ–°æ‰“åŒ…ã€‚Git è‡ªåŠ¨å®šæœŸå¯¹ä»“åº“è¿›è¡Œé‡æ–°æ‰“åŒ…ä»¥èŠ‚çœç©ºé—´ã€‚å½“ç„¶ä¹Ÿå¯ä»¥æ‰‹å·¥è¿è¡Œ <code>git gc</code> å‘½ä»¤æ¥è¿™ä¹ˆåšã€‚</p>
<h2 id="The-Refspec"><a href="#The-Refspec" class="headerlink" title="The Refspec"></a>The Refspec</h2><p>è¿™æœ¬ä¹¦è¯»åˆ°è¿™é‡Œï¼Œä½ å·²ç»ä½¿ç”¨è¿‡ä¸€äº›ç®€å•çš„è¿œç¨‹åˆ†æ”¯åˆ°æœ¬åœ°å¼•ç”¨çš„æ˜ å°„æ–¹å¼äº†ï¼Œè¿™ç§æ˜ å°„å¯ä»¥æ›´ä¸ºå¤æ‚ã€‚ å‡è®¾ä½ åƒè¿™æ ·æ·»åŠ äº†ä¸€é¡¹è¿œç¨‹ä»“åº“ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin git@github.com:schacon/simplegit-progit.git</span><br></pre></td></tr></table></figure>

<p>å®ƒåœ¨ä½ çš„ <code>.git/config</code> æ–‡ä»¶ä¸­æ·»åŠ äº†ä¸€èŠ‚ï¼ŒæŒ‡å®šäº†è¿œç¨‹çš„åç§° (<code>origin</code>), è¿œç¨‹ä»“åº“çš„URLåœ°å€ï¼Œå’Œç”¨äºè·å–æ“ä½œçš„ Refspec:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">       url = git@github.com:schacon/simplegit-progit.git</span><br><span class="line">       fetch = +refs/heads/*:refs/remotes/origin/*</span><br></pre></td></tr></table></figure>

<p>Refspec çš„æ ¼å¼æ˜¯ä¸€ä¸ªå¯é€‰çš„ <code>+</code> å·ï¼Œæ¥ç€æ˜¯ <code>&lt;src&gt;:&lt;dst&gt;</code> çš„æ ¼å¼ï¼Œè¿™é‡Œ <code>&lt;src&gt;</code> æ˜¯è¿œç«¯ä¸Šçš„å¼•ç”¨æ ¼å¼ï¼Œ <code>&lt;dst&gt;</code> æ˜¯å°†è¦è®°å½•åœ¨æœ¬åœ°çš„å¼•ç”¨æ ¼å¼ã€‚å¯é€‰çš„ <code>+</code> å·å‘Šè¯‰ Git åœ¨å³ä½¿ä¸èƒ½å¿«é€Ÿæ¼”è¿›çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå»å¼ºåˆ¶æ›´æ–°å®ƒã€‚</p>
<p>ç¼ºçœæƒ…å†µä¸‹ refspec ä¼šè¢« <code>git remote add</code> å‘½ä»¤æ‰€è‡ªåŠ¨ç”Ÿæˆï¼Œ Git ä¼šè·å–è¿œç«¯ä¸Š <code>refs/heads/</code> ä¸‹é¢çš„æ‰€æœ‰å¼•ç”¨ï¼Œå¹¶å°†å®ƒå†™å…¥åˆ°æœ¬åœ°çš„ <code>refs/remotes/origin/</code>. æ‰€ä»¥ï¼Œå¦‚æœè¿œç«¯ä¸Šæœ‰ä¸€ä¸ª <code>master</code> åˆ†æ”¯ï¼Œä½ åœ¨æœ¬åœ°å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ç§æ–¹å¼æ¥è®¿é—®å®ƒçš„å†å²è®°å½•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git log origin/master</span><br><span class="line">$ git log remotes/origin/master</span><br><span class="line">$ git log refs/remotes/origin/master</span><br></pre></td></tr></table></figure>

<p>å®ƒä»¬å…¨æ˜¯ç­‰ä»·çš„ï¼Œå› ä¸º Git æŠŠå®ƒä»¬éƒ½æ‰©å±•æˆ <code>refs/remotes/origin/master</code>.</p>
<p>å¦‚æœä½ æƒ³è®© Git æ¯æ¬¡åªæ‹‰å–è¿œç¨‹çš„ <code>master</code> åˆ†æ”¯ï¼Œè€Œä¸æ˜¯è¿œç¨‹çš„æ‰€æœ‰åˆ†æ”¯ï¼Œä½ å¯ä»¥æŠŠ fetch è¿™ä¸€è¡Œä¿®æ”¹æˆè¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch = +refs/heads/master:refs/remotes/origin/master</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ <code>git fetch</code> æ“ä½œå¯¹è¿™ä¸ªè¿œç«¯çš„ç¼ºçœ refspec å€¼ã€‚è€Œå¦‚æœä½ åªæƒ³åšä¸€æ¬¡è¯¥æ“ä½œï¼Œä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šè¿™ä¸ª refspec. å¦‚å¯ä»¥è¿™æ ·æ‹‰å–è¿œç¨‹çš„ <code>master</code> åˆ†æ”¯åˆ°æœ¬åœ°çš„ <code>origin/mymaster</code> åˆ†æ”¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch origin master:refs/remotes/origin/mymaster</span><br></pre></td></tr></table></figure>

<p>ä½ ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šå¤šä¸ª refspec. åƒè¿™æ ·å¯ä»¥ä¸€æ¬¡è·å–è¿œç¨‹çš„å¤šä¸ªåˆ†æ”¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch origin master:refs/remotes/origin/mymaster \</span><br><span class="line">   topic:refs/remotes/origin/topic</span><br><span class="line">From git@github.com:schacon/simplegit</span><br><span class="line"> ! [rejected]        master     -&gt; origin/mymaster  (non fast forward)</span><br><span class="line"> * [new branch]      topic      -&gt; origin/topic</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ <code>master</code> åˆ†æ”¯å› ä¸ºä¸æ˜¯ä¸€ä¸ªå¯ä»¥å¿«é€Ÿæ¼”è¿›çš„å¼•ç”¨è€Œæ‹‰å–æ“ä½œè¢«æ‹’ç»ã€‚ä½ å¯ä»¥åœ¨ refspec ä¹‹å‰ä½¿ç”¨ä¸€ä¸ª <code>+</code> å·æ¥é‡è½½è¿™ç§è¡Œä¸ºã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå¤šä¸ª refspec. å¦‚ä½ æƒ³åœ¨æ¯æ¬¡è·å–æ—¶éƒ½è·å– <code>master</code> å’Œ <code>experiment</code> åˆ†æ”¯ï¼Œå°±æ·»åŠ ä¸¤è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">       url = git@github.com:schacon/simplegit-progit.git</span><br><span class="line">       fetch = +refs/heads/master:refs/remotes/origin/master</span><br><span class="line">       fetch = +refs/heads/experiment:refs/remotes/origin/experiment</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™é‡Œä¸èƒ½ä½¿ç”¨éƒ¨åˆ†é€šé…ç¬¦ï¼Œåƒè¿™æ ·å°±æ˜¯ä¸åˆæ³•çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch = +refs/heads/qa*:refs/remotes/origin/qa*</span><br></pre></td></tr></table></figure>

<p>ä½†æ— è®ºå¦‚ä½•ï¼Œä½ å¯ä»¥ä½¿ç”¨å‘½åç©ºé—´æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚å¦‚ä½ æœ‰ä¸€ä¸ªQAç»„ï¼Œä»–ä»¬æ¨é€ä¸€ç³»åˆ—åˆ†æ”¯ï¼Œä½ æƒ³æ¯æ¬¡è·å– <code>master</code> åˆ†æ”¯å’ŒQAç»„çš„æ‰€æœ‰åˆ†æ”¯ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™æ ·çš„é…ç½®æ®µè½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">       url = git@github.com:schacon/simplegit-progit.git</span><br><span class="line">       fetch = +refs/heads/master:refs/remotes/origin/master</span><br><span class="line">       fetch = +refs/heads/qa/*:refs/remotes/origin/qa/*</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ çš„å·¥ä½œæµå¾ˆå¤æ‚ï¼Œæœ‰QAç»„æ¨é€çš„åˆ†æ”¯ã€å¼€å‘äººå‘˜æ¨é€çš„åˆ†æ”¯ã€å’Œé›†æˆäººå‘˜æ¨é€çš„åˆ†æ”¯ï¼Œå¹¶ä¸”ä»–ä»¬åœ¨è¿œç¨‹åˆ†æ”¯ä¸Šåä½œï¼Œä½ å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼ä¸ºä»–ä»¬åˆ›å»ºå„è‡ªçš„å‘½åç©ºé—´ã€‚</p>
<h3 id="æ¨é€-Refspec"><a href="#æ¨é€-Refspec" class="headerlink" title="æ¨é€ Refspec"></a>æ¨é€ Refspec</h3><p>é‡‡ç”¨å‘½åç©ºé—´çš„æ–¹å¼ç¡®å®å¾ˆæ£’ï¼Œä½†QAç»„æˆå‘˜ç¬¬1æ¬¡æ˜¯å¦‚ä½•å°†ä»–ä»¬çš„åˆ†æ”¯æ¨é€åˆ° <code>qa/</code> ç©ºé—´é‡Œé¢çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä½ å¯ä»¥ä½¿ç”¨ refspec æ¥æ¨é€ã€‚</p>
<p>å¦‚æœQAç»„æˆå‘˜æƒ³æŠŠä»–ä»¬çš„ <code>master</code> åˆ†æ”¯æ¨é€åˆ°è¿œç¨‹çš„ <code>qa/master</code> åˆ†æ”¯ä¸Šï¼Œå¯ä»¥è¿™æ ·è¿è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master:refs/heads/qa/master</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä»–ä»¬æƒ³è®© Git æ¯æ¬¡è¿è¡Œ <code>git push origin</code> æ—¶éƒ½è¿™æ ·è‡ªåŠ¨æ¨é€ï¼Œä»–ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  <code>push</code> å€¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">       url = git@github.com:schacon/simplegit-progit.git</span><br><span class="line">       fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">       push = refs/heads/master:refs/heads/qa/master</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œå°±ä¼šè®© <code>git push origin</code> ç¼ºçœå°±æŠŠæœ¬åœ°çš„ <code>master</code> åˆ†æ”¯æ¨é€åˆ°è¿œç¨‹çš„ <code>qa/master</code> åˆ†æ”¯ä¸Šã€‚</p>
<h3 id="åˆ é™¤å¼•ç”¨"><a href="#åˆ é™¤å¼•ç”¨" class="headerlink" title="åˆ é™¤å¼•ç”¨"></a>åˆ é™¤å¼•ç”¨</h3><p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ refspec æ¥åˆ é™¤è¿œç¨‹çš„å¼•ç”¨ï¼Œæ˜¯é€šè¿‡è¿è¡Œè¿™æ ·çš„å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin :topic</span><br></pre></td></tr></table></figure>

<p>å› ä¸º refspec çš„æ ¼å¼æ˜¯ <code>&lt;src&gt;:&lt;dst&gt;</code>, é€šè¿‡æŠŠ <code>&lt;src&gt;</code> éƒ¨åˆ†ç•™ç©ºçš„æ–¹å¼ï¼Œè¿™ä¸ªæ„æ€æ˜¯æ˜¯æŠŠè¿œç¨‹çš„ <code>topic</code> åˆ†æ”¯å˜æˆç©ºï¼Œä¹Ÿå°±æ˜¯åˆ é™¤å®ƒã€‚</p>
<h2 id="ä¼ è¾“åè®®"><a href="#ä¼ è¾“åè®®" class="headerlink" title="ä¼ è¾“åè®®"></a>ä¼ è¾“åè®®</h2><p>Git å¯ä»¥ä»¥ä¸¤ç§ä¸»è¦çš„æ–¹å¼è·¨è¶Šä¸¤ä¸ªä»“åº“ä¼ è¾“æ•°æ®ï¼šåŸºäºHTTPåè®®ä¹‹ä¸Šï¼Œå’Œ <code>file://</code>, <code>ssh://</code>, å’Œ <code>git://</code> ç­‰æ™ºèƒ½ä¼ è¾“åè®®ã€‚è¿™ä¸€èŠ‚å¸¦ä½ å¿«é€Ÿæµè§ˆè¿™ä¸¤ç§ä¸»è¦çš„åè®®æ“ä½œè¿‡ç¨‹ã€‚</p>
<h3 id="å“‘åè®®"><a href="#å“‘åè®®" class="headerlink" title="å“‘åè®®"></a>å“‘åè®®</h3><p>Git åŸºäºHTTPä¹‹ä¸Šä¼ è¾“é€šå¸¸è¢«ç§°ä¸ºå“‘åè®®ï¼Œè¿™æ˜¯å› ä¸ºå®ƒåœ¨æœåŠ¡ç«¯ä¸éœ€è¦æœ‰é’ˆå¯¹ Git ç‰¹æœ‰çš„ä»£ç ã€‚è¿™ä¸ªè·å–è¿‡ç¨‹ä»…ä»…æ˜¯ä¸€ç³»åˆ—GETè¯·æ±‚ï¼Œå®¢æˆ·ç«¯å¯ä»¥å‡å®šæœåŠ¡ç«¯çš„Gitä»“åº“ä¸­çš„å¸ƒå±€ã€‚è®©æˆ‘ä»¬ä»¥ simplegit åº“æ¥çœ‹çœ‹ <code>http-fetch</code> çš„è¿‡ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone http://github.com/schacon/simplegit-progit.git</span><br></pre></td></tr></table></figure>

<p>å®ƒåšçš„ç¬¬1ä»¶äº‹æƒ…å°±æ˜¯è·å– <code>info/refs</code> æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯åœ¨æœåŠ¡ç«¯è¿è¡Œäº† <code>update-server-info</code> æ‰€ç”Ÿæˆçš„ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆåœ¨æœåŠ¡ç«¯è¦æƒ³ä½¿ç”¨HTTPä¼ è¾“ï¼Œå¿…é¡»è¦å¼€å¯ <code>post-receive</code> é’©å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET info/refs</span><br><span class="line">ca82a6dff817ec66f44342007202690a93763949     refs/heads/master</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ä½ æœ‰ä¸€ä¸ªè¿œç«¯å¼•ç”¨å’ŒSHAå€¼çš„åˆ—è¡¨ã€‚ä¸‹ä¸€æ­¥æ˜¯å¯»æ‰¾HEADå¼•ç”¨ï¼Œè¿™æ ·ä½ å°±çŸ¥é“äº†åœ¨å®Œæˆåï¼Œä»€ä¹ˆåº”è¯¥è¢«æ£€å‡ºåˆ°å·¥ä½œç›®å½•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET HEAD</span><br><span class="line">ref: refs/heads/master</span><br></pre></td></tr></table></figure>

<p>è¿™è¯´æ˜åœ¨å®Œæˆè·å–åï¼Œéœ€è¦æ£€å‡º <code>master</code> åˆ†æ”¯ã€‚ è¿™æ—¶ï¼Œå·²ç»å¯ä»¥å¼€å§‹æ¼«æ¸¸æ“ä½œäº†ã€‚å› ä¸ºä½ çš„èµ·ç‚¹æ˜¯åœ¨ <code>info/refs</code> æ–‡ä»¶ä¸­æ‰€æåˆ°çš„ <code>ca82a6</code> commit å¯¹è±¡ï¼Œä½ çš„å¼€å§‹æ“ä½œå°±æ˜¯è·å–å®ƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET objects/ca/82a6dff817ec66f44342007202690a93763949</span><br><span class="line">(179 bytes of binary data)</span><br></pre></td></tr></table></figure>

<p>ç„¶åä½ å–å›äº†è¿™ä¸ªå¯¹è±¡ ï¼ è¿™åœ¨æœåŠ¡ç«¯æ˜¯ä¸€ä¸ªæ¾æ•£æ ¼å¼çš„å¯¹è±¡ï¼Œä½ ä½¿ç”¨çš„æ˜¯é™æ€çš„ HTTP GET è¯·æ±‚è·å–çš„ã€‚å¯ä»¥ä½¿ç”¨ zlib è§£å‹ç¼©å®ƒï¼Œå»é™¤å…¶å¤´éƒ¨ï¼ŒæŸ¥çœ‹å®ƒçš„ commmit å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p ca82a6dff817ec66f44342007202690a93763949</span><br><span class="line">tree cfda3bf379e4f8dba8717dee55aab78aef7f4daf</span><br><span class="line">parent 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7</span><br><span class="line">author Scott Chacon &lt;schacon@gmail.com&gt; 1205815931 -0700</span><br><span class="line">committer Scott Chacon &lt;schacon@gmail.com&gt; 1240030591 -0700</span><br><span class="line"></span><br><span class="line">changed the version number</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œå°±å¾—åˆ°äº†ä¸¤ä¸ªéœ€è¦è¿›ä¸€æ­¥è·å–çš„å¯¹è±¡ ï¼ <code>cfda3b</code> æ˜¯è¿™ä¸ª commit å¯¹è±¡æ‰€å¯¹åº”çš„ tree å¯¹è±¡ï¼Œå’Œ <code>085bb3</code> æ˜¯å®ƒçš„çˆ¶å¯¹è±¡ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET objects/08/5bb3bcb608e1e8451d4b2432f8ecbe6306e7e7</span><br><span class="line">(179 bytes of data)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å–å¾—äº†è¿™å®ƒçš„ä¸‹ä¸€æ­¥ commit å¯¹è±¡ï¼Œå†æŠ“å– tree å¯¹è±¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET objects/cf/da3bf379e4f8dba8717dee55aab78aef7f4daf</span><br><span class="line">(404 - Not Found)</span><br></pre></td></tr></table></figure>

<p>Oops - çœ‹èµ·æ¥è¿™ä¸ª tree å¯¹è±¡åœ¨æœåŠ¡ç«¯å¹¶ä¸ä»¥æ¾æ•£æ ¼å¼å¯¹è±¡å­˜åœ¨ï¼Œæ‰€ä»¥å¾—åˆ°äº†404å“åº”ï¼Œä»£è¡¨åœ¨HTTPæœåŠ¡ç«¯æ²¡æœ‰æ‰¾åˆ°è¯¥å¯¹è±¡ã€‚è¿™æœ‰å¥½å‡ ä¸ªåŸå›  ï¼ è¿™ä¸ªå¯¹è±¡å¯èƒ½åœ¨æ›¿ä»£ä»“åº“é‡Œé¢ï¼Œæˆ–è€…åœ¨æ‰“åŒ…æ–‡ä»¶é‡Œé¢ï¼Œ Git ä¼šé¦–å…ˆæ£€æŸ¥ä»»ä½•åˆ—å‡ºçš„æ›¿ä»£ä»“åº“ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET objects/info/http-alternates</span><br><span class="line">(empty file)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¿™è¿”å›äº†å‡ ä¸ªæ›¿ä»£ä»“åº“åˆ—è¡¨ï¼Œé‚£ä¹ˆå®ƒä¼šå»é‚£äº›åœ°æ–¹æ£€æŸ¥æ¾æ•£æ ¼å¼å¯¹è±¡å’Œæ–‡ä»¶ ï¼ è¿™æ˜¯ä¸€ç§åœ¨è½¯ä»¶åˆ†å‰ä¹‹é—´å…±äº«å¯¹è±¡ä»¥èŠ‚çœç£ç›˜çš„å¥½æ–¹æ³•ã€‚ç„¶è€Œï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ²¡æœ‰æ›¿ä»£ä»“åº“ã€‚æ‰€ä»¥ä½ æ‰€éœ€è¦çš„å¯¹è±¡è‚¯å®šåœ¨æŸä¸ªæ‰“åŒ…æ–‡ä»¶ä¸­ã€‚è¦æ£€æŸ¥æœåŠ¡ç«¯æœ‰å“ªäº›æ‰“åŒ…æ ¼å¼æ–‡ä»¶ï¼Œä½ éœ€è¦è·å– <code>objects/info/packs</code> æ–‡ä»¶ï¼Œè¿™é‡Œé¢åŒ…å«æœ‰æ‰“åŒ…æ–‡ä»¶åˆ—è¡¨ï¼ˆæ˜¯çš„ï¼Œå®ƒä¹Ÿæ˜¯è¢« <code>update-server-info</code> æ‰€ç”Ÿæˆçš„ï¼‰ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET objects/info/packs</span><br><span class="line">P pack-816a9b2334da9953e530f27bcac22082a9f5b835.pack</span><br></pre></td></tr></table></figure>

<p>è¿™é‡ŒæœåŠ¡ç«¯åªæœ‰ä¸€ä¸ªæ‰“åŒ…æ–‡ä»¶ï¼Œæ‰€ä»¥ä½ è¦çš„å¯¹è±¡æ˜¾ç„¶å°±åœ¨é‡Œé¢ã€‚ä½†æ˜¯ä½ å¯ä»¥å…ˆæ£€æŸ¥å®ƒçš„ç´¢å¼•æ–‡ä»¶ä»¥ç¡®è®¤ã€‚è¿™åœ¨æœåŠ¡ç«¯æœ‰å¤šä¸ªæ‰“åŒ…æ–‡ä»¶æ—¶ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œå› ä¸ºè¿™æ ·å°±å¯ä»¥å…ˆæ£€æŸ¥ä½ æ‰€éœ€è¦çš„å¯¹è±¡ç©ºé—´æ˜¯åœ¨å“ªä¸€ä¸ªæ‰“åŒ…æ–‡ä»¶é‡Œé¢äº†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET objects/pack/pack-816a9b2334da9953e530f27bcac22082a9f5b835.idx</span><br><span class="line">(4k of binary data)</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ä½ æœ‰äº†è¿™ä¸ªæ‰“åŒ…æ–‡ä»¶çš„ç´¢å¼•ï¼Œä½ å¯ä»¥çœ‹çœ‹ä½ è¦çš„å¯¹è±¡æ˜¯å¦åœ¨é‡Œé¢ ï¼ å› ä¸ºç´¢å¼•æ–‡ä»¶åˆ—å‡ºäº†è¿™ä¸ªæ‰“åŒ…æ–‡ä»¶æ‰€åŒ…å«çš„æ‰€æœ‰å¯¹è±¡çš„SHAå€¼ï¼Œå’Œè¯¥å¯¹è±¡å­˜åœ¨äºæ‰“åŒ…æ–‡ä»¶ä¸­çš„åç§»é‡ï¼Œæ‰€ä»¥ä½ åªéœ€è¦ç®€å•åœ°è·å–æ•´ä¸ªæ‰“åŒ…æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET objects/pack/pack-816a9b2334da9953e530f27bcac22082a9f5b835.pack</span><br><span class="line">(13k of binary data)</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ä½ ä¹Ÿæœ‰äº†è¿™ä¸ª tree å¯¹è±¡ï¼Œä½ å¯ä»¥ç»§ç»­åœ¨ commit å¯¹è±¡ä¸Šæ¼«æ¸¸ã€‚å®ƒä»¬å…¨éƒ¨éƒ½åœ¨è¿™ä¸ªä½ å·²ç»ä¸‹è½½åˆ°çš„æ‰“åŒ…æ–‡ä»¶é‡Œé¢ï¼Œæ‰€ä»¥ä½ ä¸ç”¨ç»§ç»­å‘æœåŠ¡ç«¯è¯·æ±‚æ›´å¤šä¸‹è½½äº†ã€‚ åœ¨è¿™å®Œæˆä¹‹åï¼Œç”±äºä¸‹è½½å¼€å§‹æ—¶å·²æ¢æ˜HEADå¼•ç”¨æ˜¯æŒ‡å‘ <code>master</code> åˆ†æ”¯ï¼Œ Git ä¼šå°†å®ƒæ£€å‡ºåˆ°å·¥ä½œç›®å½•ã€‚</p>
<p>æ•´ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥å°±åƒè¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git clone http://github.com/schacon/simplegit-progit.git</span><br><span class="line">Initialized empty Git repository in /private/tmp/simplegit-progit/.git/</span><br><span class="line">got ca82a6dff817ec66f44342007202690a93763949</span><br><span class="line">walk ca82a6dff817ec66f44342007202690a93763949</span><br><span class="line">got 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7</span><br><span class="line">Getting alternates list for http://github.com/schacon/simplegit-progit.git</span><br><span class="line">Getting pack list for http://github.com/schacon/simplegit-progit.git</span><br><span class="line">Getting index for pack 816a9b2334da9953e530f27bcac22082a9f5b835</span><br><span class="line">Getting pack 816a9b2334da9953e530f27bcac22082a9f5b835</span><br><span class="line"> which contains cfda3bf379e4f8dba8717dee55aab78aef7f4daf</span><br><span class="line">walk 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7</span><br><span class="line">walk a11bef06a3f659402fe7563abf99ad00de2209e6</span><br></pre></td></tr></table></figure>

<h3 id="æ™ºèƒ½åè®®"><a href="#æ™ºèƒ½åè®®" class="headerlink" title="æ™ºèƒ½åè®®"></a>æ™ºèƒ½åè®®</h3><p>è¿™ä¸ªHTTPæ–¹æ³•æ˜¯å¾ˆç®€å•ä½†æ•ˆç‡ä¸æ˜¯å¾ˆé«˜ã€‚ä½¿ç”¨æ™ºèƒ½åè®®æ˜¯ä¼ é€æ•°æ®çš„æ›´å¸¸ç”¨çš„æ–¹æ³•ã€‚è¿™äº›åè®®åœ¨è¿œç«¯éƒ½æœ‰Gitæ™ºèƒ½å‹è¿›ç¨‹åœ¨æœåŠ¡ ï¼ å®ƒå¯ä»¥è¯»å‡ºæœ¬åœ°æ•°æ®å¹¶è®¡ç®—å‡ºå®¢æˆ·ç«¯æ‰€éœ€è¦çš„ï¼Œå¹¶ç”Ÿæˆåˆé€‚çš„æ•°æ®ç»™å®ƒï¼Œè¿™æœ‰ä¸¤ç±»ä¼ è¾“æ•°æ®çš„è¿›ç¨‹ï¼šä¸€å¯¹ç”¨äºä¸Šä¼ æ•°æ®å’Œä¸€å¯¹ç”¨äºä¸‹è½½ã€‚</p>
<h4 id="ä¸Šä¼ æ•°æ®"><a href="#ä¸Šä¼ æ•°æ®" class="headerlink" title="ä¸Šä¼ æ•°æ®"></a>ä¸Šä¼ æ•°æ®</h4><p>ä¸ºäº†ä¸Šä¼ æ•°æ®è‡³è¿œç«¯ï¼Œ Git ä½¿ç”¨ <code>send-pack</code> å’Œ <code>receive-pack</code> è¿›ç¨‹ã€‚è¿™ä¸ª <code>send-pack</code> è¿›ç¨‹è¿è¡Œåœ¨å®¢æˆ·ç«¯ä¸Šï¼Œå®ƒè¿æ¥è‡³è¿œç«¯è¿è¡Œçš„ <code>receive-pack</code> è¿›ç¨‹ã€‚</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œä½ åœ¨ä½ çš„é¡¹ç›®ä¸Šè¿è¡Œäº† <code>git push origin master</code>, å¹¶ä¸” <code>origin</code> è¢«å®šä¹‰ä¸ºä¸€ä¸ªä½¿ç”¨SSHåè®®çš„URLã€‚ Git ä¼šä½¿ç”¨ <code>send-pack</code> è¿›ç¨‹ï¼Œå®ƒä¼šå¯åŠ¨ä¸€ä¸ªåŸºäºSSHçš„è¿æ¥åˆ°æœåŠ¡å™¨ã€‚å®ƒå°è¯•åƒè¿™æ ·é€è¿‡SSHåœ¨æœåŠ¡ç«¯è¿è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -x git@github.com &quot;git-receive-pack &#x27;schacon/simplegit-progit.git&#x27;&quot;</span><br><span class="line">005bca82a6dff817ec66f4437202690a93763949 refs/heads/master report-status delete-refs</span><br><span class="line">003e085bb3bcb608e1e84b2432f8ecbe6306e7e7 refs/heads/topic</span><br><span class="line">0000</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ <code>git-receive-pack</code> å‘½ä»¤ä¼šç«‹å³å¯¹å®ƒæ‰€æ‹¥æœ‰çš„æ¯ä¸€ä¸ªå¼•ç”¨å“åº”ä¸€è¡Œ ï¼ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåªæœ‰ <code>master</code> åˆ†æ”¯å’Œå®ƒçš„SHAå€¼ã€‚è¿™é‡Œç¬¬1è¡Œä¹ŸåŒ…å«äº†æœåŠ¡ç«¯çš„èƒ½åŠ›åˆ—è¡¨ï¼ˆè¿™é‡Œæ˜¯ <code>report-status</code> å’Œ <code>delete-refs</code>ï¼‰ã€‚</p>
<p>æ¯ä¸€è¡Œä»¥4å­—èŠ‚çš„åå…­è¿›åˆ¶å¼€å§‹ï¼Œç”¨äºæŒ‡å®šæ•´è¡Œçš„é•¿åº¦ã€‚ä½ çœ‹åˆ°ç¬¬1è¡Œä»¥005bå¼€å§‹ï¼Œè¿™åœ¨åå…­è¿›åˆ¶ä¸­è¡¨ç¤º91ï¼Œæ„å‘³ç€ç¬¬1è¡Œæœ‰91å­—èŠ‚é•¿ã€‚ä¸‹ä¸€è¡Œä»¥003eèµ·å§‹ï¼Œè¡¨ç¤ºæœ‰62å­—èŠ‚é•¿ï¼Œæ‰€ä»¥éœ€è¦è¯»å‰©ä¸‹çš„62å­—èŠ‚ã€‚å†ä¸‹ä¸€è¡Œæ˜¯0000å¼€å§‹ï¼Œè¡¨ç¤ºæœåŠ¡å™¨å·²å®Œæˆäº†å¼•ç”¨åˆ—è¡¨è¿‡ç¨‹ã€‚</p>
<p>ç°åœ¨å®ƒçŸ¥é“äº†æœåŠ¡ç«¯çš„çŠ¶æ€ï¼Œä½ çš„ <code>send-pack</code> è¿›ç¨‹ä¼šåˆ¤æ–­å“ªäº› commit æ˜¯å®ƒæ‰€æ‹¥æœ‰ä½†æœåŠ¡ç«¯æ²¡æœ‰çš„ã€‚é’ˆå¯¹æ¯ä¸ªå¼•ç”¨ï¼Œè¿™æ¬¡æ¨é€éƒ½ä¼šå‘Šè¯‰å¯¹ç«¯çš„ <code>receive-pack</code> è¿™ä¸ªä¿¡æ¯ã€‚ä¸¾ä¾‹è¯´ï¼Œå¦‚æœä½ åœ¨æ›´æ–° <code>master</code> åˆ†æ”¯ï¼Œå¹¶ä¸”å¢åŠ  <code>experiment</code> åˆ†æ”¯ï¼Œè¿™ä¸ª <code>send-pack</code> å°†ä¼šæ˜¯åƒè¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0085ca82a6dff817ec66f44342007202690a93763949  15027957951b64cf874c3557a0f3547bd83b3ff6 refs/heads/master report-status</span><br><span class="line">00670000000000000000000000000000000000000000 cdfdb42577e2506715f8cfeacdbabc092bf63e8d refs/heads/experiment</span><br><span class="line">0000</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„å…¨â€™0â€™çš„SHA-1å€¼è¡¨ç¤ºä¹‹å‰æ²¡æœ‰è¿‡è¿™ä¸ªå¯¹è±¡ ï¼ å› ä¸ºä½ æ˜¯åœ¨æ·»åŠ æ–°çš„ experiment å¼•ç”¨ã€‚å¦‚æœä½ åœ¨åˆ é™¤ä¸€ä¸ªå¼•ç”¨ï¼Œä½ ä¼šçœ‹åˆ°ç›¸åçš„ï¼š å°±æ˜¯å³è¾¹æ˜¯å…¨â€™0â€™ã€‚</p>
<p>Git é’ˆå¯¹æ¯ä¸ªå¼•ç”¨å‘é€è¿™æ ·ä¸€è¡Œä¿¡æ¯ï¼Œå°±æ˜¯æ—§çš„SHAå€¼ï¼Œæ–°çš„SHAå€¼ï¼Œå’Œå°†è¦æ›´æ–°çš„å¼•ç”¨çš„åç§°ã€‚ç¬¬1è¡Œè¿˜ä¼šåŒ…å«æœ‰å®¢æˆ·ç«¯çš„èƒ½åŠ›ã€‚ä¸‹ä¸€æ­¥ï¼Œå®¢æˆ·ç«¯ä¼šå‘é€ä¸€ä¸ªæ‰€æœ‰é‚£äº›æœåŠ¡ç«¯æ‰€æ²¡æœ‰çš„å¯¹è±¡çš„ä¸€ä¸ªæ‰“åŒ…æ–‡ä»¶ã€‚æœ€åï¼ŒæœåŠ¡ç«¯ä»¥æˆåŠŸ(æˆ–è€…å¤±è´¥)æ¥å“åº”ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">000Aunpack ok</span><br></pre></td></tr></table></figure>

<h4 id="ä¸‹è½½æ•°æ®"><a href="#ä¸‹è½½æ•°æ®" class="headerlink" title="ä¸‹è½½æ•°æ®"></a>ä¸‹è½½æ•°æ®</h4><p>å½“ä½ åœ¨ä¸‹è½½æ•°æ®æ—¶ï¼Œ <code>fetch-pack</code> å’Œ <code>upload-pack</code> è¿›ç¨‹å°±èµ·ä½œç”¨äº†ã€‚å®¢æˆ·ç«¯å¯åŠ¨ <code>fetch-pack</code> è¿›ç¨‹ï¼Œè¿æ¥è‡³è¿œç«¯çš„ <code>upload-pack</code> è¿›ç¨‹ï¼Œä»¥åå•†åç»­æ•°æ®ä¼ è¾“è¿‡ç¨‹ã€‚</p>
<p>åœ¨è¿œç«¯ä»“åº“æœ‰ä¸åŒçš„æ–¹å¼å¯åŠ¨ <code>upload-pack</code> è¿›ç¨‹ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸ <code>receive-pack</code> ç›¸åŒçš„é€è¿‡SSHç®¡é“çš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Git åå°æ¥å¯åŠ¨è¿™ä¸ªè¿›ç¨‹ï¼Œå®ƒé»˜è®¤ç›‘å¬åœ¨9418å·ç«¯å£ä¸Šã€‚è¿™é‡Œ <code>fetch-pack</code> è¿›ç¨‹åœ¨è¿æ¥ååƒè¿™æ ·å‘åå°å‘é€æ•°æ®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">003fgit-upload-pack schacon/simplegit-progit.git\0host=myserver.com\0</span><br></pre></td></tr></table></figure>

<p>å®ƒä¹Ÿæ˜¯ä»¥4å­—èŠ‚æŒ‡å®šåç»­å­—èŠ‚é•¿åº¦çš„æ–¹å¼å¼€å§‹ï¼Œç„¶åæ˜¯è¦è¿è¡Œçš„å‘½ä»¤ï¼Œå’Œä¸€ä¸ªç©ºå­—èŠ‚ï¼Œç„¶åæ˜¯æœåŠ¡ç«¯çš„ä¸»æœºåï¼Œå†è·Ÿéšä¸€ä¸ªæœ€åçš„ç©ºå­—èŠ‚ã€‚ Git åå°è¿›ç¨‹ä¼šæ£€æŸ¥è¿™ä¸ªå‘½ä»¤æ˜¯å¦å¯ä»¥è¿è¡Œï¼Œä»¥åŠé‚£ä¸ªä»“åº“æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠæ˜¯å¦å…·æœ‰å…¬å¼€æƒé™ã€‚å¦‚æœæ‰€æœ‰æ£€æŸ¥éƒ½é€šè¿‡äº†ï¼Œå®ƒä¼šå¯åŠ¨è¿™ä¸ª <code>upload-pack</code> è¿›ç¨‹å¹¶å°†å®¢æˆ·ç«¯çš„è¯·æ±‚ç§»äº¤ç»™å®ƒã€‚</p>
<p>å¦‚æœä½ é€è¿‡SSHä½¿ç”¨è·å–åŠŸèƒ½ï¼Œ <code>fetch-pack</code> ä¼šåƒè¿™æ ·è¿è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -x git@github.com &quot;git-upload-pack &#x27;schacon/simplegit-progit.git&#x27;&quot;</span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡å“ªç§æ–¹å¼ï¼Œåœ¨ <code>fetch-pack</code> è¿æ¥ä¹‹åï¼Œ <code>upload-pack</code> éƒ½ä¼šä»¥è¿™ç§å½¢å¼è¿”å›ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0088ca82a6dff817ec66f44342007202690a93763949 HEAD\0multi_ack thin-pack \</span><br><span class="line">  side-band side-band-64k ofs-delta shallow no-progress include-tag</span><br><span class="line">003fca82a6dff817ec66f44342007202690a93763949 refs/heads/master</span><br><span class="line">003e085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7 refs/heads/topic</span><br><span class="line">0000</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ <code>receive-pack</code> å“åº”å¾ˆç±»ä¼¼ï¼Œä½†æ˜¯è¿™é‡ŒæŒ‡çš„èƒ½åŠ›æ˜¯ä¸åŒçš„ã€‚è€Œä¸”å®ƒè¿˜ä¼šæŒ‡å‡ºHEADå¼•ç”¨ï¼Œè®©å®¢æˆ·ç«¯å¯ä»¥æ£€æŸ¥æ˜¯å¦æ˜¯ä¸€ä»½å…‹éš†ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œ <code>fetch-pack</code> è¿›ç¨‹æ£€æŸ¥å®ƒè‡ªå·±æ‰€æ‹¥æœ‰çš„å¯¹è±¡å’Œæ‰€æœ‰å®ƒéœ€è¦çš„å¯¹è±¡ï¼Œé€šè¿‡å‘é€ â€œwantâ€ å’Œæ‰€éœ€å¯¹è±¡çš„SHAå€¼ï¼Œå‘é€ â€œhaveâ€ å’Œæ‰€æœ‰å®ƒå·²æ‹¥æœ‰çš„å¯¹è±¡çš„SHAå€¼ã€‚åœ¨åˆ—è¡¨å®Œæˆæ—¶ï¼Œå†å‘é€ â€œdoneâ€ é€šçŸ¥ <code>upload-pack</code> è¿›ç¨‹å¼€å§‹å‘é€æ‰€éœ€å¯¹è±¡çš„æ‰“åŒ…æ–‡ä»¶ã€‚è¿™ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0054want ca82a6dff817ec66f44342007202690a93763949 ofs-delta</span><br><span class="line">0032have 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7</span><br><span class="line">0000</span><br><span class="line">0009done</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¼ è¾“åè®®çš„ä¸€ä¸ªå¾ˆåŸºç¡€çš„ä¾‹å­ï¼Œåœ¨æ›´å¤æ‚çš„ä¾‹å­ä¸­ï¼Œå®¢æˆ·ç«¯å¯èƒ½ä¼šæ”¯æŒ <code>multi_ack</code> æˆ–è€… <code>side-band</code> èƒ½åŠ›ï¼›ä½†æ˜¯è¿™ä¸ªä¾‹å­ä¸­å±•ç¤ºäº†æ™ºèƒ½åè®®çš„åŸºæœ¬äº¤äº’è¿‡ç¨‹ã€‚</p>
<h2 id="ç»´æŠ¤åŠæ•°æ®æ¢å¤"><a href="#ç»´æŠ¤åŠæ•°æ®æ¢å¤" class="headerlink" title="ç»´æŠ¤åŠæ•°æ®æ¢å¤"></a>ç»´æŠ¤åŠæ•°æ®æ¢å¤</h2><p>ä½ æ—¶ä¸æ—¶çš„éœ€è¦è¿›è¡Œä¸€äº›æ¸…ç†å·¥ä½œ â”€â”€ å¦‚å‡å°ä¸€ä¸ªä»“åº“çš„å¤§å°ï¼Œæ¸…ç†å¯¼å…¥çš„åº“ï¼Œæˆ–æ˜¯æ¢å¤ä¸¢å¤±çš„æ•°æ®ã€‚æœ¬èŠ‚å°†æè¿°è¿™ç±»ä½¿ç”¨åœºæ™¯ã€‚</p>
<h3 id="ç»´æŠ¤"><a href="#ç»´æŠ¤" class="headerlink" title="ç»´æŠ¤"></a>ç»´æŠ¤</h3><p>Git ä¼šä¸å®šæ—¶åœ°è‡ªåŠ¨è¿è¡Œç§°ä¸º â€œauto gcâ€ çš„å‘½ä»¤ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¯¥å‘½ä»¤ä»€ä¹ˆéƒ½ä¸å¤„ç†ã€‚ä¸è¿‡è¦æ˜¯å­˜åœ¨å¤ªå¤šæ¾æ•£å¯¹è±¡ (loose object, ä¸åœ¨ packfile ä¸­çš„å¯¹è±¡) æˆ– packfileï¼ŒGit ä¼šè¿›è¡Œè°ƒç”¨ <code>git gc</code> å‘½ä»¤ã€‚ <code>gc</code> æŒ‡åƒåœ¾æ”¶é›† (garbage collect)ï¼Œæ­¤å‘½ä»¤ä¼šåšå¾ˆå¤šå·¥ä½œï¼šæ”¶é›†æ‰€æœ‰æ¾æ•£å¯¹è±¡å¹¶å°†å®ƒä»¬å­˜å…¥ packfileï¼Œåˆå¹¶è¿™äº› packfile è¿›ä¸€ä¸ªå¤§çš„ packfileï¼Œç„¶åå°†ä¸è¢«ä»»ä½• commit å¼•ç”¨å¹¶ä¸”å·²å­˜åœ¨ä¸€æ®µæ—¶é—´ (æ•°æœˆ) çš„å¯¹è±¡åˆ é™¤ã€‚</p>
<p>å¯ä»¥æ‰‹å·¥è¿è¡Œ auto gc å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git gc --auto</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡å¼ºè°ƒï¼Œè¿™ä¸ªå‘½ä»¤ä¸€èˆ¬ä»€ä¹ˆéƒ½ä¸å¹²ã€‚å¦‚æœæœ‰ 7,000 ä¸ªå·¦å³çš„æ¾æ•£å¯¹è±¡æˆ–æ˜¯ 50 ä¸ªä»¥ä¸Šçš„ packfileï¼ŒGit æ‰ä¼šçœŸæ­£è°ƒç”¨ gc å‘½ä»¤ã€‚å¯èƒ½é€šè¿‡ä¿®æ”¹é…ç½®ä¸­çš„ <code>gc.auto</code> å’Œ <code>gc.autopacklimit</code> æ¥è°ƒæ•´è¿™ä¸¤ä¸ªé˜ˆå€¼ã€‚</p>
<p><code>gc</code> è¿˜ä¼šå°†æ‰€æœ‰å¼•ç”¨ (references) å¹¶å…¥ä¸€ä¸ªå•ç‹¬æ–‡ä»¶ã€‚å‡è®¾ä»“åº“ä¸­åŒ…å«ä»¥ä¸‹åˆ†æ”¯å’Œæ ‡ç­¾ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/refs -type f</span><br><span class="line">.git/refs/heads/experiment</span><br><span class="line">.git/refs/heads/master</span><br><span class="line">.git/refs/tags/v1.0</span><br><span class="line">.git/refs/tags/v1.1</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å¦‚æœè¿è¡Œ <code>git gc</code>, <code>refs</code> ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šæ¶ˆå¤±ã€‚Git ä¼šå°†è¿™äº›æ–‡ä»¶æŒªåˆ° <code>.git/packed-refs</code> æ–‡ä»¶ä¸­å»ä»¥æé«˜æ•ˆç‡ï¼Œè¯¥æ–‡ä»¶æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/packed-refs</span><br><span class="line"># pack-refs with: peeled</span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d refs/heads/experiment</span><br><span class="line">ab1afef80fac8e34258ff41fc1b867c702daa24b refs/heads/master</span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d refs/tags/v1.0</span><br><span class="line">9585191f37f7b0fb9444f35a9bf50de191beadc2 refs/tags/v1.1</span><br><span class="line">^1a410efbd13591db07496601ebc7a059dd55cfe9</span><br></pre></td></tr></table></figure>

<p>å½“æ›´æ–°ä¸€ä¸ªå¼•ç”¨æ—¶ï¼ŒGit ä¸ä¼šä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨ <code>refs/heads</code> ä¸‹å†™å…¥ä¸€ä¸ªæ–°æ–‡ä»¶ã€‚å½“æŸ¥æ‰¾ä¸€ä¸ªå¼•ç”¨çš„ SHA æ—¶ï¼ŒGit é¦–å…ˆåœ¨ <code>refs</code> ç›®å½•ä¸‹æŸ¥æ‰¾ï¼Œå¦‚æœæœªæ‰¾åˆ°åˆ™åˆ° <code>packed-refs</code> æ–‡ä»¶ä¸­å»æŸ¥æ‰¾ã€‚å› æ­¤å¦‚æœåœ¨ <code>refs</code> ç›®å½•ä¸‹æ‰¾ä¸åˆ°ä¸€ä¸ªå¼•ç”¨ï¼Œè¯¥å¼•ç”¨å¯èƒ½å­˜åˆ° <code>packed-refs</code> æ–‡ä»¶ä¸­å»äº†ã€‚</p>
<p>è¯·ç•™æ„æ–‡ä»¶æœ€åä»¥ <code>^</code> å¼€å¤´çš„é‚£ä¸€è¡Œã€‚è¿™è¡¨ç¤ºè¯¥è¡Œä¸Šä¸€è¡Œçš„é‚£ä¸ªæ ‡ç­¾æ˜¯ä¸€ä¸ª annotated æ ‡ç­¾ï¼Œè€Œè¯¥è¡Œæ­£æ˜¯é‚£ä¸ªæ ‡ç­¾æ‰€æŒ‡å‘çš„ commit ã€‚</p>
<h3 id="æ•°æ®æ¢å¤"><a href="#æ•°æ®æ¢å¤" class="headerlink" title="æ•°æ®æ¢å¤"></a>æ•°æ®æ¢å¤</h3><p>åœ¨ä½¿ç”¨ Git çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶ä¼šä¸å°å¿ƒä¸¢å¤± commit ä¿¡æ¯ã€‚è¿™ä¸€èˆ¬å‡ºç°åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼šå¼ºåˆ¶åˆ é™¤äº†ä¸€ä¸ªåˆ†æ”¯è€Œååˆæƒ³é‡æ–°ä½¿ç”¨è¿™ä¸ªåˆ†æ”¯ï¼Œhard-reset äº†ä¸€ä¸ªåˆ†æ”¯ä»è€Œä¸¢å¼ƒäº†åˆ†æ”¯çš„éƒ¨åˆ† commitã€‚å¦‚æœè¿™çœŸçš„å‘ç”Ÿäº†ï¼Œæœ‰ä»€ä¹ˆåŠæ³•æŠŠä¸¢å¤±çš„ commit æ‰¾å›æ¥å‘¢ï¼Ÿ</p>
<p>ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†å¯¹ test ä»“åº“ä¸»åˆ†æ”¯è¿›è¡Œ hard-reset åˆ°ä¸€ä¸ªè€ç‰ˆæœ¬çš„ commit çš„æ“ä½œï¼Œç„¶åæ¢å¤ä¸¢å¤±çš„ commit ã€‚é¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹å½“å‰çš„ä»“åº“çŠ¶æ€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git log --pretty=oneline</span><br><span class="line">ab1afef80fac8e34258ff41fc1b867c702daa24b modified repo a bit</span><br><span class="line">484a59275031909e19aadb7c92262719cfcdf19a added repo.rb</span><br><span class="line">1a410efbd13591db07496601ebc7a059dd55cfe9 third commit</span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d second commit</span><br><span class="line">fdf4fc3344e67ab068f836878b6c4951e3b15f3d first commit</span><br></pre></td></tr></table></figure>

<p>æ¥ç€å°† <code>master</code> åˆ†æ”¯ç§»å›è‡³ä¸­é—´çš„ä¸€ä¸ª commitï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard 1a410efbd13591db07496601ebc7a059dd55cfe9</span><br><span class="line">HEAD is now at 1a410ef third commit</span><br><span class="line">$ git log --pretty=oneline</span><br><span class="line">1a410efbd13591db07496601ebc7a059dd55cfe9 third commit</span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d second commit</span><br><span class="line">fdf4fc3344e67ab068f836878b6c4951e3b15f3d first commit</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±ä¸¢å¼ƒäº†æœ€æ–°çš„ä¸¤ä¸ª commit â”€â”€ åŒ…å«è¿™ä¸¤ä¸ª commit çš„åˆ†æ”¯ä¸å­˜åœ¨äº†ã€‚ç°åœ¨è¦åšçš„æ˜¯æ‰¾å‡ºæœ€æ–°çš„é‚£ä¸ª commit çš„ SHAï¼Œç„¶åæ·»åŠ ä¸€ä¸ªæŒ‡å®ƒå®ƒçš„åˆ†æ”¯ã€‚å…³é”®åœ¨äºæ‰¾å‡ºæœ€æ–°çš„ commit çš„ SHA â”€â”€ ä½ ä¸å¤§å¯èƒ½è®°ä½äº†è¿™ä¸ª SHAï¼Œæ˜¯å§ï¼Ÿ</p>
<p>é€šå¸¸æœ€å¿«æ·çš„åŠæ³•æ˜¯ä½¿ç”¨ <code>git reflog</code> å·¥å…·ã€‚å½“ä½  (åœ¨ä¸€ä¸ªä»“åº“ä¸‹) å·¥ä½œæ—¶ï¼ŒGit ä¼šåœ¨ä½ æ¯æ¬¡ä¿®æ”¹äº† HEAD æ—¶æ‚„æ‚„åœ°å°†æ”¹åŠ¨è®°å½•ä¸‹æ¥ã€‚å½“ä½ æäº¤æˆ–ä¿®æ”¹åˆ†æ”¯æ—¶ï¼Œreflog å°±ä¼šæ›´æ–°ã€‚<code>git update-ref</code> å‘½ä»¤ä¹Ÿå¯ä»¥æ›´æ–° reflogï¼Œè¿™æ˜¯åœ¨æœ¬ç« å‰é¢çš„ â€œGit Referencesâ€ éƒ¨åˆ†æˆ‘ä»¬ä½¿ç”¨è¯¥å‘½ä»¤è€Œä¸æ˜¯æ‰‹å·¥å°† SHA å€¼å†™å…¥ ref æ–‡ä»¶çš„ç†ç”±ã€‚ä»»ä½•æ—¶é—´è¿è¡Œ <code>git reflog</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰çš„çŠ¶æ€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git reflog</span><br><span class="line">1a410ef HEAD@&#123;0&#125;: 1a410efbd13591db07496601ebc7a059dd55cfe9: updating HEAD</span><br><span class="line">ab1afef HEAD@&#123;1&#125;: ab1afef80fac8e34258ff41fc1b867c702daa24b: updating HEAD</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç­¾å‡ºçš„ä¸¤ä¸ª commit ï¼Œä½†æ²¡æœ‰æ›´å¤šçš„ç›¸å…³ä¿¡æ¯ã€‚è¿è¡Œ <code>git log -g</code> ä¼šè¾“å‡º reflog çš„æ­£å¸¸æ—¥å¿—ï¼Œä»è€Œæ˜¾ç¤ºæ›´å¤šæœ‰ç”¨ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ git log -g</span><br><span class="line">commit 1a410efbd13591db07496601ebc7a059dd55cfe9</span><br><span class="line">Reflog: HEAD@&#123;0&#125; (Scott Chacon &lt;schacon@gmail.com&gt;)</span><br><span class="line">Reflog message: updating HEAD</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Fri May 22 18:22:37 2009 -0700</span><br><span class="line"></span><br><span class="line">    third commit</span><br><span class="line"></span><br><span class="line">commit ab1afef80fac8e34258ff41fc1b867c702daa24b</span><br><span class="line">Reflog: HEAD@&#123;1&#125; (Scott Chacon &lt;schacon@gmail.com&gt;)</span><br><span class="line">Reflog message: updating HEAD</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Fri May 22 18:15:24 2009 -0700</span><br><span class="line"></span><br><span class="line">     modified repo a bit</span><br></pre></td></tr></table></figure>

<p>çœ‹èµ·æ¥å¼„ä¸¢äº†çš„ commit æ˜¯åº•ä¸‹é‚£ä¸ªï¼Œè¿™æ ·åœ¨é‚£ä¸ª commit ä¸Šåˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯å°±èƒ½æŠŠå®ƒæ¢å¤è¿‡æ¥ã€‚æ¯”æ–¹è¯´ï¼Œå¯ä»¥åœ¨é‚£ä¸ª commit (ab1afef) ä¸Šåˆ›å»ºä¸€ä¸ªåä¸º <code>recover-branch</code> çš„åˆ†æ”¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git branch recover-branch ab1afef</span><br><span class="line">$ git log --pretty=oneline recover-branch</span><br><span class="line">ab1afef80fac8e34258ff41fc1b867c702daa24b modified repo a bit</span><br><span class="line">484a59275031909e19aadb7c92262719cfcdf19a added repo.rb</span><br><span class="line">1a410efbd13591db07496601ebc7a059dd55cfe9 third commit</span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d second commit</span><br><span class="line">fdf4fc3344e67ab068f836878b6c4951e3b15f3d first commit</span><br></pre></td></tr></table></figure>

<p>é…·ï¼è¿™æ ·æœ‰äº†ä¸€ä¸ªè·ŸåŸæ¥ <code>master</code> ä¸€æ ·çš„ <code>recover-branch</code> åˆ†æ”¯ï¼Œæœ€æ–°çš„ä¸¤ä¸ª commit åˆæ‰¾å›æ¥äº†ã€‚æ¥ç€ï¼Œå‡è®¾å¼•èµ· commit ä¸¢å¤±çš„åŸå› å¹¶æ²¡æœ‰è®°å½•åœ¨ reflog ä¸­ â”€â”€ å¯ä»¥é€šè¿‡åˆ é™¤ <code>recover-branch</code> å’Œ reflog æ¥æ¨¡æ‹Ÿè¿™ç§æƒ…å†µã€‚è¿™æ ·æœ€æ–°çš„ä¸¤ä¸ª commit ä¸ä¼šè¢«ä»»ä½•ä¸œè¥¿å¼•ç”¨åˆ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -D recover-branch</span><br><span class="line">$ rm -Rf .git/logs/</span><br></pre></td></tr></table></figure>

<p>å› ä¸º reflog æ•°æ®æ˜¯ä¿å­˜åœ¨ <code>.git/logs/</code> ç›®å½•ä¸‹çš„ï¼Œè¿™æ ·å°±æ²¡æœ‰ reflog äº†ã€‚ç°åœ¨è¦æ€æ ·æ¢å¤ commit å‘¢ï¼ŸåŠæ³•ä¹‹ä¸€æ˜¯ä½¿ç”¨ <code>git fsck</code> å·¥å…·ï¼Œè¯¥å·¥å…·ä¼šæ£€æŸ¥ä»“åº“çš„æ•°æ®å®Œæ•´æ€§ã€‚å¦‚æœæŒ‡å®š <code>--full</code> é€‰é¡¹ï¼Œè¯¥å‘½ä»¤æ˜¾ç¤ºæ‰€æœ‰æœªè¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ (æŒ‡å‘) çš„æ‰€æœ‰å¯¹è±¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git fsck --full</span><br><span class="line">dangling blob d670460b4b4aece5915caf5c68d12f560a9fe3e4</span><br><span class="line">dangling commit ab1afef80fac8e34258ff41fc1b867c702daa24b</span><br><span class="line">dangling tree aea790b9a58f6cf6f2804eeac9f0abbe9631e4c9</span><br><span class="line">dangling blob 7108f7ecb345ee9d0084193f147cdad4d2998293</span><br></pre></td></tr></table></figure>

<p>æœ¬ä¾‹ä¸­ï¼Œå¯ä»¥ä» dangling commit æ‰¾åˆ°ä¸¢å¤±äº†çš„ commitã€‚ç”¨ç›¸åŒçš„æ–¹æ³•å°±å¯ä»¥æ¢å¤å®ƒï¼Œå³åˆ›å»ºä¸€ä¸ªæŒ‡å‘è¯¥ SHA çš„åˆ†æ”¯ã€‚</p>
<h3 id="ç§»é™¤å¯¹è±¡"><a href="#ç§»é™¤å¯¹è±¡" class="headerlink" title="ç§»é™¤å¯¹è±¡"></a>ç§»é™¤å¯¹è±¡</h3><p>Git æœ‰è®¸å¤šè¿‡äººä¹‹å¤„ï¼Œä¸è¿‡æœ‰ä¸€ä¸ªåŠŸèƒ½æœ‰æ—¶å´ä¼šå¸¦æ¥é—®é¢˜ï¼š<code>git clone</code> ä¼šå°†åŒ…å«æ¯ä¸€ä¸ªæ–‡ä»¶çš„æ‰€æœ‰å†å²ç‰ˆæœ¬çš„æ•´ä¸ªé¡¹ç›®ä¸‹è½½ä¸‹æ¥ã€‚å¦‚æœé¡¹ç›®åŒ…å«çš„ä»…ä»…æ˜¯æºä»£ç çš„è¯è¿™å¹¶æ²¡æœ‰ä»€ä¹ˆåå¤„ï¼Œæ¯•ç«Ÿ Git å¯ä»¥éå¸¸é«˜æ•ˆåœ°å‹ç¼©æ­¤ç±»æ•°æ®ã€‚ä¸è¿‡å¦‚æœæœ‰äººåœ¨æŸä¸ªæ—¶åˆ»å¾€é¡¹ç›®ä¸­æ·»åŠ äº†ä¸€ä¸ªéå¸¸å¤§çš„æ–‡ä»¶ï¼Œé‚£ä»¬å³ä¾¿ä»–åœ¨åæ¥çš„æäº¤ä¸­å°†æ­¤æ–‡ä»¶åˆ æ‰äº†ï¼Œæ‰€æœ‰çš„ç­¾å‡ºéƒ½ä¼šä¸‹è½½è¿™ä¸ªå¤§æ–‡ä»¶ã€‚å› ä¸ºå†å²è®°å½•ä¸­å¼•ç”¨äº†è¿™ä¸ªæ–‡ä»¶ï¼Œå®ƒä¼šä¸€ç›´å­˜åœ¨ç€ã€‚</p>
<p>å½“ä½ å°† Subversion æˆ– Perforce ä»“åº“è½¬æ¢å¯¼å…¥è‡³ Git æ—¶è¿™ä¼šæˆä¸ºä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ã€‚åœ¨æ­¤ç±»ç³»ç»Ÿä¸­ï¼Œ(ç­¾å‡ºæ—¶) ä¸ä¼šä¸‹è½½æ•´ä¸ªä»“åº“å†å²ï¼Œæ‰€ä»¥è¿™ç§æƒ…å½¢ä¸å¤§ä¼šæœ‰ä¸è‰¯åæœã€‚å¦‚æœä½ ä»å…¶ä»–ç³»ç»Ÿå¯¼å…¥äº†ä¸€ä¸ªä»“åº“ï¼Œæˆ–æ˜¯å‘è§‰ä¸€ä¸ªä»“åº“çš„å°ºå¯¸è¿œè¶…å‡ºé¢„è®¡ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•æ‰¾åˆ°å¹¶ç§»é™¤å¤§ (å°ºå¯¸) å¯¹è±¡ã€‚</p>
<p>è­¦å‘Šï¼šæ­¤æ–¹æ³•ä¼šç ´åæäº¤å†å²ã€‚ä¸ºäº†ç§»é™¤å¯¹ä¸€ä¸ªå¤§æ–‡ä»¶çš„å¼•ç”¨ï¼Œä»æœ€æ—©åŒ…å«è¯¥å¼•ç”¨çš„ tree å¯¹è±¡å¼€å§‹ä¹‹åçš„æ‰€æœ‰ commit å¯¹è±¡éƒ½ä¼šè¢«é‡å†™ã€‚å¦‚æœåœ¨åˆšå¯¼å…¥ä¸€ä¸ªä»“åº“å¹¶åœ¨å…¶ä»–äººåœ¨æ­¤åŸºç¡€ä¸Šå¼€å§‹å·¥ä½œä¹‹å‰è¿™ä¹ˆåšï¼Œé‚£æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ â”€â”€ å¦åˆ™ä½ ä¸å¾—ä¸é€šçŸ¥æ‰€æœ‰åä½œè€… (è´¡çŒ®è€…) å»è¡åˆä½ æ–°ä¿®æ”¹çš„ commit ã€‚</p>
<p>ä¸ºäº†æ¼”ç¤ºè¿™ç‚¹ï¼Œå¾€ test ä»“åº“ä¸­åŠ å…¥ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œç„¶ååœ¨ä¸‹æ¬¡æäº¤æ—¶å°†å®ƒåˆ é™¤ï¼Œæ¥ç€æ‰¾åˆ°å¹¶å°†è¿™ä¸ªæ–‡ä»¶ä»ä»“åº“ä¸­æ°¸ä¹…åˆ é™¤ã€‚é¦–å…ˆï¼ŒåŠ ä¸€ä¸ªå¤§æ–‡ä»¶è¿›å»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://kernel.org/pub/software/scm/git/git-1.6.3.1.tar.bz2 &gt; git.tbz2</span><br><span class="line">$ git add git.tbz2</span><br><span class="line">$ git commit -am &#x27;added git tarball&#x27;</span><br><span class="line">[master 6df7640] added git tarball</span><br><span class="line"> 1 files changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 git.tbz2</span><br></pre></td></tr></table></figure>

<p>å–”ï¼Œä½ å¹¶ä¸æƒ³å¾€é¡¹ç›®ä¸­åŠ è¿›ä¸€ä¸ªè¿™ä¹ˆå¤§çš„ tar åŒ…ã€‚æœ€åè¿˜æ˜¯å»æ‰å®ƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git rm git.tbz2</span><br><span class="line">rm &#x27;git.tbz2&#x27;</span><br><span class="line">$ git commit -m &#x27;oops - removed large tarball&#x27;</span><br><span class="line">[master da3f30d] oops - removed large tarball</span><br><span class="line"> 1 files changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> delete mode 100644 git.tbz2</span><br></pre></td></tr></table></figure>

<p>å¯¹ä»“åº“è¿›è¡Œ <code>gc</code> æ“ä½œï¼Œå¹¶æŸ¥çœ‹å ç”¨äº†ç©ºé—´ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git gc</span><br><span class="line">Counting objects: 21, done.</span><br><span class="line">Delta compression using 2 threads.</span><br><span class="line">Compressing objects: 100% (16/16), done.</span><br><span class="line">Writing objects: 100% (21/21), done.</span><br><span class="line">Total 21 (delta 3), reused 15 (delta 1)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è¿è¡Œ <code>count-objects</code> ä»¥æŸ¥çœ‹ä½¿ç”¨äº†å¤šå°‘ç©ºé—´ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git count-objects -v</span><br><span class="line">count: 4</span><br><span class="line">size: 16</span><br><span class="line">in-pack: 21</span><br><span class="line">packs: 1</span><br><span class="line">size-pack: 2016</span><br><span class="line">prune-packable: 0</span><br><span class="line">garbage: 0</span><br></pre></td></tr></table></figure>

<p><code>size-pack</code> æ˜¯ä»¥åƒå­—èŠ‚ä¸ºå•ä½è¡¨ç¤ºçš„ packfiles çš„å¤§å°ï¼Œå› æ­¤å·²ç»ä½¿ç”¨äº† 2MB ã€‚è€Œåœ¨è¿™æ¬¡æäº¤ä¹‹å‰ä»…ç”¨äº† 2K å·¦å³ â”€â”€ æ˜¾ç„¶åœ¨è¿™æ¬¡æäº¤æ—¶åˆ é™¤æ–‡ä»¶å¹¶æ²¡æœ‰çœŸæ­£å°†å…¶ä»å†å²è®°å½•ä¸­åˆ é™¤ã€‚æ¯å½“æœ‰äººå¤åˆ¶è¿™ä¸ªä»“åº“å»å–å¾—è¿™ä¸ªå°é¡¹ç›®æ—¶ï¼Œéƒ½ä¸å¾—ä¸å¤åˆ¶æ‰€æœ‰ 2MB æ•°æ®ï¼Œè€Œè¿™ä»…ä»…å› ä¸ºä½ æ›¾ç»ä¸å°å¿ƒåŠ äº†ä¸ªå¤§æ–‡ä»¶ã€‚å½“æˆ‘ä»¬æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>é¦–å…ˆè¦æ‰¾å‡ºè¿™ä¸ªæ–‡ä»¶ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œä½ çŸ¥é“æ˜¯å“ªä¸ªæ–‡ä»¶ã€‚å‡è®¾ä½ å¹¶ä¸çŸ¥é“è¿™ä¸€ç‚¹ï¼Œè¦å¦‚ä½•æ‰¾å‡ºå“ªä¸ª (äº›) æ–‡ä»¶å ç”¨äº†è¿™ä¹ˆå¤šçš„ç©ºé—´ï¼Ÿå¦‚æœè¿è¡Œ <code>git gc</code>ï¼Œæ‰€æœ‰å¯¹è±¡ä¼šå­˜å…¥ä¸€ä¸ª packfile æ–‡ä»¶ï¼›è¿è¡Œå¦ä¸€ä¸ªåº•å±‚å‘½ä»¤ <code>git verify-pack</code> ä»¥è¯†åˆ«å‡ºå¤§å¯¹è±¡ï¼Œå¯¹è¾“å‡ºçš„ç¬¬ä¸‰åˆ—ä¿¡æ¯å³æ–‡ä»¶å¤§å°è¿›è¡Œæ’åºï¼Œè¿˜å¯ä»¥å°†è¾“å‡ºå®šå‘åˆ° <code>tail</code> å‘½ä»¤ï¼Œå› ä¸ºä½ åªå…³å¿ƒæ’åœ¨æœ€åçš„é‚£å‡ ä¸ªæœ€å¤§çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git verify-pack -v .git/objects/pack/pack-3f8c0...bb.idx | sort -k 3 -n | tail -3</span><br><span class="line">e3f094f522629ae358806b17daf78246c27c007b blob   1486 734 4667</span><br><span class="line">05408d195263d853f09dca71d55116663690c27c blob   12908 3478 1189</span><br><span class="line">7a9eb2fba2b1811321254ac360970fc169ba2330 blob   2056716 2056872 5401</span><br></pre></td></tr></table></figure>

<p>æœ€åº•ä¸‹é‚£ä¸ªå°±æ˜¯é‚£ä¸ªå¤§æ–‡ä»¶ï¼š2MB ã€‚è¦æŸ¥çœ‹è¿™åˆ°åº•æ˜¯å“ªä¸ªæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ 7 ç« ä¸­å·²ç»ç®€å•ä½¿ç”¨è¿‡çš„ <code>rev-list</code> å‘½ä»¤ã€‚è‹¥ç»™ <code>rev-list</code> å‘½ä»¤ä¼ å…¥ <code>--objects</code> é€‰é¡¹ï¼Œå®ƒä¼šåˆ—å‡ºæ‰€æœ‰ commit SHA å€¼ï¼Œblob SHA å€¼åŠç›¸åº”çš„æ–‡ä»¶è·¯å¾„ã€‚å¯ä»¥è¿™æ ·æŸ¥çœ‹ blob çš„æ–‡ä»¶åï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git rev-list --objects --all | grep 7a9eb2fb</span><br><span class="line">7a9eb2fba2b1811321254ac360970fc169ba2330 git.tbz2</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥è¦å°†è¯¥æ–‡ä»¶ä»å†å²è®°å½•çš„æ‰€æœ‰ tree ä¸­ç§»é™¤ã€‚å¾ˆå®¹æ˜“æ‰¾å‡ºå“ªäº› commit ä¿®æ”¹äº†è¿™ä¸ªæ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git log --pretty=oneline --branches -- git.tbz2</span><br><span class="line">da3f30d019005479c99eb4c3406225613985a1db oops - removed large tarball</span><br><span class="line">6df764092f3e7c8f5f94cbe08ee5cf42e92a0289 added git tarball</span><br></pre></td></tr></table></figure>

<p>å¿…é¡»é‡å†™ä» <code>6df76</code> å¼€å§‹çš„æ‰€æœ‰ commit æ‰èƒ½å°†æ–‡ä»¶ä» Git å†å²ä¸­å®Œå…¨ç§»é™¤ã€‚è¿™ä¹ˆåšéœ€è¦ç”¨åˆ°ç¬¬ 6 ç« ä¸­ç”¨è¿‡çš„ <code>filter-branch</code> å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git filter-branch --index-filter \</span><br><span class="line">   &#x27;git rm --cached --ignore-unmatch git.tbz2&#x27; -- 6df7640^..</span><br><span class="line">Rewrite 6df764092f3e7c8f5f94cbe08ee5cf42e92a0289 (1/2)rm &#x27;git.tbz2&#x27;</span><br><span class="line">Rewrite da3f30d019005479c99eb4c3406225613985a1db (2/2)</span><br><span class="line">Ref &#x27;refs/heads/master&#x27; was rewritten</span><br></pre></td></tr></table></figure>

<p><code>--index-filter</code> é€‰é¡¹ç±»ä¼¼äºç¬¬ 6 ç« ä¸­ä½¿ç”¨çš„ <code>--tree-filter</code> é€‰é¡¹ï¼Œä½†è¿™é‡Œä¸æ˜¯ä¼ å…¥ä¸€ä¸ªå‘½ä»¤å»ä¿®æ”¹ç£ç›˜ä¸Šç­¾å‡ºçš„æ–‡ä»¶ï¼Œè€Œæ˜¯ä¿®æ”¹æš‚å­˜åŒºåŸŸæˆ–ç´¢å¼•ã€‚ä¸èƒ½ç”¨ <code>rm file</code> å‘½ä»¤æ¥åˆ é™¤ä¸€ä¸ªç‰¹å®šæ–‡ä»¶ï¼Œè€Œæ˜¯å¿…é¡»ç”¨ <code>git rm --cached</code> æ¥åˆ é™¤å®ƒ â”€â”€ å³ä»ç´¢å¼•è€Œä¸æ˜¯ç£ç›˜åˆ é™¤å®ƒã€‚è¿™æ ·åšæ˜¯å‡ºäºé€Ÿåº¦è€ƒè™‘ â”€â”€ ç”±äº Git åœ¨è¿è¡Œä½ çš„ filter ä¹‹å‰æ— éœ€å°†æ‰€æœ‰ç‰ˆæœ¬ç­¾å‡ºåˆ°ç£ç›˜ä¸Šï¼Œè¿™ä¸ªæ“ä½œä¼šå¿«å¾—å¤šã€‚ä¹Ÿå¯ä»¥ç”¨ <code>--tree-filter</code> æ¥å®Œæˆç›¸åŒçš„æ“ä½œã€‚<code>git rm</code> çš„ <code>--ignore-unmatch</code> é€‰é¡¹æŒ‡å®šå½“ä½ è¯•å›¾åˆ é™¤çš„å†…å®¹å¹¶ä¸å­˜åœ¨æ—¶ä¸æ˜¾ç¤ºé”™è¯¯ã€‚æœ€åï¼Œå› ä¸ºä½ æ¸…æ¥šé—®é¢˜æ˜¯ä»å“ªä¸ª commit å¼€å§‹çš„ï¼Œä½¿ç”¨ <code>filter-branch</code> é‡å†™è‡ª <code>6df7640</code> è¿™ä¸ª commit å¼€å§‹çš„æ‰€æœ‰å†å²è®°å½•ã€‚ä¸è¿™ä¹ˆåšçš„è¯ä¼šé‡å†™æ‰€æœ‰å†å²è®°å½•ï¼ŒèŠ±è´¹ä¸å¿…è¦çš„æ›´å¤šæ—¶é—´ã€‚</p>
<p>ç°åœ¨å†å²è®°å½•ä¸­å·²ç»ä¸åŒ…å«å¯¹é‚£ä¸ªæ–‡ä»¶çš„å¼•ç”¨äº†ã€‚ä¸è¿‡ reflog ä»¥åŠè¿è¡Œ <code>filter-branch</code> æ—¶ Git å¾€ <code>.git/refs/original</code> æ·»åŠ çš„ä¸€äº› refs ä¸­ä»æœ‰å¯¹å®ƒçš„å¼•ç”¨ï¼Œå› æ­¤éœ€è¦å°†è¿™äº›å¼•ç”¨åˆ é™¤å¹¶å¯¹ä»“åº“è¿›è¡Œ repack æ“ä½œã€‚åœ¨è¿›è¡Œ repack å‰éœ€è¦å°†æ‰€æœ‰å¯¹è¿™äº› commits çš„å¼•ç”¨å»é™¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ rm -Rf .git/refs/original</span><br><span class="line">$ rm -Rf .git/logs/</span><br><span class="line">$ git gc</span><br><span class="line">Counting objects: 19, done.</span><br><span class="line">Delta compression using 2 threads.</span><br><span class="line">Compressing objects: 100% (14/14), done.</span><br><span class="line">Writing objects: 100% (19/19), done.</span><br><span class="line">Total 19 (delta 3), reused 16 (delta 1)</span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸€ä¸‹èŠ‚çœäº†å¤šå°‘ç©ºé—´ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git count-objects -v</span><br><span class="line">count: 8</span><br><span class="line">size: 2040</span><br><span class="line">in-pack: 19</span><br><span class="line">packs: 1</span><br><span class="line">size-pack: 7</span><br><span class="line">prune-packable: 0</span><br><span class="line">garbage: 0</span><br></pre></td></tr></table></figure>

<p>repack åä»“åº“çš„å¤§å°å‡å°åˆ°äº† 7K ï¼Œè¿œå°äºä¹‹å‰çš„ 2MB ã€‚ä» size å€¼å¯ä»¥çœ‹å‡ºå¤§æ–‡ä»¶å¯¹è±¡è¿˜åœ¨æ¾æ•£å¯¹è±¡ä¸­ï¼Œå…¶å®å¹¶æ²¡æœ‰æ¶ˆå¤±ï¼Œä¸è¿‡è¿™æ²¡æœ‰å…³ç³»ï¼Œé‡è¦çš„æ˜¯åœ¨å†è¿›è¡Œæ¨é€æˆ–å¤åˆ¶ï¼Œè¿™ä¸ªå¯¹è±¡ä¸ä¼šå†ä¼ é€å‡ºå»ã€‚å¦‚æœçœŸçš„è¦å®Œå…¨æŠŠè¿™ä¸ªå¯¹è±¡åˆ é™¤ï¼Œå¯ä»¥è¿è¡Œ <code>git prune --expire</code> å‘½ä»¤ã€‚</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/git/" rel="tag"># git</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/08/23/git/git-git%E4%B8%8E%E5%85%B6%E4%BB%96%E7%B3%BB%E7%BB%9F/" rel="prev" title="git-gitä¸å…¶ä»–ç³»ç»Ÿ">
      <i class="fa fa-chevron-left"></i> git-gitä¸å…¶ä»–ç³»ç»Ÿ
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/08/24/algorithm/tree/" rel="next" title="tree">
      tree <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%95%E5%B1%82%E5%91%BD%E4%BB%A4-Plumbing-%E5%92%8C%E9%AB%98%E5%B1%82%E5%91%BD%E4%BB%A4-Porcelain"><span class="nav-number">1.</span> <span class="nav-text">åº•å±‚å‘½ä»¤ (Plumbing) å’Œé«˜å±‚å‘½ä»¤ (Porcelain)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Git-%E5%AF%B9%E8%B1%A1"><span class="nav-number">2.</span> <span class="nav-text">Git å¯¹è±¡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#tree-%E6%A0%91-%E5%AF%B9%E8%B1%A1"><span class="nav-number">2.1.</span> <span class="nav-text">tree (æ ‘) å¯¹è±¡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#commit-%E6%8F%90%E4%BA%A4-%E5%AF%B9%E8%B1%A1"><span class="nav-number">2.2.</span> <span class="nav-text">commit (æäº¤) å¯¹è±¡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8"><span class="nav-number">2.3.</span> <span class="nav-text">å¯¹è±¡å­˜å‚¨</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Git-References"><span class="nav-number">3.</span> <span class="nav-text">Git References</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HEAD-%E6%A0%87%E8%AE%B0"><span class="nav-number">3.1.</span> <span class="nav-text">HEAD æ ‡è®°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tags"><span class="nav-number">3.2.</span> <span class="nav-text">Tags</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Remotes"><span class="nav-number">3.3.</span> <span class="nav-text">Remotes</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Packfiles"><span class="nav-number">4.</span> <span class="nav-text">Packfiles</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-Refspec"><span class="nav-number">5.</span> <span class="nav-text">The Refspec</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A8%E9%80%81-Refspec"><span class="nav-number">5.1.</span> <span class="nav-text">æ¨é€ Refspec</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E5%BC%95%E7%94%A8"><span class="nav-number">5.2.</span> <span class="nav-text">åˆ é™¤å¼•ç”¨</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE"><span class="nav-number">6.</span> <span class="nav-text">ä¼ è¾“åè®®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%91%E5%8D%8F%E8%AE%AE"><span class="nav-number">6.1.</span> <span class="nav-text">å“‘åè®®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%BA%E8%83%BD%E5%8D%8F%E8%AE%AE"><span class="nav-number">6.2.</span> <span class="nav-text">æ™ºèƒ½åè®®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8A%E4%BC%A0%E6%95%B0%E6%8D%AE"><span class="nav-number">6.2.1.</span> <span class="nav-text">ä¸Šä¼ æ•°æ®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="nav-number">6.2.2.</span> <span class="nav-text">ä¸‹è½½æ•°æ®</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%B4%E6%8A%A4%E5%8F%8A%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D"><span class="nav-number">7.</span> <span class="nav-text">ç»´æŠ¤åŠæ•°æ®æ¢å¤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%B4%E6%8A%A4"><span class="nav-number">7.1.</span> <span class="nav-text">ç»´æŠ¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D"><span class="nav-number">7.2.</span> <span class="nav-text">æ•°æ®æ¢å¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A7%BB%E9%99%A4%E5%AF%B9%E8%B1%A1"><span class="nav-number">7.3.</span> <span class="nav-text">ç§»é™¤å¯¹è±¡</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="CHENPENGBLOG"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">CHENPENGBLOG</p>
  <div class="site-description" itemprop="description">å…¨æ ˆæèµ·æ¥ï¼</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">97</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yourname" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yourname@gmail.com" title="E-Mail â†’ mailto:yourname@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/yourname" title="Weibo â†’ https:&#x2F;&#x2F;weibo.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/yourname" title="StackOverflow â†’ https:&#x2F;&#x2F;stackoverflow.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CHENPENGBLOG</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
