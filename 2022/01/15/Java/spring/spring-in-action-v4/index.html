<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"chenpeng.pages.dev","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="å…¨ä¹¦åˆ†ä¸º 4 éƒ¨åˆ†ã€‚ç¬¬ 1 éƒ¨åˆ†ä»‹ç» Spring æ¡†æ¶çš„æ ¸å¿ƒçŸ¥è¯†ã€‚ç¬¬ 2 éƒ¨åˆ†åœ¨æ­¤åŸºç¡€ä¸Šä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Spring æ„å»º Web åº”ç”¨ç¨‹åºã€‚ç¬¬ 3 éƒ¨åˆ†å‘Šåˆ«å‰ç«¯ï¼Œä»‹ç»äº†å¦‚ä½•åœ¨åº”ç”¨ç¨‹åºçš„åç«¯ä½¿ç”¨ Springã€‚ç¬¬ 4 éƒ¨åˆ†æè¿°äº†å¦‚ä½•ä½¿ç”¨ Spring ä¸å…¶ä»–çš„åº”ç”¨å’ŒæœåŠ¡è¿›è¡Œé›†æˆã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="spring-in-action-v4">
<meta property="og:url" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/index.html">
<meta property="og:site_name" content="é™ˆé¹çš„åšå®¢">
<meta property="og:description" content="å…¨ä¹¦åˆ†ä¸º 4 éƒ¨åˆ†ã€‚ç¬¬ 1 éƒ¨åˆ†ä»‹ç» Spring æ¡†æ¶çš„æ ¸å¿ƒçŸ¥è¯†ã€‚ç¬¬ 2 éƒ¨åˆ†åœ¨æ­¤åŸºç¡€ä¸Šä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Spring æ„å»º Web åº”ç”¨ç¨‹åºã€‚ç¬¬ 3 éƒ¨åˆ†å‘Šåˆ«å‰ç«¯ï¼Œä»‹ç»äº†å¦‚ä½•åœ¨åº”ç”¨ç¨‹åºçš„åç«¯ä½¿ç”¨ Springã€‚ç¬¬ 4 éƒ¨åˆ†æè¿°äº†å¦‚ä½•ä½¿ç”¨ Spring ä¸å…¶ä»–çš„åº”ç”¨å’ŒæœåŠ¡è¿›è¡Œé›†æˆã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211027104236899.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211027110842477.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211027111030810.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211027114018559.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211015105103441.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211012113540226.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211027144045165.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211020091950504.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211027165439437.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211122154454794.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211014105618837.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211014135855338.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211014140550324.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211014154829792.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211014161703113.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211014162033571.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211014175714743.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211014180948279.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211014195252484.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211028193858055.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211021112649999.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211021183533119.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211022100737079.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211022103627696.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211022105250379.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211022110423300.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211022204227004.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211101142028132.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211101144543984.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211101164020716.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211101170930669.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211102141648596.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211102210046054.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211102210830105.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211103203654783.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211103230004821.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211103231502068.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211103232230475.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211103232431202.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211103233600856.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211104153559851.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211101203221220.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211101214636479.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211104225555510.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211108095702675.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211108104552145.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211108104745073.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211110224117848.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211110224522258.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211110224646129.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211111083338803.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211111084204602.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211111085152544.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211111090129546.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211111090603017.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211111090737616.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211111092403336.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211112102523995.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211112102531982.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211112102601892.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211112102611775.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211112091946207.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211112092824597.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211112093717028.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211112100131206.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211114110749065.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/spring-in-action-v4/image-20211114113932607.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/spring-in-action-v4/image-20211114114242015.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/spring-in-action-v4/image-20211114120726131.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/spring-in-action-v4/image-20211114130851853.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/spring-in-action-v4/image-20211114134451156.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/spring-in-action-v4/image-20211114135257054.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/spring-in-action-v4/image-20211114135408542.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/spring-in-action-v4/image-20211114135810011.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/spring-in-action-v4/image-20211114141311487.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/spring-in-action-v4/image-20211114141511375.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/spring-in-action-v4/image-20211114144746810.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/spring-in-action-v4/image-20211114201133060.png">
<meta property="og:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/spring-in-action-v4/image-20211114201549663.png">
<meta property="article:published_time" content="2022-01-15T14:15:31.000Z">
<meta property="article:modified_time" content="2022-04-14T10:54:47.905Z">
<meta property="article:author" content="CHENPENGBLOG">
<meta property="article:tag" content="java">
<meta property="article:tag" content="spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/image-20211027104236899.png">

<link rel="canonical" href="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>spring-in-action-v4 | é™ˆé¹çš„åšå®¢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">é™ˆé¹çš„åšå®¢</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ğŸ˜‰</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://chenpeng.pages.dev/2022/01/15/Java/spring/spring-in-action-v4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CHENPENGBLOG">
      <meta itemprop="description" content="å…¨æ ˆæèµ·æ¥ï¼">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é™ˆé¹çš„åšå®¢">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          spring-in-action-v4
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2022-01-15 22:15:31" itemprop="dateCreated datePublished" datetime="2022-01-15T22:15:31+08:00">2022-01-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-04-14 18:54:47" itemprop="dateModified" datetime="2022-04-14T18:54:47+08:00">2022-04-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>å…¨ä¹¦åˆ†ä¸º 4 éƒ¨åˆ†ã€‚ç¬¬ 1 éƒ¨åˆ†ä»‹ç» Spring æ¡†æ¶çš„æ ¸å¿ƒçŸ¥è¯†ã€‚ç¬¬ 2 éƒ¨åˆ†åœ¨æ­¤åŸºç¡€ä¸Šä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Spring æ„å»º Web åº”ç”¨ç¨‹åºã€‚ç¬¬ 3 éƒ¨åˆ†å‘Šåˆ«å‰ç«¯ï¼Œä»‹ç»äº†å¦‚ä½•åœ¨åº”ç”¨ç¨‹åºçš„åç«¯ä½¿ç”¨ Springã€‚ç¬¬ 4 éƒ¨åˆ†æè¿°äº†å¦‚ä½•ä½¿ç”¨ Spring ä¸å…¶ä»–çš„åº”ç”¨å’ŒæœåŠ¡è¿›è¡Œé›†æˆã€‚</p>
<span id="more"></span>

<h1 id="Spring-çš„æ ¸å¿ƒ"><a href="#Spring-çš„æ ¸å¿ƒ" class="headerlink" title="Spring çš„æ ¸å¿ƒ"></a>Spring çš„æ ¸å¿ƒ</h1><p>spring çš„ä¸»è¦ç‰¹æ€§æ˜¯ä¾èµ–æ³¨å…¥ (dependency injection, DI) å’Œé¢å‘åˆ‡é¢ç¼–ç¨‹ (aspect-oriented programming, AOP)</p>
<h2 id="Spring-ä¹‹æ—…"><a href="#Spring-ä¹‹æ—…" class="headerlink" title="Spring ä¹‹æ—…"></a>Spring ä¹‹æ—…</h2><p>æœ¬ç« å†…å®¹</p>
<ol>
<li>æ¢ç´¢ Spring çš„æ ¸å¿ƒæ¨¡å—</li>
<li>è§£è€¦åº”ç”¨å¯¹è±¡</li>
<li>ä½¿ç”¨ AOP æ¨ªåˆ‡å…³æ³¨ç‚¹</li>
<li>Spring çš„ Bean å®¹å™¨</li>
</ol>
<p>åœ¨è¯ç”Ÿä¹‹åˆï¼Œåˆ›å»º Spring çš„ä¸»è¦ç›®çš„æ˜¯ç”¨æ¥æ›¿ä»£æ›´åŠ é‡é‡çº§çš„ä¼ä¸šçº§ Java æŠ€æœ¯ï¼Œå°¤å…¶æ˜¯ EJBã€‚</p>
<h3 id="ç®€åŒ–-Java-å¼€å‘"><a href="#ç®€åŒ–-Java-å¼€å‘" class="headerlink" title="ç®€åŒ– Java å¼€å‘"></a>ç®€åŒ– Java å¼€å‘</h3><p>Spring æ˜¯ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œæœ€æ—©ç”± Rod Johnson åˆ›å»ºï¼Œå¹¶åœ¨ã€ŠExpert One-on-Oneï¼šJ2EE Design and Developmentã€‹ï¼ˆ<a target="_blank" rel="noopener" href="http://amzn.com/076454385">http://amzn.com/076454385</a>ï¼‰è¿™æœ¬è‘—ä½œä¸­è¿›è¡Œäº†ä»‹ç»ã€‚</p>
<p>ä¸€ä¸ª Spring ç»„ä»¶å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„ POJOã€‚åœ¨æœ¬ä¹¦ä¸­ï¼Œæˆ‘é‡‡ç”¨ JavaBean çš„å¹¿æ³›å®šä¹‰ï¼Œå³ POJO çš„åŒä¹‰è¯ã€‚</p>
<p>Spring æœ€æ ¹æœ¬çš„ä½¿å‘½ï¼šç®€åŒ– Java å¼€å‘ã€‚</p>
<p>ä¸ºäº†é™ä½ Java å¼€å‘çš„å¤æ‚æ€§ï¼ŒSpring é‡‡ç”¨äº†ä»¥ä¸‹ 4 ç§ç­–ç•¥:ï¼š</p>
<ol>
<li>åŸºäº POJO çš„è½»é‡çº§å’Œæœ€å°ä¾µå…¥æ€§ç¼–ç¨‹</li>
<li>é€šè¿‡ä¾èµ–æ³¨å…¥å’Œé¢å‘æ¥å£å®ç°æ¾è€¦åˆ</li>
<li>åŸºäºåˆ‡é¢å’Œæƒ¯ä¾‹è¿›è¡Œå£°æ˜å¼ç¼–ç¨‹</li>
<li>é€šè¿‡åˆ‡é¢å’Œæ¨¡æ¿å‡å°‘æ ·æ¿å¼ä»£ç </li>
</ol>
<p>å‡ ä¹ Spring æ‰€åšçš„ä»»ä½•äº‹æƒ…éƒ½å¯ä»¥è¿½æº¯åˆ°ä¸Šè¿°çš„ä¸€æ¡æˆ–å¤šæ¡ç­–ç•¥ã€‚</p>
<h4 id="æ¿€å‘-POJO-çš„æ½œèƒ½"><a href="#æ¿€å‘-POJO-çš„æ½œèƒ½" class="headerlink" title="æ¿€å‘ POJO çš„æ½œèƒ½"></a>æ¿€å‘ POJO çš„æ½œèƒ½</h4><p>Spring ä¸ä¼šå¼ºè¿«ä½ å®ç° Spring è§„èŒƒçš„æ¥å£æˆ–ç»§æ‰¿Spring è§„èŒƒçš„ç±»ï¼Œç›¸åï¼Œåœ¨åŸºäº Spring æ„å»ºçš„åº”ç”¨ä¸­ï¼Œå®ƒçš„ç±»é€šå¸¸æ²¡æœ‰ä»»ä½•ç—•è¿¹è¡¨æ˜ä½ ä½¿ç”¨äº† Springã€‚æœ€åçš„åœºæ™¯æ˜¯ï¼Œä¸€ä¸ªç±»æˆ–è®¸ä¼šä½¿ç”¨ Spring æ³¨è§£ï¼Œä½†å®ƒä¾æ—§æ˜¯ POJOã€‚</p>
<center>ç¨‹åºæ¸…å• 1.1 Spring ä¸ä¼šåœ¨ HelloWorldBeanä¸Šæœ‰ä»»ä½•ä¸åˆç†çš„è¦æ±‚</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spring;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldBean</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayhello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello world!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•æ™®é€šçš„ Java ç±» â€”â€” POJOã€‚æ²¡æœ‰ä»»ä½•åœ°æ–¹è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ª Spring ç»„ä»¶ã€‚Spring çš„éä¾µå…¥ç¼–ç¨‹æ¨¡å‹æ„å‘³ç€è¿™ä¸ªç±»åœ¨ Spring åº”ç”¨å’Œé Spring åº”ç”¨ä¸­éƒ½å¯ä»¥å‘æŒ¥åŒæ ·çš„ä½œç”¨ã€‚Spring èµ‹äºˆ POJO é­”åŠ›çš„æ–¹å¼ä¹‹ä¸€å°±æ˜¯é€šè¿‡ DI æ¥è£…é…å®ƒä»¬ã€‚</p>
<h4 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a>ä¾èµ–æ³¨å…¥</h4><p>ä»»ä½•ä¸€ä¸ªæœ‰å®é™…æ„ä¹‰çš„åº”ç”¨éƒ½æ˜¯ç”±ä¸¤ä¸ªæˆ–æ›´å¤šçš„ç±»ç»„æˆï¼Œè¿™äº›ç±»ä¹‹é—´ç›¸äº’åä½œå®Œæˆç‰¹å®šçš„ä¸šåŠ¡é€»è¾‘ã€‚é€šå¸¸ï¼Œæ¯ä¸ªå¯¹è±¡è´Ÿè´£ç®¡ç†ä¸è‡ªå·±ç›¸äº’åä½œçš„å¯¹è±¡ï¼ˆå³å®ƒæ‰€ä»¥æ¥çš„å¯¹è±¡ï¼‰çš„å¼•ç”¨ï¼Œè¿™å°†ä¼šå¯¼è‡´é«˜åº¦è€¦åˆå’Œéš¾ä»¥æµ‹è¯•çš„ä»£ç ã€‚</p>
<center>ç¨‹åºæ¸…å• 1.2 DamselRescuingKnight åªèƒ½æ‰§è¡Œ RescueDamselQuest æ¢é™©ä»»åŠ¡</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springinaction.knights;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DameselRescuingKnight</span> <span class="keyword">implements</span> <span class="title">Knights</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> RescueDameselQuest quest;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DameselRescuingKnight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.quest = <span class="keyword">new</span> RescueDameselQuest(); <span class="comment">// ä¸ RescueDameselQuest ç´§è€¦åˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">embarkOnQuest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        quest.embark();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ï¼šDamselRescuingKnight ç´§å¯†åœ°å’Œ RescueDamselQuest è€¦åˆåˆ°äº†ä¸€èµ·ï¼Œéª‘å£«åªèƒ½æ‹¯æ•‘å°‘å¥³ï¼Œæ— æ³•è¿›è¡Œå…¶ä»–çš„æ¢é™©ä»»åŠ¡ã€‚</p>
<p>ç¬¬äºŒï¼šDamselRescuingKnight å°†æ— æ³•è¿›è¡Œæµ‹è¯•ã€‚</p>
<p>è€¦åˆå…·æœ‰ä¸¤é¢æ€§ï¼ˆtwo-headed beastï¼‰ã€‚ä¸€æ–¹é¢ï¼Œç´§å¯†è€¦åˆçš„ä»£ç éš¾ä»¥æµ‹è¯•ã€éš¾ä»¥å¤ç”¨ã€éš¾ä»¥ç†è§£ï¼Œå¹¶ä¸”å…¸å‹åœ°è¡¨ç°å‡ºâ€œæ‰“åœ°é¼ â€å¼çš„ bug ç‰¹æ€§ï¼ˆä¿®å¤ä¸€ä¸ª bugï¼Œå°†ä¼šå‡ºç°ä¸€ä¸ªæˆ–è€…æ›´å¤šæ–°çš„ bugï¼‰ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸€å®šç¨‹åº¦çš„è€¦åˆåˆæ˜¯å¿…é¡»çš„â€”â€”å®Œå…¨æ²¡æœ‰è€¦åˆçš„ä»£ç ä»€ä¹ˆä¹Ÿåšä¸äº†ã€‚ä¸ºäº†å®Œæˆæœ‰å®é™…æ„ä¹‰çš„åŠŸèƒ½ï¼Œä¸åŒçš„ç±»å¿…é¡»ä»¥é€‚å½“çš„æ–¹å¼è¿›è¡Œäº¤äº’ã€‚æ€»è€Œè¨€ä¹‹ï¼Œè€¦åˆæ˜¯å¿…é¡»çš„ï¼Œä½†åº”å½“è¢«å°å¿ƒè°¨æ…åœ°ç®¡ç†ã€‚</p>
<p>é€šè¿‡ä¾èµ–æ³¨å…¥ (DI)ï¼Œå¯¹è±¡çš„ä¾èµ–å…³ç³»å°†ç”±è´Ÿè´£åè°ƒç³»ç»Ÿä¸­å„ä¸ªå¯¹è±¡çš„ç¬¬ä¸‰æ–¹ç»„ä»¶åœ¨åˆ›å»ºå¯¹è±¡æ—¶è®¾å®šã€‚å¯¹è±¡æ— éœ€è‡ªè¡Œåˆ›å»ºæˆ–ç®¡ç†å®ƒä»¬çš„ä¾èµ–å…³ç³»ï¼Œå¦‚å›¾ 1.1 æ‰€ç¤ºï¼Œä¾èµ–å…³ç³»å°†è¢«è‡ªåŠ¨æ³¨å…¥åˆ°éœ€è¦å®ƒä»¬çš„å¯¹è±¡å½“ä¸­å»ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211027104236899.png" alt="image-20211027104236899"></p>
<center>å›¾ 1.1ã€€ä¾èµ–æ³¨å…¥ä¼šå°†æ‰€ä¾èµ–çš„å…³ç³»è‡ªåŠ¨äº¤ç»™ç›®æ ‡å¯¹è±¡ï¼Œè€Œä¸æ˜¯è®©å¯¹è±¡è‡ªå·±å»è·å–ä¾èµ–</center>

<p>ä¸ºäº†å±•ç¤ºè¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€çœ‹ç¨‹åºæ¸…å• 1.3 ä¸­çš„ BraveKnightï¼Œè¿™ä¸ªéª‘å£«ä¸ä»…å‹‡æ•¢ï¼Œè€Œä¸”èƒ½æŒ‘æˆ˜ä»»ä½•å½¢å¼çš„æ¢é™©ã€‚</p>
<center>ç¨‹åºæ¸…å• 1.3 BraveKnight è¶³å¤Ÿçµæ´»å¯ä»¥æ¥å—ä»»ä½•èµ‹äºˆä»–çš„æ¢é™©ä»»åŠ¡</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BraveKnight</span> <span class="keyword">implements</span> <span class="title">Knight</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Quest quest;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BraveKnight</span><span class="params">(Quest quest)</span> </span>&#123; <span class="comment">// Quest è¢«æ³¨å…¥è¿›æ¥</span></span><br><span class="line">        <span class="keyword">this</span>.quest = quest; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">embarkOnQuest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        quest.embark();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BraveKnight æ²¡æœ‰è‡ªè¡Œåˆ›å»ºæ¢é™©ä»»åŠ¡ï¼Œè€Œæ˜¯åœ¨æ„é€ æ—¶æŠŠæ¢é™©ä»»åŠ¡ä½œä¸ºæ„é€ å™¨å‚æ•°ä¼ å…¥â€”â€”è¿™æ˜¯ä¾èµ–æ³¨å…¥çš„æ–¹å¼ä¹‹ä¸€ï¼Œå³æ„é€ å™¨æ³¨å…¥ã€‚</p>
<p>æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒè¢«ä¼ å…¥çš„æ¢é™©ç±»å‹æ˜¯ Questï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ‰€æœ‰æ¢é™©ä»»åŠ¡éƒ½å¿…é¡»å®ç°çš„æ¥å£ã€‚æ‰€ä»¥ï¼ŒBraveKnight èƒ½å¤Ÿç›¸åº”ä»»æ„ä¸€ç§ Quest å®ç°ã€‚</p>
<p>è¿™é‡Œçš„è¦ç‚¹æ˜¯ BraveKnight æ²¡æœ‰ä¸ä»»ä½•ç‰¹å®šçš„ <strong>Quest å®ç°</strong>å‘ç”Ÿè€¦åˆã€‚è¿™å°±æ˜¯ä¾èµ–æ³¨å…¥æœ€å¤§çš„å¥½å¤„â€”â€”<strong>æ¾è€¦åˆ</strong>ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡åªé€šè¿‡æ¥å£ï¼ˆè€Œä¸æ˜¯å…·ä½“å®ç°æˆ–åˆå§‹åŒ–çš„è¿‡ç¨‹ï¼‰æ¥è¡¨æ˜ä¾èµ–å…³ç³»ï¼Œé‚£ä¹ˆè¿™ç§ä¾èµ–å°±èƒ½å¤Ÿåœ¨å¯¹è±¡æœ¬èº«æ¯«ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œç”¨ä¸åŒçš„å…·ä½“å®ç°è¿›è¡Œæ›¿æ¢ã€‚</p>
<p>å¯¹ä¾èµ–è¿›è¡Œæ›¿æ¢çš„ä¸€ä¸ªæœ€å¸¸ç”¨æ–¹æ³•å°±æ˜¯åœ¨æµ‹è¯•çš„æ—¶å€™ä½¿ç”¨ mock å®ç°ã€‚</p>
<center>ç¨‹åºæ¸…å• 1.4ã€€ä¸ºäº†æµ‹è¯• BraveKnightï¼Œéœ€è¦æ³¨å…¥ä¸€ä¸ª mock Quest</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springinaction.knights;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.*;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BraveKnightTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">knightShouldEmbarkOnQuest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Quest mockQuest = mock(Quest.class); <span class="comment">// åˆ›å»º mock Quest</span></span><br><span class="line">        Braveknight knight = <span class="keyword">new</span> BraveKnight(mockQuest); <span class="comment">// æ³¨å…¥ mock Quest</span></span><br><span class="line">        knight.embarkOnQuest();</span><br><span class="line">        verify(mockQuest, times(<span class="number">1</span>)).embark();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥ä½¿ç”¨ mock æ¡†æ¶ Mockito å»åˆ›å»ºä¸€ä¸ª Quest æ¥å£çš„ mock å®ç°ã€‚é€šè¿‡è¿™ä¸ª mock å¯¹è±¡ï¼Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ BraveKnight å®ä¾‹ï¼Œå¹¶é€šè¿‡æ„é€ å™¨æ³¨å…¥è¿™ä¸ª mock Questã€‚å½“è°ƒç”¨ embarkOnQuest() æ–¹æ³•æ—¶ï¼Œä½ å¯ä»¥è¦æ±‚ Mockito æ¡†æ¶éªŒè¯ Quest çš„ mock å®ç°çš„ embark() æ–¹æ³•ä»…ä»…è¢«è°ƒç”¨äº†ä¸€æ¬¡ã€‚</p>
<p><strong>å°†Questæ³¨å…¥åˆ°Knightä¸­</strong></p>
<p>å‡è®¾ï¼Œå¸Œæœ› BraveKnight æ‰€è¦è¿›è¡Œæ¢é™©ä»»åŠ¡æ˜¯æ€æ­»ä¸€åªæ€ªé¾™ï¼Œé‚£ä¹ˆ SlayDragonQuest ä¹Ÿè®¸æ˜¯æŒºåˆé€‚çš„ã€‚</p>
<center>ç¨‹åºæ¸…å• 1.5ã€€SlayDragonQuest æ˜¯è¦æ³¨å…¥åˆ° BraveKnight ä¸­çš„ Quest å®ç°</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SlayDragonQuest</span> <span class="keyword">implements</span> <span class="title">Quest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> PrintStream stream;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SlayDragonQuest</span><span class="params">(PrintStream stream)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stream = stream;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">embark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stream.println(<span class="string">&quot;Embarking on quest to slay the dragon!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸å…¶ä»–çš„ Java å…¥é—¨æ ·ä¾‹æœ‰æ‰€ä¸åŒï¼ŒSlayDragonQuest æ²¡æœ‰ä½¿ç”¨ System.out.println()ï¼Œè€Œæ˜¯åœ¨æ„é€ æ–¹æ³•ä¸­è¯·æ±‚ä¸€ä¸ªæ›´ä¸ºé€šç”¨çš„ PrintStreamã€‚</p>
<p>åˆ›å»ºåº”ç”¨ç»„ä»¶ä¹‹é—´åä½œçš„è¡Œä¸ºé€šå¸¸ç§°ä¸ºè£…é…  (wiring)ã€‚Spring æœ‰å¤šç§è£…é… Bean çš„æ–¹å¼ï¼Œé‡‡ç”¨ XML é…ç½®æ˜¯å¸¸ç”¨è£…é…æ–¹å¼ä¹‹ä¸€ã€‚</p>
<center>ç¨‹åºæ¸…å• 1.6ã€€ä½¿ç”¨ Spring å°† SlayDragonQuest æ³¨å…¥åˆ° BraveKnight ä¸­</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span> = <span class="string">&quot;knight&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.chenpeng.knights.BraveKnight&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ³¨å…¥ quest --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;quest&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;quest&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.chenpeng.knights.SlayDragonQuest&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;T(System).out&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼ŒBraveKnight å’Œ SlayDragonQuest è¢«å£°æ˜ä¸º Spring ä¸­çš„ beanã€‚å°± BraveKnight bean æ¥è®²ï¼Œå®ƒåœ¨æ„é€ æ—¶ä¼ å…¥äº†å¯¹ SlayDragonQuest bean çš„å¼•ç”¨ï¼Œå°†å…¶ä½œä¸ºæ„é€ å™¨å‚æ•°ã€‚åŒæ—¶ï¼ŒSlayDragonQuest bean çš„å£°æ˜ä½¿ç”¨äº† Spring è¡¨è¾¾å¼è¯­è¨€ï¼ˆSpring Expression Languageï¼‰ï¼Œå°† System.outï¼ˆè¿™æ˜¯ä¸€ä¸ªPrintStreamï¼‰ ä¼ å…¥åˆ°äº† SlayDragonQuest çš„æ„é€ å™¨ä¸­ã€‚</p>
<p>å¦‚æœ XML é…ç½®ä¸ç¬¦åˆä½ çš„å–œå¥½çš„è¯ï¼ŒSpring è¿˜æ”¯æŒä½¿ç”¨ Java æ¥æè¿°é…ç½®ã€‚æ¯”å¦‚ï¼Œç¨‹åºæ¸…å• 1.7 å±•ç°äº†åŸºäº Java çš„é…ç½®ï¼Œå®ƒçš„åŠŸèƒ½ä¸ç¨‹åºæ¸…å• 1.6 ç›¸åŒã€‚</p>
<center>ç¨‹åºæ¸…å• 1.7ã€€Spring æä¾›äº†åŸºäº Java çš„é…ç½®ï¼Œå¯ä½œä¸º XML çš„æ›¿ä»£æ–¹æ¡ˆ</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sia.knights.BraveKnight;</span><br><span class="line"><span class="keyword">import</span> sia.knights.Knight;</span><br><span class="line"><span class="keyword">import</span> sia.knights.Quest;</span><br><span class="line"><span class="keyword">import</span> sia.knights.SlayDragonQuest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KnightConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Knight <span class="title">knight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BraveKnight(quest());</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Quest <span class="title">quest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SlayDragonQuest(System.out);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring é€šè¿‡å®ƒçš„é…ç½®ï¼Œå¯ä»¥åœ¨ä¸æ”¹å˜æ‰€ä¾èµ–çš„ç±»çš„æƒ…å†µä¸‹ï¼Œä¿®æ”¹ä¾èµ–å…³ç³»ã€‚</p>
<p>ç°åœ¨å·²ç»å£°æ˜äº†BraveKnight å’Œ Quest çš„å…³ç³»ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦è£…è½½ XML é…ç½®æ–‡ä»¶ï¼Œå¹¶æŠŠåº”ç”¨å¯åŠ¨èµ·æ¥ã€‚</p>
<p><strong>è§‚å¯Ÿå®ƒå¦‚ä½•å·¥ä½œ</strong></p>
<p>Spring é€šè¿‡åº”ç”¨ä¸Šä¸‹æ–‡ (Application Context) è£…è½½ Bean çš„å®šä¹‰å¹¶æŠŠå®ƒä»¬ç»„è£…èµ·æ¥ã€‚Spring åº”ç”¨ä¸Šä¸‹æ–‡å…¨æƒè´Ÿè´£å¯¹è±¡çš„åˆ›å»ºå’Œç»„è£…ã€‚Spring è‡ªå¸¦äº†å¤šç§åº”ç”¨ä¸Šä¸‹æ–‡çš„å®ç°ï¼Œå®ƒä»¬ä¹‹é—´çš„ä¸»è¦åŒºåˆ«æ˜¯å¦‚ä½•åŠ è½½å®ƒä»¬çš„é…ç½®ã€‚</p>
<p>å› ä¸º knights.xml ä¸­çš„ bean æ˜¯ä½¿ç”¨ XML æ–‡ä»¶è¿›è¡Œé…ç½®çš„ï¼Œæ‰€ä»¥é€‰æ‹© ClassPathXmlApplicationContext ä½œä¸ºåº”ç”¨ä¸Šä¸‹æ–‡ç›¸å¯¹æ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚è¯¥ç±»åŠ è½½ä½äºåº”ç”¨ç¨‹åºç±»è·¯å¾„ä¸‹çš„ä¸€ä¸ªæˆ–å¤šä¸ª XML é…ç½®æ–‡ä»¶ã€‚ç¨‹åºæ¸…å• 1.8 ä¸­çš„ main() æ–¹æ³•è°ƒç”¨ClassPathXmlApplicationContext åŠ è½½ knights.xmlï¼Œå¹¶è·å¾— Knight å¯¹è±¡çš„å¼•ç”¨ã€‚</p>
<center>ç¨‹åºæ¸…å• 1.8ã€€KnightMain.java åŠ è½½åŒ…å« Knight çš„ Spring ä¸Šä¸‹æ–‡</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springinaction.knights;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClasspathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KnightMain</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åŠ è½½ Spring ä¸Šä¸‹æ–‡</span></span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;knights.xml&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å– knight bean</span></span><br><span class="line">    	Knight knight = context.getBean(Kngiht.class);</span><br><span class="line">    	knight.embarkOnQuest(); <span class="comment">// ä½¿ç”¨ knight</span></span><br><span class="line">        context.close();</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ main() æ–¹æ³•åŸºäº knights.xml æ–‡ä»¶åˆ›å»ºäº† Spring åº”ç”¨ä¸Šä¸‹æ–‡ã€‚éšåå®ƒè°ƒç”¨è¯¥åº”ç”¨ä¸Šä¸‹æ–‡è·å–ä¸€ä¸ª ID ä¸º knight çš„ beanã€‚å¾—åˆ° Knight å¯¹è±¡çš„å¼•ç”¨åï¼Œåªéœ€ç®€å•è°ƒç”¨ embarkOnQuest() æ–¹æ³•å°±å¯ä»¥æ‰§è¡Œæ‰€èµ‹äºˆçš„æ¢é™©ä»»åŠ¡äº†ã€‚æ³¨æ„è¿™ä¸ªç±»å®Œå…¨ä¸çŸ¥é“æˆ‘ä»¬çš„è‹±é›„éª‘å£«æ¥å—å“ªç§æ¢é™©ä»»åŠ¡ï¼Œè€Œä¸”å®Œå…¨æ²¡æœ‰æ„è¯†åˆ°è¿™æ˜¯ç”± BraveKnight æ¥æ‰§è¡Œçš„ã€‚åªæœ‰ knights.xml æ–‡ä»¶çŸ¥é“å“ªä¸ªéª‘å£«æ‰§è¡Œå“ªç§æ¢é™©ä»»åŠ¡ã€‚</p>
<h4 id="åº”ç”¨åˆ‡é¢"><a href="#åº”ç”¨åˆ‡é¢" class="headerlink" title="åº”ç”¨åˆ‡é¢"></a>åº”ç”¨åˆ‡é¢</h4><p><strong>ä¾èµ–æ³¨å…¥è®©ç›¸äº’åä½œçš„è½¯ä»¶ç»„ä»¶ä¿æŒæ¾æ•£è€¦åˆï¼Œè€Œ AOP ç¼–ç¨‹å…è®¸ä½ æŠŠéå¸ƒåº”ç”¨å„å¤„çš„åŠŸèƒ½åˆ†ç¦»å‡ºæ¥å½¢æˆå¯é‡ç”¨çš„ç»„ä»¶ã€‚</strong></p>
<p>é¢å‘åˆ‡é¢ç¼–ç¨‹å¾€å¾€è¢«å®šä¹‰ä¸ºä¿ƒä½¿åº”ç”¨ç¨‹åºåˆ†ç¦»å…³æ³¨ç‚¹çš„ä¸€é¡¹æŠ€æœ¯ã€‚ç³»ç»Ÿç”±è®¸å¤šä¸åŒç»„ä»¶ç»„æˆï¼Œæ¯ä¸€ä¸ªç»„ä»¶å„è´Ÿè´£ä¸€å—ç‰¹å®šçš„åŠŸèƒ½ã€‚é™¤äº†å®ç°è‡ªèº«æ ¸å¿ƒçš„åŠŸèƒ½ä¹‹å¤–ï¼Œè¿™äº›ç»„ä»¶è¿˜ç»å¸¸æ‰¿æ‹…ç€é¢å¤–çš„èŒè´£ã€‚è¯¸å¦‚æ—¥å¿—ã€äº‹åŠ¡ç®¡ç†å’Œå®‰å…¨æ­¤ç±»çš„ç³»ç»ŸæœåŠ¡ç»å¸¸èå…¥åˆ°æœ‰è‡ªèº«æ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„ç»„ä»¶ä¸­å»ï¼Œè¿™äº›ç³»ç»ŸæœåŠ¡é€šå¸¸è¢«ç§°ä¸ºæ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œå› ä¸ºå®ƒä»¬æ€»æ˜¯è·¨è¶Šç³»ç»Ÿçš„å¤šä¸ªç»„ä»¶ã€‚</p>
<p>å¦‚æœå°†è¿™äº›å…³æ³¨ç‚¹åˆ†æ•£åˆ°å¤šä¸ªç»„ä»¶ä¸­å»ï¼Œä»£ç å°†å¼•å…¥åŒé‡å¤æ‚æ€§ï¼š</p>
<ul>
<li>éå¸ƒç³»ç»Ÿçš„å…³æ³¨ç‚¹å®ç°ä»£ç å°†ä¼šé‡å¤å‡ºç°åœ¨å¤šä¸ªç»„ä»¶ä¸­ã€‚è¿™æ„å‘³ç€å¦‚æœä½ è¦æ”¹å˜è¿™äº›å…³æ³¨ç‚¹çš„é€»è¾‘ï¼Œä½ å¿…é¡»ä¿®æ”¹å„ä¸ªæ¨¡å—çš„ç›¸å…³å®ç°ã€‚</li>
<li>ç»„ä»¶ä¼šå› ä¸ºé‚£äº›ä¸è‡ªèº«æ ¸å¿ƒä¸šåŠ¡æ— å…³çš„ä»£ç è€Œå˜å¾—æ··ä¹±ã€‚ä¸€ä¸ªå‘åœ°å€ç°¿å¢åŠ åœ°å€æ¡ç›®çš„æ–¹æ³•åº”è¯¥åªå…³æ³¨å¦‚ä½•æ·»åŠ åœ°å€ï¼Œè€Œä¸åº”è¯¥å…³æ³¨å®ƒæ˜¯ä¸æ˜¯å®‰å…¨çš„æˆ–è€…æ˜¯å¦éœ€è¦æ”¯æŒäº‹åŠ¡ã€‚</li>
</ul>
<p>å›¾ 1.2 å±•ç¤ºäº†è¿™ç§å¤æ‚æ€§ã€‚å·¦è¾¹çš„ä¸šåŠ¡å¯¹è±¡ä¸ç³»ç»Ÿçº§æœåŠ¡ç»“åˆå¾—è¿‡äºç´§å¯†ã€‚æ¯ä¸ªå¯¹è±¡ä¸ä½†è¦çŸ¥é“å®ƒéœ€è¦è®°æ—¥å¿—ã€è¿›è¡Œå®‰å…¨æ§åˆ¶å’Œå‚ä¸äº‹åŠ¡ï¼Œè¿˜è¦äº²è‡ªæ‰§è¡Œè¿™äº›æœåŠ¡ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211027110842477.png" alt="image-20211027110842477"></p>
<center>
    å›¾ 1.2ã€€åœ¨æ•´ä¸ªç³»ç»Ÿå†…ï¼Œå…³æ³¨ç‚¹ï¼ˆä¾‹å¦‚æ—¥å¿—å’Œå®‰å…¨ï¼‰çš„è°ƒç”¨ç»å¸¸æ•£å¸ƒåˆ°å„ä¸ªæ¨¡å—ä¸­ï¼Œè€Œè¿™äº›å…³æ³¨ç‚¹å¹¶ä¸æ˜¯æ¨¡å—çš„æ ¸å¿ƒä¸šåŠ¡
</center>


<p><strong>AOP ä½¿è¿™äº›æœåŠ¡æ¨¡å—åŒ–ï¼Œå¹¶ä»¥å£°æ˜çš„æ–¹å¼å°†å®ƒä»¬åº”ç”¨åˆ°éœ€è¦çš„ç»„ä»¶ä¸­å»ã€‚</strong>ç»“æœæ˜¯è¿™äº›ç»„ä»¶å…·æœ‰æ›´é«˜çš„å†…èšæ€§ä»¥åŠæ›´åŠ å…³æ³¨è‡ªèº«ä¸šåŠ¡ï¼Œå®Œå…¨ä¸éœ€è¦äº†è§£å¯èƒ½æ¶‰åŠçš„ç³»ç»ŸæœåŠ¡çš„å¤æ‚æ€§ã€‚æ€»ä¹‹ï¼ŒAOP ç¡®ä¿ POJO ä¿æŒç®€å•ã€‚</p>
<p>å¦‚å›¾ 1.3 æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåˆ‡é¢æƒ³è±¡ä¸ºè¦†ç›–åœ¨å¾ˆå¤šç»„ä»¶ä¹‹ä¸Šçš„ä¸€ä¸ªå¤–å£³ã€‚åº”ç”¨æ˜¯ç”±é‚£äº›å®ç°å„è‡ªä¸šåŠ¡åŠŸèƒ½çš„æ¨¡å—ç»„æˆçš„ã€‚å€ŸåŠ© AOPï¼Œå¯ä»¥ä½¿ç”¨å„ç§åŠŸèƒ½å±‚å»åŒ…è£¹æ ¸å¿ƒä¸šåŠ¡å±‚ã€‚è¿™äº›å±‚ä»¥å£°æ˜çš„æ–¹å¼çµæ´»åœ°åº”ç”¨åˆ°ç³»ç»Ÿä¸­ï¼Œä½ çš„æ ¸å¿ƒåº”ç”¨ç”šè‡³æ ¹æœ¬ä¸çŸ¥é“å®ƒä»¬çš„å­˜åœ¨ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ç†å¿µï¼Œå¯ä»¥å°†å®‰å…¨ã€äº‹åŠ¡å’Œæ—¥å¿—å…³æ³¨ç‚¹ä¸æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ç›¸åˆ†ç¦»ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211027111030810.png" alt="image-20211027111030810"></p>
<center>å›¾ 1.3ã€€åˆ©ç”¨ AOPï¼Œç³»ç»ŸèŒƒå›´å†…çš„å…³æ³¨ç‚¹è¦†ç›–åœ¨å®ƒä»¬æ‰€å½±å“ç»„ä»¶ä¹‹ä¸Š</center>

<p>ä¸ºäº†ç¤ºèŒƒåœ¨ Spring ä¸­å¦‚ä½•åº”ç”¨åˆ‡é¢ï¼Œè®©æˆ‘ä»¬é‡æ–°å›åˆ°éª‘å£«çš„ä¾‹å­ï¼Œå¹¶ä¸ºå®ƒæ·»åŠ ä¸€ä¸ªåˆ‡é¢ã€‚</p>
<p><strong>AOP åº”ç”¨</strong></p>
<p>æ¯ä¸€ä¸ªäººéƒ½ç†ŸçŸ¥éª‘å£«æ‰€åšçš„ä»»ä½•äº‹æƒ…ï¼Œè¿™æ˜¯å› ä¸ºåŸæ¸¸è¯—äººç”¨è¯—æ­Œè®°è½½äº†éª‘å£«çš„äº‹è¿¹å¹¶å°†å…¶è¿›è¡Œä¼ å”±ã€‚å‡è®¾æˆ‘ä»¬éœ€è¦ä½¿ç”¨åŸæ¸¸è¯—äººè¿™ä¸ªæœåŠ¡ç±»æ¥è®°è½½éª‘å£«çš„æ‰€æœ‰äº‹è¿¹ã€‚ç¨‹åºæ¸…å• 1.9 å±•ç¤ºäº†æˆ‘ä»¬ä¼šä½¿ç”¨çš„ Minstrel ç±»ã€‚</p>
<center>ç¨‹åºæ¸…å• 1.9 åŸæ¸¸è¯—äººæ˜¯ä¸­ä¸–çºªçš„éŸ³ä¹è®°å½•å™¨</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Minstrel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PrintStream stream;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Minstrel</span><span class="params">(PrintStream stream)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stream = stream;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">singBeforeQuest</span><span class="params">()</span> </span>&#123; <span class="comment">// æ¢é™©ä¹‹å‰è°ƒç”¨</span></span><br><span class="line">        stream.println(<span class="string">&quot;Fa la la, the knight is so brave!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">singAfterQuest</span><span class="params">()</span> </span>&#123; <span class="comment">// æ¢é™©ä¹‹åè°ƒç”¨</span></span><br><span class="line">        stream.println(<span class="string">&quot;Tee hee hee, the brave knight &quot;</span> + <span class="string">&quot;did embark on a quest!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„é‚£æ ·ï¼ŒMinstrel æ˜¯åªæœ‰ä¸¤ä¸ªæ–¹æ³•çš„ç®€å•ç±»ã€‚åœ¨éª‘å£«æ‰§è¡Œæ¯ä¸€ä¸ªæ¢é™©ä»»åŠ¡ä¹‹å‰ï¼ŒsingBeforeQuest() æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼›åœ¨éª‘å£«å®Œæˆæ¢é™©ä»»åŠ¡ä¹‹åï¼ŒsingAfterQuest() æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼ŒMinstrel éƒ½ä¼šé€šè¿‡ä¸€ä¸ª PrintStream ç±»æ¥æ­Œé¢‚éª‘å£«çš„äº‹è¿¹ï¼Œè¿™ä¸ªç±»æ˜¯é€šè¿‡æ„é€ å™¨æ³¨å…¥è¿›æ¥çš„ã€‚</p>
<p>æŠŠ Minstrel åŠ å…¥ä½ çš„ä»£ç ä¸­å¹¶ä½¿å…¶è¿è¡Œèµ·æ¥ï¼Œè¿™å¯¹ä½ æ¥è¯´æ˜¯å°äº‹ä¸€æ¡©ã€‚æˆ‘ä»¬é€‚å½“åšä¸€ä¸‹è°ƒæ•´ä»è€Œè®© BraveKnight å¯ä»¥ä½¿ç”¨ Minstrelã€‚ç¨‹åºæ¸…å• 1.10 å±•ç¤ºäº†å°† BraveKnight å’Œ Minstrel ç»„åˆèµ·æ¥çš„ç¬¬ä¸€æ¬¡å°è¯•ã€‚</p>
<center>ç¨‹åºæ¸…å• 1.10ã€€BraveKnight å¿…é¡»è¦è°ƒç”¨ Minstrel çš„æ–¹æ³•</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springinaction.knights;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BraveKnight</span> <span class="keyword">implements</span> <span class="title">Knight</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Quest quest;</span><br><span class="line">    <span class="keyword">private</span> Minstrel minstrel;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BraveKnight</span><span class="params">(Quest quest, Minstrel minstrel)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.quest = quest;</span><br><span class="line">        <span class="keyword">this</span>.minstrel = minstrel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">embarkOnQuest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        minstrel.singBeforeQuest(); <span class="comment">// Knight åº”è¯¥ç®¡ç†å®ƒçš„ Minstrel å—ï¼Ÿ</span></span><br><span class="line">        quest.embark();</span><br><span class="line">        minstrel.singAfterQuest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™åº”è¯¥å¯ä»¥è¾¾åˆ°é¢„æœŸæ•ˆæœã€‚ç°åœ¨ï¼Œä½ æ‰€éœ€è¦åšçš„å°±æ˜¯å›åˆ° Spring é…ç½®ä¸­ï¼Œå£°æ˜ Minstrel bean å¹¶å°†å…¶æ³¨å…¥åˆ° BraveKnightçš„æ„é€ å™¨ä¹‹ä¸­ã€‚</p>
<p>ç®¡ç†ä»–çš„åŸæ¸¸è¯—äººçœŸçš„æ˜¯éª‘å£«èŒè´£èŒƒå›´å†…çš„å·¥ä½œå—ï¼Ÿä¸ºä»€ä¹ˆéª‘å£«è¿˜éœ€è¦æé†’åŸæ¸¸è¯—äººå»åšä»–ä»½å†…çš„äº‹æƒ…å‘¢ï¼Ÿ</p>
<p>æ­¤å¤–ï¼Œå› ä¸ºéª‘å£«éœ€è¦çŸ¥é“åŸæ¸¸è¯—äººï¼Œæ‰€ä»¥å°±å¿…é¡»æŠŠåŸæ¸¸è¯—äººæ³¨å…¥åˆ° BarveKnight ç±»ä¸­ã€‚è¿™ä¸ä»…ä½¿ BraveKnight çš„ä»£ç å¤æ‚åŒ–äº†ï¼Œè€Œä¸”è¿˜è®©æˆ‘ç–‘æƒ‘æ˜¯å¦è¿˜éœ€è¦ä¸€ä¸ªä¸éœ€è¦åŸæ¸¸è¯—äººçš„éª‘å£«å‘¢ï¼Ÿå¦‚æœ Minstrel ä¸º null ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿæˆ‘æ˜¯å¦åº”è¯¥å¼•å…¥ä¸€ä¸ªç©ºå€¼æ ¡éªŒé€»è¾‘æ¥è¦†ç›–è¯¥åœºæ™¯ï¼Ÿ</p>
<p>ç®€å•çš„ BraveKnight ç±»å¼€å§‹å˜å¾—å¤æ‚ï¼Œå¦‚æœä½ è¿˜éœ€è¦åº”å¯¹æ²¡æœ‰åŸæ¸¸è¯—äººæ—¶çš„åœºæ™¯ï¼Œé‚£ä»£ç ä¼šå˜å¾—æ›´å¤æ‚ã€‚ä½†åˆ©ç”¨ AOPï¼Œä½ å¯ä»¥å£°æ˜åŸæ¸¸è¯—äººå¿…é¡»æ­Œé¢‚éª‘å£«çš„æ¢é™©äº‹è¿¹ï¼Œè€Œéª‘å£«æœ¬èº«å¹¶ä¸ç”¨ç›´æ¥è®¿é—® Minstrel çš„æ–¹æ³•ã€‚</p>
<p>è¦å°† Minstrel æŠ½è±¡ä¸ºä¸€ä¸ªåˆ‡é¢ï¼Œä½ æ‰€éœ€è¦åšçš„äº‹æƒ…å°±æ˜¯åœ¨ä¸€ä¸ª Spring é…ç½®æ–‡ä»¶ä¸­å£°æ˜å®ƒã€‚ç¨‹åºæ¸…å• 1.11 æ˜¯æ›´æ–°åçš„knights.xml æ–‡ä»¶ï¼ŒMinstrel è¢«å£°æ˜ä¸ºä¸€ä¸ªåˆ‡é¢ã€‚</p>
<center>ç¨‹åºæ¸…å•1.11ã€€å°† Minstrel å£°æ˜ä¸ºä¸€ä¸ªåˆ‡é¢</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/aop </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;knight&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.springinaction.knights.BraveKnight&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;quest&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;quest&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.springinaction.knights.SlayDragonQuest&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;T(System).out&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;minstrel&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.springinaction.knights.Minstrel&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;T(System).out&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;minstrel&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--å®šä¹‰åˆ‡ç‚¹--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;embark&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* *.embarkOnQuest(..))&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--å£°æ˜å‰ç½®é€šçŸ¥--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;embark&quot;</span> <span class="attr">method</span>=<span class="string">&quot;singBeforeQuest&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--å£°æ˜åç½®é€šçŸ¥--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;embark&quot;</span> <span class="attr">method</span>=<span class="string">&quot;singAfterQuest&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä½¿ç”¨äº† Spring çš„ AOP é…ç½®çš„å‘½åç©ºé—´æŠŠ Minstrel Bean å£°æ˜ä¸ºä¸€ä¸ªåˆ‡é¢ã€‚é¦–å…ˆï¼Œå¿…é¡»æŠŠ Minstrel å£°æ˜ä¸ºä¸€ä¸ª Beanï¼Œç„¶åå† <code>&lt;aop:aspect&gt;</code> å…ƒç´ ä¸­å¼•ç”¨è¯¥ Beanã€‚ä¸ºäº†è¿›ä¸€æ­¥å®šä¹‰åˆ‡é¢ï¼Œå¿…é¡»ä½¿ç”¨ <code>&lt;aop:before&gt;</code> æ¥å£°æ˜åœ¨ embarkOnQuest() æ–¹æ³•æ‰§è¡Œå‰è°ƒç”¨ Minstrel çš„ singBeforeQuest() æ–¹æ³•ã€‚è¿™ç§æ–¹å¼ç§°ä¸ºå‰ç½®é€šçŸ¥ã€‚åŒæ—¶ï¼Œä½¿ç”¨ <code>&lt;aop:after&gt;</code> çš„æ–¹å¼è¢«ç§°ä¸ºåç½®é€šçŸ¥ã€‚</p>
<p>åœ¨è¿™ä¸¤ç§æ–¹å¼ä¸­ï¼Œpointcut-ref å±æ€§éƒ½å¼•ç”¨äº†åå­—ä¸º embark çš„åˆ‡å…¥ç‚¹ã€‚è¯¥åˆ‡å…¥ç‚¹æ˜¯åœ¨å‰è¾¹çš„ <code>&lt;pointcut&gt;</code> å…ƒç´ ä¸­å®šä¹‰çš„ï¼Œå¹¶é…ç½® expression å±æ€§æ¥é€‰æ‹©æ‰€åº”ç”¨çš„é€šçŸ¥ã€‚è¡¨è¾¾å¼çš„è¯­æ³•é‡‡ç”¨çš„æ˜¯ AspectJ çš„åˆ‡ç‚¹è¡¨è¾¾å¼è¯­è¨€ã€‚</p>
<p>é€šè¿‡å°‘é‡çš„ XML é…ç½®ï¼Œå°±å¯ä»¥æŠŠ Minstrel å£°æ˜ä¸ºä¸€ä¸ª Spring åˆ‡é¢ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªç¤ºä¾‹ä¸­è·å¾—ä¸¤ä¸ªé‡è¦çš„è§‚ç‚¹ã€‚</p>
<p>é¦–å…ˆï¼ŒMinstrel ä»ç„¶æ˜¯ä¸€ä¸ª POJOï¼Œæ²¡æœ‰ä»»ä½•ä»£ç è¡¨æ˜å®ƒè¦è¢«ä½œä¸ºä¸€ä¸ªåˆ‡é¢ä½¿ç”¨ã€‚å½“æˆ‘ä»¬æŒ‰ç…§ä¸Šé¢é‚£æ ·è¿›è¡Œé…ç½®åï¼Œåœ¨ Spring çš„ä¸Šä¸‹æ–‡ä¸­ï¼ŒMinstrel å®é™…ä¸Šå·²ç»å˜æˆä¸€ä¸ªåˆ‡é¢äº†ã€‚</p>
<p>å…¶æ¬¡ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ï¼ŒMinstrel å¯ä»¥è¢«åº”ç”¨åˆ° BraveKnight ä¸­ï¼Œè€Œ BraveKnight ä¸éœ€è¦æ˜¾å¼åœ°è°ƒç”¨å®ƒã€‚å®é™…ä¸Šï¼ŒBraveKnight å®Œå…¨ä¸çŸ¥é“ Minstrel çš„å­˜åœ¨ã€‚</p>
<p>å¿…é¡»è¿˜è¦æŒ‡å‡ºçš„æ˜¯ï¼Œå°½ç®¡æˆ‘ä»¬ä½¿ç”¨ Spring é­”æ³•æŠŠ Minstrel è½¬å˜ä¸ºä¸€ä¸ªåˆ‡é¢ï¼Œä½†é¦–å…ˆè¦æŠŠå®ƒå£°æ˜ä¸ºä¸€ä¸ªSpring beanã€‚èƒ½å¤Ÿä¸ºå…¶ä»– Spring bean åšåˆ°çš„äº‹æƒ…éƒ½å¯ä»¥åŒæ ·åº”ç”¨åˆ° Spring åˆ‡é¢ä¸­ï¼Œä¾‹å¦‚ä¸ºå®ƒä»¬æ³¨å…¥ä¾èµ–ã€‚</p>
<h4 id="ä½¿ç”¨æ¨¡æ¿æ¶ˆé™¤æ ·æ¿å¼ä»£ç "><a href="#ä½¿ç”¨æ¨¡æ¿æ¶ˆé™¤æ ·æ¿å¼ä»£ç " class="headerlink" title="ä½¿ç”¨æ¨¡æ¿æ¶ˆé™¤æ ·æ¿å¼ä»£ç "></a>ä½¿ç”¨æ¨¡æ¿æ¶ˆé™¤æ ·æ¿å¼ä»£ç </h4><p>ä½ æ˜¯å¦å†™è¿‡è¿™æ ·çš„ä»£ç ï¼Œå½“ç¼–å†™çš„æ—¶å€™æ€»ä¼šæ„Ÿè§‰ä»¥å‰æ›¾ç»è¿™ä¹ˆå†™è¿‡ï¼Ÿæˆ‘çš„æœ‹å‹ï¼Œè¿™ä¸æ˜¯ä¼¼æ›¾ç›¸è¯†ã€‚è¿™æ˜¯æ ·æ¿å¼çš„ä»£ç ï¼ˆboilerplate codeï¼‰ã€‚é€šå¸¸ä¸ºäº†å®ç°é€šç”¨çš„å’Œç®€å•çš„ä»»åŠ¡ï¼Œä½ ä¸å¾—ä¸ä¸€ééåœ°é‡å¤ç¼–å†™è¿™æ ·çš„ä»£ç ã€‚</p>
<p>é—æ†¾çš„æ˜¯ï¼Œå®ƒä»¬ä¸­çš„å¾ˆå¤šæ˜¯å› ä¸ºä½¿ç”¨ Java API è€Œå¯¼è‡´çš„æ ·æ¿å¼ä»£ç ã€‚æ ·æ¿å¼ä»£ç çš„ä¸€ä¸ªå¸¸è§èŒƒä¾‹æ˜¯ä½¿ç”¨ JDBC è®¿é—®æ•°æ®åº“æŸ¥è¯¢æ•°æ®ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ æ›¾ç»ç”¨è¿‡ JDBCï¼Œé‚£ä¹ˆä½ æˆ–è®¸ä¼šå†™å‡ºç±»ä¼¼ä¸‹é¢çš„ä»£ç ã€‚</p>
<center>ç¨‹åºæ¸…å• 1.12ã€€è®¸å¤š Java APIï¼Œä¾‹å¦‚ JDBCï¼Œä¼šæ¶‰åŠç¼–å†™å¤§é‡çš„æ ·æ¿å¼ä»£ç </center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmployeeById</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;   </span><br><span class="line">    Connection conn = <span class="keyword">null</span>;</span><br><span class="line">    PreparedStatement stmt = <span class="keyword">null</span>;</span><br><span class="line">    ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        conn = dataSource.getConnection();</span><br><span class="line">        stmt = conn.prepareStatement(<span class="string">&quot;select id, firstname, lastname, salary from employee where id=?&quot;</span>);</span><br><span class="line">        stmt.setLong(<span class="number">1</span>, id);</span><br><span class="line">        rs = stmt.executeQuery();</span><br><span class="line">        Employee employee = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">            employee = <span class="keyword">new</span> Employee();</span><br><span class="line">            employee.setId(rs.getLong(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">            employee.setFirstName(rs.getString(<span class="string">&quot;firstname&quot;</span>));</span><br><span class="line">            employee.setLastName(rs.getString(<span class="string">&quot;lastname&quot;</span>));</span><br><span class="line">            employee.setSalary(rs.getBigDecimal(<span class="string">&quot;salary&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> employee;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (rs != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¿™æ®µ JDBC ä»£ç æŸ¥è¯¢æ•°æ®åº“è·å¾—å‘˜å·¥å§“åå’Œè–ªæ°´ã€‚æˆ‘æ‰“èµŒä½ å¾ˆéš¾æŠŠä¸Šé¢çš„ä»£ç é€è¡Œçœ‹å®Œï¼Œè¿™æ˜¯å› ä¸ºå°‘é‡æŸ¥è¯¢å‘˜å·¥çš„ä»£ç æ·¹æ²¡åœ¨ä¸€å † JDBC çš„æ ·æ¿å¼ä»£ç ä¸­ã€‚é¦–å…ˆä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ªè¯­å¥å¯¹è±¡ï¼Œæœ€åä½ æ‰èƒ½è¿›è¡ŒæŸ¥è¯¢ã€‚ä¸ºäº†å¹³æ¯ JDBC å¯èƒ½ä¼šå‡ºç°çš„æ€’ç«ï¼Œä½ å¿…é¡»æ•æ‰ SQLExceptionï¼Œè¿™æ˜¯ä¸€ä¸ªæ£€æŸ¥å‹å¼‚å¸¸ï¼Œå³ä½¿å®ƒæŠ›å‡ºåä½ ä¹Ÿåšä¸äº†å¤ªå¤šäº‹æƒ…ã€‚æœ€åï¼Œæ¯•ç«Ÿè¯¥è¯´çš„ä¹Ÿè¯´äº†ï¼Œè¯¥åšçš„ä¹Ÿåšäº†ï¼Œä½ ä¸å¾—ä¸æ¸…ç†æˆ˜åœºï¼Œå…³é—­æ•°æ®åº“è¿æ¥ã€è¯­å¥å’Œç»“æœé›†ã€‚åŒæ ·ä¸ºäº†å¹³æ¯ JDBC å¯èƒ½ä¼šå‡ºç°çš„æ€’ç«ï¼Œä½ ä¾ç„¶è¦æ•æ‰ SQLExceptionã€‚</p>
<p>ç¨‹åºæ¸…å• 1.12 ä¸­çš„ä»£ç å’Œä½ å®ç°å…¶ä»– JDBC æ“ä½œæ—¶æ‰€å†™çš„ä»£ç å‡ ä¹æ˜¯ç›¸åŒçš„ã€‚åªæœ‰å°‘é‡çš„ä»£ç ä¸æŸ¥è¯¢å‘˜å·¥é€»è¾‘æœ‰å…³ç³»ï¼Œå…¶ä»–çš„ä»£ç éƒ½æ˜¯ JDBC çš„æ ·æ¿ä»£ç ã€‚</p>
<p>JDBC ä¸æ˜¯äº§ç”Ÿæ ·æ¿å¼ä»£ç çš„å”¯ä¸€åœºæ™¯ã€‚åœ¨è®¸å¤šç¼–ç¨‹åœºæ™¯ä¸­å¾€å¾€éƒ½ä¼šå¯¼è‡´ç±»ä¼¼çš„æ ·æ¿å¼ä»£ç ï¼ŒJMSã€JNDI å’Œä½¿ç”¨ REST æœåŠ¡é€šå¸¸ä¹Ÿæ¶‰åŠå¤§é‡çš„é‡å¤ä»£ç ã€‚</p>
<p><strong>Spring æ—¨åœ¨é€šè¿‡æ¨¡æ¿å°è£…æ¥æ¶ˆé™¤æ ·æ¿å¼ä»£ç ã€‚</strong>Spring çš„ JdbcTemplate ä½¿å¾—åœ¨æ‰§è¡Œæ•°æ®åº“æ“ä½œæ—¶ï¼Œé¿å…ä¼ ç»Ÿçš„ JDBC æ ·æ¿å¼ä»£ç ç§°ä¸ºäº†å¯èƒ½ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä½¿ç”¨ Spring çš„ JdbcTemplateï¼ˆåˆ©ç”¨äº† Java 5 ç‰¹æ€§çš„ JdbcTemplate å®ç°ï¼‰é‡å†™çš„ getEmployeeById() æ–¹æ³•ä»…ä»…å…³æ³¨äºè·å–å‘˜å·¥æ•°æ®çš„æ ¸å¿ƒé€»è¾‘ï¼Œè€Œä¸éœ€è¦è¿åˆ JDBC API çš„éœ€æ±‚ã€‚ç¨‹åºæ¸…å• 1.13 å±•ç¤ºäº†ä¿®è®¢åçš„ getEmployeeById() æ–¹æ³•ã€‚</p>
<center>ç¨‹åºæ¸…å•1.13ã€€æ¨¡æ¿èƒ½å¤Ÿè®©ä½ çš„ä»£ç å…³æ³¨äºè‡ªèº«çš„èŒè´£</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmployeeByid</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> jdbcTemplate.queryforobject(<span class="string">&quot;select id, firstname, lastname, salary&quot;</span> +</span><br><span class="line">                                      <span class="string">&quot;from employee where id=?&quot;</span>,</span><br><span class="line">                                      <span class="keyword">new</span> RowMapper&lt;Employee&gt;() &#123;</span><br><span class="line">                                          <span class="function"><span class="keyword">public</span> Employee <span class="title">maprow</span><span class="params">(ResultSet rs,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                                <span class="keyword">int</span> rowNum)</span> throw SQLException </span>&#123;</span><br><span class="line">                                              Emplyee employee = <span class="keyword">new</span> Employee();</span><br><span class="line">                                              employee.setId(rs.getLong(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">                                              employee.setFirstName(rs.getString(<span class="string">&quot;firstname&quot;</span>));</span><br><span class="line">                                              employee.setLastName(rs.getString(<span class="string">&quot;lastName&quot;</span>));</span><br><span class="line">                                              employee.setSalary(rs.getBigDecimal(<span class="string">&quot;salary&quot;</span>));</span><br><span class="line">                                              <span class="keyword">return</span> employee;</span><br><span class="line">                                          &#125;</span><br><span class="line">                                      &#125;,</span><br><span class="line">                                      id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæ–°ç‰ˆæœ¬çš„ getEmployeeById() ç®€å•å¤šäº†ï¼Œè€Œä¸”ä»…ä»…å…³æ³¨äºä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‘˜å·¥ã€‚æ¨¡æ¿çš„ queryForObject() æ–¹æ³•éœ€è¦ä¸€ä¸ª SQL æŸ¥è¯¢è¯­å¥ï¼Œä¸€ä¸ª RowMapper å¯¹è±¡ï¼ˆæŠŠæ•°æ®æ˜ å°„ä¸ºä¸€ä¸ªåŸŸå¯¹è±¡ï¼‰ï¼Œé›¶ä¸ªæˆ–å¤šä¸ªæŸ¥è¯¢å‚æ•°ã€‚GetEmployeeById() æ–¹æ³•å†ä¹Ÿçœ‹ä¸åˆ°ä»¥å‰çš„ JDBC æ ·æ¿å¼ä»£ç äº†ï¼Œå®ƒä»¬å…¨éƒ¨è¢«å°è£…åˆ°äº†æ¨¡æ¿ä¸­ã€‚</p>
<p>æˆ‘å·²ç»å‘ä½ å±•ç¤ºäº† Spring é€šè¿‡é¢å‘ POJO ç¼–ç¨‹ã€DIã€åˆ‡é¢å’Œæ¨¡æ¿æŠ€æœ¯æ¥ç®€åŒ– Java å¼€å‘ä¸­çš„å¤æ‚æ€§ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘å±•ç¤ºäº†åœ¨åŸºäº XML çš„é…ç½®æ–‡ä»¶ä¸­å¦‚ä½•é…ç½® bean å’Œåˆ‡é¢ï¼Œä½†è¿™äº›æ–‡ä»¶æ˜¯å¦‚ä½•åŠ è½½çš„å‘¢ï¼Ÿå®ƒä»¬è¢«åŠ è½½åˆ°å“ªé‡Œå»äº†ï¼Ÿè®©æˆ‘ä»¬å†äº†è§£ä¸‹ Spring å®¹å™¨ï¼Œè¿™æ˜¯åº”ç”¨ä¸­çš„æ‰€æœ‰ bean æ‰€é©»ç•™çš„åœ°æ–¹ã€‚</p>
<h3 id="å®¹çº³ä½ çš„-Bean"><a href="#å®¹çº³ä½ çš„-Bean" class="headerlink" title="å®¹çº³ä½ çš„ Bean"></a>å®¹çº³ä½ çš„ Bean</h3><p>åœ¨åŸºäº Spring çš„åº”ç”¨ä¸­ï¼Œåº”ç”¨å¯¹è±¡ç”Ÿå­˜äº Spring å®¹å™¨ä¸­ã€‚Spring å®¹å™¨åˆ›å»ºå¯¹è±¡ï¼Œè£…é…å®ƒä»¬ï¼Œé…ç½®å®ƒä»¬ï¼Œç®¡ç†å®ƒä»¬çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œä»ç”Ÿå­˜åˆ°æ­»äº¡ï¼ˆæˆ–è€…ä»åˆ›å»ºåˆ°é”€æ¯ï¼‰ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211027114018559.png" alt="image-20211027114018559"></p>
<center>å›¾ 1.4ã€€åœ¨ Spring åº”ç”¨ä¸­ï¼Œå¯¹è±¡ç”± Spring å®¹å™¨åˆ›å»ºå’Œè£…é…ï¼Œå¹¶å­˜åœ¨å®¹å™¨ä¹‹ä¸­</center>

<p>åœ¨ä¸‹ä¸€ç« ï¼Œä½ å°†äº†è§£å¦‚ä½•é…ç½®Springï¼Œä»è€Œè®©å®ƒçŸ¥é“è¯¥åˆ›å»ºã€é…ç½®å’Œç»„è£…å“ªäº›å¯¹è±¡ã€‚ä½†é¦–å…ˆï¼Œæœ€é‡è¦çš„æ˜¯äº†è§£å®¹çº³å¯¹è±¡çš„å®¹å™¨ã€‚ç†è§£å®¹å™¨å°†æœ‰åŠ©äºç†è§£å¯¹è±¡æ˜¯å¦‚ä½•è¢«ç®¡ç†çš„ã€‚</p>
<p>å®¹å™¨æ˜¯ Spring æ¡†æ¶çš„æ ¸å¿ƒã€‚Spring å®¹å™¨ä½¿ç”¨ DI ç®¡ç†æ„æˆåº”ç”¨çš„ç»„ä»¶ï¼Œå®ƒä¼šåˆ›å»ºç›¸äº’åä½œçš„ç»„ä»¶ä¹‹é—´çš„å…³è”ã€‚æ¯«æ— ç–‘é—®ï¼Œè¿™äº›å¯¹è±¡æ›´ç®€å•å¹²å‡€ï¼Œæ›´æ˜“äºç†è§£ï¼Œæ›´æ˜“äºé‡ç”¨å¹¶ä¸”æ›´æ˜“äºè¿›è¡Œå•å…ƒæµ‹è¯•ã€‚</p>
<p>Spring å®¹å™¨å¹¶ä¸æ˜¯åªæœ‰ä¸€ä¸ªã€‚Spring è‡ªå¸¦äº†å¤šä¸ªå®¹å™¨å®ç°ï¼Œå¯ä»¥å½’ä¸ºä¸¤ç§ä¸åŒçš„ç±»å‹ã€‚bean å·¥å‚ï¼ˆç”± org.springframework.beans.factory.beanFactory æ¥å£å®šä¹‰ï¼‰æ˜¯æœ€ç®€å•çš„å®¹å™¨ï¼Œæä¾›åŸºæœ¬çš„ DI æ”¯æŒã€‚åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆç”± org.springframework.context.ApplicationContext æ¥å£å®šä¹‰ï¼‰åŸºäº BeanFactory æ„å»ºï¼Œå¹¶æä¾›åº”ç”¨æ¡†æ¶çº§åˆ«çš„æœåŠ¡ï¼Œä¾‹å¦‚ä»å±æ€§æ–‡ä»¶è§£ææ–‡æœ¬ä¿¡æ¯ä»¥åŠå‘å¸ƒåº”ç”¨äº‹ä»¶ç»™æ„Ÿå…´è¶£çš„äº‹ä»¶ç›‘å¬è€…ã€‚è™½ç„¶æˆ‘ä»¬å¯ä»¥åœ¨ bean å·¥å‚å’Œåº”ç”¨ä¸Šä¸‹æ–‡ä¹‹é—´ä»»é€‰ä¸€ç§ï¼Œä½† bean å·¥å‚å¯¹å¤§å¤šæ•°åº”ç”¨æ¥è¯´å¾€å¾€å¤ªä½çº§äº†ï¼Œå› æ­¤ï¼Œåº”ç”¨ä¸Šä¸‹æ–‡è¦æ¯” bean å·¥å‚æ›´å—æ¬¢è¿ã€‚</p>
<h4 id="ä½¿ç”¨åº”ç”¨ä¸Šä¸‹æ–‡"><a href="#ä½¿ç”¨åº”ç”¨ä¸Šä¸‹æ–‡" class="headerlink" title="ä½¿ç”¨åº”ç”¨ä¸Šä¸‹æ–‡"></a>ä½¿ç”¨åº”ç”¨ä¸Šä¸‹æ–‡</h4><p>Spring è‡ªå¸¦äº†å¤šç§ç±»å‹çš„åº”ç”¨ä¸Šä¸‹æ–‡ã€‚ä¸‹é¢ç½—åˆ—çš„å‡ ä¸ªæ˜¯ä½ æœ€æœ‰å¯èƒ½é‡åˆ°çš„ã€‚</p>
<ul>
<li>AnnotationConfigApplicationContextï¼šä»ä¸€ä¸ªæˆ–å¤šä¸ªåŸºäº Java çš„é…ç½®ç±»ä¸­åŠ è½½ Spring åº”ç”¨ä¸Šä¸‹æ–‡ã€‚</li>
<li>AnnotationConfigWebApplicationContextï¼šä»ä¸€ä¸ªæˆ–å¤šä¸ªåŸºäº Java çš„é…ç½®ç±»ä¸­åŠ è½½ Spring Web åº”ç”¨ä¸Šä¸‹æ–‡ã€‚</li>
<li>ClassPathXmlApplicationContextï¼šä»ç±»è·¯å¾„ä¸‹çš„ä¸€ä¸ªæˆ–å¤šä¸ª XML é…ç½®æ–‡ä»¶ä¸­åŠ è½½ä¸Šä¸‹æ–‡å®šä¹‰ï¼ŒæŠŠåº”ç”¨ä¸Šä¸‹æ–‡çš„å®šä¹‰æ–‡ä»¶ä½œä¸ºç±»èµ„æºã€‚</li>
<li>FileSystemXmlapplicationcontextï¼šä»æ–‡ä»¶ç³»ç»Ÿä¸‹çš„ä¸€ä¸ªæˆ–å¤šä¸ª XML é…ç½®æ–‡ä»¶ä¸­åŠ è½½ä¸Šä¸‹æ–‡å®šä¹‰ã€‚</li>
<li>XmlWebApplicationContextï¼šä» Web åº”ç”¨ä¸‹çš„ä¸€ä¸ªæˆ–å¤šä¸ª XML é…ç½®æ–‡ä»¶ä¸­åŠ è½½ä¸Šä¸‹æ–‡å®šä¹‰ã€‚</li>
</ul>
<p>æ— è®ºæ˜¯ä»æ–‡ä»¶ç³»ç»Ÿä¸­è£…è½½åº”ç”¨ä¸Šä¸‹æ–‡è¿˜æ˜¯ä»ç±»è·¯å¾„ä¸‹è£…è½½åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œå°† bean åŠ è½½åˆ° bean å·¥å‚çš„è¿‡ç¨‹éƒ½æ˜¯ç›¸ä¼¼çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•åŠ è½½ä¸€ä¸ª FileSystemXmlApplicationContextï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> FileSystemXmlApplicationContext(<span class="string">&quot;c:/kinght.xml&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼åœ°ï¼Œä½ å¯ä»¥ä½¿ç”¨ ClassPathXmlApplicationContext ä»åº”ç”¨çš„ç±»è·¯å¾„ä¸‹åŠ è½½åº”ç”¨ä¸Šä¸‹æ–‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Application context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;kight.xml&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ FileSystemXmlApplicationContext å’Œä½¿ç”¨ ClassPathXmlApplicationContext çš„åŒºåˆ«åœ¨äºï¼šFileSystemXmlApplicationContext åœ¨æŒ‡å®šçš„æ–‡ä»¶ç³»ç»Ÿè·¯<br>å¾„ä¸‹æŸ¥æ‰¾ knight.xml æ–‡ä»¶ï¼›è€Œ ClassPathXmlApplicationContext æ˜¯åœ¨æ‰€æœ‰çš„ç±»è·¯å¾„ï¼ˆåŒ…å« JAR æ–‡ä»¶ï¼‰ä¸‹æŸ¥æ‰¾ knight.xml æ–‡ä»¶ã€‚</p>
<p>å¦‚æœä½ æƒ³ä» Java é…ç½®ä¸­åŠ è½½åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ AnnotationConfigApplicationContextï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(com.springinaction.knights.config.KnightConfig.class);</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œæ²¡æœ‰æŒ‡å®šåŠ è½½ Spring åº”ç”¨ä¸Šä¸‹æ–‡æ‰€éœ€çš„ XML æ–‡ä»¶ï¼ŒAnnotationConfigApplicationContext é€šè¿‡ä¸€ä¸ªé…ç½®ç±»åŠ è½½ beanã€‚</p>
<p>åº”ç”¨ä¸Šä¸‹æ–‡å‡†å¤‡å°±ç»ªä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨ä¸Šä¸‹æ–‡çš„ getBean() æ–¹æ³•ä» Spring å®¹å™¨ä¸­è·å– beanã€‚</p>
<p>ç°åœ¨ä½ åº”è¯¥åŸºæœ¬äº†è§£äº†å¦‚ä½•åˆ›å»º Spring å®¹å™¨ï¼Œè®©æˆ‘ä»¬å¯¹å®¹å™¨ä¸­ bean çš„ç”Ÿå‘½å‘¨æœŸåšæ›´è¿›ä¸€æ­¥çš„æ¢ç©¶ã€‚</p>
<h4 id="Bean-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Bean-çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Bean çš„ç”Ÿå‘½å‘¨æœŸ"></a>Bean çš„ç”Ÿå‘½å‘¨æœŸ</h4><p>åœ¨ä¼ ç»Ÿçš„ Java åº”ç”¨ä¸­ï¼Œbean çš„ç”Ÿå‘½å‘¨æœŸå¾ˆç®€å•ã€‚ä½¿ç”¨ Java å…³é”®å­— new è¿›è¡Œ bean å®ä¾‹åŒ–ï¼Œç„¶åè¯¥ bean å°±å¯ä»¥ä½¿ç”¨äº†ã€‚ä¸€æ—¦è¯¥ bean ä¸å†è¢«ä½¿ç”¨ï¼Œåˆ™ç”± Java è‡ªåŠ¨è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒSpring å®¹å™¨ä¸­çš„ bean çš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¾å¾—ç›¸å¯¹å¤æ‚å¤šäº†ã€‚æ­£ç¡®ç†è§£ Spring bean çš„ç”Ÿå‘½å‘¨æœŸéå¸¸é‡è¦ï¼Œå› ä¸ºä½ æˆ–è®¸è¦åˆ©ç”¨ Spring æä¾›çš„æ‰©å±•ç‚¹æ¥è‡ªå®šä¹‰ bean çš„åˆ›å»ºè¿‡ç¨‹ã€‚å›¾ 1.5 å±•ç¤ºäº† bean è£…è½½åˆ° Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ä¸€ä¸ªå…¸å‹çš„ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ã€‚</p>
<p>æ­£ç¡®ç†è§£ Spring Bean çš„ç”Ÿå‘½å‘¨æœŸéå¸¸é‡è¦ï¼Œå› ä¸ºä½ æˆ–è®¸è¦åˆ©ç”¨ Spring æä¾›çš„æ‰©å±•ç‚¹æ¥è‡ªå®šä¹‰ Bean çš„åˆ›å»ºè¿‡ç¨‹ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211015105103441.png" alt="image-20211015105103441"></p>
<center>å›¾ 1.5ã€€bean åœ¨ Spring å®¹å™¨ä¸­ä»åˆ›å»ºåˆ°é”€æ¯ç»å†äº†è‹¥å¹²é˜¶æ®µï¼Œæ¯ä¸€é˜¶æ®µéƒ½å¯ä»¥é’ˆå¯¹ Spring å¦‚ä½•ç®¡ç† bean è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶</center>

<p>æ­£å¦‚ä½ æ‰€è§ï¼Œåœ¨ bean å‡†å¤‡å°±ç»ªä¹‹å‰ï¼Œbean å·¥å‚æ‰§è¡Œäº†è‹¥å¹²å¯åŠ¨æ­¥éª¤ã€‚æˆ‘ä»¬å¯¹å›¾ 1.5 è¿›è¡Œè¯¦ç»†æè¿°ï¼š</p>
<ol>
<li>Spring å¯¹ Bean è¿›è¡Œåˆå§‹åŒ–</li>
<li>Spring å°†å€¼å’Œ Bean çš„å¼•ç”¨æ³¨å…¥è¿› Bean å¯¹åº”çš„å±æ€§ä¸­</li>
<li>å¦‚æœ Bean å®ç°äº† BeanNameAware æ¥å£ï¼ŒSpring å°† Bean çš„ ID ä¼ é€’ç»™ setBeanName() æ¥å£æ–¹æ³•</li>
<li>å¦‚æœ Bean å®ç°äº† BeanFactoryAware æ¥å£ï¼ŒSpring å°†è°ƒç”¨ setBeanFactory() æ¥å£æ–¹æ³•ï¼Œå°† BeanFactory å®¹å™¨å®ä¾‹ä¼ å…¥</li>
<li>å¦‚æœ Bean å®ç°äº† ApplicationContextAware æ¥å£ï¼ŒSpring å°†è°ƒç”¨ setApplicationContext() æ¥å£æ–¹æ³•ï¼Œå°†åº”ç”¨ä¸Šä¸‹æ–‡çš„å¼•ç”¨ä¼ å…¥</li>
<li>å¦‚æœ Bean å®ç°äº† BeanPostProcessor æ¥å£ï¼ŒSpring å°†è°ƒç”¨ postProcessorBeforeInitialization() æ¥å£æ–¹æ³•</li>
<li>å¦‚æœ Bean å®ç°äº† InitializingBean æ¥å£ï¼ŒSpring å°†è°ƒç”¨å®ƒä»¬çš„ afterPropertiesSet() æ¥å£ã€‚ç±»ä¼¼çš„ï¼Œå¦‚æœ Bean ä½¿ç”¨ init-method å£°æ˜äº†åˆå§‹åŒ–æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨</li>
<li>å¦‚æœ Bean å®ç°äº† BeanPostProcessor æ¥å£ï¼ŒSpring å°†è°ƒç”¨ postProcessorAfterInitialization() æ–¹æ³•</li>
<li>æ­¤æ—¶ï¼ŒBean å·²ç»å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥è¢«åº”ç”¨ç¨‹åºä½¿ç”¨äº†ï¼Œå®ƒä»¬å°†ä¸€ç›´é©»ç•™åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼ŒçŸ¥é“è¯¥åº”ç”¨ä¸Šä¸‹æ–‡è¢«é”€æ¯</li>
<li>å¦‚æœ Bean å®ç°äº† DisposableBean æ¥å£ï¼ŒSpring å°†è°ƒç”¨ destory() æ¥å£æ–¹æ³•ã€‚åŒæ ·ï¼Œå¦‚æœ Bean ä½¿ç”¨ destory-method å£°æ˜äº†é”€æ¯æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨</li>
</ol>
<p>ç°åœ¨ä½ å·²ç»äº†è§£äº†å¦‚ä½•åˆ›å»ºå’ŒåŠ è½½ä¸€ä¸ª Spring å®¹å™¨ã€‚ä½†æ˜¯ä¸€ä¸ªç©ºçš„å®¹å™¨å¹¶æ²¡æœ‰å¤ªå¤§çš„ä»·å€¼ï¼Œåœ¨ä½ æŠŠä¸œè¥¿æ”¾è¿›å»ä¹‹å‰ï¼Œå®ƒé‡Œé¢ä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚ä¸ºäº†ä» Spring çš„ DI ä¸­å—ç›Šï¼Œæˆ‘ä»¬å¿…é¡»å°†åº”ç”¨å¯¹è±¡è£…é…è¿› Spring å®¹å™¨ä¸­ã€‚æˆ‘ä»¬å°†åœ¨ç¬¬2ç« å¯¹beanè£…é…è¿›è¡Œæ›´è¯¦ç»†çš„æ¢è®¨ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨é¦–å…ˆæµè§ˆä¸€ä¸‹ Spring çš„ä½“ç³»ç»“æ„ï¼Œäº†è§£ä¸€ä¸‹ Spring æ¡†æ¶çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†å’Œæœ€æ–°ç‰ˆæœ¬çš„ Spring æ‰€å‘å¸ƒçš„æ–°ç‰¹æ€§ã€‚</p>
<h3 id="ä¿¯ç°-Spring-çš„é£æ™¯çº¿"><a href="#ä¿¯ç°-Spring-çš„é£æ™¯çº¿" class="headerlink" title="ä¿¯ç° Spring çš„é£æ™¯çº¿"></a>ä¿¯ç° Spring çš„é£æ™¯çº¿</h3><p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼ŒSpring æ¡†æ¶å…³æ³¨äºé€šè¿‡ DIã€AOP å’Œæ¶ˆé™¤æ ·æ¿å¼ä»£ç æ¥ç®€åŒ–ä¼ä¸šçº§ Java å¼€å‘ã€‚å³ä½¿è¿™æ˜¯ Spring æ‰€èƒ½åšçš„å…¨éƒ¨äº‹æƒ…ï¼Œé‚£ Spring ä¹Ÿå€¼å¾—ä¸€ç”¨ã€‚ä½†æ˜¯ï¼ŒSpring å®é™…ä¸Šçš„åŠŸèƒ½è¶…ä¹ä½ çš„æƒ³è±¡ã€‚</p>
<p>åœ¨ Spring æ¡†æ¶çš„èŒƒç•´å†…ï¼Œä½ ä¼šå‘ç° Spring ç®€åŒ– Java å¼€å‘çš„å¤šç§æ–¹å¼ã€‚ä½†åœ¨ Spring æ¡†æ¶ä¹‹å¤–è¿˜å­˜åœ¨ä¸€ä¸ªæ„å»ºåœ¨æ ¸å¿ƒæ¡†æ¶ä¹‹ä¸Šçš„åºå¤§ç”Ÿæ€åœˆï¼Œå®ƒå°† Spring æ‰©å±•åˆ°ä¸åŒçš„é¢†åŸŸï¼Œä¾‹å¦‚ Web æœåŠ¡ã€RESTã€ç§»åŠ¨å¼€å‘ä»¥åŠ NoSQLã€‚</p>
<p>é¦–å…ˆè®©æˆ‘ä»¬æ‹†å¼€ Spring æ¡†æ¶çš„æ ¸å¿ƒæ¥çœ‹çœ‹å®ƒç©¶ç«Ÿä¸ºæˆ‘ä»¬å¸¦æ¥äº†ä»€ä¹ˆï¼Œç„¶åæˆ‘ä»¬å†æµè§ˆä¸‹ Spring Portfolio ä¸­çš„å…¶ä»–æˆå‘˜ã€‚</p>
<h4 id="Spring-æ¨¡å—"><a href="#Spring-æ¨¡å—" class="headerlink" title="Spring æ¨¡å—"></a>Spring æ¨¡å—</h4><p>å½“æˆ‘ä»¬ä¸‹è½½ Spring å‘å¸ƒç‰ˆæœ¬å¹¶æŸ¥çœ‹å…¶ lib ç›®å½•æ—¶ï¼Œä¼šå‘ç°é‡Œé¢æœ‰å¤šä¸ª JAR æ–‡ä»¶ã€‚åœ¨ Spring 4.0 ä¸­ï¼ŒSpring æ¡†æ¶çš„å‘å¸ƒç‰ˆæœ¬åŒ…æ‹¬äº† 20 ä¸ªä¸åŒçš„æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—ä¼šæœ‰ 3 ä¸ª JAR æ–‡ä»¶ï¼ˆäºŒè¿›åˆ¶ç±»åº“ã€æºç çš„ JAR æ–‡ä»¶ä»¥åŠ JavaDoc çš„ JAR æ–‡ä»¶ï¼‰ã€‚å®Œæ•´çš„åº“ JAR æ–‡ä»¶å¦‚å›¾ 1.6 æ‰€ç¤ºã€‚</p>
<img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211012113540226.png">

<center>å›¾ 1.6ã€€Spring æ¡†æ¶ç”± 20 ä¸ªä¸åŒçš„æ¨¡å—ç»„æˆ</center>

<p>è¿™äº›æ¨¡å—ä¾æ®å…¶æ‰€å±çš„åŠŸèƒ½å¯ä»¥åˆ’åˆ†ä¸º 6 ç±»ä¸åŒçš„åŠŸèƒ½ï¼Œå¦‚å›¾ 1.7 æ‰€ç¤ºã€‚</p>
<p>æ€»ä½“è€Œè¨€ï¼Œè¿™äº›æ¨¡å—ä¸ºå¼€å‘ä¼ä¸šçº§åº”ç”¨æä¾›äº†æ‰€éœ€çš„ä¸€åˆ‡ã€‚ä½†æ˜¯ä½ ä¹Ÿä¸å¿…å°†åº”ç”¨å»ºç«‹åœ¨æ•´ä¸ª Spring æ¡†æ¶ä¹‹ä¸Šï¼Œä½ å¯ä»¥è‡ªç”±åœ°é€‰æ‹©é€‚åˆè‡ªèº«åº”ç”¨éœ€æ±‚çš„ Spring æ¨¡å—ï¼›å½“ Spring ä¸èƒ½æ»¡è¶³éœ€æ±‚æ—¶ï¼Œå®Œå…¨å¯ä»¥è€ƒè™‘å…¶ä»–é€‰æ‹©ã€‚äº‹å®ä¸Šï¼ŒSpring ç”šè‡³æä¾›äº†ä¸å…¶ä»–ç¬¬ä¸‰æ–¹æ¡†æ¶å’Œç±»åº“çš„é›†æˆç‚¹ï¼Œè¿™æ ·ä½ å°±ä¸éœ€è¦è‡ªå·±ç¼–å†™è¿™æ ·çš„ä»£ç äº†ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211027144045165.png" alt="image-20211027144045165"></p>
<p>è®©æˆ‘ä»¬é€ä¸€æµè§ˆ Spring çš„æ¨¡å—ï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•æ„å»ºèµ·Springæ•´ä½“è“å›¾çš„ã€‚</p>
<p>æ ¸å¿ƒ Spring å®¹å™¨</p>
<p>å®¹å™¨æ˜¯ Spring æ¡†æ¶æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå®ƒè´Ÿè´£ Spring åº”ç”¨ä¸­çš„ Bean çš„åˆ›å»ºã€é…ç½®å’Œç®¡ç†ã€‚åœ¨è¯¥æ¨¡å—ä¸­ï¼Œ Spring çš„ Bean å·¥å‚æä¾›äº†ä¾èµ–æ³¨å…¥ï¼Œåœ¨ Bean å·¥å‚ä¹‹ä¸Šï¼Œæœ‰å‡ ç§ Spring åº”ç”¨ä¸Šä¸‹æ–‡çš„å®ç°ï¼Œæ¯ä¸€ç§æä¾›äº†é…ç½® Spring çš„ä¸åŒæ–¹å¼ã€‚</p>
<p>é™¤äº† bean å·¥å‚å’Œåº”ç”¨ä¸Šä¸‹æ–‡ï¼Œè¯¥æ¨¡å—ä¹Ÿæä¾›äº†è®¸å¤šä¼ä¸šæœåŠ¡ï¼Œä¾‹å¦‚ Emailã€JNDI è®¿é—®ã€EJB é›†æˆå’Œè°ƒåº¦ã€‚</p>
<p>æ‰€æœ‰çš„ Spring æ¨¡å—éƒ½æ„å»ºäºæ ¸å¿ƒå®¹å™¨ä¹‹ä¸Šã€‚å½“ä½ é…ç½®åº”ç”¨æ—¶ï¼Œå…¶å®ä½ éšå¼åœ°ä½¿ç”¨äº†è¿™äº›ç±»ã€‚è´¯ç©¿æœ¬ä¹¦ï¼Œæˆ‘ä»¬éƒ½ä¼šæ¶‰åŠåˆ°æ ¸å¿ƒæ¨¡å—ï¼Œåœ¨ç¬¬ 2 ç« ä¸­æˆ‘ä»¬å°†ä¼šæ·±å…¥æ¢è®¨ Spring çš„ DIã€‚</p>
<p>AOP æ¨¡å—</p>
<p>åœ¨ AOP æ¨¡å—ä¸­ï¼ŒSpring å¯¹é¢å‘åˆ‡é¢ç¼–ç¨‹æä¾›äº†ä¸°å¯Œçš„æ”¯æŒã€‚è¿™ä¸ªæ¨¡å—æ˜¯ Spring åº”ç”¨ç³»ç»Ÿä¸­å¼€å‘åˆ‡é¢çš„åŸºç¡€ã€‚ä¸ DI ä¸€æ ·ï¼ŒAOP å¯ä»¥å¸®åŠ©åº”ç”¨å¯¹è±¡è§£è€¦ã€‚å€ŸåŠ© AOPï¼Œå¯ä»¥å°†éå¸ƒåº”ç”¨çš„å…³æ³¨ç‚¹ï¼ˆä¾‹å¦‚äº‹åŠ¡å’Œå®‰å…¨ï¼‰ä»å®ƒä»¬æ‰€åº”ç”¨çš„å¯¹è±¡ä¸­è§£è€¦å‡ºæ¥ã€‚</p>
<p>æˆ‘ä»¬å°†åœ¨ç¬¬4ç« æ·±å…¥æ¢è®¨Springå¯¹AOPæ”¯æŒã€‚</p>
<p>æ•°æ®é›†æˆå’Œè®¿é—®</p>
<p>ä½¿ç”¨ JDBC ç¼–å†™ä»£ç é€šå¸¸ä¼šå¯¼è‡´å¤§é‡çš„æ ·æ¿å¼ä»£ç ï¼Œä¾‹å¦‚è·å¾—æ•°æ®åº“è¿æ¥ã€åˆ›å»ºè¯­å¥ã€å¤„ç†ç»“æœé›†åˆ°æœ€åå…³é—­æ•°æ®åº“è¿æ¥ã€‚Spring çš„ JDBC å’Œ DAO (data access objects) å°è£…äº†è¿™äº›æ ·æ¿å¼ä»£ç ï¼Œä½¿æˆ‘ä»¬çš„æ•°æ®åº“ä»£ç å˜å¾—ç®€å•æ˜äº†ï¼Œè¿˜å¯ä»¥é¿å…å› ä¸ºé‡Šæ”¾æ•°æ®åº“èµ„æºè€Œå¼•å‘çš„é—®é¢˜ã€‚è¯¥æ¨¡å—åœ¨å‡ ç§æ•°æ®åº“æœåŠ¡çš„é”™è¯¯ä¿¡æ¯ä¹‹ä¸Šæ„å»ºäº†ä¸€ä¸ªè¯­ä¹‰ä¸°å¯Œçš„å¼‚å¸¸å±‚ï¼Œä»¥åæˆ‘ä»¬å†ä¹Ÿä¸éœ€è¦è§£é‡Šå“ªäº›éšæ™¦ä¸“æœ‰çš„ SQL é”™è¯¯ä¿¡æ¯äº†ã€‚</p>
<p>Spring ä¸ºé‚£äº›å–œæ¬¢ ORM (object-relational mapping) å·¥å…·çš„å¼€å‘è€…æä¾›äº† ORM æ¨¡å—ã€‚Spring çš„ ORM æ¨¡å—å»ºç«‹åœ¨å¯¹ DAO çš„æ”¯æŒä¹‹ä¸Šï¼Œå¹¶ä¸ºæŸäº› ORM æ¡†æ¶æä¾›äº†ä¸€ç§æ„å»º DAO çš„ç®€ä¾¿æ–¹å¼ã€‚Spring æ²¡æœ‰å»åˆ›å»ºè‡ªå·±çš„ ORM è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯å¯¹è®¸å¤šæµè¡Œçš„ ORM æ¡†æ¶è¿›è¡Œäº†é›†æˆã€‚Spring çš„äº‹åŠ¡ç®¡ç†æ”¯æŒæ‰€æœ‰çš„ ORM æ¡†æ¶ä»¥åŠ JDBCã€‚</p>
<p>åœ¨ç¬¬ 10 ç« è®¨è®º Spring æ•°æ®è®¿é—®æ—¶ï¼Œä½ ä¼šçœ‹åˆ° Spring åŸºäºæ¨¡æ¿çš„ JDBC æŠ½è±¡å±‚èƒ½å¤Ÿæå¤§åœ°ç®€åŒ– JDBC ä»£ç ã€‚</p>
<p>æœ¬æ¨¡å—åŒæ ·åŒ…å«äº†åœ¨ JMSï¼ˆJava Message Serviceï¼‰ä¹‹ä¸Šæ„å»ºçš„ Spring æŠ½è±¡å±‚ï¼Œå®ƒä¼šä½¿ç”¨æ¶ˆæ¯ä»¥å¼‚æ­¥çš„æ–¹å¼ä¸å…¶ä»–åº”ç”¨é›†æˆã€‚ä» Spring 3.0 å¼€å§‹ï¼Œæœ¬æ¨¡å—è¿˜åŒ…å«å¯¹è±¡åˆ° XML æ˜ å°„çš„ç‰¹æ€§ï¼Œå®ƒæœ€åˆæ˜¯ Spring WebService é¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæœ¬æ¨¡å—ä¼šä½¿ç”¨ Spring AOP æ¨¡å—ä¸º Spring åº”ç”¨ä¸­çš„å¯¹è±¡æä¾›äº‹åŠ¡ç®¡ç†æœåŠ¡ã€‚</p>
<p>Web å’Œè¿œç¨‹è°ƒç”¨</p>
<p>MVC (Model-View-Controller)  æ¨¡å¼å·²ç»è¢«æ™®éçš„æ¥å—ä¸ºæ„å»º Web åº”ç”¨çš„æ–¹æ³•ï¼Œå®ƒæœ‰åŠ©äºå°†ç”¨æˆ·ç•Œé¢é€»è¾‘å’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»ã€‚Java ä»æ¥ä¸ç¼ºå°‘ MVC æ¡†æ¶ï¼ŒApache çš„Strutsã€JSFã€WebWork å’Œ Tapestry éƒ½æ˜¯å¯é€‰çš„æœ€æµè¡Œçš„ MVC æ¡†æ¶ã€‚</p>
<p>è™½ç„¶ Spring é›†æˆäº†å¤šç§æµè¡Œçš„ MVC æ¡†æ¶ï¼Œä½†å®ƒçš„ Web å’Œè¿œç¨‹è°ƒç”¨æ¨¡å—è‡ªå¸¦äº†ä¸€ä¸ªå¼ºå¤§çš„ MVC æ¡†æ¶ï¼Œæœ‰åŠ©äºåº”ç”¨æå‡ Web å±‚æŠ€æœ¯çš„æ¾æ•£è€¦åˆã€‚åœ¨ç¬¬ 5 ç« åˆ°ç¬¬ 7 ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå­¦ä¹  Spring çš„ MVC æ¡†æ¶ã€‚</p>
<p>é™¤äº†é¢å‘ç”¨æˆ·çš„ Web åº”ç”¨ï¼Œè¯¥æ¨¡å—è¿˜æä¾›äº†å¤šç§æ„å»ºä¸å…¶ä»–åº”ç”¨äº¤äº’çš„è¿œç¨‹è°ƒç”¨æ–¹æ¡ˆã€‚Spring è¿œç¨‹è°ƒç”¨åŠŸèƒ½é›†æˆäº† RMIï¼ˆRemote Method Invocationï¼‰ã€Hessianã€Burlapã€JAX-WSï¼ŒåŒæ—¶ Spring è¿˜è‡ªå¸¦äº†ä¸€ä¸ªè¿œç¨‹è°ƒç”¨æ¡†æ¶ï¼šHTTP invokerã€‚Spring è¿˜æä¾›äº†æš´éœ²å’Œä½¿ç”¨ REST API çš„è‰¯å¥½æ”¯æŒã€‚</p>
<p>æˆ‘ä»¬å°†ä¼šåœ¨ç¬¬ 15ç«  è®¨è®º Spring çš„è¿œç¨‹è°ƒç”¨åŠŸèƒ½ã€‚åœ¨ç¬¬ 16 ç« å­¦ä¹ å¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨ REST APIã€‚</p>
<p>Instrumentation</p>
<p>Spring çš„ Instrumentation æ¨¡å—æä¾›äº†ä¸º JVM æ·»åŠ ä»£ç† (agent) çš„åŠŸèƒ½ã€‚å…·ä½“æ¥è®²ï¼Œå®ƒä¸º Tomcat æä¾›äº†ä¸€ä¸ªç»‡å…¥ä»£ç†ï¼Œèƒ½å¤Ÿä¸º Tomcat ä¼ é€’ç±»æ–‡ä»¶ï¼Œå°±åƒè¿™äº›æ–‡ä»¶æ˜¯è¢«ç±»åŠ è½½å™¨åŠ è½½çš„ä¸€æ ·ã€‚</p>
<p>å¦‚æœè¿™å¬èµ·æ¥æœ‰ç‚¹éš¾ä»¥ç†è§£ï¼Œä¸å¿…å¯¹æ­¤è¿‡äºæ‹…å¿ƒã€‚è¿™ä¸ªæ¨¡å—æ‰€æä¾›çš„ Instrumentation ä½¿ç”¨åœºæ™¯éå¸¸æœ‰é™ï¼Œåœ¨æœ¬ä¹¦ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šä»‹ç»è¯¥æ¨¡å—ã€‚</p>
<p>æµ‹è¯•</p>
<p>é‰´äºå¼€å‘è€…è‡ªæµ‹çš„é‡è¦æ€§ï¼ŒSpring æä¾›äº†æµ‹è¯•æ¨¡å—ä»¥è‡´åŠ›äº Spring åº”ç”¨çš„æµ‹è¯•ã€‚</p>
<p>é€šè¿‡è¯¥æ¨¡å—ï¼Œä½ ä¼šå‘ç° Spring ä¸ºä½¿ç”¨ JNDIã€Servlet å’Œ Portlet ç¼–å†™å•å…ƒæµ‹è¯•æä¾›äº†ä¸€ç³»åˆ—çš„ mock å¯¹è±¡å®ç°ã€‚å¯¹äºé›†æˆæµ‹è¯•ï¼Œè¯¥æ¨¡å—ä¸ºåŠ è½½ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ bean é›†åˆä»¥åŠä¸ Spring ä¸Šä¸‹æ–‡ä¸­çš„ bean è¿›è¡Œäº¤äº’æä¾›äº†æ”¯æŒã€‚</p>
<p>åœ¨æœ¬ä¹¦ä¸­ï¼Œæœ‰å¾ˆå¤šçš„æ ·ä¾‹éƒ½æ˜¯æµ‹è¯•é©±åŠ¨çš„ï¼Œå°†ä¼šä½¿ç”¨åˆ° Spring æ‰€æä¾›çš„æµ‹è¯•åŠŸèƒ½ã€‚</p>
<h4 id="Spring-Portfolio"><a href="#Spring-Portfolio" class="headerlink" title="Spring Portfolio"></a>Spring Portfolio</h4><p>å½“è°ˆè®º Springæ—¶ï¼Œå…¶å®å®ƒè¿œè¿œè¶…å‡ºæˆ‘ä»¬çš„æƒ³è±¡ã€‚äº‹å®ä¸Šï¼ŒSpring è¿œä¸æ˜¯ Spring æ¡†æ¶æ‰€ä¸‹è½½çš„é‚£äº›ã€‚å¦‚æœä»…ä»…åœç•™åœ¨æ ¸å¿ƒçš„ Spring æ¡†æ¶å±‚é¢ï¼Œæˆ‘ä»¬å°†é”™è¿‡ Spring Portfolio æ‰€æä¾›çš„å·¨é¢è´¢å¯Œã€‚æ•´ä¸ª Spring Portfolio åŒ…æ‹¬å¤šä¸ªæ„å»ºäºæ ¸å¿ƒ Spring æ¡†æ¶ä¹‹ä¸Šçš„æ¡†æ¶å’Œç±»åº“ã€‚æ¦‚æ‹¬åœ°è®²ï¼Œæ•´ä¸ª Spring Portfolio åŒ…æ‹¬å¤šä¸ªæ„å»ºäºæ ¸å¿ƒ Spring æ¡†æ¶ä¹‹ä¸Šçš„æ¡†æ¶å’Œç±»åº“ã€‚æ¦‚æ‹¬åœ°è®²ï¼Œæ•´ä¸ª Spring Portfolio å‡ ä¹ä¸ºæ¯ä¸€ä¸ªé¢†åŸŸçš„ Java å¼€å‘éƒ½æä¾›äº† Spring ç¼–ç¨‹æ¨¡å‹ã€‚</p>
<p>æˆ–è®¸éœ€è¦å‡ å·ä¹¦æ‰èƒ½è¦†ç›– Spring Portfolio æ‰€æä¾›çš„æ‰€æœ‰å†…å®¹ï¼Œè¿™ä¹Ÿè¿œè¿œè¶…å‡ºäº†æœ¬ä¹¦çš„èŒƒå›´ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬ä¼šä»‹ç» Spring  Portfolio ä¸­çš„ä¸€äº›é¡¹ç›®ï¼ŒåŒæ ·ï¼Œæˆ‘ä»¬å°†ä½“éªŒä¸€ä¸‹æ ¸å¿ƒæ¡†æ¶ä¹‹å¤–çš„å¦ä¸€ç•ªé£æ™¯ã€‚</p>
<p>Spring Web Flow</p>
<p>Spring Web Flow å»ºç«‹äº Spring MVC æ¡†æ¶ä¹‹ä¸Šï¼Œå®ƒä¸ºåŸºäºæµç¨‹çš„ä¼šè¯å¼ Web åº”ç”¨ï¼ˆå¯ä»¥æƒ³ä¸€ä¸‹è´­ç‰©è½¦æˆ–è€…å‘å¯¼åŠŸèƒ½ï¼‰æä¾›äº†æ”¯æŒã€‚æˆ‘ä»¬å°†åœ¨ç¬¬ 8 ç« è®¨è®ºæ›´å¤šå…³äº Spring Web Flow çš„å†…å®¹ï¼Œä½ è¿˜å¯ä»¥è®¿é—® Spring Web Flow çš„ä¸»é¡µï¼ˆ<a target="_blank" rel="noopener" href="http://projects.spring.io/spring-webflow/%EF%BC%89%E3%80%82">http://projects.spring.io/spring-webflow/ï¼‰ã€‚</a></p>
<p>Spring Web Service</p>
<p>è™½ç„¶æ ¸å¿ƒçš„ Spring æ¡†æ¶æä¾›äº†å°† Spring bean ä»¥å£°æ˜çš„æ–¹å¼å‘å¸ƒä¸º Web Service çš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿™äº›æœåŠ¡æ˜¯åŸºäºä¸€ä¸ªå…·æœ‰äº‰è®®æ€§çš„æ¶æ„ï¼ˆæ‹™åŠ£çš„å¥‘çº¦åç½®æ¨¡å‹ï¼‰ä¹‹ä¸Šè€Œæ„å»ºçš„ã€‚è¿™äº›æœåŠ¡çš„å¥‘çº¦ç”±beançš„æ¥å£æ¥å†³å®šã€‚ Spring Web Service æä¾›äº†å¥‘çº¦ä¼˜å…ˆçš„ Web Service æ¨¡å‹ï¼ŒæœåŠ¡çš„å®ç°éƒ½æ˜¯ä¸ºäº†æ»¡è¶³æœåŠ¡çš„å¥‘çº¦è€Œç¼–å†™çš„ã€‚</p>
<p>æœ¬ä¹¦ä¸ä¼šå†æ¢è®¨ Spring Web Serviceï¼Œä½†æ˜¯ä½ å¯ä»¥æµè§ˆç«™ç‚¹ <a target="_blank" rel="noopener" href="http://docs.spring.io/spring-">http://docs.spring.io/spring-</a> ws/site/ æ¥äº†è§£æ›´å¤šå…³äº Spring Web Service çš„ä¿¡æ¯ã€‚</p>
<p>Spring Security</p>
<p>å®‰å…¨å¯¹äºè®¸å¤šåº”ç”¨éƒ½æ˜¯ä¸€ä¸ªéå¸¸å…³é”®çš„åˆ‡é¢ã€‚åˆ©ç”¨ Spring AOPï¼ŒSpring Security ä¸º Spring åº”ç”¨æä¾›äº†å£°æ˜å¼çš„å®‰å…¨æœºåˆ¶ã€‚ä½ å°†ä¼šåœ¨ç¬¬ 9 ç« çœ‹åˆ°å¦‚ä½•ä¸ºåº”ç”¨çš„ Web å±‚æ·»åŠ  Spring Security åŠŸèƒ½ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜ä¼šåœ¨ç¬¬ 14 ç« é‡æ–°å›åˆ° Spring  Security çš„è¯é¢˜ï¼Œå­¦ä¹ å¦‚ä½•ä¿æŠ¤æ–¹æ³•è°ƒç”¨ã€‚ä½ å¯ä»¥åœ¨ä¸»é¡µ <a target="_blank" rel="noopener" href="http://projects.spring.io/spring-security/">http://projects.spring.io/spring-security/</a> ä¸Šè·å¾—å…³äº Spring Security çš„æ›´å¤šä¿¡æ¯ã€‚</p>
<p>Spring Integration</p>
<p>è®¸å¤šä¼ä¸šçº§åº”ç”¨éƒ½éœ€è¦ä¸å…¶ä»–åº”ç”¨è¿›è¡Œäº¤äº’ã€‚Spring Integration æä¾›äº†å¤šç§é€šç”¨åº”ç”¨é›†æˆæ¨¡å¼çš„ Spring å£°æ˜å¼é£æ ¼å®ç°ã€‚</p>
<p>æˆ‘ä»¬ä¸ä¼šåœ¨æœ¬ä¹¦è¦†ç›– Spring Integration çš„å†…å®¹ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº Spring Integration çš„ä¿¡æ¯ï¼Œæˆ‘æ¨è Mark  Fisherã€Jonas Partnerã€Marius Bogoevici å’Œ Iwein Fuld ç¼–å†™çš„ã€ŠSpring Integration in Actionã€‹ï¼ˆManningï¼Œ2012ï¼Œ<a target="_blank" rel="noopener" href="http://www.manning.com/fisher/%EF%BC%89%EF%BC%9B%E6%88%96%E8%80%85%E4%BD%A0%E8%BF%98%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE">www.manning.com/fisher/ï¼‰ï¼›æˆ–è€…ä½ è¿˜å¯ä»¥è®¿é—®</a> Spring Integration çš„ä¸»é¡µ <a target="_blank" rel="noopener" href="http://projects.spring.io/spring-integration/%E3%80%82">http://projects.spring.io/spring-integration/ã€‚</a></p>
<p>Spring Batch</p>
<p>å½“æˆ‘ä»¬éœ€è¦å¯¹æ•°æ®è¿›è¡Œå¤§é‡æ“ä½œæ—¶ï¼Œæ²¡æœ‰ä»»ä½•æŠ€æœ¯å¯ä»¥æ¯”æ‰¹å¤„ç†æ›´èƒœä»»è¿™ç§åœºæ™¯ã€‚å¦‚æœéœ€è¦å¼€å‘ä¸€ä¸ªæ‰¹å¤„ç†åº”ç”¨ï¼Œä½ å¯ä»¥é€šè¿‡ Spring Batchï¼Œä½¿ç”¨ Spring å¼ºå¤§çš„é¢å‘ POJO çš„ç¼–ç¨‹æ¨¡å‹ã€‚</p>
<p>Spring Batch è¶…å‡ºäº†æœ¬ä¹¦çš„èŒƒç•´ï¼Œä½†æ˜¯ä½ å¯ä»¥é˜…è¯» ArnaudCogoluegnesã€Thierry Templierã€Gary Gregory å’Œ Olivier  Bazoud ç¼–å†™çš„ ã€ŠSpring Batch in Actionã€‹ï¼ˆManningï¼Œ2012ï¼Œ<a target="_blank" rel="noopener" href="http://www.manning.com/templier/%EF%BC%89%EF%BC%8C%E6%88%96%E8%80%85%E8%AE%BF%E9%97%AE">www.manning.com/templier/ï¼‰ï¼Œæˆ–è€…è®¿é—®</a> Spring Batchçš„ä¸»é¡µ <a target="_blank" rel="noopener" href="http://projects.spring.io/">http://projects.spring.io/</a> spring-batch/ã€‚</p>
<p>Spring Data</p>
<p>Spring Data ä½¿å¾—åœ¨ Spring ä¸­ä½¿ç”¨ä»»ä½•æ•°æ®åº“éƒ½å˜å¾—éå¸¸å®¹æ˜“ã€‚å°½ç®¡å…³ç³»å‹æ•°æ®åº“ç»Ÿæ²»ä¼ä¸šçº§åº”ç”¨å¤šå¹´ï¼Œä½†æ˜¯ç°ä»£åŒ–çš„åº”ç”¨æ­£åœ¨è®¤è¯†åˆ°å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®éƒ½é€‚åˆæ”¾åœ¨ä¸€å¼ è¡¨ä¸­çš„è¡Œå’Œåˆ—ä¸­ã€‚ä¸€ç§æ–°çš„æ•°æ®åº“ç§ç±»ï¼Œé€šå¸¸è¢«ç§°ä¹‹ä¸º NoSQL æ•°æ®åº“ï¼Œæä¾›äº†ä½¿ç”¨æ•°æ®çš„æ–°æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¼šæ¯”ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“æ›´ä¸ºåˆé€‚ã€‚</p>
<p>ä¸ç®¡ä½ ä½¿ç”¨æ–‡æ¡£æ•°æ®åº“ï¼Œå¦‚ MongoDBï¼Œå›¾æ•°æ®åº“ï¼Œå¦‚ Neo4jï¼Œè¿˜æ˜¯ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ï¼ŒSpring Data éƒ½ä¸ºæŒä¹…åŒ–æä¾›äº†ä¸€ç§ç®€å•çš„ç¼–ç¨‹æ¨¡å‹ã€‚è¿™åŒ…æ‹¬ä¸ºå¤šç§æ•°æ®åº“ç±»å‹æä¾›äº†ä¸€ç§è‡ªåŠ¨åŒ–çš„ Repository æœºåˆ¶ï¼Œå®ƒè´Ÿè´£ä¸ºä½ åˆ›å»º Repository çš„å®ç°ã€‚</p>
<p>æˆ‘ä»¬å°†ä¼šåœ¨ç¬¬ 11 ç« çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ Spring Data ç®€åŒ– Java PersistenceAPIï¼ˆJPAï¼‰å¼€å‘ï¼Œç„¶ååœ¨ç¬¬ 12 ç« ï¼Œå°†ç›¸å…³çš„è®¨è®ºæ‹“å±•è‡³å‡ ç§ NoSQL æ•°æ®åº“ã€‚</p>
<p>Spring Social</p>
<p>ç¤¾äº¤ç½‘ç»œæ˜¯äº’è”ç½‘é¢†åŸŸä¸­æ–°å…´çš„ä¸€ç§æ½®æµï¼Œè¶Šæ¥è¶Šå¤šçš„åº”ç”¨æ­£åœ¨èå…¥ç¤¾äº¤ç½‘ç»œç½‘ç«™ï¼Œä¾‹å¦‚ Facebook æˆ–è€… Twitterã€‚å¦‚æœå¯¹æ­¤æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥äº†è§£ä¸€ä¸‹ Spring Socialï¼Œè¿™æ˜¯ Spring çš„ä¸€ä¸ªç¤¾äº¤ç½‘ç»œæ‰©å±•æ¨¡å—ã€‚</p>
<p>ä¸è¿‡ï¼ŒSpring Social å¹¶ä¸ä»…ä»…æ˜¯ tweet å’Œå¥½å‹ã€‚å°½ç®¡åå­—æ˜¯è¿™æ ·ï¼Œä½† Spring Social æ›´å¤šçš„æ˜¯å…³æ³¨è¿æ¥ï¼ˆconnectï¼‰ï¼Œè€Œä¸æ˜¯ç¤¾äº¤ï¼ˆsocialï¼‰ã€‚å®ƒèƒ½å¤Ÿå¸®åŠ©ä½ é€šè¿‡ REST API è¿æ¥Springåº”ç”¨ï¼Œå…¶ä¸­æœ‰äº› Spring åº”ç”¨å¯èƒ½åŸæœ¬å¹¶æ²¡æœ‰ä»»ä½•ç¤¾äº¤æ–¹é¢çš„åŠŸèƒ½ç›®æ ‡ã€‚</p>
<p>é™äºç¯‡å¹…ï¼Œæˆ‘ä»¬åœ¨æœ¬ä¹¦ä¸­ä¸ä¼šæ¶‰åŠ Spring Socialã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å¯¹ Spring å¦‚ä½•å¸®åŠ©ä½ è¿æ¥ Facebook æˆ– Twitter æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥æŸ¥çœ‹ç½‘å€ <a target="_blank" rel="noopener" href="https://spring.io/guides/gs/accessing-">https://spring.io/guides/gs/accessing-</a> facebook/ å’Œ <a target="_blank" rel="noopener" href="https://spring.io/guides/gs/accessing-twitter/%E4%B8%AD%E7%9A%84%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E3%80%82">https://spring.io/guides/gs/accessing-twitter/ä¸­çš„å…¥é—¨æŒ‡å—ã€‚</a></p>
<p>Spring Mobile</p>
<p>ç§»åŠ¨åº”ç”¨æ˜¯å¦ä¸€ä¸ªå¼•äººç©ç›®çš„è½¯ä»¶å¼€å‘é¢†åŸŸã€‚æ™ºèƒ½æ‰‹æœºå’Œå¹³æ¿è®¾å¤‡å·²æˆä¸ºè®¸å¤šç”¨æˆ·é¦–é€‰çš„å®¢æˆ·ç«¯ã€‚Spring Mobile æ˜¯ Spring MVC æ–°çš„æ‰©å±•æ¨¡å—ï¼Œç”¨äºæ”¯æŒç§»åŠ¨ Web åº”ç”¨å¼€å‘ã€‚</p>
<p>Spring for Android</p>
<p>ä¸ Spring Mobile ç›¸å…³çš„æ˜¯ Spring Android é¡¹ç›®ã€‚è¿™ä¸ªæ–°é¡¹ç›®ï¼Œæ—¨åœ¨é€šè¿‡ Spring æ¡†æ¶ä¸ºå¼€å‘åŸºäº Android è®¾å¤‡çš„æœ¬åœ°åº”ç”¨æä¾›æŸäº›ç®€å•çš„æ”¯æŒã€‚</p>
<p>æœ€åˆï¼Œè¿™ä¸ªé¡¹ç›®æä¾›äº† Spring RestTemplate çš„ä¸€ä¸ªå¯ä»¥ç”¨äº Android åº”ç”¨ä¹‹ä¸­çš„ç‰ˆæœ¬ã€‚å®ƒè¿˜èƒ½ä¸ Spring Social åä½œï¼Œä½¿å¾—åŸç”Ÿåº”ç”¨å¯ä»¥é€šè¿‡ REST API è¿›è¡Œç¤¾äº¤ç½‘ç»œçš„è¿æ¥ã€‚</p>
<p>æœ¬ä¹¦ä¸­ï¼Œæˆ‘ä¸ä¼šè®¨è®º Spring for Androidï¼Œä¸è¿‡ä½ å¯ä»¥é€šè¿‡ <a target="_blank" rel="noopener" href="http://projects.spring.io/">http://projects.spring.io</a> /spring-android/ äº†è§£æ›´å¤šå†…å®¹ã€‚</p>
<p>Spring Boot</p>
<p>Spring æå¤§åœ°ç®€åŒ–äº†ä¼—å¤šçš„ç¼–ç¨‹ä»»åŠ¡ï¼Œå‡å°‘ç”šè‡³æ¶ˆé™¤äº†å¾ˆå¤šæ ·æ¿å¼ä»£ç ï¼Œå¦‚æœæ²¡æœ‰ Spring çš„è¯ï¼Œåœ¨æ—¥å¸¸å·¥ä½œä¸­ä½ ä¸å¾—ä¸ç¼–å†™è¿™æ ·çš„æ ·æ¿ä»£ç ã€‚Spring Boot æ˜¯ä¸€ä¸ªå´­æ–°çš„ä»¤äººå…´å¥‹çš„é¡¹ç›®ï¼Œå®ƒä»¥ Spring çš„è§†è§’ï¼Œè‡´åŠ›äºç®€åŒ– Spring æœ¬èº«ã€‚</p>
<p>Spring Boot å¤§é‡ä¾èµ–äºè‡ªåŠ¨é…ç½®æŠ€æœ¯ï¼Œå®ƒèƒ½å¤Ÿæ¶ˆé™¤å¤§éƒ¨åˆ†ï¼ˆåœ¨å¾ˆå¤šåœºæ™¯ä¸­ï¼Œç”šè‡³æ˜¯å…¨éƒ¨ï¼‰Spring é…ç½®ã€‚å®ƒè¿˜æä¾›äº†å¤šä¸ªStarter é¡¹ç›®ï¼Œä¸ç®¡ä½ ä½¿ç”¨ Maven è¿˜æ˜¯ Gradleï¼Œè¿™éƒ½èƒ½å‡å°‘ Spring å·¥ç¨‹æ„å»ºæ–‡ä»¶çš„å¤§å°ã€‚</p>
<p>åœ¨æœ¬ä¹¦å³å°†ç»“æŸçš„ç¬¬ 21 ç« ï¼Œæˆ‘ä»¬å°†ä¼šå­¦ä¹  Spring Bootã€‚</p>
<h3 id="Spring-æ–°åŠŸèƒ½"><a href="#Spring-æ–°åŠŸèƒ½" class="headerlink" title="Spring æ–°åŠŸèƒ½"></a>Spring æ–°åŠŸèƒ½</h3><p>å½“æœ¬ä¹¦çš„ç¬¬ 3 ç‰ˆäº¤ä»˜å°åˆ·çš„æ—¶å€™ï¼Œå½“æ—¶ Spring çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ 3.0.5ã€‚é‚£å¤§çº¦æ˜¯åœ¨ 3 å¹´å‰ï¼Œä»é‚£æ—¶åˆ°ç°åœ¨å‘ç”Ÿäº†å¾ˆå¤šçš„å˜åŒ–ã€‚Spring æ¡†æ¶ç»å†äº† 3 ä¸ªé‡è¦çš„å‘å¸ƒç‰ˆæœ¬â€”â€”3.1ã€3.2 ä»¥åŠç°åœ¨çš„ 4.0â€”â€”æ¯ä¸ªç‰ˆæœ¬éƒ½å¸¦æ¥äº†æ–°çš„ç‰¹æ€§å’Œå¢å¼ºï¼Œä»¥ç®€åŒ–åº”ç”¨ç¨‹åºçš„ç ”å‘ã€‚Spring Portfolio ä¸­çš„ä¸€äº›æˆå‘˜é¡¹ç›®ä¹Ÿç»å†äº†é‡è¦çš„å˜æ›´ã€‚</p>
<p>æœ¬ä¹¦ä¹Ÿè¿›è¡Œäº†æ›´æ–°ï¼Œè¯•å›¾æ¶µç›–è¿™äº›å‘å¸ƒç‰ˆæœ¬ä¸­ä¼—å¤šæœ€ä»¤äººå…´å¥‹å’Œæœ‰ç”¨çš„ç‰¹æ€§ã€‚ä½†ç°åœ¨ï¼Œæˆ‘ä»¬å…ˆç®€è¦åœ°äº†è§£ä¸€ä¸‹ Spring å¸¦æ¥äº†å“ªäº›æ–°åŠŸèƒ½ã€‚</p>
<h4 id="Spring-3-1-æ–°ç‰¹æ€§"><a href="#Spring-3-1-æ–°ç‰¹æ€§" class="headerlink" title="Spring 3.1 æ–°ç‰¹æ€§"></a>Spring 3.1 æ–°ç‰¹æ€§</h4><p>Spring 3.1 å¸¦æ¥äº†å¤šé¡¹æœ‰ç”¨çš„æ–°ç‰¹æ€§å’Œå¢å¼ºï¼Œå…¶ä¸­æœ‰å¾ˆå¤šéƒ½æ˜¯å…³äºå¦‚ä½•ç®€åŒ–å’Œæ”¹å–„é…ç½®çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒSpring 3.1 è¿˜æä¾›äº†å£°æ˜å¼ç¼“å­˜çš„æ”¯æŒä»¥åŠä¼—å¤šé’ˆå¯¹ Spring  MVCçš„åŠŸèƒ½å¢å¼ºã€‚</p>
<ul>
<li>ä¸ºäº†è§£å†³å„ç§ç¯å¢ƒä¸‹ï¼ˆå¦‚å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ï¼‰é€‰æ‹©ä¸åŒé…ç½®çš„é—®é¢˜ï¼ŒSpring 3.1 å¼•å…¥äº†ç¯å¢ƒ profile åŠŸèƒ½ã€‚å€ŸåŠ©äº profileï¼Œå°±èƒ½æ ¹æ®åº”ç”¨éƒ¨ç½²åœ¨ä»€ä¹ˆç¯å¢ƒä¹‹ä¸­é€‰æ‹©ä¸åŒçš„æ•°æ®æº beanï¼›</li>
<li>åœ¨ Spring 3.0 åŸºäº Java çš„é…ç½®ä¹‹ä¸Šï¼ŒSpring 3.1 æ·»åŠ äº†å¤šä¸ª enable æ³¨è§£ï¼Œè¿™æ ·å°±èƒ½ä½¿ç”¨è¿™ä¸ªæ³¨è§£å¯ç”¨ Spring çš„ç‰¹å®šåŠŸèƒ½ï¼›</li>
<li>æ·»åŠ äº† Spring å¯¹å£°æ˜å¼ç¼“å­˜çš„æ”¯æŒï¼Œèƒ½å¤Ÿä½¿ç”¨ç®€å•çš„æ³¨è§£å£°æ˜ç¼“å­˜è¾¹ç•Œå’Œè§„åˆ™ï¼Œè¿™ä¸ä½ ä»¥å‰å£°æ˜äº‹åŠ¡è¾¹ç•Œå¾ˆç±»ä¼¼ï¼›</li>
<li>æ–°æ·»åŠ çš„ç”¨äºæ„é€ å™¨æ³¨å…¥çš„ c å‘½åç©ºé—´ï¼Œå®ƒç±»ä¼¼äº Spring 2.0 æ‰€æä¾›çš„é¢å‘å±æ€§çš„på‘½åç©ºé—´ï¼Œp å‘½åç©ºé—´ç”¨äºå±æ€§æ³¨å…¥ï¼Œå®ƒä»¬éƒ½æ˜¯éå¸¸ç®€æ´æ˜“ç”¨çš„ï¼›</li>
<li>Spring å¼€å§‹æ”¯æŒ Servlet 3.0ï¼ŒåŒ…æ‹¬åœ¨åŸºäº Java çš„é…ç½®ä¸­å£°æ˜ Servlet å’Œ Filterï¼Œè€Œä¸å†å€ŸåŠ©äº web.xmlï¼›</li>
<li>æ”¹å–„ Spring å¯¹ JPA çš„æ”¯æŒï¼Œä½¿å¾—å®ƒèƒ½å¤Ÿåœ¨ Spring ä¸­å®Œæ•´åœ°é…ç½® JPAï¼Œä¸å¿…å†ä½¿ç”¨ persistence.xml æ–‡ä»¶ã€‚</li>
</ul>
<p>Spring 3.1 è¿˜åŒ…å«äº†å¤šé¡¹é’ˆå¯¹ Spring MVC çš„åŠŸèƒ½å¢å¼ºï¼š</p>
<ul>
<li>è‡ªåŠ¨ç»‘å®šè·¯å¾„å˜é‡åˆ°æ¨¡å‹å±æ€§ä¸­ï¼›</li>
<li>æä¾›äº†@RequestMappingproduceså’Œconsumeså±æ€§ï¼Œç”¨äºåŒ¹é…è¯·æ±‚ä¸­çš„Acceptå’ŒContent-Typeå¤´éƒ¨ä¿¡æ¯ï¼›</li>
<li>æä¾›äº†@RequestPartæ³¨è§£ï¼Œç”¨äºå°†multipartè¯·æ±‚ä¸­çš„æŸäº›éƒ¨åˆ†ç»‘å®šåˆ°å¤„ç†å™¨çš„æ–¹æ³•å‚æ•°ä¸­ï¼›</li>
<li>æ”¯æŒFlashå±æ€§ï¼ˆåœ¨redirectè¯·æ±‚ä¹‹åä¾ç„¶èƒ½å¤Ÿå­˜æ´»çš„å±æ€§ï¼‰ä»¥åŠç”¨äºåœ¨è¯·æ±‚é—´å­˜æ”¾flashå±æ€§çš„RedirectAttributesç±»å‹ã€‚</li>
</ul>
<p>Spring çš„ JpaTemplate å’Œ JpaDaoSupport ç±»è¢«åºŸå¼ƒæ‰äº†</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ Spring 3.2 æä¾›äº†ä»€ä¹ˆæ–°åŠŸèƒ½ã€‚</p>
<h4 id="Spring-3-2-æ–°ç‰¹æ€§"><a href="#Spring-3-2-æ–°ç‰¹æ€§" class="headerlink" title="Spring 3.2 æ–°ç‰¹æ€§"></a>Spring 3.2 æ–°ç‰¹æ€§</h4><p>Spring 3.2 æ˜¯ä¸»è¦å…³æ³¨ Spring MVC çš„ä¸€ä¸ªå‘å¸ƒç‰ˆæœ¬ã€‚</p>
<ul>
<li>Spring 3.2 çš„æ§åˆ¶å™¨ï¼ˆControllerï¼‰å¯ä»¥ä½¿ç”¨ Servlet 3.0 çš„å¼‚æ­¥è¯·æ±‚ï¼Œå…è®¸åœ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¸­å¤„ç†è¯·æ±‚ï¼Œä»è€Œå°† Servlet çº¿ç¨‹è§£æ”¾å‡ºæ¥å¤„ç†æ›´å¤šçš„è¯·æ±‚ï¼›</li>
<li>Spring 3.2 å¼•å…¥äº† Spring MVC æµ‹è¯•æ¡†æ¶ï¼Œç”¨äºä¸ºæ§åˆ¶å™¨ç¼–å†™æ›´ä¸ºä¸°å¯Œçš„æµ‹è¯•ï¼Œæ–­è¨€å®ƒä»¬ä½œä¸ºæ§åˆ¶å™¨çš„è¡Œä¸ºè¡Œä¸ºæ˜¯å¦æ­£ç¡®ï¼Œè€Œä¸”åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å¹¶ä¸éœ€è¦ Servlet å®¹å™¨ï¼›</li>
<li>åŸºäº RestTemplate çš„å®¢æˆ·ç«¯çš„æµ‹è¯•æ”¯æŒï¼Œåœ¨æµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œä¸éœ€è¦å¾€çœŸæ­£çš„ REST ç«¯ç‚¹ä¸Šå‘é€è¯·æ±‚ï¼›</li>
<li>@ControllerAdvice æ³¨è§£èƒ½å¤Ÿå°†é€šç”¨çš„ @ExceptionHandlerã€@InitBinder å’Œ @ModelAttributes æ–¹æ³•æ”¶é›†åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œå¹¶åº”ç”¨åˆ°æ‰€æœ‰æ§åˆ¶å™¨ä¸Šï¼›</li>
<li>åœ¨ Spring 3.2 ä¹‹å‰ï¼Œåªèƒ½é€šè¿‡ ContentNegotiatingViewResolver ä½¿ç”¨å®Œæ•´çš„å†…å®¹åå•†ï¼ˆfull content negotiationï¼‰åŠŸèƒ½ã€‚ä½†æ˜¯åœ¨ Spring 3.2 ä¸­ï¼Œå®Œæ•´çš„å†…å®¹åå•†åŠŸèƒ½å¯ä»¥åœ¨æ•´ä¸ª Spring MVC ä¸­ä½¿ç”¨ï¼Œå³ä¾¿æ˜¯ä¾èµ–äºæ¶ˆæ¯è½¬æ¢å™¨ï¼ˆmessage converterï¼‰ä½¿ç”¨å’Œäº§ç”Ÿå†…å®¹çš„æ§åˆ¶å™¨æ–¹æ³•ä¹Ÿèƒ½ä½¿ç”¨è¯¥åŠŸèƒ½ï¼›</li>
<li>Spring MVC 3.2 åŒ…å«äº†ä¸€ä¸ªæ–°çš„ @MatrixVariable æ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£èƒ½å¤Ÿå°†è¯·æ±‚ä¸­çš„çŸ©é˜µå˜é‡ï¼ˆmatrix variableï¼‰ç»‘å®šåˆ°å¤„ç†å™¨çš„æ–¹æ³•å‚æ•°ä¸­ï¼›</li>
<li>åŸºç¡€çš„æŠ½è±¡ç±» AbstractDispatcherServletInitializer èƒ½å¤Ÿéå¸¸ä¾¿åˆ©åœ°é…ç½® DispatcherServletï¼Œè€Œä¸å¿…å†ä½¿ç”¨ web.xmlã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œå½“ä½ å¸Œæœ›é€šè¿‡åŸºäº Java çš„æ–¹å¼æ¥é…ç½® Spring çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ Abstract- AnnotationConfigDispatcherServletInitializer çš„å­ç±»ï¼›</li>
<li>æ–°å¢äº† ResponseEntityExceptionHandlerï¼Œå¯ä»¥ç”¨æ¥æ›¿ä»£ DefaultHandlerExceptionResolverã€‚ResponseEntityExceptionHandleræ–¹æ³•ä¼šè¿”å›<code>ResponseEntity&lt;Object&gt;</code>ï¼Œè€Œä¸æ˜¯ ModelAndViewï¼›RestTemplate å’Œ @RequestBody çš„å‚æ•°å¯ä»¥æ”¯æŒèŒƒå‹ï¼›</li>
<li>RestTemplate å’Œ @RequestMapping å¯ä»¥æ”¯æŒ HTTP PATCH æ–¹æ³•ï¼›</li>
<li>åœ¨æ‹¦æˆªå™¨åŒ¹é…æ—¶ï¼Œæ”¯æŒä½¿ç”¨ URL æ¨¡å¼å°†å…¶æ’é™¤åœ¨æ‹¦æˆªå™¨çš„å¤„ç†åŠŸèƒ½ä¹‹å¤–ã€‚</li>
</ul>
<p>è™½ç„¶ Spring MVC æ˜¯ Spring 3.2 æ”¹å–„çš„æ ¸å¿ƒå†…å®¹ï¼Œä½†æ˜¯å®ƒä¾ç„¶è¿˜å¢åŠ äº†å¤šé¡¹é MVC çš„åŠŸèƒ½æ”¹å–„ã€‚ä¸‹é¢åˆ—å‡ºäº† Spring 3.2 ä¸­å‡ é¡¹æœ€ä¸ºæœ‰æ„æ€çš„æ–°ç‰¹æ€§ï¼š</p>
<ul>
<li>@Autowiredã€@Value å’Œ @Bean æ³¨è§£èƒ½å¤Ÿä½œä¸ºå…ƒæ³¨è§£ï¼Œç”¨äºåˆ›å»ºè‡ªå®šä¹‰çš„æ³¨å…¥å’Œbeanå£°æ˜æ³¨è§£ï¼›</li>
<li>@DateTimeFormat æ³¨è§£ä¸å†å¼ºä¾èµ– JodaTimeã€‚å¦‚æœæä¾›äº† JodaTimeï¼Œå°±ä¼šä½¿ç”¨å®ƒï¼Œå¦åˆ™çš„è¯ï¼Œä¼šä½¿ç”¨ SimpleDateFormatï¼›</li>
<li>Spring çš„å£°æ˜å¼ç¼“å­˜æä¾›äº†å¯¹ JCache 0.5 çš„æ”¯æŒï¼›</li>
<li>æ”¯æŒå®šä¹‰å…¨å±€çš„æ ¼å¼æ¥è§£æå’Œæ¸²æŸ“æ—¥æœŸä¸æ—¶é—´ï¼›</li>
<li>åœ¨é›†æˆæµ‹è¯•ä¸­ï¼Œèƒ½å¤Ÿé…ç½®å’ŒåŠ è½½ WebApplicationContextï¼›</li>
<li>åœ¨é›†æˆæµ‹è¯•ä¸­ï¼Œèƒ½å¤Ÿé’ˆå¯¹ request å’Œ session ä½œç”¨åŸŸçš„ bean è¿›è¡Œæµ‹è¯•ã€‚</li>
</ul>
<p>åœ¨æœ¬ä¹¦çš„å¤šä¸ªç« èŠ‚ä¸­ï¼Œéƒ½èƒ½çœ‹åˆ°Spring 3.2çš„ç‰¹æ€§ï¼Œå°¤å…¶æ˜¯åœ¨Webå’ŒRESTç›¸å…³çš„ç« èŠ‚ä¸­ã€‚</p>
<h4 id="Spring-4-0-æ–°ç‰¹æ€§"><a href="#Spring-4-0-æ–°ç‰¹æ€§" class="headerlink" title="Spring 4.0 æ–°ç‰¹æ€§"></a>Spring 4.0 æ–°ç‰¹æ€§</h4><p>å½“ç¼–å†™æœ¬ä¹¦æ—¶ï¼ŒSpring 4.0 æ˜¯æœ€æ–°çš„å‘å¸ƒç‰ˆæœ¬ã€‚åœ¨ Spring 4.0 ä¸­åŒ…å«äº†å¾ˆå¤šä»¤äººå…´å¥‹çš„æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>Spring æä¾›äº†å¯¹ WebSocke tç¼–ç¨‹çš„æ”¯æŒï¼ŒåŒ…æ‹¬æ”¯æŒ JSR-356 â€”â€”Java API for WebSocketï¼›</li>
<li>é‰´äº WebSocket ä»…ä»…æä¾›äº†ä¸€ç§ä½å±‚æ¬¡çš„ APIï¼Œæ€¥éœ€é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œå› æ­¤ Spring 4.0 åœ¨ WebSocket ä¹‹ä¸Šæä¾›äº†ä¸€ä¸ªé«˜å±‚æ¬¡çš„é¢å‘æ¶ˆæ¯çš„ç¼–ç¨‹æ¨¡å‹ï¼Œè¯¥æ¨¡å‹åŸºäºSockJSï¼Œå¹¶ä¸”åŒ…å«äº†å¯¹ STOMP åè®®çš„æ”¯æŒï¼›</li>
<li>æ–°çš„æ¶ˆæ¯ï¼ˆmessagingï¼‰æ¨¡å—ï¼Œå¾ˆå¤šçš„ç±»å‹æ¥æºäº Spring Integration é¡¹ç›®ã€‚è¿™ä¸ªæ¶ˆæ¯æ¨¡å—æ”¯æŒ Spring çš„ SockJS/STOMP åŠŸèƒ½ï¼ŒåŒæ—¶æä¾›äº†åŸºäºæ¨¡æ¿çš„æ–¹å¼å‘å¸ƒæ¶ˆæ¯ï¼›</li>
<li>Spring æ˜¯ç¬¬ä¸€æ‰¹ï¼ˆå¦‚æœä¸è¯´æ˜¯ç¬¬ä¸€ä¸ªçš„è¯ï¼‰æ”¯æŒ Java 8 ç‰¹æ€§çš„ Java æ¡†æ¶ï¼Œæ¯”å¦‚å®ƒæ‰€æ”¯æŒçš„ lambda è¡¨è¾¾å¼ã€‚åˆ«çš„æš‚ä¸”ä¸è¯´ï¼Œè¿™é¦–å…ˆèƒ½å¤Ÿè®©ä½¿ç”¨ç‰¹å®šçš„å›è°ƒæ¥å£ï¼ˆå¦‚ RowMapper å’Œ JdbcTemplateï¼‰æ›´åŠ ç®€æ´ï¼Œä»£ç æ›´åŠ æ˜“è¯»ï¼›</li>
<li>ä¸ Java 8 åŒæ—¶å¾—åˆ°æ”¯æŒçš„æ˜¯ JSR-310 â€”- Date ä¸ Time APIï¼Œåœ¨å¤„ç†æ—¥æœŸå’Œæ—¶é—´æ—¶ï¼Œå®ƒä¸ºå¼€å‘è€…æä¾›äº†æ¯” java.util.Date æˆ– java.util.Calendar æ›´ä¸°å¯Œçš„APIï¼›</li>
<li>ä¸º Groovy å¼€å‘çš„åº”ç”¨ç¨‹åºæä¾›äº†æ›´åŠ é¡ºç•…çš„ç¼–ç¨‹ä½“éªŒï¼Œå°¤å…¶æ˜¯æ”¯æŒéå¸¸ä¾¿åˆ©åœ°å®Œå…¨é‡‡ç”¨ Groovy å¼€å‘ Spring åº”ç”¨ç¨‹åºã€‚éšè¿™äº›ä¸€èµ·æä¾›çš„æ˜¯æ¥è‡ªäº Grails çš„BeanBuilderï¼Œå€ŸåŠ©å®ƒèƒ½å¤Ÿé€šè¿‡ Groovy é…ç½® Spring åº”ç”¨ï¼›</li>
<li>æ·»åŠ äº†æ¡ä»¶åŒ–åˆ›å»º bean çš„åŠŸèƒ½ï¼Œåœ¨è¿™é‡Œåªæœ‰å¼€å‘äººå‘˜å®šä¹‰çš„æ¡ä»¶æ»¡è¶³æ—¶ï¼Œæ‰ä¼šåˆ›å»ºæ‰€å£°æ˜çš„ beanï¼›</li>
<li>Spring 4.0 åŒ…å«äº† Spring RestTemplateçš„ä¸€ä¸ªæ–°çš„å¼‚æ­¥å®ç°ï¼Œå®ƒä¼šç«‹å³è¿”å›å¹¶ä¸”å…è®¸åœ¨æ“ä½œå®Œæˆåæ‰§è¡Œå›è°ƒï¼›</li>
<li>æ·»åŠ äº†å¯¹å¤šé¡¹ JEE è§„èŒƒçš„æ”¯æŒï¼ŒåŒ…æ‹¬ JMS 2.0ã€JTA 1.2ã€JPA 2.1 å’Œ Bean Validation 1.1ã€‚</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ Spring æ¡†æ¶çš„æœ€æ–°å‘å¸ƒç‰ˆæœ¬ä¸­ï¼ŒåŒ…å«äº†å¾ˆå¤šä»¤äººå…´å¥‹çš„æ–°ç‰¹æ€§ã€‚åœ¨æœ¬ä¹¦ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¾ˆå¤šè¿™æ ·çš„æ–°ç‰¹æ€§ï¼ŒåŒæ—¶ä¹Ÿä¼šå­¦ä¹  Spring ä¸­é•¿æœŸä»¥æ¥ä¸€ç›´å­˜åœ¨çš„ç‰¹æ€§ã€‚</p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>ç°åœ¨ï¼Œä½ åº”è¯¥å¯¹ Spring çš„åŠŸèƒ½ç‰¹æ€§æœ‰äº†ä¸€ä¸ªæ¸…æ™°çš„è®¤è¯†ã€‚Spring è‡´åŠ›äºç®€åŒ–ä¼ä¸šçº§ Java å¼€å‘ï¼Œä¿ƒè¿›ä»£ç çš„æ¾æ•£è€¦åˆã€‚æˆåŠŸçš„å…³é”®åœ¨äºä¾èµ–æ³¨å…¥å’Œ AOPã€‚</p>
<p>åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬å…ˆä½“éªŒäº† Spring çš„ DIã€‚DI æ˜¯ç»„è£…åº”ç”¨å¯¹è±¡çš„ä¸€ç§æ–¹å¼ï¼Œå€ŸåŠ©è¿™ç§æ–¹å¼å¯¹è±¡æ— éœ€çŸ¥é“ä¾èµ–æ¥è‡ªä½•å¤„æˆ–è€…ä¾èµ–çš„å®ç°æ–¹å¼ã€‚ä¸åŒäºè‡ªå·±è·å–ä¾èµ–å¯¹è±¡ï¼Œå¯¹è±¡ä¼šåœ¨è¿è¡ŒæœŸèµ‹äºˆå®ƒä»¬æ‰€ä¾èµ–çš„å¯¹è±¡ã€‚ä¾èµ–å¯¹è±¡é€šå¸¸ä¼šé€šè¿‡æ¥å£äº†è§£æ‰€æ³¨å…¥çš„å¯¹è±¡ï¼Œè¿™æ ·çš„è¯å°±èƒ½ç¡®ä¿ä½è€¦åˆã€‚</p>
<p>é™¤äº† DIï¼Œæˆ‘ä»¬è¿˜ç®€å•ä»‹ç»äº† Spring å¯¹ AOP çš„æ”¯æŒã€‚AOP å¯ä»¥å¸®åŠ©åº”ç”¨å°†æ•£è½åœ¨å„å¤„çš„é€»è¾‘æ±‡é›†äºä¸€å¤„â€”â€”åˆ‡é¢ã€‚å½“ Spring è£…é… bean çš„æ—¶å€™ï¼Œè¿™äº›åˆ‡é¢èƒ½å¤Ÿåœ¨è¿è¡ŒæœŸç¼–ç»‡èµ·æ¥ï¼Œè¿™æ ·å°±èƒ½éå¸¸æœ‰æ•ˆåœ°èµ‹äºˆ bean æ–°çš„è¡Œä¸ºã€‚</p>
<p>ä¾èµ–æ³¨å…¥å’Œ AOP æ˜¯ Spring æ¡†æ¶æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå› æ­¤åªæœ‰ç†è§£äº†å¦‚ä½•åº”ç”¨ Spring æœ€å…³é”®çš„åŠŸèƒ½ï¼Œä½ æ‰æœ‰èƒ½åŠ›ä½¿ç”¨ Spring æ¡†æ¶çš„å…¶ä»–åŠŸèƒ½ã€‚åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬åªæ˜¯è§¦åŠäº† Spring DI å’Œ AOP ç‰¹æ€§çš„çš®æ¯›ã€‚åœ¨ä»¥åçš„å‡ ç« ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ DI å’Œ AOPã€‚</p>
<p>é—²è¨€å°‘å™ï¼Œæˆ‘ä»¬ç«‹å³è½¬åˆ°ç¬¬2ç« å­¦ä¹ å¦‚ä½•åœ¨ Spring ä¸­ä½¿ç”¨ DI è£…é…å¯¹è±¡ã€‚</p>
<h2 id="è£…é…-Bean"><a href="#è£…é…-Bean" class="headerlink" title="è£…é… Bean"></a>è£…é… Bean</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>å£°æ˜ bean</li>
<li>æ„é€ å™¨æ³¨å…¥å’Œ Setter æ–¹æ³•æ³¨å…¥</li>
<li>è£…é… bean</li>
<li>æ§åˆ¶ bean çš„åˆ›å»ºå’Œé”€æ¯</li>
</ul>
<p>åœ¨çœ‹ç”µå½±çš„æ—¶å€™ï¼Œä½ æ›¾ç»åœ¨ç”µå½±ç»“æŸåç•™åœ¨ä½ç½®ä¸Šç»§ç»­è§‚çœ‹ç‰‡å°¾å­—å¹•å—ï¼Ÿä¸€éƒ¨ç”µå½±éœ€è¦ç”±è¿™ä¹ˆå¤šäººé½å¿ƒååŠ›æ‰èƒ½åˆ¶ä½œå‡ºæ¥ï¼Œè¿™çœŸæ˜¯æœ‰ç‚¹ä»¤äººéš¾ä»¥ç½®ä¿¡ï¼é™¤äº†ä¸»è¦çš„å‚ä¸äººå‘˜â€”â€”æ¼”å‘˜ã€ç¼–å‰§ã€å¯¼æ¼”å’Œåˆ¶ç‰‡äººï¼Œè¿˜æœ‰é‚£äº›å¹•åäººå‘˜â€”â€”éŸ³ä¹å¸ˆã€ç‰¹æ•ˆåˆ¶ä½œäººå‘˜å’Œè‰ºæœ¯æŒ‡å¯¼ï¼Œæ›´ä¸ç”¨è¯´é“å…·å¸ˆã€å½•éŸ³å¸ˆã€æœè£…å¸ˆã€åŒ–å¦†å¸ˆã€ç‰¹æŠ€æ¼”å‘˜ã€å¹¿å‘Šå¸ˆã€ç¬¬ä¸€åŠ©ç†æ‘„å½±å¸ˆã€ç¬¬äºŒåŠ©ç†æ‘„å½±å¸ˆã€å¸ƒæ™¯å¸ˆã€ç¯å…‰å¸ˆå’Œä¼™é£Ÿç®¡ç†å‘˜ï¼ˆæˆ–è®¸æ˜¯æœ€é‡è¦çš„äººå‘˜ï¼‰äº†ã€‚</p>
<p>ç°åœ¨æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœè¿™äº›äººå½¼æ­¤ä¹‹é—´æ²¡æœ‰ä»»ä½•äº¤æµï¼Œä½ æœ€å–œçˆ±çš„ç”µå½±ä¼šå˜æˆä»€ä¹ˆæ ·å­ï¼Ÿè®©æˆ‘è¿™ä¹ˆè¯´å§ï¼Œä»–ä»¬éƒ½å‡ºç°åœ¨æ‘„å½±æ£šä¸­ï¼Œå¼€å§‹å„åšå„çš„äº‹æƒ…ï¼Œå½¼æ­¤ä¹‹é—´äº’ä¸åˆä½œã€‚å¦‚æœå¯¼æ¼”ä¿æŒæ²‰é»˜ä¸å–Šâ€œå¼€æœºâ€ï¼Œæ‘„å½±å¸ˆå°±ä¸ä¼šå¼€å§‹æ‹æ‘„ã€‚æˆ–è®¸è¿™å¹¶æ²¡ä»€ä¹ˆå¤§ä¸äº†çš„ï¼Œå› ä¸ºå¥³ä¸»è§’è¿˜å‘†åœ¨å¥¹çš„ä¿å§†è½¦é‡Œï¼Œè€Œä¸”å› ä¸ºæ²¡æœ‰é›‡ä½£ç¯å…‰å¸ˆï¼Œä¸€åˆ‡å¤„äºé»‘æš—ä¹‹ä¸­ã€‚æˆ–è®¸ä½ æ›¾ç»çœ‹è¿‡ç±»ä¼¼è¿™æ ·çš„ç”µå½±ã€‚ä½†æ˜¯å¤§å¤šæ•°ç”µå½±ï¼ˆæ€»ä¹‹ï¼Œéƒ½è¿˜æ˜¯å¾ˆä¼˜ç§€çš„ï¼‰éƒ½æ˜¯ç”±æˆåƒä¸Šä¸‡çš„äººä¸€èµ·åä½œæ¥å®Œæˆçš„ï¼Œä»–ä»¬æœ‰ç€å…±åŒçš„ç›®æ ‡ï¼šåˆ¶ä½œä¸€éƒ¨å¹¿å—æ¬¢è¿çš„ä½³ä½œã€‚</p>
<p>åœ¨è¿™æ–¹é¢ï¼Œä¸€ä¸ªä¼˜ç§€çš„è½¯ä»¶ä¸ä¹‹ç›¸æ¯”å¹¶æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚ä»»ä½•ä¸€ä¸ªæˆåŠŸçš„åº”ç”¨éƒ½æ˜¯ç”±å¤šä¸ªä¸ºäº†å®ç°æŸä¸€ä¸ªä¸šåŠ¡ç›®æ ‡è€Œç›¸äº’åä½œçš„ç»„ä»¶æ„æˆçš„ã€‚è¿™äº›ç»„ä»¶å¿…é¡»å½¼æ­¤äº†è§£ï¼Œå¹¶ä¸”ç›¸äº’åä½œæ¥å®Œæˆå·¥ä½œã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªåœ¨çº¿è´­ç‰©ç³»ç»Ÿä¸­ï¼Œè®¢å•ç®¡ç†ç»„ä»¶éœ€è¦å’Œäº§å“ç®¡ç†ç»„ä»¶ä»¥åŠä¿¡ç”¨å¡è®¤è¯ç»„ä»¶åä½œã€‚è¿™äº›ç»„ä»¶æˆ–è®¸è¿˜éœ€è¦ä¸æ•°æ®è®¿é—®ç»„ä»¶åä½œï¼Œä»æ•°æ®åº“è¯»å–æ•°æ®ä»¥åŠæŠŠæ•°æ®å†™å…¥æ•°æ®åº“ã€‚</p>
<p>ä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨ç¬¬ 1 ç« ä¸­æ‰€çœ‹åˆ°çš„ï¼Œåˆ›å»ºåº”ç”¨å¯¹è±¡ä¹‹é—´å…³è”å…³ç³»çš„ä¼ ç»Ÿæ–¹æ³•ï¼ˆé€šè¿‡æ„é€ å™¨æˆ–è€…æŸ¥æ‰¾ï¼‰é€šå¸¸ä¼šå¯¼è‡´ç»“æ„å¤æ‚çš„ä»£ç ï¼Œè¿™äº›ä»£ç å¾ˆéš¾è¢«å¤ç”¨ä¹Ÿå¾ˆéš¾è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚å¦‚æœæƒ…å†µä¸ä¸¥é‡çš„è¯ï¼Œè¿™äº›å¯¹è±¡æ‰€åšçš„äº‹æƒ…åªæ˜¯è¶…å‡ºäº†å®ƒåº”è¯¥åšçš„èŒƒå›´ï¼›è€Œæœ€åçš„æƒ…å†µåˆ™æ˜¯ï¼Œè¿™äº›å¯¹è±¡å½¼æ­¤ä¹‹é—´é«˜åº¦è€¦åˆï¼Œéš¾ä»¥å¤ç”¨å’Œæµ‹è¯•ã€‚</p>
<p>åœ¨ Spring ä¸­ï¼Œå¯¹è±¡æ— éœ€è‡ªå·±æŸ¥æ‰¾æˆ–åˆ›å»ºä¸å…¶æ‰€å…³è”çš„å…¶ä»–å¯¹è±¡ã€‚ç›¸åï¼Œå®¹å™¨è´Ÿè´£æŠŠéœ€è¦ç›¸äº’åä½œçš„å¯¹è±¡å¼•ç”¨èµ‹äºˆå„ä¸ªå¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè®¢å•ç®¡ç†ç»„ä»¶éœ€è¦ä¿¡ç”¨å¡è®¤è¯ç»„ä»¶ï¼Œä½†å®ƒä¸éœ€è¦è‡ªå·±åˆ›å»ºä¿¡ç”¨å¡è®¤è¯ç»„ä»¶ã€‚è®¢å•ç®¡ç†ç»„ä»¶åªéœ€è¦è¡¨æ˜è‡ªå·±ä¸¤æ‰‹ç©ºç©ºï¼Œå®¹å™¨å°±ä¼šä¸»åŠ¨èµ‹äºˆå®ƒä¸€ä¸ªä¿¡ç”¨å¡è®¤è¯ç»„ä»¶ã€‚</p>
<p>åˆ›å»ºåº”ç”¨å¯¹è±¡ä¹‹é—´åä½œå…³ç³»çš„è¡Œä¸ºé€šå¸¸ç§°ä¸ºè£…é…ï¼ˆwiringï¼‰ï¼Œè¿™ä¹Ÿæ˜¯ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰çš„æœ¬è´¨ã€‚åœ¨æœ¬ç« æˆ‘ä»¬å°†ä»‹ç»ä½¿ç”¨ Spring è£…é… bean çš„åŸºç¡€çŸ¥è¯†ã€‚å› ä¸º DI æ˜¯ Spring çš„æœ€åŸºæœ¬è¦ç´ ï¼Œæ‰€ä»¥åœ¨å¼€å‘åŸºäº Spring çš„åº”ç”¨æ—¶ï¼Œä½ éšæ—¶éƒ½åœ¨ä½¿ç”¨è¿™äº›æŠ€æœ¯ã€‚</p>
<p>åœ¨ Spring ä¸­è£…é… bean æœ‰å¤šç§æ–¹å¼ã€‚ä½œä¸ºæœ¬ç« çš„å¼€å§‹ï¼Œæˆ‘ä»¬å…ˆèŠ±ä¸€ç‚¹æ—¶é—´æ¥ä»‹ç»ä¸€ä¸‹é…ç½® Spring å®¹å™¨æœ€å¸¸è§çš„ä¸‰ç§æ–¹æ³•ã€‚</p>
<h3 id="Spring-é…ç½®çš„å¯é€‰æ–¹æ¡ˆ"><a href="#Spring-é…ç½®çš„å¯é€‰æ–¹æ¡ˆ" class="headerlink" title="Spring é…ç½®çš„å¯é€‰æ–¹æ¡ˆ"></a>Spring é…ç½®çš„å¯é€‰æ–¹æ¡ˆ</h3><p>å¦‚ç¬¬ 1 ç« ä¸­æ‰€è¿°ï¼ŒSpring å®¹å™¨è´Ÿè´£åˆ›å»ºåº”ç”¨ç¨‹åºä¸­çš„ bean å¹¶é€šè¿‡ DI æ¥åè°ƒè¿™äº›å¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚ä½†æ˜¯ï¼Œä½œä¸ºå¼€å‘äººå‘˜ï¼Œä½ éœ€è¦å‘Šè¯‰ Spring è¦åˆ›å»ºå“ªäº› bean å¹¶ä¸”å¦‚ä½•å°†å…¶è£…é…åœ¨ä¸€èµ·ã€‚å½“æè¿° bean å¦‚ä½•è¿›è¡Œè£…é…æ—¶ï¼ŒSpring å…·æœ‰éå¸¸å¤§çš„çµæ´»æ€§ï¼Œå®ƒæä¾›äº†ä¸‰ç§ä¸»è¦çš„è£…é…æœºåˆ¶ï¼š</p>
<ul>
<li>åœ¨ XML ä¸­è¿›è¡Œæ˜¾å¼é…ç½®ã€‚</li>
<li>åœ¨ Java ä¸­è¿›è¡Œæ˜¾å¼é…ç½®ã€‚</li>
<li>éšå¼çš„ bean å‘ç°æœºåˆ¶å’Œè‡ªåŠ¨è£…é…ã€‚</li>
</ul>
<p>ä¹çœ‹ä¸Šå»ï¼Œæä¾›ä¸‰ç§å¯é€‰çš„é…ç½®æ–¹æ¡ˆä¼šä½¿ Spring å˜å¾—å¤æ‚ã€‚æ¯ç§é…ç½®æŠ€æœ¯æ‰€æä¾›çš„åŠŸèƒ½ä¼šæœ‰ä¸€äº›é‡å ï¼Œæ‰€ä»¥åœ¨ç‰¹å®šçš„åœºæ™¯ä¸­ï¼Œç¡®å®šå“ªç§æŠ€æœ¯æœ€ä¸ºåˆé€‚å°±ä¼šå˜å¾—æœ‰äº›å›°éš¾ã€‚ä½†æ˜¯ï¼Œä¸å¿…ç´§å¼ â€”â€”åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œé€‰æ‹©å“ªç§æ–¹æ¡ˆå¾ˆå¤§ç¨‹åº¦ä¸Šå°±æ˜¯ä¸ªäººå–œå¥½çš„é—®é¢˜ï¼Œä½ å°½å¯ä»¥é€‰æ‹©è‡ªå·±æœ€å–œæ¬¢çš„æ–¹å¼ã€‚</p>
<p>Spring æœ‰å¤šç§å¯é€‰æ–¹æ¡ˆæ¥é…ç½® beanï¼Œè¿™æ˜¯éå¸¸æ£’çš„ï¼Œä½†æœ‰æ—¶å€™ä½ å¿…é¡»è¦åœ¨å…¶ä¸­åšå‡ºé€‰æ‹©ã€‚</p>
<p>è¿™æ–¹é¢ï¼Œå¹¶æ²¡æœ‰å”¯ä¸€çš„æ­£ç¡®ç­”æ¡ˆã€‚ä½ æ‰€åšå‡ºçš„é€‰æ‹©å¿…é¡»è¦é€‚åˆä½ å’Œä½ çš„é¡¹ç›®ã€‚è€Œä¸”ï¼Œè°è¯´æˆ‘ä»¬åªèƒ½é€‰æ‹©å…¶ä¸­çš„ä¸€ç§æ–¹æ¡ˆå‘¢ï¼ŸSpring çš„é…ç½®é£æ ¼æ˜¯å¯ä»¥äº’ç›¸æ­é…çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ XML è£…é…ä¸€äº› beanï¼Œä½¿ç”¨ Spring åŸºäº Java çš„é…ç½®ï¼ˆJavaConfigï¼‰æ¥è£…é…å¦ä¸€äº› beanï¼Œè€Œå°†å‰©ä½™çš„ bean è®© Spring å»è‡ªåŠ¨å‘ç°ã€‚</p>
<p>å³ä¾¿å¦‚æ­¤ï¼Œæˆ‘çš„å»ºè®®æ˜¯<strong>å°½å¯èƒ½åœ°ä½¿ç”¨è‡ªåŠ¨é…ç½®çš„æœºåˆ¶</strong>ã€‚æ˜¾å¼é…ç½®è¶Šå°‘è¶Šå¥½ã€‚å½“ä½ å¿…é¡»è¦æ˜¾å¼é…ç½® bean çš„æ—¶å€™ï¼ˆæ¯”å¦‚ï¼Œæœ‰äº›æºç ä¸æ˜¯ç”±ä½ æ¥ç»´æŠ¤çš„ï¼Œè€Œå½“ä½ éœ€è¦ä¸ºè¿™äº›ä»£ç é…ç½®bean çš„æ—¶å€™ï¼‰ï¼Œæˆ‘æ¨èä½¿ç”¨ç±»å‹å®‰å…¨å¹¶ä¸”æ¯” XML æ›´åŠ å¼ºå¤§çš„ JavaConfigã€‚æœ€åï¼Œåªæœ‰å½“ä½ æƒ³è¦ä½¿ç”¨ä¾¿åˆ©çš„ XML å‘½åç©ºé—´ï¼Œå¹¶ä¸”åœ¨ JavaConfig ä¸­æ²¡æœ‰åŒæ ·çš„å®ç°æ—¶ï¼Œæ‰åº”è¯¥ä½¿ç”¨ XMLã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šè¯¦ç»†ä»‹ç»è¿™ä¸‰ç§æŠ€æœ¯å¹¶ä¸”åœ¨æ•´æœ¬ä¹¦ä¸­éƒ½ä¼šç”¨åˆ°å®ƒä»¬ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ä¼šå°è¯•ä¸€ä¸‹æ¯ç§æ–¹æ³•ï¼Œå¯¹å®ƒä»¬æ˜¯ä»€ä¹ˆæ ·å­çš„æœ‰ä¸€ä¸ªç›´è§‚çš„å°è±¡ã€‚ä½œä¸ºSpringé…ç½®çš„å¼€å§‹ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹Springçš„è‡ªåŠ¨åŒ–é…ç½®ã€‚</p>
<h3 id="è‡ªåŠ¨åŒ–è£…é…-Bean"><a href="#è‡ªåŠ¨åŒ–è£…é…-Bean" class="headerlink" title="è‡ªåŠ¨åŒ–è£…é… Bean"></a>è‡ªåŠ¨åŒ–è£…é… Bean</h3><p>åœ¨æœ¬ç« ç¨åçš„å†…å®¹ä¸­ï¼Œä½ ä¼šçœ‹åˆ°å¦‚ä½•å€ŸåŠ© Java å’Œ XML æ¥è¿›è¡Œ Spring è£…é…ã€‚å°½ç®¡ä½ ä¼šå‘ç°è¿™äº›æ˜¾å¼è£…é…æŠ€æœ¯éå¸¸æœ‰ç”¨ï¼Œä½†æ˜¯åœ¨ä¾¿åˆ©æ€§æ–¹é¢ï¼Œæœ€å¼ºå¤§çš„è¿˜æ˜¯ Spring çš„è‡ªåŠ¨åŒ–é…ç½®ã€‚å¦‚æœ Spring èƒ½å¤Ÿè¿›è¡Œè‡ªåŠ¨åŒ–è£…é…çš„è¯ï¼Œé‚£ä½•è‹¦è¿˜è¦æ˜¾å¼åœ°å°†è¿™äº› bean è£…é…åœ¨ä¸€èµ·å‘¢ï¼Ÿ</p>
<p>Spring ä»ä¸¤ä¸ªè§’åº¦æ¥å®ç°è‡ªåŠ¨åŒ–è£…é…ï¼š</p>
<ul>
<li>ç»„ä»¶æ‰«æï¼ˆcomponent scanningï¼‰ï¼šSpring ä¼šè‡ªåŠ¨å‘ç°åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰€åˆ›å»ºçš„ beanã€‚</li>
<li>è‡ªåŠ¨è£…é…ï¼ˆautowiringï¼‰ï¼šSpring è‡ªåŠ¨æ»¡è¶³ bean ä¹‹é—´çš„ä¾èµ–ã€‚</li>
</ul>
<p>ç»„ä»¶æ‰«æå’Œè‡ªåŠ¨è£…é…ç»„åˆåœ¨ä¸€èµ·å°±èƒ½å‘æŒ¥å‡ºå¼ºå¤§çš„å¨åŠ›ï¼Œå®ƒä»¬èƒ½å¤Ÿå°†ä½ çš„æ˜¾å¼é…ç½®é™ä½åˆ°æœ€å°‘ã€‚</p>
<p>ä¸ºäº†é˜è¿°ç»„ä»¶æ‰«æå’Œè£…é…ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºå‡ ä¸ª beanï¼Œå®ƒä»¬ä»£è¡¨äº†ä¸€ä¸ªéŸ³å“ç³»ç»Ÿä¸­çš„ç»„ä»¶ã€‚é¦–å…ˆï¼Œè¦åˆ›å»º CompactDisc ç±»ï¼ŒSpring ä¼šå‘ç°å®ƒå¹¶å°†å…¶åˆ›å»ºä¸ºä¸€ä¸ªbeanã€‚ç„¶åï¼Œä¼šåˆ›å»ºä¸€ä¸ª CDPlayer ç±»ï¼Œè®© Spring å‘ç°å®ƒï¼Œå¹¶å°† CompactDisc bean æ³¨å…¥è¿›æ¥ã€‚</p>
<h4 id="åˆ›å»ºå¯è¢«å‘ç°çš„-bean"><a href="#åˆ›å»ºå¯è¢«å‘ç°çš„-bean" class="headerlink" title="åˆ›å»ºå¯è¢«å‘ç°çš„ bean"></a>åˆ›å»ºå¯è¢«å‘ç°çš„ bean</h4><p>åœ¨è¿™ä¸ª MP3 å’Œæµå¼åª’ä½“éŸ³ä¹çš„æ—¶ä»£ï¼ŒCDï¼ˆcompact discï¼‰æ˜¾å¾—æœ‰ç‚¹å…¸é›…ç”šè‡³é™ˆæ—§ã€‚å®ƒä¸åƒå¡å¸¦æœºã€å…«è½¨ç£å¸¦ã€å¡‘èƒ¶å”±ç‰‡é‚£ä¹ˆæ™®éï¼Œéšç€ä»¥ç‰©ç†è½½ä½“è¿›è¡ŒéŸ³ä¹äº¤ä»˜çš„æ–¹å¼è¶Šæ¥è¶Šå°‘ï¼ŒCD ä¹Ÿå˜å¾—è¶Šæ¥è¶Šç¨€å°‘äº†ã€‚</p>
<p>å°½ç®¡å¦‚æ­¤ï¼ŒCD ä¸ºæˆ‘ä»¬é˜è¿° DI å¦‚ä½•è¿è¡Œæä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„æ ·ä¾‹ã€‚å¦‚æœä½ ä¸å°† CD æ’å…¥ï¼ˆæ³¨å…¥ï¼‰åˆ° CD æ’­æ”¾å™¨ä¸­ï¼Œé‚£ä¹ˆ CD æ’­æ”¾å™¨å…¶å®æ˜¯æ²¡æœ‰å¤ªå¤§ç”¨å¤„çš„ã€‚æ‰€ä»¥ï¼Œå¯ä»¥è¿™æ ·è¯´ï¼ŒCD æ’­æ”¾å™¨ä¾èµ–äº CD æ‰èƒ½å®Œæˆå®ƒçš„ä½¿å‘½ã€‚</p>
<p>ä¸ºäº†åœ¨ Spring ä¸­é˜è¿°è¿™ä¸ªä¾‹å­ï¼Œè®©æˆ‘ä»¬é¦–å…ˆåœ¨ Java ä¸­å»ºç«‹ CD çš„æ¦‚å¿µã€‚ç¨‹åºæ¸…å• 2.1 å±•ç°äº† CompactDiscï¼Œå®ƒæ˜¯å®šä¹‰ CD çš„ä¸€ä¸ªæ¥å£ï¼š</p>
<center>ç¨‹åºæ¸…å• 2.1ã€€CompactDisc æ¥å£åœ¨ Java ä¸­å®šä¹‰äº† CD çš„æ¦‚å¿µ</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CompactDisc</span> </span>&#123;  <span class="function"><span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>CompactDisc çš„å…·ä½“å†…å®¹å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯ä½ å°†å…¶å®šä¹‰ä¸ºä¸€ä¸ªæ¥å£ã€‚ä½œä¸ºæ¥å£ï¼Œå®ƒå®šä¹‰äº† CD æ’­æ”¾å™¨å¯¹ä¸€ç›˜ CD æ‰€èƒ½è¿›è¡Œçš„æ“ä½œã€‚å®ƒå°† CD æ’­æ”¾å™¨çš„ä»»æ„å®ç°ä¸CD æœ¬èº«çš„è€¦åˆé™ä½åˆ°äº†æœ€å°çš„ç¨‹åº¦ã€‚</p>
<center>ç¨‹åºæ¸…å• 2.2 å¸¦æœ‰ @Component æ³¨è§£çš„ CompactDisc å®ç°ç±» SgtPeppers</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;<span class="keyword">import</span> org.springframework.stereotype.Component;<span class="meta">@Componentpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">SgtPeppers</span> <span class="keyword">implements</span> <span class="title">CompactDisc</span> </span>&#123;  <span class="keyword">private</span> String title = <span class="string">&quot;Sgt. Pepper&#x27;s Lonely Hearts Club Band&quot;</span>;    <span class="keyword">private</span> String artist = <span class="string">&quot;The Beatles&quot;</span>;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;    System.out.println(<span class="string">&quot;Playing &quot;</span> + title + <span class="string">&quot; by &quot;</span> + artist);  &#125;  &#125;</span><br></pre></td></tr></table></figure>

<p>å’Œ CompactDisc æ¥å£ä¸€æ ·ï¼ŒSgtPeppers çš„å…·ä½“å†…å®¹å¹¶ä¸é‡è¦ã€‚ä½ éœ€è¦æ³¨æ„çš„å°±æ˜¯ SgtPeppers ç±»ä¸Šä½¿ç”¨äº†@Component æ³¨è§£ã€‚@Component æ³¨è§£è¡¨æ˜è¯¥ç±»ä¼šä½œä¸ºç»„ä»¶ç±»ï¼Œå¹¶å‘ŠçŸ¥ Spring è¦ä¸ºè¿™ä¸ªç±»åˆ›å»º beanã€‚æ²¡æœ‰å¿…è¦æ˜¾å¼é…ç½® SgtPeppers beanï¼Œå› ä¸ºè¿™ä¸ªç±»ä½¿ç”¨äº† @Component æ³¨è§£ï¼Œæ‰€ä»¥ Spring ä¼šä¸ºä½ æŠŠäº‹æƒ…å¤„ç†å¦¥å½“ã€‚</p>
<p>ä¸è¿‡ï¼Œç»„ä»¶æ‰«æé»˜è®¤æ˜¯ä¸å¯ç”¨çš„ã€‚æˆ‘ä»¬è¿˜éœ€è¦æ˜¾å¼é…ç½®ä¸€ä¸‹ Springï¼Œä»è€Œå‘½ä»¤å®ƒå»å¯»æ‰¾å¸¦æœ‰ @Component æ³¨è§£çš„ç±»ï¼Œå¹¶ä¸ºå…¶åˆ›å»º beanã€‚ç¨‹åºæ¸…å• 2.3 çš„é…ç½®ç±»å±•ç°äº†å®Œæˆè¿™é¡¹ä»»åŠ¡çš„æœ€ç®€æ´é…ç½®ã€‚</p>
<center>ç¨‹åºæ¸…å• 2.3 @ComponentScan æ³¨è§£å¯ç”¨äº†ç»„ä»¶æ‰«æ</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;<span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="meta">@Configuration</span><span class="meta">@ComponentScanpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">CDPlayerConfig</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

<p>ç±» CDPlayerConfig é€šè¿‡ Java ä»£ç å®šä¹‰äº† Spring çš„è£…é…è§„åˆ™ã€‚åœ¨ 2.3 èŠ‚ä¸­ï¼Œæˆ‘ä»¬è¿˜ä¼šæ›´ä¸ºè¯¦ç»†åœ°ä»‹ç»åŸºäº Java çš„ Spring é…ç½®ã€‚ä¸è¿‡ï¼Œç°åœ¨æˆ‘ä»¬åªéœ€è§‚å¯Ÿä¸€ä¸‹ CDPlayerConfig ç±»å¹¶æ²¡æœ‰æ˜¾å¼åœ°å£°æ˜ä»»ä½• beanï¼Œåªä¸è¿‡å®ƒä½¿ç”¨äº†@ComponentScan æ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£èƒ½å¤Ÿåœ¨ Spring ä¸­å¯ç”¨ç»„ä»¶æ‰«æã€‚</p>
<p>å¦‚æœæ²¡æœ‰å…¶ä»–é…ç½®çš„è¯ï¼Œ@ComponentScan é»˜è®¤ä¼šæ‰«æä¸é…ç½®ç±»ç›¸åŒçš„åŒ…ã€‚å› ä¸º CDPlayerConfig ç±»ä½äº soundsystem åŒ…ä¸­ï¼Œå› æ­¤ Spring å°†ä¼šæ‰«æè¿™ä¸ªåŒ…ä»¥åŠè¿™ä¸ªåŒ…ä¸‹çš„æ‰€æœ‰å­åŒ…ï¼ŒæŸ¥æ‰¾å¸¦æœ‰ @Component æ³¨è§£çš„ç±»ã€‚è¿™æ ·çš„è¯ï¼Œå°±èƒ½å‘ç° CompactDiscï¼Œå¹¶ä¸”ä¼šåœ¨ Spring ä¸­è‡ªåŠ¨ä¸ºå…¶åˆ›å»ºä¸€ä¸ª beanã€‚</p>
<p>å¦‚æœä½ æ›´å€¾å‘äºä½¿ç”¨ XML æ¥å¯ç”¨ç»„ä»¶æ‰«æçš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ Spring context å‘½åç©ºé—´çš„ <code>&lt;context:component-scan&gt;</code> å…ƒç´ ã€‚ç¨‹åºæ¸…å• 2.4 å±•ç¤ºäº†å¯ç”¨ç»„ä»¶æ‰«æçš„æœ€ç®€æ´ XML é…ç½®ã€‚</p>
<center>ç¨‹åºæ¸…å• 2.4ã€€é€šè¿‡ XML å¯ç”¨ç»„ä»¶æ‰«æ</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span>  <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span>  <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd      http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;soundsystem&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å°½ç®¡æˆ‘ä»¬å¯ä»¥é€šè¿‡ XML çš„æ–¹æ¡ˆæ¥å¯ç”¨ç»„ä»¶æ‰«æï¼Œä½†æ˜¯åœ¨åé¢çš„è®¨è®ºä¸­ï¼Œæˆ‘æ›´å¤šçš„è¿˜æ˜¯ä¼šä½¿ç”¨åŸºäº Java çš„é…ç½®ã€‚å¦‚æœä½ æ›´å–œæ¬¢XMLçš„è¯ï¼Œ<code>&lt;context:component-scan&gt;</code> å…ƒç´ ä¼šæœ‰ä¸@ComponentScanæ³¨è§£ç›¸å¯¹åº”çš„å±æ€§å’Œå­å…ƒç´ ã€‚</p>
<p>å¯èƒ½æœ‰ç‚¹è®©äººéš¾ä»¥ç½®ä¿¡ï¼Œæˆ‘ä»¬åªåˆ›å»ºäº†ä¸¤ä¸ªç±»ï¼Œå°±èƒ½å¯¹åŠŸèƒ½è¿›è¡Œä¸€ç•ªå°è¯•äº†ã€‚ä¸ºäº†æµ‹è¯•ç»„ä»¶æ‰«æçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„ JUnit æµ‹è¯•ï¼Œå®ƒä¼šåˆ›å»º Spring ä¸Šä¸‹æ–‡ï¼Œå¹¶åˆ¤æ–­ CompactDisc æ˜¯ä¸æ˜¯çœŸçš„åˆ›å»ºå‡ºæ¥äº†ã€‚ç¨‹åºæ¸…å• 2.5 ä¸­çš„ CDPlayerTest å°±æ˜¯ç”¨æ¥å®Œæˆè¿™é¡¹ä»»åŠ¡çš„ã€‚</p>
<center>ç¨‹åºæ¸…å• 2.5ã€€æµ‹è¯•ç»„ä»¶æ‰«æèƒ½å¤Ÿå‘ç° CompactDisc</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;<span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;<span class="keyword">import</span> org.junit.Test;<span class="keyword">import</span> org.junit.runner.RunWith;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;<span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;<span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span><span class="meta">@ContextConfiguration(classes=CDPlayerConfig.class)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CDPlayerTest</span> </span>&#123;  <span class="meta">@Autowired</span>  <span class="keyword">private</span> CompactDisc cd;    <span class="meta">@Test</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cdShouldNotBeNull</span><span class="params">()</span> </span>&#123;    assertNotNull(cd);  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>CDPlayerTest ä½¿ç”¨äº† Spring çš„ SpringJUnit4ClassRunnerï¼Œä»¥ä¾¿åœ¨æµ‹è¯•å¼€å§‹çš„æ—¶å€™è‡ªåŠ¨åˆ›å»º Spring çš„åº”ç”¨ä¸Šä¸‹æ–‡ã€‚æ³¨è§£ @ContextConfiguration ä¼šå‘Šè¯‰å®ƒéœ€è¦åœ¨ CDPlayerConfig ä¸­åŠ è½½é…ç½®ã€‚å› ä¸º CDPlayerConfig ç±»ä¸­åŒ…å«äº†@ComponentScanï¼Œå› æ­¤æœ€ç»ˆçš„åº”ç”¨ä¸Šä¸‹æ–‡ä¸­åº”è¯¥åŒ…å« CompactDiscbeanã€‚</p>
<p>ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œåœ¨æµ‹è¯•ä»£ç ä¸­æœ‰ä¸€ä¸ª CompactDisc ç±»å‹çš„å±æ€§ï¼Œå¹¶ä¸”è¿™ä¸ªå±æ€§å¸¦æœ‰ @Autowired æ³¨è§£ï¼Œä»¥ä¾¿äºå°† CompactDiscbean æ³¨å…¥åˆ°æµ‹è¯•ä»£ç ä¹‹ä¸­ã€‚æœ€åï¼Œä¼šæœ‰ä¸€ä¸ªç®€å•çš„æµ‹è¯•æ–¹æ³•æ–­è¨€ cd å±æ€§ä¸ä¸º nullã€‚å¦‚æœå®ƒä¸ä¸º null çš„è¯ï¼Œå°±æ„å‘³ç€ Spring èƒ½å¤Ÿå‘ç° CompactDisc ç±»ï¼Œè‡ªåŠ¨åœ¨ Spring ä¸Šä¸‹æ–‡ä¸­å°†å…¶åˆ›å»ºä¸º bean å¹¶å°†å…¶æ³¨å…¥åˆ°æµ‹è¯•ä»£ç ä¹‹ä¸­ã€‚</p>
<p>è¿™ä¸ªä»£ç åº”è¯¥èƒ½å¤Ÿé€šè¿‡æµ‹è¯•ï¼Œå¹¶ä»¥æµ‹è¯•æˆåŠŸçš„é¢œè‰²æ˜¾ç¤ºï¼ˆåœ¨ä½ çš„æµ‹è¯•è¿è¡Œå™¨ä¸­ï¼Œæˆ–è®¸ä¼šå¸Œæœ›å‡ºç°ç»¿è‰²ï¼‰ã€‚ä½ ç¬¬ä¸€ä¸ªç®€å•çš„ç»„ä»¶æ‰«æç»ƒä¹ å°±æˆåŠŸäº†ï¼å°½ç®¡æˆ‘ä»¬åªç”¨å®ƒåˆ›å»ºäº†ä¸€ä¸ª beanï¼Œä½†åŒæ ·æ˜¯è¿™ä¹ˆå°‘çš„é…ç½®èƒ½å¤Ÿç”¨æ¥å‘ç°å’Œåˆ›å»ºä»»æ„æ•°é‡çš„ beanã€‚åœ¨ soundsystem åŒ…åŠå…¶å­åŒ…ä¸­ï¼Œæ‰€æœ‰å¸¦æœ‰ @Component æ³¨è§£çš„ç±»éƒ½ä¼šåˆ›å»ºä¸º beanã€‚åªæ·»åŠ ä¸€è¡Œ @ComponentScan æ³¨è§£å°±èƒ½è‡ªåŠ¨åˆ›å»ºæ— æ•°ä¸ª beanï¼Œè¿™ç§æƒè¡¡è¿˜æ˜¯å¾ˆåˆ’ç®—çš„ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¼šæ›´åŠ æ·±å…¥åœ°æ¢è®¨ @ComponentScan å’Œ @Componentï¼Œçœ‹ä¸€ä¸‹ä½¿ç”¨ç»„ä»¶æ‰«æè¿˜èƒ½åšäº›ä»€ä¹ˆã€‚</p>
<h4 id="ä¸ºç»„ä»¶æ‰«æçš„-bean-å‘½å"><a href="#ä¸ºç»„ä»¶æ‰«æçš„-bean-å‘½å" class="headerlink" title="ä¸ºç»„ä»¶æ‰«æçš„ bean å‘½å"></a>ä¸ºç»„ä»¶æ‰«æçš„ bean å‘½å</h4><p>Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰çš„ bean éƒ½ä¼šç»™å®šä¸€ä¸ª IDã€‚åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œå°½ç®¡æˆ‘ä»¬æ²¡æœ‰æ˜ç¡®åœ°ä¸º SgtPeppers bean è®¾ç½® IDï¼Œä½† Spring ä¼šæ ¹æ®ç±»åä¸ºå…¶æŒ‡å®šä¸€ä¸ªIDã€‚å…·ä½“æ¥è®²ï¼Œè¿™ä¸ª bean æ‰€ç»™å®šçš„ ID ä¸º sgtPeppersï¼Œä¹Ÿå°±æ˜¯å°†ç±»åçš„ç¬¬ä¸€ä¸ªå­—æ¯å˜ä¸ºå°å†™ã€‚</p>
<p>å¦‚æœæƒ³ä¸ºè¿™ä¸ª bean è®¾ç½®ä¸åŒçš„ IDï¼Œä½ æ‰€è¦åšçš„å°±æ˜¯å°†æœŸæœ›çš„ ID ä½œä¸ºå€¼ä¼ é€’ç»™ @Component æ³¨è§£ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœæƒ³å°†è¿™ä¸ª bean æ ‡è¯†ä¸º lonelyHeartsClubï¼Œé‚£ä¹ˆä½ éœ€è¦å°† SgtPeppers ç±»çš„ @Component æ³¨è§£é…ç½®ä¸ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;lonelyHeartsClub&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SgtPeppers</span> <span class="keyword">implements</span> <span class="title">CompactDisc</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ Java ä¾èµ–æ³¨å…¥è§„èŒƒï¼ˆJava Dependency Injectionï¼‰ä¸­æ‰€æä¾›çš„ @Named æ³¨è§£æ¥ä¸º bean è®¾ç½® IDï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.inject.Named;<span class="meta">@Named(&quot;lonelyHeartsClub&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SgtPeppers</span> <span class="keyword">implements</span> <span class="title">CompactDisc</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Spring æ”¯æŒå°† @Named ä½œä¸º @Component æ³¨è§£çš„æ›¿ä»£æ–¹æ¡ˆã€‚ä¸¤è€…ä¹‹é—´æœ‰ä¸€äº›ç»†å¾®çš„å·®å¼‚ï¼Œä½†æ˜¯åœ¨å¤§å¤šæ•°åœºæ™¯ä¸­ï¼Œå®ƒä»¬æ˜¯å¯ä»¥äº’ç›¸æ›¿æ¢çš„ã€‚</p>
<p>è¯è™½å¦‚æ­¤ï¼Œæˆ‘æ›´åŠ å¼ºçƒˆåœ°å–œæ¬¢ @Component æ³¨è§£ï¼Œè€Œå¯¹äº @Namedâ€¦â€¦ æ€ä¹ˆè¯´å‘¢ï¼Œæˆ‘æ„Ÿè§‰å®ƒçš„åå­—èµ·å¾—å¾ˆä¸å¥½ã€‚å®ƒå¹¶æ²¡æœ‰åƒ @Component é‚£æ ·æ¸…æ¥šåœ°è¡¨æ˜å®ƒæ˜¯åšä»€ä¹ˆçš„ã€‚å› æ­¤åœ¨æœ¬ä¹¦åŠå…¶ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä¸ä¼šå†ä½¿ç”¨ @Namedã€‚</p>
<h4 id="è®¾ç½®ç»„ä»¶æ‰«æçš„åŸºç¡€åŒ…"><a href="#è®¾ç½®ç»„ä»¶æ‰«æçš„åŸºç¡€åŒ…" class="headerlink" title="è®¾ç½®ç»„ä»¶æ‰«æçš„åŸºç¡€åŒ…"></a>è®¾ç½®ç»„ä»¶æ‰«æçš„åŸºç¡€åŒ…</h4><p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¸º @ComponentScan è®¾ç½®ä»»ä½•å±æ€§ã€‚è¿™æ„å‘³ç€ï¼ŒæŒ‰ç…§é»˜è®¤è§„åˆ™ï¼Œå®ƒä¼šä»¥é…ç½®ç±»æ‰€åœ¨çš„åŒ…ä½œä¸ºåŸºç¡€åŒ…ï¼ˆbasepackageï¼‰æ¥æ‰«æç»„ä»¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³æ‰«æä¸åŒçš„åŒ…ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ–è€…ï¼Œå¦‚æœä½ æƒ³æ‰«æå¤šä¸ªåŸºç¡€åŒ…ï¼Œé‚£åˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>æœ‰ä¸€ä¸ªåŸå› ä¼šä¿ƒä½¿æˆ‘ä»¬æ˜ç¡®åœ°è®¾ç½®åŸºç¡€åŒ…ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬æƒ³è¦å°†é…ç½®ç±»æ”¾åœ¨å•ç‹¬çš„åŒ…ä¸­ï¼Œä½¿å…¶ä¸å…¶ä»–çš„åº”ç”¨ä»£ç åŒºåˆ†å¼€æ¥ã€‚å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œé‚£é»˜è®¤çš„åŸºç¡€åŒ…å°±ä¸èƒ½æ»¡è¶³è¦æ±‚äº†ã€‚</p>
<p>è¦æ»¡è¶³è¿™æ ·çš„éœ€æ±‚å…¶å®ä¹Ÿå®Œå…¨æ²¡æœ‰é—®é¢˜ï¼ä¸ºäº†æŒ‡å®šä¸åŒçš„åŸºç¡€åŒ…ï¼Œä½ æ‰€éœ€è¦åšçš„å°±æ˜¯åœ¨ @ComponentScan çš„ value å±æ€§ä¸­æŒ‡æ˜åŒ…çš„åç§°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span><span class="meta">@ComponentScan(&quot;soundsystem&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CDPlayerConfig</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æƒ³æ›´åŠ æ¸…æ™°åœ°è¡¨æ˜ä½ æ‰€è®¾ç½®çš„æ˜¯åŸºç¡€åŒ…ï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡ basePackages å±æ€§è¿›è¡Œé…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span><span class="meta">@ComponentScan(basePackages=&quot;soundsystem&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CDPlayerConfig</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³è¦è®¾ç½®å¤šä¸ªåŸºç¡€åŒ…ï¼Œåªéœ€è¦å°† basePackages å±æ€§è®¾ç½®ä¸ºè¦æ‰«æåŒ…çš„ä¸€ä¸ªæ•°ç»„å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span><span class="meta">@ComponentScan(basePackages=&#123;&quot;soundsystem&quot;, &quot;video&quot;&#125;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CDPlayerConfig</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ‰€è®¾ç½®çš„åŸºç¡€åŒ…æ˜¯ä»¥ String ç±»å‹è¡¨ç¤ºçš„ã€‚æˆ‘è®¤ä¸ºè¿™æ˜¯å¯ä»¥çš„ï¼Œä½†è¿™ç§æ–¹æ³•æ˜¯ç±»å‹ä¸å®‰å…¨ï¼ˆnot type-safeï¼‰çš„ã€‚å¦‚æœä½ é‡æ„ä»£ç çš„è¯ï¼Œé‚£ä¹ˆæ‰€æŒ‡å®šçš„åŸºç¡€åŒ…å¯èƒ½å°±ä¼šå‡ºç°é”™è¯¯äº†ã€‚</p>
<p>é™¤äº†å°†åŒ…è®¾ç½®ä¸ºç®€å•çš„ String ç±»å‹ä¹‹å¤–ï¼Œ@ComponentScan è¿˜æä¾›äº†å¦å¤–ä¸€ç§æ–¹æ³•ï¼Œé‚£å°±æ˜¯å°†å…¶æŒ‡å®šä¸ºåŒ…ä¸­æ‰€åŒ…å«çš„ç±»æˆ–æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span><span class="meta">@ComponentScan(basePackageClasses=&#123;CDPlayer.class, DVDPlayer.class&#125;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CDPlayerConfig</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒbasePackageså±æ€§è¢«æ›¿æ¢æˆäº†basePackageClassesã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¸æ˜¯å†ä½¿ç”¨Stringç±»å‹çš„åç§°æ¥æŒ‡å®šåŒ…ï¼Œä¸ºbasePackageClasseså±æ€§æ‰€è®¾ç½®çš„æ•°ç»„ä¸­åŒ…å«äº†ç±»ã€‚è¿™äº›ç±»æ‰€åœ¨çš„åŒ…å°†ä¼šä½œä¸ºç»„ä»¶æ‰«æçš„åŸºç¡€åŒ…ã€‚</p>
<p>å°½ç®¡åœ¨æ ·ä¾‹ä¸­ï¼Œæˆ‘ä¸ºbasePackageClassesè®¾ç½®çš„æ˜¯ç»„ä»¶ç±»ï¼Œä½†æ˜¯ä½ å¯ä»¥è€ƒè™‘åœ¨åŒ…ä¸­åˆ›å»ºä¸€ä¸ªç”¨æ¥è¿›è¡Œæ‰«æçš„ç©ºæ ‡è®°æ¥å£ï¼ˆmarker interfaceï¼‰ã€‚é€šè¿‡æ ‡è®°æ¥å£çš„æ–¹å¼ï¼Œä½ ä¾ç„¶èƒ½å¤Ÿä¿æŒå¯¹é‡æ„å‹å¥½çš„æ¥å£å¼•ç”¨ï¼Œä½†æ˜¯å¯ä»¥é¿å…å¼•ç”¨ä»»ä½•å®é™…çš„åº”ç”¨ç¨‹åºä»£ç ï¼ˆåœ¨ç¨åé‡æ„ä¸­ï¼Œè¿™äº›åº”ç”¨ä»£ç æœ‰å¯èƒ½ä¼šä»æƒ³è¦æ‰«æçš„åŒ…ä¸­ç§»é™¤æ‰ï¼‰ã€‚</p>
<p>åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¦‚æœæ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå½¼æ­¤ä¹‹é—´æ²¡æœ‰ä»»ä½•ä¾èµ–ï¼Œå°±åƒ SgtPeppersbean è¿™æ ·ï¼Œé‚£ä¹ˆä½ æ‰€éœ€è¦çš„å¯èƒ½å°±æ˜¯ç»„ä»¶æ‰«æè€Œå·²ã€‚ä½†æ˜¯ï¼Œå¾ˆå¤šå¯¹è±¡ä¼šä¾èµ–å…¶ä»–çš„å¯¹è±¡æ‰èƒ½å®Œæˆä»»åŠ¡ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦æœ‰ä¸€ç§æ–¹æ³•èƒ½å¤Ÿå°†ç»„ä»¶æ‰«æå¾—åˆ°çš„ bean å’Œå®ƒä»¬çš„ä¾èµ–è£…é…åœ¨ä¸€èµ·ã€‚è¦å®Œæˆè¿™é¡¹ä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ Spring è‡ªåŠ¨åŒ–é…ç½®çš„å¦å¤–ä¸€æ–¹é¢å†…å®¹ï¼Œé‚£å°±æ˜¯è‡ªåŠ¨è£…é…ã€‚</p>
<h4 id="é€šè¿‡ä¸º-bean-æ·»åŠ æ³¨è§£å®ç°è‡ªåŠ¨è£…é…"><a href="#é€šè¿‡ä¸º-bean-æ·»åŠ æ³¨è§£å®ç°è‡ªåŠ¨è£…é…" class="headerlink" title="é€šè¿‡ä¸º bean æ·»åŠ æ³¨è§£å®ç°è‡ªåŠ¨è£…é…"></a>é€šè¿‡ä¸º bean æ·»åŠ æ³¨è§£å®ç°è‡ªåŠ¨è£…é…</h4><p>ç®€å•æ¥è¯´ï¼Œè‡ªåŠ¨è£…é…å°±æ˜¯è®© Spring è‡ªåŠ¨æ»¡è¶³ bean ä¾èµ–çš„ä¸€ç§æ–¹æ³•ï¼Œåœ¨æ»¡è¶³ä¾èµ–çš„è¿‡ç¨‹ä¸­ï¼Œä¼šåœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­å¯»æ‰¾åŒ¹é…æŸä¸ª bean éœ€æ±‚çš„å…¶ä»– beanã€‚ä¸ºäº†å£°æ˜è¦è¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© Spring çš„ @Autowired æ³¨è§£ã€‚</p>
<p>æ¯”æ–¹è¯´ï¼Œè€ƒè™‘ç¨‹åºæ¸…å• 2.6 ä¸­çš„ CDPlayer ç±»ã€‚å®ƒçš„æ„é€ å™¨ä¸Šæ·»åŠ äº† @Autowired æ³¨è§£ï¼Œè¿™è¡¨æ˜å½“ Spring åˆ›å»º CDPlayer bean çš„æ—¶å€™ï¼Œä¼šé€šè¿‡è¿™ä¸ªæ„é€ å™¨æ¥è¿›è¡Œå®ä¾‹åŒ–å¹¶ä¸”ä¼šä¼ å…¥ä¸€ä¸ªå¯è®¾ç½®ç»™ CompactDisc ç±»å‹çš„ beanã€‚</p>
<center>ç¨‹åºæ¸…å• 2.6ã€€é€šè¿‡è‡ªåŠ¨è£…é…ï¼Œå°†ä¸€ä¸ª CompactDisc æ³¨å…¥åˆ° CDPlayer ä¹‹ä¸­</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CDPlayer</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span> </span>&#123;  <span class="keyword">private</span> CompactDisc cd;  <span class="meta">@Autowired</span>  <span class="function"><span class="keyword">public</span> <span class="title">CDPlayer</span><span class="params">(CompactDisc cd)</span> </span>&#123;    <span class="keyword">this</span>.cd = cd;  &#125;  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;    cd.play();  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>@Autowired æ³¨è§£ä¸ä»…èƒ½å¤Ÿç”¨åœ¨æ„é€ å™¨ä¸Šï¼Œè¿˜èƒ½ç”¨åœ¨å±æ€§çš„ Setter æ–¹æ³•ä¸Šã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœ CDPlayer æœ‰ä¸€ä¸ª setCompactDisc() æ–¹æ³•ï¼Œé‚£ä¹ˆå¯ä»¥é‡‡ç”¨å¦‚ä¸‹çš„æ³¨è§£å½¢å¼è¿›è¡Œè‡ªåŠ¨è£…é…ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowiredpublic</span> <span class="function"><span class="keyword">void</span> <span class="title">setCompactDisc</span><span class="params">(CompactDisc cd)</span> </span>&#123;    <span class="keyword">this</span>.cd = cd;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ Spring åˆå§‹åŒ– bean ä¹‹åï¼Œå®ƒä¼šå°½å¯èƒ½å¾—å»æ»¡è¶³ bean çš„ä¾èµ–ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œä¾èµ–æ˜¯é€šè¿‡å¸¦æœ‰@Autowiredæ³¨è§£çš„æ–¹æ³•è¿›è¡Œå£°æ˜çš„ï¼Œä¹Ÿå°±æ˜¯setCompactDisc()ã€‚</p>
<p>å®é™…ä¸Šï¼ŒSetter æ–¹æ³•å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šä¹‹å¤„ã€‚@Autowired æ³¨è§£å¯ä»¥ç”¨åœ¨ç±»çš„ä»»ä½•æ–¹æ³•ä¸Šã€‚å‡è®¾ CDPlayer ç±»æœ‰ä¸€ä¸ª insertDisc() æ–¹æ³•ï¼Œé‚£ä¹ˆ @Autowired èƒ½å¤Ÿåƒåœ¨ setCompactDisc() ä¸Šé‚£æ ·ï¼Œå‘æŒ¥å®Œå…¨ç›¸åŒçš„ä½œç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowiredpublic</span> <span class="function"><span class="keyword">void</span> <span class="title">insertDisc</span><span class="params">(CompactDisc cd)</span> </span>&#123;    <span class="keyword">this</span>.cd = cd;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡æ˜¯æ„é€ å™¨ã€Setter æ–¹æ³•è¿˜æ˜¯å…¶ä»–çš„æ–¹æ³•ï¼ŒSpring éƒ½ä¼šå°è¯•æ»¡è¶³æ–¹æ³•å‚æ•°ä¸Šæ‰€å£°æ˜çš„ä¾èµ–ã€‚å‡å¦‚æœ‰ä¸”åªæœ‰ä¸€ä¸ª bean åŒ¹é…ä¾èµ–éœ€æ±‚çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ª bean å°†ä¼šè¢«è£…é…è¿›æ¥ã€‚</p>
<p>å¦‚æœæ²¡æœ‰åŒ¹é…çš„ beanï¼Œé‚£ä¹ˆåœ¨åº”ç”¨ä¸Šä¸‹æ–‡åˆ›å»ºçš„æ—¶å€™ï¼ŒSpring ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚ä¸ºäº†é¿å…å¼‚å¸¸çš„å‡ºç°ï¼Œä½ å¯ä»¥å°† @Autowired çš„ required å±æ€§è®¾ç½®ä¸º falseï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired(required=false)</span><span class="function"><span class="keyword">public</span> <span class="title">CDPlayer</span><span class="params">(CompactDisc cd)</span> </span>&#123;    <span class="keyword">this</span>.cd = cd;&#125;</span><br></pre></td></tr></table></figure>

<p>å°† required å±æ€§è®¾ç½®ä¸º false æ—¶ï¼ŒSpring ä¼šå°è¯•æ‰§è¡Œè‡ªåŠ¨è£…é…ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰åŒ¹é…çš„ bean çš„è¯ï¼ŒSpring å°†ä¼šè®©è¿™ä¸ª bean å¤„äºæœªè£…é…çš„çŠ¶æ€ã€‚ä½†æ˜¯ï¼ŒæŠŠ required å±æ€§è®¾ç½®ä¸ºfalseæ—¶ï¼Œä½ éœ€è¦è°¨æ…å¯¹å¾…ã€‚å¦‚æœåœ¨ä½ çš„ä»£ç ä¸­æ²¡æœ‰è¿›è¡Œ null æ£€æŸ¥çš„è¯ï¼Œè¿™ä¸ªå¤„äºæœªè£…é…çŠ¶æ€çš„å±æ€§æœ‰å¯èƒ½ä¼šå‡ºç° NullPointerExceptionã€‚</p>
<p>å¦‚æœæœ‰å¤šä¸ª bean éƒ½èƒ½æ»¡è¶³ä¾èµ–å…³ç³»çš„è¯ï¼ŒSpring å°†ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œè¡¨æ˜æ²¡æœ‰æ˜ç¡®æŒ‡å®šè¦é€‰æ‹©å“ªä¸ª bean è¿›è¡Œè‡ªåŠ¨è£…é…ã€‚åœ¨ç¬¬ 3 ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šè¿›ä¸€æ­¥è®¨è®ºè‡ªåŠ¨è£…é…ä¸­çš„æ­§ä¹‰æ€§ã€‚</p>
<p>@Autowired æ˜¯ Spring ç‰¹æœ‰çš„æ³¨è§£ã€‚å¦‚æœä½ ä¸æ„¿æ„åœ¨ä»£ç ä¸­åˆ°å¤„ä½¿ç”¨ Spring çš„ç‰¹å®šæ³¨è§£æ¥å®Œæˆè‡ªåŠ¨è£…é…ä»»åŠ¡çš„è¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥è€ƒè™‘å°†å…¶æ›¿æ¢ä¸º @Injectï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;<span class="keyword">import</span> javax.inject.Inject;<span class="keyword">import</span> javax.inject.Named;<span class="meta">@Namedpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">CDPlayer</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span> </span>&#123;  <span class="meta">@Inject</span>  <span class="function"><span class="keyword">public</span> <span class="title">CDPlayer</span><span class="params">(CompactDisc cd)</span> </span>&#123;    <span class="keyword">this</span>.cd = cd;  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>@Inject æ³¨è§£æ¥æºäº Java ä¾èµ–æ³¨å…¥è§„èŒƒï¼Œè¯¥è§„èŒƒåŒæ—¶è¿˜ä¸ºæˆ‘ä»¬å®šä¹‰äº† @Named æ³¨è§£ã€‚åœ¨è‡ªåŠ¨è£…é…ä¸­ï¼ŒSpring åŒæ—¶æ”¯æŒ @Inject å’Œ @Autowiredã€‚å°½ç®¡ @Inject å’Œ @Autowired ä¹‹é—´æœ‰ç€ä¸€äº›ç»†å¾®çš„å·®åˆ«ï¼Œä½†æ˜¯åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œå®ƒä»¬éƒ½æ˜¯å¯ä»¥äº’ç›¸æ›¿æ¢çš„ã€‚</p>
<p>åœ¨ @Inject å’Œ @Autowired ä¸­ï¼Œæˆ‘æ²¡æœ‰ç‰¹åˆ«å¼ºçƒˆçš„åå‘æ€§ã€‚å®é™…ä¸Šï¼Œåœ¨æœ‰çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä¼šå‘ç°æˆ‘åŒæ—¶ä½¿ç”¨äº†è¿™ä¸¤ä¸ªæ³¨è§£ã€‚ä¸è¿‡åœ¨æœ¬ä¹¦çš„æ ·ä¾‹ä¸­ï¼Œæˆ‘ä¼šä¸€ç›´ä½¿ç”¨ @Autowiredï¼Œè€Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„æƒ…å†µï¼Œé€‰æ‹©å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚</p>
<h4 id="éªŒè¯è‡ªåŠ¨è£…é…"><a href="#éªŒè¯è‡ªåŠ¨è£…é…" class="headerlink" title="éªŒè¯è‡ªåŠ¨è£…é…"></a>éªŒè¯è‡ªåŠ¨è£…é…</h4><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»åœ¨ CDPlayer çš„æ„é€ å™¨ä¸­æ·»åŠ äº† @Autowired æ³¨è§£ï¼ŒSpring å°†æŠŠä¸€ä¸ªå¯åˆ†é…ç»™ CompactDisc ç±»å‹çš„ bean è‡ªåŠ¨æ³¨å…¥è¿›æ¥ã€‚ä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ CDPlayerTestï¼Œä½¿å…¶èƒ½å¤Ÿå€ŸåŠ© CDPlayer bean æ’­æ”¾ CDï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;<span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;<span class="keyword">import</span> org.junit.Rule;<span class="keyword">import</span> org.junit.Test;<span class="keyword">import</span> org.junit.contrib.java.lang.system.StandardOutputStreamLog;<span class="keyword">import</span> org.junit.runner.RunWith;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;<span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;<span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span><span class="meta">@ContextConfiguration(classes=CDPlayerConfig.class)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CDPlayerTest</span> </span>&#123;  <span class="meta">@Rule</span>  <span class="keyword">public</span> <span class="keyword">final</span> StandardOutputStreamLog log = <span class="keyword">new</span> StandardOutputStreamLog();  <span class="meta">@Autowired</span>  <span class="keyword">private</span> MediaPlayer player;    <span class="meta">@Autowired</span>  <span class="keyword">private</span> CompactDisc cd;    <span class="meta">@Test</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cdShouldNotBeNull</span><span class="params">()</span> </span>&#123;    assertNotNull(cd);  &#125;  <span class="meta">@Test</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;    player.play();    assertEquals(        <span class="string">&quot;Playing Sgt. Pepper&#x27;s Lonely Hearts Club Band by The Beatles\n&quot;</span>,         log.getLog());  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œé™¤äº†æ³¨å…¥ CompactDiscï¼Œæˆ‘ä»¬è¿˜å°† CDPlayerbean æ³¨å…¥åˆ°æµ‹è¯•ä»£ç çš„playeræˆå‘˜å˜é‡ä¹‹ä¸­ï¼ˆå®ƒæ˜¯æ›´ä¸ºé€šç”¨çš„ MediaPlayer ç±»å‹ï¼‰ã€‚åœ¨ play() æµ‹è¯•æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ CDPlayer çš„ play() æ–¹æ³•ï¼Œå¹¶æ–­è¨€å®ƒçš„è¡Œä¸ºä¸ä½ çš„é¢„æœŸä¸€è‡´ã€‚</p>
<p>åœ¨æµ‹è¯•ä»£ç ä¸­ä½¿ç”¨ System.out.println() æ˜¯ç¨å¾®æœ‰ç‚¹æ£˜æ‰‹çš„äº‹æƒ…ã€‚å› æ­¤ï¼Œè¯¥æ ·ä¾‹ä¸­ä½¿ç”¨äº† StandardOutputStreamLogï¼Œè¿™æ˜¯æ¥æºäº System Rules åº“ï¼ˆ<a target="_blank" rel="noopener" href="http://stefanbirkner.github.io/systemrules/index.html%EF%BC%89%E7%9A%84%E4%B8%80%E4%B8%AA">http://stefanbirkner.github.io/systemrules/index.htmlï¼‰çš„ä¸€ä¸ª</a> JUnit è§„åˆ™ï¼Œè¯¥è§„åˆ™èƒ½å¤ŸåŸºäºæ§åˆ¶å°çš„è¾“å‡ºç¼–å†™æ–­è¨€ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ–­è¨€ SgtPeppers.play() æ–¹æ³•çš„è¾“å‡ºè¢«å‘é€åˆ°äº†æ§åˆ¶å°ä¸Šã€‚</p>
<p>ç°åœ¨ï¼Œä½ å·²ç»äº†è§£äº†ç»„ä»¶æ‰«æå’Œè‡ªåŠ¨è£…é…çš„åŸºç¡€çŸ¥è¯†ï¼Œåœ¨ç¬¬ 3 ç« ä¸­ï¼Œå½“æˆ‘ä»¬ä»‹ç»å¦‚ä½•å¤„ç†è‡ªåŠ¨è£…é…çš„æ­§ä¹‰æ€§æ—¶ï¼Œè¿˜ä¼šç»§ç»­ç ”ç©¶ç»„ä»¶æ‰«æã€‚</p>
<p>ä½†æ˜¯ç°åœ¨ï¼Œæˆ‘ä»¬å…ˆå°†ç»„ä»¶æ‰«æå’Œè‡ªåŠ¨è£…é…æ”¾åœ¨ä¸€è¾¹ï¼Œçœ‹ä¸€ä¸‹åœ¨ Spring ä¸­å¦‚ä½•æ˜¾å¼åœ°è£…é… beanï¼Œé¦–å…ˆä»é€šè¿‡ Java ä»£ç ç¼–å†™é…ç½®å¼€å§‹ã€‚</p>
<h3 id="é€šè¿‡-Java-ä»£ç è£…é…-bean"><a href="#é€šè¿‡-Java-ä»£ç è£…é…-bean" class="headerlink" title="é€šè¿‡ Java ä»£ç è£…é… bean"></a>é€šè¿‡ Java ä»£ç è£…é… bean</h3><p>å°½ç®¡åœ¨å¾ˆå¤šåœºæ™¯ä¸‹é€šè¿‡ç»„ä»¶æ‰«æå’Œè‡ªåŠ¨è£…é…å®ç° Spring çš„è‡ªåŠ¨åŒ–é…ç½®æ˜¯æ›´ä¸ºæ¨èçš„æ–¹å¼ï¼Œä½†æœ‰æ—¶å€™è‡ªåŠ¨åŒ–é…ç½®çš„æ–¹æ¡ˆè¡Œä¸é€šï¼Œå› æ­¤éœ€è¦æ˜ç¡®é…ç½® Springã€‚æ¯”å¦‚è¯´ï¼Œä½ æƒ³è¦å°†ç¬¬ä¸‰æ–¹åº“ä¸­çš„ç»„ä»¶è£…é…åˆ°ä½ çš„åº”ç”¨ä¸­ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¯æ²¡æœ‰åŠæ³•åœ¨å®ƒçš„ç±»ä¸Šæ·»åŠ  @Component å’Œ @Autowired æ³¨è§£çš„ï¼Œå› æ­¤å°±ä¸èƒ½ä½¿ç”¨è‡ªåŠ¨åŒ–è£…é…çš„æ–¹æ¡ˆäº†ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¿…é¡»è¦é‡‡ç”¨æ˜¾å¼è£…é…çš„æ–¹å¼ã€‚åœ¨è¿›è¡Œæ˜¾å¼é…ç½®çš„æ—¶å€™ï¼Œæœ‰ä¸¤ç§å¯é€‰æ–¹æ¡ˆï¼šJava å’Œ XMLã€‚åœ¨è¿™èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå­¦ä¹ å¦‚ä½•ä½¿ç”¨ Javaé…ç½®ï¼Œæ¥ä¸‹æ¥çš„ä¸€èŠ‚ä¸­å°†ä¼šç»§ç»­å­¦ä¹  Spring çš„ XML é…ç½®ã€‚</p>
<p>å°±åƒæˆ‘ä¹‹å‰æ‰€è¯´çš„ï¼Œåœ¨è¿›è¡Œæ˜¾å¼é…ç½®æ—¶ï¼ŒJavaConfig æ˜¯æ›´å¥½çš„æ–¹æ¡ˆï¼Œå› ä¸ºå®ƒæ›´ä¸ºå¼ºå¤§ã€ç±»å‹å®‰å…¨å¹¶ä¸”å¯¹é‡æ„å‹å¥½ã€‚å› ä¸ºå®ƒå°±æ˜¯ Java ä»£ç ï¼Œå°±åƒåº”ç”¨ç¨‹åºä¸­çš„å…¶ä»–Java ä»£ç ä¸€æ ·ã€‚åŒæ—¶ï¼ŒJavaConfig ä¸å…¶ä»–çš„ Java ä»£ç åˆæœ‰æ‰€åŒºåˆ«ï¼Œåœ¨æ¦‚å¿µä¸Šï¼Œå®ƒä¸åº”ç”¨ç¨‹åºä¸­çš„ä¸šåŠ¡é€»è¾‘å’Œé¢†åŸŸä»£ç æ˜¯ä¸åŒçš„ã€‚å°½ç®¡å®ƒä¸å…¶ä»–çš„ç»„ä»¶ä¸€æ ·éƒ½ä½¿ç”¨ç›¸åŒçš„è¯­è¨€è¿›è¡Œè¡¨è¿°ï¼Œä½† JavaConfig æ˜¯é…ç½®ä»£ç ã€‚è¿™æ„å‘³ç€å®ƒä¸åº”è¯¥åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼ŒJavaConfig ä¹Ÿä¸åº”è¯¥ä¾µå…¥åˆ°ä¸šåŠ¡é€»è¾‘ä»£ç ä¹‹ä¸­ã€‚å°½ç®¡ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†é€šå¸¸ä¼šå°† JavaConfig æ”¾åˆ°å•ç‹¬çš„åŒ…ä¸­ï¼Œä½¿å®ƒä¸å…¶ä»–çš„åº”ç”¨ç¨‹åºé€»è¾‘åˆ†ç¦»å¼€æ¥ï¼Œè¿™æ ·å¯¹äºå®ƒçš„æ„å›¾å°±ä¸ä¼šäº§ç”Ÿå›°æƒ‘äº†ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•é€šè¿‡JavaConfigæ˜¾å¼é…ç½®Springã€‚</p>
<h4 id="åˆ›å»ºé…ç½®ç±»"><a href="#åˆ›å»ºé…ç½®ç±»" class="headerlink" title="åˆ›å»ºé…ç½®ç±»"></a>åˆ›å»ºé…ç½®ç±»</h4><p>åœ¨æœ¬ç« å‰é¢çš„ç¨‹åºæ¸…å• 2.3 ä¸­ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡è§è¯†åˆ° JavaConfigã€‚è®©æˆ‘ä»¬é‡æ¸©ä¸€ä¸‹é‚£ä¸ªæ ·ä¾‹ä¸­çš„ CDPlayerConfigï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CDPlayerConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»º JavaConfig ç±»çš„å…³é”®åœ¨äºä¸ºå…¶æ·»åŠ  @Configuration æ³¨è§£ï¼Œ@Configuration æ³¨è§£è¡¨æ˜è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œè¯¥ç±»åº”è¯¥åŒ…å«åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­å¦‚ä½•åˆ›å»ºbean çš„ç»†èŠ‚ã€‚</p>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä¾èµ–ç»„ä»¶æ‰«ææ¥å‘ç° Spring åº”è¯¥åˆ›å»ºçš„ beanã€‚å°½ç®¡æˆ‘ä»¬å¯ä»¥åŒæ—¶ä½¿ç”¨ç»„ä»¶æ‰«æå’Œæ˜¾å¼é…ç½®ï¼Œä½†æ˜¯åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ›´åŠ å…³æ³¨äºæ˜¾å¼é…ç½®ï¼Œå› æ­¤æˆ‘å°† CDPlayerConfig çš„ @ComponentScan æ³¨è§£ç§»é™¤æ‰äº†ã€‚</p>
<p>ç§»é™¤äº† @ComponentScan æ³¨è§£ï¼Œæ­¤æ—¶çš„ CDPlayerConfig ç±»å°±æ²¡æœ‰ä»»ä½•ä½œç”¨äº†ã€‚å¦‚æœä½ ç°åœ¨è¿è¡Œ CDPlayerTest çš„è¯ï¼Œæµ‹è¯•ä¼šå¤±è´¥ï¼Œå¹¶ä¸”ä¼šå‡ºç° BeanCreationException å¼‚å¸¸ã€‚æµ‹è¯•æœŸæœ›è¢«æ³¨å…¥ CDPlayer å’Œ CompactDiscï¼Œä½†æ˜¯è¿™äº› bean æ ¹æœ¬å°±æ²¡æœ‰åˆ›å»ºï¼Œå› ä¸ºç»„ä»¶æ‰«æä¸ä¼šå‘ç°å®ƒä»¬ã€‚</p>
<p>ä¸ºäº†å†æ¬¡è®©æµ‹è¯•é€šè¿‡ï¼Œä½ å¯ä»¥å°† @ComponentScan æ³¨è§£æ·»åŠ å›å»ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™ä¸€èŠ‚å…³æ³¨æ˜¾å¼é…ç½®ï¼Œå› æ­¤è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ JavaConfig è£…é… CDPlayer å’Œ CompactDiscã€‚</p>
<h4 id="å£°æ˜ç®€å•çš„-bean"><a href="#å£°æ˜ç®€å•çš„-bean" class="headerlink" title="å£°æ˜ç®€å•çš„ bean"></a>å£°æ˜ç®€å•çš„ bean</h4><p>è¦åœ¨ JavaConfig ä¸­å£°æ˜ beanï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåˆ›å»ºæ‰€éœ€ç±»å‹çš„å®ä¾‹ï¼Œç„¶åç»™è¿™ä¸ªæ–¹æ³•æ·»åŠ  @Bean æ³¨è§£ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CompactDisc <span class="title">sgtPeppers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SgtPeppers();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Bean æ³¨è§£ä¼šå‘Šè¯‰ Spring è¿™ä¸ªæ–¹æ³•å°†ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡è¦æ³¨å†Œä¸º Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ beanã€‚æ–¹æ³•ä½“ä¸­åŒ…å«äº†æœ€ç»ˆäº§ç”Ÿ bean å®ä¾‹çš„é€»è¾‘ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œbean çš„ ID ä¸å¸¦æœ‰ @Bean æ³¨è§£çš„æ–¹æ³•åæ˜¯ä¸€æ ·çš„ã€‚å¦‚æœä½ æƒ³ä¸ºå…¶è®¾ç½®æˆä¸€ä¸ªä¸åŒçš„åå­—çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥é‡å‘½åè¯¥æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ name å±æ€§æŒ‡å®šä¸€ä¸ªä¸åŒçš„åå­—ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(name=&quot;longlyHeartsClubBand&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CompactDisc <span class="title">sgtPeppers</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SgtPeppers();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡ä½ é‡‡ç”¨ä»€ä¹ˆæ–¹æ³•æ¥ä¸º bean å‘½åï¼Œbeanå£°æ˜éƒ½æ˜¯éå¸¸ç®€å•çš„ã€‚æ–¹æ³•ä½“è¿”å›äº†ä¸€ä¸ªæ–°çš„ SgtPeppers å®ä¾‹ã€‚è¿™é‡Œæ˜¯ä½¿ç”¨ Java æ¥è¿›è¡Œæè¿°çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å‘æŒ¥Java æä¾›çš„æ‰€æœ‰åŠŸèƒ½ï¼Œåªè¦æœ€ç»ˆç”Ÿæˆä¸€ä¸ª CompactDisc å®ä¾‹å³å¯ã€‚</p>
<p>è¯·ç¨å¾®å‘æŒ¥ä¸€ä¸‹ä½ çš„æƒ³è±¡åŠ›ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›åšä¸€ç‚¹ç¨å¾®ç–¯ç‹‚çš„äº‹æƒ…ï¼Œæ¯”å¦‚è¯´ï¼Œåœ¨ä¸€ç»„ CD ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª CompactDisc æ¥æ’­æ”¾ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">CompactDisc <span class="title">randomBeatlesCD</span><span class="params">()</span> </span>&#123;    <span class="keyword">int</span> choice = (<span class="keyword">int</span>) Math.floor(Math.random() * <span class="number">4</span>);    <span class="keyword">if</span> (choice == <span class="number">0</span>) &#123;        <span class="keyword">return</span> <span class="keyword">new</span> SgtPeppers();    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (choice == <span class="number">1</span>) &#123;        <span class="keyword">return</span> <span class="keyword">new</span> WhiteAlbum();    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (choice == <span class="number">2</span>) &#123;        <span class="keyword">return</span> <span class="keyword">new</span> HardDaysNight();    &#125; <span class="keyword">else</span> &#123;        <span class="keyword">return</span> <span class="keyword">new</span> Revolver();    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œä½ å¯ä»¥è‡ªå·±æƒ³è±¡ä¸€ä¸‹ï¼Œå€ŸåŠ© @Bean æ³¨è§£æ–¹æ³•çš„å½¢å¼ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å‘æŒ¥å‡º Java çš„å…¨éƒ¨å¨åŠ›æ¥äº§ç”Ÿ beanã€‚å½“ä½ æƒ³å®Œä¹‹åï¼Œæˆ‘ä»¬è¦å›è¿‡å¤´æ¥çœ‹ä¸€ä¸‹åœ¨ JavaConfig ä¸­ï¼Œå¦‚ä½•å°† CompactDisc æ³¨å…¥åˆ° CDPlayer ä¹‹ä¸­ã€‚</p>
<h4 id="å€ŸåŠ©-JavaConfig-å®ç°æ³¨å…¥"><a href="#å€ŸåŠ©-JavaConfig-å®ç°æ³¨å…¥" class="headerlink" title="å€ŸåŠ© JavaConfig å®ç°æ³¨å…¥"></a>å€ŸåŠ© JavaConfig å®ç°æ³¨å…¥</h4><p>æˆ‘ä»¬å‰é¢æ‰€å£°æ˜çš„ CompactDisc bean æ˜¯éå¸¸ç®€å•çš„ï¼Œå®ƒè‡ªèº«æ²¡æœ‰å…¶ä»–çš„ä¾èµ–ã€‚ä½†ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜ CDPlayerbeanï¼Œå®ƒä¾èµ–äº CompactDiscã€‚åœ¨ JavaConfig ä¸­ï¼Œè¦å¦‚ä½•å°†å®ƒä»¬è£…é…åœ¨ä¸€èµ·å‘¢ï¼Ÿ</p>
<p>åœ¨ JavaConfig ä¸­è£…é… bean çš„æœ€ç®€å•æ–¹å¼å°±æ˜¯å¼•ç”¨åˆ›å»º bean çš„æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">CDPlayer <span class="title">cdPlayer</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> CDPlayer(sgtPeppers());&#125;</span><br></pre></td></tr></table></figure>

<p>cdPlayer() æ–¹æ³•åƒ sgtPeppers() æ–¹æ³•ä¸€æ ·ï¼ŒåŒæ ·ä½¿ç”¨äº†@Bean æ³¨è§£ï¼Œè¿™è¡¨æ˜è¿™ä¸ªæ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ª bean å®ä¾‹å¹¶å°†å…¶æ³¨å†Œåˆ° Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ã€‚æ‰€åˆ›å»ºçš„ bean  IDä¸º cdPlayerï¼Œä¸æ–¹æ³•çš„åå­—ç›¸åŒã€‚</p>
<p>cdPlayer() çš„æ–¹æ³•ä½“ä¸ sgtPeppers() ç¨å¾®æœ‰äº›åŒºåˆ«ã€‚åœ¨è¿™é‡Œå¹¶æ²¡æœ‰ä½¿ç”¨é»˜è®¤çš„æ„é€ å™¨æ„å»ºå®ä¾‹ï¼Œè€Œæ˜¯è°ƒç”¨äº†éœ€è¦ä¼ å…¥ CompactDisc å¯¹è±¡çš„æ„é€ å™¨æ¥åˆ›å»º CDPlayer å®ä¾‹ã€‚</p>
<p>çœ‹èµ·æ¥ï¼ŒCompactDisc æ˜¯é€šè¿‡è°ƒç”¨ sgtPeppers() å¾—åˆ°çš„ï¼Œä½†æƒ…å†µå¹¶éå®Œå…¨å¦‚æ­¤ã€‚å› ä¸º sgtPeppers() æ–¹æ³•ä¸Šæ·»åŠ äº† @Bean æ³¨è§£ï¼ŒSpring å°†ä¼šæ‹¦æˆªæ‰€æœ‰å¯¹å®ƒçš„è°ƒç”¨ï¼Œå¹¶ç¡®ä¿ç›´æ¥è¿”å›è¯¥æ–¹æ³•æ‰€åˆ›å»ºçš„ beanï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½å¯¹å…¶è¿›è¡Œå®é™…çš„è°ƒç”¨ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œå‡è®¾ä½ å¼•å…¥äº†ä¸€ä¸ªå…¶ä»–çš„ CDPlayerbeanï¼Œå®ƒå’Œä¹‹å‰çš„é‚£ä¸ª bean å®Œå…¨ä¸€æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CDPlayer <span class="title">cdPlayer</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CDPlayer(sgtPeppers());</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CDPlayer <span class="title">anotherCDPlayer</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CDPlayer(sgtPeppers());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‡å¦‚å¯¹ sgtPeppers() çš„è°ƒç”¨å°±åƒå…¶ä»–çš„ Java æ–¹æ³•è°ƒç”¨ä¸€æ ·çš„è¯ï¼Œé‚£ä¹ˆæ¯ä¸ª CDPlayer å®ä¾‹éƒ½ä¼šæœ‰ä¸€ä¸ªè‡ªå·±ç‰¹æœ‰çš„ SgtPeppers å®ä¾‹ã€‚å¦‚æœæˆ‘ä»¬è®¨è®ºçš„æ˜¯å®é™…çš„ CDæ’­æ”¾å™¨å’Œ CD å…‰ç›˜çš„è¯ï¼Œè¿™ä¹ˆåšæ˜¯æœ‰æ„ä¹‰çš„ã€‚å¦‚æœä½ æœ‰ä¸¤å° CD æ’­æ”¾å™¨ï¼Œåœ¨ç‰©ç†ä¸Šå¹¶æ²¡æœ‰åŠæ³•å°†åŒä¸€å¼  CD å…‰ç›˜æ”¾åˆ°ä¸¤ä¸ª CD æ’­æ”¾å™¨ä¸­ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨è½¯ä»¶é¢†åŸŸä¸­ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å°†åŒä¸€ä¸ª SgtPeppers å®ä¾‹æ³¨å…¥åˆ°ä»»æ„æ•°é‡çš„å…¶ä»– bean ä¹‹ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring ä¸­çš„ bean éƒ½æ˜¯å•ä¾‹çš„ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å¿…è¦ä¸ºç¬¬äºŒä¸ª CDPlayer bean åˆ›å»ºå®Œå…¨ç›¸åŒçš„ SgtPeppers å®ä¾‹ã€‚æ‰€ä»¥ï¼ŒSpring ä¼šæ‹¦æˆªå¯¹ sgtPeppers()çš„è°ƒç”¨å¹¶ç¡®ä¿è¿”å›çš„æ˜¯ Spring æ‰€åˆ›å»ºçš„ beanï¼Œä¹Ÿå°±æ˜¯ Spring æœ¬èº«åœ¨è°ƒç”¨ sgtPeppers() æ—¶æ‰€åˆ›å»ºçš„ CompactDiscbeanã€‚å› æ­¤ï¼Œä¸¤ä¸ª CDPlayer bean ä¼šå¾—åˆ°ç›¸åŒçš„ SgtPeppers å®ä¾‹ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡è°ƒç”¨æ–¹æ³•æ¥å¼•ç”¨ bean çš„æ–¹å¼æœ‰ç‚¹ä»¤äººå›°æƒ‘ã€‚å…¶å®è¿˜æœ‰ä¸€ç§ç†è§£èµ·æ¥æ›´ä¸ºç®€å•çš„æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">CDPlayer <span class="title">cdPlayer</span><span class="params">(CompactDisc compactDisc)</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> CDPlayer(compactDisc);&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼ŒcdPlayer() æ–¹æ³•è¯·æ±‚ä¸€ä¸ª CompactDisc ä½œä¸ºå‚æ•°ã€‚å½“ Spring è°ƒç”¨ cdPlayer() åˆ›å»º CDPlayer bean çš„æ—¶å€™ï¼Œå®ƒä¼šè‡ªåŠ¨è£…é…ä¸€ä¸ª CompactDisc åˆ°é…ç½®æ–¹æ³•ä¹‹ä¸­ã€‚ç„¶åï¼Œæ–¹æ³•ä½“å°±å¯ä»¥æŒ‰ç…§åˆé€‚çš„æ–¹å¼æ¥ä½¿ç”¨å®ƒã€‚å€ŸåŠ©è¿™ç§æŠ€æœ¯ï¼ŒcdPlayer() æ–¹æ³•ä¹Ÿèƒ½å¤Ÿå°† CompactDisc æ³¨å…¥åˆ° CDPlayer çš„æ„é€ å™¨ä¸­ï¼Œè€Œä¸”ä¸ç”¨æ˜ç¡®å¼•ç”¨CompactDisc çš„ @Bean æ–¹æ³•ã€‚</p>
<p>é€šè¿‡è¿™ç§æ–¹å¼å¼•ç”¨å…¶ä»–çš„ bean é€šå¸¸æ˜¯æœ€ä½³çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒä¸ä¼šè¦æ±‚å°† CompactDisc å£°æ˜åˆ°åŒä¸€ä¸ªé…ç½®ç±»ä¹‹ä¸­ã€‚åœ¨è¿™é‡Œç”šè‡³æ²¡æœ‰è¦æ±‚ CompactDisc å¿…é¡»è¦åœ¨ JavaConfig ä¸­å£°æ˜ï¼Œå®é™…ä¸Šå®ƒå¯ä»¥é€šè¿‡ç»„ä»¶æ‰«æåŠŸèƒ½è‡ªåŠ¨å‘ç°æˆ–è€…é€šè¿‡ XML æ¥è¿›è¡Œé…ç½®ã€‚ä½ å¯ä»¥å°†é…ç½®åˆ†æ•£åˆ°å¤šä¸ªé…ç½®ç±»ã€XML æ–‡ä»¶ä»¥åŠè‡ªåŠ¨æ‰«æå’Œè£…é… bean ä¹‹ä¸­ï¼Œåªè¦åŠŸèƒ½å®Œæ•´å¥å…¨å³å¯ã€‚ä¸ç®¡ CompactDisc æ˜¯é‡‡ç”¨ä»€ä¹ˆæ–¹å¼åˆ›å»ºå‡ºæ¥çš„ï¼ŒSpring éƒ½ä¼šå°†å…¶ä¼ å…¥åˆ°é…ç½®æ–¹æ³•ä¸­ï¼Œå¹¶ç”¨æ¥åˆ›å»º CDPlayer beanã€‚</p>
<p>å¦å¤–ï¼Œéœ€è¦æé†’çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨ CDPlayer çš„æ„é€ å™¨å®ç°äº† DI åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘ä»¬å®Œå…¨å¯ä»¥é‡‡ç”¨å…¶ä»–é£æ ¼çš„DIé…ç½®ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœä½ æƒ³é€šè¿‡ Setter æ–¹æ³•æ³¨å…¥ CompactDisc çš„è¯ï¼Œé‚£ä¹ˆä»£ç çœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">CDPlayer <span class="title">cdPlayer</span><span class="params">(CompactDisc compactDisc)</span> </span>&#123;    CDPlayer cdPlayer = <span class="keyword">new</span> CDPlayer(compactDisc);    cdPlayer.setCompactDisc(compactDisc);    retyrb cdPlayer;&#125;</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡å¼ºè°ƒä¸€éï¼Œå¸¦æœ‰ @Bean æ³¨è§£çš„æ–¹æ³•å¯ä»¥é‡‡ç”¨ä»»ä½•å¿…è¦çš„ Java åŠŸèƒ½æ¥äº§ç”Ÿ bean å®ä¾‹ã€‚æ„é€ å™¨å’Œ Setter æ–¹æ³•åªæ˜¯ @Bean æ–¹æ³•çš„ä¸¤ä¸ªç®€å•æ ·ä¾‹ã€‚è¿™é‡Œæ‰€å­˜åœ¨çš„å¯èƒ½æ€§ä»…ä»…å—åˆ° Java è¯­è¨€çš„é™åˆ¶ã€‚</p>
<h3 id="é€šè¿‡-XML-è£…é…-bean"><a href="#é€šè¿‡-XML-è£…é…-bean" class="headerlink" title="é€šè¿‡ XML è£…é… bean"></a>é€šè¿‡ XML è£…é… bean</h3><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•è®© Spring è‡ªåŠ¨å‘ç°å’Œè£…é…beanï¼Œè¿˜çœ‹åˆ°äº†å¦‚ä½•è¿›è¡Œæ‰‹åŠ¨å¹²é¢„ï¼Œå³é€šè¿‡ JavaConfig æ˜¾å¼åœ°è£…é… beanã€‚ä½†æ˜¯ï¼Œåœ¨è£…é… bean çš„æ—¶å€™ï¼Œè¿˜æœ‰ä¸€ç§å¯é€‰æ–¹æ¡ˆï¼Œå°½ç®¡è¿™ç§æ–¹æ¡ˆå¯èƒ½ä¸å¤ªåˆä¹å¤§å®¶çš„å¿ƒæ„ï¼Œä½†æ˜¯å®ƒåœ¨ Spring ä¸­å·²ç»æœ‰å¾ˆé•¿çš„å†å²äº†ã€‚</p>
<p>åœ¨ Spring åˆšåˆšå‡ºç°çš„æ—¶å€™ï¼ŒXML æ˜¯æè¿°é…ç½®çš„ä¸»è¦æ–¹å¼ã€‚åœ¨ Spring çš„åä¹‰ä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºäº†æ— æ•°è¡Œ XML ä»£ç ã€‚åœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼ŒSpring æˆä¸ºäº† XML é…ç½®çš„åŒä¹‰è¯ã€‚</p>
<p>å°½ç®¡ Spring é•¿æœŸä»¥æ¥ç¡®å®ä¸ XML æœ‰ç€å…³è”ï¼Œä½†ç°åœ¨éœ€è¦æ˜ç¡®çš„æ˜¯ï¼ŒXML ä¸å†æ˜¯é…ç½® Spring çš„å”¯ä¸€å¯é€‰æ–¹æ¡ˆã€‚Spring ç°åœ¨æœ‰äº†å¼ºå¤§çš„è‡ªåŠ¨åŒ–é…ç½®å’ŒåŸºäº Java çš„é…ç½®ï¼ŒXML ä¸åº”è¯¥å†æ˜¯ä½ çš„ç¬¬ä¸€é€‰æ‹©äº†ã€‚</p>
<p>ä¸è¿‡ï¼Œé‰´äºå·²ç»å­˜åœ¨é‚£ä¹ˆå¤šåŸºäº XML çš„ Spring é…ç½®ï¼Œæ‰€ä»¥ç†è§£å¦‚ä½•åœ¨ Spring ä¸­ä½¿ç”¨ XML è¿˜æ˜¯å¾ˆé‡è¦çš„ã€‚ä½†æ˜¯ï¼Œæˆ‘å¸Œæœ›æœ¬èŠ‚çš„å†…å®¹åªæ˜¯ç”¨æ¥å¸®åŠ©ä½ ç»´æŠ¤å·²æœ‰çš„ XML é…ç½®ï¼Œåœ¨å®Œæˆæ–°çš„ Spring å·¥ä½œæ—¶ï¼Œå¸Œæœ›ä½ ä¼šä½¿ç”¨è‡ªåŠ¨åŒ–é…ç½®å’Œ JavaConfigã€‚</p>
<h4 id="åˆ›å»º-XML-é…ç½®è§„èŒƒ"><a href="#åˆ›å»º-XML-é…ç½®è§„èŒƒ" class="headerlink" title="åˆ›å»º XML é…ç½®è§„èŒƒ"></a>åˆ›å»º XML é…ç½®è§„èŒƒ</h4><p>åœ¨ä½¿ç”¨ XML ä¸º Spring è£…é… bean ä¹‹å‰ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„é…ç½®è§„èŒƒã€‚åœ¨ä½¿ç”¨ JavaConfig çš„æ—¶å€™ï¼Œè¿™æ„å‘³ç€è¦åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ @Configuration æ³¨è§£çš„ç±»ï¼Œè€Œåœ¨ XML é…ç½®ä¸­ï¼Œè¿™æ„å‘³ç€è¦åˆ›å»ºä¸€ä¸ª XML æ–‡ä»¶ï¼Œå¹¶ä¸”è¦ä»¥ <code>&lt;beans&gt;</code> å…ƒç´ ä¸ºæ ¹ã€‚</p>
<p>æœ€ä¸ºç®€å•çš„ Spring XML é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span>  <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span>  <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd      http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span>	<span class="comment">&lt;!-- configuration details go here --&gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¾ˆå®¹æ˜“å°±èƒ½çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªåŸºæœ¬çš„ XML é…ç½®å·²ç»æ¯”åŒç­‰åŠŸèƒ½çš„ JavaConfig ç±»å¤æ‚å¾—å¤šäº†ã€‚ä½œä¸ºèµ·æ­¥ï¼Œåœ¨ JavaConfig ä¸­æ‰€éœ€è¦çš„åªæ˜¯ @Configurationï¼Œä½†åœ¨ä½¿ç”¨ XML æ—¶ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶çš„é¡¶éƒ¨å£°æ˜å¤šä¸ª XML æ¨¡å¼ï¼ˆXSDï¼‰æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å®šä¹‰äº†é…ç½® Spring çš„ XML å…ƒç´ ã€‚</p>
<blockquote>
<p>å€ŸåŠ© Spring Tool Suite </p>
<p>åˆ›å»º XML é…ç½®æ–‡ä»¶åˆ›å»ºå’Œç®¡ç† Spring XML é…ç½®æ–‡ä»¶çš„ä¸€ç§ç®€ä¾¿æ–¹å¼æ˜¯ä½¿ç”¨ Spring ToolSuiteï¼ˆ<a target="_blank" rel="noopener" href="https://spring.io/tools/sts%EF%BC%89%E3%80%82%E5%9C%A8">https://spring.io/tools/stsï¼‰ã€‚åœ¨</a> Spring Tool Suite çš„èœå•ä¸­ï¼Œé€‰æ‹© File&gt;New&gt;Spring Bean Configuration Fileï¼Œèƒ½å¤Ÿåˆ›å»º Spring XML é…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©å¯ç”¨çš„é…ç½®å‘½åç©ºé—´ã€‚</p>
</blockquote>
<p>ç”¨æ¥è£…é… bean çš„æœ€åŸºæœ¬çš„ XML å…ƒç´ åŒ…å«åœ¨ spring-beans æ¨¡å¼ä¹‹ä¸­ï¼Œåœ¨ä¸Šé¢è¿™ä¸ª XML æ–‡ä»¶ä¸­ï¼Œå®ƒè¢«å®šä¹‰ä¸ºæ ¹å‘½åç©ºé—´ã€‚<code>&lt;beans&gt;</code> æ˜¯è¯¥æ¨¡å¼ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œå®ƒæ˜¯æ‰€æœ‰ Spring é…ç½®æ–‡ä»¶çš„æ ¹å…ƒç´ ã€‚</p>
<p>åœ¨ XML ä¸­é…ç½® Spring æ—¶ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ¨¡å¼ã€‚å°½ç®¡åœ¨æœ¬ä¹¦ä¸­ï¼Œæˆ‘æ›´åŠ å…³æ³¨è‡ªåŠ¨åŒ–ä»¥åŠåŸºäº Java çš„é…ç½®ï¼Œä½†æ˜¯åœ¨æœ¬ä¹¦è®²è§£çš„è¿‡ç¨‹ä¸­ï¼Œå½“å‡ºç°å…¶ä»–æ¨¡å¼çš„æ—¶å€™ï¼Œæˆ‘è‡³å°‘ä¼šæé†’ä½ ã€‚å°±è¿™æ ·ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªåˆæ³•çš„ Spring XML é…ç½®ã€‚ä¸è¿‡ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªæ²¡æœ‰ä»»ä½•ç”¨å¤„çš„é…ç½®ï¼Œå› ä¸ºå®ƒï¼ˆè¿˜ï¼‰æ²¡æœ‰å£°æ˜ä»»ä½• beanã€‚ä¸ºäº†ç»™äºˆå®ƒç”Ÿå‘½åŠ›ï¼Œè®©æˆ‘ä»¬é‡æ–°åˆ›å»ºä¸€ä¸‹ CD æ ·ä¾‹ï¼Œåªä¸è¿‡æˆ‘ä»¬è¿™æ¬¡ä½¿ç”¨ XML é…ç½®ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ JavaConfig å’Œè‡ªåŠ¨åŒ–è£…é…ã€‚</p>
<h4 id="å£°æ˜ä¸€ä¸ªç®€å•çš„-lt-bean-gt"><a href="#å£°æ˜ä¸€ä¸ªç®€å•çš„-lt-bean-gt" class="headerlink" title="å£°æ˜ä¸€ä¸ªç®€å•çš„ &lt;bean&gt;"></a>å£°æ˜ä¸€ä¸ªç®€å•çš„ <code>&lt;bean&gt;</code></h4><p>è¦åœ¨åŸºäº XML çš„ Spring é…ç½®ä¸­å£°æ˜ä¸€ä¸ª beanï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ spring beans æ¨¡å¼ä¸­çš„å¦å¤–ä¸€ä¸ªå…ƒç´ ï¼š<code>&lt;bean&gt;</code>ã€‚<code>&lt;bean&gt;</code> å…ƒç´ ç±»ä¼¼äº JavaConfig ä¸­çš„ @Bean æ³¨è§£ã€‚æˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼å£°æ˜ CompactDiscbeanï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.SgtPeppers&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå£°æ˜äº†ä¸€ä¸ªå¾ˆç®€å•çš„ beanï¼Œåˆ›å»ºè¿™ä¸ª bean çš„ç±»é€šè¿‡ class å±æ€§æ¥æŒ‡å®šçš„ï¼Œå¹¶ä¸”è¦ä½¿ç”¨å…¨é™å®šçš„ç±»åã€‚</p>
<p>å› ä¸ºæ²¡æœ‰æ˜ç¡®ç»™å®š IDï¼Œæ‰€ä»¥è¿™ä¸ª bean å°†ä¼šæ ¹æ®å…¨é™å®šç±»åæ¥è¿›è¡Œå‘½åã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œbean çš„ ID å°†ä¼šæ˜¯ â€œsoundsystem.SgtPeppers#0â€ã€‚å…¶ä¸­ï¼Œâ€œ#0â€ æ˜¯ä¸€ä¸ªè®¡æ•°çš„å½¢å¼ï¼Œç”¨æ¥åŒºåˆ†ç›¸åŒç±»å‹çš„å…¶ä»– beanã€‚å¦‚æœä½ å£°æ˜äº†å¦å¤–ä¸€ä¸ª SgtPeppersï¼Œå¹¶ä¸”æ²¡æœ‰æ˜ç¡®è¿›è¡Œæ ‡è¯†ï¼Œé‚£ä¹ˆå®ƒè‡ªåŠ¨å¾—åˆ°çš„ ID å°†ä¼šæ˜¯ â€œsoundsystem.SgtPeppers#1â€ã€‚</p>
<p>å°½ç®¡è‡ªåŠ¨åŒ–çš„ beanå‘½ åæ–¹å¼éå¸¸æ–¹ä¾¿ï¼Œä½†å¦‚æœä½ è¦ç¨åå¼•ç”¨å®ƒçš„è¯ï¼Œé‚£è‡ªåŠ¨äº§ç”Ÿçš„åå­—å°±æ²¡æœ‰å¤šå¤§çš„ç”¨å¤„äº†ã€‚å› æ­¤ï¼Œé€šå¸¸æ¥è®²æ›´å¥½çš„åŠæ³•æ˜¯å€ŸåŠ© id å±æ€§ï¼Œä¸ºæ¯ä¸ªbean è®¾ç½®ä¸€ä¸ªä½ è‡ªå·±é€‰æ‹©çš„åå­—ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;compactDisc&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.SgtPeppers&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¨åå°†è¿™ä¸ª bean è£…é…åˆ° CDPlayer bean ä¹‹ä¸­çš„æ—¶å€™ï¼Œä½ ä¼šç”¨åˆ°è¿™ä¸ªå…·ä½“çš„åå­—ã€‚</p>
<blockquote>
<p>å‡å°‘ç¹ç</p>
<p>ä¸ºäº†å‡å°‘ XML ä¸­ç¹ççš„é…ç½®ï¼Œåªå¯¹é‚£äº›éœ€è¦æŒ‰åå­—å¼•ç”¨çš„ beanï¼ˆæ¯”å¦‚ï¼Œä½ éœ€è¦å°†å¯¹å®ƒçš„å¼•ç”¨æ³¨å…¥åˆ°å¦å¤–ä¸€ä¸ª bean ä¸­ï¼‰è¿›è¡Œæ˜ç¡®åœ°å‘½åã€‚</p>
</blockquote>
<p>åœ¨è¿›ä¸€æ­¥å­¦ä¹ ä¹‹å‰ï¼Œè®©æˆ‘ä»¬èŠ±ç‚¹æ—¶é—´çœ‹ä¸€ä¸‹è¿™ä¸ªç®€å• bean å£°æ˜çš„ä¸€äº›ç‰¹å¾ã€‚</p>
<p>ç¬¬ä¸€ä»¶éœ€è¦æ³¨æ„çš„äº‹æƒ…å°±æ˜¯ä½ ä¸å†éœ€è¦ç›´æ¥è´Ÿè´£åˆ›å»º SgtPeppers çš„å®ä¾‹ï¼Œåœ¨åŸºäº JavaConfig çš„é…ç½®ä¸­ï¼Œæˆ‘ä»¬æ˜¯éœ€è¦è¿™æ ·åšçš„ã€‚å½“ Spring å‘ç°è¿™ä¸ª <code>&lt;bean&gt;</code> å…ƒç´ æ—¶ï¼Œå®ƒå°†ä¼šè°ƒç”¨ SgtPeppers çš„é»˜è®¤æ„é€ å™¨æ¥åˆ›å»º beanã€‚åœ¨ XML é…ç½®ä¸­ï¼Œbean çš„åˆ›å»ºæ˜¾å¾—æ›´åŠ è¢«åŠ¨ï¼Œä¸è¿‡ï¼Œå®ƒå¹¶æ²¡æœ‰ JavaConfig é‚£æ ·å¼ºå¤§ï¼Œåœ¨ JavaConfig é…ç½®æ–¹å¼ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ä»»ä½•å¯ä»¥æƒ³è±¡åˆ°çš„æ–¹æ³•æ¥åˆ›å»º bean å®ä¾‹ã€‚</p>
<p>å¦å¤–ä¸€ä¸ªéœ€è¦æ³¨æ„åˆ°çš„äº‹æƒ…å°±æ˜¯ï¼Œåœ¨è¿™ä¸ªç®€å•çš„ <code>&lt;bean&gt;</code> å£°æ˜ä¸­ï¼Œæˆ‘ä»¬å°† bean çš„ç±»å‹ä»¥å­—ç¬¦ä¸²çš„å½¢å¼è®¾ç½®åœ¨äº† class å±æ€§ä¸­ã€‚è°èƒ½ä¿è¯è®¾ç½®ç»™ class å±æ€§çš„å€¼æ˜¯çœŸæ­£çš„ç±»å‘¢ï¼ŸSpring çš„ XML é…ç½®å¹¶ä¸èƒ½ä»ç¼–è¯‘æœŸçš„ç±»å‹æ£€æŸ¥ä¸­å—ç›Šã€‚å³ä¾¿å®ƒæ‰€å¼•ç”¨çš„æ˜¯å®é™…çš„ç±»å‹ï¼Œå¦‚æœä½ é‡å‘½åäº†ç±»ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p>
<blockquote>
<p>å€ŸåŠ© IDE æ£€æŸ¥ XML çš„åˆæ³•æ€§</p>
<p>ä½¿ç”¨èƒ½å¤Ÿæ„ŸçŸ¥ Spring åŠŸèƒ½çš„ IDEï¼Œå¦‚ Spring Tool Suiteï¼Œèƒ½å¤Ÿåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå¸®åŠ©ä½ ç¡®ä¿ Spring XML é…ç½®çš„åˆæ³•æ€§ã€‚</p>
</blockquote>
<p>ä»¥ä¸Šä»‹ç»çš„åªæ˜¯ JavaConfig è¦ä¼˜äº XML é…ç½®çš„éƒ¨åˆ†åŸå› ã€‚æˆ‘å»ºè®®åœ¨ä¸ºä½ çš„åº”ç”¨é€‰æ‹©é…ç½®é£æ ¼æ—¶ï¼Œè¦è®°ä½ XML é…ç½®çš„è¿™äº›ç¼ºç‚¹ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­ Spring XML é…ç½®çš„å­¦ä¹ è¿›ç¨‹ï¼Œäº†è§£å¦‚ä½•å°† SgtPeppers bean æ³¨å…¥åˆ° CDPlayer ä¸­ã€‚</p>
<h4 id="å€ŸåŠ©æ„é€ å™¨æ³¨å…¥åˆå§‹åŒ–-bean"><a href="#å€ŸåŠ©æ„é€ å™¨æ³¨å…¥åˆå§‹åŒ–-bean" class="headerlink" title="å€ŸåŠ©æ„é€ å™¨æ³¨å…¥åˆå§‹åŒ– bean"></a>å€ŸåŠ©æ„é€ å™¨æ³¨å…¥åˆå§‹åŒ– bean</h4><p>åœ¨ Spring XML é…ç½®ä¸­ï¼Œåªæœ‰ä¸€ç§å£°æ˜ bean çš„æ–¹å¼ï¼šä½¿ç”¨ <code>&lt;bean&gt;</code> å…ƒç´ å¹¶æŒ‡å®š class å±æ€§ã€‚Spring ä¼šä»è¿™é‡Œè·å–å¿…è¦çš„ä¿¡æ¯æ¥åˆ›å»º beanã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨ XML ä¸­å£°æ˜ DI æ—¶ï¼Œä¼šæœ‰å¤šç§å¯é€‰çš„é…ç½®æ–¹æ¡ˆå’Œé£æ ¼ã€‚å…·ä½“åˆ°æ„é€ å™¨æ³¨å…¥ï¼Œæœ‰ä¸¤ç§åŸºæœ¬çš„é…ç½®æ–¹æ¡ˆå¯ä¾›é€‰æ‹©ï¼š</p>
<ul>
<li><code>&lt;constructor-arg&gt;</code>å…ƒç´ </li>
<li>ä½¿ç”¨ Spring 3.0 æ‰€å¼•å…¥çš„ c-å‘½åç©ºé—´</li>
</ul>
<p>ä¸¤è€…çš„åŒºåˆ«åœ¨å¾ˆå¤§ç¨‹åº¦å°±æ˜¯æ˜¯å¦å†—é•¿çƒ¦çã€‚å¯ä»¥çœ‹åˆ°ï¼Œ<code>&lt;constructor-arg&gt;</code> å…ƒç´ æ¯”ä½¿ç”¨ c-å‘½åç©ºé—´ä¼šæ›´åŠ å†—é•¿ï¼Œä»è€Œå¯¼è‡´ XML æ›´åŠ éš¾ä»¥è¯»æ‡‚ã€‚å¦å¤–ï¼Œæœ‰äº›äº‹æƒ…<code>&lt;constructor-arg&gt;</code> å¯ä»¥åšåˆ°ï¼Œä½†æ˜¯ä½¿ç”¨c-å‘½åç©ºé—´å´æ— æ³•å®ç°ã€‚</p>
<p>åœ¨ä»‹ç» Spring XML çš„æ„é€ å™¨æ³¨å…¥æ—¶ï¼Œæˆ‘ä»¬å°†ä¼šåˆ†åˆ«ä»‹ç»è¿™ä¸¤ç§å¯é€‰æ–¹æ¡ˆã€‚é¦–å…ˆï¼Œçœ‹ä¸€ä¸‹å®ƒä»¬å„è‡ªå¦‚ä½•æ³¨å…¥ bean å¼•ç”¨ã€‚</p>
<p>æ„é€ å™¨æ³¨å…¥ bean å¼•ç”¨</p>
<p>æŒ‰ç…§ç°åœ¨çš„å®šä¹‰ï¼ŒCDPlayerbean æœ‰ä¸€ä¸ªæ¥å— CompactDisc ç±»å‹çš„æ„é€ å™¨ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªå¾ˆå¥½çš„åœºæ™¯æ¥å­¦ä¹ å¦‚ä½•æ³¨å…¥bean çš„å¼•ç”¨ã€‚</p>
<p>ç°åœ¨å·²ç»å£°æ˜äº† SgtPeppers beanï¼Œå¹¶ä¸” SgtPeppers ç±»å®ç°äº† CompactDisc æ¥å£ï¼Œæ‰€ä»¥å®é™…ä¸Šæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªå¯ä»¥æ³¨å…¥åˆ° CDPlayerbean ä¸­çš„ beanã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯åœ¨ XML ä¸­å£°æ˜ CDPlayer å¹¶é€šè¿‡ ID å¼•ç”¨ SgtPeppersï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cdPlayer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.CDPlayer&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;compactDisc&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ Spring é‡åˆ°è¿™ä¸ª <code>&lt;bean&gt;</code> å…ƒç´ æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ª CDPlayer å®ä¾‹ã€‚<code>&lt;constructor-arg&gt;</code> å…ƒç´ ä¼šå‘ŠçŸ¥ Spring è¦å°†ä¸€ä¸ª ID compactDisc çš„ bean å¼•ç”¨ä¼ é€’åˆ° CDPlayer çš„æ„é€ å™¨ä¸­ã€‚ä½œä¸ºæ›¿ä»£çš„æ–¹æ¡ˆï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Spring çš„ c-å‘½åç©ºé—´ã€‚c-å‘½åç©ºé—´æ˜¯åœ¨ Spring 3.0 ä¸­å¼•å…¥çš„ï¼Œå®ƒæ˜¯åœ¨ XML ä¸­æ›´ä¸ºç®€æ´åœ°æè¿°æ„é€ å™¨å‚æ•°çš„æ–¹å¼ã€‚è¦ä½¿ç”¨å®ƒçš„è¯ï¼Œå¿…é¡»è¦åœ¨ XML çš„é¡¶éƒ¨å£°æ˜å…¶æ¨¡å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>       <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span>       <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans       http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span>                                     <span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ c-å‘½åç©ºé—´å’Œæ¨¡å¼å£°æ˜ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å®ƒæ¥å£°æ˜æ„é€ å™¨å‚æ•°äº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cdPlayer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.CDPlayer&quot;</span> <span class="attr">c:cd-ref</span>=<span class="string">&quot;compactDisc&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† c-å‘½åç©ºé—´æ¥å£°æ˜æ„é€ å™¨å‚æ•°ï¼Œå®ƒä½œä¸º <code>&lt;bean&gt;</code> å…ƒç´ çš„ä¸€ä¸ªå±æ€§ï¼Œä¸è¿‡è¿™ä¸ªå±æ€§çš„åå­—æœ‰ç‚¹è¯¡å¼‚ã€‚å›¾2.1 æè¿°äº†è¿™ä¸ªå±æ€§åæ˜¯å¦‚ä½•ç»„åˆè€Œæˆçš„ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211020091950504.png" alt="image-20211020091950504"></p>
<center>å›¾ 2.1ã€€é€šè¿‡ Spring çš„ c-å‘½åç©ºé—´å°† bean å¼•ç”¨æ³¨å…¥åˆ°æ„é€ å™¨å‚æ•°ä¸­</center>

<p>å±æ€§åä»¥ â€œc:â€ å¼€å¤´ï¼Œä¹Ÿå°±æ˜¯å‘½åç©ºé—´çš„å‰ç¼€ã€‚æ¥ä¸‹æ¥å°±æ˜¯è¦è£…é…çš„æ„é€ å™¨å‚æ•°åï¼Œåœ¨æ­¤ä¹‹åæ˜¯ â€œ-refâ€ï¼Œè¿™æ˜¯ä¸€ä¸ªå‘½åçš„çº¦å®šï¼Œå®ƒä¼šå‘Šè¯‰ Springï¼Œæ­£åœ¨è£…é…çš„æ˜¯ä¸€ä¸ª bean çš„å¼•ç”¨ï¼Œè¿™ä¸ª bean çš„åå­—æ˜¯ compactDiscï¼Œè€Œä¸æ˜¯å­—é¢é‡ â€œcompactDiscâ€ã€‚</p>
<p>å¾ˆæ˜¾ç„¶ï¼Œä½¿ç”¨ c-å‘½åç©ºé—´å±æ€§è¦æ¯”ä½¿ç”¨ <code>&lt;constructor-arg&gt;</code> å…ƒç´ ç®€ç»ƒå¾—å¤šã€‚è¿™æ˜¯æˆ‘å¾ˆå–œæ¬¢å®ƒçš„åŸå› ä¹‹ä¸€ã€‚é™¤äº†æ›´æ˜“è¯»ä¹‹å¤–ï¼Œå½“æˆ‘åœ¨ç¼–å†™æ ·ä¾‹ä»£ç æ—¶ï¼Œc-å‘½åç©ºé—´å±æ€§èƒ½å¤Ÿæ›´åŠ æœ‰åŠ©äºä½¿ä»£ç çš„é•¿åº¦ä¿æŒåœ¨ä¹¦çš„è¾¹æ¡†ä¹‹å†…ã€‚</p>
<p>åœ¨ç¼–å†™å‰é¢çš„æ ·ä¾‹æ—¶ï¼Œå…³äº c-å‘½åç©ºé—´ï¼Œæœ‰ä¸€ä»¶è®©æˆ‘æ„Ÿåˆ°å›°æ‰°çš„äº‹æƒ…å°±æ˜¯å®ƒç›´æ¥å¼•ç”¨äº†æ„é€ å™¨å‚æ•°çš„åç§°ã€‚å¼•ç”¨å‚æ•°çš„åç§°çœ‹èµ·æ¥æœ‰äº›æ€ªå¼‚ï¼Œå› ä¸ºè¿™éœ€è¦åœ¨ç¼–è¯‘ä»£ç çš„æ—¶å€™ï¼Œå°†è°ƒè¯•æ ‡å¿—ï¼ˆdebug symbolï¼‰ä¿å­˜åœ¨ç±»ä»£ç ä¸­ã€‚å¦‚æœä½ ä¼˜åŒ–æ„å»ºè¿‡ç¨‹ï¼Œå°†è°ƒè¯•æ ‡å¿—ç§»é™¤æ‰ï¼Œé‚£ä¹ˆè¿™ç§æ–¹å¼å¯èƒ½å°±æ— æ³•æ­£å¸¸æ‰§è¡Œäº†ã€‚</p>
<p>æ›¿ä»£çš„æ–¹æ¡ˆæ˜¯æˆ‘ä»¬ä½¿ç”¨å‚æ•°åœ¨æ•´ä¸ªå‚æ•°åˆ—è¡¨ä¸­çš„ä½ç½®ä¿¡æ¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cdPlayer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.CDPlayer&quot;</span> <span class="attr">c:_0-ref</span>=<span class="string">&quot;compactDisc&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª c-å‘½åç©ºé—´å±æ€§çœ‹èµ·æ¥ä¼¼ä¹æ¯”ä¸Šä¸€ç§æ–¹æ³•æ›´åŠ æ€ªå¼‚ã€‚æˆ‘å°†å‚æ•°çš„åç§°æ›¿æ¢æˆäº† â€œ0â€ï¼Œä¹Ÿå°±æ˜¯å‚æ•°çš„ç´¢å¼•ã€‚å› ä¸ºåœ¨ XML ä¸­ä¸å…è®¸æ•°å­—ä½œä¸ºå±æ€§çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œå› æ­¤å¿…é¡»è¦æ·»åŠ ä¸€ä¸ªä¸‹ç”»çº¿ä½œä¸ºå‰ç¼€ã€‚</p>
<p>ä½¿ç”¨ç´¢å¼•æ¥è¯†åˆ«æ„é€ å™¨å‚æ•°æ„Ÿè§‰æ¯”ä½¿ç”¨åå­—æ›´å¥½ä¸€äº›ã€‚å³ä¾¿åœ¨æ„å»ºçš„æ—¶å€™ç§»é™¤æ‰äº†è°ƒè¯•æ ‡å¿—ï¼Œå‚æ•°å´ä¼šä¾ç„¶ä¿æŒç›¸åŒçš„é¡ºåºã€‚å¦‚æœæœ‰å¤šä¸ªæ„é€ å™¨å‚æ•°çš„è¯ï¼Œè¿™å½“ç„¶æ˜¯å¾ˆæœ‰ç”¨å¤„çš„ã€‚åœ¨è¿™é‡Œå› ä¸ºåªæœ‰ä¸€ä¸ªæ„é€ å™¨å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æœ‰å¦å¤–ä¸€ä¸ªæ–¹æ¡ˆâ€”â€”æ ¹æœ¬ä¸ç”¨å»æ ‡ç¤ºå‚æ•°ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cdPlayer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.CDPlayer&quot;</span> <span class="attr">c:_-ref</span>=<span class="string">&quot;compactDisc&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™æ˜¯æœ€ä¸ºå¥‡ç‰¹çš„ä¸€ä¸ª c-å‘½åç©ºé—´å±æ€§ï¼Œè¿™é‡Œæ²¡æœ‰å‚æ•°ç´¢å¼•æˆ–å‚æ•°åã€‚åªæœ‰ä¸€ä¸ªä¸‹ç”»çº¿ï¼Œç„¶åå°±æ˜¯ç”¨â€œ-refâ€æ¥è¡¨æ˜æ­£åœ¨è£…é…çš„æ˜¯ä¸€ä¸ªå¼•ç”¨ã€‚</p>
<p>æˆ‘ä»¬å·²ç»å°†å¼•ç”¨è£…é…åˆ°äº†å…¶ä»–çš„ bean ä¹‹ä¸­ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å¦‚ä½•å°†å­—é¢é‡å€¼ï¼ˆliteral valueï¼‰è£…é…åˆ°æ„é€ å™¨ä¹‹ä¸­ã€‚</p>
<p>å°†å­—é¢é‡æ³¨å…¥åˆ°æ„é€ å™¨ä¸­</p>
<p>è¿„ä»Šä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰€åšçš„ DI é€šå¸¸æŒ‡çš„éƒ½æ˜¯ç±»å‹çš„è£…é…â€”â€”ä¹Ÿå°±æ˜¯å°†å¯¹è±¡çš„å¼•ç”¨è£…é…åˆ°ä¾èµ–äºå®ƒä»¬çš„å…¶ä»–å¯¹è±¡ä¹‹ä¸­â€”â€”è€Œæœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åšçš„åªæ˜¯ç”¨ä¸€ä¸ªå­—é¢é‡å€¼æ¥é…ç½®å¯¹è±¡ã€‚ä¸ºäº†é˜è¿°è¿™ä¸€ç‚¹ï¼Œå‡è®¾ä½ è¦åˆ›å»º CompactDisc çš„ä¸€ä¸ªæ–°å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlankDisc</span> <span class="keyword">implements</span> <span class="title">CompactDisc</span> </span>&#123;    <span class="keyword">private</span> String title;    <span class="keyword">private</span> String artist;        <span class="function"><span class="keyword">public</span> <span class="title">BlankDisc</span><span class="params">(String title, String artist)</span> </span>&#123;        <span class="keyword">this</span>.title = title;        <span class="keyword">this</span>.artist = artist;    &#125;        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;        System.out.println(<span class="string">&quot;playing &quot;</span> + title + <span class="string">&quot; by &quot;</span> + artist);    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ SgtPeppers ä¸­ï¼Œå”±ç‰‡åç§°å’Œè‰ºæœ¯å®¶çš„åå­—éƒ½æ˜¯ç¡¬ç¼–ç çš„ï¼Œä½†æ˜¯è¿™ä¸ª CompactDisc å®ç°ä¸ä¹‹ä¸åŒï¼Œå®ƒæ›´åŠ çµæ´»ã€‚åƒç°å®ä¸­çš„ç©ºç£ç›˜ä¸€æ ·ï¼Œå®ƒå¯ä»¥è®¾ç½®æˆä»»æ„ä½ æƒ³è¦çš„è‰ºæœ¯å®¶å’Œå”±ç‰‡åã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†å·²æœ‰çš„ SgtPeppers æ›¿æ¢ä¸ºè¿™ä¸ªç±»ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;compactDisc&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.BlankDisc&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;Sgt. Pepper&#x27;s Lonely Hearts Club Band&quot;</span>/&gt;</span>    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;The Battle&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å†æ¬¡ä½¿ç”¨ <code>&lt;constructor-arg&gt;</code> å…ƒç´ è¿›è¡Œæ„é€ å™¨å‚æ•°çš„æ³¨å…¥ã€‚ä½†æ˜¯è¿™ä¸€æ¬¡æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ â€œrefâ€ å±æ€§æ¥å¼•ç”¨å…¶ä»–çš„ beanï¼Œè€Œæ˜¯ä½¿ç”¨äº† value å±æ€§ï¼Œé€šè¿‡è¯¥å±æ€§è¡¨æ˜ç»™å®šçš„å€¼è¦ä»¥å­—é¢é‡çš„å½¢å¼æ³¨å…¥åˆ°æ„é€ å™¨ä¹‹ä¸­ã€‚</p>
<p>å¦‚æœè¦ä½¿ç”¨ c-å‘½åç©ºé—´çš„è¯ï¼Œè¿™ä¸ªä¾‹å­åˆè¯¥æ˜¯ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿç¬¬ä¸€ç§æ–¹æ¡ˆæ˜¯å¼•ç”¨æ„é€ å™¨å‚æ•°çš„åå­—ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;compactDisc&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.BlankDisc&quot;</span>      <span class="attr">c:title</span>=<span class="string">&quot;Sgt. Pepper&#x27;s Lonely Hearts Club Band&quot;</span>      <span class="attr">c:_artist</span>=<span class="string">&quot;The Battle&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè£…é…å­—é¢é‡ä¸è£…é…å¼•ç”¨çš„åŒºåˆ«åœ¨äºå±æ€§åä¸­å»æ‰äº† â€œ-refâ€ åç¼€ã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°ç´¢å¼•è£…é…ç›¸åŒçš„å­—é¢é‡å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;compactDisc&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.BlankDisc&quot;</span>      <span class="attr">c:_0</span>=<span class="string">&quot;Sgt. Pepper&#x27;s Lonely Hearts Club Band&quot;</span>      <span class="attr">c:_1</span>=<span class="string">&quot;The Battle&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>XML ä¸å…è®¸æŸä¸ªå…ƒç´ çš„å¤šä¸ªå±æ€§å…·æœ‰ç›¸åŒçš„åå­—ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªæˆ–æ›´å¤šçš„æ„é€ å™¨å‚æ•°çš„è¯ï¼Œæˆ‘ä»¬ä¸èƒ½ç®€å•åœ°ä½¿ç”¨ä¸‹ç”»çº¿è¿›è¡Œæ ‡ç¤ºã€‚ä½†æ˜¯å¦‚æœåªæœ‰ä¸€ä¸ªæ„é€ å™¨å‚æ•°çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿™æ ·åšäº†ã€‚ä¸ºäº†å®Œæ•´åœ°å±•ç°è¯¥åŠŸèƒ½ï¼Œå‡è®¾ BlankDisc åªæœ‰ä¸€ä¸ªæ„é€ å™¨å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ¥å—å”±ç‰‡çš„åç§°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Spring ä¸­è¿™æ ·å£°æ˜å®ƒï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;compactDisc&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.BlankDisc&quot;</span> <span class="attr">c:_</span>=<span class="string">&quot;Sgt. Pepper&#x27;s Lonely hearts Club Band&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è£…é… bean å¼•ç”¨å’Œå­—é¢é‡å€¼æ–¹é¢ï¼Œ<code>&lt;</code>constructor-arg&gt; å’Œ c-å‘½åç©ºé—´çš„åŠŸèƒ½æ˜¯ç›¸åŒçš„ã€‚ä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µæ˜¯ <code>&lt;constructor-arg&gt;</code> èƒ½å¤Ÿå®ç°ï¼Œc-å‘½åç©ºé—´å´æ— æ³•åšåˆ°çš„ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•å°†é›†åˆè£…é…åˆ°æ„é€ å™¨å‚æ•°ä¸­ã€‚</p>
<p>è£…é…é›†åˆ</p>
<p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬å‡è®¾ CompactDisc åœ¨å®šä¹‰æ—¶åªåŒ…å«äº†å”±ç‰‡åç§°å’Œè‰ºæœ¯å®¶çš„åå­—ã€‚å¦‚æœç°å®ä¸–ç•Œä¸­çš„ CD ä¹Ÿæ˜¯è¿™æ ·çš„è¯ï¼Œé‚£ä¹ˆåœ¨æŠ€æœ¯ä¸Šå°±ä¸ä¼šä»»ä½•çš„è¿›å±•ã€‚CD ä¹‹æ‰€ä»¥å€¼å¾—è´­ä¹°æ˜¯å› ä¸ºå®ƒä¸Šé¢æ‰€æ‰¿è½½çš„éŸ³ä¹ã€‚å¤§å¤šæ•°çš„ CD éƒ½ä¼šåŒ…å«åå¤šä¸ªç£é“ï¼Œæ¯ä¸ªç£é“ä¸ŠåŒ…å«ä¸€é¦–æ­Œã€‚</p>
<p>å¦‚æœä½¿ç”¨ CompactDisc ä¸ºçœŸæ­£çš„ CD å»ºæ¨¡ï¼Œé‚£ä¹ˆå®ƒä¹Ÿåº”è¯¥æœ‰ç£é“åˆ—è¡¨çš„æ¦‚å¿µã€‚è¯·è€ƒè™‘ä¸‹é¢è¿™ä¸ªæ–°çš„ BlankDiscï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem.collectons;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> soundsystem.CompactDisc;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlankDisc</span> <span class="keyword">implements</span> <span class="title">CompactDisc</span> </span>&#123;    <span class="keyword">private</span> String title;    <span class="keyword">private</span> String artist;    <span class="keyword">private</span> List&lt;String&gt; tracks;        <span class="function"><span class="keyword">public</span> <span class="title">BlanDisc</span><span class="params">(String title, String artist, List&lt;String&gt; tracks)</span> </span>&#123;        <span class="keyword">this</span>.title = title;        <span class="keyword">this</span>.artist = artist;        <span class="keyword">this</span>.tracks = tracks;    &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;        System.out.println(<span class="string">&quot;Playing &quot;</span> + title + <span class="string">&quot; by &quot;</span> + artist);        <span class="keyword">for</span> (String track: tracks) &#123;            System.out.println(<span class="string">&quot;-Track: &quot;</span> + track);        &#125;    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå˜æ›´ä¼šå¯¹ Spring å¦‚ä½•é…ç½® bean äº§ç”Ÿå½±å“ï¼Œåœ¨å£°æ˜ bean çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»è¦æä¾›ä¸€ä¸ªç£é“åˆ—è¡¨ã€‚æœ€ç®€å•çš„åŠæ³•æ˜¯å°†åˆ—è¡¨è®¾ç½®ä¸º nullã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªæ„é€ å™¨å‚æ•°ï¼Œæ‰€ä»¥å¿…é¡»è¦å£°æ˜å®ƒï¼Œä¸è¿‡ä½ å¯ä»¥é‡‡ç”¨å¦‚ä¸‹çš„æ–¹å¼ä¼ é€’nullç»™å®ƒï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;compactDisc&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.BlankDisc&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;Sgt. Pepper&#x27;s Lonely Hearts Club Band&quot;</span>/&gt;</span>    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;The Beatles&quot;</span>/&gt;</span>    <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span><span class="tag">&lt;<span class="name">null</span>/&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;null/&gt;</code> å…ƒç´ æ‰€åšçš„äº‹æƒ…ä¸ä½ çš„æœŸæœ›æ˜¯ä¸€æ ·çš„ï¼šå°† null ä¼ é€’ç»™æ„é€ å™¨ã€‚è¿™å¹¶ä¸æ˜¯è§£å†³é—®é¢˜çš„å¥½åŠæ³•ï¼Œä½†åœ¨æ³¨å…¥æœŸå®ƒèƒ½æ­£å¸¸æ‰§è¡Œã€‚å½“è°ƒç”¨ play() æ–¹æ³•æ—¶ï¼Œä½ ä¼šé‡åˆ°NullPointerException å¼‚å¸¸ï¼Œå› æ­¤è¿™å¹¶ä¸æ˜¯ç†æƒ³çš„æ–¹æ¡ˆã€‚æ›´å¥½çš„è§£å†³æ–¹æ³•æ˜¯æä¾›ä¸€ä¸ªç£é“åç§°çš„åˆ—è¡¨ã€‚è¦è¾¾åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰å¤šä¸ªå¯é€‰æ–¹æ¡ˆã€‚é¦–å…ˆï¼Œå¯ä»¥ä½¿ç”¨<code>&lt;list&gt;</code> å…ƒç´ å°†å…¶å£°æ˜ä¸ºä¸€ä¸ªåˆ—è¡¨ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;compactDisc&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.BlankDisc&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;Sgt. Pepper&#x27;s Lonely Hearts Club Band&quot;</span>/&gt;</span>    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;The Beatles&quot;</span>/&gt;</span>    <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span>    	<span class="tag">&lt;<span class="name">list</span>&gt;</span>        	<span class="tag">&lt;<span class="name">value</span>&gt;</span>Sgt. Pepper&#x27;s Lonely Hearts Club Band<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>With a Little Help from My Friends<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Lucy in the Sky with Diamonds<span class="tag">&lt;/<span class="name">value</span>&gt;</span>        <span class="tag">&lt;/<span class="name">list</span>&gt;</span>    <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>&lt;list&gt;</code> å…ƒç´ æ˜¯ <code>&lt;constructor-arg&gt;</code> çš„å­å…ƒç´ ï¼Œè¿™è¡¨æ˜ä¸€ä¸ªåŒ…å«å€¼çš„åˆ—è¡¨å°†ä¼šä¼ é€’åˆ°æ„é€ å™¨ä¸­ã€‚å…¶ä¸­ï¼Œ<code>&lt;value&gt;</code> å…ƒç´ ç”¨æ¥æŒ‡å®šåˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚</p>
<p>ä¸ä¹‹ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>&lt;ref&gt;</code> å…ƒç´ æ›¿ä»£ <code>&lt;value&gt;</code>ï¼Œå®ç° bean å¼•ç”¨åˆ—è¡¨çš„è£…é…ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ª Discography ç±»ï¼Œå®ƒçš„æ„é€ å™¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Discography</span><span class="params">(String artist, List&lt;CompactDisc&gt; cds)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆï¼Œä½ å¯ä»¥é‡‡å–å¦‚ä¸‹çš„æ–¹å¼é…ç½® Discography beanï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;compactDisc&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.BlankDisc&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;Sgt. Pepper&#x27;s Lonely Hearts Club Band&quot;</span>/&gt;</span>    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;The Beatles&quot;</span>/&gt;</span>    <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span>    	<span class="tag">&lt;<span class="name">list</span>&gt;</span>        	<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;sgtPeppers&quot;</span>/&gt;</span>            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;WhiteAlbum&quot;</span>/&gt;</span>        <span class="tag">&lt;/<span class="name">list</span>&gt;</span>    <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“æ„é€ å™¨å‚æ•°çš„ç±»å‹æ˜¯ java.util.List æ—¶ï¼Œä½¿ç”¨ <code>&lt;list&gt;</code> å…ƒç´ æ˜¯åˆæƒ…åˆç†çš„ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‰ç…§åŒæ ·çš„æ–¹å¼ä½¿ç”¨ <code>&lt;set&gt;</code> å…ƒç´ ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;compactDisc&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.BlankDisc&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;Sgt. Pepper&#x27;s Lonely Hearts Club Band&quot;</span>/&gt;</span>    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;The Beatles&quot;</span>/&gt;</span>    <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span>    	<span class="tag">&lt;<span class="name">set</span>&gt;</span>        	<span class="tag">&lt;<span class="name">value</span>&gt;</span>Sgt. Pepper&#x27;s Lonely Hearts Club Band<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>With a Little Help from My Friends<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Lucy in the Sky with Diamonds<span class="tag">&lt;/<span class="name">value</span>&gt;</span>        <span class="tag">&lt;/<span class="name">set</span>&gt;</span>    <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;set&gt;</code> å’Œ <code>&lt;list&gt;</code> å…ƒç´ çš„åŒºåˆ«ä¸å¤§ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸åŒåœ¨äºå½“ Spring åˆ›å»ºè¦è£…é…çš„é›†åˆæ—¶ï¼Œæ‰€åˆ›å»ºçš„æ˜¯ java.util.Set è¿˜æ˜¯ java.util.Listã€‚å¦‚æœæ˜¯ Set çš„è¯ï¼Œæ‰€æœ‰é‡å¤çš„å€¼éƒ½ä¼šè¢«å¿½ç•¥æ‰ï¼Œå­˜æ”¾é¡ºåºä¹Ÿä¸ä¼šå¾—ä»¥ä¿è¯ã€‚ä¸è¿‡æ— è®ºåœ¨å“ªç§æƒ…å†µä¸‹ï¼Œ<code>&lt;set&gt;</code> æˆ– <code>&lt;list&gt;</code> éƒ½å¯ä»¥ç”¨æ¥è£…é… Listã€Set ç”šè‡³æ•°ç»„ã€‚</p>
<p>åœ¨è£…é…é›†åˆæ–¹é¢ï¼Œ<code>&lt;constructor-arg&gt;</code> æ¯” c-å‘½åç©ºé—´çš„å±æ€§æ›´æœ‰ä¼˜åŠ¿ã€‚ç›®å‰ï¼Œä½¿ç”¨ c-å‘½åç©ºé—´çš„å±æ€§æ— æ³•å®ç°è£…é…é›†åˆçš„åŠŸèƒ½ã€‚</p>
<p>ä½¿ç”¨ <code>&lt;constructor-arg&gt;</code> å’Œ c-å‘½åç©ºé—´å®ç°æ„é€ å™¨æ³¨å…¥æ—¶ï¼Œå®ƒä»¬ä¹‹é—´è¿˜æœ‰ä¸€äº›ç»†å¾®çš„å·®åˆ«ã€‚ä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰€æ¶µç›–çš„å†…å®¹å·²ç»è¶³å¤Ÿäº†ï¼Œå°¤å…¶æ˜¯åƒæˆ‘ä¹‹å‰æ‰€å»ºè®®çš„é‚£æ ·ï¼Œè¦é¦–é€‰åŸºäº Java çš„é…ç½®è€Œä¸æ˜¯ XMLã€‚å› æ­¤ï¼Œä¸å…¶ä¸åŒå…¶çƒ¦åœ°èŠ±è´¹æ—¶é—´è®²è¿°å¦‚ä½•ä½¿ç”¨ XML è¿›è¡Œæ„é€ å™¨æ³¨å…¥ï¼Œè¿˜ä¸å¦‚çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ XML æ¥è£…é…å±æ€§ã€‚</p>
<h4 id="è®¾ç½®å±æ€§"><a href="#è®¾ç½®å±æ€§" class="headerlink" title="è®¾ç½®å±æ€§"></a>è®¾ç½®å±æ€§</h4><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒCDPlayer å’Œ BlankDisc ç±»å®Œå…¨æ˜¯é€šè¿‡æ„é€ å™¨æ³¨å…¥çš„ï¼Œæ²¡æœ‰ä½¿ç”¨å±æ€§çš„ Setter æ–¹æ³•ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ Spring XML å®ç°å±æ€§æ³¨å…¥ã€‚å‡è®¾å±æ€§æ³¨å…¥çš„ CDPlayer å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CDPlayer</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span> </span>&#123;  <span class="keyword">private</span> CompactDisc cd;  <span class="meta">@Autowired</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCompactDisc</span><span class="params">(CompactDisc compactDisc)</span> </span>&#123;    <span class="keyword">this</span>.compactDisc = compactDisc;  &#125;  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;    cd.play();  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥é€‰æ‹©æ„é€ å™¨æ³¨å…¥è¿˜æ˜¯å±æ€§æ³¨å…¥å‘¢ï¼Ÿä½œä¸ºä¸€ä¸ªé€šç”¨çš„è§„åˆ™ï¼Œ<strong>æˆ‘å€¾å‘äºå¯¹å¼ºä¾èµ–ä½¿ç”¨æ„é€ å™¨æ³¨å…¥ï¼Œè€Œå¯¹å¯é€‰æ€§çš„ä¾èµ–ä½¿ç”¨å±æ€§æ³¨å…¥ã€‚</strong>æŒ‰ç…§è¿™ä¸ªè§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥è¯´å¯¹äº BlankDisc æ¥è®²ï¼Œå”±ç‰‡åç§°ã€è‰ºæœ¯å®¶ä»¥åŠç£é“åˆ—è¡¨æ˜¯å¼ºä¾èµ–ï¼Œå› æ­¤æ„é€ å™¨æ³¨å…¥æ˜¯æ­£ç¡®çš„æ–¹æ¡ˆã€‚ä¸è¿‡ï¼Œå¯¹äº CDPlayer æ¥è®²ï¼Œå®ƒå¯¹ CompactDisc æ˜¯å¼ºä¾èµ–è¿˜æ˜¯å¯é€‰æ€§ä¾èµ–å¯èƒ½ä¼šæœ‰äº›äº‰è®®ã€‚è™½ç„¶æˆ‘ä¸å¤ªè®¤åŒï¼Œä½†ä½ å¯èƒ½ä¼šè§‰å¾—å³ä¾¿æ²¡æœ‰å°† CompactDisc è£…å…¥è¿›å»ï¼ŒCDPlayer ä¾ç„¶è¿˜èƒ½å…·å¤‡ä¸€äº›æœ‰é™çš„åŠŸèƒ½ã€‚</p>
<p>ç°åœ¨ï¼ŒCDPlayer æ²¡æœ‰ä»»ä½•çš„æ„é€ å™¨ï¼ˆé™¤äº†éšå«çš„é»˜è®¤æ„é€ å™¨ï¼‰ï¼Œå®ƒä¹Ÿæ²¡æœ‰ä»»ä½•çš„å¼ºä¾èµ–ã€‚å› æ­¤ï¼Œä½ å¯ä»¥é‡‡ç”¨å¦‚ä¸‹çš„æ–¹å¼å°†å…¶å£°æ˜ä¸º Spring beanï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cdPlayer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.CDPlayer&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>Spring åœ¨åˆ›å»º bean çš„æ—¶å€™ä¸ä¼šæœ‰ä»»ä½•çš„é—®é¢˜ï¼Œä½†æ˜¯ CDPlayerTest ä¼šå› ä¸ºå‡ºç° NullPointerException è€Œå¯¼è‡´æµ‹è¯•å¤±è´¥ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰æ³¨å…¥ CDPlayer çš„ compactDisc å±æ€§ã€‚ä¸è¿‡ï¼ŒæŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼ä¿®æ”¹ XMLï¼Œå°±èƒ½è§£å†³è¯¥é—®é¢˜ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cdPlayer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.CDPlayer&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;compactDisc&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;compactDisc&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;property&gt;</code> å…ƒç´ ä¸ºå±æ€§çš„ Setter æ–¹æ³•æ‰€æä¾›çš„åŠŸèƒ½ä¸ <code>&lt;constructor-arg&gt;</code> å…ƒç´ ä¸ºæ„é€ å™¨æ‰€æä¾›çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒå¼•ç”¨äº† ID ä¸º compactDisc çš„beanï¼ˆé€šè¿‡refå±æ€§ï¼‰ï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ° compactDisc å±æ€§ä¸­ï¼ˆé€šè¿‡ setCompactDisc() æ–¹æ³•ï¼‰ã€‚å¦‚æœä½ ç°åœ¨è¿è¡Œæµ‹è¯•çš„è¯ï¼Œå®ƒåº”è¯¥å°±èƒ½é€šè¿‡äº†ã€‚</p>
<p>æˆ‘ä»¬å·²ç»çŸ¥é“ï¼ŒSpring ä¸º <code>&lt;constructor-arg&gt;</code> å…ƒç´ æä¾›äº† c-å‘½åç©ºé—´ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆï¼Œä¸ä¹‹ç±»ä¼¼ï¼ŒSpring æä¾›äº†æ›´åŠ ç®€æ´çš„ p-å‘½åç©ºé—´ï¼Œä½œä¸º <code>&lt;property&gt;</code> å…ƒç´ çš„æ›¿ä»£æ–¹æ¡ˆã€‚ä¸ºäº†å¯ç”¨ p-å‘½åç©ºé—´ï¼Œå¿…é¡»è¦åœ¨XMLæ–‡ä»¶ä¸­ä¸å…¶ä»–çš„å‘½åç©ºé—´ä¸€èµ·å¯¹å…¶è¿›è¡Œå£°æ˜ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>   <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>   <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span>   <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans 		http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span>	...<span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ p-å‘½åç©ºé—´ï¼ŒæŒ‰ç…§ä»¥ä¸‹çš„æ–¹å¼è£…é… compactDisc å±æ€§ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cdPlayer&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;soundsystem.properties.CDPlayer&quot;</span>      <span class="attr">p:compactDisc-ref</span>=<span class="string">&quot;compactDisc&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>p-å‘½åç©ºé—´ä¸­å±æ€§æ‰€éµå¾ªçš„å‘½åçº¦å®šä¸ c-å‘½åç©ºé—´ä¸­çš„å±æ€§ç±»ä¼¼ã€‚å›¾ 2.2 é˜è¿°äº†p-å‘½åç©ºé—´å±æ€§æ˜¯å¦‚ä½•ç»„æˆçš„ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211027165439437.png" alt="image-20211027165439437"></p>
<center>å›¾2.2ã€€å€ŸåŠ©Springçš„p-å‘½åç©ºé—´ï¼Œå°†beanå¼•ç”¨æ³¨å…¥åˆ°å±æ€§ä¸­</center>

<p>é¦–å…ˆï¼Œå±æ€§çš„åå­—ä½¿ç”¨äº† â€œp:â€ å‰ç¼€ï¼Œè¡¨æ˜æˆ‘ä»¬æ‰€è®¾ç½®çš„æ˜¯ä¸€ä¸ªå±æ€§ã€‚æ¥ä¸‹æ¥å°±æ˜¯è¦æ³¨å…¥çš„å±æ€§åã€‚æœ€åï¼Œå±æ€§çš„åç§°ä»¥ â€œ-refâ€ ç»“å°¾ï¼Œè¿™ä¼šæç¤º Spring è¦è¿›è¡Œè£…é…çš„æ˜¯å¼•ç”¨ï¼Œè€Œä¸æ˜¯å­—é¢é‡ã€‚</p>
<p>å°†å­—é¢é‡æ³¨å…¥åˆ°å±æ€§ä¸­</p>
<p>å±æ€§ä¹Ÿå¯ä»¥æ³¨å…¥å­—é¢é‡ï¼Œè¿™ä¸æ„é€ å™¨å‚æ•°éå¸¸ç±»ä¼¼ã€‚ä½œä¸ºç¤ºä¾‹ï¼Œæˆ‘ä»¬é‡æ–°çœ‹ä¸€ä¸‹ BlankDisc beanã€‚ä¸è¿‡ï¼ŒBlankDisc è¿™æ¬¡å®Œå…¨é€šè¿‡å±æ€§æ³¨å…¥è¿›è¡Œé…ç½®ï¼Œè€Œä¸æ˜¯æ„é€ å™¨æ³¨å…¥ã€‚æ–°çš„ BlankDisc ç±»å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> soundsystem.CompactDisc;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlankDisc</span> <span class="keyword">implements</span> <span class="title">CompactDisc</span> </span>&#123;  <span class="keyword">private</span> String title;  <span class="keyword">private</span> String artist;  <span class="keyword">private</span> List&lt;String&gt; tracks;  <span class="function"><span class="keyword">public</span> <span class="title">BlankDisc</span><span class="params">(String title, String artist, List&lt;String&gt; tracks)</span> </span>&#123;    <span class="keyword">this</span>.title = title;    <span class="keyword">this</span>.artist = artist;    <span class="keyword">this</span>.tracks = tracks;  &#125;  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;    System.out.println(<span class="string">&quot;Playing &quot;</span> + title + <span class="string">&quot; by &quot;</span> + artist);    <span class="keyword">for</span> (String track : tracks) &#123;      System.out.println(<span class="string">&quot;-Track: &quot;</span> + track);    &#125;  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œå®ƒä¸å†å¼ºåˆ¶è¦æ±‚æˆ‘ä»¬è£…é…ä»»ä½•çš„å±æ€§ã€‚ä½ å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼åˆ›å»ºä¸€ä¸ª BlankDiscbeanï¼Œå®ƒçš„æ‰€æœ‰å±æ€§å…¨éƒ½æ˜¯ç©ºçš„ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;reallyBlankDisc&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsysem.BlankDisc&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œå¦‚æœåœ¨è£…é… bean çš„æ—¶å€™ä¸è®¾ç½®è¿™äº›å±æ€§ï¼Œé‚£ä¹ˆåœ¨è¿è¡ŒæœŸ CD æ’­æ”¾å™¨å°†ä¸èƒ½æ­£å¸¸æ’­æ”¾å†…å®¹ã€‚play() æ–¹æ³•å¯èƒ½ä¼šé‡åˆ°çš„è¾“å‡ºå†…å®¹æ˜¯ â€œPlaying null by nullâ€ï¼Œéšä¹‹ä¼šæŠ›å‡º NullPointerException å¼‚å¸¸ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šä»»ä½•çš„ç£é“ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦è£…é…è¿™äº›å±æ€§ï¼Œå¯ä»¥å€ŸåŠ© <code>&lt;property&gt;</code> å…ƒç´ çš„ value å±æ€§å®ç°è¯¥åŠŸèƒ½ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;compactDisc&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;soundsystem.properties.BlankDisc&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Sgt. Pepper&#x27;s Lonely Hearts Club Band&quot;</span> /&gt;</span>    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;artist&quot;</span> <span class="attr">value</span>=<span class="string">&quot;The Beatles&quot;</span> /&gt;</span>    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;tracks&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">list</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Sgt. Pepper&#x27;s Lonely Hearts Club Band<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>With a Little Help from My Friends<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Lucy in the Sky with Diamonds<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Getting Better<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Fixing a Hole<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>She&#x27;s Leaving Home<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Being for the Benefit of Mr. Kite!<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Within You Without You<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>When I&#x27;m Sixty-Four<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Lovely Rita<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Good Morning Good Morning<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Sgt. Pepper&#x27;s Lonely Hearts Club Band (Reprise)<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>A Day in the Life<span class="tag">&lt;/<span class="name">value</span>&gt;</span>        <span class="tag">&lt;/<span class="name">list</span>&gt;</span>    <span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œé™¤äº†ä½¿ç”¨ <property> å…ƒç´ çš„ value å±æ€§æ¥è®¾ç½® title å’Œ artistï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨äº†å†…åµŒçš„ <list> å…ƒç´ æ¥è®¾ç½® trackså±æ€§ï¼Œè¿™ä¸ä¹‹å‰é€šè¿‡ <constructor-arg> è£…é… tracks æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</constructor-arg></list></property></p>
<p>å¦å¤–ä¸€ç§å¯é€‰æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ p-å‘½åç©ºé—´çš„å±æ€§æ¥å®Œæˆè¯¥åŠŸèƒ½ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;compactDisc&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;soundsystem.properties.BlankDisc&quot;</span>      <span class="attr">p:title</span>=<span class="string">&quot;Sgt. Pepper&#x27;s Lonely Hearts Club Band&quot;</span>      <span class="attr">p:artist</span>=<span class="string">&quot;The Beatles&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;tracks&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">list</span>&gt;</span>      <span class="tag">&lt;<span class="name">value</span>&gt;</span>Sgt. Pepper&#x27;s Lonely Hearts Club Band<span class="tag">&lt;/<span class="name">value</span>&gt;</span>      <span class="tag">&lt;<span class="name">value</span>&gt;</span>With a Little Help from My Friends<span class="tag">&lt;/<span class="name">value</span>&gt;</span>      <span class="tag">&lt;<span class="name">value</span>&gt;</span>Lucy in the Sky with Diamonds<span class="tag">&lt;/<span class="name">value</span>&gt;</span>      <span class="tag">&lt;<span class="name">value</span>&gt;</span>Getting Better<span class="tag">&lt;/<span class="name">value</span>&gt;</span>      <span class="tag">&lt;<span class="name">value</span>&gt;</span>Fixing a Hole<span class="tag">&lt;/<span class="name">value</span>&gt;</span>      <span class="tag">&lt;<span class="name">value</span>&gt;</span>She&#x27;s Leaving Home<span class="tag">&lt;/<span class="name">value</span>&gt;</span>      <span class="tag">&lt;<span class="name">value</span>&gt;</span>Being for the Benefit of Mr. Kite!<span class="tag">&lt;/<span class="name">value</span>&gt;</span>      <span class="tag">&lt;<span class="name">value</span>&gt;</span>Within You Without You<span class="tag">&lt;/<span class="name">value</span>&gt;</span>      <span class="tag">&lt;<span class="name">value</span>&gt;</span>When I&#x27;m Sixty-Four<span class="tag">&lt;/<span class="name">value</span>&gt;</span>      <span class="tag">&lt;<span class="name">value</span>&gt;</span>Lovely Rita<span class="tag">&lt;/<span class="name">value</span>&gt;</span>      <span class="tag">&lt;<span class="name">value</span>&gt;</span>Good Morning Good Morning<span class="tag">&lt;/<span class="name">value</span>&gt;</span>      <span class="tag">&lt;<span class="name">value</span>&gt;</span>Sgt. Pepper&#x27;s Lonely Hearts Club Band (Reprise)<span class="tag">&lt;/<span class="name">value</span>&gt;</span>      <span class="tag">&lt;<span class="name">value</span>&gt;</span>A Day in the Life<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    <span class="tag">&lt;/<span class="name">list</span>&gt;</span>  <span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ c-å‘½åç©ºé—´ä¸€æ ·ï¼Œè£…é… bean å¼•ç”¨ä¸è£…é…å­—é¢é‡çš„å”¯ä¸€åŒºåˆ«åœ¨äºæ˜¯å¦å¸¦æœ‰ â€œ-refâ€ åç¼€ã€‚å¦‚æœæ²¡æœ‰ â€œ-refâ€ åç¼€çš„è¯ï¼Œæ‰€è£…é…çš„å°±æ˜¯å­—é¢é‡ã€‚</p>
<p>ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ p-å‘½åç©ºé—´æ¥è£…é…é›†åˆï¼Œæ²¡æœ‰ä¾¿åˆ©çš„æ–¹å¼ä½¿ç”¨ p-å‘½åç©ºé—´æ¥æŒ‡å®šä¸€ä¸ªå€¼ï¼ˆæˆ– bean å¼•ç”¨ï¼‰çš„åˆ—è¡¨ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Spring util-å‘½åç©ºé—´ä¸­çš„ä¸€äº›åŠŸèƒ½æ¥ç®€åŒ– BlankDiscbeanã€‚</p>
<p>é¦–å…ˆï¼Œéœ€è¦åœ¨ XML ä¸­å£°æ˜ util-å‘½åç©ºé—´åŠå…¶æ¨¡å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span>  <span class="attr">xmlns:util</span>=<span class="string">&quot;http://www.springframework.org/schema/util&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans     http://www.springframework.org/schema/beans/spring-beans.xsd    http://www.springframework.org/schema/util     http://www.springframework.org/schema/util/spring-util.xsd&quot;</span>&gt;</span>    ...<span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>util-å‘½åç©ºé—´æ‰€æä¾›çš„åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯ <code>&lt;util:list&gt;</code> å…ƒç´ ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªåˆ—è¡¨çš„ beanã€‚å€ŸåŠ© <code>&lt;util:list&gt;</code>ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç£é“åˆ—è¡¨è½¬ç§»åˆ° BlankDisc beanä¹‹å¤–ï¼Œå¹¶å°†å…¶å£°æ˜åˆ°å•ç‹¬çš„ bean ä¹‹ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">&quot;trackList&quot;</span>&gt;</span>      <span class="tag">&lt;<span class="name">value</span>&gt;</span>Sgt. Pepper&#x27;s Lonely Hearts Club Band<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    <span class="tag">&lt;<span class="name">value</span>&gt;</span>With a Little Help from My Friends<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    <span class="tag">&lt;<span class="name">value</span>&gt;</span>Lucy in the Sky with Diamonds<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    <span class="tag">&lt;<span class="name">value</span>&gt;</span>Getting Better<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    <span class="tag">&lt;<span class="name">value</span>&gt;</span>Fixing a Hole<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    <span class="tag">&lt;<span class="name">value</span>&gt;</span>She&#x27;s Leaving Home<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    <span class="tag">&lt;<span class="name">value</span>&gt;</span>Being for the Benefit of Mr. Kite!<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    <span class="tag">&lt;<span class="name">value</span>&gt;</span>Within You Without You<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    <span class="tag">&lt;<span class="name">value</span>&gt;</span>When I&#x27;m Sixty-Four<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    <span class="tag">&lt;<span class="name">value</span>&gt;</span>Lovely Rita<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    <span class="tag">&lt;<span class="name">value</span>&gt;</span>Good Morning Good Morning<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    <span class="tag">&lt;<span class="name">value</span>&gt;</span>Sgt. Pepper&#x27;s Lonely Hearts Club Band (Reprise)<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    <span class="tag">&lt;<span class="name">value</span>&gt;</span>A Day in the Life<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  <span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;util:list&gt;</code> åªæ˜¯ util-å‘½åç©ºé—´ä¸­çš„å¤šä¸ªå…ƒç´ ä¹‹ä¸€ã€‚è¡¨ 2.1 åˆ—å‡ºäº† util-å‘½åç©ºé—´æä¾›çš„æ‰€æœ‰å…ƒç´ ã€‚</p>
<p>åœ¨éœ€è¦çš„æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šç”¨åˆ° util-å‘½åç©ºé—´ä¸­çš„éƒ¨åˆ†æˆå‘˜ã€‚ä½†ç°åœ¨ï¼Œåœ¨ç»“æŸæœ¬ç« å‰ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•å°†è‡ªåŠ¨åŒ–é…ç½®ã€ JavaConfig ä»¥åŠ XMLé…ç½®æ··åˆå¹¶åŒ¹é…åœ¨ä¸€èµ·ã€‚</p>
<center>è¡¨ 2.1ã€€Spring util-å‘½åç©ºé—´ä¸­çš„å…ƒç´ </center>

<table>
<thead>
<tr>
<th>å…ƒ ç´ </th>
<th>æ è¿°</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;util:constant&gt;</code></td>
<td>å¼•ç”¨æŸä¸ªç±»å‹çš„ public static åŸŸï¼Œå¹¶å°†å…¶æš´éœ²ä¸º bean</td>
</tr>
<tr>
<td>util:list</td>
<td>åˆ›å»ºä¸€ä¸ª java.util.List ç±»å‹çš„ beanï¼Œå…¶ä¸­åŒ…å«å€¼æˆ–å¼•ç”¨</td>
</tr>
<tr>
<td>util:map</td>
<td>åˆ›å»ºä¸€ä¸ª java.util.Map ç±»å‹çš„ beanï¼Œå…¶ä¸­åŒ…å«å€¼æˆ–å¼•ç”¨</td>
</tr>
<tr>
<td>util:properties</td>
<td>åˆ›å»ºä¸€ä¸ª java.util.Properties ç±»å‹çš„ bean</td>
</tr>
<tr>
<td>util:property-path</td>
<td>å¼•ç”¨ä¸€ä¸ª bean çš„å±æ€§ï¼ˆæˆ–å†…åµŒå±æ€§ï¼‰ï¼Œå¹¶å°†å…¶æš´éœ²ä¸º bean</td>
</tr>
<tr>
<td>util:set</td>
<td>åˆ›å»ºä¸€ä¸ª java.util.Set ç±»å‹çš„ beanï¼Œå…¶ä¸­åŒ…å«å€¼æˆ–å¼•ç”¨</td>
</tr>
</tbody></table>
<h3 id="å¯¼å…¥å’Œæ··åˆé…ç½®"><a href="#å¯¼å…¥å’Œæ··åˆé…ç½®" class="headerlink" title="å¯¼å…¥å’Œæ··åˆé…ç½®"></a>å¯¼å…¥å’Œæ··åˆé…ç½®</h3><p>åœ¨å…¸å‹çš„ Spring åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåŒæ—¶ä½¿ç”¨è‡ªåŠ¨åŒ–å’Œæ˜¾å¼é…ç½®ã€‚å³ä¾¿ä½ æ›´å–œæ¬¢é€šè¿‡ JavaConfig å®ç°æ˜¾å¼é…ç½®ï¼Œä½†æœ‰çš„æ—¶å€™XMLå´æ˜¯æœ€ä½³çš„æ–¹æ¡ˆã€‚</p>
<p>å¹¸å¥½åœ¨ Spring ä¸­ï¼Œè¿™äº›é…ç½®æ–¹æ¡ˆéƒ½ä¸æ˜¯äº’æ–¥çš„ã€‚ä½ å°½å¯ä»¥å°† JavaConfig çš„ç»„ä»¶æ‰«æå’Œè‡ªåŠ¨è£…é…å’Œ / æˆ– XML é…ç½®æ··åˆåœ¨ä¸€èµ·ã€‚å®é™…ä¸Šï¼Œå°±åƒåœ¨ 2.2.1 å°èŠ‚ä¸­æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬è‡³å°‘éœ€è¦æœ‰ä¸€ç‚¹æ˜¾å¼é…ç½®æ¥å¯ç”¨ç»„ä»¶æ‰«æå’Œè‡ªåŠ¨è£…é…ã€‚</p>
<p>å…³äºæ··åˆé…ç½®ï¼Œç¬¬ä¸€ä»¶éœ€è¦äº†è§£çš„äº‹æƒ…å°±æ˜¯åœ¨è‡ªåŠ¨è£…é…æ—¶ï¼Œå®ƒå¹¶ä¸åœ¨æ„è¦è£…é…çš„  bean æ¥è‡ªå“ªé‡Œã€‚è‡ªåŠ¨è£…é…çš„æ—¶å€™ä¼šè€ƒè™‘åˆ° Spring å®¹å™¨ä¸­æ‰€æœ‰çš„ beanï¼Œä¸ç®¡å®ƒæ˜¯åœ¨ JavaConfig æˆ– XML ä¸­å£°æ˜çš„è¿˜æ˜¯é€šè¿‡ç»„ä»¶æ‰«æè·å–åˆ°çš„ã€‚</p>
<p>ä½ å¯èƒ½ä¼šæƒ³åœ¨æ˜¾å¼é…ç½®æ—¶ï¼Œæ¯”å¦‚åœ¨ XML é…ç½®å’Œ Java é…ç½®ä¸­è¯¥å¦‚ä½•å¼•ç”¨ bean å‘¢ã€‚è®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ JavaConfig ä¸­å¼•ç”¨ XML é…ç½®çš„ beanã€‚</p>
<h4 id="åœ¨-JavaConfig-ä¸­å¼•ç”¨-XML-é…ç½®"><a href="#åœ¨-JavaConfig-ä¸­å¼•ç”¨-XML-é…ç½®" class="headerlink" title="åœ¨ JavaConfig ä¸­å¼•ç”¨ XML é…ç½®"></a>åœ¨ JavaConfig ä¸­å¼•ç”¨ XML é…ç½®</h4><p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¸´æ—¶å‡è®¾ CDPlayerConfig å·²ç»å˜å¾—æœ‰äº›ç¬¨é‡ï¼Œæˆ‘ä»¬æƒ³è¦å°†å…¶è¿›è¡Œæ‹†åˆ†ã€‚å½“ç„¶ï¼Œå®ƒç›®å‰åªå®šä¹‰äº†ä¸¤ä¸ª beanï¼Œè¿œè¿œç§°ä¸ä¸Šå¤æ‚çš„ Spring é…ç½®ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å‡è®¾ä¸¤ä¸ª bean å°±å·²ç»å¤ªå¤šäº†ã€‚</p>
<p>æˆ‘ä»¬æ‰€èƒ½å®ç°çš„ä¸€ç§æ–¹æ¡ˆå°±æ˜¯å°† BlankDisc ä» CDPlayerConfig æ‹†åˆ†å‡ºæ¥ï¼Œå®šä¹‰åˆ°å®ƒè‡ªå·±çš„ CDConfig ç±»ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;<span class="keyword">import</span> org.springframework.context.annotation.Bean;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="meta">@Configurationpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">CDConfig</span> </span>&#123;  <span class="meta">@Bean</span>  <span class="function"><span class="keyword">public</span> CompactDisc <span class="title">compactDisc</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> SgtPeppers();  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>compactDisc() æ–¹æ³•å·²ç»ä» CDPlayerConfig ä¸­ç§»é™¤æ‰äº†ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ç§æ–¹å¼å°†è¿™ä¸¤ä¸ªç±»ç»„åˆåœ¨ä¸€èµ·ã€‚ä¸€ç§æ–¹æ³•å°±æ˜¯åœ¨ CDPlayerConfig ä¸­ä½¿ç”¨ @Import æ³¨è§£å¯¼å…¥ CDConfigï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;<span class="keyword">import</span> org.springframework.context.annotation.Bean;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.context.annotation.Import;<span class="meta">@Configuration</span><span class="meta">@Import(CDConfig.class)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CDPlayerConfig</span> </span>&#123;    <span class="meta">@Bean</span>  <span class="function"><span class="keyword">public</span> CDPlayer <span class="title">cdPlayer</span><span class="params">(CompactDisc compactDisc)</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> CDPlayer(compactDisc);  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…é‡‡ç”¨ä¸€ä¸ªæ›´å¥½çš„åŠæ³•ï¼Œä¹Ÿå°±æ˜¯ä¸åœ¨ CDPlayerConfig ä¸­ä½¿ç”¨ @Importï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªæ›´é«˜çº§åˆ«çš„ SoundSystemConfigï¼Œåœ¨è¿™ä¸ªç±»ä¸­ä½¿ç”¨ @Import å°†ä¸¤ä¸ªé…ç½®ç±»ç»„åˆåœ¨ä¸€èµ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.context.annotation.Import;<span class="keyword">import</span> org.springframework.context.annotation.ImportResource;<span class="meta">@Configuration</span><span class="meta">@Import(&#123;CDPlayerConfig.class, CDConfig.class&#125;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SoundSystemConfig</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡é‡‡ç”¨å“ªç§æ–¹å¼ï¼Œæˆ‘ä»¬éƒ½å°† CDPlayer çš„é…ç½®ä¸ BlankDisc çš„é…ç½®åˆ†å¼€äº†ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å‡è®¾ï¼ˆåŸºäºæŸäº›åŸå› ï¼‰å¸Œæœ›é€šè¿‡ XML æ¥é…ç½® BlankDiscï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;compactDisc&quot;</span>        <span class="attr">class</span>=<span class="string">&quot;soundsystem.BlankDisc&quot;</span>        <span class="attr">c:_0</span>=<span class="string">&quot;Sgt. Pepper&#x27;s Lonely Hearts Club Band&quot;</span>        <span class="attr">c:_1</span>=<span class="string">&quot;The Beatles&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span>      <span class="tag">&lt;<span class="name">list</span>&gt;</span>        <span class="tag">&lt;<span class="name">value</span>&gt;</span>Sgt. Pepper&#x27;s Lonely Hearts Club Band<span class="tag">&lt;/<span class="name">value</span>&gt;</span>        <span class="tag">&lt;<span class="name">value</span>&gt;</span>With a Little Help from My Friends<span class="tag">&lt;/<span class="name">value</span>&gt;</span>        <span class="tag">&lt;<span class="name">value</span>&gt;</span>Lucy in the Sky with Diamonds<span class="tag">&lt;/<span class="name">value</span>&gt;</span>        <span class="tag">&lt;<span class="name">value</span>&gt;</span>Getting Better<span class="tag">&lt;/<span class="name">value</span>&gt;</span>        <span class="tag">&lt;<span class="name">value</span>&gt;</span>Fixing a Hole<span class="tag">&lt;/<span class="name">value</span>&gt;</span>        <span class="comment">&lt;!-- ...other tracks omitted for brevity... --&gt;</span>      <span class="tag">&lt;/<span class="name">list</span>&gt;</span>    <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span>  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ BlankDisc é…ç½®åœ¨äº† XML ä¹‹ä¸­ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è®© Spring åŒæ—¶åŠ è½½å®ƒå’Œå…¶ä»–åŸºäº Java çš„é…ç½®å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ @ImportResource æ³¨è§£ï¼Œå‡è®¾ BlankDisc å®šä¹‰åœ¨åä¸º cdconfig.xml çš„æ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶ä½äºæ ¹ç±»è·¯å¾„ä¸‹ï¼Œé‚£ä¹ˆå¯ä»¥ä¿®æ”¹ SoundSystemConfigï¼Œè®©å®ƒä½¿ç”¨@ImportResourceæ³¨è§£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span><span class="meta">@Import(CDPlayerConfig.class)</span><span class="meta">@ImportResource(&quot;classpath:cd-config.xml&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SoundSystemConfig</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸¤ä¸ª beanâ€”â€”é…ç½®åœ¨ JavaConfig ä¸­çš„ CDPlayer ä»¥åŠé…ç½®åœ¨ XML ä¸­ BlankDiscâ€”â€”éƒ½ä¼šè¢«åŠ è½½åˆ° Spring å®¹å™¨ä¹‹ä¸­ã€‚å› ä¸º CDPlayer ä¸­å¸¦æœ‰ @Bean æ³¨è§£çš„æ–¹æ³•æ¥å—ä¸€ä¸ª CompactDisc ä½œä¸ºå‚æ•°ï¼Œå› æ­¤ BlankDisc å°†ä¼šè£…é…è¿›æ¥ï¼Œæ­¤æ—¶ä¸å®ƒæ˜¯é€šè¿‡ XML é…ç½®çš„æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚</p>
<p>è®©æˆ‘ä»¬ç»§ç»­è¿™ä¸ªç»ƒä¹ ï¼Œä½†æ˜¯è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ XML ä¸­å¼•ç”¨ JavaConfig å£°æ˜çš„ beanã€‚</p>
<h4 id="åœ¨-XML-é…ç½®ä¸­å¼•ç”¨-JavaConfig"><a href="#åœ¨-XML-é…ç½®ä¸­å¼•ç”¨-JavaConfig" class="headerlink" title="åœ¨ XML é…ç½®ä¸­å¼•ç”¨ JavaConfig"></a>åœ¨ XML é…ç½®ä¸­å¼•ç”¨ JavaConfig</h4><p>å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ Spring åŸºäº XML çš„é…ç½®å¹¶ä¸”ä½ å·²ç»æ„è¯†åˆ° XML é€æ¸å˜å¾—æ— æ³•æ§åˆ¶ã€‚åƒå‰é¢ä¸€æ ·ï¼Œæˆ‘ä»¬æ­£åœ¨å¤„ç†çš„æ˜¯ä¸¤ä¸ª beanï¼Œä½†äº‹æƒ…å®é™…ä¸Šä¼šå˜å¾—æ›´åŠ ç³Ÿç³•ã€‚åœ¨è¢«æ— æ•°çš„å°–æ‹¬å·æ·¹æ²¡ä¹‹å‰ï¼Œæˆ‘ä»¬å†³å®šå°† XML é…ç½®æ–‡ä»¶è¿›è¡Œæ‹†åˆ†ã€‚</p>
<p>åœ¨ JavaConfig é…ç½®ä¸­ï¼Œæˆ‘ä»¬å·²ç»å±•ç°äº†å¦‚ä½•ä½¿ç”¨ @Import å’Œ @ImportResource æ¥æ‹†åˆ† JavaConfig ç±»ã€‚åœ¨ XML ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ import å…ƒç´ æ¥æ‹†åˆ† XML é…ç½®ã€‚</p>
<p>æ¯”å¦‚ï¼Œå‡è®¾å¸Œæœ›å°† BlankDisc bean æ‹†åˆ†åˆ°è‡ªå·±çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶åä¸º  cd-config.xmlï¼Œè¿™ä¸æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨@ImportResource æ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ XML é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ <code>&lt;import&gt;</code> å…ƒç´ æ¥å¼•ç”¨è¯¥æ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;compactDisc&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.SgtPeppers&quot;</span> /&gt;</span>          <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cdPlayer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.CDPlayer&quot;</span>        <span class="attr">c:cd-ref</span>=<span class="string">&quot;compactDisc&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å‡è®¾ä¸å†å°† BlankDisc é…ç½®åœ¨ XML ä¹‹ä¸­ï¼Œè€Œæ˜¯å°†å…¶é…ç½®åœ¨ JavaConfig ä¸­ï¼ŒCDPlayer åˆ™ç»§ç»­é…ç½®åœ¨ XML ä¸­ã€‚åŸºäº XML çš„é…ç½®è¯¥å¦‚ä½•å¼•ç”¨ä¸€ä¸ª JavaConfig ç±»å‘¢ï¼Ÿ</p>
<p>äº‹å®ä¸Šï¼Œç­”æ¡ˆå¹¶ä¸é‚£ä¹ˆç›´è§‚ã€‚<code>&lt;import&gt;</code> å…ƒç´ åªèƒ½å¯¼å…¥å…¶ä»–çš„ XML é…ç½®æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰ XML å…ƒç´ èƒ½å¤Ÿå¯¼å…¥ JavaConfig ç±»ã€‚</p>
<p>ä½†æ˜¯ï¼Œæœ‰ä¸€ä¸ªä½ å·²ç»ç†ŸçŸ¥çš„å…ƒç´ èƒ½å¤Ÿç”¨æ¥å°† Java é…ç½®å¯¼å…¥åˆ° XML é…ç½®ä¸­ï¼š<code>&lt;bean&gt;</code> å…ƒç´ ã€‚ä¸ºäº†å°† JavaConfig ç±»å¯¼å…¥åˆ° XML é…ç½®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å£°æ˜ beanï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.CDConfig&quot;</span> /&gt;</span>          <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cdPlayer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.CDPlayer&quot;</span>        <span class="attr">c:cd-ref</span>=<span class="string">&quot;compactDisc&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é‡‡ç”¨è¿™æ ·çš„æ–¹å¼ï¼Œä¸¤ç§é…ç½®â€”â€”å…¶ä¸­ä¸€ä¸ªä½¿ç”¨ XML æè¿°ï¼Œå¦ä¸€ä¸ªä½¿ç”¨ Java æè¿°â€”â€”è¢«ç»„åˆåœ¨äº†ä¸€èµ·ã€‚ç±»ä¼¼åœ°ï¼Œä½ å¯èƒ½è¿˜å¸Œæœ›åˆ›å»ºä¸€ä¸ªæ›´é«˜å±‚æ¬¡çš„é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸å£°æ˜ä»»ä½•çš„ beanï¼Œåªæ˜¯è´Ÿè´£å°†ä¸¤ä¸ªæˆ–æ›´å¤šçš„é…ç½®ç»„åˆèµ·æ¥ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å°† CDConfig bean ä»ä¹‹å‰çš„ XML æ–‡ä»¶ä¸­ç§»é™¤æ‰ï¼Œè€Œæ˜¯ä½¿ç”¨ç¬¬ä¸‰ä¸ªé…ç½®æ–‡ä»¶å°†è¿™ä¸¤ä¸ªç»„åˆåœ¨ä¸€èµ·ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.CDConfig&quot;</span> /&gt;</span>          <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;cdplayer-config.xml&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡ä½¿ç”¨ JavaConfig è¿˜æ˜¯ä½¿ç”¨ XML è¿›è¡Œè£…é…ï¼Œæˆ‘é€šå¸¸éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ¹é…ç½®ï¼ˆroot configurationï¼‰ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œå±•ç°çš„è¿™æ ·ï¼Œè¿™ä¸ªé…ç½®ä¼šå°†ä¸¤ä¸ªæˆ–æ›´å¤šçš„è£…é…ç±»å’Œ / æˆ– XML æ–‡ä»¶ç»„åˆèµ·æ¥ã€‚æˆ‘ä¹Ÿä¼šåœ¨æ ¹é…ç½®ä¸­å¯ç”¨ç»„ä»¶æ‰«æï¼ˆé€šè¿‡<code>&lt;context:component-scan&gt;</code> æˆ– @ComponentScanï¼‰ã€‚ä½ ä¼šåœ¨æœ¬ä¹¦çš„å¾ˆå¤šä¾‹å­ä¸­çœ‹åˆ°è¿™ç§æŠ€æœ¯ã€‚</p>
<h3 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>Spring æ¡†æ¶çš„æ ¸å¿ƒæ˜¯ Spring å®¹å™¨ã€‚å®¹å™¨è´Ÿè´£ç®¡ç†åº”ç”¨ä¸­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒä¼šåˆ›å»ºè¿™äº›ç»„ä»¶å¹¶ä¿è¯å®ƒä»¬çš„ä¾èµ–èƒ½å¤Ÿå¾—åˆ°æ»¡è¶³ï¼Œè¿™æ ·çš„è¯ï¼Œç»„ä»¶æ‰èƒ½å®Œæˆé¢„å®šçš„ä»»åŠ¡ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†åœ¨ Spring ä¸­è£…é… bean çš„ä¸‰ç§ä¸»è¦æ–¹å¼ï¼šè‡ªåŠ¨åŒ–é…ç½®ã€åŸºäº Java çš„æ˜¾å¼é…ç½®ä»¥åŠåŸºäº XML çš„æ˜¾å¼é…ç½®ã€‚ä¸ç®¡ä½ é‡‡ç”¨ä»€ä¹ˆæ–¹å¼ï¼Œè¿™äº›æŠ€æœ¯éƒ½æè¿°äº† Spring åº”ç”¨ä¸­çš„ç»„ä»¶ä»¥åŠè¿™äº›ç»„ä»¶ä¹‹é—´çš„å…³ç³»ã€‚</p>
<p>æˆ‘åŒæ—¶å»ºè®®å°½å¯èƒ½ä½¿ç”¨è‡ªåŠ¨åŒ–é…ç½®ï¼Œä»¥é¿å…æ˜¾å¼é…ç½®æ‰€å¸¦æ¥çš„ç»´æŠ¤æˆæœ¬ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ç¡®å®éœ€è¦æ˜¾å¼é…ç½® Spring çš„è¯ï¼Œåº”è¯¥ä¼˜å…ˆé€‰æ‹©åŸºäº Java çš„é…ç½®ï¼Œå®ƒæ¯”åŸºäº XML çš„é…ç½®æ›´åŠ å¼ºå¤§ã€ç±»å‹å®‰å…¨å¹¶ä¸”æ˜“äºé‡æ„ã€‚åœ¨æœ¬ä¹¦ä¸­çš„ä¾‹å­ä¸­ï¼Œå½“å†³å®šå¦‚ä½•è£…é…ç»„ä»¶æ—¶ï¼Œæˆ‘éƒ½ä¼šéµå¾ªè¿™æ ·çš„æŒ‡å¯¼æ„è§ã€‚</p>
<p>å› ä¸ºä¾èµ–æ³¨å…¥æ˜¯ Spring ä¸­éå¸¸é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œæ‰€ä»¥æœ¬ç« ä¸­ä»‹ç»çš„æŠ€æœ¯åœ¨æœ¬ä¹¦ä¸­æ‰€æœ‰çš„åœ°æ–¹éƒ½ä¼šç”¨åˆ°ã€‚åŸºäºè¿™äº›åŸºç¡€çŸ¥è¯†ï¼Œä¸‹ä¸€ç« å°†ä¼šä»‹ç»ä¸€äº›æ›´ä¸ºé«˜çº§çš„ bean è£…é…æŠ€æœ¯ï¼Œè¿™äº›æŠ€æœ¯èƒ½å¤Ÿè®©ä½ æ›´åŠ å……åˆ†åœ°å‘æŒ¥ Spring å®¹å™¨çš„å¨åŠ›ã€‚</p>
<h2 id="é«˜çº§è£…é…"><a href="#é«˜çº§è£…é…" class="headerlink" title="é«˜çº§è£…é…"></a>é«˜çº§è£…é…</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>Spring profile</li>
<li>æ¡ä»¶åŒ–çš„ bean å£°æ˜</li>
<li>è‡ªåŠ¨è£…é…ä¸æ­§ä¹‰æ€§</li>
<li>bean çš„ä½œç”¨åŸŸ</li>
<li>Spring è¡¨è¾¾å¼è¯­è¨€</li>
</ul>
<p>åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€äº›æœ€ä¸ºæ ¸å¿ƒçš„ bean è£…é…æŠ€æœ¯ã€‚ä½ å¯èƒ½ä¼šå‘ç°ä¸Šä¸€ç« å­¦åˆ°çš„çŸ¥è¯†æœ‰å¾ˆå¤§çš„ç”¨å¤„ã€‚ä½†æ˜¯ï¼Œbean è£…é…æ‰€æ¶‰åŠçš„é¢†åŸŸå¹¶ä¸ä»…ä»…å±€é™äºä¸Šä¸€ç« æ‰€å­¦ä¹ åˆ°çš„å†…å®¹ã€‚Spring æä¾›äº†å¤šç§æŠ€å·§ï¼Œå€ŸåŠ©å®ƒä»¬å¯ä»¥å®ç°æ›´ä¸ºé«˜çº§çš„ bean è£…é…åŠŸèƒ½ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šæ·±å…¥ä»‹ç»ä¸€äº›è¿™æ ·çš„é«˜çº§æŠ€æœ¯ã€‚æœ¬ç« ä¸­æ‰€ä»‹ç»çš„æŠ€æœ¯ä¹Ÿè®¸ä½ ä¸ä¼šå¤©å¤©éƒ½ç”¨åˆ°ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€å®ƒä»¬çš„ä»·å€¼ä¼šå› æ­¤è€Œé™ä½ã€‚</p>
<h3 id="ç¯å¢ƒä¸-profile"><a href="#ç¯å¢ƒä¸-profile" class="headerlink" title="ç¯å¢ƒä¸ profile"></a>ç¯å¢ƒä¸ profile</h3><p>åœ¨å¼€å‘è½¯ä»¶çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªå¾ˆå¤§çš„æŒ‘æˆ˜å°±æ˜¯å°†åº”ç”¨ç¨‹åºä»ä¸€ä¸ªç¯å¢ƒè¿ç§»åˆ°å¦å¤–ä¸€ä¸ªç¯å¢ƒã€‚å¼€å‘é˜¶æ®µä¸­ï¼ŒæŸäº›ç¯å¢ƒç›¸å…³åšæ³•å¯èƒ½å¹¶ä¸é€‚åˆè¿ç§»åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œç”šè‡³å³ä¾¿è¿ç§»è¿‡å»ä¹Ÿæ— æ³•æ­£å¸¸å·¥ä½œã€‚æ•°æ®åº“é…ç½®ã€åŠ å¯†ç®—æ³•ä»¥åŠä¸å¤–éƒ¨ç³»ç»Ÿçš„é›†æˆæ˜¯è·¨ç¯å¢ƒéƒ¨ç½²æ—¶ä¼šå‘ç”Ÿå˜åŒ–çš„å‡ ä¸ªå…¸å‹ä¾‹å­ã€‚</p>
<p>æ¯”å¦‚ï¼Œè€ƒè™‘ä¸€ä¸‹æ•°æ®åº“é…ç½®ã€‚åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“ï¼Œå¹¶é¢„å…ˆåŠ è½½æµ‹è¯•æ•°æ®ã€‚ä¾‹å¦‚ï¼Œåœ¨ Spring é…ç½®ç±»ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåœ¨ä¸€ä¸ªå¸¦æœ‰ @Bean æ³¨è§£çš„æ–¹æ³•ä¸Šä½¿ç”¨ EmbeddedDatabaseBuilderï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(destoryMethod=&quot;shutdown&quot;)</span><span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedDatabaseBuilder()        .addScript(<span class="string">&quot;classpath:schema.sql&quot;</span>)        .addScript(<span class="string">&quot;classpath:test-data.sql&quot;</span>)        .builder();&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¼šåˆ›å»ºä¸€ä¸ªç±»å‹ä¸º javax.sql.DataSource çš„ beanï¼Œè¿™ä¸ª bean æ˜¯å¦‚ä½•åˆ›å»ºå‡ºæ¥çš„æ‰æ˜¯æœ€æœ‰æ„æ€çš„ã€‚ä½¿ç”¨ EmbeddedDatabaseBuilder ä¼šæ­å»ºä¸€ä¸ªåµŒå…¥å¼çš„ Hypersonic æ•°æ®åº“ï¼Œå®ƒçš„æ¨¡å¼ï¼ˆschemaï¼‰å®šä¹‰åœ¨ schema.sql ä¸­ï¼Œæµ‹è¯•æ•°æ®åˆ™æ˜¯é€šè¿‡ test-data.sql åŠ è½½çš„ã€‚</p>
<p>å½“ä½ åœ¨å¼€å‘ç¯å¢ƒä¸­è¿è¡Œé›†æˆæµ‹è¯•æˆ–è€…å¯åŠ¨åº”ç”¨è¿›è¡Œæ‰‹åŠ¨æµ‹è¯•çš„æ—¶å€™ï¼Œè¿™ä¸ª DataSource æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚æ¯æ¬¡å¯åŠ¨å®ƒçš„æ—¶å€™ï¼Œéƒ½èƒ½è®©æ•°æ®åº“å¤„äºä¸€ä¸ªç»™å®šçš„çŠ¶æ€ã€‚</p>
<p>å°½ç®¡ EmbeddedDatabaseBuilder åˆ›å»ºçš„ DataSource éå¸¸é€‚äºå¼€å‘ç¯å¢ƒï¼Œä½†æ˜¯å¯¹äºç”Ÿäº§ç¯å¢ƒæ¥è¯´ï¼Œè¿™ä¼šæ˜¯ä¸€ä¸ªç³Ÿç³•çš„é€‰æ‹©ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒçš„é…ç½®ä¸­ï¼Œä½ å¯èƒ½ä¼šå¸Œæœ›ä½¿ç”¨ JNDI ä»å®¹å™¨ä¸­è·å–ä¸€ä¸ª DataSourceã€‚åœ¨è¿™æ ·åœºæ™¯ä¸­ï¼Œå¦‚ä¸‹çš„ @Bean æ–¹æ³•ä¼šæ›´åŠ åˆé€‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;    JndiObjectFactoryBean jndiObjectFactoryBean = <span class="keyword">new</span> JndiObjectFactoryBean();    jndiObjectFactoryBean.setJndiName(<span class="string">&quot;jdbc/myDS&quot;</span>);    jndiObjectFactoryBean.setResourceRef(<span class="keyword">true</span>);    jndiObjectFactoryBean.setProxyInterface(javax.sql.DataSource.class);    <span class="keyword">return</span> (DataSource) jndiObjectFactoryBean.getObject();&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ JNDI è·å– DataSource èƒ½å¤Ÿè®©å®¹å™¨å†³å®šè¯¥å¦‚ä½•åˆ›å»ºè¿™ä¸ª DataSourceï¼Œç”šè‡³åŒ…æ‹¬åˆ‡æ¢ä¸ºå®¹å™¨ç®¡ç†çš„è¿æ¥æ± ã€‚å³ä¾¿å¦‚æ­¤ï¼ŒJNDI ç®¡ç†çš„ DataSource æ›´åŠ é€‚åˆäºç”Ÿäº§ç¯å¢ƒï¼Œå¯¹äºç®€å•çš„é›†æˆå’Œå¼€å‘æµ‹è¯•ç¯å¢ƒæ¥è¯´ï¼Œè¿™ä¼šå¸¦æ¥ä¸å¿…è¦çš„å¤æ‚æ€§ã€‚</p>
<p>åŒæ—¶ï¼Œåœ¨ QA ç¯å¢ƒä¸­ï¼Œä½ å¯ä»¥é€‰æ‹©å®Œå…¨ä¸åŒçš„ DataSource é…ç½®ï¼Œå¯ä»¥é…ç½®ä¸º Commons DBCP è¿æ¥æ± ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(destoryMethod=&quot;shutdown&quot;)</span><span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;    BasicDataSource dataSource = <span class="keyword">new</span> BasicDataSource();    dataSource.setUrl(<span class="string">&quot;jdbc:h2:tcp://dbserver/~/test&quot;</span>);    dataSource.setDriverClassName(<span class="string">&quot;org.h2.Driver&quot;</span>);    dataSource.setUsername(<span class="string">&quot;sa&quot;</span>);    dataSource.setPassword(<span class="string">&quot;password&quot;</span>);    dataSource.setInitialSize(<span class="number">20</span>);    dataSource.setMaxActive(<span class="number">30</span>);    <span class="keyword">return</span> dataSource;&#125;</span><br></pre></td></tr></table></figure>

<p>æ˜¾ç„¶ï¼Œè¿™é‡Œå±•ç°çš„ä¸‰ä¸ªç‰ˆæœ¬çš„ dataSource() æ–¹æ³•äº’ä¸ç›¸åŒã€‚è™½ç„¶å®ƒä»¬éƒ½ä¼šç”Ÿæˆä¸€ä¸ªç±»å‹ä¸º javax.sql.DataSource çš„ beanï¼Œä½†å®ƒä»¬çš„ç›¸ä¼¼ç‚¹ä¹Ÿä»…é™äºæ­¤äº†ã€‚æ¯ä¸ªæ–¹æ³•éƒ½ä½¿ç”¨äº†å®Œå…¨ä¸åŒçš„ç­–ç•¥æ¥ç”Ÿæˆ DataSource beanã€‚</p>
<p>å†æ¬¡å¼ºè°ƒçš„æ˜¯ï¼Œè¿™é‡Œçš„è®¨è®ºå¹¶ä¸æ˜¯å¦‚ä½•é…ç½® DataSourceï¼ˆæˆ‘ä»¬å°†ä¼šåœ¨ç¬¬ 10 ç« æ›´è¯¦ç»†åœ°è®¨è®ºè¿™ä¸ªè¯é¢˜ï¼‰ã€‚çœ‹èµ·æ¥å¾ˆç®€å•çš„ DataSource å®é™…ä¸Šå¹¶ä¸æ˜¯é‚£ä¹ˆç®€å•ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œå®ƒè¡¨ç°äº†åœ¨ä¸åŒçš„ç¯å¢ƒä¸­æŸä¸ª bean ä¼šæœ‰æ‰€ä¸åŒã€‚æˆ‘ä»¬å¿…é¡»è¦æœ‰ä¸€ç§æ–¹æ³•æ¥é…ç½® DataSourceï¼Œä½¿å…¶åœ¨æ¯ç§ç¯å¢ƒä¸‹éƒ½ä¼šé€‰æ‹©æœ€ä¸ºåˆé€‚çš„é…ç½®ã€‚</p>
<p>å…¶ä¸­ä¸€ç§æ–¹å¼å°±æ˜¯åœ¨å•ç‹¬çš„é…ç½®ç±»ï¼ˆæˆ– XML æ–‡ä»¶ï¼‰ä¸­é…ç½®æ¯ä¸ª beanï¼Œç„¶ååœ¨æ„å»ºé˜¶æ®µï¼ˆå¯èƒ½ä¼šä½¿ç”¨ Maven çš„ profilesï¼‰ ç¡®å®šè¦å°†å“ªä¸€ä¸ªé…ç½®ç¼–è¯‘åˆ°å¯éƒ¨ç½²çš„åº”ç”¨ä¸­ã€‚è¿™ç§æ–¹å¼çš„é—®é¢˜åœ¨äºè¦ä¸ºæ¯ç§ç¯å¢ƒé‡æ–°æ„å»ºåº”ç”¨ã€‚å½“ä»å¼€å‘é˜¶æ®µè¿ç§»åˆ° QA é˜¶æ®µæ—¶ï¼Œé‡æ–°æ„å»ºä¹Ÿè®¸ç®—ä¸ä¸Šä»€ä¹ˆå¤§é—®é¢˜ã€‚ä½†æ˜¯ï¼Œä» QA é˜¶æ®µè¿ç§»åˆ°ç”Ÿäº§é˜¶æ®µæ—¶ï¼Œé‡æ–°æ„å»ºå¯èƒ½ä¼šå¼•å…¥ bug å¹¶ä¸”ä¼šåœ¨ QA å›¢é˜Ÿçš„æˆå‘˜ä¸­å¸¦æ¥ä¸å®‰çš„æƒ…ç»ªã€‚</p>
<p>å€¼å¾—åº†å¹¸çš„æ˜¯ï¼ŒSpring æ‰€æä¾›çš„è§£å†³æ–¹æ¡ˆå¹¶ä¸éœ€è¦é‡æ–°æ„å»ºã€‚</p>
<h4 id="é…ç½®-profile-bean"><a href="#é…ç½®-profile-bean" class="headerlink" title="é…ç½® profile bean"></a>é…ç½® profile bean</h4><p>Spring ä¸ºç¯å¢ƒç›¸å…³çš„ bean æ‰€æä¾›çš„è§£å†³æ–¹æ¡ˆå…¶å®ä¸æ„å»ºæ—¶çš„æ–¹æ¡ˆæ²¡æœ‰å¤ªå¤§çš„å·®åˆ«ã€‚å½“ç„¶ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦æ ¹æ®ç¯å¢ƒå†³å®šè¯¥åˆ›å»ºå“ªä¸ª bean å’Œä¸åˆ›å»ºå“ªä¸ª beanã€‚ä¸è¿‡ Spring å¹¶ä¸æ˜¯åœ¨æ„å»ºçš„æ—¶å€™åšå‡ºè¿™æ ·çš„å†³ç­–ï¼Œè€Œæ˜¯ç­‰åˆ°è¿è¡Œæ—¶å†æ¥ç¡®å®šã€‚è¿™æ ·çš„ç»“æœå°±æ˜¯åŒä¸€ä¸ªéƒ¨ç½²å•å…ƒï¼ˆå¯èƒ½ä¼šæ˜¯ WAR æ–‡ä»¶ï¼‰èƒ½å¤Ÿé€‚ç”¨äºæ‰€æœ‰çš„ç¯å¢ƒï¼Œæ²¡æœ‰å¿…è¦è¿›è¡Œé‡æ–°æ„å»ºã€‚</p>
<p>åœ¨ 3.1 ç‰ˆæœ¬ä¸­ï¼ŒSpring å¼•å…¥äº† bean profile çš„åŠŸèƒ½ã€‚è¦ä½¿ç”¨ profileï¼Œä½ é¦–å…ˆè¦å°†æ‰€æœ‰ä¸åŒçš„ bean å®šä¹‰æ•´ç†åˆ°ä¸€ä¸ªæˆ–å¤šä¸ª profile ä¹‹ä¸­ï¼Œåœ¨å°†åº”ç”¨éƒ¨ç½²åˆ°æ¯ä¸ªç¯å¢ƒæ—¶ï¼Œè¦ç¡®ä¿å¯¹åº”çš„ profile å¤„äºæ¿€æ´»ï¼ˆactiveï¼‰çš„çŠ¶æ€ã€‚</p>
<p>åœ¨ Java é…ç½®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ @Profileæ³¨è§£æŒ‡å®šæŸä¸ª bean å±äºå“ªä¸€ä¸ª profileã€‚ä¾‹å¦‚ï¼Œåœ¨é…ç½®ç±»ä¸­ï¼ŒåµŒå…¥å¼æ•°æ®åº“çš„ DataSource å¯èƒ½ä¼šé…ç½®æˆå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myapp;<span class="keyword">import</span> javax.sql.DataSource;<span class="keyword">import</span> org.springframework.context.annotation.Bean;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.context.annotation.Profile;<span class="keyword">import</span> org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseBuilder;<span class="keyword">import</span> org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseType;<span class="keyword">import</span> org.springframework.jndi.JndiObjectFactoryBean;<span class="meta">@Configuration</span><span class="meta">@Profile(&quot;dev&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfig</span> </span>&#123;      <span class="meta">@Bean(destroyMethod = &quot;shutdown&quot;)</span>    <span class="function"><span class="keyword">public</span> DataSource <span class="title">embeddedDataSource</span><span class="params">()</span> </span>&#123;        <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedDatabaseBuilder()            .setType(EmbeddedDatabaseType.H2)            .addScript(<span class="string">&quot;classpath:schema.sql&quot;</span>)            .addScript(<span class="string">&quot;classpath:test-data.sql&quot;</span>)            .build();    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘å¸Œæœ›ä½ èƒ½å¤Ÿæ³¨æ„çš„æ˜¯ @Profile æ³¨è§£åº”ç”¨åœ¨äº†ç±»çº§åˆ«ä¸Šã€‚å®ƒä¼šå‘Šè¯‰ Spring è¿™ä¸ªé…ç½®ç±»ä¸­çš„ bean åªæœ‰åœ¨ dev profile æ¿€æ´»æ—¶æ‰ä¼šåˆ›å»ºã€‚å¦‚æœ dev profile æ²¡æœ‰æ¿€æ´»çš„è¯ï¼Œé‚£ä¹ˆå¸¦æœ‰ @Bean æ³¨è§£çš„æ–¹æ³•éƒ½ä¼šè¢«å¿½ç•¥æ‰ã€‚</p>
<p>åŒæ—¶ï¼Œä½ å¯èƒ½è¿˜éœ€è¦æœ‰ä¸€ä¸ªé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒçš„é…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myapp;<span class="keyword">import</span> javax.sql.DataSource;<span class="keyword">import</span> org.springframework.context.annotation.Bean;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.context.annotation.Profile;<span class="keyword">import</span> org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseBuilder;<span class="keyword">import</span> org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseType;<span class="keyword">import</span> org.springframework.jndi.JndiObjectFactoryBean;<span class="meta">@Configuration</span><span class="meta">@Profile(&quot;prod&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfig</span> </span>&#123;    <span class="meta">@Bean</span>      <span class="function"><span class="keyword">public</span> DataSource <span class="title">jndiDataSource</span><span class="params">()</span> </span>&#123;        JndiObjectFactoryBean jndiObjectFactoryBean = <span class="keyword">new</span> JndiObjectFactoryBean();        jndiObjectFactoryBean.setJndiName(<span class="string">&quot;jdbc/myDS&quot;</span>);        jndiObjectFactoryBean.setResourceRef(<span class="keyword">true</span>);        jndiObjectFactoryBean.setProxyInterface(javax.sql.DataSource.class);        <span class="keyword">return</span> (DataSource) jndiObjectFactoryBean.getObject();    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œåªæœ‰ prod profile æ¿€æ´»çš„æ—¶å€™ï¼Œæ‰ä¼šåˆ›å»ºå¯¹åº”çš„ beanã€‚</p>
<p>åœ¨ Spring 3.1 ä¸­ï¼Œåªèƒ½åœ¨ç±»çº§åˆ«ä¸Šä½¿ç”¨ @Profile æ³¨è§£ã€‚ä¸è¿‡ï¼Œä» Spring 3.2 å¼€å§‹ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨æ–¹æ³•çº§åˆ«ä¸Šä½¿ç”¨ @Profile æ³¨è§£ï¼Œä¸ @Bean æ³¨è§£ä¸€åŒä½¿ç”¨ã€‚è¿™æ ·çš„è¯ï¼Œå°±èƒ½å°†è¿™ä¸¤ä¸ª bean çš„å£°æ˜æ”¾åˆ°åŒä¸€ä¸ªé…ç½®ç±»ä¹‹ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<center>ç¨‹åºæ¸…å•3.1ã€€@Profileæ³¨è§£åŸºäºæ¿€æ´»çš„profileå®ç°beançš„è£…é…</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myapp;<span class="keyword">import</span> javax.sql.DataSource;<span class="keyword">import</span> org.springframework.context.annotation.Bean;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.context.annotation.Profile;<span class="keyword">import</span> org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseBuilder;<span class="keyword">import</span> org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseType;<span class="keyword">import</span> org.springframework.jndi.JndiObjectFactoryBean;<span class="meta">@Configurationpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfig</span> </span>&#123;    <span class="meta">@Bean(destroyMethod = &quot;shutdown&quot;)</span>  <span class="meta">@Profile(&quot;dev&quot;)</span>  <span class="function"><span class="keyword">public</span> DataSource <span class="title">embeddedDataSource</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedDatabaseBuilder()        .setType(EmbeddedDatabaseType.H2)        .addScript(<span class="string">&quot;classpath:schema.sql&quot;</span>)        .addScript(<span class="string">&quot;classpath:test-data.sql&quot;</span>)        .build();  &#125;  <span class="meta">@Bean</span>  <span class="meta">@Profile(&quot;prod&quot;)</span>  <span class="function"><span class="keyword">public</span> DataSource <span class="title">jndiDataSource</span><span class="params">()</span> </span>&#123;    JndiObjectFactoryBean jndiObjectFactoryBean = <span class="keyword">new</span> JndiObjectFactoryBean();    jndiObjectFactoryBean.setJndiName(<span class="string">&quot;jdbc/myDS&quot;</span>);    jndiObjectFactoryBean.setResourceRef(<span class="keyword">true</span>);    jndiObjectFactoryBean.setProxyInterface(javax.sql.DataSource.class);    <span class="keyword">return</span> (DataSource) jndiObjectFactoryBean.getObject();  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼Œå°½ç®¡æ¯ä¸ª DataSource bean éƒ½è¢«å£°æ˜åœ¨ä¸€ä¸ª profile ä¸­ï¼Œå¹¶ä¸”åªæœ‰å½“è§„å®šçš„ profile æ¿€æ´»æ—¶ï¼Œç›¸åº”çš„ bean æ‰ä¼šè¢«åˆ›å»ºï¼Œä½†æ˜¯å¯èƒ½ä¼šæœ‰å…¶ä»–çš„ bean å¹¶æ²¡æœ‰å£°æ˜åœ¨ä¸€ä¸ªç»™å®šçš„ profile èŒƒå›´å†…ã€‚æ²¡æœ‰æŒ‡å®š profile çš„ bean å§‹ç»ˆéƒ½ä¼šè¢«åˆ›å»ºï¼Œä¸æ¿€æ´»å“ªä¸ª profile æ²¡æœ‰å…³ç³»ã€‚</p>
<p>åœ¨ XML ä¸­é…ç½® profile</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <code>&lt;beans&gt;</code> å…ƒç´ çš„ profile å±æ€§ï¼Œåœ¨ XML ä¸­é…ç½® profile beanã€‚ä¾‹å¦‚ï¼Œä¸ºäº†åœ¨ XML ä¸­å®šä¹‰é€‚ç”¨äºå¼€å‘é˜¶æ®µçš„åµŒå…¥å¼æ•°æ®åº“ DataSource beanï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¦‚ä¸‹æ‰€ç¤ºçš„ XML æ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>       <span class="attr">xmlns:jdbc</span>=<span class="string">&quot;http://www.springframework.org/schema/jdbc&quot;</span>       <span class="attr">xmlns:jee</span>=<span class="string">&quot;http://www.springframework.org/schema/jee&quot;</span>       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span>       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/jee                           http://www.springframework.org/schema/jee/spring-jee.xsd                           http://www.springframework.org/schema/jdbc                           http://www.springframework.org/schema/jdbc/spring-jdbc.xsd                           http://www.springframework.org/schema/beans                           http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>       <span class="attr">profile</span>=<span class="string">&quot;dev&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">jdbc:embedded-database</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">type</span>=<span class="string">&quot;H2&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;classpath:schema.sql&quot;</span> /&gt;</span>        <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;classpath:test-data.sql&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">jdbc:embedded-database</span>&gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ä¹‹ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°† profile è®¾ç½®ä¸º prodï¼Œåˆ›å»ºé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒçš„ä» JNDI è·å– çš„DataSource beanã€‚åŒæ ·ï¼Œå¯ä»¥åˆ›å»ºåŸºäºè¿æ¥æ± å®šä¹‰çš„ DataSource beanï¼Œå°†å…¶æ”¾åœ¨å¦å¤–ä¸€ä¸ª XML æ–‡ä»¶ä¸­ï¼Œå¹¶æ ‡æ³¨ä¸º qaprofileã€‚æ‰€æœ‰çš„é…ç½®æ–‡ä»¶éƒ½ä¼šæ”¾åˆ°éƒ¨ç½²å•å…ƒä¹‹ä¸­ï¼ˆå¦‚WARæ–‡ä»¶ï¼‰ï¼Œä½†æ˜¯åªæœ‰ profile å±æ€§ä¸å½“å‰æ¿€æ´» profile ç›¸åŒ¹é…çš„é…ç½®æ–‡ä»¶æ‰ä¼šè¢«ç”¨åˆ°ã€‚</p>
<p>ä½ è¿˜å¯ä»¥åœ¨æ ¹ <code>&lt;beans&gt;</code> å…ƒç´ ä¸­åµŒå¥—å®šä¹‰ <code>&lt;beans&gt;</code> å…ƒç´ ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªç¯å¢ƒéƒ½åˆ›å»ºä¸€ä¸ª profile XML æ–‡ä»¶ã€‚è¿™èƒ½å¤Ÿå°†æ‰€æœ‰çš„ profile bean å®šä¹‰æ”¾åˆ°åŒä¸€ä¸ª XML æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<center>ç¨‹åºæ¸…å• 3.2ã€€é‡å¤ä½¿ç”¨å…ƒç´ æ¥æŒ‡å®šå¤šä¸ª profile</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>       <span class="attr">xmlns:jdbc</span>=<span class="string">&quot;http://www.springframework.org/schema/jdbc&quot;</span>       <span class="attr">xmlns:jee</span>=<span class="string">&quot;http://www.springframework.org/schema/jee&quot;</span>       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span>       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/jee                           http://www.springframework.org/schema/jee/spring-jee.xsd                           http://www.springframework.org/schema/jdbc                           http://www.springframework.org/schema/jdbc/spring-jdbc.xsd                           http://www.springframework.org/schema/beans                           http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;dev&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">jdbc:embedded-database</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">type</span>=<span class="string">&quot;H2&quot;</span>&gt;</span>            <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;classpath:schema.sql&quot;</span> /&gt;</span>            <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;classpath:test-data.sql&quot;</span> /&gt;</span>        <span class="tag">&lt;/<span class="name">jdbc:embedded-database</span>&gt;</span>    <span class="tag">&lt;/<span class="name">beans</span>&gt;</span>    <span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;qa&quot;</span>&gt;</span>    	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>              <span class="attr">destory-method</span>=<span class="string">&quot;close&quot;</span>              <span class="attr">p:url</span>=<span class="string">&quot;jdbc:h2:tcp://dbserver/~/test&quot;</span>              <span class="attr">...</span>     &lt;/<span class="attr">beans</span>&gt;</span>    <span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;prod&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">jee:jndi-lookup</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span>                         <span class="attr">lazy-init</span>=<span class="string">&quot;true&quot;</span>                         <span class="attr">jndi-name</span>=<span class="string">&quot;jdbc/myDatabase&quot;</span>                         <span class="attr">resource-ref</span>=<span class="string">&quot;true&quot;</span>                         <span class="attr">proxy-interface</span>=<span class="string">&quot;javax.sql.DataSource&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">beans</span>&gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é™¤äº†æ‰€æœ‰çš„ bean å®šä¹‰åˆ°äº†åŒä¸€ä¸ªXMLæ–‡ä»¶ä¹‹ä¸­ï¼Œè¿™ç§é…ç½®æ–¹å¼ä¸å®šä¹‰åœ¨å•ç‹¬çš„XMLæ–‡ä»¶ä¸­çš„å®é™…æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚è¿™é‡Œæœ‰ä¸‰ä¸ª beanï¼Œç±»å‹éƒ½æ˜¯ javax.sql.DataSourceï¼Œå¹¶ä¸” ID éƒ½æ˜¯ dataSourceã€‚ä½†æ˜¯åœ¨è¿è¡Œæ—¶ï¼Œåªä¼šåˆ›å»ºä¸€ä¸ª beanï¼Œè¿™å–å†³äºå¤„äºæ¿€æ´»çŠ¶æ€çš„æ˜¯å“ªä¸ª profileã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šæˆ‘ä»¬è¯¥æ€æ ·æ¿€æ´»æŸä¸ª profile å‘¢ï¼Ÿ</p>
<h4 id="æ¿€æ´»-profile"><a href="#æ¿€æ´»-profile" class="headerlink" title="æ¿€æ´» profile"></a>æ¿€æ´» profile</h4><p>Spring åœ¨ç¡®å®šå“ªä¸ª profile å¤„äºæ¿€æ´»çŠ¶æ€æ—¶ï¼Œéœ€è¦ä¾èµ–ä¸¤ä¸ªç‹¬ç«‹çš„å±æ€§ï¼šspring.profiles.active å’Œ spring.profiles.defaultã€‚å¦‚æœè®¾ç½®äº† spring.profiles.active å±æ€§çš„è¯ï¼Œé‚£ä¹ˆå®ƒçš„å€¼å°±ä¼šç”¨æ¥ç¡®å®šå“ªä¸ª profile æ˜¯æ¿€æ´»çš„ã€‚ä½†å¦‚æœæ²¡æœ‰è®¾ç½® spring.profiles.active å±æ€§çš„è¯ï¼Œé‚£ Spring å°†ä¼šæŸ¥æ‰¾ spring.profiles.default çš„å€¼ã€‚å¦‚æœ spring.profiles.active å’Œ spring.profiles.default å‡æ²¡æœ‰è®¾ç½®çš„è¯ï¼Œé‚£å°±æ²¡æœ‰æ¿€æ´»çš„profileï¼Œå› æ­¤åªä¼šåˆ›å»ºé‚£äº›æ²¡æœ‰å®šä¹‰åœ¨ profile ä¸­çš„ beanã€‚</p>
<p>æœ‰å¤šç§æ–¹å¼æ¥è®¾ç½®è¿™ä¸¤ä¸ªå±æ€§ï¼š</p>
<ul>
<li>ä½œä¸º DispatcherServlet çš„åˆå§‹åŒ–å‚æ•°ï¼›</li>
<li>ä½œä¸º Web åº”ç”¨çš„ä¸Šä¸‹æ–‡å‚æ•°ï¼›</li>
<li>ä½œä¸º JNDI æ¡ç›®ï¼›</li>
<li>ä½œä¸ºç¯å¢ƒå˜é‡ï¼›</li>
<li>ä½œä¸º JVM çš„ç³»ç»Ÿå±æ€§ï¼›</li>
<li>åœ¨é›†æˆæµ‹è¯•ç±»ä¸Šï¼Œä½¿ç”¨ @ActiveProfiles æ³¨è§£è®¾ç½®ã€‚</li>
</ul>
<p>ä½ å°½å¯ä»¥é€‰æ‹© spring.profiles.active å’Œ spring.profiles.default çš„æœ€ä½³ç»„åˆæ–¹å¼ä»¥æ»¡è¶³éœ€æ±‚ï¼Œæˆ‘å°†è¿™æ ·çš„è‡ªä¸»æƒç•™ç»™è¯»è€…ã€‚</p>
<p>æˆ‘æ‰€å–œæ¬¢çš„ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ DispatcherServlet çš„å‚æ•°å°† spring.profiles.default è®¾ç½®ä¸ºå¼€å‘ç¯å¢ƒçš„ profileï¼Œæˆ‘ä¼šåœ¨ Servlet ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œè®¾ç½®ï¼ˆä¸ºäº†å…¼é¡¾åˆ° ContextLoaderListenerï¼‰ã€‚ä¾‹å¦‚ï¼Œåœ¨ Web åº”ç”¨ä¸­ï¼Œè®¾ç½® spring.profiles.default çš„ web.xml æ–‡ä»¶ä¼šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<center>ç¨‹åºæ¸…å• 3.3ã€€åœ¨ Web åº”ç”¨çš„ web.xml æ–‡ä»¶ä¸­è®¾ç½®é»˜è®¤çš„ profile</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">version</span>=<span class="string">&quot;2.5&quot;</span>         <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javeee&quot;</span>         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javeee                             http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span>    	<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/spring/root-context.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span>        <span class="tag">&lt;<span class="name">context-param</span>&gt;</span>        <span class="comment">&lt;!--ä¸ºä¸Šä¸‹æ–‡è®¾ç½®é»˜è®¤çš„ profile--&gt;</span>        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>spring.profiles.default<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span>        <span class="tag">&lt;<span class="name">listener</span>&gt;</span>    	<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>        	org.springramework.web.context.ContextLoaderListener        <span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span>    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span>    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span>        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>appServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>        	org.springframework.web.servlet.DispatcherServlet        <span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span>        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span>        	<span class="comment">&lt;!--ä¸º servlet è®¾ç½®é»˜è®¤çš„ profile--&gt;</span>            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>spring.profiles.default<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span>        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span>    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span>    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span>    	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>appServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span>	</span><br></pre></td></tr></table></figure>

<p>æŒ‰ç…§è¿™ç§æ–¹å¼è®¾ç½® spring.profiles.defaultï¼Œæ‰€æœ‰çš„å¼€å‘äººå‘˜éƒ½èƒ½ä»ç‰ˆæœ¬æ§åˆ¶è½¯ä»¶ä¸­è·å¾—åº”ç”¨ç¨‹åºæºç ï¼Œå¹¶ä½¿ç”¨å¼€å‘ç¯å¢ƒçš„è®¾ç½®ï¼ˆå¦‚åµŒå…¥å¼æ•°æ®åº“ï¼‰è¿è¡Œä»£ç ï¼Œè€Œä¸éœ€è¦ä»»ä½•é¢å¤–çš„é…ç½®ã€‚</p>
<p>å½“åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° QAã€ç”Ÿäº§æˆ–å…¶ä»–ç¯å¢ƒä¹‹ä¸­æ—¶ï¼Œè´Ÿè´£éƒ¨ç½²çš„äººæ ¹æ®æƒ…å†µä½¿ç”¨ç³»ç»Ÿå±æ€§ã€ç¯å¢ƒå˜é‡æˆ– JNDI è®¾ç½® spring.profiles.active å³å¯ã€‚å½“è®¾ç½® spring.profiles.active ä»¥åï¼Œè‡³äº spring.profiles.default ç½®æˆä»€ä¹ˆå€¼å°±å·²ç»æ— æ‰€è°“äº†ï¼›ç³»ç»Ÿä¼šä¼˜å…ˆä½¿ç”¨ spring.profiles.active ä¸­æ‰€è®¾ç½®çš„ profileã€‚</p>
<p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œåœ¨ spring.profiles.active å’Œ spring.profiles.default ä¸­ï¼Œprofile ä½¿ç”¨çš„éƒ½æ˜¯å¤æ•°å½¢å¼ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åŒæ—¶æ¿€æ´»å¤šä¸ª profileï¼Œè¿™å¯ä»¥é€šè¿‡åˆ—å‡ºå¤šä¸ª profile åç§°ï¼Œå¹¶ä»¥é€—å·åˆ†éš”æ¥å®ç°ã€‚å½“ç„¶ï¼ŒåŒæ—¶å¯ç”¨ dev å’Œ prod profile å¯èƒ½ä¹Ÿæ²¡æœ‰å¤ªå¤§çš„æ„ä¹‰ï¼Œä¸è¿‡ä½ å¯ä»¥åŒæ—¶è®¾ç½®å¤šä¸ªå½¼æ­¤ä¸ç›¸å…³çš„ profileã€‚</p>
<p>ä½¿ç”¨ profile è¿›è¡Œæµ‹è¯•</p>
<p>å½“è¿è¡Œé›†æˆæµ‹è¯•æ—¶ï¼Œé€šå¸¸ä¼šå¸Œæœ›é‡‡ç”¨ä¸ç”Ÿäº§ç¯å¢ƒï¼ˆæˆ–è€…æ˜¯ç”Ÿäº§ç¯å¢ƒçš„éƒ¨åˆ†å­é›†ï¼‰ç›¸åŒçš„é…ç½®è¿›è¡Œæµ‹è¯•ã€‚ä½†æ˜¯ï¼Œå¦‚æœé…ç½®ä¸­çš„ bean å®šä¹‰åœ¨äº† profile ä¸­ï¼Œé‚£ä¹ˆåœ¨è¿è¡Œæµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦æœ‰ä¸€ç§æ–¹å¼æ¥å¯ç”¨åˆé€‚çš„ profileã€‚</p>
<p>Spring æä¾›äº† @ActiveProfiles æ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥æŒ‡å®šè¿è¡Œæµ‹è¯•æ—¶è¦æ¿€æ´»å“ªä¸ª profileã€‚åœ¨é›†æˆæµ‹è¯•æ—¶ï¼Œé€šå¸¸æƒ³è¦æ¿€æ´»çš„æ˜¯å¼€å‘ç¯å¢ƒçš„ profileã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„æµ‹è¯•ç±»ç‰‡æ®µå±•ç°äº†ä½¿ç”¨ @ActiveProfiles æ¿€æ´» dev profileï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span><span class="meta">@ContextConfiguration(classes=&#123;PersistenceTestConfig.class&#125;)</span><span class="meta">@ActiveProfiles(&quot;dev&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersistenceTest</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ¡ä»¶åŒ–åˆ›å»º bean æ–¹é¢ï¼ŒSpring çš„ profile æœºåˆ¶æ˜¯ä¸€ç§å¾ˆæ£’çš„æ–¹æ³•ï¼Œè¿™é‡Œçš„æ¡ä»¶è¦åŸºäºå“ªä¸ª profile å¤„äºæ¿€æ´»çŠ¶æ€æ¥åˆ¤æ–­ã€‚Spring 4.0 ä¸­æä¾›äº†ä¸€ç§æ›´ä¸ºé€šç”¨çš„æœºåˆ¶æ¥å®ç°æ¡ä»¶åŒ–çš„ bean å®šä¹‰ï¼Œåœ¨è¿™ç§æœºåˆ¶ä¹‹ä¸­ï¼Œæ¡ä»¶å®Œå…¨ç”±ä½ æ¥ç¡®å®šã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ Spring 4 å’Œ @Conditional æ³¨è§£å®šä¹‰æ¡ä»¶åŒ–çš„ beanã€‚</p>
<h3 id="æ¡ä»¶åŒ–çš„-bean"><a href="#æ¡ä»¶åŒ–çš„-bean" class="headerlink" title="æ¡ä»¶åŒ–çš„ bean"></a>æ¡ä»¶åŒ–çš„ bean</h3><p>å‡è®¾ä½ å¸Œæœ›ä¸€ä¸ªæˆ–å¤šä¸ª bean åªæœ‰åœ¨åº”ç”¨çš„ç±»è·¯å¾„ä¸‹åŒ…å«ç‰¹å®šçš„åº“æ—¶æ‰åˆ›å»ºã€‚æˆ–è€…æˆ‘ä»¬å¸Œæœ›æŸä¸ª bean åªæœ‰å½“å¦å¤–æŸä¸ªç‰¹å®šçš„ bean ä¹Ÿå£°æ˜äº†ä¹‹åæ‰ä¼šåˆ›å»ºã€‚æˆ‘ä»¬è¿˜å¯èƒ½è¦æ±‚åªæœ‰æŸä¸ªç‰¹å®šçš„ç¯å¢ƒå˜é‡è®¾ç½®ä¹‹åï¼Œæ‰ä¼šåˆ›å»ºæŸä¸ª beanã€‚</p>
<p>Spring 4 å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ @Conditional æ³¨è§£ï¼Œå®ƒå¯ä»¥ç”¨åˆ°å¸¦æœ‰ @Bean æ³¨è§£çš„æ–¹æ³•ä¸Šã€‚å¦‚æœç»™å®šçš„æ¡ä»¶è®¡ç®—ç»“æœä¸º trueï¼Œå°±ä¼šåˆ›å»ºè¿™ä¸ª beanï¼Œå¦åˆ™çš„è¯ï¼Œè¿™ä¸ª bean ä¼šè¢«å¿½ç•¥ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªåä¸º MagicBean çš„ç±»ï¼Œæˆ‘ä»¬å¸Œæœ›åªæœ‰è®¾ç½®äº† magic ç¯å¢ƒå±æ€§çš„æ—¶å€™ï¼ŒSpring æ‰ä¼šå®ä¾‹åŒ–è¿™ä¸ªç±»ã€‚å¦‚æœç¯å¢ƒä¸­æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆ MagicBean å°†ä¼šè¢«å¿½ç•¥ã€‚åœ¨ç¨‹åºæ¸…å• 3.4 æ‰€å±•ç°çš„é…ç½®ä¸­ï¼Œä½¿ç”¨ @Conditional æ³¨è§£æ¡ä»¶åŒ–åœ°é…ç½®äº† MagicBeanã€‚</p>
<center>ç¨‹åºæ¸…å• 3.4ã€€æ¡ä»¶åŒ–åœ°é…ç½® bean</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span><span class="meta">@Conditional(MagicExistCondition.class)</span><span class="function"><span class="keyword">public</span> MagicBean <span class="title">magicBean</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> MagicBean;&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œ@Conditional ä¸­ç»™å®šäº†ä¸€ä¸ª Classï¼Œå®ƒæŒ‡æ˜äº†æ¡ä»¶ â€”â€” åœ¨æœ¬ä¾‹ä¸­ï¼Œä¹Ÿå°±æ˜¯ MagicExistsConditionã€‚@Conditional å°†ä¼šé€šè¿‡ Condition æ¥å£è¿›è¡Œæ¡ä»¶å¯¹æ¯”ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Condition</span> </span>&#123;    <span class="function"><span class="keyword">boolean</span> <span class="title">matches</span> <span class="params">(ConditionContext ctxt, AnnotatedTypeMetadata metadata)</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®ç»™ @Conditional çš„ç±»å¯ä»¥æ˜¯ä»»æ„å®ç°äº† Condition æ¥å£çš„ç±»å‹ã€‚å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªæ¥å£å®ç°èµ·æ¥å¾ˆç®€å•ç›´æ¥ï¼Œåªéœ€æä¾› matches() æ–¹æ³•çš„å®ç°å³å¯ã€‚å¦‚æœmatches() æ–¹æ³•è¿”å› trueï¼Œé‚£ä¹ˆå°±ä¼šåˆ›å»ºå¸¦æœ‰ @Conditional æ³¨è§£çš„ beanã€‚å¦‚æœ matches() æ–¹æ³•è¿”å› falseï¼Œå°†ä¸ä¼šåˆ›å»ºè¿™äº› beanã€‚</p>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»º Condition çš„å®ç°å¹¶æ ¹æ®ç¯å¢ƒä¸­æ˜¯å¦å­˜åœ¨ magic å±æ€§æ¥åšå‡ºå†³ç­–ã€‚ç¨‹åºæ¸…å• 3.5 å±•ç°äº† MagicExistsConditionï¼Œè¿™æ˜¯å®Œæˆè¯¥åŠŸèƒ½çš„Conditionå®ç°ç±»ï¼š</p>
<center>ç¨‹åºæ¸…å• 3.5ã€€åœ¨ Condition ä¸­æ£€æŸ¥æ˜¯å¦å­˜åœ¨ magic å±æ€§</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.restfun;<span class="keyword">import</span> org.springframework.context.annotation.Condition;<span class="keyword">import</span> org.springframework.context.annotation.ConditionContext;<span class="keyword">import</span> org.springframework.core.env.Environment;<span class="keyword">import</span> org.springframework.core.type.AnnotatedTypeMetadata;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MagicExistsCondition</span> <span class="keyword">implements</span> <span class="title">Condition</span> </span>&#123;  <span class="meta">@Override</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> </span>&#123;    Environment env = context.getEnvironment();    <span class="keyword">return</span> env.containsProperty(<span class="string">&quot;magic&quot;</span>);  &#125;  &#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ç¨‹åºæ¸…å•ä¸­ï¼Œmatches() æ–¹æ³•å¾ˆç®€å•ä½†åŠŸèƒ½å¼ºå¤§ã€‚å®ƒé€šè¿‡ç»™å®šçš„ ConditionContext å¯¹è±¡è¿›è€Œå¾—åˆ° Environment å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨è¿™ä¸ªå¯¹è±¡æ£€æŸ¥ç¯å¢ƒä¸­æ˜¯å¦å­˜åœ¨åä¸º magic çš„ç¯å¢ƒå±æ€§ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå±æ€§çš„å€¼æ˜¯ä»€ä¹ˆæ— æ‰€è°“ï¼Œåªè¦å±æ€§å­˜åœ¨å³å¯æ»¡è¶³è¦æ±‚ã€‚å¦‚æœæ»¡è¶³è¿™ä¸ªæ¡ä»¶çš„è¯ï¼Œmatches() æ–¹æ³•å°±ä¼šè¿”å› trueã€‚æ‰€å¸¦æ¥çš„ç»“æœå°±æ˜¯æ¡ä»¶èƒ½å¤Ÿå¾—åˆ°æ»¡è¶³ï¼Œæ‰€æœ‰ @Conditional æ³¨è§£ä¸Šå¼•ç”¨ MagicExistsCondition çš„ bean éƒ½ä¼šè¢«åˆ›å»ºã€‚</p>
<p>è¯è¯´å›æ¥ï¼Œå¦‚æœè¿™ä¸ªå±æ€§ä¸å­˜åœ¨çš„è¯ï¼Œå°±æ— æ³•æ»¡è¶³æ¡ä»¶ï¼Œmatches() æ–¹æ³•ä¼šè¿”å› falseï¼Œè¿™äº› bean éƒ½ä¸ä¼šè¢«åˆ›å»ºã€‚</p>
<p>MagicExistsCondition ä¸­åªæ˜¯ä½¿ç”¨äº† ConditionContext å¾—åˆ°çš„ Environmentï¼Œä½† Condition å®ç°çš„è€ƒé‡å› ç´ å¯èƒ½ä¼šæ¯”è¿™æ›´å¤šã€‚matches() æ–¹æ³•ä¼šå¾—åˆ°ConditionContext å’Œ AnnotatedTypeMetadata å¯¹è±¡ç”¨æ¥åšå‡ºå†³ç­–ã€‚</p>
<p>ConditionContext æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¤§è‡´å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ConditionContext</span> </span>&#123;	<span class="function">BeanDefinitionRegistry <span class="title">getRegistry</span><span class="params">()</span></span>;	<span class="meta">@Nullable</span>	<span class="function">ConfigurableListableBeanFactory <span class="title">getBeanFactory</span><span class="params">()</span></span>;	<span class="function">Environment <span class="title">getEnvironment</span><span class="params">()</span></span>;	<span class="function">ResourceLoader <span class="title">getResourceLoader</span><span class="params">()</span></span>;	<span class="meta">@Nullable</span>	<span class="function">ClassLoader <span class="title">getClassLoader</span><span class="params">()</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ ConditionContextï¼Œæˆ‘ä»¬å¯ä»¥åšåˆ°å¦‚ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li><p>å€ŸåŠ© getRegistry() è¿”å›çš„ BeanDefinitionRegistry æ£€æŸ¥ bean å®šä¹‰ï¼›</p>
</li>
<li><p>å€ŸåŠ© getBeanFactory() è¿”å›çš„ ConfigurableListableBeanFactory æ£€æŸ¥ bean æ˜¯å¦å­˜åœ¨ï¼Œç”šè‡³æ¢æŸ¥ bean çš„å±æ€§ï¼›</p>
</li>
<li><p>å€ŸåŠ© getEnvironment() è¿”å›çš„ Environment æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦å­˜åœ¨ä»¥åŠå®ƒçš„å€¼æ˜¯ä»€ä¹ˆï¼›</p>
</li>
<li><p>è¯»å–å¹¶æ¢æŸ¥ getResourceLoader() è¿”å›çš„ ResourceLoader æ‰€åŠ è½½çš„èµ„æºï¼›</p>
</li>
<li><p>å€ŸåŠ© getClassLoader() è¿”å›çš„ ClassLoader åŠ è½½å¹¶æ£€æŸ¥ç±»æ˜¯å¦å­˜åœ¨ã€‚</p>
</li>
</ul>
<p>AnnotatedTypeMetadata åˆ™èƒ½å¤Ÿè®©æˆ‘ä»¬æ£€æŸ¥å¸¦æœ‰ @Bean æ³¨è§£çš„æ–¹æ³•ä¸Šè¿˜æœ‰ä»€ä¹ˆå…¶ä»–çš„æ³¨è§£ã€‚åƒ ConditionContext ä¸€æ ·ï¼ŒAnnotatedTypeMetadata ä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ã€‚å®ƒå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AnnotatedTypeMetadata</span> </span>&#123;    <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">isAnnotated</span><span class="params">(String annotationName)</span></span>;    <span class="function"><span class="keyword">default</span> Map&lt;String, Object&gt; <span class="title">getAnnotationAttributes</span><span class="params">(String annotationName)</span></span>;    <span class="function"><span class="keyword">default</span> Map&lt;String, Object&gt; <span class="title">getAnnotationAttributes</span><span class="params">(String annotationName, <span class="keyword">boolean</span> classValuesAsString)</span></span>;    <span class="function"><span class="keyword">default</span> MultiValueMap&lt;String, Object&gt; <span class="title">getAllAnnotationAttributes</span><span class="params">(String annotationName)</span></span>;    <span class="function"><span class="keyword">default</span> MultiValueMap&lt;String, Object&gt; <span class="title">getAllAnnotationAttributes</span><span class="params">(String annotationName, <span class="keyword">boolean</span> classValuesAsString)</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>å€ŸåŠ© isAnnotated() æ–¹æ³•ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåˆ¤æ–­å¸¦æœ‰ @Bean æ³¨è§£çš„æ–¹æ³•æ˜¯ä¸æ˜¯è¿˜æœ‰å…¶ä»–ç‰¹å®šçš„æ³¨è§£ã€‚å€ŸåŠ©å…¶ä»–çš„é‚£äº›æ–¹æ³•ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ£€æŸ¥ @Bean æ³¨è§£çš„æ–¹æ³•ä¸Šå…¶ä»–æ³¨è§£çš„å±æ€§ã€‚</p>
<p>ä» Spring 4 å¼€å§‹ï¼Œ@Profile æ³¨è§£è¿›è¡Œäº†é‡æ„ï¼Œä½¿å…¶åŸºäº @Conditional å’Œ Condition å®ç°ã€‚ä½œä¸ºå¦‚ä½•ä½¿ç”¨ @Conditional å’Œ Condition çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åœ¨ Spring 4 ä¸­ï¼Œ@Profile æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span><span class="meta">@Documented</span><span class="meta">@Conditional(ProfileCondition.class)</span><span class="keyword">public</span> <span class="meta">@interface</span> Profile &#123;    String[] value();&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼š@Profile æœ¬èº«ä¹Ÿä½¿ç”¨äº† @Conditional æ³¨è§£ï¼Œå¹¶ä¸”å¼•ç”¨ ProfileCondition ä½œä¸º Condition å®ç°ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œ ProfileCondition å®ç°äº† Condition æ¥å£ï¼Œå¹¶ä¸”åœ¨åšå‡ºå†³ç­–çš„è¿‡ç¨‹ä¸­ï¼Œè€ƒè™‘åˆ°äº† ConditionContext å’Œ AnnotatedTypeMetadata ä¸­çš„å¤šä¸ªå› ç´ ã€‚</p>
</blockquote>
<center>ç¨‹åºæ¸…å• 3.6ã€€ProfileCondition æ£€æŸ¥æŸä¸ª bean profile æ˜¯å¦å¯ç”¨</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProfileCondition</span> <span class="keyword">implements</span> <span class="title">Condition</span> </span>&#123;    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(ConditonContext context,                            AnnotatedTypeMetadata metadata)</span> </span>&#123;        <span class="keyword">if</span> (context.getEnvironment() != <span class="keyword">null</span>) &#123;            MultiValueMap&lt;String, object&gt; attrs =                 metadata.getAllAnnotationAttributes(Profile.class.getname());            <span class="keyword">if</span> (attrs != <span class="keyword">null</span>) &#123;                <span class="keyword">for</span> (Object value : attrs.get(<span class="string">&quot;value&quot;</span>)) &#123;                    <span class="keyword">if</span> (context.getEnvironment().acceptsProfiles(((String[]) value))) &#123;                        <span class="keyword">return</span> <span class="keyword">true</span>;                    &#125;                &#125;                <span class="keyword">return</span> <span class="keyword">false</span>;            &#125;        &#125;        <span class="keyword">return</span> <span class="keyword">true</span>;    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒProfileCondition é€šè¿‡ AnnotatedTypeMetadata å¾—åˆ°äº†ç”¨äº @Profile æ³¨è§£çš„æ‰€æœ‰å±æ€§ã€‚å€ŸåŠ©è¯¥ä¿¡æ¯ï¼Œå®ƒä¼šæ˜ç¡®åœ°æ£€æŸ¥ value å±æ€§ï¼Œè¯¥å±æ€§åŒ…å«äº† bean çš„ profile åç§°ã€‚ç„¶åï¼Œå®ƒæ ¹æ®é€šè¿‡ ConditionContext å¾—åˆ°çš„ Environment æ¥æ£€æŸ¥ï¼»å€ŸåŠ© acceptsProfiles() æ–¹æ³•ï¼½è¯¥ profile æ˜¯å¦å¤„äºæ¿€æ´»çŠ¶æ€ã€‚</p>
<h3 id="å¤„ç†è‡ªåŠ¨è£…é…çš„æ­§ä¹‰æ€§"><a href="#å¤„ç†è‡ªåŠ¨è£…é…çš„æ­§ä¹‰æ€§" class="headerlink" title="å¤„ç†è‡ªåŠ¨è£…é…çš„æ­§ä¹‰æ€§"></a>å¤„ç†è‡ªåŠ¨è£…é…çš„æ­§ä¹‰æ€§</h3><p>åœ¨ç¬¬ 2 ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°å¦‚ä½•ä½¿ç”¨è‡ªåŠ¨è£…é…è®© Spring å®Œå…¨è´Ÿè´£å°† bean å¼•ç”¨æ³¨å…¥åˆ°æ„é€ å‚æ•°å’Œå±æ€§ä¸­ã€‚è‡ªåŠ¨è£…é…èƒ½å¤Ÿæä¾›å¾ˆå¤§çš„å¸®åŠ©ï¼Œå› ä¸ºå®ƒä¼šå‡å°‘è£…é…åº”ç”¨ç¨‹åºç»„ä»¶æ—¶æ‰€éœ€è¦çš„æ˜¾å¼é…ç½®çš„æ•°é‡ã€‚</p>
<p>ä¸è¿‡ï¼Œä»…æœ‰ä¸€ä¸ª bean åŒ¹é…æ‰€éœ€çš„ç»“æœæ—¶ï¼Œè‡ªåŠ¨è£…é…æ‰æ˜¯æœ‰æ•ˆçš„ã€‚å¦‚æœä¸ä»…æœ‰ä¸€ä¸ª bean èƒ½å¤ŸåŒ¹é…ç»“æœçš„è¯ï¼Œè¿™ç§æ­§ä¹‰æ€§ä¼šé˜»ç¢ Spring è‡ªåŠ¨è£…é…å±æ€§ã€æ„é€ å™¨å‚æ•°æˆ–æ–¹æ³•å‚æ•°ã€‚</p>
<p>ä¸ºäº†é˜è¿°è‡ªåŠ¨è£…é…çš„æ­§ä¹‰æ€§ï¼Œå‡è®¾æˆ‘ä»¬ä½¿ç”¨ @Autowired æ³¨è§£æ ‡æ³¨äº† setDessert() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowiredpublic</span> <span class="function"><span class="keyword">void</span> <span class="title">setDessert</span><span class="params">(Dessert dessert)</span> </span>&#123;    <span class="keyword">this</span>.dessert = dessert;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼ŒDessert æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¹¶ä¸”æœ‰ä¸‰ä¸ªç±»å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œåˆ†åˆ«ä¸º Cakeã€Cookies å’Œ IceCreamï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Componentpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">Cake</span> <span class="keyword">implements</span> <span class="title">Dessert</span> </span>&#123;&#125;<span class="meta">@Componentpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">Cookies</span>  <span class="keyword">implements</span> <span class="title">Dessert</span> </span>&#123;&#125;<span class="meta">@Componentpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">IceCream</span> <span class="keyword">implements</span> <span class="title">Dessert</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºè¿™ä¸‰ä¸ªå®ç°å‡ä½¿ç”¨äº† @Component æ³¨è§£ï¼Œåœ¨ç»„ä»¶æ‰«æçš„æ—¶å€™ï¼Œèƒ½å¤Ÿå‘ç°å®ƒä»¬å¹¶å°†å…¶åˆ›å»ºä¸º Spring åº”ç”¨ä¸Šä¸‹æ–‡é‡Œé¢çš„  beanã€‚ç„¶åï¼Œå½“ Spring è¯•å›¾è‡ªåŠ¨è£…é… setDessert() ä¸­çš„ Dessert å‚æ•°æ—¶ï¼Œå®ƒå¹¶æ²¡æœ‰å”¯ä¸€ã€æ— æ­§ä¹‰çš„å¯é€‰å€¼ã€‚åœ¨ä»å¤šç§ç”œç‚¹ä¸­åšå‡ºé€‰æ‹©æ—¶ï¼Œå°½ç®¡å¤§å¤šæ•°äººå¹¶ä¸ä¼šæœ‰ä»€ä¹ˆå›°éš¾ï¼Œä½†æ˜¯ Spring å´æ— æ³•åšå‡ºé€‰æ‹©ã€‚Springæ­¤æ—¶åˆ«æ— ä»–æ³•ï¼Œåªå¥½å®£å‘Šå¤±è´¥å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚æ›´ç²¾ç¡®åœ°è®²ï¼ŒSpring ä¼šæŠ›å‡º NoUniqueBeanDefinitionExceptionï¼š</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211122154454794.png" alt="image-20211014100052480"></p>
<p>å½“ç„¶ï¼Œä½¿ç”¨åƒç”œç‚¹çš„æ ·ä¾‹æ¥é˜è¿°è‡ªåŠ¨è£…é…åœ¨é‡åˆ°æ­§ä¹‰æ€§æ—¶æ‰€é¢ä¸´çš„é—®é¢˜å¤šå°‘æœ‰äº›ç‰µå¼ºã€‚åœ¨å®é™…ä¸­ï¼Œè‡ªåŠ¨è£…é…æ­§ä¹‰æ€§çš„é—®é¢˜å…¶å®æ¯”ä½ æƒ³è±¡ä¸­çš„æ›´ä¸ºç½•è§ã€‚å°±ç®—è¿™ç§æ­§ä¹‰æ€§ç¡®å®æ˜¯ä¸ªé—®é¢˜ï¼Œä½†æ›´å¸¸è§çš„æƒ…å†µæ˜¯ç»™å®šçš„ç±»å‹åªæœ‰ä¸€ä¸ªå®ç°ç±»ï¼Œå› æ­¤è‡ªåŠ¨è£…é…èƒ½å¤Ÿå¾ˆå¥½åœ°è¿è¡Œã€‚</p>
<p>ä½†æ˜¯ï¼Œå½“ç¡®å®å‘ç”Ÿæ­§ä¹‰æ€§çš„æ—¶å€™ï¼ŒSpring æä¾›äº†å¤šç§å¯é€‰æ–¹æ¡ˆæ¥è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚ä½ å¯ä»¥å°†å¯é€‰ beanä¸­ çš„æŸä¸€ä¸ªè®¾ä¸ºé¦–é€‰ï¼ˆprimaryï¼‰çš„ beanï¼Œæˆ–è€…ä½¿ç”¨é™å®šç¬¦ï¼ˆqualifierï¼‰æ¥å¸®åŠ© Spring å°†å¯é€‰çš„ bean çš„èŒƒå›´ç¼©å°åˆ°åªæœ‰ä¸€ä¸ª beanã€‚</p>
<h4 id="æ ‡ç¤ºé¦–é€‰çš„-bean"><a href="#æ ‡ç¤ºé¦–é€‰çš„-bean" class="headerlink" title="æ ‡ç¤ºé¦–é€‰çš„ bean"></a>æ ‡ç¤ºé¦–é€‰çš„ bean</h4><p>åœ¨å£°æ˜ bean çš„æ—¶å€™ï¼Œé€šè¿‡å°†å…¶ä¸­ä¸€ä¸ªå¯é€‰çš„ bean è®¾ç½®ä¸ºé¦–é€‰ï¼ˆprimaryï¼‰bean èƒ½å¤Ÿé¿å…è‡ªåŠ¨è£…é…æ—¶çš„æ­§ä¹‰æ€§ã€‚å½“é‡åˆ°æ­§ä¹‰æ€§çš„æ—¶å€™ï¼ŒSpring å°†ä¼šä½¿ç”¨é¦–é€‰çš„ beanï¼Œè€Œä¸æ˜¯å…¶ä»–å¯é€‰çš„ beanã€‚</p>
<p>åœ¨ Spring ä¸­ï¼Œå¯ä»¥é€šè¿‡ @Primary æ¥è¡¨è¾¾æœ€å–œæ¬¢çš„æ–¹æ¡ˆã€‚@Primary èƒ½å¤Ÿä¸ @Component ç»„åˆç”¨åœ¨ç»„ä»¶æ‰«æçš„ bean ä¸Šï¼Œä¹Ÿå¯ä»¥ä¸ @Bean ç»„åˆç”¨åœ¨ Java é…ç½®çš„ bean å£°æ˜ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="meta">@Primarypublic</span> <span class="class"><span class="keyword">class</span> <span class="title">IceCream</span> <span class="keyword">implements</span> <span class="title">Dessert</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼Œå¦‚æœä½ é€šè¿‡ Java é…ç½®æ˜¾å¼åœ°å£°æ˜ IceCreamï¼Œé‚£ä¹ˆ @Bean æ–¹æ³•åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span><span class="meta">@Primarypublic</span> <span class="function">Dessert <span class="title">iceCream</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> IceCream();&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ ä½¿ç”¨ XML é…ç½® bean çš„è¯ï¼ŒåŒæ ·å¯ä»¥å®ç°è¿™æ ·çš„åŠŸèƒ½ã€‚<code>&lt;bean&gt;</code> å…ƒç´ æœ‰ä¸€ä¸ª primary å±æ€§ç”¨æ¥æŒ‡å®šé¦–é€‰çš„ beanï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;iceCream&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.dessertteater.IceCream&quot;</span> <span class="attr">primary</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ï¼Œå¦‚æœä½ æ ‡ç¤ºäº†ä¸¤ä¸ªæˆ–æ›´å¤šçš„é¦–é€‰ beanï¼Œé‚£ä¹ˆå®ƒå°±æ— æ³•æ­£å¸¸å·¥ä½œäº†ã€‚æ¯”å¦‚ï¼Œå‡è®¾ Cake ç±»å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="meta">@Primarypublic</span> <span class="class"><span class="keyword">class</span> <span class="title">Cake</span> <span class="keyword">implements</span> <span class="title">Dessert</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæœ‰ä¸¤ä¸ªé¦–é€‰çš„ Dessert beanï¼šCake å’Œ IceCreamã€‚è¿™å¸¦æ¥äº†æ–°çš„æ­§ä¹‰æ€§é—®é¢˜ã€‚å°±åƒ Spring æ— æ³•ä»å¤šä¸ªå¯é€‰çš„ bean ä¸­åšå‡ºé€‰æ‹©ä¸€æ ·ï¼Œå®ƒä¹Ÿæ— æ³•ä»å¤šä¸ªé¦–é€‰çš„ bean ä¸­åšå‡ºé€‰æ‹©ã€‚æ˜¾ç„¶ï¼Œå¦‚æœä¸æ­¢ä¸€ä¸ª bean è¢«è®¾ç½®æˆäº†é¦–é€‰ beanï¼Œé‚£å®é™…ä¸Šä¹Ÿå°±æ˜¯æ²¡æœ‰é¦–é€‰ bean äº†ã€‚</p>
<p>å°±è§£å†³æ­§ä¹‰æ€§é—®é¢˜è€Œè¨€ï¼Œé™å®šç¬¦æ˜¯ä¸€ç§æ›´ä¸ºå¼ºå¤§çš„æœºåˆ¶ï¼Œä¸‹é¢å°±å°†å¯¹å…¶è¿›è¡Œä»‹ç»ã€‚</p>
<h4 id="é™å®šè‡ªåŠ¨è£…é…çš„-bean"><a href="#é™å®šè‡ªåŠ¨è£…é…çš„-bean" class="headerlink" title="é™å®šè‡ªåŠ¨è£…é…çš„ bean"></a>é™å®šè‡ªåŠ¨è£…é…çš„ bean</h4><p>Spring çš„é™å®šç¬¦èƒ½å¤Ÿåœ¨æ‰€æœ‰å¯é€‰çš„ bean ä¸Šè¿›è¡Œç¼©å°èŒƒå›´çš„æ“ä½œï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°åªæœ‰ä¸€ä¸ª bean æ»¡è¶³æ‰€è§„å®šçš„é™åˆ¶æ¡ä»¶ã€‚å¦‚æœå°†æ‰€æœ‰çš„é™å®šç¬¦éƒ½ç”¨ä¸Šåä¾ç„¶å­˜åœ¨æ­§ä¹‰æ€§ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç»§ç»­ä½¿ç”¨æ›´å¤šçš„é™å®šç¬¦æ¥ç¼©å°é€‰æ‹©èŒƒå›´ã€‚</p>
<p>@Qualifier æ³¨è§£æ˜¯ä½¿ç”¨é™å®šç¬¦çš„ä¸»è¦æ–¹å¼ã€‚å®ƒå¯ä»¥ä¸ @Autowired å’Œ @Inject ååŒä½¿ç”¨ï¼Œåœ¨æ³¨å…¥çš„æ—¶å€™æŒ‡å®šæƒ³è¦æ³¨å…¥è¿›å»çš„æ˜¯å“ªä¸ª beanã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦ç¡®ä¿è¦å°† IceCream æ³¨å…¥åˆ° setDessert() ä¹‹ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span><span class="meta">@Qualifier(&quot;iceCream&quot;)</span><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDessert</span><span class="params">(Dessert dessert)</span> </span>&#123;    <span class="keyword">this</span>.dessert = dessert;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸º @Qualifier æ³¨è§£æ‰€è®¾ç½®çš„å‚æ•°å°±æ˜¯æƒ³è¦æ³¨å…¥çš„ bean çš„ IDã€‚æ‰€æœ‰ä½¿ç”¨ @Component æ³¨è§£å£°æ˜çš„ç±»éƒ½ä¼šåˆ›å»ºä¸º beanï¼Œå¹¶ä¸” bean çš„ ID ä¸ºé¦–å­—æ¯å˜ä¸ºå°å†™çš„ç±»åã€‚å› æ­¤ï¼Œ@Qualifier(â€œiceCreamâ€) æŒ‡å‘çš„æ˜¯ç»„ä»¶æ‰«ææ—¶æ‰€åˆ›å»ºçš„ beanï¼Œå¹¶ä¸”è¿™ä¸ª bean æ˜¯ IceCream ç±»çš„å®ä¾‹ã€‚</p>
<p>å®é™…ä¸Šï¼Œè¿˜æœ‰ä¸€ç‚¹éœ€è¦è¡¥å……ä¸€ä¸‹ã€‚æ›´å‡†ç¡®åœ°è®²ï¼Œ@Qualifier(â€œiceCreamâ€) æ‰€å¼•ç”¨çš„ bean è¦å…·æœ‰ String ç±»å‹çš„ â€œiceCreamâ€ ä½œä¸ºé™å®šç¬¦ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå…¶ä»–çš„é™å®šç¬¦çš„è¯ï¼Œæ‰€æœ‰çš„ bean éƒ½ä¼šç»™å®šä¸€ä¸ªé»˜è®¤çš„é™å®šç¬¦ï¼Œè¿™ä¸ªé™å®šç¬¦ä¸ bean çš„ ID ç›¸åŒã€‚å› æ­¤ï¼Œæ¡†æ¶ä¼šå°†å…·æœ‰ â€œiceCreamâ€ é™å®šç¬¦çš„ bean æ³¨å…¥åˆ° setDessert() æ–¹æ³•ä¸­ã€‚è¿™æ°å·§å°±æ˜¯ ID ä¸º iceCream çš„ beanï¼Œå®ƒæ˜¯ IceCream ç±»åœ¨ç»„ä»¶æ‰«æçš„æ—¶å€™åˆ›å»ºçš„ã€‚</p>
<p>åŸºäºé»˜è®¤çš„ bean ID ä½œä¸ºé™å®šç¬¦æ˜¯éå¸¸ç®€å•çš„ï¼Œä½†è¿™æœ‰å¯èƒ½ä¼šå¼•å…¥ä¸€äº›é—®é¢˜ã€‚å¦‚æœä½ é‡æ„äº† IceCream ç±»ï¼Œå°†å…¶é‡å‘½åä¸º Gelato çš„è¯ï¼Œé‚£æ­¤æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿå¦‚æœè¿™æ ·çš„è¯ï¼Œbean çš„ ID å’Œé»˜è®¤çš„é™å®šç¬¦ä¼šå˜ä¸º gelatoï¼Œè¿™å°±æ— æ³•åŒ¹é… setDessert() æ–¹æ³•ä¸­çš„é™å®šç¬¦ã€‚è‡ªåŠ¨è£…é…ä¼šå¤±è´¥ã€‚</p>
<p>è¿™é‡Œçš„é—®é¢˜åœ¨äº setDessert() æ–¹æ³•ä¸Šæ‰€æŒ‡å®šçš„é™å®šç¬¦ä¸è¦æ³¨å…¥çš„beançš„åç§°æ˜¯ç´§è€¦åˆçš„ã€‚å¯¹ç±»åç§°çš„ä»»æ„æ”¹åŠ¨éƒ½ä¼šå¯¼è‡´é™å®šç¬¦å¤±æ•ˆã€‚</p>
<p>åˆ›å»ºè‡ªå®šä¹‰çš„é™å®šç¬¦</p>
<p>æˆ‘ä»¬å¯ä»¥ä¸º bean è®¾ç½®è‡ªå·±çš„é™å®šç¬¦ï¼Œè€Œä¸æ˜¯ä¾èµ–äºå°† bean ID ä½œä¸ºé™å®šç¬¦ã€‚åœ¨è¿™é‡Œæ‰€éœ€è¦åšçš„å°±æ˜¯åœ¨ bean å£°æ˜ä¸Šæ·»åŠ  @Qualifier æ³¨è§£ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥ä¸@Component ç»„åˆä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="meta">@Qualifier(&quot;cold&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IceCream</span> <span class="keyword">implements</span> <span class="title">Dessert</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œcold é™å®šç¬¦åˆ†é…ç»™äº† IceCream beanã€‚å› ä¸ºå®ƒæ²¡æœ‰è€¦åˆç±»åï¼Œå› æ­¤ä½ å¯ä»¥éšæ„é‡æ„ IceCream çš„ç±»åï¼Œè€Œä¸å¿…æ‹…å¿ƒä¼šç ´åè‡ªåŠ¨è£…é…ã€‚åœ¨æ³¨å…¥çš„åœ°æ–¹ï¼Œåªè¦å¼•ç”¨ cold é™å®šç¬¦å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span><span class="meta">@Qualifier(&quot;cold&quot;)</span><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDessert</span><span class="params">(Dessert dessert)</span> </span>&#123;    <span class="keyword">this</span>.dessert = dessert;&#125;</span><br></pre></td></tr></table></figure>

<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå½“é€šè¿‡ Java é…ç½®æ˜¾å¼å®šä¹‰ bean çš„æ—¶å€™ï¼Œ@Qualifier ä¹Ÿå¯ä»¥ä¸ @Bean æ³¨è§£ä¸€èµ·ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span><span class="meta">@Qualifier(&quot;cold&quot;)</span><span class="function"><span class="keyword">public</span> Dessert <span class="title">iceCream</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> IceCream();&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ä½¿ç”¨è‡ªå®šä¹‰çš„ @Qualifier å€¼æ—¶ï¼Œæœ€ä½³å®è·µæ˜¯ä¸º bean é€‰æ‹©ç‰¹å¾æ€§æˆ–æè¿°æ€§çš„æœ¯è¯­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨éšæ„çš„åå­—ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘å°† IceCream bean æè¿°ä¸º â€œcoldâ€ beanã€‚åœ¨æ³¨å…¥çš„æ—¶å€™ï¼Œå¯ä»¥å°†è¿™ä¸ªéœ€æ±‚ç†è§£ä¸ºâ€œç»™æˆ‘ä¸€ä¸ªå‡‰çš„ç”œç‚¹â€ï¼Œè¿™å…¶å®å°±æ˜¯æè¿°çš„ IceCreamã€‚ç±»ä¼¼åœ°ï¼Œæˆ‘å¯ä»¥å°† Cake æè¿°ä¸º â€œsoftâ€ï¼Œå°† Cookie æè¿°ä¸º â€œcrispyâ€ã€‚</p>
<p>ä½¿ç”¨è‡ªå®šä¹‰çš„é™å®šç¬¦æ³¨è§£</p>
<p><strong>é¢å‘ç‰¹æ€§çš„é™å®šç¬¦è¦æ¯”åŸºäº bean ID çš„é™å®šç¬¦æ›´å¥½ä¸€äº›ã€‚</strong>ä½†æ˜¯ï¼Œå¦‚æœå¤šä¸ª bean éƒ½å…·å¤‡ç›¸åŒç‰¹æ€§çš„è¯ï¼Œè¿™ç§åšæ³•ä¹Ÿä¼šå‡ºç°é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¼•å…¥äº†è¿™ä¸ªæ–°çš„ Dessert beanï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="meta">@Qualifier(&quot;cold&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Popsicle</span> <span class="keyword">implements</span> <span class="title">Dessert</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ä¼šå§ï¼Ÿï¼ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸¤ä¸ªå¸¦æœ‰ â€œcoldâ€ é™å®šç¬¦çš„ç”œç‚¹ã€‚åœ¨è‡ªåŠ¨è£…é… Dessert bean çš„æ—¶å€™ï¼Œæˆ‘ä»¬å†æ¬¡é‡åˆ°äº†æ­§ä¹‰æ€§çš„é—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨æ›´å¤šçš„é™å®šç¬¦æ¥å°†å¯é€‰èŒƒå›´é™å®šåˆ°åªæœ‰ä¸€ä¸ª beanã€‚</p>
<p>å¯èƒ½æƒ³åˆ°çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯åœ¨æ³¨å…¥ç‚¹å’Œ bean å®šä¹‰çš„åœ°æ–¹åŒæ—¶å†æ·»åŠ å¦å¤–ä¸€ä¸ª @Qualifier æ³¨è§£ã€‚IceCream ç±»å¤§è‡´å°±ä¼šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="meta">@Qualifier(&quot;cold&quot;)</span><span class="meta">@Qualifier(&quot;creamy&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IceCream</span> <span class="keyword">implements</span> <span class="title">Dessert</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Popsicle ç±»åŒæ ·ä¹Ÿå¯èƒ½å†æ·»åŠ å¦å¤–ä¸€ä¸ª @Qualifier æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="meta">@Qualifier(&quot;cold&quot;)</span><span class="meta">@Qualifier(&quot;fruity&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Popsicle</span> <span class="keyword">implements</span> <span class="title">Dessert</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ³¨å…¥ç‚¹ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä½¿ç”¨è¿™æ ·çš„æ–¹å¼æ¥å°†èŒƒå›´ç¼©å°åˆ° IceCreamï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span><span class="meta">@Qualifier(&quot;cold&quot;)</span><span class="meta">@Qualifier(&quot;creamy&quot;)</span><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDessert</span><span class="params">(Dessert dessert)</span> </span>&#123;    <span class="keyword">this</span>.dessert = dessert;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œåªæœ‰ä¸€ä¸ªå°é—®é¢˜ï¼šJava ä¸å…è®¸åœ¨åŒä¸€ä¸ªæ¡ç›®ä¸Šé‡å¤å‡ºç°ç›¸åŒç±»å‹çš„å¤šä¸ªæ³¨è§£ã€‚å¦‚æœä½ è¯•å›¾è¿™æ ·åšçš„è¯ï¼Œç¼–è¯‘å™¨ä¼šæç¤ºé”™è¯¯ã€‚åœ¨è¿™é‡Œï¼Œä½¿ç”¨ @Qualifier æ³¨è§£å¹¶æ²¡æœ‰åŠæ³•ï¼ˆè‡³å°‘æ²¡æœ‰ç›´æ¥çš„åŠæ³•ï¼‰å°†è‡ªåŠ¨è£…é…çš„å¯é€‰ bean ç¼©å°èŒƒå›´è‡³ä»…æœ‰ä¸€ä¸ªå¯é€‰çš„ beanã€‚</p>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„é™å®šç¬¦æ³¨è§£ï¼Œå€ŸåŠ©è¿™æ ·çš„æ³¨è§£æ¥è¡¨è¾¾ bean æ‰€å¸Œæœ›é™å®šçš„ç‰¹æ€§ã€‚è¿™é‡Œæ‰€éœ€è¦åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ³¨è§£ï¼Œå®ƒæœ¬èº«è¦ä½¿ç”¨ @Qualifier æ³¨è§£æ¥æ ‡æ³¨ã€‚è¿™æ ·æˆ‘ä»¬å°†ä¸å†ä½¿ç”¨ @Qualifier(â€œcoldâ€)ï¼Œè€Œæ˜¯ä½¿ç”¨è‡ªå®šä¹‰çš„ @Cold æ³¨è§£ï¼Œè¯¥æ³¨è§£çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.CONSTRUCTOR, ElementType.FIELD, ElementType.METHOD, ElementType.TYPE&#125;)</span><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span><span class="meta">@Qualifierpublic</span> <span class="meta">@interface</span> Cold &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ @Creamy æ³¨è§£æ¥ä»£æ›¿ @Qualifier(â€œcreamyâ€)ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.CONSTRUCTOR, ElementType.FIELD, ElementType.METHOD, ElementType.TYPE&#125;)</span><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span><span class="meta">@Qualifierpublic</span> <span class="meta">@interface</span> Creamy  &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ä½ ä¸æƒ³ç”¨ @Qualifier æ³¨è§£çš„æ—¶å€™ï¼Œå¯ä»¥ç±»ä¼¼åœ°åˆ›å»º @Softã€@Crispy å’Œ @Fruityã€‚é€šè¿‡åœ¨å®šä¹‰æ—¶æ·»åŠ  @Qualifier æ³¨è§£ï¼Œå®ƒä»¬å°±å…·æœ‰äº† @Qualifier æ³¨è§£çš„ç‰¹æ€§ã€‚å®ƒä»¬æœ¬èº«å®é™…ä¸Šå°±æˆä¸ºäº†é™å®šç¬¦æ³¨è§£ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°çœ‹ä¸€ä¸‹ IceCreamï¼Œå¹¶ä¸ºå…¶æ·»åŠ  @Cold å’Œ @Creamy æ³¨è§£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="meta">@Cold</span><span class="meta">@Creamypublic</span> <span class="class"><span class="keyword">class</span> <span class="title">IceCream</span> <span class="keyword">implements</span> <span class="title">Dessert</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼åœ°ï¼ŒPopsicle ç±»å¯ä»¥æ·»åŠ  @Cold å’Œ @Fruity æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="meta">@Cold</span><span class="meta">@Fruitypublic</span> <span class="class"><span class="keyword">class</span> <span class="title">Popsicle</span> <span class="keyword">implements</span> <span class="title">Dessert</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆï¼Œåœ¨æ³¨å…¥ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨å¿…è¦çš„é™å®šç¬¦æ³¨è§£è¿›è¡Œä»»æ„ç»„åˆï¼Œä»è€Œå°†å¯é€‰èŒƒå›´ç¼©å°åˆ°åªæœ‰ä¸€ä¸ª bean æ»¡è¶³éœ€æ±‚ã€‚ä¸ºäº†å¾—åˆ° IceCream beanï¼ŒsetDessert() æ–¹æ³•å¯ä»¥è¿™æ ·ä½¿ç”¨æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span><span class="meta">@Cold</span><span class="meta">@Creamypublic</span> <span class="function"><span class="keyword">void</span> <span class="title">setDessert</span><span class="params">(Dessert dessert)</span> </span>&#123;    <span class="keyword">this</span>.dessert = dessert;&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡å£°æ˜è‡ªå®šä¹‰çš„é™å®šç¬¦æ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªé™å®šç¬¦ï¼Œä¸ä¼šå†æœ‰ Java ç¼–è¯‘å™¨çš„é™åˆ¶æˆ–é”™è¯¯ã€‚ä¸æ­¤åŒæ—¶ï¼Œç›¸å¯¹äºä½¿ç”¨åŸå§‹çš„ @Qualifier å¹¶å€ŸåŠ© String ç±»å‹æ¥æŒ‡å®šé™å®šç¬¦ï¼Œè‡ªå®šä¹‰çš„æ³¨è§£ä¹Ÿæ›´ä¸ºç±»å‹å®‰å…¨ã€‚</p>
<p>è®©æˆ‘ä»¬è¿‘è·ç¦»è§‚å¯Ÿä¸€ä¸‹ setDessert() æ–¹æ³•ä»¥åŠå®ƒçš„æ³¨è§£ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹æ˜ç¡®æŒ‡å®šè¦å°† IceCream è‡ªåŠ¨è£…é…åˆ°è¯¥æ–¹æ³•ä¸­ã€‚ç›¸åï¼Œæˆ‘ä»¬ä½¿ç”¨æ‰€éœ€ bean çš„ç‰¹æ€§æ¥è¿›è¡ŒæŒ‡å®šï¼Œå³ @Cold å’Œ @Creamyã€‚å› æ­¤ï¼ŒsetDessert() æ–¹æ³•ä¾ç„¶èƒ½å¤Ÿä¸ç‰¹å®šçš„ Dessert å®ç°ä¿æŒè§£è€¦ã€‚ä»»æ„æ»¡è¶³è¿™äº›ç‰¹å¾çš„ bean éƒ½æ˜¯å¯ä»¥çš„ã€‚åœ¨å½“å‰é€‰æ‹© Dessert å®ç°æ—¶ï¼Œæ°å¥½å¦‚æ­¤ï¼ŒIceCream æ˜¯å”¯ä¸€èƒ½å¤Ÿä¸ä¹‹åŒ¹é…çš„ beanã€‚</p>
<p>åœ¨æœ¬èŠ‚å’Œå‰é¢çš„èŠ‚ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å‡ ç§é€šè¿‡è‡ªå®šä¹‰æ³¨è§£æ‰©å±• Spring çš„æ–¹å¼ã€‚ä¸ºäº†åˆ›å»ºè‡ªå®šä¹‰çš„æ¡ä»¶åŒ–æ³¨è§£ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æ³¨è§£å¹¶åœ¨è¿™ä¸ªæ³¨è§£ä¸Šæ·»åŠ äº† @Conditionalã€‚ä¸ºäº†åˆ›å»ºè‡ªå®šä¹‰çš„é™å®šç¬¦æ³¨è§£ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æ³¨è§£å¹¶åœ¨è¿™ä¸ªæ³¨è§£ä¸Šæ·»åŠ äº† @Qualifierã€‚è¿™ç§æŠ€æœ¯å¯ä»¥ç”¨åˆ°å¾ˆå¤šçš„ Spring æ³¨è§£ä¸­ï¼Œä»è€Œèƒ½å¤Ÿå°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·å½¢æˆç‰¹å®šç›®æ ‡çš„è‡ªå®šä¹‰æ³¨è§£ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ä¸åŒçš„ä½œç”¨åŸŸä¸­å£°æ˜ beanã€‚</p>
<h3 id="beançš„ä½œç”¨åŸŸ"><a href="#beançš„ä½œç”¨åŸŸ" class="headerlink" title="beançš„ä½œç”¨åŸŸ"></a>beançš„ä½œç”¨åŸŸ</h3><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰ bean éƒ½æ˜¯ä½œä¸ºä»¥å•ä¾‹ï¼ˆsingletonï¼‰çš„å½¢å¼åˆ›å»ºçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡ç»™å®šçš„ä¸€ä¸ª bean è¢«æ³¨å…¥åˆ°å…¶ä»– bean å¤šå°‘æ¬¡ï¼Œæ¯æ¬¡æ‰€æ³¨å…¥çš„éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚</p>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå•ä¾‹ bean æ˜¯å¾ˆç†æƒ³çš„æ–¹æ¡ˆã€‚åˆå§‹åŒ–å’Œåƒåœ¾å›æ”¶å¯¹è±¡å®ä¾‹æ‰€å¸¦æ¥çš„æˆæœ¬åªç•™ç»™ä¸€äº›å°è§„æ¨¡ä»»åŠ¡ï¼Œåœ¨è¿™äº›ä»»åŠ¡ä¸­ï¼Œè®©å¯¹è±¡ä¿æŒæ— çŠ¶æ€å¹¶ä¸”åœ¨åº”ç”¨ä¸­åå¤é‡ç”¨è¿™äº›å¯¹è±¡å¯èƒ½å¹¶ä¸åˆç†ã€‚</p>
<p>æœ‰æ—¶å€™ï¼Œå¯èƒ½ä¼šå‘ç°ï¼Œä½ æ‰€ä½¿ç”¨çš„ç±»æ˜¯æ˜“å˜çš„ï¼ˆmutableï¼‰ï¼Œå®ƒä»¬ä¼šä¿æŒä¸€äº›çŠ¶æ€ï¼Œå› æ­¤é‡ç”¨æ˜¯ä¸å®‰å…¨çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°† class å£°æ˜ä¸ºå•ä¾‹çš„ bean å°±ä¸æ˜¯ä»€ä¹ˆå¥½ä¸»æ„äº†ï¼Œå› ä¸ºå¯¹è±¡ä¼šè¢«æ±¡æŸ“ï¼Œç¨åé‡ç”¨çš„æ—¶å€™ä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚</p>
<p>Spring å®šä¹‰äº†å¤šç§ä½œç”¨åŸŸï¼Œå¯ä»¥åŸºäºè¿™äº›ä½œç”¨åŸŸåˆ›å»º beanï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>å•ä¾‹ï¼ˆSingletonï¼‰ï¼šåœ¨æ•´ä¸ªåº”ç”¨ä¸­ï¼Œåªåˆ›å»ºbeançš„ä¸€ä¸ªå®ä¾‹ã€‚</li>
<li>åŸå‹ï¼ˆPrototypeï¼‰ï¼šæ¯æ¬¡æ³¨å…¥æˆ–è€…é€šè¿‡ Spring åº”ç”¨ä¸Šä¸‹æ–‡è·å–çš„æ—¶å€™ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„beanå®ä¾‹ã€‚</li>
<li>ä¼šè¯ï¼ˆSessionï¼‰ï¼šåœ¨ Web åº”ç”¨ä¸­ï¼Œä¸ºæ¯ä¸ªä¼šè¯åˆ›å»ºä¸€ä¸ª bean å®ä¾‹ã€‚</li>
<li>è¯·æ±‚ï¼ˆRquestï¼‰ï¼šåœ¨ Web åº”ç”¨ä¸­ï¼Œä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ª bean å®ä¾‹ã€‚</li>
</ul>
<p>å•ä¾‹æ˜¯é»˜è®¤çš„ä½œç”¨åŸŸï¼Œä½†æ˜¯æ­£å¦‚ä¹‹å‰æ‰€è¿°ï¼Œå¯¹äºæ˜“å˜çš„ç±»å‹ï¼Œè¿™å¹¶ä¸åˆé€‚ã€‚å¦‚æœé€‰æ‹©å…¶ä»–çš„ä½œç”¨åŸŸï¼Œè¦ä½¿ç”¨ @Scope æ³¨è§£ï¼Œå®ƒå¯ä»¥ä¸ @Component æˆ– @Bean ä¸€èµ·ä½¿ç”¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœä½ ä½¿ç”¨ç»„ä»¶æ‰«ææ¥å‘ç°å’Œå£°æ˜ beanï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨ bean çš„ç±»ä¸Šä½¿ç”¨ @Scope æ³¨è§£ï¼Œå°†å…¶å£°æ˜ä¸ºåŸå‹ beanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="meta">@Scope(ConfigurableFactory.SCOPE_PROTOTYPE)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Notepad</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œï¼Œä½¿ç”¨ ConfigurableBeanFactory ç±»çš„ SCOPE_PROTOTYPE å¸¸é‡è®¾ç½®äº†åŸå‹ä½œç”¨åŸŸã€‚ä½ å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ @Scope(â€œprototypeâ€)ï¼Œä½†æ˜¯ä½¿ç”¨ SCOPE_PROTOTYPE å¸¸é‡æ›´åŠ å®‰å…¨å¹¶ä¸”ä¸æ˜“å‡ºé”™ã€‚</p>
<p>å¦‚æœä½ æƒ³åœ¨ Java é…ç½®ä¸­å°† Notepad å£°æ˜ä¸ºåŸå‹ beanï¼Œé‚£ä¹ˆå¯ä»¥ç»„åˆä½¿ç”¨ @Scope å’Œ @Bean æ¥æŒ‡å®šæ‰€éœ€çš„ä½œç”¨åŸŸï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="meta">@Scope(ConfigurableFactory.SCOPE_PROTOTYPE)</span><span class="function"><span class="keyword">public</span> Notepad <span class="title">notepad</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> Notepad();&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·ï¼Œå¦‚æœä½ ä½¿ç”¨ XML æ¥é…ç½® bean çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>&lt;bean&gt;</code> å…ƒç´ çš„ scope å±æ€§æ¥è®¾ç½®ä½œç”¨åŸŸï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;notepad&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.myapp.Notepad&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;propertype&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡ä½ ä½¿ç”¨å“ªç§æ–¹å¼æ¥å£°æ˜åŸå‹ä½œç”¨åŸŸï¼Œæ¯æ¬¡æ³¨å…¥æˆ–ä» Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ£€ç´¢è¯¥ bean çš„æ—¶å€™ï¼Œéƒ½ä¼šåˆ›å»ºæ–°çš„å®ä¾‹ã€‚è¿™æ ·æ‰€å¯¼è‡´çš„ç»“æœå°±æ˜¯æ¯æ¬¡æ“ä½œéƒ½èƒ½å¾—åˆ°è‡ªå·±çš„ Notepad å®ä¾‹ã€‚</p>
<h4 id="ä½¿ç”¨ä¼šè¯å’Œè¯·æ±‚ä½œç”¨åŸŸ"><a href="#ä½¿ç”¨ä¼šè¯å’Œè¯·æ±‚ä½œç”¨åŸŸ" class="headerlink" title="ä½¿ç”¨ä¼šè¯å’Œè¯·æ±‚ä½œç”¨åŸŸ"></a>ä½¿ç”¨ä¼šè¯å’Œè¯·æ±‚ä½œç”¨åŸŸ</h4><p>åœ¨ Web åº”ç”¨ä¸­ï¼Œå¦‚æœèƒ½å¤Ÿå®ä¾‹åŒ–åœ¨ä¼šè¯å’Œè¯·æ±‚èŒƒå›´å†…å…±äº«çš„ beanï¼Œé‚£å°†æ˜¯éå¸¸æœ‰ä»·å€¼çš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œåœ¨å…¸å‹çš„ç”µå­å•†åŠ¡åº”ç”¨ä¸­ï¼Œå¯èƒ½ä¼šæœ‰ä¸€ä¸ª bean ä»£è¡¨ç”¨æˆ·çš„è´­ç‰©è½¦ã€‚å¦‚æœè´­ç‰©è½¦æ˜¯å•ä¾‹çš„è¯ï¼Œé‚£ä¹ˆå°†ä¼šå¯¼è‡´æ‰€æœ‰çš„ç”¨æˆ·éƒ½ä¼šå‘åŒä¸€ä¸ªè´­ç‰©è½¦ä¸­æ·»åŠ å•†å“ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœè´­ç‰©è½¦æ˜¯åŸå‹ä½œç”¨åŸŸçš„ï¼Œé‚£ä¹ˆåœ¨åº”ç”¨ä¸­æŸä¸€ä¸ªåœ°æ–¹å¾€è´­ç‰©è½¦ä¸­æ·»åŠ å•†å“ï¼Œåœ¨åº”ç”¨çš„å¦å¤–ä¸€ä¸ªåœ°æ–¹å¯èƒ½å°±ä¸å¯ç”¨äº†ï¼Œå› ä¸ºåœ¨è¿™é‡Œæ³¨å…¥çš„æ˜¯å¦å¤–ä¸€ä¸ªåŸå‹ä½œç”¨åŸŸçš„è´­ç‰©è½¦ã€‚</p>
<p>å°±è´­ç‰©è½¦ bean æ¥è¯´ï¼Œä¼šè¯ä½œç”¨åŸŸæ˜¯æœ€ä¸ºåˆé€‚çš„ï¼Œå› ä¸ºå®ƒä¸ç»™å®šçš„ç”¨æˆ·å…³è”æ€§æœ€å¤§ã€‚è¦æŒ‡å®šä¼šè¯ä½œç”¨åŸŸï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ @Scope æ³¨è§£ï¼Œå®ƒçš„ä½¿ç”¨æ–¹å¼ä¸æŒ‡å®šåŸå‹ä½œç”¨åŸŸæ˜¯ç›¸åŒçš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="meta">@Scope(value=WebApplicationContext.SCOPE_SESSION, proxyMode=ScopedProxyMode.INTERFACES)</span><span class="function"><span class="keyword">public</span> ShoppingCart <span class="title">ShoppingCart</span><span class="params">()</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œï¼Œæˆ‘ä»¬å°† value è®¾ç½®æˆäº† WebApplicationContext ä¸­çš„ SCOPE_SESSION å¸¸é‡ï¼ˆå®ƒçš„å€¼æ˜¯ sessionï¼‰ã€‚è¿™ä¼šå‘Šè¯‰ Spring ä¸º Web åº”ç”¨ä¸­çš„æ¯ä¸ªä¼šè¯åˆ›å»ºä¸€ä¸ªShoppingCartã€‚è¿™ä¼šåˆ›å»ºå¤šä¸ª ShoppingCart bean çš„å®ä¾‹ï¼Œä½†æ˜¯å¯¹äºç»™å®šçš„ä¼šè¯åªä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œåœ¨å½“å‰ä¼šè¯ç›¸å…³çš„æ“ä½œä¸­ï¼Œè¿™ä¸ª bean å®é™…ä¸Šç›¸å½“äºå•ä¾‹çš„ã€‚</p>
<p>è¦æ³¨æ„çš„æ˜¯ï¼Œ@Scope åŒæ—¶è¿˜æœ‰ä¸€ä¸ª proxyMode å±æ€§ï¼Œå®ƒè¢«è®¾ç½®æˆäº† ScopedProxyMode.INTERFACESã€‚è¿™ä¸ªå±æ€§è§£å†³äº†å°†ä¼šè¯æˆ–è¯·æ±‚ä½œç”¨åŸŸçš„ bean æ³¨å…¥åˆ°å•ä¾‹ bean ä¸­æ‰€é‡åˆ°çš„é—®é¢˜ã€‚åœ¨æè¿° proxyMode å±æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ proxyMode æ‰€è§£å†³é—®é¢˜çš„åœºæ™¯ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬è¦å°† ShoppingCart bean æ³¨å…¥åˆ°å•ä¾‹ StoreService bean çš„ Setter æ–¹æ³•ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Componentpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">StoreService</span> </span>&#123;    <span class="meta">@Autowired</span>    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShoppingCart</span><span class="params">(ShoppingCart shoppingCart)</span> </span>&#123;        <span class="keyword">this</span>.shoppingCart = shoppingCart;    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸º StoreService æ˜¯ä¸€ä¸ªå•ä¾‹çš„ beanï¼Œä¼šåœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡åŠ è½½çš„æ—¶å€™åˆ›å»ºã€‚å½“å®ƒåˆ›å»ºçš„æ—¶å€™ï¼ŒSpring ä¼šè¯•å›¾å°† ShoppingCart bean æ³¨å…¥åˆ° setShoppingCart() æ–¹æ³•ä¸­ã€‚ä½†æ˜¯ ShoppingCart bean æ˜¯ä¼šè¯ä½œç”¨åŸŸçš„ï¼Œæ­¤æ—¶å¹¶ä¸å­˜åœ¨ã€‚ç›´åˆ°æŸä¸ªç”¨æˆ·è¿›å…¥ç³»ç»Ÿï¼Œåˆ›å»ºäº†ä¼šè¯ä¹‹åï¼Œæ‰ä¼šå‡ºç° ShoppingCart å®ä¾‹ã€‚</p>
<p>å¦å¤–ï¼Œç³»ç»Ÿä¸­å°†ä¼šæœ‰å¤šä¸ª ShoppingCart å®ä¾‹ï¼šæ¯ä¸ªç”¨æˆ·ä¸€ä¸ªã€‚æˆ‘ä»¬å¹¶ä¸æƒ³è®© Spring æ³¨å…¥æŸä¸ªå›ºå®šçš„ ShoppingCart å®ä¾‹åˆ° StoreService ä¸­ã€‚æˆ‘ä»¬å¸Œæœ›çš„æ˜¯å½“ StoreService å¤„ç†è´­ç‰©è½¦åŠŸèƒ½æ—¶ï¼Œå®ƒæ‰€ä½¿ç”¨çš„ ShoppingCart å®ä¾‹æ°å¥½æ˜¯å½“å‰ä¼šè¯æ‰€å¯¹åº”çš„é‚£ä¸€ä¸ªã€‚</p>
<p>Spring å¹¶ä¸ä¼šå°†å®é™…çš„ ShoppingCart bean æ³¨å…¥åˆ° StoreService ä¸­ï¼ŒSpring ä¼šæ³¨å…¥ä¸€ä¸ªåˆ° ShoppingCart bean çš„ä»£ç†ã€‚è¿™ä¸ªä»£ç†ä¼šæš´éœ²ä¸ ShoppingCart ç›¸åŒçš„æ–¹æ³•ï¼Œæ‰€ä»¥ StoreService ä¼šè®¤ä¸ºå®ƒå°±æ˜¯ä¸€ä¸ªè´­ç‰©è½¦ã€‚ä½†æ˜¯ï¼Œå½“ StoreService è°ƒç”¨ ShoppingCart çš„æ–¹æ³•æ—¶ï¼Œä»£ç†ä¼šå¯¹å…¶è¿›è¡Œæ‡’è§£æå¹¶å°†è°ƒç”¨å§”æ‰˜ç»™ä¼šè¯ä½œç”¨åŸŸå†…çœŸæ­£çš„ ShoppingCart beanã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¸¦ç€å¯¹è¿™ä¸ªä½œç”¨åŸŸçš„ç†è§£ï¼Œè®¨è®ºä¸€ä¸‹ proxyMode å±æ€§ã€‚</p>
<p>å¦‚é…ç½®æ‰€ç¤ºï¼ŒproxyMode å±æ€§è¢«è®¾ç½®æˆäº† ScopedProxyMode.INTERFACESï¼Œè¿™è¡¨æ˜è¿™ä¸ªä»£ç†è¦å®ç° ShoppingCart æ¥å£ï¼Œå¹¶å°†è°ƒç”¨å§”æ‰˜ç»™å®ç° beanã€‚</p>
<p>å¦‚æœ ShoppingCart æ˜¯æ¥å£è€Œä¸æ˜¯ç±»çš„è¯ï¼Œè¿™æ˜¯å¯ä»¥çš„ï¼ˆä¹Ÿæ˜¯æœ€ä¸ºç†æƒ³çš„ä»£ç†æ¨¡å¼ï¼‰ã€‚ä½†å¦‚æœ ShoppingCart æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»çš„è¯ï¼ŒSpring å°±æ²¡æœ‰åŠæ³•åˆ›å»ºåŸºäºæ¥å£çš„ä»£ç†äº†ã€‚æ­¤æ—¶ï¼Œå®ƒå¿…é¡»ä½¿ç”¨ CGLib æ¥ç”ŸæˆåŸºäºç±»çš„ä»£ç†ã€‚æ‰€ä»¥ï¼Œå¦‚æœ bean ç±»å‹æ˜¯å…·ä½“ç±»çš„è¯ï¼Œæˆ‘ä»¬å¿…é¡»è¦å°† proxyMode å±æ€§è®¾ç½®ä¸º ScopedProxyMode.TARGET_CLASSï¼Œä»¥æ­¤æ¥è¡¨æ˜è¦ä»¥ç”Ÿæˆç›®æ ‡ç±»æ‰©å±•çš„æ–¹å¼åˆ›å»ºä»£ç†ã€‚</p>
<p>å°½ç®¡æˆ‘ä¸»è¦å…³æ³¨äº†ä¼šè¯ä½œç”¨åŸŸï¼Œä½†æ˜¯è¯·æ±‚ä½œç”¨åŸŸçš„ bean ä¼šé¢ä¸´ç›¸åŒçš„è£…é…é—®é¢˜ã€‚å› æ­¤ï¼Œè¯·æ±‚ä½œç”¨åŸŸçš„ bean åº”è¯¥ä¹Ÿä»¥ä½œç”¨åŸŸä»£ç†çš„æ–¹å¼è¿›è¡Œæ³¨å…¥ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211014105618837.png" alt="image-20211014105618837"></p>
<center>å›¾3.1ã€€ä½œç”¨åŸŸä»£ç†èƒ½å¤Ÿå»¶è¿Ÿæ³¨å…¥è¯·æ±‚å’Œä¼šè¯ä½œç”¨åŸŸçš„bean</center>

<h4 id="åœ¨-XML-ä¸­å£°æ˜ä½œç”¨åŸŸä»£ç†"><a href="#åœ¨-XML-ä¸­å£°æ˜ä½œç”¨åŸŸä»£ç†" class="headerlink" title="åœ¨ XML ä¸­å£°æ˜ä½œç”¨åŸŸä»£ç†"></a>åœ¨ XML ä¸­å£°æ˜ä½œç”¨åŸŸä»£ç†</h4><p>å¦‚æœä½ éœ€è¦ä½¿ç”¨XMLæ¥å£°æ˜ä¼šè¯æˆ–è¯·æ±‚ä½œç”¨åŸŸçš„beanï¼Œé‚£ä¹ˆå°±ä¸èƒ½ä½¿ç”¨@Scopeæ³¨è§£åŠå…¶proxyModeå±æ€§äº†ã€‚<code>&lt;bean&gt;</code> å…ƒç´ çš„ scope å±æ€§èƒ½å¤Ÿè®¾ç½® bean çš„ä½œç”¨åŸŸï¼Œä½†æ˜¯è¯¥æ€æ ·æŒ‡å®šä»£ç†æ¨¡å¼å‘¢ï¼Ÿ</p>
<p>è¦è®¾ç½®ä»£ç†æ¨¡å¼ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ Spring aop å‘½åç©ºé—´çš„ä¸€ä¸ªæ–°å…ƒç´ ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cart&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.myapp.ShoppingCart&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;session&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">aop:scoped-proxy</span>/&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;aop:scoped-proxy&gt;</code> æ˜¯ä¸ @Scope æ³¨è§£çš„ proxyMode å±æ€§åŠŸèƒ½ç›¸åŒçš„ Spring XML é…ç½®å…ƒç´ ã€‚å®ƒä¼šå‘Šè¯‰ Spring ä¸º bean åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸä»£ç†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šä½¿ç”¨ CGLib åˆ›å»ºç›®æ ‡ç±»çš„ä»£ç†ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥å°† proxy-target-class å±æ€§è®¾ç½®ä¸º falseï¼Œè¿›è€Œè¦æ±‚å®ƒç”ŸæˆåŸºäºæ¥å£çš„ä»£ç†ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cart&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.myapp.ShoppingCart&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;session&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">aop:scoped-proxy</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;false&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ç¬¬ 4 ç« ä¸­ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ Spring å’Œé¢å‘åˆ‡é¢ç¼–ç¨‹çš„æ—¶å€™ï¼Œä¼šè®¨è®º Spring aop å‘½åç©ºé—´çš„æ›´å¤šçŸ¥è¯†ã€‚ä¸è¿‡ï¼Œåœ¨ç»“æŸæœ¬ç« çš„å†…å®¹ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Spring é«˜çº§é…ç½®çš„å¦å¤–ä¸€ä¸ªå¯é€‰æ–¹æ¡ˆï¼šSpring è¡¨è¾¾å¼è¯­è¨€ï¼ˆSpring Expression Languageï¼‰ã€‚</p>
<h3 id="è¿è¡Œæ—¶å€¼æ³¨å…¥"><a href="#è¿è¡Œæ—¶å€¼æ³¨å…¥" class="headerlink" title="è¿è¡Œæ—¶å€¼æ³¨å…¥"></a>è¿è¡Œæ—¶å€¼æ³¨å…¥</h3><p>å½“è®¨è®ºä¾èµ–æ³¨å…¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸æ‰€è®¨è®ºçš„æ˜¯å°†ä¸€ä¸ª bean å¼•ç”¨æ³¨å…¥åˆ°å¦ä¸€ä¸ª bean çš„å±æ€§æˆ–æ„é€ å™¨å‚æ•°ä¸­ã€‚å®ƒé€šå¸¸æ¥è®²æŒ‡çš„æ˜¯å°†ä¸€ä¸ªå¯¹è±¡ä¸å¦ä¸€ä¸ªå¯¹è±¡è¿›è¡Œå…³è”ã€‚</p>
<p>ä½†æ˜¯ bean è£…é…çš„å¦å¤–ä¸€ä¸ªæ–¹é¢æŒ‡çš„æ˜¯å°†ä¸€ä¸ªå€¼æ³¨å…¥åˆ° bean çš„å±æ€§æˆ–è€…æ„é€ å™¨å‚æ•°ä¸­ã€‚æˆ‘ä»¬åœ¨ç¬¬ 2 ç« ä¸­å·²ç»è¿›è¡Œäº†å¾ˆå¤šå€¼è£…é…ï¼Œå¦‚å°†ä¸“è¾‘çš„åå­—è£…é…åˆ° BlankDisc bean çš„æ„é€ å™¨æˆ– title å±æ€§ä¸­ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½æŒ‰ç…§è¿™æ ·çš„æ–¹å¼æ¥ç»„è£… BlankDiscï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">CompactDisc <span class="title">sgtPeppers</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> BlankDisc(<span class="string">&quot;Sgt. Pepper&#x27;s Lonely Hearts Club Band&quot;</span>,                        <span class="string">&quot;The Battles&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>å°½ç®¡è¿™å®ç°äº†ä½ çš„éœ€æ±‚ï¼Œä¹Ÿå°±æ˜¯ä¸º BlankDisc bean è®¾ç½® title å’Œ artistï¼Œä½†å®ƒåœ¨å®ç°çš„æ—¶å€™æ˜¯å°†å€¼ç¡¬ç¼–ç åœ¨é…ç½®ç±»ä¸­çš„ã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œå¦‚æœä½¿ç”¨ XML çš„è¯ï¼Œé‚£ä¹ˆå€¼ä¹Ÿä¼šæ˜¯ç¡¬ç¼–ç çš„ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sgtPeppers&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.BlankDisc&quot;</span>      <span class="attr">c:_title</span>=<span class="string">&quot;Sgt. Pepper&#x27;s Lonely Hearts Club Band&quot;</span>      <span class="attr">c:_artist</span>=<span class="string">&quot;The Battles&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ‰æ—¶å€™ç¡¬ç¼–ç æ˜¯å¯ä»¥çš„ï¼Œä½†æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¸Œæœ›é¿å…ç¡¬ç¼–ç å€¼ï¼Œè€Œæ˜¯æƒ³è®©è¿™äº›å€¼åœ¨è¿è¡Œæ—¶å†ç¡®å®šã€‚ä¸ºäº†å®ç°è¿™äº›åŠŸèƒ½ï¼ŒSpringæä¾›äº†ä¸¤ç§åœ¨è¿è¡Œæ—¶æ±‚å€¼çš„æ–¹å¼ï¼š</p>
<ul>
<li>å±æ€§å ä½ç¬¦ï¼ˆProperty placeholderï¼‰ã€‚</li>
<li>Springè¡¨è¾¾å¼è¯­è¨€ï¼ˆSpELï¼‰ã€‚</li>
</ul>
<p>å¾ˆå¿«ä½ å°±ä¼šå‘ç°è¿™ä¸¤ç§æŠ€æœ¯çš„ç”¨æ³•æ˜¯ç±»ä¼¼çš„ï¼Œä¸è¿‡å®ƒä»¬çš„ç›®çš„å’Œè¡Œä¸ºæ˜¯æœ‰æ‰€å·®åˆ«çš„ã€‚è®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å±æ€§å ä½ç¬¦ï¼Œåœ¨è¿™ä¸¤è€…ä¸­å®ƒè¾ƒä¸ºç®€å•ï¼Œç„¶åå†çœ‹ä¸€ä¸‹æ›´ä¸ºå¼ºå¤§çš„ SpELã€‚</p>
<h4 id="æ³¨å…¥å¤–éƒ¨çš„å€¼"><a href="#æ³¨å…¥å¤–éƒ¨çš„å€¼" class="headerlink" title="æ³¨å…¥å¤–éƒ¨çš„å€¼"></a>æ³¨å…¥å¤–éƒ¨çš„å€¼</h4><p>åœ¨ Spring ä¸­ï¼Œå¤„ç†å¤–éƒ¨å€¼çš„æœ€ç®€å•æ–¹å¼å°±æ˜¯å£°æ˜å±æ€§æºå¹¶é€šè¿‡ Spring çš„ Environment æ¥æ£€ç´¢å±æ€§ã€‚ä¾‹å¦‚ï¼Œç¨‹åºæ¸…å•3.7å±•ç°äº†ä¸€ä¸ªåŸºæœ¬çš„ Spring é…ç½®ç±»ï¼Œå®ƒä½¿ç”¨å¤–éƒ¨çš„å±æ€§æ¥è£…é… BlankDisc beanã€‚</p>
<center>ç¨‹åºæ¸…å• 3.7ã€€ä½¿ç”¨ @PropertySource æ³¨è§£å’Œ Environment</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.soundsystem;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.context.annotation.Bean;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.context.annotation.PropertySource;<span class="keyword">import</span> org.springframework.core.env.Environment;<span class="meta">@Configuration</span><span class="meta">@PropertySource(&quot;classpath:/com/soundsystem/app.properties&quot;)</span> <span class="comment">// å£°æ˜å±æ€§æºpublic class ExpressiveConfig &#123;    @Autowired    Environment env;        @Bean    public BlankDisc disc() &#123;        return new BlankDisc(env.getProperty(&quot;disc.title&quot;), // æ£€ç´¢å±æ€§å€¼                            env.getProperrty(&quot;disc.artist&quot;));    &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ@PropertySource å¼•ç”¨äº†ç±»è·¯å¾„ä¸­ä¸€ä¸ªåä¸º app.properties çš„æ–‡ä»¶ã€‚å®ƒå¤§è‡´ä¼šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">disc.title</span>=<span class="string">Sgt. Pepper&#x27;s Lonely Hearts Club Banddisc.artist=The Battles</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå±æ€§æ–‡ä»¶ä¼šåŠ è½½åˆ° Spring çš„ Environment ä¸­ï¼Œç¨åå¯ä»¥ä»è¿™é‡Œæ£€ç´¢å±æ€§ã€‚åŒæ—¶ï¼Œåœ¨ disc() æ–¹æ³•ä¸­ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ BlankDiscï¼Œå®ƒçš„æ„é€ å™¨å‚æ•°æ˜¯ä»å±æ€§æ–‡ä»¶ä¸­è·å–çš„ï¼Œè€Œè¿™æ˜¯é€šè¿‡è°ƒç”¨ getProperty() å®ç°çš„ã€‚</p>
<p>æ·±å…¥å­¦ä¹  Spring çš„ Environment</p>
<p>å½“æˆ‘ä»¬å»äº†è§£ Environment çš„æ—¶å€™ä¼šå‘ç°ï¼Œç¨‹åºæ¸…å• 3.7 æ‰€ç¤ºçš„ getProperty() æ–¹æ³•å¹¶ä¸æ˜¯è·å–å±æ€§å€¼çš„å”¯ä¸€æ–¹æ³•ï¼Œ  getProperty() æ–¹æ³•æœ‰å››ä¸ªé‡è½½çš„å˜ç§å½¢å¼ï¼š</p>
<ul>
<li>String getProperty(String key)</li>
<li>String getProperty(String key, String defaultValue)</li>
<li>T getProperty(String key, Class<T> type)</T></li>
<li>T getProperty(String key, Class<T> type, T defaultValue)</T></li>
</ul>
<p>å‰ä¸¤ç§å½¢å¼çš„ getProperty()æ–¹æ³•éƒ½ä¼šè¿”å› String ç±»å‹çš„å€¼ã€‚æˆ‘ä»¬å·²ç»åœ¨ç¨‹åºæ¸…å• 3.7 ä¸­çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ç¬¬ä¸€ç§ getProperty() æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥ç¨å¾®å¯¹@Beanæ–¹æ³•è¿›è¡Œä¸€ä¸‹ä¿®æ”¹ï¼Œè¿™æ ·åœ¨æŒ‡å®šå±æ€§ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ä¸€ä¸ªé»˜è®¤å€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">BlankDisc <span class="title">disc</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> Blank(env.getProperty(<span class="string">&quot;disc.title&quot;</span>, <span class="string">&quot;Rattle and Hum&quot;</span>),                    env.getProperty(<span class="string">&quot;disc.artist&quot;</span>, <span class="string">&quot;U2&quot;</span>));&#125;</span><br></pre></td></tr></table></figure>

<p>å‰©ä¸‹çš„ä¸¤ç§ getProperty() æ–¹æ³•ä¸å‰é¢çš„ä¸¤ç§éå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒä»¬ä¸ä¼šå°†æ‰€æœ‰çš„å€¼éƒ½è§†ä¸º String ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æƒ³è¦è·å–çš„å€¼æ‰€ä»£è¡¨çš„å«ä¹‰æ˜¯è¿æ¥æ± ä¸­æ‰€ç»´æŒçš„è¿æ¥æ•°é‡ã€‚å¦‚æœæˆ‘ä»¬ä»å±æ€§æ–‡ä»¶ä¸­å¾—åˆ°çš„æ˜¯ä¸€ä¸ª String ç±»å‹çš„å€¼ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨ä¹‹å‰è¿˜éœ€è¦å°†å…¶è½¬æ¢ä¸ºInteger ç±»å‹ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨é‡è½½å½¢å¼çš„ getProperty() çš„è¯ï¼Œå°±èƒ½éå¸¸ä¾¿åˆ©åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> connectionCount = env.getProperty(<span class="string">&quot;db.connection.count&quot;</span>, Integer.class, <span class="number">30</span>);</span><br></pre></td></tr></table></figure>

<p>Environment è¿˜æä¾›äº†å‡ ä¸ªä¸å±æ€§ç›¸å…³çš„æ–¹æ³•ï¼Œå¦‚æœä½ åœ¨ä½¿ç”¨ getProperty() æ–¹æ³•çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šé»˜è®¤å€¼ï¼Œå¹¶ä¸”è¿™ä¸ªå±æ€§æ²¡æœ‰å®šä¹‰çš„è¯ï¼Œè·å–åˆ°çš„å€¼æ˜¯ nullã€‚å¦‚æœä½ å¸Œæœ›è¿™ä¸ªå±æ€§å¿…é¡»è¦å®šä¹‰ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ getRequiredProperty() æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">BlankDisc <span class="title">disc</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> BlankDisc(env.getRequiredProperty(<span class="string">&quot;disc.title&quot;</span>),                        env.getRequiredProperty(<span class="string">&quot;disc.artist&quot;</span>));&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œå¦‚æœ disc.title æˆ– disc.artist å±æ€§æ²¡æœ‰å®šä¹‰çš„è¯ï¼Œå°†ä¼šæŠ›å‡º IllegalStateException å¼‚å¸¸ã€‚</p>
<p>å¦‚æœæƒ³æ£€æŸ¥ä¸€ä¸‹æŸä¸ªå±æ€§æ˜¯å¦å­˜åœ¨çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥è°ƒç”¨ Environment çš„ containsProperty() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boolean</span> titleExists = env.containsProperty(<span class="string">&quot;disc.title&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œå¦‚æœæƒ³å°†å±æ€§è§£æä¸ºç±»çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ getPropertyAsClass() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;CompactDisc&gt; cdClass = env.getPropertyAsClass(<span class="string">&quot;disc.class&quot;</span>, CompactDisc.class);</span><br></pre></td></tr></table></figure>

<p>é™¤äº†å±æ€§ç›¸å…³çš„åŠŸèƒ½ä»¥å¤–ï¼ŒEnvironment è¿˜æä¾›äº†ä¸€äº›æ–¹æ³•æ¥æ£€æŸ¥å“ªäº› profile å¤„äºæ¿€æ´»çŠ¶æ€ï¼š</p>
<ul>
<li>String[] getActiveProfiles()ï¼šè¿”å›æ¿€æ´» profile åç§°çš„æ•°ç»„ï¼›</li>
<li>String[] getDefaultProfiles()ï¼šè¿”å›é»˜è®¤ profile åç§°çš„æ•°ç»„ï¼›</li>
<li>boolean acceptsProfiles(Stringâ€¦ profiles)ï¼šå¦‚æœ environment æ”¯æŒç»™å®š profile çš„è¯ï¼Œå°±è¿”å› trueã€‚</li>
</ul>
<p>åœ¨ç¨‹åºæ¸…å• 3.6 ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ acceptsProfiles()ã€‚åœ¨é‚£ä¸ªä¾‹å­ä¸­ï¼ŒEnvironment æ˜¯ä» ConditionContext ä¸­è·å–åˆ°çš„ï¼Œåœ¨ bean åˆ›å»ºä¹‹å‰ï¼Œä½¿ç”¨ acceptsProfiles() æ–¹æ³•æ¥ç¡®ä¿ç»™å®š bean æ‰€éœ€çš„ profile å¤„äºæ¿€æ´»çŠ¶æ€ã€‚é€šå¸¸æ¥è®²ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šé¢‘ç¹ä½¿ç”¨ Environment ç›¸å…³çš„æ–¹æ³•ï¼Œä½†æ˜¯çŸ¥é“æœ‰è¿™äº›æ–¹æ³•è¿˜æ˜¯æœ‰å¥½å¤„çš„ã€‚</p>
<p>ç›´æ¥ä» Environment ä¸­æ£€ç´¢å±æ€§æ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œå°¤å…¶æ˜¯åœ¨ Java é…ç½®ä¸­è£…é… bean çš„æ—¶å€™ã€‚ä½†æ˜¯ï¼ŒSpring ä¹Ÿæä¾›äº†é€šè¿‡å ä½ç¬¦è£…é…å±æ€§çš„æ–¹æ³•ï¼Œè¿™äº›å ä½ç¬¦çš„å€¼ä¼šæ¥æºäºä¸€ä¸ªå±æ€§æºã€‚</p>
<p>è§£æå±æ€§å ä½ç¬¦</p>
<p>Spring ä¸€ç›´æ”¯æŒå°†å±æ€§å®šä¹‰åˆ°å¤–éƒ¨çš„å±æ€§çš„æ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨å ä½ç¬¦å€¼å°†å…¶æ’å…¥åˆ° Spring bean ä¸­ã€‚åœ¨ Spring è£…é…ä¸­ï¼Œå ä½ç¬¦çš„å½¢å¼ä¸ºä½¿ç”¨ â€œ${â€¦ }â€ åŒ…è£…çš„å±æ€§åç§°ã€‚ä½œä¸ºæ ·ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ XML ä¸­æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼è§£æ BlankDisc æ„é€ å™¨å‚æ•°ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sgtPeppers&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.BlankDisc&quot;</span>      <span class="attr">c:_title</span>=<span class="string">$&#123;disc.titile&#125;</span>      <span class="attr">c:_artist</span>=<span class="string">$&#123;disc.artist&#125;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œtitle æ„é€ å™¨å‚æ•°æ‰€ç»™å®šçš„å€¼æ˜¯ä»ä¸€ä¸ªå±æ€§ä¸­è§£æå¾—åˆ°çš„ï¼Œè¿™ä¸ªå±æ€§çš„åç§°ä¸º disc.titleã€‚artist å‚æ•°è£…é…çš„æ˜¯åä¸º disc.artist çš„å±æ€§å€¼ã€‚æŒ‰ç…§è¿™ç§æ–¹å¼ï¼Œ XML é…ç½®æ²¡æœ‰ä½¿ç”¨ä»»ä½•ç¡¬ç¼–ç çš„å€¼ï¼Œå®ƒçš„å€¼æ˜¯ä»é…ç½®æ–‡ä»¶ä»¥å¤–çš„ä¸€ä¸ªæºä¸­è§£æå¾—åˆ°çš„ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬ä¾èµ–äºç»„ä»¶æ‰«æå’Œè‡ªåŠ¨è£…é…æ¥åˆ›å»ºå’Œåˆå§‹åŒ–åº”ç”¨ç»„ä»¶çš„è¯ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰æŒ‡å®šå ä½ç¬¦çš„é…ç½®æ–‡ä»¶æˆ–ç±»äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ @Value æ³¨è§£ï¼Œå®ƒçš„ä½¿ç”¨æ–¹å¼ä¸ @Autowired æ³¨è§£éå¸¸ç›¸ä¼¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">BlankDisc</span><span class="params">(        <span class="meta">@Value(&quot;$&#123;disc.title&#125;&quot;)</span> String title,        <span class="meta">@Value(&quot;$&#123;disc.artist&#125;&quot;)</span> String artist)</span> </span>&#123;    <span class="keyword">this</span>.title = title;    <span class="keyword">this</span>.artist = artist;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†ä½¿ç”¨å ä½ç¬¦ï¼Œæˆ‘ä»¬å¿…é¡»è¦é…ç½®ä¸€ä¸ª PropertyPlaceholderConfigurer bean æˆ– PropertySourcesPlaceholderConfigurer beanã€‚ä» Spring 3.1å¼€å§‹ï¼Œæ¨èä½¿ç”¨ PropertySourcesPlaceholderConfigurerï¼Œå› ä¸ºå®ƒèƒ½å¤ŸåŸºäº Spring Environment åŠå…¶å±æ€§æºæ¥è§£æå ä½ç¬¦ã€‚</p>
<p>å¦‚ä¸‹çš„ @Bean æ–¹æ³•åœ¨ Java ä¸­é…ç½®äº† PropertySourcesPlaceholderConfigurerï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function"><span class="keyword">static</span> PropertySourcesPlaceholderConfigurer <span class="title">placeholderConfigurer</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> PropertySourcesPlaceholderConfigurer();&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æƒ³ä½¿ç”¨ XML é…ç½®çš„è¯ï¼ŒSpring context å‘½åç©ºé—´ä¸­çš„ <code>&lt;context:propertyplaceholder&gt;</code> å…ƒç´ å°†ä¼šä¸ºä½ ç”Ÿæˆ PropertySourcesPlaceholderConfigurer  beanï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>è§£æå¤–éƒ¨å±æ€§èƒ½å¤Ÿå°†å€¼çš„å¤„ç†æ¨è¿Ÿåˆ°è¿è¡Œæ—¶ï¼Œä½†æ˜¯å®ƒçš„å…³æ³¨ç‚¹åœ¨äºæ ¹æ®åç§°è§£ææ¥è‡ªäº Spring Environment å’Œå±æ€§æºçš„å±æ€§ã€‚è€Œ Spring è¡¨è¾¾å¼è¯­è¨€æä¾›äº†ä¸€ç§æ›´é€šç”¨çš„æ–¹å¼åœ¨è¿è¡Œæ—¶è®¡ç®—æ‰€è¦æ³¨å…¥çš„å€¼ã€‚</p>
<h4 id="ä½¿ç”¨-Spring-è¡¨è¾¾å¼è¯­è¨€è¿›è¡Œè£…é…"><a href="#ä½¿ç”¨-Spring-è¡¨è¾¾å¼è¯­è¨€è¿›è¡Œè£…é…" class="headerlink" title="ä½¿ç”¨ Spring è¡¨è¾¾å¼è¯­è¨€è¿›è¡Œè£…é…"></a>ä½¿ç”¨ Spring è¡¨è¾¾å¼è¯­è¨€è¿›è¡Œè£…é…</h4><p>Spring 3 å¼•å…¥äº† Spring è¡¨è¾¾å¼è¯­è¨€ï¼ˆSpring Expression Languageï¼ŒSpELï¼‰ï¼Œå®ƒèƒ½å¤Ÿä»¥ä¸€ç§å¼ºå¤§å’Œç®€æ´çš„æ–¹å¼å°†å€¼è£…é…åˆ° bean å±æ€§å’Œæ„é€ å™¨å‚æ•°ä¸­ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨çš„è¡¨è¾¾å¼ä¼šåœ¨è¿è¡Œæ—¶è®¡ç®—å¾—åˆ°å€¼ã€‚ä½¿ç”¨ SpELï¼Œä½ å¯ä»¥å®ç°è¶…ä¹æƒ³è±¡çš„è£…é…æ•ˆæœï¼Œè¿™æ˜¯ä½¿ç”¨å…¶ä»–çš„è£…é…æŠ€æœ¯éš¾ä»¥åšåˆ°çš„ï¼ˆç”šè‡³æ˜¯ä¸å¯èƒ½çš„ï¼‰ã€‚</p>
<p>SpEL æ‹¥æœ‰å¾ˆå¤šç‰¹æ€§ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>ä½¿ç”¨ bean çš„ ID æ¥å¼•ç”¨ beanï¼›</li>
<li>è°ƒç”¨æ–¹æ³•å’Œè®¿é—®å¯¹è±¡çš„å±æ€§ï¼›</li>
<li>å¯¹å€¼è¿›è¡Œç®—æœ¯ã€å…³ç³»å’Œé€»è¾‘è¿ç®—ï¼›</li>
<li>æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼›</li>
<li>é›†åˆæ“ä½œã€‚</li>
</ul>
<p>SpEL èƒ½å¤Ÿç”¨åœ¨ä¾èµ–æ³¨å…¥ä»¥å¤–çš„å…¶ä»–åœ°æ–¹ã€‚ä¾‹å¦‚ï¼ŒSpring Security æ”¯æŒä½¿ç”¨ SpEL è¡¨è¾¾å¼å®šä¹‰å®‰å…¨é™åˆ¶è§„åˆ™ã€‚å¦å¤–ï¼Œå¦‚æœä½ åœ¨ Spring MVC åº”ç”¨ä¸­ä½¿ç”¨ Thymeleaf æ¨¡æ¿ä½œä¸ºè§†å›¾çš„è¯ï¼Œé‚£ä¹ˆè¿™äº›æ¨¡æ¿å¯ä»¥ä½¿ç”¨ SpEL è¡¨è¾¾å¼å¼•ç”¨æ¨¡å‹æ•°æ®ã€‚</p>
<p>éœ€è¦äº†è§£çš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯ SpEL è¡¨è¾¾å¼è¦æ”¾åˆ° â€œ#{ â€¦ }â€ ä¹‹ä¸­ï¼Œè¿™ä¸å±æ€§å ä½ç¬¦æœ‰äº›ç±»ä¼¼ï¼Œå±æ€§å ä½ç¬¦éœ€è¦æ”¾åˆ° â€œ${ â€¦ }â€ ä¹‹ä¸­ã€‚ä¸‹é¢æ‰€å±•ç°çš„å¯èƒ½æ˜¯æœ€ç®€å•çš„SpELè¡¨è¾¾å¼äº†ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;1&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤å» â€œ#{ â€¦ }â€ æ ‡è®°ä¹‹åï¼Œå‰©ä¸‹çš„å°±æ˜¯ SpEL è¡¨è¾¾å¼ä½“äº†ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ•°å­—å¸¸é‡ã€‚è¿™ä¸ªè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœå°±æ˜¯æ•°å­— 1ï¼Œè¿™ææ€•å¹¶ä¸ä¼šè®©ä½ æ„Ÿåˆ°ä¸æ¯«æƒŠè®¶ã€‚</p>
<p>å½“ç„¶ï¼Œåœ¨å®é™…çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯èƒ½å¹¶ä¸ä¼šä½¿ç”¨è¿™ä¹ˆç®€å•çš„è¡¨è¾¾å¼ã€‚æˆ‘ä»¬å¯èƒ½ä¼šä½¿ç”¨æ›´åŠ æœ‰æ„æ€çš„è¡¨è¾¾å¼ï¼Œå¦‚ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;T(System).currentTimeMillis()&#125;</span><br></pre></td></tr></table></figure>

<p>å®ƒçš„æœ€ç»ˆç»“æœæ˜¯è®¡ç®—è¡¨è¾¾å¼çš„é‚£ä¸€åˆ»å½“å‰æ—¶é—´çš„æ¯«ç§’æ•°ã€‚T() è¡¨è¾¾å¼ä¼šå°† java.lang.System è§†ä¸º Java ä¸­å¯¹åº”çš„ç±»å‹ï¼Œå› æ­¤å¯ä»¥è°ƒç”¨å…¶ static ä¿®é¥°çš„currentTimeMillis() æ–¹æ³•ã€‚</p>
<p>SpEL è¡¨è¾¾å¼ä¹Ÿå¯ä»¥å¼•ç”¨å…¶ä»–çš„ bean æˆ–å…¶ä»– bean çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„è¡¨è¾¾å¼ä¼šè®¡ç®—å¾—åˆ° ID ä¸º sgtPeppers çš„ bean çš„ artist å±æ€§ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;sgtPeppers.artist&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ systemProperties å¯¹è±¡å¼•ç”¨ç³»ç»Ÿå±æ€§ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;systemProperties[&#x27;disc.title&#x27;]&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœé€šè¿‡ç»„ä»¶æ‰«æåˆ›å»º bean çš„è¯ï¼Œåœ¨æ³¨å…¥å±æ€§å’Œæ„é€ å™¨å‚æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ @Value æ³¨è§£ï¼Œè¿™ä¸ä¹‹å‰çœ‹åˆ°çš„å±æ€§å ä½ç¬¦éå¸¸ç±»ä¼¼ã€‚ä¸è¿‡ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æ‰€ä½¿ç”¨çš„ä¸æ˜¯å ä½ç¬¦è¡¨è¾¾å¼ï¼Œè€Œæ˜¯ SpEL è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„æ ·ä¾‹å±•ç°äº† BlankDiscï¼Œå®ƒä¼šä»ç³»ç»Ÿå±æ€§ä¸­è·å–ä¸“è¾‘åç§°å’Œè‰ºæœ¯å®¶çš„åå­—ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">BlankDisc</span><span class="params">(        <span class="meta">@Value(&quot;#&#123;systemProperties[&#x27;disc.title&#x27;]&#125;&quot;)</span> String title,        <span class="meta">@Value(&quot;#&#123;systemProperties[&#x27;disc.artist&#x27;]&#125;&quot;)</span> String artist)</span> </span>&#123;    <span class="keyword">this</span>.title = title;    <span class="keyword">this</span>.artist = artist;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ XML é…ç½®ä¸­ï¼Œä½ å¯ä»¥å°† SpEL è¡¨è¾¾å¼ä¼ å…¥<code> &lt;property&gt;</code> æˆ– <code>&lt;constructor-arg&gt;</code> çš„ value å±æ€§ä¸­ï¼Œæˆ–è€…å°†å…¶ä½œä¸º p-å‘½åç©ºé—´æˆ– c-å‘½åç©ºé—´æ¡ç›®çš„å€¼ã€‚ä¾‹å¦‚ï¼Œåœ¨å¦‚ä¸‹ BlankDisc bean çš„ XML å£°æ˜ä¸­ï¼Œæ„é€ å™¨å‚æ•°å°±æ˜¯é€šè¿‡ SpEL è¡¨è¾¾å¼è®¾ç½®çš„ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sgtPeppers&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.BlankDisc&quot;</span>      <span class="attr">c:_title</span>=<span class="string">&quot;#&#123;systemProperties[&#x27;disc.title&#x27;]&#125;&quot;</span>      <span class="attr">c:_artist</span>=<span class="string">&quot;#&#123;systemProperties[&#x27;disc.artist&#x27;]&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¡¨ç¤ºå­—é¢å€¼</p>
<p>æˆ‘ä»¬åœ¨å‰é¢å·²ç»çœ‹åˆ°äº†ä¸€ä¸ªä½¿ç”¨ SpEL æ¥è¡¨ç¤ºæ•´æ•°å­—é¢é‡çš„æ ·ä¾‹ã€‚å®ƒå®é™…ä¸Šè¿˜å¯ä»¥ç”¨æ¥è¡¨ç¤ºæµ®ç‚¹æ•°ã€String å€¼ä»¥åŠBoolean å€¼ã€‚</p>
<p>ä¸‹é¢çš„ SpEL è¡¨è¾¾å¼æ ·ä¾‹æ‰€è¡¨ç¤ºçš„å°±æ˜¯æµ®ç‚¹å€¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;3.14159&#125;</span><br></pre></td></tr></table></figure>

<p>æ•°å€¼è¿˜å¯ä»¥ä½¿ç”¨ç§‘å­¦è®°æ•°æ³•çš„æ–¹å¼è¿›è¡Œè¡¨ç¤ºã€‚å¦‚ä¸‹é¢çš„è¡¨è¾¾å¼è®¡ç®—å¾—åˆ°çš„å€¼å°±æ˜¯ 98,700ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;9.87E4&#125;</span><br></pre></td></tr></table></figure>

<p>SpEL è¡¨è¾¾å¼ä¹Ÿå¯ä»¥ç”¨æ¥è®¡ç®— String ç±»å‹çš„å­—é¢å€¼ï¼Œå¦‚ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;&#x27;Hello&#x27;&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œå­—é¢å€¼ true å’Œ false çš„è®¡ç®—ç»“æœå°±æ˜¯å®ƒä»¬å¯¹åº”çš„ Boolean ç±»å‹çš„å€¼ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;false&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ SpEL è¡¨è¾¾å¼ä¸­ï¼ŒåªåŒ…å«å­—é¢å€¼æƒ…å†µå¹¶æ²¡æœ‰å¤ªå¤§çš„ç”¨å¤„ã€‚ä½†éœ€è¦è®°ä½çš„ä¸€ç‚¹æ˜¯ï¼Œæ›´æœ‰æ„æ€çš„ SpEL è¡¨è¾¾å¼æ˜¯ç”±æ›´ç®€å•çš„è¡¨è¾¾å¼ç»„æˆçš„ï¼Œå› æ­¤äº†è§£åœ¨ SpEL ä¸­å¦‚ä½•ä½¿ç”¨å­—é¢é‡è¿˜æ˜¯å¾ˆæœ‰ç”¨å¤„çš„ã€‚å½“ç»„åˆæ›´ä¸ºå¤æ‚çš„è¡¨è¾¾å¼æ—¶ï¼Œä½ è¿Ÿæ—©ä¼šç”¨åˆ°å®ƒä»¬ã€‚</p>
<p>å¼•ç”¨ beanã€å±æ€§å’Œæ–¹æ³•</p>
<p>SpEL æ‰€èƒ½åšçš„å¦å¤–ä¸€ä»¶åŸºç¡€çš„äº‹æƒ…å°±æ˜¯é€šè¿‡ ID å¼•ç”¨å…¶ä»–çš„ beanã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ SpEL å°†ä¸€ä¸ª bean è£…é…åˆ°å¦å¤–ä¸€ä¸ª bean çš„å±æ€§ä¸­ï¼Œæ­¤æ—¶è¦ä½¿ç”¨ bean ID ä½œä¸º SpEL è¡¨è¾¾å¼ï¼ˆåœ¨æœ¬ä¾‹ä¸­ï¼Œä¹Ÿå°±æ˜¯ sgtPeppersï¼‰ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;sgtPeppers&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬æƒ³åœ¨ä¸€ä¸ªè¡¨è¾¾å¼ä¸­å¼•ç”¨ sgtPeppers çš„ artist å±æ€§ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;sgtPeppers.artist&#125;</span><br></pre></td></tr></table></figure>

<p>è¡¨è¾¾å¼ä¸»ä½“çš„ç¬¬ä¸€éƒ¨åˆ†å¼•ç”¨äº†ä¸€ä¸ª ID ä¸º sgtPeppers çš„ beanï¼Œåˆ†å‰²ç¬¦ä¹‹åæ˜¯å¯¹ artist å±æ€§çš„å¼•ç”¨ã€‚</p>
<p>é™¤äº†å¼•ç”¨ bean çš„å±æ€§ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è°ƒç”¨ bean ä¸Šçš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æœ‰å¦å¤–ä¸€ä¸ª beanï¼Œå®ƒçš„ ID ä¸º artistSelectorï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ SpEL è¡¨è¾¾å¼ä¸­æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼æ¥è°ƒç”¨ bean çš„ selectArtist() æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;sgtPeppers.selectAtist()&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºè¢«è°ƒç”¨æ–¹æ³•çš„è¿”å›å€¼æ¥è¯´ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥è°ƒç”¨å®ƒçš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ selectArtist() æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª Stringï¼Œé‚£ä¹ˆå¯ä»¥è°ƒç”¨ toUpperCase() å°†æ•´ä¸ªè‰ºæœ¯å®¶çš„åå­—æ”¹ä¸ºå¤§å†™å­—æ¯å½¢å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;sgtPeppers.selectAtist().toUpperCase()&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ selectArtist() çš„è¿”å›å€¼ä¸æ˜¯ null çš„è¯ï¼Œè¿™æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ä¸ºäº†é¿å…å‡ºç° NullPointerExceptionï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»å‹å®‰å…¨çš„è¿ç®—ç¬¦ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;sgtPeppers.selectAtist()?.toUpperCase()&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ä¹‹å‰åªæ˜¯ä½¿ç”¨ç‚¹å·ï¼ˆ.ï¼‰æ¥è®¿é—® toUpperCase() æ–¹æ³•ä¸åŒï¼Œç°åœ¨æˆ‘ä»¬ä½¿ç”¨äº† â€œ?.â€ è¿ç®—ç¬¦ã€‚è¿™ä¸ªè¿ç®—ç¬¦èƒ½å¤Ÿåœ¨è®¿é—®å®ƒå³è¾¹çš„å†…å®¹ä¹‹å‰ï¼Œç¡®ä¿å®ƒæ‰€å¯¹åº”çš„å…ƒç´ ä¸æ˜¯ nullã€‚æ‰€ä»¥ï¼Œå¦‚æœ selectArtist() çš„è¿”å›å€¼æ˜¯ null çš„è¯ï¼Œé‚£ä¹ˆ SpEL å°†ä¸ä¼šè°ƒç”¨ toUpperCase() æ–¹æ³•ã€‚è¡¨è¾¾å¼çš„è¿”å›å€¼ä¼šæ˜¯ nullã€‚</p>
<p>åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨ç±»å‹</p>
<p>å¦‚æœè¦åœ¨ SpEL ä¸­è®¿é—®ç±»ä½œç”¨åŸŸçš„æ–¹æ³•å’Œå¸¸é‡çš„è¯ï¼Œè¦ä¾èµ– T() è¿™ä¸ªå…³é”®çš„è¿ç®—ç¬¦ã€‚ä¾‹å¦‚ï¼Œä¸ºäº†åœ¨ SpEL ä¸­è¡¨è¾¾ Java çš„ Math ç±»ï¼Œéœ€è¦æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼ä½¿ç”¨ T() è¿ç®—ç¬¦ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T(java.lang.Math)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ‰€ç¤ºçš„ T() è¿ç®—ç¬¦çš„ç»“æœä¼šæ˜¯ä¸€ä¸ª Class å¯¹è±¡ï¼Œä»£è¡¨äº† java.lang.Mathã€‚å¦‚æœéœ€è¦çš„è¯ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å°†å…¶è£…é…åˆ°ä¸€ä¸ª Class ç±»å‹çš„ bean å±æ€§ä¸­ã€‚ä½†æ˜¯ T() è¿ç®—ç¬¦çš„çœŸæ­£ä»·å€¼åœ¨äºå®ƒèƒ½å¤Ÿè®¿é—®ç›®æ ‡ç±»å‹çš„é™æ€æ–¹æ³•å’Œå¸¸é‡ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡å¦‚ä½ éœ€è¦å°† PI å€¼è£…é…åˆ° bean å±æ€§ä¸­ã€‚å¦‚ä¸‹çš„ SpEL å°±èƒ½å®Œæˆè¯¥ä»»åŠ¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T(java.lang.Math).PI</span><br></pre></td></tr></table></figure>

<p>ä¸ä¹‹ç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ T() è¿ç®—ç¬¦æ‰€å¾—åˆ°ç±»å‹çš„é™æ€æ–¹æ³•ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†é€šè¿‡ T() è°ƒç”¨ System.currentTimeMillis()ã€‚å¦‚ä¸‹çš„è¿™ä¸ªæ ·ä¾‹ä¼šè®¡ç®—å¾—åˆ°ä¸€ä¸ª0åˆ°1ä¹‹é—´çš„éšæœºæ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T(java.lang.Math).random()</span><br></pre></td></tr></table></figure>

<p>SpELè¿ç®—ç¬¦</p>
<p>SpELæä¾›äº†å¤šä¸ªè¿ç®—ç¬¦ï¼Œè¿™äº›è¿ç®—ç¬¦å¯ä»¥ç”¨åœ¨SpELè¡¨è¾¾å¼çš„å€¼ä¸Šã€‚</p>
<table>
<thead>
<tr>
<th>è¿ç®—ç¬¦ç±»å‹</th>
<th>è¿ã€€ç®—ã€€ç¬¦</th>
</tr>
</thead>
<tbody><tr>
<td>ç®—æœ¯è¿ç®—</td>
<td>+ã€-ã€ * ã€/ã€%ã€^</td>
</tr>
<tr>
<td>æ¯”è¾ƒè¿ç®—</td>
<td>&lt;ã€ &gt; ã€ == ã€ &lt;= ã€ &gt;= ã€ lt ã€ gt ã€ eq ã€ le ã€ ge</td>
</tr>
<tr>
<td>é€»è¾‘è¿ç®—</td>
<td>and ã€ or ã€ not ã€â”‚</td>
</tr>
<tr>
<td>æ¡ä»¶è¿ç®—</td>
<td>?: (ternary) ã€ ?: (Elvis)</td>
</tr>
<tr>
<td>æ­£åˆ™è¡¨è¾¾å¼</td>
<td>matches</td>
</tr>
</tbody></table>
<p>ä½œä¸ºä½¿ç”¨ä¸Šè¿°è¿ç®—ç¬¦çš„ä¸€ä¸ªç®€å•æ ·ä¾‹ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ª SpEL è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;2 * T(java.lang.Math).PI * circle.radius&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ä»…æ˜¯ä½¿ç”¨ SpEL ä¸­ä¹˜æ³•è¿ç®—ç¬¦ï¼ˆ*ï¼‰çš„ç»ä½³æ ·ä¾‹ï¼Œå®ƒä¹Ÿä¸ºä½ å±•ç°äº†å¦‚ä½•å°†ç®€å•çš„è¡¨è¾¾å¼ç»„åˆä¸ºæ›´ä¸ºå¤æ‚çš„è¡¨è¾¾å¼ã€‚åœ¨è¿™é‡Œ PI çš„å€¼ä¹˜ä»¥ 2ï¼Œç„¶åå†ä¹˜ä»¥ radius å±æ€§çš„å€¼ï¼Œè¿™ä¸ªå±æ€§æ¥æºäº ID ä¸º circle çš„ beanã€‚å®é™…ä¸Šï¼Œå®ƒè®¡ç®—äº† circle bean ä¸­æ‰€å®šä¹‰åœ†çš„å‘¨é•¿ã€‚</p>
<p>ç±»ä¼¼åœ°ï¼Œä½ è¿˜å¯ä»¥åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨ä¹˜æ–¹è¿ç®—ç¬¦ï¼ˆ^ï¼‰æ¥è®¡ç®—åœ†çš„é¢ç§¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;T(java.lang.Math).PI * circle.radius^2&#125;</span><br></pre></td></tr></table></figure>

<p>â€œ^â€ æ˜¯ç”¨äºä¹˜æ–¹è®¡ç®—çš„è¿ç®—ç¬¦ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥è®¡ç®—åœ†åŠå¾„çš„å¹³æ–¹ã€‚</p>
<p>å½“ä½¿ç”¨ String ç±»å‹çš„å€¼æ—¶ï¼Œâ€œ+â€ è¿ç®—ç¬¦æ‰§è¡Œçš„æ˜¯è¿æ¥æ“ä½œï¼Œä¸åœ¨ Java ä¸­æ˜¯ä¸€æ ·çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;disc.title + &#x27;by&#x27; + disc.artist&#125;</span><br></pre></td></tr></table></figure>

<p>SpEL åŒæ—¶è¿˜æä¾›äº†æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œç”¨æ¥åœ¨è¡¨è¾¾å¼ä¸­å¯¹å€¼è¿›è¡Œå¯¹æ¯”ã€‚æ¯”è¾ƒè¿ç®—ç¬¦æœ‰ä¸¤ç§å½¢å¼ï¼šç¬¦å·å½¢å¼å’Œæ–‡æœ¬å½¢å¼ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¬¦å·è¿ç®—ç¬¦ä¸å¯¹åº”çš„æ–‡æœ¬è¿ç®—ç¬¦ä½œç”¨æ˜¯ç›¸åŒçš„ï¼Œä½¿ç”¨å“ªä¸€ç§å½¢å¼å‡å¯ä»¥ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè¦æ¯”è¾ƒä¸¤ä¸ªæ•°å­—æ˜¯ä¸æ˜¯ç›¸ç­‰ï¼Œå¯ä»¥ä½¿ç”¨åŒç­‰å·è¿ç®—ç¬¦ï¼ˆ==ï¼‰ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;counter.total == 100&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ–‡æœ¬å‹çš„ eq è¿ç®—ç¬¦ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;counter.total eq 100&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸¤ç§æ–¹å¼çš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœæ˜¯ä¸ª Boolean å€¼ï¼šå¦‚æœ counter.total ç­‰äº 100 çš„è¯ï¼Œä¸º trueï¼Œå¦åˆ™ä¸º falseã€‚</p>
<p>SpEL è¿˜æä¾›äº†ä¸‰å…ƒè¿ç®—ç¬¦ï¼ˆternaryï¼‰ï¼Œå®ƒä¸ Java ä¸­çš„ä¸‰å…ƒè¿ç®—ç¬¦éå¸¸ç±»ä¼¼ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„è¡¨è¾¾å¼ä¼šåˆ¤æ–­å¦‚æœ scoreboard.score&gt;1000 çš„è¯ï¼Œè®¡ç®—ç»“æœä¸º Stringç±»å‹çš„ â€œWinnerï¼â€ï¼Œå¦åˆ™çš„è¯ï¼Œç»“æœä¸º Loserï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;scoreboard.score &gt; 1000 ? &quot;Winner&quot; : &quot;Loser&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‰å…ƒè¿ç®—ç¬¦çš„ä¸€ä¸ªå¸¸è§åœºæ™¯å°±æ˜¯æ£€æŸ¥ null å€¼ï¼Œå¹¶ç”¨ä¸€ä¸ªé»˜è®¤å€¼æ¥æ›¿ä»£ nullã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„è¡¨è¾¾å¼ä¼šåˆ¤æ–­ disc.title çš„å€¼æ˜¯ä¸æ˜¯ nullï¼Œå¦‚æœæ˜¯ null çš„è¯ï¼Œé‚£ä¹ˆè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœå°±ä¼šæ˜¯ â€œRattle and Humâ€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;disc.title ?: &#x27;Rattle and Hum&#x27;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§è¡¨è¾¾å¼é€šå¸¸ç§°ä¸º Elvis è¿ç®—ç¬¦ã€‚è¿™ä¸ªå¥‡æ€ªåç§°çš„æ¥å†æ˜¯ï¼Œå½“ä½¿ç”¨ç¬¦å·æ¥è¡¨ç¤ºè¡¨æƒ…æ—¶ï¼Œé—®å·çœ‹èµ·æ¥å¾ˆåƒæ˜¯çŒ«ç‹ï¼ˆElvis Presleyï¼‰çš„å¤´å‘ã€‚</p>
<p>è®¡ç®—æ­£åˆ™è¡¨è¾¾å¼</p>
<p>å½“å¤„ç†æ–‡æœ¬æ—¶ï¼Œæœ‰æ—¶æ£€æŸ¥æ–‡æœ¬æ˜¯å¦åŒ¹é…æŸç§æ¨¡å¼æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚SpEL é€šè¿‡ matches è¿ç®—ç¬¦æ”¯æŒè¡¨è¾¾å¼ä¸­çš„æ¨¡å¼åŒ¹é…ã€‚matches è¿ç®—ç¬¦å¯¹ String ç±»å‹çš„æ–‡æœ¬ï¼ˆä½œä¸ºå·¦è¾¹å‚æ•°ï¼‰åº”ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼ˆä½œä¸ºå³è¾¹å‚æ•°ï¼‰ã€‚matches çš„è¿ç®—ç»“æœä¼šè¿”å›ä¸€ä¸ª Boolean ç±»å‹çš„å€¼ï¼šå¦‚æœä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…ï¼Œåˆ™è¿”å› trueï¼›å¦åˆ™è¿”å› falseã€‚</p>
<p>ä¸ºäº†è¿›ä¸€æ­¥è§£é‡Š matches è¿ç®—ç¬¦ï¼Œå‡è®¾æˆ‘ä»¬æƒ³åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„é‚®ä»¶åœ°å€ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ matches è¿ç®—ç¬¦ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;admin.email mathes &#x27;[a-zA-Z0-9._%+-]+@[a-zA-Z0-9._%+-]+\\.com&#x27;&#125;</span><br></pre></td></tr></table></figure>

<p>è®¡ç®—é›†åˆ</p>
<p>SpEL ä¸­æœ€ä»¤äººæƒŠå¥‡çš„ä¸€äº›æŠ€å·§æ˜¯ä¸é›†åˆå’Œæ•°ç»„ç›¸å…³çš„ã€‚æœ€ç®€å•çš„äº‹æƒ…å¯èƒ½å°±æ˜¯å¼•ç”¨åˆ—è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ äº†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;jukebox.songs[4].title&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè¡¨è¾¾å¼ä¼šè®¡ç®— songs é›†åˆä¸­ç¬¬äº”ä¸ªï¼ˆåŸºäºé›¶å¼€å§‹ï¼‰å…ƒç´ çš„ title å±æ€§ï¼Œè¿™ä¸ªé›†åˆæ¥æºäº ID ä¸º jukebox beanã€‚</p>
<p>ä¸ºäº†è®©è¿™ä¸ªè¡¨è¾¾å¼æ›´ä¸°å¯Œä¸€äº›ï¼Œå‡è®¾æˆ‘ä»¬è¦ä» jukebox ä¸­éšæœºé€‰æ‹©ä¸€é¦–æ­Œï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;jukebox.songs[T(java.lang.Math).random() * jukebox.songs.size()].title&#125;</span><br></pre></td></tr></table></figure>

<p>â€œ[]â€ è¿ç®—ç¬¦ç”¨æ¥ä»é›†åˆæˆ–æ•°ç»„ä¸­æŒ‰ç…§ç´¢å¼•è·å–å…ƒç´ ï¼Œå®é™…ä¸Šï¼Œå®ƒè¿˜å¯ä»¥ä» String ä¸­è·å–ä¸€ä¸ªå­—ç¬¦ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;&#x27;this is a test&#x27;[3]&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè¡¨è¾¾å¼å¼•ç”¨äº† String ä¸­çš„ç¬¬ 4 ä¸ªï¼ˆåŸºäºé›¶å¼€å§‹ï¼‰å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯ â€œsâ€ã€‚</p>
<p>SpEL è¿˜æä¾›äº†æŸ¥è¯¢è¿ç®—ç¬¦ï¼ˆ.?[]ï¼‰ï¼Œå®ƒä¼šç”¨æ¥å¯¹é›†åˆè¿›è¡Œè¿‡æ»¤ï¼Œå¾—åˆ°é›†åˆçš„ä¸€ä¸ªå­é›†ã€‚ä½œä¸ºé˜è¿°çš„æ ·ä¾‹ï¼Œå‡è®¾ä½ å¸Œæœ›å¾—åˆ° jukebox ä¸­ artist å±æ€§ä¸º Aerosmith çš„æ‰€æœ‰æ­Œæ›²ã€‚å¦‚ä¸‹çš„è¡¨è¾¾å¼å°±ä½¿ç”¨æŸ¥è¯¢è¿ç®—ç¬¦å¾—åˆ°äº† Aerosmith çš„æ‰€æœ‰æ­Œæ›²ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@&#123;jukebox.songs.?[artist eq &#x27;Aerosmith&#x27;]&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œé€‰æ‹©è¿ç®—ç¬¦åœ¨å®ƒçš„æ–¹æ‹¬å·ä¸­æ¥å—å¦ä¸€ä¸ªè¡¨è¾¾å¼ã€‚å½“ SpEL è¿­ä»£æ­Œæ›²åˆ—è¡¨çš„æ—¶å€™ï¼Œä¼šå¯¹æ­Œæ›²é›†åˆä¸­çš„æ¯ä¸€ä¸ªæ¡ç›®è®¡ç®—è¿™ä¸ªè¡¨è¾¾å¼ã€‚å¦‚æœè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœä¸º true çš„è¯ï¼Œé‚£ä¹ˆæ¡ç›®ä¼šæ”¾åˆ°æ–°çš„é›†åˆä¸­ã€‚å¦åˆ™çš„è¯ï¼Œå®ƒå°±ä¸ä¼šæ”¾åˆ°æ–°é›†åˆä¸­ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå†…éƒ¨çš„è¡¨è¾¾å¼ä¼šæ£€æŸ¥æ­Œæ›²çš„ artist å±æ€§æ˜¯ä¸æ˜¯ç­‰äº Aerosmithã€‚</p>
<p>SpEL è¿˜æä¾›äº†å¦å¤–ä¸¤ä¸ªæŸ¥è¯¢è¿ç®—ç¬¦ï¼šâ€œ.^[]â€ å’Œ â€œ.$[]â€ï¼Œå®ƒä»¬åˆ†åˆ«ç”¨æ¥åœ¨é›†åˆä¸­æŸ¥è¯¢ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹å’Œæœ€åä¸€ä¸ªåŒ¹é…é¡¹ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸‹é¢çš„è¡¨è¾¾å¼ï¼Œå®ƒä¼šæŸ¥æ‰¾åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ª artist å±æ€§ä¸º Aerosmith çš„æ­Œæ›²ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;jukebox.songs.^[artist eq &#x27;Aerosmith&#x27;]&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼ŒSpEL è¿˜æä¾›äº†æŠ•å½±è¿ç®—ç¬¦ï¼ˆ.![]ï¼‰ï¼Œå®ƒä¼šä»é›†åˆçš„æ¯ä¸ªæˆå‘˜ä¸­é€‰æ‹©ç‰¹å®šçš„å±æ€§æ”¾åˆ°å¦å¤–ä¸€ä¸ªé›†åˆä¸­ã€‚ä½œä¸ºæ ·ä¾‹ï¼Œå‡è®¾æˆ‘ä»¬ä¸æƒ³è¦æ­Œæ›²å¯¹è±¡çš„é›†åˆï¼Œè€Œæ˜¯æ‰€æœ‰æ­Œæ›²åç§°çš„é›†åˆã€‚å¦‚ä¸‹çš„è¡¨è¾¾å¼ä¼šå°† title å±æ€§æŠ•å½±åˆ°ä¸€ä¸ªæ–°çš„ String ç±»å‹çš„é›†åˆä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;jukebox.songs.![title]&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šï¼ŒæŠ•å½±æ“ä½œå¯ä»¥ä¸å…¶ä»–ä»»æ„çš„ SpEL è¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„è¡¨è¾¾å¼è·å¾— Aerosmith æ‰€æœ‰æ­Œæ›²çš„åç§°åˆ—è¡¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;jukebox.songs.?[artist eq <span class="string">&#x27;Aerosmith&#x27;</span>].![title]&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰€ä»‹ç»çš„åªæ˜¯ SpEL åŠŸèƒ½çš„ä¸€ä¸ªçš®æ¯›ã€‚åœ¨æœ¬ä¹¦ä¸­è¿˜æœ‰æ›´å¤šçš„æœºä¼šç»§ç»­ä»‹ç» SpELï¼Œå°¤å…¶æ˜¯åœ¨å®šä¹‰å®‰å…¨è§„åˆ™çš„æ—¶å€™ã€‚</p>
<p>ç°åœ¨å¯¹ SpEL çš„ä»‹ç»è¦å‘Šä¸€æ®µè½äº†ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæç¤ºã€‚åœ¨åŠ¨æ€æ³¨å…¥å€¼åˆ° Spring bean æ—¶ï¼ŒSpEL æ˜¯ä¸€ç§å¾ˆä¾¿åˆ©å’Œå¼ºå¤§çš„æ–¹å¼ã€‚æˆ‘ä»¬æœ‰æ—¶ä¼šå¿ä¸ä½ç¼–å†™å¾ˆå¤æ‚çš„è¡¨è¾¾å¼ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸è¦è®©ä½ çš„è¡¨è¾¾å¼å¤ªæ™ºèƒ½ã€‚ä½ çš„è¡¨è¾¾å¼è¶Šæ™ºèƒ½ï¼Œå¯¹å®ƒçš„æµ‹è¯•å°±è¶Šé‡è¦ã€‚SpEL æ¯•ç«Ÿåªæ˜¯ String ç±»å‹çš„å€¼ï¼Œå¯èƒ½æµ‹è¯•èµ·æ¥å¾ˆå›°éš¾ã€‚é‰´äºè¿™ä¸€ç‚¹ï¼Œæˆ‘å»ºè®®å°½å¯èƒ½è®©è¡¨è¾¾å¼ä¿æŒç®€æ´ï¼Œè¿™æ ·æµ‹è¯•ä¸ä¼šæ˜¯ä»€ä¹ˆå¤§é—®é¢˜ã€‚</p>
<h3 id="å°ç»“-2"><a href="#å°ç»“-2" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>æˆ‘ä»¬åœ¨æœ¬ç« ä»‹ç»äº†è®¸å¤šèƒŒæ™¯çŸ¥è¯†ï¼Œåœ¨ç¬¬ 2 ç« æ‰€ä»‹ç»çš„åŸºæœ¬ bean è£…é…åŸºç¡€ä¹‹ä¸Šï¼Œåˆå­¦ä¹ äº†ä¸€äº›å¼ºå¤§çš„é«˜çº§è£…é…æŠ€å·§ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å­¦ä¹ äº† Spring profileï¼Œå®ƒè§£å†³äº† Spring bean è¦è·¨å„ç§éƒ¨ç½²ç¯å¢ƒçš„é€šç”¨é—®é¢˜ã€‚åœ¨è¿è¡Œæ—¶ï¼Œé€šè¿‡å°†ç¯å¢ƒç›¸å…³çš„ bean ä¸å½“å‰æ¿€æ´»çš„ profile è¿›è¡ŒåŒ¹é…ï¼ŒSpring èƒ½å¤Ÿè®©ç›¸åŒçš„éƒ¨ç½²å•å…ƒè·¨å¤šç§ç¯å¢ƒè¿è¡Œï¼Œè€Œä¸éœ€è¦è¿›è¡Œé‡æ–°æ„å»ºã€‚</p>
<p>Profile bean æ˜¯åœ¨è¿è¡Œæ—¶æ¡ä»¶åŒ–åˆ›å»º bean çš„ä¸€ç§æ–¹å¼ï¼Œä½†æ˜¯ Spring 4 æä¾›äº†ä¸€ç§æ›´ä¸ºé€šç”¨çš„æ–¹å¼ï¼Œé€šè¿‡è¿™ç§æ–¹å¼èƒ½å¤Ÿå£°æ˜æŸäº› bean çš„åˆ›å»ºä¸å¦è¦ä¾èµ–äºç»™å®šæ¡ä»¶çš„è¾“å‡ºç»“æœã€‚ç»“åˆä½¿ç”¨ @Conditional æ³¨è§£å’Œ Spring Condition æ¥å£çš„å®ç°ï¼Œèƒ½å¤Ÿä¸ºå¼€å‘äººå‘˜æä¾›ä¸€ç§å¼ºå¤§å’Œçµæ´»çš„æœºåˆ¶ï¼Œå®ç°æ¡ä»¶åŒ–åœ°åˆ›å»º beanã€‚</p>
<p>æˆ‘ä»¬è¿˜çœ‹äº†ä¸¤ç§è§£å†³è‡ªåŠ¨è£…é…æ­§ä¹‰æ€§çš„æ–¹æ³•ï¼šé¦–é€‰ bean ä»¥åŠé™å®šç¬¦ã€‚</p>
<p>å°½ç®¡å°†æŸä¸ª bean è®¾ç½®ä¸ºé¦–é€‰ bean æ˜¯å¾ˆç®€å•çš„ï¼Œä½†è¿™ç§æ–¹å¼ä¹Ÿæœ‰å…¶å±€é™æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•å°†ä¸€ç»„å¯é€‰çš„è‡ªåŠ¨è£…é… beanï¼Œå€ŸåŠ©é™å®šç¬¦å°†å…¶èŒƒå›´ç¼©å°åˆ°åªæœ‰ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„ beanã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜çœ‹åˆ°äº†å¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰çš„é™å®šç¬¦æ³¨è§£ï¼Œè¿™äº›é™å®šç¬¦æè¿°äº† bean çš„ç‰¹æ€§ã€‚</p>
<p>å°½ç®¡å¤§å¤šæ•°çš„ Spring bean éƒ½æ˜¯ä»¥å•ä¾‹çš„æ–¹å¼åˆ›å»ºçš„ï¼Œä½†æœ‰çš„æ—¶å€™å…¶ä»–çš„åˆ›å»ºç­–ç•¥æ›´ä¸ºåˆé€‚ã€‚Spring èƒ½å¤Ÿè®© bean ä»¥å•ä¾‹ã€åŸå‹ã€è¯·æ±‚ä½œç”¨åŸŸæˆ–ä¼šè¯ä½œç”¨åŸŸçš„æ–¹å¼æ¥åˆ›å»ºã€‚åœ¨å£°æ˜è¯·æ±‚ä½œç”¨åŸŸæˆ–ä¼šè¯ä½œç”¨åŸŸçš„ bean çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜å­¦ä¹ äº†å¦‚ä½•åˆ›å»ºä½œç”¨åŸŸä»£ç†ï¼Œå®ƒåˆ†ä¸ºåŸºäºç±»çš„ä»£ç†å’ŒåŸºäºæ¥å£çš„ä»£ç†çš„ä¸¤ç§æ–¹å¼ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬å­¦ä¹ äº† Spring è¡¨è¾¾å¼è¯­è¨€ï¼Œå®ƒèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶è®¡ç®—è¦æ³¨å…¥åˆ° bean å±æ€§ä¸­çš„å€¼ã€‚</p>
<p>å¯¹äº bean è£…é…ï¼Œæˆ‘ä»¬å·²ç»æŒæ¡äº†æ‰å®çš„åŸºç¡€çŸ¥è¯†ï¼Œç°åœ¨æˆ‘ä»¬è¦å°†æ³¨æ„åŠ›è½¬å‘é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆaspect-oriented programming ï¼ŒAOPï¼‰äº†ã€‚ä¾èµ–æ³¨å…¥èƒ½å¤Ÿå°†ç»„ä»¶åŠå…¶åä½œçš„å…¶ä»–ç»„ä»¶è§£è€¦ï¼Œä¸ä¹‹ç±»ä¼¼ï¼ŒAOP æœ‰åŠ©äºå°†åº”ç”¨ç»„ä»¶ä¸è·¨å¤šä¸ªç»„ä»¶çš„ä»»åŠ¡è¿›è¡Œè§£è€¦ã€‚åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†ä¼šæ·±å…¥å­¦ä¹ åœ¨ Spring ä¸­å¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨åˆ‡é¢ã€‚ </p>
<h2 id="é¢å‘åˆ‡é¢çš„-Spring"><a href="#é¢å‘åˆ‡é¢çš„-Spring" class="headerlink" title="é¢å‘åˆ‡é¢çš„ Spring"></a>é¢å‘åˆ‡é¢çš„ Spring</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>é¢å‘åˆ‡é¢ç¼–ç¨‹çš„åŸºæœ¬åŸç†</li>
<li>é€šè¿‡ POJO åˆ›å»ºåˆ‡é¢</li>
<li>ä½¿ç”¨ @AspectJ æ³¨è§£</li>
<li>ä¸º AspectJ åˆ‡é¢æ³¨å…¥ä¾èµ–</li>
</ul>
<p>åœ¨ç¼–å†™æœ¬ç« æ—¶ï¼Œå¾—å…‹è¨æ–¯å·ï¼ˆæˆ‘æ‰€å±…ä½çš„åœ°æ–¹ï¼‰æ­£å€¼ç››å¤ï¼Œè¿™å‡ å¤©æ­£åœ¨ç»å†åˆ›å†å²è®°å½•çš„é«˜æ¸©å¤©æ°”ã€‚è¿™é‡ŒçœŸçš„éå¸¸çƒ­ï¼Œåœ¨è¿™ç§å¤©æ°”ä¸‹ï¼Œç©ºè°ƒå½“ç„¶æ˜¯å¿…ä¸å¯å°‘çš„ã€‚ä½†æ˜¯ç©ºè°ƒçš„ç¼ºç‚¹æ˜¯å®ƒä¼šè€—ç”µï¼Œè€Œç”µéœ€è¦é’±ã€‚ä¸ºäº†äº«å—å‡‰çˆ½å’Œèˆ’é€‚ï¼Œæˆ‘ä»¬æ²¡æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥é¿å…è¿™ç§å¼€é”€ã€‚è¿™æ˜¯å› ä¸ºæ¯å®¶æ¯æˆ·éƒ½æœ‰ä¸€ä¸ªç”µè¡¨æ¥è®°å½•ç”¨ç”µé‡ï¼Œæ¯ä¸ªæœˆéƒ½ä¼šæœ‰äººæ¥æŸ¥ç”µè¡¨ï¼Œè¿™æ ·ç”µåŠ›å…¬å¸å°±çŸ¥é“åº”è¯¥æ”¶å–å¤šå°‘è´¹ç”¨äº†ã€‚</p>
<p>ç°åœ¨æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰ç”µè¡¨ï¼Œä¹Ÿæ²¡æœ‰äººæ¥æŸ¥çœ‹ç”¨ç”µé‡ï¼Œå‡è®¾ç°åœ¨ç”±æˆ·ä¸»æ¥è”ç³»ç”µåŠ›å…¬å¸å¹¶æŠ¥å‘Šè‡ªå·±çš„ç”¨ç”µé‡ã€‚è™½ç„¶å¯èƒ½ä¼šæœ‰ä¸€äº›ç‰¹åˆ«æ‰§ç€çš„æˆ·ä¸»ä¼šè¯¦ç»†è®°å½•ä½¿ç”¨ç”µç¯ã€ç”µè§†å’Œç©ºè°ƒçš„æƒ…å†µï¼Œä½†å¤§å¤šæ•°äººè‚¯å®šä¸ä¼šè¿™ä¹ˆåšã€‚åŸºäºä¿¡ç”¨çš„ç”µåŠ›æ”¶è´¹å¯¹äºæ¶ˆè´¹è€…å¯èƒ½éå¸¸ä¸é”™ï¼Œä½†å¯¹äºç”µåŠ›å…¬å¸æ¥è¯´ç»“æœå¯èƒ½å°±ä¸é‚£ä¹ˆç¾å¦™äº†ã€‚</p>
<p>ç›‘æ§ç”¨ç”µé‡æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½ï¼Œä½†å¹¶ä¸æ˜¯å¤§å¤šæ•°å®¶åº­é‡ç‚¹å…³æ³¨çš„é—®é¢˜ã€‚æ‰€æœ‰å®¶åº­å®é™…ä¸Šæ‰€å…³æ³¨çš„å¯èƒ½æ˜¯ä¿®å‰ªè‰åªã€ç”¨å¸å°˜å™¨æ¸…ç†åœ°æ¯¯ã€æ‰“æ‰«æµ´å®¤ç­‰äº‹é¡¹ã€‚ä»å®¶åº­çš„è§’åº¦æ¥çœ‹ï¼Œç›‘æ§æˆ¿å±‹çš„ç”¨ç”µé‡æ˜¯ä¸€ä¸ªè¢«åŠ¨äº‹ä»¶ï¼ˆå…¶å®ä¿®å‰ªè‰åªä¹Ÿæ˜¯ä¸€ä¸ªè¢«åŠ¨äº‹ä»¶â€”â€”ç‰¹åˆ«æ˜¯åœ¨ç‚çƒ­çš„å¤©æ°”ä¸‹ï¼‰ã€‚</p>
<p>è½¯ä»¶ç³»ç»Ÿä¸­çš„ä¸€äº›åŠŸèƒ½å°±åƒæˆ‘ä»¬å®¶é‡Œçš„ç”µè¡¨ä¸€æ ·ã€‚è¿™äº›åŠŸèƒ½éœ€è¦ç”¨åˆ°åº”ç”¨ç¨‹åºçš„å¤šä¸ªåœ°æ–¹ï¼Œä½†æ˜¯æˆ‘ä»¬åˆä¸æƒ³åœ¨æ¯ä¸ªç‚¹éƒ½æ˜ç¡®è°ƒç”¨å®ƒä»¬ã€‚æ—¥å¿—ã€å®‰å…¨å’Œäº‹åŠ¡ç®¡ç†çš„ç¡®éƒ½å¾ˆé‡è¦ï¼Œä½†å®ƒä»¬æ˜¯å¦ä¸ºåº”ç”¨å¯¹è±¡ä¸»åŠ¨å‚ä¸çš„è¡Œä¸ºå‘¢ï¼Ÿå¦‚æœè®©åº”ç”¨å¯¹è±¡åªå…³æ³¨äºè‡ªå·±æ‰€é’ˆå¯¹çš„ä¸šåŠ¡é¢†åŸŸé—®é¢˜ï¼Œè€Œå…¶ä»–æ–¹é¢çš„é—®é¢˜ç”±å…¶ä»–åº”ç”¨å¯¹è±¡æ¥å¤„ç†ï¼Œè¿™ä¼šä¸ä¼šæ›´å¥½å‘¢ï¼Ÿ</p>
<p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œ**åˆ†å¸ƒäºåº”ç”¨ä¸­å¤šå‡ºçš„åŠŸèƒ½è¢«ç§°ä¸ºæ¨ªåˆ‡å…³æ³¨ç‚¹ (cross-cutting concerns)**ã€‚é€šå¸¸ï¼Œè¿™äº›æ¨ªåˆ‡å…³æ³¨ç‚¹åœ¨æ¦‚å¿µä¸Šæ˜¯ä¸ä¸šåŠ¡é€»è¾‘ç›¸åˆ†ç¦»çš„ (ä½†æ˜¯å¾€å¾€åµŒå…¥åˆ°åº”ç”¨çš„ä¸šåŠ¡é€»è¾‘ä¸­)ã€‚å°†è¿™äº›æ¨ªåˆ‡å…³æ³¨ç‚¹å’Œä¸šåŠ¡é€»è¾‘ç›¸åˆ†ç¦»æ­£æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ (AOP) ç´¢è¦è§£å†³çš„ã€‚</p>
<p>åœ¨ç¬¬ 2 ç« ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ç®¡ç†å’Œé…ç½®æˆ‘ä»¬çš„åº”ç”¨å¯¹è±¡ã€‚<strong>DI æœ‰åŠ©äºåº”ç”¨å¯¹è±¡ä¹‹é—´çš„è§£è€¦ï¼Œè€ŒAOPå¯ä»¥å®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹ä¸å®ƒä»¬æ‰€å½±å“çš„å¯¹è±¡ä¹‹é—´çš„è§£è€¦ã€‚</strong></p>
<p>æ—¥å¿—æ˜¯åº”ç”¨åˆ‡é¢çš„å¸¸è§èŒƒä¾‹ï¼Œä½†å®ƒå¹¶ä¸æ˜¯åˆ‡é¢é€‚ç”¨çš„å”¯ä¸€åœºæ™¯ã€‚é€šè§ˆæœ¬ä¹¦ï¼Œæˆ‘ä»¬è¿˜ä¼šçœ‹åˆ°åˆ‡é¢æ‰€é€‚ç”¨çš„å¤šä¸ªåœºæ™¯ï¼ŒåŒ…æ‹¬å£°æ˜å¼äº‹åŠ¡ã€å®‰å…¨å’Œç¼“å­˜ã€‚</p>
<p>æœ¬ç« å±•ç¤ºäº† Spring å¯¹åˆ‡é¢çš„æ”¯æŒï¼ŒåŒ…æ‹¬å¦‚ä½•æŠŠæ™®é€šç±»å£°æ˜ä¸ºä¸€ä¸ªåˆ‡é¢å’Œå¦‚ä½•ä½¿ç”¨æ³¨è§£åˆ›å»ºåˆ‡é¢ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜ä¼šçœ‹åˆ° AspectJâ€”â€”å¦ä¸€ç§æµè¡Œçš„ AOP å®ç°â€”â€”å¦‚ä½•è¡¥å…… Spring AOP æ¡†æ¶çš„åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å…ˆä¸ç®¡äº‹åŠ¡ã€å®‰å…¨å’Œç¼“å­˜ï¼Œå…ˆçœ‹ä¸€ä¸‹ Spring æ˜¯å¦‚ä½•å®ç°åˆ‡é¢çš„ï¼Œå°±ä» AOP çš„åŸºç¡€çŸ¥è¯†å¼€å§‹å§ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹"><a href="#ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹" class="headerlink" title="ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹"></a>ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹</h3><p>å¦‚å‰æ‰€è¿°ï¼Œåˆ‡é¢èƒ½å¸®åŠ©æˆ‘ä»¬æ¨¡å—åŒ–æ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ¨ªåˆ‡å…³æ³¨ç‚¹å¯ä»¥è¢«æè¿°ä¸ºå½±å“åº”ç”¨å¤šå¤„çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå®‰å…¨å°±æ˜¯ä¸€ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œåº”ç”¨ä¸­çš„è®¸å¤šæ–¹æ³•éƒ½ä¼šæ¶‰åŠåˆ°å®‰å…¨è§„åˆ™ã€‚å›¾ 4.1 ç›´è§‚å‘ˆç°äº†æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æ¦‚å¿µã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211014135855338.png" alt="image-20211014135855338"></p>
<center>å›¾ 4.1ã€€åˆ‡é¢å®ç°äº†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆè·¨å¤šä¸ªåº”ç”¨å¯¹è±¡çš„é€»è¾‘ï¼‰çš„æ¨¡å—åŒ–</center>

<p>å›¾ 4.1 å±•ç°äº†ä¸€ä¸ªè¢«åˆ’åˆ†ä¸ºæ¨¡å—çš„å…¸å‹åº”ç”¨ã€‚æ¯ä¸ªæ¨¡å—çš„æ ¸å¿ƒåŠŸèƒ½éƒ½æ˜¯ä¸ºç‰¹å®šä¸šåŠ¡é¢†åŸŸæä¾›æœåŠ¡ï¼Œä½†æ˜¯è¿™äº›æ¨¡å—éƒ½éœ€è¦ç±»ä¼¼çš„è¾…åŠ©åŠŸèƒ½ï¼Œä¾‹å¦‚å®‰å…¨å’Œäº‹åŠ¡ç®¡ç†ã€‚</p>
<p>å¦‚æœè¦é‡ç”¨é€šç”¨åŠŸèƒ½çš„è¯ï¼Œæœ€å¸¸è§çš„é¢å‘å¯¹è±¡æŠ€æœ¯æ˜¯ç»§æ‰¿ï¼ˆinheritanceï¼‰æˆ–å§”æ‰˜ï¼ˆdelegationï¼‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœ¨æ•´ä¸ªåº”ç”¨ä¸­éƒ½ä½¿ç”¨ç›¸åŒçš„åŸºç±»ï¼Œç»§æ‰¿å¾€å¾€ä¼šå¯¼è‡´ä¸€ä¸ªè„†å¼±çš„å¯¹è±¡ä½“ç³»ï¼›è€Œä½¿ç”¨å§”æ‰˜å¯èƒ½éœ€è¦å¯¹å§”æ‰˜å¯¹è±¡è¿›è¡Œå¤æ‚çš„è°ƒç”¨ã€‚</p>
<p>åˆ‡é¢æä¾›äº†å–ä»£ç»§æ‰¿å’Œå§”æ‰˜çš„å¦ä¸€ç§é€‰æ‹©ï¼Œè€Œä¸”åœ¨å¾ˆå¤šåœºæ™¯ä¸‹æ›´æ¸…æ™°ç®€æ´ã€‚åœ¨ä½¿ç”¨é¢å‘åˆ‡é¢ç¼–ç¨‹æ—¶ï¼Œæˆ‘ä»¬ä»ç„¶åœ¨ä¸€ä¸ªåœ°æ–¹å®šä¹‰é€šç”¨åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å£°æ˜çš„æ–¹å¼å®šä¹‰è¿™ä¸ªåŠŸèƒ½ä»¥ä½•ç§æ–¹å¼åœ¨ä½•å¤„åº”ç”¨ï¼Œè€Œæ— éœ€ä¿®æ”¹å—å½±å“çš„ç±»ã€‚æ¨ªåˆ‡å…³æ³¨ç‚¹å¯ä»¥è¢«æ¨¡å—åŒ–ç‰¹æ®Šçš„ç±»ï¼Œè¿™äº›ç±»è¢«ç§°ä¸ºåˆ‡é¢ã€‚è¿™æ ·åšæœ‰ä¸¤ä¸ªå¥½å¤„ï¼šé¦–å…ˆï¼Œæ¯ä¸ªå…³æ³¨ç‚¹ç°åœ¨éƒ½é›†ä¸­åœ¨ä¸€å¤„ï¼Œè€Œä¸æ˜¯åˆ†æ•£åˆ°å¤šå¤„ä»£ç ä¸­ï¼›å…¶æ¬¡ï¼ŒæœåŠ¡æ¨¡å—æ›´ç®€æ´ï¼Œå› ä¸ºå®ƒä»¬åªåŒ…å«ä¸»è¦å…³æ³¨ç‚¹ (æˆ–æ ¸å¿ƒåŠŸèƒ½) çš„ä»£ç ï¼Œè€Œæ¬¡è¦å…³æ³¨ç‚¹çš„ä»£ç è¢«è½¬ç§»åˆ°åˆ‡é¢ä¸­äº†ã€‚</p>
<h4 id="å®šä¹‰-AOP-æœ¯è¯­"><a href="#å®šä¹‰-AOP-æœ¯è¯­" class="headerlink" title="å®šä¹‰ AOP æœ¯è¯­"></a>å®šä¹‰ AOP æœ¯è¯­</h4><p>ä¸å¤§å¤šæ•°æŠ€æœ¯ä¸€æ ·ï¼ŒAOP å·²ç»å½¢æˆäº†è‡ªå·±çš„æœ¯è¯­ã€‚æè¿°åˆ‡é¢çš„å¸¸ç”¨æœ¯è¯­æœ‰é€šçŸ¥ï¼ˆadviceï¼‰ã€åˆ‡ç‚¹ï¼ˆpointcutï¼‰å’Œè¿æ¥ç‚¹ï¼ˆjoin pointï¼‰ã€‚å›¾4.2å±•ç¤ºäº†è¿™äº›æ¦‚å¿µæ˜¯å¦‚ä½•å…³è”åœ¨ä¸€èµ·çš„ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211014140550324.png" alt="image-20211014140550324"></p>
<center>å›¾ 4.2ã€€åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªè¿æ¥ç‚¹ä¸Šï¼Œ<br>
å¯ä»¥æŠŠåˆ‡é¢çš„åŠŸèƒ½ï¼ˆé€šçŸ¥ï¼‰ç»‡å…¥åˆ°ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ä¸­</center>



<p>é—æ†¾çš„æ˜¯ï¼Œå¤§å¤šæ•°ç”¨äºæè¿° AOP åŠŸèƒ½çš„æœ¯è¯­å¹¶ä¸ç›´è§‚ï¼Œå°½ç®¡å¦‚æ­¤ï¼Œå®ƒä»¬ç°åœ¨å·²ç»æ˜¯ AOP è¡Œè¯çš„ç»„æˆéƒ¨åˆ†äº†ï¼Œä¸ºäº†ç†è§£ AOPï¼Œæˆ‘ä»¬å¿…é¡»äº†è§£è¿™äº›æœ¯è¯­ã€‚åœ¨æˆ‘ä»¬è¿›å…¥æŸä¸ªé¢†åŸŸä¹‹å‰ï¼Œå¿…é¡»å­¦ä¼šåœ¨è¿™ä¸ªé¢†åŸŸè¯¥å¦‚ä½•è¯´è¯ã€‚</p>
<p><strong>é€šçŸ¥ (advice)</strong></p>
<p>å½“æŠ„è¡¨å‘˜å‡ºç°åœ¨æˆ‘ä»¬å®¶é—¨å£æ—¶ï¼Œä»–ä»¬è¦ç™»è®°ç”¨ç”µé‡å¹¶å›å»å‘ç”µåŠ›å…¬å¸æŠ¥å‘Šã€‚æ˜¾ç„¶ï¼Œä»–ä»¬å¿…é¡»æœ‰ä¸€ä»½éœ€è¦æŠ„è¡¨çš„ä½æˆ·æ¸…å•ï¼Œä»–ä»¬æ‰€æ±‡æŠ¥çš„ä¿¡æ¯ä¹Ÿå¾ˆé‡è¦ï¼Œä½†è®°å½•ç”¨ç”µé‡æ‰æ˜¯æŠ„è¡¨å‘˜çš„ä¸»è¦å·¥ä½œã€‚</p>
<p>ç±»ä¼¼åœ°ï¼Œåˆ‡é¢ä¹Ÿæœ‰ç›®æ ‡â€”â€”å®ƒå¿…é¡»è¦å®Œæˆçš„å·¥ä½œã€‚<strong>åœ¨ AOP æœ¯è¯­ä¸­ï¼Œåˆ‡é¢çš„å·¥ä½œè¢«ç§°ä¸ºé€šçŸ¥ã€‚</strong></p>
<p>é€šçŸ¥å®šä¹‰äº†åˆ‡é¢æ˜¯ä»€ä¹ˆä»¥åŠä½•æ—¶ä½¿ç”¨ã€‚é™¤äº†æè¿°åˆ‡é¢è¦å®Œæˆçš„å·¥ä½œï¼Œé€šçŸ¥è¿˜è§£å†³äº†ä½•æ—¶æ‰§è¡Œè¿™ä¸ªå·¥ä½œçš„é—®é¢˜ã€‚</p>
<p>Spring  åˆ‡é¢å¯ä»¥åº”ç”¨ 5 ç§ç±»å‹çš„é€šçŸ¥ã€‚</p>
<ol>
<li>Beforeï¼Œåœ¨æ–¹æ³•è°ƒç”¨ä¹‹å‰è°ƒç”¨é€šçŸ¥</li>
<li>Afterï¼Œåœ¨æ–¹æ³•è°ƒç”¨ä¹‹åè°ƒç”¨é€šçŸ¥ï¼Œæ— è®ºæ–¹æ³•æ‰§è¡Œæ˜¯å¦æˆåŠŸ</li>
<li>After-returningï¼Œåœ¨æ–¹æ³•æˆåŠŸæ‰§è¡Œä¹‹åè°ƒç”¨é€šçŸ¥</li>
<li>After-throwingï¼Œåœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åè°ƒç”¨é€šçŸ¥</li>
<li>Aroundï¼Œé€šçŸ¥åŒ…è£¹äº†è¢«é€šçŸ¥çš„æ–¹æ³•ï¼Œåœ¨è¢«é€šçŸ¥çš„æ–¹æ³•è°ƒç”¨ä¹‹å‰å’Œè°ƒç”¨ä¹‹åæ‰§è‡ªå®šä¹‰çš„è¡Œä¸º</li>
</ol>
<p><strong>è¿æ¥ç‚¹ (join point)</strong></p>
<p>ç”µåŠ›å…¬å¸ä¸ºå¤šä¸ªä½æˆ·æä¾›æœåŠ¡ï¼Œç”šè‡³å¯èƒ½æ˜¯æ•´ä¸ªåŸå¸‚ã€‚æ¯å®¶éƒ½æœ‰ä¸€ä¸ªç”µè¡¨ï¼Œè¿™äº›ç”µè¡¨ä¸Šçš„æ•°å­—éƒ½éœ€è¦è¯»å–ï¼Œå› æ­¤æ¯å®¶éƒ½æ˜¯æŠ„è¡¨å‘˜çš„æ½œåœ¨ç›®æ ‡ã€‚æŠ„è¡¨å‘˜ä¹Ÿè®¸èƒ½å¤Ÿè¯»å–å„ç§ç±»å‹çš„è®¾å¤‡ï¼Œä½†æ˜¯ä¸ºäº†å®Œæˆä»–çš„å·¥ä½œï¼Œä»–çš„ç›®æ ‡åº”è¯¥æˆ¿å±‹å†…æ‰€å®‰è£…çš„ç”µè¡¨ã€‚</p>
<p>åŒæ ·ï¼Œæˆ‘ä»¬çš„åº”ç”¨å¯èƒ½éœ€è¦é¢å¯¹æ•°ä»¥åƒè®¡çš„æ—¶æœºåº”ç”¨é€šçŸ¥ã€‚è¿™äº›æ—¶æœºè¢«ç§°ä¸ºè¿æ¥ç‚¹ã€‚è¿æ¥ç‚¹æ˜¯åœ¨åº”ç”¨æ‰§è¡Œè¿‡ç¨‹ä¸­èƒ½å¤Ÿæ’å…¥åˆ‡é¢çš„ä¸€ä¸ªç‚¹ã€‚è¿™ä¸ªç‚¹å¯ä»¥æ˜¯è°ƒç”¨æ–¹æ³•æ—¶ã€æŠ›å‡ºå¼‚å¸¸æ—¶ã€ç”šè‡³ä¿®æ”¹ä¸€ä¸ªå­—æ®µæ—¶ã€‚åˆ‡é¢ä»£ç å¯ä»¥åˆ©ç”¨è¿™äº›ç‚¹æ’å…¥åˆ°åº”ç”¨çš„æ­£å¸¸æµç¨‹ä¹‹ä¸­ï¼Œå¹¶æ·»åŠ æ–°çš„è¡Œä¸ºã€‚</p>
<p><strong>åˆ‡ç‚¹ (pointcut)</strong></p>
<p>å¦‚æœè®©ä¸€ä½æŠ„è¡¨å‘˜è®¿é—®ç”µåŠ›å…¬å¸æ‰€æœåŠ¡çš„æ‰€æœ‰ä½æˆ·ï¼Œé‚£è‚¯å®šæ˜¯ä¸ç°å®çš„ã€‚å®é™…ä¸Šï¼Œç”µåŠ›å…¬å¸ä¸ºæ¯ä¸€ä¸ªæŠ„è¡¨å‘˜éƒ½åˆ†åˆ«æŒ‡å®šæŸä¸€å—åŒºåŸŸçš„ä½æˆ·ã€‚ç±»ä¼¼åœ°ï¼Œä¸€ä¸ªåˆ‡é¢å¹¶ä¸éœ€è¦é€šçŸ¥åº”ç”¨çš„æ‰€æœ‰è¿æ¥ç‚¹ã€‚åˆ‡ç‚¹æœ‰åŠ©äºç¼©å°åˆ‡é¢æ‰€é€šçŸ¥çš„è¿æ¥ç‚¹çš„èŒƒå›´ã€‚</p>
<p>å¦‚æœé€šçŸ¥å®šä¹‰äº†åˆ‡é¢çš„ â€œä»€ä¹ˆâ€ å’Œ â€œä½•æ—¶â€ï¼Œé‚£ä¹ˆåˆ‡é¢å°±å®šä¹‰äº† â€ä½•å¤„â€œã€‚åˆ‡ç‚¹çš„å®šä¹‰ä¼šåŒ¹é…é€šçŸ¥æ‰€è¦ç»‡å…¥çš„ä¸€ ä¸ªæˆ–å¤šä¸ªè¿æ¥ç‚¹ã€‚æˆ‘ä»¬é€šå¸¸ä½¿ç”¨æ˜ç¡®çš„ç±»å’Œæ–¹æ³•åç§°æ¥æŒ‡å®šè¿™äº›åˆ‡ç‚¹ï¼Œæˆ–æ˜¯åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰åŒ¹é…çš„ç±»å’Œæ–¹æ³•åç§°æ¨¡å¼æ¥æŒ‡å®šè¿™äº›åˆ‡ç‚¹ã€‚æœ‰äº›  AOP  æ¡†æ¶å…è®¸æˆ‘ä»¬åˆ›å»ºåŠ¨æ€çš„åˆ‡ç‚¹ï¼Œå¯ä»¥æ ¹æ®è¿è¡Œæ—¶çš„å†³ç­– (æ¯”å¦‚æ–¹æ³•çš„å‚æ•°å€¼) æ¥å†³å®šæ˜¯å¦åº”ç”¨é€šçŸ¥ã€‚</p>
<p><strong>åˆ‡é¢ (aspect)</strong></p>
<p>å½“æŠ„è¡¨å‘˜å¼€å§‹ä¸€å¤©çš„å·¥ä½œæ—¶ï¼Œä»–çŸ¥é“è‡ªå·±è¦åšçš„äº‹æƒ…ï¼ˆæŠ¥å‘Šç”¨ç”µé‡ï¼‰å’Œä»å“ªäº›æˆ¿å±‹æ”¶é›†ä¿¡æ¯ã€‚å› æ­¤ï¼Œä»–çŸ¥é“è¦å®Œæˆå·¥ä½œæ‰€éœ€è¦çš„ä¸€åˆ‡ä¸œè¥¿ã€‚</p>
<p>åˆ‡é¢æ—¶é€šçŸ¥å’Œåˆ‡ç‚¹çš„ç»“åˆã€‚é€šçŸ¥å’Œåˆ‡ç‚¹å…±åŒå®šä¹‰äº†å…³äºåˆ‡é¢çš„å…¨éƒ¨å†…å®¹ï¼Œå®ƒæ˜¯ä»€ä¹ˆï¼Œåœ¨ä½•æ—¶å’Œä½•å¤„å®Œæˆå…¶åŠŸèƒ½ã€‚</p>
<p><strong>å¼•å…¥ (introduction)</strong></p>
<p>å¼•å…¥å…è®¸æˆ‘ä»¬å‘ç°æœ‰çš„ç±»æ·»åŠ æ–°æ–¹æ³•å’Œå±æ€§ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª Auditable é€šçŸ¥ç±»ï¼Œè¯¥ç±»è®°å½•äº†å¯¹è±¡æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶çš„çŠ¶æ€ã€‚è¿™å¾ˆç®€å•ï¼Œåªéœ€ä¸€ç§æ–¹æ³•ï¼ŒsetLastModified(Date)ï¼Œå’Œä¸€ä¸ªå®ä¾‹å˜é‡æ¥ä¿å­˜è¿™ä¸ªçŠ¶æ€ã€‚ç„¶åï¼Œè¿™ä¸ªæ–°æ–¹æ³•å’Œå®ä¾‹å˜é‡å°±å¯ä»¥è¢«å¼•å…¥åˆ°ç°æœ‰çš„ç±»ä¸­ã€‚ä»è€Œå¯ä»¥åœ¨æ— éœ€ä¿®æ”¹è¿™äº›ç°æœ‰çš„ç±»çš„æƒ…å†µä¸‹ï¼Œè®©å®ƒä»¬å…·æœ‰æ–°çš„è¡Œä¸ºå’ŒçŠ¶æ€ã€‚</p>
<p><strong>ç»‡å…¥ (weaving)</strong></p>
<p>ç»‡å…¥æ˜¯å°†åˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡æ¥åˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚åˆ‡é¢åœ¨æŒ‡å®šçš„è¿æ¥ç‚¹è¢«ç»‡å…¥åˆ°ç›®æ ‡å¯¹è±¡ä¸­ã€‚åœ¨ç›®æ ‡å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸé‡Œæœ‰å¤šä¸ªç‚¹å¯ä»¥è¿›è¡Œç»‡å…¥ã€‚</p>
<ul>
<li>ç¼–è¯‘æœŸï¼šåˆ‡é¢åœ¨ç›®æ ‡ç±»ç¼–è¯‘æ—¶è¢«ç»‡å…¥ã€‚è¿™ç§æ–¹å¼éœ€è¦ç‰¹æ®Šçš„ç¼–è¯‘å™¨ã€‚AspectJ çš„ç»‡å…¥ç¼–è¯‘å™¨å°±æ˜¯ä»¥è¿™ç§æ–¹å¼ç»‡å…¥åˆ‡é¢çš„ã€‚</li>
<li>ç±»åŠ è½½æœŸï¼šåˆ‡é¢åœ¨ç›®æ ‡ç±»åŠ è½½åˆ° JVM æ—¶è¢«ç»‡å…¥ã€‚è¿™ç§æ–¹å¼éœ€è¦ç‰¹æ®Šçš„ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰ï¼Œå®ƒå¯ä»¥åœ¨ç›®æ ‡ç±»è¢«å¼•å…¥åº”ç”¨ä¹‹å‰å¢å¼ºè¯¥ç›®æ ‡ç±»çš„å­—èŠ‚ç ã€‚AspectJ 5 çš„åŠ è½½æ—¶ç»‡å…¥ï¼ˆload-time weavingï¼ŒLTWï¼‰å°±æ”¯æŒä»¥è¿™ç§æ–¹å¼ç»‡å…¥åˆ‡é¢ã€‚</li>
<li>è¿è¡ŒæœŸï¼šåˆ‡é¢åœ¨åº”ç”¨è¿è¡Œçš„æŸä¸ªæ—¶åˆ»è¢«ç»‡å…¥ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ç»‡å…¥åˆ‡é¢æ—¶ï¼ŒAOP å®¹å™¨ä¼šä¸ºç›®æ ‡å¯¹è±¡åŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚Spring AOP å°±æ˜¯ä»¥è¿™ç§æ–¹å¼ç»‡å…¥åˆ‡é¢çš„ã€‚</li>
</ul>
<p>è¦æŒæ¡çš„æ–°æœ¯è¯­å¯çœŸä¸å°‘å•Šã€‚å†çœ‹ä¸€ä¸‹å›¾ 4.1ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä¸‹çš„çŸ¥è¯†ï¼Œé€šçŸ¥åŒ…å«äº†éœ€è¦ç”¨äºå¤šä¸ªåº”ç”¨å¯¹è±¡çš„æ¨ªåˆ‡è¡Œä¸ºï¼›è¿æ¥ç‚¹æ˜¯ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­èƒ½å¤Ÿåº”ç”¨é€šçŸ¥çš„æ‰€æœ‰ç‚¹ï¼›åˆ‡ç‚¹å®šä¹‰äº†é€šçŸ¥è¢«åº”ç”¨çš„å…·ä½“ä½ç½®ï¼ˆåœ¨å“ªäº›è¿æ¥ç‚¹ï¼‰ã€‚å…¶ä¸­å…³é”®çš„æ¦‚å¿µæ˜¯åˆ‡ç‚¹å®šä¹‰äº†å“ªäº›è¿æ¥ç‚¹ä¼šå¾—åˆ°é€šçŸ¥ã€‚</p>
<p>æˆ‘ä»¬å·²ç»äº†è§£äº†ä¸€äº›åŸºç¡€çš„ AOP æœ¯è¯­ï¼Œç°åœ¨è®©æˆ‘ä»¬å†çœ‹çœ‹è¿™äº› AOP çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯å¦‚ä½•åœ¨ Spring ä¸­å®ç°çš„ã€‚</p>
<h4 id="Spring-å¯¹-AOP-çš„æ”¯æŒ"><a href="#Spring-å¯¹-AOP-çš„æ”¯æŒ" class="headerlink" title="Spring å¯¹ AOP çš„æ”¯æŒ"></a>Spring å¯¹ AOP çš„æ”¯æŒ</h4><p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„ AOP æ¡†æ¶éƒ½æ˜¯ç›¸åŒçš„ï¼Œå®ƒä»¬åœ¨è¿æ¥ç‚¹æ¨¡å‹ä¸Šå¯èƒ½æœ‰å¼ºå¼±ä¹‹åˆ†ã€‚æœ‰äº›å…è®¸åœ¨å­—æ®µä¿®é¥°ç¬¦çº§åˆ«åº”ç”¨é€šçŸ¥ï¼Œè€Œå¦ä¸€äº›åªæ”¯æŒä¸æ–¹æ³•è°ƒç”¨ç›¸å…³çš„è¿æ¥ç‚¹ã€‚å®ƒä»¬ç»‡å…¥åˆ‡é¢çš„æ–¹å¼å’Œæ—¶æœºä¹Ÿæœ‰æ‰€ä¸åŒã€‚ä½†æ˜¯æ— è®ºå¦‚ä½•ï¼Œåˆ›å»ºåˆ‡ç‚¹æ¥å®šä¹‰åˆ‡é¢æ‰€ç»‡å…¥çš„è¿æ¥ç‚¹æ˜¯ AOP æ¡†æ¶çš„åŸºæœ¬åŠŸèƒ½ã€‚</p>
<p>å› ä¸ºè¿™æ˜¯ä¸€æœ¬ä»‹ç» Spring çš„å›¾ä¹¦ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šå…³æ³¨ Spring AOPã€‚è™½ç„¶å¦‚æ­¤ï¼ŒSpring å’Œ AspectJ é¡¹ç›®ä¹‹é—´æœ‰å¤§é‡çš„åä½œï¼Œè€Œä¸” Spring å¯¹ AOP çš„æ”¯æŒåœ¨å¾ˆå¤šæ–¹é¢å€Ÿé‰´äº† AspectJ é¡¹ç›®ã€‚</p>
<p>Spring æä¾›äº† 4 ç§å„å…·ç‰¹è‰²çš„ AOP æ”¯æŒï¼š</p>
<ul>
<li>åŸºäºä»£ç†çš„ç»å…¸ AOP</li>
<li>çº¯ POJO åˆ‡é¢</li>
<li>@AsoectJ æ³¨è§£é©±åŠ¨çš„åˆ‡é¢</li>
<li>æ³¨å…¥å¼ Aspect J åˆ‡é¢ (é€‚åˆ Spring å„ç‰ˆæœ¬)</li>
</ul>
<p>å‰ä¸‰ç§éƒ½æ˜¯ Spring AOP å®ç°çš„å˜ä½“ï¼ŒSpring AOP æ„å»ºåœ¨åŠ¨æ€ä»£ç†åŸºç¡€ä¹‹ä¸Šï¼Œå› æ­¤ï¼ŒSpring å¯¹ AOP çš„æ”¯æŒå±€é™äºæ–¹æ³•æ‹¦æˆªã€‚æœ¯è¯­â€œç»å…¸â€é€šå¸¸æ„å‘³ç€æ˜¯å¾ˆå¥½çš„ä¸œè¥¿ã€‚è€çˆ·è½¦ã€ç»å…¸é«˜å°”å¤«çƒèµ›ã€å¯å£å¯ä¹ç²¾å“éƒ½æ˜¯å¥½ä¸œè¥¿ã€‚ä½†æ˜¯ Spring çš„ç»å…¸ AOP ç¼–ç¨‹æ¨¡å‹å¹¶ä¸æ€ä¹ˆæ ·ã€‚å½“ç„¶ï¼Œæ›¾ç»å®ƒçš„ç¡®éå¸¸æ£’ã€‚ä½†æ˜¯ç°åœ¨ Spring æä¾›äº†æ›´ç®€æ´å’Œå¹²å‡€çš„é¢å‘åˆ‡é¢ç¼–ç¨‹æ–¹å¼ã€‚å¼•å…¥äº†ç®€å•çš„å£°æ˜å¼ AOP å’ŒåŸºäºæ³¨è§£çš„ AOP ä¹‹åï¼ŒSpring ç»å…¸çš„ AOP çœ‹èµ·æ¥å°±æ˜¾å¾—éå¸¸ç¬¨é‡å’Œè¿‡äºå¤æ‚ï¼Œç›´æ¥ä½¿ç”¨<br>ProxyFactory Bean ä¼šè®©äººæ„Ÿè§‰åŒçƒ¦ã€‚æ‰€ä»¥åœ¨æœ¬ä¹¦ä¸­æˆ‘ä¸ä¼šå†ä»‹ç»ç»å…¸çš„ Spring AOPã€‚</p>
<p>å€ŸåŠ© Spring çš„ aop å‘½åç©ºé—´ï¼Œæˆ‘ä»¬å¯ä»¥å°†çº¯ POJO è½¬æ¢ä¸ºåˆ‡é¢ã€‚å®é™…ä¸Šï¼Œè¿™äº› POJO åªæ˜¯æä¾›äº†æ»¡è¶³åˆ‡ç‚¹æ¡ä»¶æ—¶æ‰€è¦è°ƒç”¨çš„æ–¹æ³•ã€‚é—æ†¾çš„æ˜¯ï¼Œè¿™ç§æŠ€æœ¯éœ€è¦ XMLé…ç½®ï¼Œä½†è¿™çš„ç¡®æ˜¯å£°æ˜å¼åœ°å°†å¯¹è±¡è½¬æ¢ä¸ºåˆ‡é¢çš„ç®€ä¾¿æ–¹å¼ã€‚</p>
<p>Spring å€Ÿé‰´äº† AspectJ çš„åˆ‡é¢ï¼Œä»¥æä¾›æ³¨è§£é©±åŠ¨çš„ AOPã€‚æœ¬è´¨ä¸Šï¼Œå®ƒä¾ç„¶æ˜¯ Spring åŸºäºä»£ç†çš„ AOPï¼Œä½†æ˜¯ç¼–ç¨‹æ¨¡å‹å‡ ä¹ä¸ç¼–å†™æˆç†Ÿçš„ AspectJ æ³¨è§£åˆ‡é¢å®Œå…¨ä¸€è‡´ã€‚è¿™ç§ AOP é£æ ¼çš„å¥½å¤„åœ¨äºèƒ½å¤Ÿä¸ä½¿ç”¨ XML æ¥å®ŒæˆåŠŸèƒ½ã€‚</p>
<p>å¦‚æœä½ çš„ AOP éœ€æ±‚è¶…è¿‡äº†ç®€å•çš„æ–¹æ³•è°ƒç”¨ï¼ˆå¦‚æ„é€ å™¨æˆ–å±æ€§æ‹¦æˆªï¼‰ï¼Œé‚£ä¹ˆä½ éœ€è¦è€ƒè™‘ä½¿ç”¨ AspectJ æ¥å®ç°åˆ‡é¢ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸Šæ–‡æ‰€ç¤ºçš„ç¬¬å››ç§ç±»å‹èƒ½å¤Ÿå¸®åŠ©ä½ å°†å€¼æ³¨å…¥åˆ° AspectJ é©±åŠ¨çš„åˆ‡é¢ä¸­ã€‚</p>
<p>æˆ‘ä»¬åœ¨å°†åœ¨æœ¬ç« å±•ç¤ºæ›´å¤šçš„ Spring AOP æŠ€æœ¯ï¼Œä½†æ˜¯åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»è¦äº†è§£ Spring AOP æ¡†æ¶çš„ä¸€äº›å…³é”®çŸ¥è¯†ã€‚</p>
<p><strong>Spring é€šçŸ¥æ˜¯ Java ç¼–å†™çš„</strong></p>
<p>Spring æ‰€åˆ›å»ºçš„é€šçŸ¥éƒ½æ˜¯ä½¿ç”¨æ ‡å‡† Java ç±»ç¼–å†™çš„ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¸æ™®é€š Java å¼€å‘ä¸€æ ·çš„é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰æ¥å¼€å‘åˆ‡é¢ã€‚è€Œä¸”ï¼Œå®šä¹‰é€šçŸ¥æ‰€åº”ç”¨çš„åˆ‡ç‚¹é€šå¸¸ä¼šä½¿ç”¨æ³¨è§£æˆ–åœ¨ Spring é…ç½®æ–‡ä»¶é‡Œé‡‡ç”¨ XML æ¥ç¼–å†™ï¼Œè¿™ä¸¤ç§è¯­æ³•å¯¹äº Java å¼€å‘è€…æ¥è¯´éƒ½æ˜¯ç›¸å½“ç†Ÿæ‚‰çš„ã€‚</p>
<p>AspectJ ä¸ä¹‹ç›¸åã€‚è™½ç„¶ AspectJ ç°åœ¨æ”¯æŒåŸºäºæ³¨è§£çš„åˆ‡é¢ï¼Œä½† AspectJ æœ€åˆæ˜¯ä»¥ Java è¯­è¨€æ‰©å±•çš„æ–¹å¼å®ç°çš„ã€‚è¿™ç§æ–¹å¼æœ‰ä¼˜ç‚¹ä¹Ÿæœ‰ç¼ºç‚¹ã€‚é€šè¿‡ç‰¹æœ‰çš„ AOP è¯­è¨€ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—æ›´å¼ºå¤§å’Œç»†ç²’åº¦çš„æ§åˆ¶ï¼Œä»¥åŠæ›´ä¸°å¯Œçš„ AOP å·¥å…·é›†ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦é¢å¤–å­¦ä¹ æ–°çš„å·¥å…·å’Œè¯­æ³•ã€‚</p>
<p><strong>Spring åœ¨è¿è¡ŒæœŸé€šçŸ¥å¯¹è±¡</strong></p>
<p>é€šè¿‡åœ¨ä»£ç†ç±»ä¸­åŒ…è£¹åˆ‡é¢ï¼ŒSpring åœ¨è¿è¡ŒæœŸæŠŠåˆ‡é¢ç»‡å…¥åˆ° Spring ç®¡ç†çš„ beanä¸­ã€‚å¦‚å›¾ 4.3 æ‰€ç¤ºï¼Œä»£ç†ç±»å°è£…äº†ç›®æ ‡ç±»ï¼Œå¹¶æ‹¦æˆªè¢«é€šçŸ¥æ–¹æ³•çš„è°ƒç”¨ï¼Œå†æŠŠè°ƒç”¨è½¬å‘ç»™çœŸæ­£çš„ç›®æ ‡ beanã€‚å½“ä»£ç†æ‹¦æˆªåˆ°æ–¹æ³•è°ƒç”¨æ—¶ï¼Œåœ¨è°ƒç”¨ç›®æ ‡ bean æ–¹æ³•ä¹‹å‰ï¼Œä¼šæ‰§è¡Œåˆ‡é¢é€»è¾‘ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211014154829792.png" alt="image-20211014154829792"></p>
<center>å›¾ 4.3ã€€Spring çš„åˆ‡é¢ç”±åŒ…è£¹äº†ç›®æ ‡å¯¹è±¡çš„ä»£ç†ç±»å®ç°ã€‚<br>ä»£ç†ç±»å¤„ç†æ–¹æ³•çš„è°ƒç”¨ï¼Œæ‰§è¡Œé¢å¤–çš„åˆ‡é¢é€»è¾‘ï¼Œå¹¶è°ƒç”¨ç›®æ ‡æ–¹æ³•</center>

<p>ç›´åˆ°åº”ç”¨éœ€è¦è¢«ä»£ç†çš„ Bean æ—¶ï¼ŒSpring æ‰åˆ›å»ºä»£ç†å¯¹è±¡ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯ ApplicationContextï¼Œåœ¨ ApplicationContext ä» BeanFactory ä¸­åŠ è½½æ‰€æœ‰çš„ Bean æ—¶ï¼ŒSpring åˆ›å»ºè¢«ä»£ç†çš„å¯¹è±¡ã€‚å› ä¸º Spring è¿è¡Œæ—¶æ‰åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ç‰¹æ®Šçš„ç¼–è¯‘å™¨æ¥ç»‡å…¥ Spring AOP çš„åˆ‡é¢ã€‚</p>
<p><strong>Spring åªæ”¯æŒæ–¹æ³•çº§åˆ«çš„è¿æ¥ç‚¹</strong></p>
<p>æ­£å¦‚å‰é¢æ‰€æ¢è®¨è¿‡çš„ï¼Œé€šè¿‡ä½¿ç”¨å„ç§ AOP æ–¹æ¡ˆå¯ä»¥æ”¯æŒå¤šç§è¿æ¥ç‚¹æ¨¡å‹ã€‚å› ä¸º Spring åŸºäºåŠ¨æ€ä»£ç†ï¼Œæ‰€ä»¥ Spring åªæ”¯æŒæ–¹æ³•è¿æ¥ç‚¹ã€‚è¿™ä¸ä¸€äº›å…¶ä»–çš„ AOP æ¡†æ¶æ˜¯ä¸åŒçš„ï¼Œä¾‹å¦‚ AspectJ å’Œ JBossï¼Œé™¤äº†æ–¹æ³•åˆ‡ç‚¹ï¼Œå®ƒä»¬è¿˜æä¾›äº†å­—æ®µå’Œæ„é€ å™¨æ¥å…¥ç‚¹ã€‚Spring ç¼ºå°‘å¯¹å­—æ®µè¿æ¥ç‚¹çš„æ”¯æŒï¼Œæ— æ³•è®©æˆ‘ä»¬åˆ›å»ºç»†ç²’åº¦çš„é€šçŸ¥ï¼Œä¾‹å¦‚æ‹¦æˆªå¯¹è±¡å­—æ®µçš„ä¿®æ”¹ã€‚è€Œä¸”å®ƒä¸æ”¯æŒæ„é€ å™¨è¿æ¥ç‚¹ï¼Œæˆ‘ä»¬å°±æ— æ³•åœ¨ bean åˆ›å»ºæ—¶åº”ç”¨é€šçŸ¥ã€‚</p>
<p>ä½†æ˜¯æ–¹æ³•æ‹¦æˆªå¯ä»¥æ»¡è¶³ç»å¤§éƒ¨åˆ†çš„éœ€æ±‚ã€‚å¦‚æœéœ€è¦æ–¹æ³•æ‹¦æˆªä¹‹å¤–çš„è¿æ¥ç‚¹æ‹¦æˆªåŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Aspect æ¥è¡¥å…… Spring AOP çš„åŠŸèƒ½ã€‚</p>
<p>å¯¹äºä»€ä¹ˆæ˜¯AOPä»¥åŠSpringå¦‚ä½•æ”¯æŒAOPçš„ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»æœ‰äº†ä¸€ä¸ªå¤§è‡´çš„äº†è§£ã€‚ç°åœ¨æ˜¯æ—¶å€™å­¦ä¹ å¦‚ä½•åœ¨ Spring ä¸­åˆ›å»ºåˆ‡é¢äº†ï¼Œè®©æˆ‘ä»¬å…ˆä» Spring çš„å£°æ˜å¼ AOP æ¨¡å‹å¼€å§‹ã€‚</p>
<h3 id="ä½¿ç”¨åˆ‡ç‚¹é€‰æ‹©è¿æ¥ç‚¹"><a href="#ä½¿ç”¨åˆ‡ç‚¹é€‰æ‹©è¿æ¥ç‚¹" class="headerlink" title="ä½¿ç”¨åˆ‡ç‚¹é€‰æ‹©è¿æ¥ç‚¹"></a>ä½¿ç”¨åˆ‡ç‚¹é€‰æ‹©è¿æ¥ç‚¹</h3><p>æ­£å¦‚ä¹‹å‰æ‰€æè¿‡çš„ï¼Œåˆ‡ç‚¹ç”¨äºå‡†ç¡®å®šä½åº”è¯¥åœ¨ä»€ä¹ˆåœ°æ–¹åº”ç”¨åˆ‡é¢çš„é€šçŸ¥ã€‚é€šçŸ¥å’Œåˆ‡ç‚¹æ˜¯åˆ‡é¢çš„æœ€åŸºæœ¬å…ƒç´ ã€‚å› æ­¤ï¼Œäº†è§£å¦‚ä½•ç¼–å†™åˆ‡ç‚¹éå¸¸é‡è¦ã€‚</p>
<p>åœ¨ Spring AOP ä¸­ï¼Œè¦ä½¿ç”¨ AspectJ çš„åˆ‡ç‚¹è¡¨è¾¾å¼è¯­è¨€æ¥å®šä¹‰åˆ‡ç‚¹ã€‚å¦‚æœä½ å·²ç»å¾ˆç†Ÿæ‚‰ AspectJï¼Œé‚£ä¹ˆåœ¨ Spring ä¸­å®šä¹‰åˆ‡ç‚¹å°±æ„Ÿè§‰éå¸¸è‡ªç„¶ã€‚ä½†æ˜¯å¦‚æœä½ ä¸€ç‚¹éƒ½ä¸äº†è§£ AspectJ çš„è¯ï¼Œæœ¬å°èŠ‚æˆ‘ä»¬å°†å¿«é€Ÿä»‹ç»ä¸€ä¸‹å¦‚ä½•ç¼–å†™ AspectJ é£æ ¼çš„åˆ‡ç‚¹ã€‚å¦‚æœä½ æƒ³è¿›ä¸€æ­¥äº†è§£ AspectJ å’Œ AspectJ åˆ‡ç‚¹è¡¨è¾¾å¼è¯­è¨€ï¼Œæˆ‘å¼ºçƒˆæ¨è Ramniva Laddad ç¼–å†™çš„ã€ŠAspectJ in Actionã€‹ç¬¬äºŒç‰ˆï¼ˆManningï¼Œ2009ï¼Œ<a target="_blank" rel="noopener" href="http://www.manning.com/laddad2/%EF%BC%89%E3%80%82">www.manning.com/laddad2/ï¼‰ã€‚</a></p>
<p>å…³äº Spring AOP çš„ AspectJ åˆ‡ç‚¹ï¼Œæœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯ Spring ä»…æ”¯æŒ AspectJ åˆ‡ç‚¹æŒ‡ç¤ºå™¨ï¼ˆpointcut designatorï¼‰çš„ä¸€ä¸ªå­é›†ã€‚è®©æˆ‘ä»¬å›é¡¾ä¸‹ï¼ŒSpring æ˜¯åŸºäºä»£ç†çš„ï¼Œè€ŒæŸäº›åˆ‡ç‚¹è¡¨è¾¾å¼æ˜¯ä¸åŸºäºä»£ç†çš„ AOP æ— å…³çš„ã€‚è¡¨ 4.1 åˆ—å‡ºäº† Spring AOP æ‰€æ”¯æŒçš„ AspectJ åˆ‡ç‚¹æŒ‡ç¤ºå™¨ã€‚</p>
<center>è¡¨ 4.1ã€€Spring å€ŸåŠ© AspectJ çš„åˆ‡ç‚¹è¡¨è¾¾å¼è¯­è¨€æ¥å®šä¹‰ Spring åˆ‡é¢</center>

<table>
<thead>
<tr>
<th>AspectJ æŒ‡ç¤ºå™¨</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>arg()</td>
<td>é™åˆ¶è¿æ¥ç‚¹åŒ¹é…å‚æ•°ä¸ºæŒ‡å®šç±»å‹çš„æ‰§è¡Œæ–¹æ³•</td>
</tr>
<tr>
<td>@args()</td>
<td>é™åˆ¶è¿æ¥ç‚¹åŒ¹é…å‚æ•°ç”±æŒ‡å®šæ³¨è§£æ ‡æ³¨çš„æ‰§è¡Œæ–¹æ³•</td>
</tr>
<tr>
<td>execution()</td>
<td>ç”¨äºåŒ¹é…æ˜¯è¿æ¥ç‚¹çš„æ‰§è¡Œæ–¹æ³•</td>
</tr>
<tr>
<td>this()</td>
<td>é™åˆ¶è¿æ¥ç‚¹åŒ¹é… AOP ä»£ç†çš„ bean å¼•ç”¨ä¸ºæŒ‡å®šç±»å‹çš„ç±»</td>
</tr>
<tr>
<td>target</td>
<td>é™åˆ¶è¿æ¥ç‚¹åŒ¹é…ç›®æ ‡å¯¹è±¡ä¸ºæŒ‡å®šç±»å‹çš„ç±»</td>
</tr>
<tr>
<td>@target()</td>
<td>é™åˆ¶è¿æ¥ç‚¹åŒ¹é…ç‰¹å®šçš„æ‰§è¡Œå¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å¯¹åº”çš„ç±»è¦å…·æœ‰æŒ‡å®šç±»å‹çš„æ³¨è§£</td>
</tr>
<tr>
<td>within()</td>
<td>é™åˆ¶è¿æ¥ç‚¹åŒ¹é…æŒ‡å®šçš„ç±»å‹</td>
</tr>
<tr>
<td>@within()</td>
<td>é™åˆ¶è¿æ¥ç‚¹åŒ¹é…æŒ‡å®šæ³¨è§£æ‰€æ ‡æ³¨çš„ç±»å‹ï¼ˆå½“ä½¿ç”¨ Spring AOP æ—¶ï¼Œæ–¹æ³•å®šä¹‰åœ¨ç”±æŒ‡å®šçš„æ³¨è§£æ‰€æ ‡æ³¨çš„ç±»é‡Œï¼‰</td>
</tr>
<tr>
<td>@annotation</td>
<td>é™å®šåŒ¹é…å¸¦æœ‰æŒ‡å®šæ³¨è§£çš„è¿æ¥ç‚¹</td>
</tr>
</tbody></table>
<p>åœ¨ Spring ä¸­å°è¯•ä½¿ç”¨ AspectJ å…¶ä»–æŒ‡ç¤ºå™¨æ—¶ï¼Œå°†ä¼šæŠ›å‡º IllegalArgument-Exception å¼‚å¸¸ã€‚</p>
<p>å½“æˆ‘ä»¬æŸ¥çœ‹å¦‚ä¸Šæ‰€å±•ç¤ºçš„è¿™äº› Spring æ”¯æŒçš„æŒ‡ç¤ºå™¨æ—¶ï¼Œæ³¨æ„åªæœ‰ execution æŒ‡ç¤ºå™¨æ˜¯å®é™…æ‰§è¡ŒåŒ¹é…çš„ï¼Œè€Œå…¶ä»–çš„æŒ‡ç¤ºå™¨éƒ½æ˜¯ç”¨æ¥é™åˆ¶åŒ¹é…çš„ã€‚è¿™è¯´æ˜ execution æŒ‡ç¤ºå™¨æ˜¯æˆ‘ä»¬åœ¨ç¼–å†™åˆ‡ç‚¹å®šä¹‰æ—¶æœ€ä¸»è¦ä½¿ç”¨çš„æŒ‡ç¤ºå™¨ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨å…¶ä»–æŒ‡ç¤ºå™¨æ¥é™åˆ¶æ‰€åŒ¹é…çš„åˆ‡ç‚¹ã€‚</p>
<h4 id="ç¼–å†™åˆ‡ç‚¹"><a href="#ç¼–å†™åˆ‡ç‚¹" class="headerlink" title="ç¼–å†™åˆ‡ç‚¹"></a>ç¼–å†™åˆ‡ç‚¹</h4><p>ä¸ºäº†é˜è¿° Spring ä¸­çš„åˆ‡é¢ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸ªä¸»é¢˜æ¥å®šä¹‰åˆ‡é¢çš„åˆ‡ç‚¹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª Performance æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> concert;<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Performance</span> </span>&#123;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">perform</span><span class="params">()</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>Performance å¯ä»¥ä»£è¡¨ä»»ä½•ç±»å‹çš„ç°åœºè¡¨æ¼”ï¼Œå¦‚èˆå°å‰§ã€ç”µå½±æˆ–éŸ³ä¹ä¼šã€‚å‡è®¾æˆ‘ä»¬æƒ³ç¼–å†™ Performance çš„ perform() æ–¹æ³•è§¦å‘çš„é€šçŸ¥ã€‚å›¾ 4.4 å±•ç°äº†ä¸€ä¸ªåˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œè¿™ä¸ªè¡¨è¾¾å¼èƒ½å¤Ÿè®¾ç½®å½“ perform() æ–¹æ³•æ‰§è¡Œæ—¶è§¦å‘é€šçŸ¥çš„è°ƒç”¨ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211014161703113.png" alt="image-20211014161703113"></p>
<center>å›¾ 4.4ã€€ä½¿ç”¨ AspectJ åˆ‡ç‚¹è¡¨è¾¾å¼æ¥é€‰æ‹© Performance çš„ perform() æ–¹æ³•</center>

<p>æˆ‘ä»¬ä½¿ç”¨ execution() æŒ‡ç¤ºå™¨é€‰æ‹© Performance çš„ perform() æ–¹æ³•ã€‚æ–¹æ³•è¡¨è¾¾å¼ä»¥ â€œ*â€ å·å¼€å§‹ï¼Œè¡¨æ˜äº†æˆ‘ä»¬ä¸å…³å¿ƒæ–¹æ³•è¿”å›å€¼çš„ç±»å‹ã€‚ç„¶åï¼Œæˆ‘ä»¬æŒ‡å®šäº†å…¨é™å®šç±»åå’Œæ–¹æ³•åã€‚å¯¹äºæ–¹æ³•å‚æ•°åˆ—è¡¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªç‚¹å·ï¼ˆ..ï¼‰è¡¨æ˜åˆ‡ç‚¹è¦é€‰æ‹©ä»»æ„çš„ perform() æ–¹æ³•ï¼Œæ— è®ºè¯¥æ–¹æ³•çš„å…¥å‚æ˜¯ä»€ä¹ˆã€‚</p>
<p>ç°åœ¨å‡è®¾æˆ‘ä»¬éœ€è¦é…ç½®çš„åˆ‡ç‚¹ä»…åŒ¹é… concert åŒ…ã€‚åœ¨æ­¤åœºæ™¯ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ within() æŒ‡ç¤ºå™¨æ¥é™åˆ¶åŒ¹é…ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211014162033571.png" alt="image-20211014162033571"></p>
<center>å›¾ 4.5ã€€ä½¿ç”¨ within() æŒ‡ç¤ºå™¨é™åˆ¶åˆ‡ç‚¹èŒƒå›´</center>

<p>è¯·æ³¨æ„æˆ‘ä»¬ä½¿ç”¨äº† â€œ&amp;&amp;â€ æ“ä½œç¬¦æŠŠ execution() å’Œ within() æŒ‡ç¤ºå™¨è¿æ¥åœ¨ä¸€èµ·å½¢æˆä¸ï¼ˆandï¼‰å…³ç³»ï¼ˆåˆ‡ç‚¹å¿…é¡»åŒ¹é…æ‰€æœ‰çš„æŒ‡ç¤ºå™¨ï¼‰ã€‚ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ â€œ||â€ æ“ä½œç¬¦æ¥æ ‡è¯†æˆ–ï¼ˆorï¼‰å…³ç³»ï¼Œè€Œä½¿ç”¨ â€œ!â€ æ“ä½œç¬¦æ¥æ ‡è¯†éï¼ˆnotï¼‰æ“ä½œã€‚</p>
<p>å› ä¸º â€œ&amp;â€ åœ¨ XML ä¸­æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œæ‰€ä»¥åœ¨ Spring çš„ XML é…ç½®é‡Œé¢æè¿°åˆ‡ç‚¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨and æ¥ä»£æ›¿ â€œ&amp;&amp;â€ã€‚åŒæ ·ï¼Œor å’Œ not å¯ä»¥åˆ†åˆ«ç”¨æ¥ä»£æ›¿ â€œ||â€ å’Œ â€œ!â€ã€‚</p>
<h4 id="åœ¨åˆ‡ç‚¹ä¸­é€‰æ‹©bean"><a href="#åœ¨åˆ‡ç‚¹ä¸­é€‰æ‹©bean" class="headerlink" title="åœ¨åˆ‡ç‚¹ä¸­é€‰æ‹©bean"></a>åœ¨åˆ‡ç‚¹ä¸­é€‰æ‹©bean</h4><p>é™¤äº†è¡¨ 4.1 æ‰€åˆ—çš„æŒ‡ç¤ºå™¨å¤–ï¼ŒSpring è¿˜å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ bean() æŒ‡ç¤ºå™¨ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨åˆ‡ç‚¹è¡¨è¾¾å¼ä¸­ä½¿ç”¨ bean çš„ ID æ¥æ ‡è¯† beanã€‚bean() ä½¿ç”¨ bean ID æˆ– bean åç§°ä½œä¸ºå‚æ•°æ¥é™åˆ¶åˆ‡ç‚¹åªåŒ¹é…ç‰¹å®šçš„ beanã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘å¦‚ä¸‹çš„åˆ‡ç‚¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execitopn(* concert.Performance.perform()) <span class="function">and <span class="title">bean</span><span class="params">(<span class="string">&#x27;woodstack&#x27;</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨æ‰§è¡Œ Performance çš„ perform() æ–¹æ³•æ—¶åº”ç”¨é€šçŸ¥ï¼Œä½†é™å®š bean çš„ ID ä¸º woodstockã€‚</p>
<p>åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œé™å®šåˆ‡ç‚¹ä¸ºæŒ‡å®šçš„ bean æˆ–è®¸å¾ˆæœ‰æ„ä¹‰ï¼Œä½†æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨éæ“ä½œä¸ºé™¤äº†ç‰¹å®š ID ä»¥å¤–çš„å…¶ä»– bean åº”ç”¨é€šçŸ¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execitopn(* concert.Performance.perform()) <span class="function">and <span class="title">bean</span><span class="params">(<span class="string">&#x27;woodstack&#x27;</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>åœ¨æ­¤åœºæ™¯ä¸‹ï¼Œåˆ‡é¢çš„é€šçŸ¥ä¼šè¢«ç¼–ç»‡åˆ°æ‰€æœ‰ ID ä¸ä¸º woodstock çš„ bean ä¸­ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»è®²è§£äº†ç¼–å†™åˆ‡ç‚¹çš„åŸºç¡€çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬å†äº†è§£ä¸€ä¸‹å¦‚ä½•ç¼–å†™é€šçŸ¥å’Œä½¿ç”¨è¿™äº›åˆ‡ç‚¹å£°æ˜åˆ‡é¢ã€‚</p>
<h3 id="ä½¿ç”¨æ³¨è§£åˆ›å»ºåˆ‡é¢"><a href="#ä½¿ç”¨æ³¨è§£åˆ›å»ºåˆ‡é¢" class="headerlink" title="ä½¿ç”¨æ³¨è§£åˆ›å»ºåˆ‡é¢"></a>ä½¿ç”¨æ³¨è§£åˆ›å»ºåˆ‡é¢</h3><p>ä½¿ç”¨æ³¨è§£æ¥åˆ›å»ºåˆ‡é¢æ˜¯ AspectJ 5 æ‰€å¼•å…¥çš„å…³é”®ç‰¹æ€§ã€‚AspectJ 5ä¹‹å‰ï¼Œç¼–å†™ AspectJ åˆ‡é¢éœ€è¦å­¦ä¹ ä¸€ç§ Java è¯­è¨€çš„æ‰©å±•ï¼Œä½†æ˜¯ AspectJ é¢å‘æ³¨è§£çš„æ¨¡å‹å¯ä»¥éå¸¸ç®€ä¾¿åœ°é€šè¿‡å°‘é‡æ³¨è§£æŠŠä»»æ„ç±»è½¬å˜ä¸ºåˆ‡é¢ã€‚</p>
<p>æˆ‘ä»¬å·²ç»å®šä¹‰äº† Performance æ¥å£ï¼Œå®ƒæ˜¯åˆ‡é¢ä¸­åˆ‡ç‚¹çš„ç›®æ ‡å¯¹è±¡ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ AspecJ æ³¨è§£æ¥å®šä¹‰åˆ‡é¢ã€‚</p>
<h4 id="å®šä¹‰åˆ‡é¢"><a href="#å®šä¹‰åˆ‡é¢" class="headerlink" title="å®šä¹‰åˆ‡é¢"></a>å®šä¹‰åˆ‡é¢</h4><p>å¦‚æœä¸€åœºæ¼”å‡ºæ²¡æœ‰è§‚ä¼—çš„è¯ï¼Œé‚£ä¸èƒ½ç§°ä¹‹ä¸ºæ¼”å‡ºã€‚å¯¹ä¸å¯¹ï¼Ÿä»æ¼”å‡ºçš„è§’åº¦æ¥çœ‹ï¼Œè§‚ä¼—æ˜¯éå¸¸é‡è¦çš„ï¼Œä½†æ˜¯å¯¹æ¼”å‡ºæœ¬èº«çš„åŠŸèƒ½æ¥è®²ï¼Œå®ƒå¹¶ä¸æ˜¯æ ¸å¿ƒï¼Œè¿™æ˜¯ä¸€ä¸ªå•ç‹¬çš„å…³æ³¨ç‚¹ã€‚å› æ­¤ï¼Œå°†è§‚ä¼—å®šä¹‰ä¸ºä¸€ä¸ªåˆ‡é¢ï¼Œå¹¶å°†å…¶åº”ç”¨åˆ°æ¼”å‡ºä¸Šå°±æ˜¯è¾ƒä¸ºæ˜æ™ºçš„åšæ³•ã€‚</p>
<p>ç¨‹åºæ¸…å• 4.1 å±•ç°äº† Audience ç±»ï¼Œå®ƒå®šä¹‰äº†æˆ‘ä»¬æ‰€éœ€çš„ä¸€ä¸ªåˆ‡é¢ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.1ã€€Audience ç±»ï¼šè§‚çœ‹æ¼”å‡ºçš„åˆ‡é¢</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> concert;<span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;<span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;<span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;<span class="keyword">import</span> org.aspectj.lang.annotation.Before;<span class="meta">@Aspectpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">Audience</span> </span>&#123;    <span class="meta">@Before(&quot;execution(** concert.Performance.perform(..))&quot;)</span> <span class="comment">//è¡¨æ¼”ä¹‹å‰    public void silienceCellPhones() &#123;        System.out.println(&quot;siliencing cellphones&quot;);    &#125;    @Before(&quot;execution(** concert.Performance.perform(..))&quot;) //è¡¨æ¼”ä¹‹å‰    public void takekSeats() &#123;        System.out.println(&quot;the audience is taking their seats&quot;);    &#125;    @AfterReturning&quot;execution(** concert.Performance.perform(..))&quot;) //è¡¨æ¼”ä¹‹å    public void applaud() &#123;        System.out.println(&quot;clap clap clap clap clap&quot;);    &#125;    @AfterThrowing(&quot;execution(** concert.Performance.perform(..))&quot;) //è¡¨æ¼”å¤±è´¥ä¹‹å    public void demandRefund() &#123;        System.out.println(&quot;Boo! we want our money back!&quot;);    &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>Audience ç±»ä½¿ç”¨ @AspectJ æ³¨è§£è¿›è¡Œäº†æ ‡æ³¨ã€‚è¯¥æ³¨è§£è¡¨æ˜ Audience ä¸ä»…ä»…æ˜¯ä¸€ä¸ª POJOï¼Œè¿˜æ˜¯ä¸€ä¸ªåˆ‡é¢ã€‚Audience ç±»ä¸­çš„æ–¹æ³•éƒ½ä½¿ç”¨æ³¨è§£æ¥å®šä¹‰åˆ‡é¢çš„å…·ä½“è¡Œä¸ºã€‚</p>
<p>Audience æœ‰å››ä¸ªæ–¹æ³•ï¼Œå®šä¹‰äº†ä¸€ä¸ªè§‚ä¼—åœ¨è§‚çœ‹æ¼”å‡ºæ—¶å¯èƒ½ä¼šåšçš„äº‹æƒ…ã€‚åœ¨æ¼”å‡ºä¹‹å‰ï¼Œè§‚ä¼—è¦å°±åï¼ˆtakeSeats()ï¼‰å¹¶å°†æ‰‹æœºè°ƒè‡³é™éŸ³çŠ¶æ€ï¼ˆsilenceCellPhones()ï¼‰ã€‚å¦‚æœæ¼”å‡ºå¾ˆç²¾å½©çš„è¯ï¼Œè§‚ä¼—åº”è¯¥ä¼šé¼“æŒå–å½©ï¼ˆapplause()ï¼‰ã€‚ä¸è¿‡ï¼Œå¦‚æœæ¼”å‡ºæ²¡æœ‰è¾¾åˆ°è§‚ä¼—é¢„æœŸçš„è¯ï¼Œè§‚ä¼—ä¼šè¦æ±‚é€€æ¬¾ï¼ˆdemandRefund()ï¼‰ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™äº›æ–¹æ³•éƒ½ä½¿ç”¨äº†é€šçŸ¥æ³¨è§£æ¥è¡¨æ˜å®ƒä»¬åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨ã€‚AspectJ æä¾›äº†äº”ä¸ªæ³¨è§£æ¥å®šä¹‰é€šçŸ¥ï¼Œå¦‚è¡¨ 4.2 æ‰€ç¤ºã€‚</p>
<center>è¡¨ 4.2ã€€Spring ä½¿ç”¨ AspectJ æ³¨è§£æ¥å£°æ˜é€šçŸ¥æ–¹æ³•</center>

<table>
<thead>
<tr>
<th>æ³¨ã€€ã€€è§£</th>
<th>é€šã€€ã€€çŸ¥</th>
</tr>
</thead>
<tbody><tr>
<td>@After</td>
<td>é€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•è¿”å›æˆ–æŠ›å‡ºå¼‚å¸¸åè°ƒç”¨</td>
</tr>
<tr>
<td>@AfterReturning</td>
<td>é€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•è¿”å›åè°ƒç”¨</td>
</tr>
<tr>
<td>@AfterThrowing</td>
<td>é€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åè°ƒç”¨</td>
</tr>
<tr>
<td>@Around</td>
<td>é€šçŸ¥æ–¹æ³•ä¼šå°†ç›®æ ‡æ–¹æ³•å°è£…èµ·æ¥</td>
</tr>
<tr>
<td>@Before</td>
<td>é€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•è°ƒç”¨ä¹‹å‰æ‰§è¡Œ</td>
</tr>
</tbody></table>
<p> Audience ä½¿ç”¨åˆ°äº†å‰é¢ 5 ä¸ªæ³¨è§£ä¸­çš„ 3 ä¸ªã€‚takeSeats() å’Œ silenceCellPhones() æ–¹æ³•éƒ½ç”¨åˆ°äº† @Before æ³¨è§£ï¼Œè¡¨æ˜å®ƒä»¬åº”è¯¥åœ¨æ¼”å‡ºå¼€å§‹ä¹‹å‰è°ƒç”¨ã€‚applause() æ–¹æ³•ä½¿ç”¨äº† @AfterReturning æ³¨è§£ï¼Œå®ƒä¼šåœ¨æ¼”å‡ºæˆåŠŸè¿”å›åè°ƒç”¨ã€‚demandRefund() æ–¹æ³•ä¸Šæ·»åŠ äº† @AfterThrowing æ³¨è§£ï¼Œè¿™è¡¨æ˜å®ƒä¼šåœ¨æŠ›å‡ºå¼‚å¸¸ä»¥åæ‰§è¡Œã€‚</p>
<p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œæ‰€æœ‰çš„è¿™äº›æ³¨è§£éƒ½ç»™å®šäº†ä¸€ä¸ªåˆ‡ç‚¹è¡¨è¾¾å¼ä½œä¸ºå®ƒçš„å€¼ï¼ŒåŒæ—¶ï¼Œè¿™å››ä¸ªæ–¹æ³•çš„åˆ‡ç‚¹è¡¨è¾¾å¼éƒ½æ˜¯ç›¸åŒçš„ã€‚å…¶å®ï¼Œå®ƒä»¬å¯ä»¥è®¾ç½®æˆä¸åŒçš„åˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œä½†æ˜¯åœ¨è¿™é‡Œï¼Œè¿™ä¸ªåˆ‡ç‚¹è¡¨è¾¾å¼å°±èƒ½æ»¡è¶³æ‰€æœ‰é€šçŸ¥æ–¹æ³•çš„éœ€æ±‚ã€‚è®©æˆ‘ä»¬è¿‘è·ç¦»çœ‹ä¸€ä¸‹è¿™ä¸ªè®¾ç½®ç»™é€šçŸ¥æ³¨è§£çš„åˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å‘ç°å®ƒä¼šåœ¨ Performance çš„perform() æ–¹æ³•æ‰§è¡Œæ—¶è§¦å‘ã€‚</p>
<p>ç›¸åŒçš„åˆ‡ç‚¹è¡¨è¾¾å¼æˆ‘ä»¬é‡å¤äº†å››éï¼Œè¿™å¯çœŸä¸æ˜¯ä»€ä¹ˆå…‰å½©çš„äº‹æƒ…ã€‚è¿™æ ·çš„é‡å¤è®©äººæ„Ÿè§‰æœ‰äº›ä¸å¯¹åŠ²ã€‚å¦‚æœæˆ‘ä»¬åªå®šä¹‰è¿™ä¸ªåˆ‡ç‚¹ä¸€æ¬¡ï¼Œç„¶åæ¯æ¬¡éœ€è¦çš„æ—¶å€™å¼•ç”¨å®ƒï¼Œé‚£ä¹ˆè¿™ä¼šæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ¡ˆã€‚</p>
<p>å¹¸å¥½ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥è¿™æ ·åšï¼š@Pointcut æ³¨è§£èƒ½å¤Ÿåœ¨ä¸€ä¸ª @AspectJ åˆ‡é¢å†…å®šä¹‰å¯é‡ç”¨çš„åˆ‡ç‚¹ã€‚æ¥ä¸‹æ¥çš„ç¨‹åºæ¸…å• 4.2 å±•ç°äº†æ–°çš„ Audienceï¼Œç°åœ¨å®ƒä½¿ç”¨äº†@Pointcutã€‚</p>
<center>ç¨‹åºæ¸…å• 4.2ã€€é€šè¿‡ @Pointcut æ³¨è§£å£°æ˜é¢‘ç¹ä½¿ç”¨çš„åˆ‡ç‚¹è¡¨è¾¾å¼</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> concert;<span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;<span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;<span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;<span class="keyword">import</span> org.aspectj.lang.annotation.Before;<span class="meta">@Aspectpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">Audience</span> </span>&#123;    <span class="meta">@Pointcut(&quot;execution(** concert.Performance.perform(..))&quot;)</span> <span class="comment">//å®šä¹‰å‘½åçš„åˆ‡ç‚¹    public void performance() &#123;&#125;        @Before(&quot;performance()&quot;) //è¡¨æ¼”ä¹‹å‰    public void silienceCellPhones() &#123;        System.out.println(&quot;siliencing cellphones&quot;);    &#125;    @Before(&quot;performance()&quot;) //è¡¨æ¼”ä¹‹å‰    public void takekSeats() &#123;        System.out.println(&quot;the audience is taking their seats&quot;);    &#125;    @AfterReturning&quot;performance()&quot;) //è¡¨æ¼”ä¹‹å    public void applaud() &#123;        System.out.println(&quot;clap clap clap clap clap&quot;);    &#125;    @AfterThrowing(&quot;performance()&quot;) //è¡¨æ¼”å¤±è´¥ä¹‹å    public void demandRefund() &#123;        System.out.println(&quot;Boo! we want our money back!&quot;);    &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ Audience ä¸­ï¼Œperformance() æ–¹æ³•ä½¿ç”¨äº† @Pointcut æ³¨è§£ã€‚ä¸º @Pointcut æ³¨è§£è®¾ç½®çš„å€¼æ˜¯ä¸€ä¸ªåˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œå°±åƒä¹‹å‰åœ¨é€šçŸ¥æ³¨è§£ä¸Šæ‰€è®¾ç½®çš„é‚£æ ·ã€‚é€šè¿‡åœ¨ performance() æ–¹æ³•ä¸Šæ·»åŠ  @Pointcut æ³¨è§£ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ‰©å±•äº†åˆ‡ç‚¹è¡¨è¾¾å¼è¯­è¨€ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä»»ä½•çš„åˆ‡ç‚¹è¡¨è¾¾å¼ä¸­ä½¿ç”¨ performance() äº†ï¼Œå¦‚æœä¸è¿™æ ·åšçš„è¯ï¼Œä½ éœ€è¦åœ¨è¿™äº›åœ°æ–¹ä½¿ç”¨é‚£ä¸ªæ›´é•¿çš„åˆ‡ç‚¹è¡¨è¾¾å¼ã€‚æˆ‘ä»¬ç°åœ¨æŠŠæ‰€æœ‰é€šçŸ¥æ³¨è§£ä¸­çš„é•¿è¡¨è¾¾å¼éƒ½æ›¿æ¢æˆäº† performance()ã€‚</p>
<p>performance() æ–¹æ³•çš„å®é™…å†…å®¹å¹¶ä¸é‡è¦ï¼Œåœ¨è¿™é‡Œå®ƒå®é™…ä¸Šåº”è¯¥æ˜¯ç©ºçš„ã€‚å…¶å®è¯¥æ–¹æ³•æœ¬èº«åªæ˜¯ä¸€ä¸ªæ ‡è¯†ï¼Œä¾› @Pointcut æ³¨è§£ä¾é™„ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé™¤äº†æ³¨è§£å’Œæ²¡æœ‰å®é™…æ“ä½œçš„ performance() æ–¹æ³•ï¼ŒAudience ç±»ä¾ç„¶æ˜¯ä¸€ä¸ª POJOã€‚æˆ‘ä»¬èƒ½å¤Ÿåƒä½¿ç”¨å…¶ä»–çš„ Java ç±»é‚£æ ·è°ƒç”¨å®ƒçš„æ–¹æ³•ï¼Œå®ƒçš„æ–¹æ³•ä¹Ÿèƒ½å¤Ÿç‹¬ç«‹åœ°è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œè¿™ä¸å…¶ä»–çš„ Java ç±»å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚Audience åªæ˜¯ä¸€ä¸ª Java ç±»ï¼Œåªä¸è¿‡å®ƒé€šè¿‡æ³¨è§£è¡¨æ˜ä¼šä½œä¸ºåˆ‡é¢ä½¿ç”¨è€Œå·²ã€‚åƒå…¶ä»–çš„ Java ç±»ä¸€æ ·ï¼Œå®ƒå¯ä»¥è£…é…ä¸º Spring ä¸­çš„ beanï¼š</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">Audience <span class="title">audience</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> Audience();&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ å°±æ­¤æ­¢æ­¥çš„è¯ï¼ŒAudience åªä¼šæ˜¯ Spring å®¹å™¨ä¸­çš„ä¸€ä¸ª beanã€‚å³ä¾¿ä½¿ç”¨äº† AspectJ æ³¨è§£ï¼Œä½†å®ƒå¹¶ä¸ä¼šè¢«è§†ä¸ºåˆ‡é¢ï¼Œè¿™äº›æ³¨è§£ä¸ä¼šè§£æï¼Œä¹Ÿä¸ä¼šåˆ›å»ºå°†å…¶è½¬æ¢ä¸ºåˆ‡é¢çš„ä»£ç†ã€‚</p>
<p>å¦‚æœä½ ä½¿ç”¨ JavaConfig çš„è¯ï¼Œå¯ä»¥åœ¨é…ç½®ç±»çš„ç±»çº§åˆ«ä¸Šé€šè¿‡ä½¿ç”¨ EnableAspectJAutoProxy æ³¨è§£å¯ç”¨è‡ªåŠ¨ä»£ç†åŠŸèƒ½ã€‚ç¨‹åºæ¸…å• 4.3 å±•ç°äº†å¦‚ä½•åœ¨ JavaConfig ä¸­å¯ç”¨è‡ªåŠ¨ä»£ç†ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.3ã€€åœ¨ JavaConfig ä¸­å¯ç”¨ AspectJ æ³¨è§£çš„è‡ªåŠ¨ä»£ç†</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> concert;<span class="keyword">import</span> org.springframework.context.annotation.Bean;<span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.context.annotation.EnableAspectJAutoProxy;<span class="meta">@Configuration</span><span class="meta">@EnableAspectJAutoProxy</span> <span class="comment">// å¯ç”¨ AspectJ è‡ªåŠ¨ä»£ç†@ComponentScanpublic class ConcertConfig &#123;    @Bean    public Audience audience() &#123;        return new Audience();    &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>å‡å¦‚ä½ åœ¨ Spring ä¸­è¦ä½¿ç”¨ XML æ¥è£…é… bean çš„è¯ï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨ Spring aop å‘½åç©ºé—´ä¸­çš„ <code>&lt;aop:aspectj-autoproxy&gt;</code> å…ƒç´ ã€‚ä¸‹é¢çš„ XML é…ç½®å±•ç°äº†å¦‚ä½•å®Œæˆè¯¥åŠŸèƒ½ã€‚</p>
<center>ç¨‹åºæ¸…å•4.4ã€€åœ¨XML ä¸­ï¼Œé€šè¿‡ Spring çš„ aop å‘½åç©ºé—´å¯ç”¨ AspectJ è‡ªåŠ¨ä»£ç†</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¯ç”¨ AspectJ è‡ªåŠ¨ä»£ç† --&gt;</span><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span><span class="comment">&lt;!-- å£°æ˜ Audience bean --&gt;</span><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;concert.Audience&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡ä½ æ˜¯ä½¿ç”¨ JavaConfig è¿˜æ˜¯ XMLï¼ŒAspectJ è‡ªåŠ¨ä»£ç†éƒ½ä¼šä¸ºä½¿ç”¨ @Aspect æ³¨è§£çš„ bean åˆ›å»ºä¸€ä¸ªä»£ç†ï¼Œè¿™ä¸ªä»£ç†ä¼šå›´ç»•ç€æ‰€æœ‰è¯¥åˆ‡é¢çš„åˆ‡ç‚¹æ‰€åŒ¹é…çš„ beanã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†ä¼šä¸º Concert bean åˆ›å»ºä¸€ä¸ªä»£ç†ï¼ŒAudience ç±»ä¸­çš„é€šçŸ¥æ–¹æ³•å°†ä¼šåœ¨ perform() è°ƒç”¨å‰åæ‰§è¡Œã€‚</p>
<p>æˆ‘ä»¬éœ€è¦è®°ä½çš„æ˜¯ï¼ŒSpring çš„ AspectJ è‡ªåŠ¨ä»£ç†ä»…ä»…ä½¿ç”¨ @AspectJ ä½œä¸ºåˆ›å»ºåˆ‡é¢çš„æŒ‡å¯¼ï¼Œåˆ‡é¢ä¾ç„¶æ˜¯åŸºäºä»£ç†çš„ã€‚åœ¨æœ¬è´¨ä¸Šï¼Œå®ƒä¾ç„¶æ˜¯ Spring åŸºäºä»£ç†çš„åˆ‡é¢ã€‚è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼Œå› ä¸ºè¿™æ„å‘³ç€å°½ç®¡ä½¿ç”¨çš„æ˜¯ @AspectJ æ³¨è§£ï¼Œä½†æˆ‘ä»¬ä»ç„¶é™äºä»£ç†æ–¹æ³•çš„è°ƒç”¨ã€‚å¦‚æœæƒ³åˆ©ç”¨ AspectJ çš„æ‰€æœ‰èƒ½åŠ›ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨è¿è¡Œæ—¶ä½¿ç”¨ AspectJ å¹¶ä¸”ä¸ä¾èµ– Spring æ¥åˆ›å»ºåŸºäºä»£ç†çš„åˆ‡é¢ã€‚</p>
<p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„åˆ‡é¢åœ¨å®šä¹‰æ—¶ï¼Œä½¿ç”¨äº†ä¸åŒçš„é€šçŸ¥æ–¹æ³•æ¥å®ç°å‰ç½®é€šçŸ¥å’Œåç½®é€šçŸ¥ã€‚ä½†æ˜¯è¡¨ 4.2 è¿˜æåˆ°äº†å¦å¤–çš„ä¸€ç§é€šçŸ¥ï¼šç¯ç»•é€šçŸ¥ï¼ˆaround adviceï¼‰ã€‚ç¯ç»•é€šçŸ¥ä¸å…¶ä»–ç±»å‹çš„é€šçŸ¥æœ‰æ‰€ä¸åŒï¼Œå› æ­¤å€¼å¾—èŠ±ç‚¹æ—¶é—´æ¥ä»‹ç»å¦‚ä½•è¿›è¡Œç¼–å†™ã€‚</p>
<h4 id="åˆ›å»ºç¯ç»•é€šçŸ¥"><a href="#åˆ›å»ºç¯ç»•é€šçŸ¥" class="headerlink" title="åˆ›å»ºç¯ç»•é€šçŸ¥"></a>åˆ›å»ºç¯ç»•é€šçŸ¥</h4><p>ç¯ç»•é€šçŸ¥æ˜¯æœ€ä¸ºå¼ºå¤§çš„é€šçŸ¥ç±»å‹ã€‚å®ƒèƒ½å¤Ÿè®©ä½ æ‰€ç¼–å†™çš„é€»è¾‘å°†è¢«é€šçŸ¥çš„ç›®æ ‡æ–¹æ³•å®Œå…¨åŒ…è£…èµ·æ¥ã€‚å®é™…ä¸Šå°±åƒåœ¨ä¸€ä¸ªé€šçŸ¥æ–¹æ³•ä¸­åŒæ—¶ç¼–å†™å‰ç½®é€šçŸ¥å’Œåç½®é€šçŸ¥ã€‚</p>
<p>ä¸ºäº†é˜è¿°ç¯ç»•é€šçŸ¥ï¼Œæˆ‘ä»¬é‡å†™ Audience åˆ‡é¢ã€‚è¿™æ¬¡ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç¯ç»•é€šçŸ¥æ¥ä»£æ›¿ä¹‹å‰å¤šä¸ªä¸åŒçš„å‰ç½®é€šçŸ¥å’Œåç½®é€šçŸ¥ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.5ã€€ä½¿ç”¨ç¯ç»•é€šçŸ¥é‡æ–°å®ç° Audience åˆ‡é¢</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> concert;<span class="keyword">import</span> org.aspectj.lang.proceeingJoinPoint;<span class="keyword">import</span> org.aspectj.lang.annotation.Around;<span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;<span class="keyword">import</span> org.aspectj.lang.annotation/Pointcut;<span class="meta">@Aspectpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">Audience</span> </span>&#123;    <span class="meta">@Pointcut(&quot;execution(** concert.Performance.perform(..))&quot;)</span> <span class="comment">// å®šä¹‰å‘½åçš„ç«™ç‚¹    public void performance()&#123;&#125;        @Around(&quot;performance()&quot;) // ç¯ç»•é€šçŸ¥æ–¹æ³•    public void watchPerformance(ProceedingJointPoint jp) &#123;        try &#123;            System.out.println(&quot;Silencing cell phones&quot;);            System.out.println(&quot;Taking seats&quot;);            jp.proceed();            System.out.println(&quot;CLAP CLAP CLAP&quot;)        &#125; catch (Throwable e) &#123;            System.out.println(&quot;Deamanding a refund&quot;);        &#125;    &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œ@Around æ³¨è§£è¡¨æ˜ watchPerformance() æ–¹æ³•ä¼šä½œä¸º performance() åˆ‡ç‚¹çš„ç¯ç»•é€šçŸ¥ã€‚åœ¨è¿™ä¸ªé€šçŸ¥ä¸­ï¼Œè§‚ä¼—åœ¨æ¼”å‡ºä¹‹å‰ä¼šå°†æ‰‹æœºè°ƒè‡³é™éŸ³å¹¶å°±åï¼Œæ¼”å‡ºç»“æŸåä¼šé¼“æŒå–å½©ã€‚åƒå‰é¢ä¸€æ ·ï¼Œå¦‚æœæ¼”å‡ºå¤±è´¥çš„è¯ï¼Œè§‚ä¼—ä¼šè¦æ±‚é€€æ¬¾ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªé€šçŸ¥æ‰€è¾¾åˆ°çš„æ•ˆæœä¸ä¹‹å‰çš„å‰ç½®é€šçŸ¥å’Œåç½®é€šçŸ¥æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯ï¼Œç°åœ¨å®ƒä»¬ä½äºåŒä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œä¸åƒä¹‹å‰é‚£æ ·åˆ†æ•£åœ¨å››ä¸ªä¸åŒçš„é€šçŸ¥æ–¹æ³•é‡Œé¢ã€‚</p>
<p>å…³äºè¿™ä¸ªæ–°çš„é€šçŸ¥æ–¹æ³•ï¼Œä½ é¦–å…ˆæ³¨æ„åˆ°çš„å¯èƒ½æ˜¯å®ƒæ¥å— ProceedingJoinPoint ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå¯¹è±¡æ˜¯å¿…é¡»è¦æœ‰çš„ï¼Œå› ä¸ºä½ è¦åœ¨é€šçŸ¥ä¸­é€šè¿‡å®ƒæ¥è°ƒç”¨è¢«é€šçŸ¥çš„æ–¹æ³•ã€‚é€šçŸ¥æ–¹æ³•ä¸­å¯ä»¥åšä»»ä½•çš„äº‹æƒ…ï¼Œå½“è¦å°†æ§åˆ¶æƒäº¤ç»™è¢«é€šçŸ¥çš„æ–¹æ³•æ—¶ï¼Œå®ƒéœ€è¦è°ƒç”¨ ProceedingJoinPoint çš„ proceed()æ–¹æ³•ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ«å¿˜è®°è°ƒç”¨ proceed() æ–¹æ³•ã€‚å¦‚æœä¸è°ƒè¿™ä¸ªæ–¹æ³•çš„è¯ï¼Œé‚£ä¹ˆä½ çš„é€šçŸ¥å®é™…ä¸Šä¼šé˜»å¡å¯¹è¢«é€šçŸ¥æ–¹æ³•çš„è°ƒç”¨ã€‚æœ‰å¯èƒ½è¿™å°±æ˜¯ä½ æƒ³è¦çš„æ•ˆæœï¼Œä½†æ›´å¤šçš„æƒ…å†µæ˜¯ä½ å¸Œæœ›åœ¨æŸä¸ªç‚¹ä¸Šæ‰§è¡Œè¢«é€šçŸ¥çš„æ–¹æ³•ã€‚</p>
<p>æœ‰æ„æ€çš„æ˜¯ï¼Œä½ å¯ä»¥ä¸è°ƒç”¨ proceed() æ–¹æ³•ï¼Œä»è€Œé˜»å¡å¯¹è¢«é€šçŸ¥æ–¹æ³•çš„è®¿é—®ï¼Œä¸ä¹‹ç±»ä¼¼ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨é€šçŸ¥ä¸­å¯¹å®ƒè¿›è¡Œå¤šæ¬¡è°ƒç”¨ã€‚è¦è¿™æ ·åšçš„ä¸€ä¸ªåœºæ™¯å°±æ˜¯å®ç°é‡è¯•é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯åœ¨è¢«é€šçŸ¥æ–¹æ³•å¤±è´¥åï¼Œè¿›è¡Œé‡å¤å°è¯•ã€‚</p>
<h4 id="å¤„ç†é€šçŸ¥ä¸­çš„å‚æ•°"><a href="#å¤„ç†é€šçŸ¥ä¸­çš„å‚æ•°" class="headerlink" title="å¤„ç†é€šçŸ¥ä¸­çš„å‚æ•°"></a>å¤„ç†é€šçŸ¥ä¸­çš„å‚æ•°</h4><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„åˆ‡é¢éƒ½å¾ˆç®€å•ï¼Œæ²¡æœ‰ä»»ä½•å‚æ•°ã€‚å”¯ä¸€çš„ä¾‹å¤–æ˜¯æˆ‘ä»¬ä¸ºç¯ç»•é€šçŸ¥æ‰€ç¼–å†™çš„ watchPerformance() ç¤ºä¾‹æ–¹æ³•ä¸­ä½¿ç”¨äº† ProceedingJoinPoint ä½œä¸ºå‚æ•°ã€‚é™¤äº†ç¯ç»•é€šçŸ¥ï¼Œæˆ‘ä»¬ç¼–å†™çš„å…¶ä»–é€šçŸ¥ä¸éœ€è¦å…³æ³¨ä¼ é€’ç»™è¢«é€šçŸ¥æ–¹æ³•çš„ä»»æ„å‚æ•°ã€‚è¿™å¾ˆæ­£å¸¸ï¼Œå› ä¸ºæˆ‘ä»¬æ‰€é€šçŸ¥çš„ perform() æ–¹æ³•æœ¬èº«æ²¡æœ‰ä»»ä½•å‚æ•°ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœåˆ‡é¢æ‰€é€šçŸ¥çš„æ–¹æ³•ç¡®å®æœ‰å‚æ•°è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿåˆ‡é¢èƒ½è®¿é—®å’Œä½¿ç”¨ä¼ é€’ç»™è¢«é€šçŸ¥æ–¹æ³•çš„å‚æ•°å—ï¼Ÿä¸ºäº†é˜è¿°è¿™ä¸ªé—®é¢˜ï¼Œè®©æˆ‘ä»¬é‡æ–°çœ‹ä¸€ä¸‹ 2.4.4 å°èŠ‚ä¸­çš„ BlankDisc æ ·ä¾‹ã€‚play() æ–¹æ³•ä¼šå¾ªç¯æ‰€æœ‰çš„ç£é“å¹¶è°ƒç”¨ playTrack() æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ playTrack() æ–¹æ³•ç›´æ¥æ’­æ”¾æŸä¸€ä¸ªç£é“ä¸­çš„æ­Œæ›²ã€‚</p>
<p>å‡è®¾ä½ æƒ³è®°å½•æ¯ä¸ªç£é“è¢«æ’­æ”¾çš„æ¬¡æ•°ã€‚ä¸€ç§æ–¹æ³•å°±æ˜¯ä¿®æ”¹ playTrack() æ–¹æ³•ï¼Œç›´æ¥åœ¨æ¯æ¬¡è°ƒç”¨çš„æ—¶å€™è®°å½•è¿™ä¸ªæ•°é‡ã€‚ä½†æ˜¯ï¼Œè®°å½•ç£é“çš„æ’­æ”¾æ¬¡æ•°ä¸æ’­æ”¾æœ¬èº«æ˜¯ä¸åŒçš„å…³æ³¨ç‚¹ï¼Œå› æ­¤ä¸åº”è¯¥å±äº playTrack() æ–¹æ³•ã€‚çœ‹èµ·æ¥ï¼Œè¿™åº”è¯¥æ˜¯åˆ‡é¢è¦å®Œæˆçš„ä»»åŠ¡ã€‚ä¸ºäº†è®°å½•æ¯ä¸ªç£é“æ‰€æ’­æ”¾çš„æ¬¡æ•°ï¼Œæˆ‘ä»¬åˆ›å»ºäº† TrackCounter ç±»ï¼Œå®ƒæ˜¯é€šçŸ¥ playTrack() æ–¹æ³•çš„ä¸€ä¸ªåˆ‡é¢ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.6ã€€ä½¿ç”¨å‚æ•°åŒ–çš„é€šçŸ¥æ¥è®°å½•ç£é“æ’­æ”¾çš„æ¬¡æ•°</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> systemsound;<span class="keyword">import</span> java.util.HashM ap;<span class="keyword">import</span> java.util.Map;<span class="keyword">import</span> org.aspectj.lang.annotation.Before;<span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;<span class="keyword">import</span> org.aspectj.lang.annotation/Pointcut;<span class="meta">@Aspectpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">TrackCount</span> </span>&#123;    <span class="keyword">private</span> Map&lt;Integer, Integer&gt; trackCount = <span class="keyword">new</span> HashMap&lt;&gt;();        <span class="meta">@Pointcut(&quot;execution(* soundsystem.Compactisc.playTrack(int))&quot; + &quot;&amp;&amp; args(trackNumber)&quot;)</span>    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">trackPlayed</span><span class="params">(<span class="keyword">int</span> trackNumber)</span> </span>&#123;&#125;        <span class="meta">@Before(&quot;trackPlayed(trackNumber)&quot;)</span>    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">countTrack</span><span class="params">(<span class="keyword">int</span> tackNumber)</span> </span>&#123;        <span class="keyword">int</span> currentCount = getPlayCount(trackNumber);        trackCounts.put(trackNumber, currentCount + <span class="number">1</span>);    &#125;        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPlayCount</span><span class="params">(<span class="keyword">int</span> trackNumber)</span> </span>&#123;        <span class="keyword">return</span> trackCounts.containsKey(trackNumber)? trackCounts.get(trackNumber) : <span class="number">0</span>;    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>åƒä¹‹å‰æ‰€åˆ›å»ºçš„åˆ‡é¢ä¸€æ ·ï¼Œè¿™ä¸ªåˆ‡é¢ä½¿ç”¨ @Pointcut æ³¨è§£å®šä¹‰å‘½åçš„åˆ‡ç‚¹ï¼Œå¹¶ä½¿ç”¨ @Before å°†ä¸€ä¸ªæ–¹æ³•å£°æ˜ä¸ºå‰ç½®é€šçŸ¥ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œçš„ä¸åŒç‚¹åœ¨äºåˆ‡ç‚¹è¿˜å£°æ˜äº†è¦æä¾›ç»™é€šçŸ¥æ–¹æ³•çš„å‚æ•°ã€‚å›¾ 4.6 å°†åˆ‡ç‚¹è¡¨è¾¾å¼è¿›è¡Œäº†åˆ†è§£ï¼Œä»¥å±•ç°å‚æ•°æ˜¯åœ¨ä»€ä¹ˆåœ°æ–¹æŒ‡å®šçš„ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211014175714743.png" alt="image-20211014175714743"></p>
<center>å›¾4.6ã€€åœ¨åˆ‡ç‚¹è¡¨è¾¾å¼ä¸­å£°æ˜å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°ä¼ å…¥åˆ°é€šçŸ¥æ–¹æ³•ä¸­</center>

<p>éœ€è¦å…³æ³¨çš„æ˜¯åˆ‡ç‚¹è¡¨è¾¾å¼ä¸­çš„ args(trackNumber) é™å®šç¬¦ã€‚å®ƒè¡¨æ˜ä¼ é€’ç»™ playTrack() æ–¹æ³•çš„intç±»å‹å‚æ•°ä¹Ÿä¼šä¼ é€’åˆ°é€šçŸ¥ä¸­å»ã€‚å‚æ•°çš„åç§° trackNumber ä¹Ÿä¸åˆ‡ç‚¹æ–¹æ³•ç­¾åä¸­çš„å‚æ•°ç›¸åŒ¹é…ã€‚</p>
<p>è¿™ä¸ªå‚æ•°ä¼šä¼ é€’åˆ°é€šçŸ¥æ–¹æ³•ä¸­ï¼Œè¿™ä¸ªé€šçŸ¥æ–¹æ³•æ˜¯é€šè¿‡ @Before æ³¨è§£å’Œå‘½ååˆ‡ç‚¹ trackPlayed(trackNumber) å®šä¹‰çš„ã€‚åˆ‡ç‚¹å®šä¹‰ä¸­çš„å‚æ•°ä¸åˆ‡ç‚¹æ–¹æ³•ä¸­çš„å‚æ•°åç§°æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ ·å°±å®Œæˆäº†ä»å‘½ååˆ‡ç‚¹åˆ°é€šçŸ¥æ–¹æ³•çš„å‚æ•°è½¬ç§»ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Spring é…ç½®ä¸­å°† BlankDisc å’Œ TrackCounter å®šä¹‰ä¸º beanï¼Œå¹¶å¯ç”¨ AspectJ è‡ªåŠ¨ä»£ç†ï¼Œå¦‚ç¨‹åºæ¸…å• 4.7 æ‰€ç¤ºã€‚</p>
<center>ç¨‹åºæ¸…å•4.7ã€€é…ç½®TrackCountè®°å½•æ¯ä¸ªç£é“æ’­æ”¾çš„æ¬¡æ•°</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> concert;<span class="keyword">import</span> java.util.ArrayList;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> org.springframework.context.annotation.Bean;<span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;<span class="keyword">import</span> org.springframework.context.annotation.EnableAspectJAutoProxy;<span class="meta">@Configuration</span><span class="meta">@EnableAspectJAutoProxy</span><span class="meta">@ComponentScanpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcertConfig</span> </span>&#123;    <span class="meta">@Bean</span>    <span class="function"><span class="keyword">public</span> Compactisc <span class="title">sgtPepers</span><span class="params">()</span> </span>&#123;        BlankDisc cd = <span class="keyword">new</span> BlankDisc();        cd.setTitle(<span class="string">&quot;Sgt. Pepper&#x27;s Lonely Hearts Club Band&quot;</span>);        <span class="function">cd <span class="title">setArtist</span><span class="params">(<span class="string">&quot;The Beatles&quot;</span>)</span></span>;        List&lt;String&gt; tracks = <span class="keyword">new</span> ArrayList&lt;&gt;();        tracks.add(<span class="string">&quot;Sgt. Pepper&#x27;s Lonely Hearts Club Band&quot;</span>);        track.add(<span class="string">&quot;With a Little help from My Friends&quot;</span>);        track.add(<span class="string">&quot;Lucy in the Sky with Diamonds&quot;</span>);        track.add(<span class="string">&quot;Getting Better&quot;</span>);        track.add(<span class="string">&quot;Fixing a Hole&quot;</span>);        <span class="comment">// ...itger tracjs inutted fir brevity...        cd.setTracks(tracks);        return cd;    &#125;        @Bean    public TrackCounter trackCounter() &#123;        return new TrackCounter();    &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œä¸ºäº†è¯æ˜å®ƒèƒ½æ­£å¸¸å·¥ä½œï¼Œä½ å¯ä»¥ç¼–å†™å¦‚ä¸‹çš„ç®€å•æµ‹è¯•ã€‚å®ƒä¼šæ’­æ”¾å‡ ä¸ªç£é“å¹¶é€šè¿‡ TrackCounter æ–­è¨€æ’­æ”¾çš„æ•°é‡ã€‚</p>
<center>ç¨‹åºæ¸…å•4.8ã€€æµ‹è¯•TrackCounteråˆ‡é¢</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;<span class="keyword">import</span> org.junit.Assert;<span class="keyword">import</span> org.junit.Rule;<span class="keyword">import</span> org.junit.Test;<span class="keyword">import</span> org.junit.contrib.java.lang.system.StandardOutputStreamLog;<span class="keyword">import</span> org.junit.runner.RunWith;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;<span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;<span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span><span class="meta">@ContextConfiguration(classes=TrackCounterConfig.class)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrackCounterTest</span> </span>&#123;    <span class="meta">@Rule</span>    <span class="keyword">public</span> <span class="keyword">final</span> StandardOutputStreamLog log = <span class="keyword">new</span> StandardOutputStreamLog();        <span class="meta">@Autowired</span>    <span class="keyword">private</span> CompactDisc cd;        <span class="meta">@Test</span>    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTrackCounter</span><span class="params">()</span> </span>&#123;        cd.playTrack(<span class="number">1</span>);        cd.playTrack(<span class="number">2</span>);        cd.playTrack(<span class="number">3</span>);        assertEqual(<span class="number">1</span>, counter.getPlayhCount(<span class="number">1</span>));        assertEqual(<span class="number">1</span>, counter.getPlayhCount(<span class="number">2</span>));        assertEqual(<span class="number">1</span>, counter.getPlayhCount(<span class="number">3</span>));    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåœ¨æˆ‘ä»¬æ‰€ä½¿ç”¨çš„åˆ‡é¢ä¸­ï¼Œæ‰€åŒ…è£…çš„éƒ½æ˜¯è¢«é€šçŸ¥å¯¹è±¡çš„å·²æœ‰æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œæ–¹æ³•åŒ…è£…ä»…ä»…æ˜¯åˆ‡é¢æ‰€èƒ½å®ç°çš„åŠŸèƒ½ä¹‹ä¸€ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•é€šè¿‡ç¼–å†™åˆ‡é¢ï¼Œä¸ºè¢«é€šçŸ¥çš„å¯¹è±¡å¼•å…¥å…¨æ–°çš„åŠŸèƒ½ã€‚</p>
<h4 id="é€šè¿‡æ³¨è§£å¼•å…¥æ–°åŠŸèƒ½"><a href="#é€šè¿‡æ³¨è§£å¼•å…¥æ–°åŠŸèƒ½" class="headerlink" title="é€šè¿‡æ³¨è§£å¼•å…¥æ–°åŠŸèƒ½"></a>é€šè¿‡æ³¨è§£å¼•å…¥æ–°åŠŸèƒ½</h4><p>ä¸€äº›ç¼–ç¨‹è¯­è¨€ï¼Œä¾‹å¦‚ Ruby å’Œ Groovyï¼Œæœ‰å¼€æ”¾ç±»çš„ç†å¿µã€‚å®ƒä»¬å¯ä»¥ä¸ç”¨ç›´æ¥ä¿®æ”¹å¯¹è±¡æˆ–ç±»çš„å®šä¹‰å°±èƒ½å¤Ÿä¸ºå¯¹è±¡æˆ–ç±»å¢åŠ æ–°çš„æ–¹æ³•ã€‚ä¸è¿‡ï¼ŒJava å¹¶ä¸æ˜¯åŠ¨æ€è¯­è¨€ã€‚ä¸€æ—¦ç±»ç¼–è¯‘å®Œæˆäº†ï¼Œæˆ‘ä»¬å°±å¾ˆéš¾å†ä¸ºè¯¥ç±»æ·»åŠ æ–°çš„åŠŸèƒ½äº†ã€‚</p>
<p>ä½†æ˜¯å¦‚æœä»”ç»†æƒ³æƒ³ï¼Œæˆ‘ä»¬åœ¨æœ¬ç« ä¸­ä¸æ˜¯ä¸€ç›´åœ¨ä½¿ç”¨åˆ‡é¢è¿™æ ·åšå—ï¼Ÿå½“ç„¶ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰ä¸ºå¯¹è±¡å¢åŠ ä»»ä½•æ–°çš„æ–¹æ³•ï¼Œä½†æ˜¯å·²ç»ä¸ºå¯¹è±¡æ‹¥æœ‰çš„æ–¹æ³•æ·»åŠ äº†æ–°åŠŸèƒ½ã€‚å¦‚æœåˆ‡é¢èƒ½å¤Ÿä¸ºç°æœ‰çš„æ–¹æ³•å¢åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆä¸èƒ½ä¸ºä¸€ä¸ªå¯¹è±¡å¢åŠ æ–°çš„æ–¹æ³•å‘¢ï¼Ÿ</p>
<p>å®é™…ä¸Šï¼Œåˆ©ç”¨è¢«ç§°ä¸ºå¼•å…¥çš„ AOP æ¦‚å¿µï¼Œåˆ‡é¢å¯ä»¥ä¸º Spring bean æ·»åŠ æ–°æ–¹æ³•ã€‚</p>
<p>å›é¡¾ä¸€ä¸‹ï¼Œåœ¨ Spring ä¸­ï¼Œåˆ‡é¢åªæ˜¯å®ç°äº†å®ƒä»¬æ‰€åŒ…è£… bean ç›¸åŒæ¥å£çš„ä»£ç†ã€‚å¦‚æœé™¤äº†å®ç°è¿™äº›æ¥å£ï¼Œä»£ç†ä¹Ÿèƒ½æš´éœ²æ–°æ¥å£çš„è¯ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿé‚£æ ·çš„è¯ï¼Œåˆ‡é¢æ‰€é€šçŸ¥çš„ bean çœ‹èµ·æ¥åƒæ˜¯å®ç°äº†æ–°çš„æ¥å£ï¼Œå³ä¾¿åº•å±‚å®ç°ç±»å¹¶æ²¡æœ‰å®ç°è¿™äº›æ¥å£ä¹Ÿæ— æ‰€è°“ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211014180948279.png" alt="image-20211014180948279"></p>
<center>
    å›¾ 4.7ã€€ä½¿ç”¨ Spring AOPï¼Œæˆ‘ä»¬å¯ä»¥ä¸º bean å¼•å…¥æ–°çš„æ–¹æ³•ã€‚ä»£ç†æ‹¦æˆªè°ƒç”¨å¹¶å§”æ‰˜ç»™å®ç°è¯¥æ–¹æ³•çš„å…¶ä»–å¯¹è±¡
</center>


<p>æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å¼•å…¥æ¥å£çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä»£ç†ä¼šæŠŠæ­¤è°ƒç”¨å§”æ‰˜ç»™å®ç°äº†æ–°æ¥å£çš„æŸä¸ªå…¶ä»–å¯¹è±¡ã€‚å®é™…ä¸Šï¼Œä¸€ä¸ª bean çš„å®ç°è¢«æ‹†åˆ†åˆ°äº†å¤šä¸ªç±»ä¸­ã€‚</p>
<p>ä¸ºäº†éªŒè¯è¯¥ä¸»æ„èƒ½è¡Œå¾—é€šï¼Œæˆ‘ä»¬ä¸ºç¤ºä¾‹ä¸­çš„æ‰€æœ‰çš„ Performance å®ç°å¼•å…¥ä¸‹é¢çš„ Encoreable æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> concert;<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Encorable</span> </span>&#123;    <span class="function"><span class="keyword">void</span> <span class="title">performEncore</span><span class="params">()</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>æš‚ä¸”å…ˆä¸ç®¡ Encoreable æ˜¯ä¸æ˜¯ä¸€ä¸ªçœŸæ­£å­˜åœ¨çš„å•è¯ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ç§æ–¹å¼å°†è¿™ä¸ªæ¥å£åº”ç”¨åˆ° Performance å®ç°ä¸­ã€‚æˆ‘ä»¬ç°åœ¨å‡è®¾ä½ èƒ½å¤Ÿè®¿é—® Performance çš„æ‰€æœ‰å®ç°ï¼Œå¹¶å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œè®©å®ƒä»¬éƒ½å®ç° Encoreable æ¥å£ã€‚ä½†æ˜¯ï¼Œä»è®¾è®¡çš„è§’åº¦æ¥çœ‹ï¼Œè¿™å¹¶ä¸æ˜¯æœ€å¥½çš„åšæ³•ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ Performance éƒ½æ˜¯å…·æœ‰ Encoreable ç‰¹æ€§çš„ã€‚å¦å¤–ä¸€æ–¹é¢ï¼Œæœ‰å¯èƒ½æ— æ³•ä¿®æ”¹æ‰€æœ‰çš„ Performance å®ç°ï¼Œå½“ä½¿ç”¨ç¬¬ä¸‰æ–¹å®ç°å¹¶ä¸”æ²¡æœ‰æºç çš„æ—¶å€™æ›´æ˜¯å¦‚æ­¤ã€‚</p>
<p>å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œå€ŸåŠ©äº AOP çš„å¼•å…¥åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä¸å¿…åœ¨è®¾è®¡ä¸Šå¦¥åæˆ–è€…ä¾µå…¥æ€§åœ°æ”¹å˜ç°æœ‰çš„å®ç°ã€‚ä¸ºäº†å®ç°è¯¥åŠŸèƒ½ï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ‡é¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> concert;<span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;<span class="keyword">import</span> org.aspectj.lang.annotation.DeclareParents;<span class="meta">@Aspectpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">EncoreableIntroducer</span> </span>&#123;    <span class="meta">@DeclareParents(value=&quot;concert.Performance+&quot;,                   defaultImpl=DefaultEncoreable.class)</span>    <span class="keyword">public</span> <span class="keyword">static</span> Encoreable encoreable;&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒEncoreableIntroducer æ˜¯ä¸€ä¸ªåˆ‡é¢ã€‚ä½†æ˜¯ï¼Œå®ƒä¸æˆ‘ä»¬ä¹‹å‰æ‰€åˆ›å»ºçš„åˆ‡é¢ä¸åŒï¼Œå®ƒå¹¶æ²¡æœ‰æä¾›å‰ç½®ã€åç½®æˆ–ç¯ç»•é€šçŸ¥ï¼Œè€Œæ˜¯é€šè¿‡@DeclareParentsæ³¨è§£ï¼Œå°†Encoreableæ¥å£å¼•å…¥åˆ°Performance beanä¸­ã€‚</p>
<p>@DeclareParents æ³¨è§£ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>value å±æ€§æŒ‡å®šäº†å“ªç§ç±»å‹çš„ bean è¦å¼•å…¥è¯¥æ¥å£ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰å®ç° Performance çš„ç±»å‹ã€‚ï¼ˆæ ‡è®°ç¬¦åé¢çš„åŠ å·è¡¨ç¤ºæ˜¯ Performance çš„æ‰€æœ‰å­ç±»å‹ï¼Œè€Œä¸æ˜¯ Performance æœ¬èº«ã€‚ï¼‰</li>
<li>defaultImpl å±æ€§æŒ‡å®šäº†ä¸ºå¼•å…¥åŠŸèƒ½æä¾›å®ç°çš„ç±»ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŒ‡å®šçš„æ˜¯ DefaultEncoreable æä¾›å®ç°ã€‚</li>
<li>@DeclareParents æ³¨è§£æ‰€æ ‡æ³¨çš„é™æ€å±æ€§æŒ‡æ˜äº†è¦å¼•å…¥äº†æ¥å£ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ‰€å¼•å…¥çš„æ˜¯ Encoreable æ¥å£ã€‚</li>
</ul>
<p>å’Œå…¶ä»–çš„åˆ‡é¢ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Spring åº”ç”¨ä¸­å°† EncoreableIntroducer å£°æ˜ä¸ºä¸€ä¸ª beanï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;concert.EncoreableIntroducer&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>Spring çš„è‡ªåŠ¨ä»£ç†æœºåˆ¶å°†ä¼šè·å–åˆ°å®ƒçš„å£°æ˜ï¼Œå½“ Spring å‘ç°ä¸€ä¸ª bean ä½¿ç”¨äº† @Aspect æ³¨è§£æ—¶ï¼ŒSpring å°±ä¼šåˆ›å»ºä¸€ä¸ªä»£ç†ï¼Œç„¶åå°†è°ƒç”¨å§”æ‰˜ç»™è¢«ä»£ç†çš„ bean æˆ–è¢«å¼•å…¥çš„å®ç°ï¼Œè¿™å–å†³äºè°ƒç”¨çš„æ–¹æ³•å±äºè¢«ä»£ç†çš„ bean è¿˜æ˜¯å±äºè¢«å¼•å…¥çš„æ¥å£ã€‚</p>
<p>åœ¨ Spring ä¸­ï¼Œæ³¨è§£å’Œè‡ªåŠ¨ä»£ç†æä¾›äº†ä¸€ç§å¾ˆä¾¿åˆ©çš„æ–¹å¼æ¥åˆ›å»ºåˆ‡é¢ã€‚å®ƒéå¸¸ç®€å•ï¼Œå¹¶ä¸”åªæ¶‰åŠåˆ°æœ€å°‘çš„ Spring é…ç½®ã€‚ä½†æ˜¯ï¼Œé¢å‘æ³¨è§£çš„åˆ‡é¢å£°æ˜æœ‰ä¸€ä¸ªæ˜æ˜¾çš„åŠ£åŠ¿ï¼šä½ å¿…é¡»èƒ½å¤Ÿä¸ºé€šçŸ¥ç±»æ·»åŠ æ³¨è§£ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¿…é¡»è¦æœ‰æºç ã€‚</p>
<p>å¦‚æœä½ æ²¡æœ‰æºç çš„è¯ï¼Œæˆ–è€…ä¸æƒ³å°† AspectJ æ³¨è§£æ”¾åˆ°ä½ çš„ä»£ç ä¹‹ä¸­ï¼ŒSpring ä¸ºåˆ‡é¢æä¾›äº†å¦å¤–ä¸€ç§å¯é€‰æ–¹æ¡ˆã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ Spring XML é…ç½®æ–‡ä»¶ä¸­å£°æ˜åˆ‡é¢ã€‚</p>
<h3 id="åœ¨-XML-ä¸­å£°æ˜åˆ‡é¢"><a href="#åœ¨-XML-ä¸­å£°æ˜åˆ‡é¢" class="headerlink" title="åœ¨ XML ä¸­å£°æ˜åˆ‡é¢"></a>åœ¨ XML ä¸­å£°æ˜åˆ‡é¢</h3><p>åœ¨æœ¬ä¹¦å‰é¢çš„å†…å®¹ä¸­ï¼Œæˆ‘æ›¾ç»å»ºç«‹è¿‡è¿™æ ·ä¸€ç§åŸåˆ™ï¼Œé‚£å°±æ˜¯åŸºäºæ³¨è§£çš„é…ç½®è¦ä¼˜äºåŸºäº Java çš„é…ç½®ï¼ŒåŸºäº Java çš„é…ç½®è¦ä¼˜äºåŸºäº XML çš„é…ç½®ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ éœ€è¦å£°æ˜åˆ‡é¢ï¼Œä½†æ˜¯åˆä¸èƒ½ä¸ºé€šçŸ¥ç±»æ·»åŠ æ³¨è§£çš„æ—¶å€™ï¼Œé‚£ä¹ˆå°±å¿…é¡»è½¬å‘ XML é…ç½®äº†ã€‚</p>
<p>åœ¨ Spring çš„ AOP é…ç½®å‘½åç©ºé—´ä¸­ï¼Œæä¾›äº†å¤šä¸ªå…ƒç´ ç”¨æ¥åœ¨XMLä¸­å£°æ˜åˆ‡é¢ï¼Œå¦‚è¡¨4.3æ‰€ç¤ºã€‚</p>
<center>è¡¨ 4.3ã€€Spring çš„ AOP é…ç½®å…ƒç´ èƒ½å¤Ÿä»¥éä¾µå…¥æ€§çš„æ–¹å¼å£°æ˜åˆ‡é¢</center>

<table>
<thead>
<tr>
<th>AOP  é…ç½®å…ƒç´ </th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;aop:advisor&gt;</code></td>
<td>å®šä¹‰ AOP é€šçŸ¥å™¨</td>
</tr>
<tr>
<td><code>&lt;aop:after&gt;</code></td>
<td>å®šä¹‰ AOP åç½®é€šçŸ¥ï¼ˆä¸ç®¡è¢«é€šçŸ¥çš„æ–¹æ³•æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼‰</td>
</tr>
<tr>
<td><code>&lt;aop:afterreturning&gt;</code></td>
<td>å®šä¹‰ AOP è¿”å›é€šçŸ¥</td>
</tr>
<tr>
<td><code>&lt;aop:afterthrowing&gt;</code></td>
<td>å®šä¹‰ AOP å¼‚å¸¸é€šçŸ¥</td>
</tr>
<tr>
<td><code>&lt;aop:around&gt;</code></td>
<td>å®šä¹‰ AOP ç¯ç»•é€šçŸ¥</td>
</tr>
<tr>
<td><code>&lt;aop:aspect&gt;</code></td>
<td>å®šä¹‰ä¸€ä¸ªåˆ‡é¢</td>
</tr>
<tr>
<td><code>&lt;aop:aspectjautoproxy&gt;</code></td>
<td>å¯ç”¨ @AspectJ æ³¨è§£é©±åŠ¨çš„åˆ‡é¢</td>
</tr>
<tr>
<td><code>&lt;aop:before&gt;</code></td>
<td>å®šä¹‰ä¸€ä¸ª AOP å‰ç½®é€šçŸ¥</td>
</tr>
<tr>
<td><code>&lt;aop:config&gt;</code></td>
<td>é¡¶å±‚çš„ AOP é…ç½®å…ƒç´ ã€‚å¤§å¤šæ•°çš„ <code>&lt;aop:*&gt;</code> å…ƒç´ å¿…é¡»åŒ…å«åœ¨ <code>&lt;aop:config&gt;</code> å…ƒç´ å†…</td>
</tr>
<tr>
<td><code>&lt;aop:declareparents&gt;</code></td>
<td>ä»¥é€æ˜çš„æ–¹å¼ä¸ºè¢«é€šçŸ¥çš„å¯¹è±¡å¼•å…¥é¢å¤–çš„æ¥å£</td>
</tr>
<tr>
<td><code>&lt;aop:pointcut&gt;</code></td>
<td>å®šä¹‰ä¸€ä¸ªåˆ‡ç‚¹</td>
</tr>
</tbody></table>
<p>æˆ‘ä»¬å·²ç»çœ‹è¿‡äº† <code>&lt;aop:aspectj-autoproxy&gt;</code> å…ƒç´ ï¼Œå®ƒèƒ½å¤Ÿè‡ªåŠ¨ä»£ç† AspectJ æ³¨è§£çš„é€šçŸ¥ç±»ã€‚aop å‘½åç©ºé—´çš„å…¶ä»–å…ƒç´ èƒ½å¤Ÿè®©æˆ‘ä»¬ç›´æ¥åœ¨ Spring é…ç½®ä¸­å£°æ˜åˆ‡é¢ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨æ³¨è§£ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬é‡æ–°çœ‹ä¸€ä¸‹ Audience ç±»ï¼Œè¿™ä¸€æ¬¡æˆ‘ä»¬å°†å®ƒæ‰€æœ‰çš„ AspectJ æ³¨è§£å…¨éƒ¨ç§»é™¤æ‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Audience</span> </span>&#123;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">silienceCellPhones</span><span class="params">()</span> </span>&#123;        System.out.println(<span class="string">&quot;siliencing cellphones&quot;</span>);    &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">takekSeats</span><span class="params">()</span> </span>&#123;        System.out.println(<span class="string">&quot;the audience is taking their seats&quot;</span>);    &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">applaud</span><span class="params">()</span> </span>&#123;        System.out.println(<span class="string">&quot;clap clap clap clap clap&quot;</span>);    &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demandRefund</span><span class="params">()</span> </span>&#123;        System.out.println(<span class="string">&quot;Boo! we want our money back!&quot;</span>);    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼ŒAudience ç±»å¹¶æ²¡æœ‰ä»»ä½•ç‰¹åˆ«ä¹‹å¤„ï¼Œå®ƒå°±æ˜¯æœ‰å‡ ä¸ªæ–¹æ³•çš„ç®€å• Java ç±»ã€‚æˆ‘ä»¬å¯ä»¥åƒå…¶ä»–ç±»ä¸€æ ·æŠŠå®ƒæ³¨å†Œä¸º Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ beanã€‚</p>
<p>å°½ç®¡çœ‹èµ·æ¥å¹¶æ²¡æœ‰ä»€ä¹ˆå·®åˆ«ï¼Œä½† Audience å·²ç»å…·å¤‡äº†æˆä¸º AOP é€šçŸ¥çš„æ‰€æœ‰æ¡ä»¶ã€‚æˆ‘ä»¬å†ç¨å¾®å¸®åŠ©å®ƒä¸€æŠŠï¼Œå®ƒå°±èƒ½å¤Ÿæˆä¸ºé¢„æœŸçš„é€šçŸ¥äº†ã€‚</p>
<h4 id="å£°æ˜å‰ç½®å’Œåç½®é€šçŸ¥"><a href="#å£°æ˜å‰ç½®å’Œåç½®é€šçŸ¥" class="headerlink" title="å£°æ˜å‰ç½®å’Œåç½®é€šçŸ¥"></a>å£°æ˜å‰ç½®å’Œåç½®é€šçŸ¥</h4><p>ä½ å¯ä»¥å†æŠŠé‚£äº› AspectJ æ³¨è§£åŠ å›æ¥ï¼Œä½†è¿™å¹¶ä¸æ˜¯æœ¬èŠ‚çš„ç›®çš„ã€‚ç›¸åï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ Spring aop å‘½åç©ºé—´ä¸­çš„ä¸€äº›å…ƒç´ ï¼Œå°†æ²¡æœ‰æ³¨è§£çš„ Audience ç±»è½¬æ¢ä¸ºåˆ‡é¢ã€‚ä¸‹é¢çš„ç¨‹åºæ¸…å• 4.9 å±•ç¤ºäº†æ‰€éœ€è¦çš„ XMLã€‚</p>
<center>ç¨‹åºæ¸…å• 4.9 ä½¿ç”¨ Spring çš„ AOP é…ç½®å…ƒç´ å£°æ˜ä¸€ä¸ª audience åˆ‡é¢</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span>    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;audience&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;taskSeats&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(** concert.Perforance.perform(..))&quot;</span>/&gt;</span>        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;silenceCellPhones&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(** concert.Perforance.perform(..))&quot;</span>/&gt;</span>        <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;applaud&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(** concert.Perforance.perform(..))&quot;</span>/&gt;</span>        <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;demandRefund&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(** concert.Perforance.perform(..))&quot;</span>/&gt;</span>    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å…³äº Spring AOP é…ç½®å…ƒç´ ï¼Œç¬¬ä¸€ä¸ªéœ€è¦æ³¨æ„çš„äº‹é¡¹æ˜¯å¤§å¤šæ•°çš„ AOP é…ç½®å…ƒç´ å¿…é¡»åœ¨ <code>&lt;aop:config&gt;</code> å…ƒç´ çš„ä¸Šä¸‹æ–‡å†…ä½¿ç”¨ã€‚è¿™æ¡è§„åˆ™æœ‰å‡ ç§ä¾‹å¤–åœºæ™¯ï¼Œä½†æ˜¯æŠŠ bean å£°æ˜ä¸ºä¸€ä¸ªåˆ‡é¢æ—¶ï¼Œæˆ‘ä»¬æ€»æ˜¯ä» <code>&lt;aop:config&gt;</code> å…ƒç´ å¼€å§‹é…ç½®çš„ã€‚</p>
<p>åœ¨ <code>&lt;aop:config&gt;</code> å…ƒç´ å†…ï¼Œæˆ‘ä»¬å¯ä»¥å£°æ˜ä¸€ä¸ªæˆ–å¤šä¸ªé€šçŸ¥å™¨ã€åˆ‡é¢æˆ–è€…åˆ‡ç‚¹ã€‚åœ¨ç¨‹åºæ¸…å• 4.9 ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>&lt;aop:aspect&gt;</code> å…ƒç´ å£°æ˜äº†ä¸€ä¸ªç®€å•çš„åˆ‡é¢ã€‚ref å…ƒç´ å¼•ç”¨äº†ä¸€ä¸ª POJO beanï¼Œè¯¥ bean å®ç°äº†åˆ‡é¢çš„åŠŸèƒ½â€”â€”åœ¨è¿™é‡Œå°±æ˜¯ audienceã€‚ref å…ƒç´ æ‰€å¼•ç”¨çš„ bean æä¾›äº†åœ¨åˆ‡é¢ä¸­é€šçŸ¥æ‰€è°ƒç”¨çš„æ–¹æ³•ã€‚</p>
<p>è¯¥åˆ‡é¢åº”ç”¨äº†å››ä¸ªä¸åŒçš„é€šçŸ¥ã€‚ä¸¤ä¸ª <code>&lt;aop:before&gt;</code> å…ƒç´ å®šä¹‰äº†åŒ¹é…åˆ‡ç‚¹çš„æ–¹æ³•æ‰§è¡Œä¹‹å‰è°ƒç”¨å‰ç½®é€šçŸ¥æ–¹æ³•â€”â€”ä¹Ÿå°±æ˜¯ Audience bean çš„ takeSeats() å’Œ turnOffCellPhones() æ–¹æ³•ï¼ˆç”± method å±æ€§æ‰€å£°æ˜ï¼‰ã€‚<code>&lt;aop:after-returning&gt;</code> å…ƒç´ å®šä¹‰äº†ä¸€ä¸ªè¿”å›ï¼ˆafter-returningï¼‰é€šçŸ¥ï¼Œåœ¨åˆ‡ç‚¹æ‰€åŒ¹é…çš„æ–¹æ³•è°ƒç”¨ä¹‹åå†è°ƒç”¨ applaud() æ–¹æ³•ã€‚åŒæ ·ï¼Œ<code>&lt;aop:after-throwing&gt;</code>å…ƒç´ å®šä¹‰äº†å¼‚å¸¸ï¼ˆafter-throwingï¼‰é€šçŸ¥ï¼Œå¦‚æœæ‰€åŒ¹é…çš„æ–¹æ³•æ‰§è¡Œæ—¶æŠ›å‡ºä»»ä½•çš„å¼‚å¸¸ï¼Œéƒ½å°†ä¼šè°ƒç”¨ demandRefund() æ–¹æ³•ã€‚å›¾ 4.8 å±•ç¤ºäº†é€šçŸ¥é€»è¾‘å¦‚ä½•ç»‡å…¥åˆ°ä¸šåŠ¡é€»è¾‘ä¸­ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211014195252484.png" alt="image-20211014195252484"></p>
<center>å›¾ 4.8ã€€Audience åˆ‡é¢åŒ…å«å››ç§é€šçŸ¥ï¼Œå®ƒä»¬æŠŠé€šçŸ¥é€»è¾‘ç»‡å…¥è¿›åŒ¹é…åˆ‡é¢åˆ‡ç‚¹çš„æ–¹æ³•ä¸­</center>

<p>åœ¨æ‰€æœ‰çš„é€šçŸ¥å…ƒç´ ä¸­ï¼Œpointcut å±æ€§å®šä¹‰äº†é€šçŸ¥æ‰€åº”ç”¨çš„åˆ‡ç‚¹ï¼Œå®ƒçš„å€¼æ˜¯ä½¿ç”¨ AspectJ åˆ‡ç‚¹è¡¨è¾¾å¼è¯­æ³•æ‰€å®šä¹‰çš„åˆ‡ç‚¹ã€‚</p>
<p>ä½ æˆ–è®¸æ³¨æ„åˆ°æ‰€æœ‰é€šçŸ¥å…ƒç´ ä¸­çš„ pointcut å±æ€§çš„å€¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ˜¯å› ä¸ºæ‰€æœ‰çš„é€šçŸ¥éƒ½è¦åº”ç”¨åˆ°ç›¸åŒçš„åˆ‡ç‚¹ä¸Šã€‚</p>
<p>åœ¨åŸºäº AspectJ æ³¨è§£çš„é€šçŸ¥ä¸­ï¼Œå½“å‘ç°è¿™ç§ç±»å‹çš„é‡å¤æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ @Pointcut æ³¨è§£æ¶ˆé™¤äº†è¿™äº›é‡å¤çš„å†…å®¹ã€‚è€Œåœ¨åŸºäº XML çš„åˆ‡é¢å£°æ˜ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>&lt;aop:pointcut&gt;</code> å…ƒç´ ã€‚å¦‚ä¸‹çš„ XML å±•ç°äº†å¦‚ä½•å°†é€šç”¨çš„åˆ‡ç‚¹è¡¨è¾¾å¼æŠ½å–åˆ°ä¸€ä¸ªåˆ‡ç‚¹å£°æ˜ä¸­ï¼Œè¿™æ ·è¿™ä¸ªå£°æ˜å°±èƒ½åœ¨æ‰€æœ‰çš„é€šçŸ¥å…ƒç´ ä¸­ä½¿ç”¨äº†ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.10ã€€ä½¿ç”¨ &lt;aop:pointcut&gt; å®šä¹‰å‘½ååˆ‡ç‚¹</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span>    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;audience&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;performance&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(** concert.Perforance.perform(..))&quot;</span>/&gt;</span>        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;taskSeats&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;performance&quot;</span>/&gt;</span>        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;silenceCellPhones&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;performance&quot;</span>/&gt;</span>        <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;applaud&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;performance&quot;</span>/&gt;</span>        <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;demandRefund&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;performance&quot;</span>/&gt;</span>    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨åˆ‡ç‚¹æ˜¯åœ¨ä¸€ä¸ªåœ°æ–¹å®šä¹‰çš„ï¼Œå¹¶ä¸”è¢«å¤šä¸ªé€šçŸ¥å…ƒç´ æ‰€å¼•ç”¨ã€‚<code>&lt;aop:pointcut&gt;</code> å…ƒç´ å®šä¹‰äº†ä¸€ä¸ª id ä¸º performance çš„åˆ‡ç‚¹ã€‚åŒæ—¶ä¿®æ”¹æ‰€æœ‰çš„é€šçŸ¥å…ƒç´ ï¼Œç”¨ pointcut-ref å±æ€§æ¥å¼•ç”¨è¿™ä¸ªå‘½ååˆ‡ç‚¹ã€‚</p>
<p>æ­£å¦‚ç¨‹åºæ¸…å• 4.10 æ‰€å±•ç¤ºçš„ï¼Œ<code>&lt;aop:pointcut&gt;</code> å…ƒç´ æ‰€å®šä¹‰çš„åˆ‡ç‚¹å¯ä»¥è¢«åŒä¸€ä¸ª <code>&lt;aop:aspect&gt;</code> å…ƒç´ ä¹‹å†…çš„æ‰€æœ‰é€šçŸ¥å…ƒç´ å¼•ç”¨ã€‚å¦‚æœæƒ³è®©å®šä¹‰çš„åˆ‡ç‚¹èƒ½å¤Ÿåœ¨å¤šä¸ªåˆ‡é¢ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ <code>&lt;aop:pointcut&gt;</code> å…ƒç´ æ”¾åœ¨ <code>&lt;aop:config&gt;</code> å…ƒç´ çš„èŒƒå›´å†…ã€‚</p>
<h4 id="å£°æ˜ç¯ç»•é€šçŸ¥"><a href="#å£°æ˜ç¯ç»•é€šçŸ¥" class="headerlink" title="å£°æ˜ç¯ç»•é€šçŸ¥"></a>å£°æ˜ç¯ç»•é€šçŸ¥</h4><p>ç›®å‰ Audience çš„å®ç°å·¥ä½œå¾—éå¸¸æ£’ï¼Œä½†æ˜¯å‰ç½®é€šçŸ¥å’Œåç½®é€šçŸ¥æœ‰ä¸€äº›é™åˆ¶ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœä¸ä½¿ç”¨æˆå‘˜å˜é‡å­˜å‚¨ä¿¡æ¯çš„è¯ï¼Œåœ¨å‰ç½®é€šçŸ¥å’Œåç½®é€šçŸ¥ä¹‹é—´å…±äº«ä¿¡æ¯éå¸¸éº»çƒ¦ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾é™¤äº†è¿›åœºå…³é—­æ‰‹æœºå’Œè¡¨æ¼”ç»“æŸåé¼“æŒï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›è§‚ä¼—ç¡®ä¿ä¸€ç›´å…³æ³¨æ¼”å‡ºï¼Œå¹¶æŠ¥å‘Šæ¯ä¸ªå‚èµ›è€…è¡¨æ¼”äº†å¤šé•¿æ—¶é—´ã€‚ä½¿ç”¨å‰ç½®é€šçŸ¥å’Œåç½®é€šçŸ¥å®ç°è¯¥åŠŸèƒ½çš„å”¯ä¸€æ–¹å¼æ˜¯åœ¨å‰ç½®é€šçŸ¥ä¸­è®°å½•å¼€å§‹æ—¶é—´å¹¶åœ¨æŸä¸ªåç½®é€šçŸ¥ä¸­æŠ¥å‘Šè¡¨æ¼”è€—è´¹çš„æ—¶é—´ã€‚ä½†è¿™æ ·çš„è¯æˆ‘ä»¬å¿…é¡»åœ¨ä¸€ä¸ªæˆå‘˜å˜é‡ä¸­ä¿å­˜å¼€å§‹æ—¶é—´ã€‚å› ä¸º Audience æ˜¯å•ä¾‹çš„ï¼Œå¦‚æœåƒè¿™æ ·ä¿å­˜çŠ¶æ€çš„è¯ï¼Œå°†ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<p>ç›¸å¯¹äºå‰ç½®é€šçŸ¥å’Œåç½®é€šçŸ¥ï¼Œç¯ç»•é€šçŸ¥åœ¨è¿™ç‚¹ä¸Šæœ‰æ˜æ˜¾çš„ä¼˜åŠ¿ã€‚ä½¿ç”¨ç¯ç»•é€šçŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥å®Œæˆå‰ç½®é€šçŸ¥å’Œåç½®é€šçŸ¥æ‰€å®ç°çš„ç›¸åŒåŠŸèƒ½ï¼Œè€Œä¸”åªéœ€è¦åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å®ç°ã€‚å› ä¸ºæ•´ä¸ªé€šçŸ¥é€»è¾‘æ˜¯åœ¨ä¸€ä¸ªæ–¹æ³•å†…å®ç°çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨æˆå‘˜å˜é‡ä¿å­˜çŠ¶æ€ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘ç¨‹åºæ¸…å• 4.11 ä¸­æ–° Audience ç±»çš„ watchPerformance() æ–¹æ³•ï¼Œå®ƒæ²¡æœ‰ä½¿ç”¨ä»»ä½•çš„æ³¨è§£ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.11 watchPerformance() æ–¹æ³•ï¼Œå®ƒæ²¡æœ‰ä½¿ç”¨ä»»ä½•çš„æ³¨è§£ã€‚</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> concert;<span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Audience</span> </span>&#123;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wathcPerformance</span><span class="params">(ProceedingJoinPoint jp)</span> </span>&#123;        <span class="keyword">try</span> &#123;            System.out.println(<span class="string">&quot;Silencing cell phone&quot;</span>);            System.out.println(<span class="string">&quot;Taking seats&quot;</span>);            jp.proceed();            System.out.println(<span class="string">&quot;Clap Clap Clap&quot;</span>);        &#125; <span class="keyword">catch</span>(Throwable e) &#123;            System.out.println(<span class="string">&quot;Demanding a refund&quot;</span>);        &#125;    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è§‚ä¼—åˆ‡é¢ä¸­ï¼ŒwatchPerformance() æ–¹æ³•åŒ…å«äº†ä¹‹å‰å››ä¸ªé€šçŸ¥æ–¹æ³•çš„æ‰€æœ‰åŠŸèƒ½ã€‚ä¸è¿‡ï¼Œæ‰€æœ‰çš„åŠŸèƒ½éƒ½æ”¾åœ¨äº†è¿™ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œå› æ­¤è¿™ä¸ªæ–¹æ³•è¿˜è¦è´Ÿè´£è‡ªèº«çš„å¼‚å¸¸å¤„ç†ã€‚</p>
<p>å£°æ˜ç¯ç»•é€šçŸ¥ä¸å£°æ˜å…¶ä»–ç±»å‹çš„é€šçŸ¥å¹¶æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„ä»…ä»…æ˜¯ä½¿ç”¨ <code> &lt;aop:around&gt;</code> å…ƒç´ ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.12ã€€åœ¨XMLä¸­ä½¿ç”¨ &lt;aop:around&gt; å…ƒç´ å£°æ˜ç¯ç»•é€šçŸ¥</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span>    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;audience&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;performance&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(** concert.Perforance.perform(..))&quot;</span>/&gt;</span>        <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;watchPerformance&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;performance&quot;</span>/&gt;</span>    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åƒå…¶ä»–é€šçŸ¥çš„ XML å…ƒç´ ä¸€æ ·ï¼Œ<code>&lt;aop:around&gt; </code>æŒ‡å®šäº†ä¸€ä¸ªåˆ‡ç‚¹å’Œä¸€ä¸ªé€šçŸ¥æ–¹æ³•çš„åå­—ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨è·Ÿä¹‹å‰ä¸€æ ·çš„åˆ‡ç‚¹ï¼Œä½†æ˜¯ä¸ºè¯¥åˆ‡ç‚¹æ‰€è®¾ç½®çš„ method å±æ€§å€¼ä¸º watchPerformance() æ–¹æ³•ã€‚</p>
<h4 id="ä¸ºé€šçŸ¥ä¼ é€’å‚æ•°"><a href="#ä¸ºé€šçŸ¥ä¼ é€’å‚æ•°" class="headerlink" title="ä¸ºé€šçŸ¥ä¼ é€’å‚æ•°"></a>ä¸ºé€šçŸ¥ä¼ é€’å‚æ•°</h4><p>åœ¨ 4.3.3 å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ @AspectJ æ³¨è§£åˆ›å»ºäº†ä¸€ä¸ªåˆ‡é¢ï¼Œè¿™ä¸ªåˆ‡é¢èƒ½å¤Ÿè®°å½• CompactDisc ä¸Šæ¯ä¸ªç£é“æ’­æ”¾çš„æ¬¡æ•°ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ XML æ¥é…ç½®åˆ‡é¢ï¼Œé‚£å°±çœ‹ä¸€ä¸‹å¦‚ä½•å®Œæˆè¿™ä¸€ç›¸åŒçš„ä»»åŠ¡ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦ç§»é™¤æ‰ TrackCounter ä¸Šæ‰€æœ‰çš„ @AspectJ æ³¨è§£ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.13ã€€æ— æ³¨è§£çš„ TrackCounter</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> systemsound;<span class="keyword">import</span> java.util.HashMap;<span class="keyword">import</span> java.util.Map;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrackCount</span> </span>&#123;    <span class="keyword">private</span> Map&lt;Integer, Integer&gt; trackCount = <span class="keyword">new</span> HashMap&lt;&gt;();        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">trackPlayed</span><span class="params">(<span class="keyword">int</span> trackNumber)</span> </span>&#123;&#125;        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">countTrack</span><span class="params">(<span class="keyword">int</span> tackNumber)</span> </span>&#123;        <span class="keyword">int</span> currentCount = getPlayCount(trackNumber);        trackCounts.put(trackNumber, currentCount + <span class="number">1</span>);    &#125;        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPlayCount</span><span class="params">(<span class="keyword">int</span> trackNumber)</span> </span>&#123;        <span class="keyword">return</span> trackCounts.containsKey(trackNumber)? trackCounts.get(trackNumber) : <span class="number">0</span>;    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å»æ‰ @AspectJ æ³¨è§£åï¼ŒTrackCounter æ˜¾å¾—æœ‰äº›å•è–„äº†ã€‚ç°åœ¨ï¼Œé™¤éæ˜¾å¼è°ƒç”¨ countTrack() æ–¹æ³•ï¼Œå¦åˆ™ TrackCounter ä¸ä¼šè®°å½•ç£é“æ’­æ”¾çš„æ•°é‡ã€‚ä½†æ˜¯ï¼Œå€ŸåŠ©ä¸€ç‚¹ Spring XML é…ç½®ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè®© TrackCounter é‡æ–°å˜ä¸ºåˆ‡é¢ã€‚</p>
<p>å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å®Œæ•´çš„ Spring é…ç½®ï¼Œåœ¨è¿™ä¸ªé…ç½®ä¸­å£°æ˜äº† TrackCounter bean å’Œ BlankDisc beanï¼Œå¹¶å°† TrackCounter è½¬åŒ–ä¸ºåˆ‡é¢ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.14ã€€åœ¨ XML ä¸­å°† TrackCounter é…ç½®ä¸ºå‚æ•°åŒ–çš„åˆ‡é¢</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;trackCounter&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.TrackCounter&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cd&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.BlankDisc&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Sgt. Pepper&#x27;s Lonely Hearts Club Band&quot;</span>/&gt;</span>    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;artist&quot;</span> <span class="attr">value</span>=<span class="string">&quot;The Beatles&quot;</span>/&gt;</span>    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;tracks&quot;</span>&gt;</span>    	<span class="tag">&lt;<span class="name">list</span>&gt;</span>        	<span class="tag">&lt;<span class="name">value</span>&gt;</span>Sgt. Pepper&#x27;s Lonely Hearts Club Band<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>With a Little Help from My Friends<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Lucy in the Sky with Diamonds<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="comment">&lt;!-- other tracks omitted for brevity...--&gt;</span>        <span class="tag">&lt;/<span class="name">list</span>&gt;</span>    <span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span>	<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;trackCounter&quot;</span>&gt;</span>    	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;trackPlayed&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* soundsystem.Compactisc.playTrack(int)) and args(trackNumber)&quot;</span>/&gt;</span>        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;trackPlayed&quot;</span> <span class="attr">method</span>=<span class="string">&quot;countTrack&quot;</span>/&gt;</span>    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å’Œå‰é¢ç›¸åŒçš„ aop å‘½åç©ºé—´ XML å…ƒç´ ï¼Œå®ƒä»¬ä¼šå°† POJO å£°æ˜ä¸ºåˆ‡é¢ã€‚å”¯ä¸€æ˜æ˜¾çš„å·®åˆ«åœ¨äºåˆ‡ç‚¹è¡¨è¾¾å¼ä¸­åŒ…å«äº†ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°ä¼šä¼ é€’åˆ°é€šçŸ¥æ–¹æ³•ä¸­ã€‚å¦‚æœä½ å°†è¿™ä¸ªè¡¨è¾¾å¼ä¸ç¨‹åºæ¸…å• 4.6 ä¸­çš„è¡¨è¾¾å¼è¿›è¡Œå¯¹æ¯”ä¼šå‘ç°å®ƒä»¬å‡ ä¹æ˜¯ç›¸åŒçš„ã€‚å”¯ä¸€çš„å·®åˆ«åœ¨äºè¿™é‡Œä½¿ç”¨ and å…³é”®å­—è€Œä¸æ˜¯ â€œ&amp;&amp;â€ï¼ˆå› ä¸ºåœ¨ XML ä¸­ï¼Œâ€œ&amp;â€ ç¬¦å·ä¼šè¢«è§£æä¸ºå®ä½“çš„å¼€å§‹ï¼‰ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡ç»ƒä¹ å·²ç»ä½¿ç”¨ Spring çš„ aop å‘½åç©ºé—´å£°æ˜äº†å‡ ä¸ªåŸºæœ¬çš„åˆ‡é¢ï¼Œé‚£ä¹ˆç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ aop å‘½åç©ºé—´å£°æ˜å¼•å…¥åˆ‡é¢ã€‚</p>
<h4 id="é€šè¿‡åˆ‡é¢å¼•å…¥æ–°åŠŸèƒ½"><a href="#é€šè¿‡åˆ‡é¢å¼•å…¥æ–°åŠŸèƒ½" class="headerlink" title="é€šè¿‡åˆ‡é¢å¼•å…¥æ–°åŠŸèƒ½"></a>é€šè¿‡åˆ‡é¢å¼•å…¥æ–°åŠŸèƒ½</h4><p>åœ¨å‰é¢çš„ 4.3.4 å°èŠ‚ä¸­ï¼Œæˆ‘å‘ä½ å±•ç°äº†å¦‚ä½•å€ŸåŠ© AspectJ çš„ @DeclareParents æ³¨è§£ä¸ºè¢«é€šçŸ¥çš„æ–¹æ³•ç¥å¥‡åœ°å¼•å…¥æ–°çš„æ–¹æ³•ã€‚ä½†æ˜¯<br>AOP å¼•å…¥å¹¶ä¸æ˜¯ AspectJ ç‰¹æœ‰çš„ã€‚ä½¿ç”¨ Spring aop å‘½åç©ºé—´ä¸­çš„ <code>&lt;aop:declare-parents&gt;</code> å…ƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚</p>
<p>å¦‚ä¸‹çš„ XML ä»£ç ç‰‡æ®µä¸ä¹‹å‰åŸºäº AspectJ çš„å¼•å…¥åŠŸèƒ½æ˜¯ç›¸åŒï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span>&gt;</span>	<span class="tag">&lt;<span class="name">aop:declare-parents</span> <span class="attr">types-matching</span>=<span class="string">&quot;concert.Performance+&quot;</span> <span class="attr">implent-interface</span>=<span class="string">&quot;concert.Encoreable&quot;</span> <span class="attr">default-impl</span>=<span class="string">&quot;concort.DefaultEncoreable&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¡¾åæ€ä¹‰ï¼Œ<code>&lt;aop:declare-parents&gt;</code> å£°æ˜äº†æ­¤åˆ‡é¢æ‰€é€šçŸ¥çš„ bean è¦åœ¨å®ƒçš„å¯¹è±¡å±‚æ¬¡ç»“æ„ä¸­æ‹¥æœ‰æ–°çš„çˆ¶ç±»å‹ã€‚å…·ä½“åˆ°æœ¬ä¾‹ä¸­ï¼Œç±»å‹åŒ¹é… Performance æ¥å£ï¼ˆç”± types-matching å±æ€§æŒ‡å®šï¼‰çš„é‚£äº› bean åœ¨çˆ¶ç±»ç»“æ„ä¸­ä¼šå¢åŠ  Encoreable æ¥å£ï¼ˆç”± implementinterface å±æ€§æŒ‡å®šï¼‰ã€‚æœ€åè¦è§£å†³çš„é—®é¢˜æ˜¯ Encoreable æ¥å£ä¸­çš„æ–¹æ³•å®ç°è¦æ¥è‡ªäºä½•å¤„ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼æ ‡è¯†æ‰€å¼•å…¥æ¥å£çš„å®ç°ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ default-impl å±æ€§ç”¨å…¨é™å®šç±»åæ¥æ˜¾å¼æŒ‡å®š Encoreable çš„å®ç°ã€‚æˆ–è€…ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ delegate-ref å±æ€§æ¥æ ‡è¯†ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span>&gt;</span>	<span class="tag">&lt;<span class="name">aop:declare-parents</span> <span class="attr">types-matching</span>=<span class="string">&quot;concert.Performance+&quot;</span> <span class="attr">implent-interface</span>=<span class="string">&quot;concert.Encoreable&quot;</span> <span class="attr">delegate-ref</span>=<span class="string">&quot;encoreableDelegate&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>delegate-ref å±æ€§å¼•ç”¨äº†ä¸€ä¸ª Spring bean ä½œä¸ºå¼•å…¥çš„å§”æ‰˜ã€‚è¿™éœ€è¦åœ¨ Spring ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨ä¸€ä¸ª ID ä¸º encoreableDelegate çš„ beanã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;encoreableDelegate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;concert.DefaultEncoreable&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ default-impl æ¥ç›´æ¥æ ‡è¯†å§”æ‰˜å’Œé—´æ¥ä½¿ç”¨ delegate-ref çš„åŒºåˆ«åœ¨äºåè€…æ˜¯ Spring beanï¼Œå®ƒæœ¬èº«å¯ä»¥è¢«æ³¨å…¥ã€é€šçŸ¥æˆ–ä½¿ç”¨å…¶ä»–çš„ Spring é…ç½®ã€‚</p>
<h3 id="æ³¨å…¥-AspectJ-åˆ‡é¢"><a href="#æ³¨å…¥-AspectJ-åˆ‡é¢" class="headerlink" title="æ³¨å…¥ AspectJ åˆ‡é¢"></a>æ³¨å…¥ AspectJ åˆ‡é¢</h3><p>è™½ç„¶ Spring AOP èƒ½å¤Ÿæ»¡è¶³è®¸å¤šåº”ç”¨çš„åˆ‡é¢éœ€æ±‚ï¼Œä½†æ˜¯ä¸ AspectJ ç›¸æ¯”ï¼ŒSpring AOP æ˜¯ä¸€ä¸ªåŠŸèƒ½æ¯”è¾ƒå¼±çš„ AOP è§£å†³æ–¹æ¡ˆã€‚  AspectJ æä¾›äº†Spring AOP æ‰€ä¸èƒ½æ”¯æŒçš„è®¸å¤šç±»å‹çš„åˆ‡ç‚¹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬éœ€è¦åœ¨åˆ›å»ºå¯¹è±¡æ—¶åº”ç”¨é€šçŸ¥ï¼Œæ„é€ å™¨åˆ‡ç‚¹å°±éå¸¸æ–¹ä¾¿ã€‚ä¸åƒæŸäº›å…¶ä»–é¢å‘å¯¹è±¡è¯­è¨€ä¸­çš„æ„é€ å™¨ï¼ŒJava æ„é€ å™¨ä¸åŒäºå…¶ä»–çš„æ­£å¸¸æ–¹æ³•ã€‚è¿™ä½¿å¾— Spring åŸºäºä»£ç†çš„ AOP æ— æ³•æŠŠé€šçŸ¥åº”ç”¨äºå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ã€‚</p>
<p>å¯¹äºå¤§éƒ¨åˆ†åŠŸèƒ½æ¥è®²ï¼ŒAspectJ åˆ‡é¢ä¸ Spring æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚è™½ç„¶å®ƒä»¬å¯ä»¥ç»‡å…¥åˆ°ä»»æ„çš„ Java åº”ç”¨ä¸­ï¼Œè¿™ä¹ŸåŒ…æ‹¬äº† Spring åº”ç”¨ï¼Œä½†æ˜¯åœ¨åº”ç”¨ AspectJ åˆ‡é¢æ—¶å‡ ä¹ä¸ä¼šæ¶‰åŠåˆ° Springã€‚</p>
<p>ä½†æ˜¯ç²¾å¿ƒè®¾è®¡ä¸”æœ‰æ„ä¹‰çš„åˆ‡é¢å¾ˆå¯èƒ½ä¾èµ–å…¶ä»–ç±»æ¥å®Œæˆå®ƒä»¬çš„å·¥ä½œã€‚å¦‚æœåœ¨æ‰§è¡Œé€šçŸ¥æ—¶ï¼Œåˆ‡é¢ä¾èµ–äºä¸€ä¸ªæˆ–å¤šä¸ªç±»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ‡é¢å†…éƒ¨å®ä¾‹åŒ–è¿™äº›åä½œçš„å¯¹è±¡ã€‚ä½†æ›´å¥½çš„æ–¹å¼æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© Spring çš„ä¾èµ–æ³¨å…¥æŠŠ bean è£…é…è¿› AspectJ åˆ‡é¢ä¸­ã€‚</p>
<p>ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬ä¸ºä¸Šé¢çš„æ¼”å‡ºåˆ›å»ºä¸€ä¸ªæ–°åˆ‡é¢ã€‚å…·ä½“æ¥è®²ï¼Œæˆ‘ä»¬ä»¥åˆ‡é¢çš„æ–¹å¼åˆ›å»ºä¸€ä¸ªè¯„è®ºå‘˜çš„è§’è‰²ï¼Œä»–ä¼šè§‚çœ‹æ¼”å‡ºå¹¶ä¸”ä¼šåœ¨æ¼”å‡ºä¹‹åæä¾›ä¸€äº›æ‰¹è¯„æ„è§ã€‚ä¸‹é¢çš„ CriticAspect å°±æ˜¯ä¸€ä¸ªè¿™æ ·çš„åˆ‡é¢ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.15ã€€ä½¿ç”¨ AspectJ å®ç°è¡¨æ¼”çš„è¯„è®ºå‘˜</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> concert;<span class="keyword">public</span> aspect CriticAspect &#123;    <span class="function"><span class="keyword">public</span> <span class="title">CriticAspect</span><span class="params">()</span></span>;    <span class="function">pointcut <span class="title">performance</span><span class="params">()</span> : <span class="title">execution</span><span class="params">(* perfor(..)</span>)</span>;    afterReturning() : performance() &#123;        System.out.println(criticismEngine.getCriticism());    &#125;    <span class="keyword">private</span> CriticismEngine criticismEngine;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCriticismEngine</span><span class="params">(CriticismEngine criticismEngine)</span> </span>&#123;        <span class="keyword">this</span>.criticismEngine = criticismEngine;    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>CriticAspect çš„ä¸»è¦èŒè´£æ˜¯åœ¨è¡¨æ¼”ç»“æŸåä¸ºè¡¨æ¼”å‘è¡¨è¯„è®ºã€‚ç¨‹åºæ¸…å• 4.15 ä¸­çš„ performance() åˆ‡ç‚¹åŒ¹é… perform() æ–¹æ³•ã€‚å½“å®ƒä¸ afterReturning() é€šçŸ¥ä¸€èµ·é…åˆä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®©è¯¥åˆ‡é¢åœ¨è¡¨æ¼”ç»“æŸæ—¶èµ·ä½œç”¨ã€‚</p>
<p>ç¨‹åºæ¸…å• 4.15 æœ‰è¶£çš„åœ°æ–¹åœ¨äºå¹¶ä¸æ˜¯è¯„è®ºå‘˜è‡ªå·±å‘è¡¨è¯„è®ºï¼Œå®é™…ä¸Šï¼ŒCriticAspect ä¸ä¸€ä¸ª CriticismEngine å¯¹è±¡ç›¸åä½œï¼Œåœ¨è¡¨æ¼”ç»“æŸæ—¶ï¼Œè°ƒç”¨è¯¥å¯¹è±¡çš„ getCriticism() æ–¹æ³•æ¥å‘è¡¨ä¸€ä¸ªè‹›åˆ»çš„è¯„è®ºã€‚ä¸ºäº†é¿å… CriticAspect å’Œ CriticismEngine ä¹‹é—´äº§ç”Ÿä¸å¿…è¦çš„è€¦åˆï¼Œæˆ‘ä»¬é€šè¿‡ Setter ä¾èµ–æ³¨å…¥ä¸º CriticAspect è®¾ç½® CriticismEngineã€‚å›¾ 4.9 å±•ç¤ºäº†æ­¤å…³ç³»ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211028193858055.png" alt="image-20211028193858055"></p>
<center>å›¾ 4.9ã€€åˆ‡é¢ä¹Ÿéœ€è¦æ³¨å…¥ã€‚åƒå…¶ä»–çš„ beanä¸€æ ·ï¼ŒSpring å¯ä»¥ä¸º AspectJ åˆ‡é¢æ³¨å…¥ä¾èµ–</center>

<p>CriticismEngine è‡ªèº«æ˜¯å£°æ˜äº†ä¸€ä¸ªç®€å• getCriticism() æ–¹æ³•çš„æ¥å£ã€‚ç¨‹åºæ¸…å• 4.16 ä¸ºCriticismEngine çš„å®ç°ã€‚</p>
<center>ç¨‹åºæ¸…å• 4.16ã€€è¦æ³¨å…¥åˆ° CriticAspect ä¸­çš„ CriticismEngine å®ç°</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springinaction.springidol;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CriticismEngineImpl</span> <span class="keyword">implements</span> <span class="title">CriticismEngine</span> </span>&#123;    <span class="function"><span class="keyword">public</span> <span class="title">CriticismEngineImpl</span><span class="params">()</span> </span>&#123;&#125;        <span class="function"><span class="keyword">public</span> String <span class="title">getCriticism</span><span class="params">()</span> </span>&#123;         <span class="keyword">int</span> i = (<span class="keyword">int</span>) (Math.random() * critismPool.length);        <span class="keyword">return</span> criticismPool[i];    &#125;        <span class="comment">// injected    private String[] criticismPool;    public void setCriticismPool(String[] criticismPool) &#123;        this.criticismPool = criticismPool;    &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>CriticismEngineImpl å®ç°äº†CriticismEngine æ¥å£ï¼Œé€šè¿‡ä»æ³¨å…¥çš„è¯„è®ºæ± ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªè‹›åˆ»çš„è¯„è®ºã€‚è¿™ä¸ªç±»å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„ XML å£°æ˜ä¸ºä¸€ä¸ª Spring beanã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;criticismEngine&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.springinaction.springidol.CriticismEngineImpl&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;criticisms&quot;</span>&gt;</span>    	<span class="tag">&lt;<span class="name">list</span>&gt;</span>        	<span class="tag">&lt;<span class="name">value</span>&gt;</span>Worst performance ever!<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>I laughed, I cried, then I realized I was at the wrong show.<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>a must see show.<span class="tag">&lt;/<span class="name">value</span>&gt;</span>        <span class="tag">&lt;/<span class="name">list</span>&gt;</span>    <span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡é¡ºåˆ©ã€‚æˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªè¦èµ‹äºˆ CriticAspect çš„ CriticismEngine å®ç°ã€‚å‰©ä¸‹çš„å°±æ˜¯ä¸º CriticAspect è£…<br>é… CriticismEngineImpleã€‚</p>
<p>åœ¨å±•ç¤ºå¦‚ä½•å®ç°æ³¨å…¥ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»æ¸…æ¥š AspectJ åˆ‡é¢æ ¹æœ¬ä¸éœ€è¦ Spring å°±å¯ä»¥ç»‡å…¥åˆ°æˆ‘ä»¬çš„åº”ç”¨ä¸­ã€‚å¦‚æœæƒ³ä½¿ç”¨ Spring çš„ä¾èµ–æ³¨å…¥ä¸º AspectJ åˆ‡é¢æ³¨å…¥åä½œè€…ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦åœ¨ Spring é…ç½®ä¸­æŠŠåˆ‡é¢å£°æ˜ä¸ºä¸€ä¸ª Spring é…ç½®ä¸­çš„ <code>&lt;bean&gt;</code>ã€‚å¦‚ä¸‹çš„ <code>&lt;bean&gt;</code> å£°æ˜ä¼šæŠŠ criticismEnginebean æ³¨å…¥åˆ° CriticAspect ä¸­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.springinaction.springidol.CriticAspect&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;aspectOf&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;criticismEngine&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;criticismEngine&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¾ˆå¤§ç¨‹åº¦ä¸Šï¼Œ<code>&lt;bean&gt;</code> çš„å£°æ˜ä¸æˆ‘ä»¬åœ¨ Spring ä¸­æ‰€çœ‹åˆ°çš„å…¶ä»– <code>&lt;bean&gt;</code> é…ç½®å¹¶æ²¡æœ‰å¤ªå¤šçš„åŒºåˆ«ï¼Œä½†æ˜¯æœ€å¤§çš„ä¸åŒåœ¨äºä½¿ç”¨äº† factorymethod å±æ€§ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒSpring bean ç”± Spring å®¹å™¨åˆå§‹åŒ–ï¼Œä½†æ˜¯ AspectJ åˆ‡é¢æ˜¯ç”± AspectJ åœ¨è¿è¡ŒæœŸåˆ›å»ºçš„ã€‚ç­‰åˆ° Spring æœ‰æœºä¼šä¸º CriticAspect æ³¨å…¥ CriticismEngine æ—¶ï¼ŒCriticAspect å·²ç»è¢«å®ä¾‹åŒ–äº†ã€‚</p>
<p>å› ä¸º Spring ä¸èƒ½è´Ÿè´£åˆ›å»º CriticAspectï¼Œé‚£å°±ä¸èƒ½åœ¨ Spring ä¸­ç®€å•åœ°æŠŠ CriticAspect å£°æ˜ä¸ºä¸€ä¸ª beanã€‚ç›¸åï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼ä¸º Spring è·å¾—å·²ç»ç”± AspectJ åˆ›å»ºçš„ CriticAspect å®ä¾‹çš„å¥æŸ„ï¼Œä»è€Œå¯ä»¥æ³¨å…¥ CriticismEngineã€‚å¹¸å¥½ï¼Œæ‰€æœ‰çš„ AspectJ åˆ‡é¢éƒ½æä¾›äº†ä¸€ä¸ªé™æ€çš„ aspectOf() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›åˆ‡é¢çš„ä¸€ä¸ªå•ä¾‹ã€‚æ‰€ä»¥ä¸ºäº†è·å¾—åˆ‡é¢çš„å®ä¾‹ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ factory-method æ¥è°ƒç”¨ asepctOf() æ–¹æ³•è€Œä¸æ˜¯è°ƒç”¨ CriticAspect çš„æ„é€ å™¨æ–¹æ³•ã€‚</p>
<p>ç®€è€Œè¨€ä¹‹ï¼ŒSpring ä¸èƒ½åƒä¹‹å‰é‚£æ ·ä½¿ç”¨ <code>&lt;bean&gt;</code> å£°æ˜æ¥åˆ›å»ºä¸€ä¸ª CriticAspect å®ä¾‹â€”â€”å®ƒå·²ç»åœ¨è¿è¡Œæ—¶ç”± AspectJ åˆ›å»ºå®Œæˆäº†ã€‚Spring éœ€è¦é€šè¿‡ aspectOf() å·¥å‚æ–¹æ³•è·å¾—åˆ‡é¢çš„å¼•ç”¨ï¼Œç„¶ååƒ <code>&lt;bean&gt;</code> å…ƒç´ è§„å®šçš„é‚£æ ·åœ¨è¯¥å¯¹è±¡ä¸Šæ‰§è¡Œä¾èµ–æ³¨å…¥ã€‚</p>
<h3 id="å°ç»“-3"><a href="#å°ç»“-3" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>AOP æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ä¸ªå¼ºå¤§è¡¥å……ã€‚é€šè¿‡ AspectJï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æŠŠä¹‹å‰åˆ†æ•£åœ¨åº”ç”¨å„å¤„çš„è¡Œä¸ºæ”¾å…¥å¯é‡ç”¨çš„æ¨¡å—ä¸­ã€‚æˆ‘ä»¬æ˜¾ç¤ºåœ°å£°æ˜åœ¨ä½•å¤„å¦‚ä½•åº”ç”¨è¯¥è¡Œä¸ºã€‚è¿™æœ‰æ•ˆå‡å°‘äº†ä»£ç å†—ä½™ï¼Œå¹¶è®©æˆ‘ä»¬çš„ç±»å…³æ³¨è‡ªèº«çš„ä¸»è¦åŠŸèƒ½ã€‚</p>
<p>Spring æä¾›äº†ä¸€ä¸ª AOP æ¡†æ¶ï¼Œè®©æˆ‘ä»¬æŠŠåˆ‡é¢æ’å…¥åˆ°æ–¹æ³•æ‰§è¡Œçš„å‘¨å›´ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»å­¦ä¼šå¦‚ä½•æŠŠé€šçŸ¥ç»‡å…¥å‰ç½®ã€åç½®å’Œç¯ç»•æ–¹æ³•çš„è°ƒç”¨ä¸­ï¼Œä»¥åŠä¸ºå¤„ç†å¼‚å¸¸å¢åŠ è‡ªå®šä¹‰çš„è¡Œä¸ºã€‚</p>
<p>å…³äºåœ¨ Spring åº”ç”¨ä¸­å¦‚ä½•ä½¿ç”¨åˆ‡é¢ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰å¤šç§é€‰æ‹©ã€‚é€šè¿‡ä½¿ç”¨ @AspectJ æ³¨è§£å’Œç®€åŒ–çš„é…ç½®å‘½åç©ºé—´ï¼Œåœ¨ Spring ä¸­è£…é…é€šçŸ¥å’Œåˆ‡ç‚¹å˜å¾—éå¸¸ç®€å•ã€‚</p>
<p>æœ€åï¼Œå½“ Spring AOP ä¸èƒ½æ»¡è¶³éœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è½¬å‘æ›´ä¸ºå¼ºå¤§çš„ AspectJã€‚å¯¹äºè¿™äº›åœºæ™¯ï¼Œæˆ‘ä»¬äº†è§£äº†å¦‚ä½•ä½¿ç”¨ Spring ä¸º AspectJ åˆ‡é¢æ³¨å…¥ä¾èµ–ã€‚</p>
<p>æ­¤æ—¶æ­¤åˆ»ï¼Œæˆ‘ä»¬å·²ç»è¦†ç›–äº† Spring æ¡†æ¶çš„åŸºç¡€çŸ¥è¯†ï¼Œäº†è§£åˆ°å¦‚ä½•é…ç½® Spring å®¹å™¨ä»¥åŠå¦‚ä½•ä¸º Spring ç®¡ç†çš„å¯¹è±¡åº”ç”¨åˆ‡é¢ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œè¿™äº›æ ¸å¿ƒæŠ€æœ¯ä¸ºåˆ›å»ºæ¾æ•£è€¦åˆçš„åº”ç”¨å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬è¶Šè¿‡è¿™äº›åŸºç¡€çš„å†…å®¹ï¼Œçœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ Spring æ„å»ºçœŸå®çš„åº”ç”¨ã€‚ä»ä¸‹ä¸€ç« å¼€å§‹ï¼Œé¦–å…ˆçœ‹åˆ°çš„æ˜¯å¦‚ä½•ä½¿ç”¨ Spring æ„å»º Web åº”ç”¨ã€‚</p>
<h1 id="Web-ä¸­çš„-Spring"><a href="#Web-ä¸­çš„-Spring" class="headerlink" title="Web ä¸­çš„ Spring"></a>Web ä¸­çš„ Spring</h1><p>Spring é€šå¸¸ç”¨æ¥å¼€å‘Webåº”ç”¨ã€‚å› æ­¤ï¼Œåœ¨ç¬¬ 2 éƒ¨åˆ†ä¸­ï¼Œå°†ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨ Spring çš„ MVC æ¡†æ¶ä¸ºåº”ç”¨ç¨‹åºæ·»åŠ Webå‰ç«¯ã€‚</p>
<p>åœ¨ç¬¬ 5 ç«  â€œæ„å»º Spring Web åº”ç”¨â€ ä¸­ï¼Œä½ å°†ä¼šå­¦ä¹ åˆ° Spring MVC çš„åŸºæœ¬ç”¨æ³•ï¼Œå®ƒæ˜¯æ„å»ºåœ¨ Spring ç†å¿µä¹‹ä¸Šçš„ä¸€ä¸ª Web æ¡†æ¶ã€‚æˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•ç¼–å†™å¤„ç† Web è¯·æ±‚çš„æ§åˆ¶å™¨ä»¥åŠå¦‚ä½•é€æ˜åœ°ç»‘å®šè¯·æ±‚å‚æ•°å’Œè´Ÿè½½åˆ°ä¸šåŠ¡å¯¹è±¡ä¸Šï¼ŒåŒæ—¶å®ƒè¿˜æä¾›äº†æ•°æ®æ£€éªŒå’Œé”™è¯¯å¤„ç†çš„åŠŸèƒ½ã€‚</p>
<p>åœ¨ç¬¬ 6 ç«  â€œæ¸²æŸ“ Web è§†å›¾â€ ä¸­ï¼Œå°†ä¼šåŸºäºç¬¬ 5 ç« çš„å†…å®¹ç»§ç»­è®²è§£ï¼Œå±•ç°äº†å¦‚ä½•å¾—åˆ° Spring MVC æ§åˆ¶å™¨æ‰€ç”Ÿæˆçš„æ¨¡å‹æ•°æ®ï¼Œå¹¶å°†å…¶æ¸²æŸ“ä¸ºç”¨æˆ·æµè§ˆå™¨ä¸­çš„ HTMLã€‚è¿™ä¸€ç« çš„è®¨è®ºåŒ…æ‹¬ JavaServer Pagesï¼ˆJSPï¼‰ã€Apache Tiles å’Œ Thymeleaf æ¨¡æ¿ã€‚</p>
<p>åœ¨ç¬¬ 7 ç«  â€œSpring MVC çš„é«˜çº§æŠ€æœ¯â€ ä¸­ï¼Œå°†ä¼šå­¦ä¹ åˆ°æ„å»º Web åº”ç”¨æ—¶çš„ä¸€äº›é«˜çº§æŠ€æœ¯ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰ Spring MVC é…ç½®ã€å¤„ç† multipart æ–‡ä»¶ä¸Šä¼ ã€å¤„ç†å¼‚å¸¸ä»¥åŠä½¿ç”¨ flash å±æ€§è·¨è¯·æ±‚ä¼ é€’æ•°æ®ã€‚</p>
<p>ç¬¬ 8 ç« ï¼Œâ€œä½¿ç”¨ Spring Web Flowâ€ å°†ä¼šä¸ºä½ å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Spring Web Flowæ¥æ„å»ºä¼šè¯å¼ã€åŸºäºæµç¨‹çš„ Web åº”ç”¨ç¨‹åºã€‚</p>
<p>é‰´äºå®‰å…¨æ˜¯å¾ˆå¤šåº”ç”¨ç¨‹åºçš„é‡è¦å…³æ³¨ç‚¹ï¼Œå› æ­¤ç¬¬ 9 ç«  â€œä¿æŠ¤ Web åº”ç”¨â€å°†ä¼šä¸ºä½ ä»‹ç»å¦‚ä½•ä½¿ç”¨ Spring Security æ¥ä¸º Web åº”ç”¨ç¨‹åºæä¾›å®‰å…¨æ€§ï¼Œä¿æŠ¤åº”ç”¨ä¸­çš„ä¿¡æ¯ã€‚</p>
<h2 id="æ„å»º-Spring-Web-åº”ç”¨ç¨‹åº"><a href="#æ„å»º-Spring-Web-åº”ç”¨ç¨‹åº" class="headerlink" title="æ„å»º Spring Web åº”ç”¨ç¨‹åº"></a>æ„å»º Spring Web åº”ç”¨ç¨‹åº</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>æ˜ å°„è¯·æ±‚åˆ° Spring æ§åˆ¶å™¨</li>
<li>é€æ˜åœ°ç»‘å®šè¡¨å•å‚æ•°</li>
<li>æ ¡éªŒè¡¨å•æäº¤</li>
</ul>
<p>ä½œä¸ºä¼ä¸šçº§ Java å¼€å‘è€…ï¼Œä½ å¯èƒ½å¼€å‘è¿‡ä¸€äº›åŸºäº Web çš„åº”ç”¨ç¨‹åºã€‚å¯¹äºå¾ˆå¤š Java å¼€å‘äººå‘˜æ¥è¯´ï¼ŒåŸºäº Web çš„åº”ç”¨ç¨‹åºæ˜¯ä»–ä»¬ä¸»è¦çš„å…³æ³¨ç‚¹ã€‚å¦‚æœä½ æœ‰è¿™æ–¹é¢ç»éªŒçš„è¯ï¼Œä½ ä¼šæ„è¯†åˆ°è¿™ç§ç³»ç»Ÿæ‰€é¢ä¸´çš„æŒ‘æˆ˜ã€‚å…·ä½“æ¥è®²ï¼ŒçŠ¶æ€ç®¡ç†ã€å·¥ä½œæµä»¥åŠéªŒè¯éƒ½æ˜¯éœ€è¦è§£å†³çš„é‡è¦ç‰¹æ€§ã€‚HTTP åè®®çš„æ— çŠ¶æ€æ€§å†³å®šäº†è¿™äº›é—®é¢˜éƒ½ä¸é‚£ä¹ˆå®¹æ˜“è§£å†³ã€‚</p>
<p>Spring çš„ Web æ¡†æ¶å°±æ˜¯ä¸ºäº†å¸®ä½ è§£å†³è¿™äº›å…³æ³¨ç‚¹è€Œè®¾è®¡çš„ã€‚SpringMVC åŸºäºæ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆModel-View-Controllerï¼ŒMVCï¼‰æ¨¡å¼å®ç°ï¼Œå®ƒèƒ½å¤Ÿå¸®ä½ æ„å»ºåƒ Spring æ¡†æ¶é‚£æ ·çµæ´»å’Œæ¾è€¦åˆçš„ Web åº”ç”¨ç¨‹åºã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šä»‹ç» Spring MVC Web æ¡†æ¶ï¼Œå¹¶ä½¿ç”¨æ–°çš„ SpringMVC æ³¨è§£æ¥æ„å»ºå¤„ç†å„ç§ Web è¯·æ±‚ã€å‚æ•°å’Œè¡¨å•è¾“å…¥çš„æ§åˆ¶å™¨ã€‚åœ¨æ·±å…¥ä»‹ç» Spring MVC ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆæ€»ä½“ä¸Šä»‹ç»ä¸€ä¸‹ Spring MVCï¼Œå¹¶å»ºç«‹èµ· Spring MVC è¿è¡Œçš„åŸºæœ¬é…ç½®ã€‚</p>
<h3 id="Spring-MVC-èµ·æ­¥"><a href="#Spring-MVC-èµ·æ­¥" class="headerlink" title="Spring  MVC  èµ·æ­¥"></a>Spring  MVC  èµ·æ­¥</h3><p>ä½ è§åˆ°è¿‡å­©å­ä»¬çš„æ•é¼ å™¨æ¸¸æˆå—ï¼Ÿè¿™çœŸæ˜¯ä¸€ä¸ªç–¯ç‹‚çš„æ¸¸æˆï¼Œå®ƒçš„ç›®æ ‡æ˜¯å‘é€ä¸€ä¸ªå°é’¢çƒï¼Œè®©å®ƒç»è¿‡ä¸€ç³»åˆ—ç¨€å¥‡å¤æ€ªçš„è£…ç½®ï¼Œæœ€åè§¦å‘æ•é¼ å™¨ã€‚å°é’¢çƒç©¿è¿‡å„ç§å¤æ‚çš„é…ä»¶ï¼Œä»ä¸€ä¸ªæ–œå¡ä¸Šæ»šä¸‹æ¥ï¼Œè¢«è··è··æ¿å¼¹èµ·ï¼Œç»•è¿‡ä¸€ä¸ªå¾®å‹æ‘©å¤©è½®ï¼Œç„¶åè¢«æ©¡èƒ¶é´ä»æ¡¶ä¸­è¸¢å‡ºå»ã€‚ç»è¿‡è¿™äº›åï¼Œå°é’¢çƒä¼šå¯¹é‚£åªå¯æ€œåˆæ— è¾œçš„æ©¡èƒ¶è€é¼ è¿›è¡Œæ•è·ã€‚</p>
<p>ä¹çœ‹ä¸Šå»ï¼Œä½ ä¼šè®¤ä¸º Spring MVC æ¡†æ¶ä¸æ•é¼ å™¨æœ‰äº›ç±»ä¼¼ã€‚Spring å°†è¯·æ±‚åœ¨è°ƒåº¦ Servletã€å¤„ç†å™¨æ˜ å°„ï¼ˆhandler mappingï¼‰ã€æ§åˆ¶å™¨ä»¥åŠè§†å›¾è§£æå™¨ï¼ˆview resolverï¼‰ä¹‹é—´ç§»åŠ¨ï¼Œè€Œæ•é¼ å™¨ä¸­çš„é’¢çƒåˆ™ä¼šåœ¨å„ç§æ–œå¡ã€è··è··æ¿ä»¥åŠæ‘©å¤©è½®ä¹‹é—´æ»šåŠ¨ã€‚ä½†æ˜¯ï¼Œä¸è¦å°† Spring MVC ä¸ Rube Goldberg-esque æ•é¼ å™¨æ¸¸æˆåšè¿‡å¤šæ¯”è¾ƒã€‚æ¯ä¸€ä¸ª Spring MVC ä¸­çš„ç»„ä»¶éƒ½æœ‰ç‰¹å®šçš„ç›®çš„ï¼Œå¹¶ä¸”å®ƒä¹Ÿæ²¡æœ‰é‚£ä¹ˆå¤æ‚ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¯·æ±‚æ˜¯å¦‚ä½•ä»å®¢æˆ·ç«¯å‘èµ·ï¼Œç»è¿‡ Spring MVC ä¸­çš„ç»„ä»¶ï¼Œæœ€ç»ˆå†è¿”å›åˆ°å®¢æˆ·ç«¯çš„ã€‚</p>
<h4 id="è·Ÿè¸ª-Spring-MVC-çš„è¯·æ±‚"><a href="#è·Ÿè¸ª-Spring-MVC-çš„è¯·æ±‚" class="headerlink" title="è·Ÿè¸ª Spring MVC çš„è¯·æ±‚"></a>è·Ÿè¸ª Spring MVC çš„è¯·æ±‚</h4><p>æ¯å½“ç”¨æˆ·åœ¨ Web æµè§ˆå™¨ä¸­ç‚¹å‡»é“¾æ¥æˆ–æäº¤è¡¨å•çš„æ—¶å€™ï¼Œè¯·æ±‚å°±å¼€å§‹å·¥ä½œäº†ã€‚å¯¹è¯·æ±‚çš„å·¥ä½œæè¿°å°±åƒæ˜¯å¿«é€’æŠ•é€å‘˜ã€‚ä¸é‚®å±€æŠ•é€’å‘˜æˆ– FedEx æŠ•é€å‘˜ä¸€æ ·ï¼Œè¯·æ±‚ä¼šå°†ä¿¡æ¯ä»ä¸€ä¸ªåœ°æ–¹å¸¦åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚</p>
<p>è¯·æ±‚æ˜¯ä¸€ä¸ªååˆ†ç¹å¿™çš„å®¶ä¼™ã€‚ä»ç¦»å¼€æµè§ˆå™¨å¼€å§‹åˆ°è·å–å“åº”è¿”å›ï¼Œå®ƒä¼šç»å†å¥½å¤šç«™ï¼Œåœ¨æ¯ç«™éƒ½ä¼šç•™ä¸‹ä¸€äº›ä¿¡æ¯åŒæ—¶ä¹Ÿä¼šå¸¦ä¸Šå…¶ä»–ä¿¡æ¯ã€‚å›¾ 5.1 å±•ç¤ºäº†è¯·æ±‚ä½¿ç”¨ Spring MVC æ‰€ç»å†çš„æ‰€æœ‰ç«™ç‚¹ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211021112649999.png"></p>
<center>å›¾ 5.1ã€€ä¸€è·¯ä¸Šè¯·æ±‚ä¼šå°†ä¿¡æ¯å¸¦åˆ°å¾ˆå¤šç«™ç‚¹ï¼Œå¹¶ç”Ÿäº§æœŸæœ›çš„ç»“æœ</center>

<p>åœ¨è¯·æ±‚ç¦»å¼€æµè§ˆå™¨æ—¶ï¼Œä¼šå¸¦æœ‰ç”¨æˆ·æ‰€è¯·æ±‚å†…å®¹çš„ä¿¡æ¯ï¼Œè‡³å°‘ä¼šåŒ…å«è¯·æ±‚çš„ URLã€‚ä½†æ˜¯è¿˜å¯èƒ½å¸¦æœ‰å…¶ä»–çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·æäº¤çš„è¡¨å•ä¿¡æ¯ã€‚</p>
<p>è¯·æ±‚æ—…ç¨‹çš„ç¬¬ä¸€ç«™æ˜¯ Spring çš„ DispatcherServletã€‚ä¸å¤§å¤šæ•°åŸºäº Java çš„ Web æ¡†æ¶ä¸€æ ·ï¼ŒSpring MVC æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šé€šè¿‡ä¸€ä¸ªå‰ç«¯æ§åˆ¶å™¨ï¼ˆfront controllerï¼‰ Servletã€‚å‰ç«¯æ§åˆ¶å™¨æ˜¯å¸¸ç”¨çš„ Web åº”ç”¨ç¨‹åºæ¨¡å¼ï¼Œåœ¨è¿™é‡Œä¸€ä¸ªå•å®ä¾‹çš„ Servlet å°†è¯·æ±‚å§”æ‰˜ç»™åº”ç”¨ç¨‹åºçš„å…¶ä»–ç»„ä»¶æ¥æ‰§è¡Œå®é™…çš„å¤„ç†ã€‚åœ¨ Spring MVC ä¸­ï¼ŒDispatcherServlet å°±æ˜¯å‰ç«¯æ§åˆ¶å™¨ã€‚</p>
<p>DispatcherServlet çš„ä»»åŠ¡æ˜¯å°†è¯·æ±‚å‘é€ç»™ Spring MVC æ§åˆ¶å™¨ï¼ˆcontrollerï¼‰ã€‚æ§åˆ¶å™¨æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†è¯·æ±‚çš„ Spring ç»„ä»¶ã€‚åœ¨å…¸å‹çš„åº”ç”¨ç¨‹åºä¸­å¯èƒ½ä¼šæœ‰å¤šä¸ªæ§åˆ¶å™¨ï¼ŒDispatcherServlet éœ€è¦çŸ¥é“åº”è¯¥å°†è¯·æ±‚å‘é€ç»™å“ªä¸ªæ§åˆ¶å™¨ã€‚æ‰€ä»¥ DispatcherServlet ä»¥ä¼šæŸ¥è¯¢ä¸€ä¸ªæˆ–å¤šä¸ªå¤„ç†å™¨æ˜ å°„ï¼ˆhandler mappingï¼‰ æ¥ç¡®å®šè¯·æ±‚çš„ä¸‹ä¸€ç«™åœ¨å“ªé‡Œã€‚å¤„ç†å™¨æ˜ å°„ä¼šæ ¹æ®è¯·æ±‚æ‰€æºå¸¦çš„ URL ä¿¡æ¯æ¥è¿›è¡Œå†³ç­–ã€‚</p>
<p>ä¸€æ—¦é€‰æ‹©äº†åˆé€‚çš„æ§åˆ¶å™¨ï¼ŒDispatcherServlet ä¼šå°†è¯·æ±‚å‘é€ç»™é€‰ä¸­çš„æ§åˆ¶å™¨ã€‚åˆ°äº†æ§åˆ¶å™¨ï¼Œè¯·æ±‚ä¼šå¸ä¸‹å…¶è´Ÿè½½ï¼ˆç”¨æˆ·æäº¤çš„ä¿¡æ¯ï¼‰å¹¶è€å¿ƒç­‰å¾…æ§åˆ¶å™¨å¤„ç†è¿™äº›ä¿¡æ¯ã€‚ï¼ˆå®é™…ä¸Šï¼Œè®¾è®¡è‰¯å¥½çš„æ§åˆ¶å™¨æœ¬èº«åªå¤„ç†å¾ˆå°‘ç”šè‡³ä¸å¤„ç†å·¥ä½œï¼Œè€Œæ˜¯å°†ä¸šåŠ¡é€»è¾‘å§”æ‰˜ç»™ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å¯¹è±¡è¿›è¡Œå¤„ç†ã€‚ï¼‰</p>
<p>æ§åˆ¶å™¨åœ¨å®Œæˆé€»è¾‘å¤„ç†åï¼Œé€šå¸¸ä¼šäº§ç”Ÿä¸€äº›ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯éœ€è¦è¿”å›ç»™ç”¨æˆ·å¹¶åœ¨æµè§ˆå™¨ä¸Šæ˜¾ç¤ºã€‚è¿™äº›ä¿¡æ¯è¢«ç§°ä¸ºæ¨¡å‹ï¼ˆmodelï¼‰ã€‚ä¸è¿‡ä»…ä»…ç»™ç”¨æˆ·è¿”å›åŸå§‹çš„ä¿¡æ¯æ˜¯ä¸å¤Ÿçš„â€”â€”è¿™äº›ä¿¡æ¯éœ€è¦ä»¥ç”¨æˆ·å‹å¥½çš„æ–¹å¼è¿›è¡Œæ ¼å¼åŒ–ï¼Œä¸€èˆ¬ä¼šæ˜¯ HTMLã€‚æ‰€ä»¥ï¼Œä¿¡æ¯éœ€è¦å‘é€ç»™ä¸€ä¸ªè§†å›¾ï¼ˆviewï¼‰ï¼Œé€šå¸¸ä¼šæ˜¯ JSPã€‚</p>
<p>æ§åˆ¶å™¨æ‰€åšçš„æœ€åä¸€ä»¶äº‹å°±æ˜¯å°†æ¨¡å‹æ•°æ®æ‰“åŒ…ï¼Œå¹¶ä¸”æ ‡ç¤ºå‡ºç”¨äºæ¸²æŸ“è¾“å‡ºçš„è§†å›¾åã€‚å®ƒæ¥ä¸‹æ¥ä¼šå°†è¯·æ±‚è¿åŒæ¨¡å‹å’Œè§†å›¾åå‘é€å› DispatcherServlet ã€‚</p>
<p>è¿™æ ·ï¼Œæ§åˆ¶å™¨å°±ä¸ä¼šä¸ç‰¹å®šçš„è§†å›¾ç›¸è€¦åˆï¼Œä¼ é€’ç»™ DispatcherServlet çš„è§†å›¾åå¹¶ä¸ç›´æ¥è¡¨ç¤ºæŸä¸ªç‰¹å®šçš„ JSPã€‚å®é™…ä¸Šï¼Œå®ƒç”šè‡³å¹¶ä¸èƒ½ç¡®å®šè§†å›¾å°±æ˜¯ JSPã€‚ç›¸åï¼Œå®ƒä»…ä»…ä¼ é€’äº†ä¸€ä¸ªé€»è¾‘åç§°ï¼Œè¿™ä¸ªåå­—å°†ä¼šç”¨æ¥æŸ¥æ‰¾äº§ç”Ÿç»“æœçš„çœŸæ­£è§†å›¾ã€‚DispatcherServlet å°†ä¼šä½¿ç”¨è§†å›¾è§£æå™¨ï¼ˆview resolverï¼‰æ¥å°†é€»è¾‘è§†å›¾ååŒ¹é…ä¸ºä¸€ä¸ªç‰¹å®šçš„è§†å›¾å®ç°ï¼Œå®ƒå¯èƒ½æ˜¯ä¹Ÿå¯èƒ½ä¸æ˜¯ JSPã€‚</p>
<p>æ—¢ç„¶ DispatcherServlet å·²ç»çŸ¥é“ç”±å“ªä¸ªè§†å›¾æ¸²æŸ“ç»“æœï¼Œé‚£è¯·æ±‚çš„ä»»åŠ¡åŸºæœ¬ä¸Šä¹Ÿå°±å®Œæˆäº†ã€‚å®ƒçš„æœ€åä¸€ç«™æ˜¯è§†å›¾çš„å®ç°ï¼ˆå¯èƒ½æ˜¯ JSPï¼‰ ï¼Œåœ¨è¿™é‡Œå®ƒäº¤ä»˜æ¨¡å‹æ•°æ®ã€‚è¯·æ±‚çš„ä»»åŠ¡å°±å®Œæˆäº†ã€‚è§†å›¾å°†ä½¿ç”¨æ¨¡å‹æ•°æ®æ¸²æŸ“è¾“å‡ºï¼Œè¿™ä¸ªè¾“å‡ºä¼šé€šè¿‡å“åº”å¯¹è±¡ä¼ é€’ç»™å®¢æˆ·ç«¯ï¼ˆä¸ä¼šåƒå¬ä¸Šå»é‚£æ ·ç¡¬ç¼–ç ï¼‰ ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¯·æ±‚è¦ç»è¿‡å¾ˆå¤šçš„æ­¥éª¤ï¼Œæœ€ç»ˆæ‰èƒ½å½¢æˆè¿”å›ç»™å®¢æˆ·ç«¯çš„å“åº”ã€‚å¤§å¤šæ•°çš„æ­¥éª¤éƒ½æ˜¯åœ¨ Spring æ¡†æ¶å†…éƒ¨å®Œæˆçš„ï¼Œä¹Ÿå°±æ˜¯å›¾ 5.1 æ‰€ç¤ºçš„ç»„ä»¶ä¸­ã€‚å°½ç®¡æœ¬ç« çš„ä¸»è¦å†…å®¹éƒ½å…³æ³¨äºå¦‚ä½•ç¼–å†™æ§åˆ¶å™¨ï¼Œä½†åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹å¦‚ä½•æ­å»º Spring MVC çš„åŸºç¡€ç»„ä»¶ã€‚</p>
<h4 id="æ­å»º-Spring-MVC"><a href="#æ­å»º-Spring-MVC" class="headerlink" title="æ­å»º Spring MVC"></a>æ­å»º Spring MVC</h4><p>åŸºäºå›¾ 5.1ï¼Œçœ‹ä¸Šå»æˆ‘ä»¬éœ€è¦é…ç½®å¾ˆå¤šçš„ç»„æˆéƒ¨åˆ†ã€‚å¹¸å¥½ï¼Œå€ŸåŠ©äºæœ€è¿‘å‡ ä¸ª Spring æ–°ç‰ˆæœ¬çš„åŠŸèƒ½å¢å¼ºï¼Œå¼€å§‹ä½¿ç”¨ Spring MVC å˜å¾—éå¸¸ç®€å•äº†ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨æœ€ç®€å•çš„æ–¹å¼æ¥é…ç½® Spring MVCï¼šæ‰€è¦å®ç°çš„åŠŸèƒ½ä»…é™äºè¿è¡Œæˆ‘ä»¬æ‰€åˆ›å»ºçš„æ§åˆ¶å™¨ã€‚åœ¨ç¬¬ 7 ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹ä¸€äº›å…¶ä»–çš„é…ç½®é€‰é¡¹ã€‚</p>
<p>é…ç½® DispatcherServlet</p>
<p>DispatcherServlet æ˜¯ Spring MVC çš„æ ¸å¿ƒã€‚åœ¨è¿™é‡Œè¯·æ±‚ä¼šç¬¬ä¸€æ¬¡æ¥è§¦åˆ°æ¡†æ¶ï¼Œå®ƒè¦è´Ÿè´£å°†è¯·æ±‚è·¯ç”±åˆ°å…¶ä»–çš„ç»„ä»¶ä¹‹ä¸­ã€‚</p>
<p>æŒ‰ç…§ä¼ ç»Ÿçš„æ–¹å¼ï¼Œåƒ DispatcherServlet è¿™æ ·çš„ Servlet ä¼šé…ç½®åœ¨ web.xml æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šæ”¾åˆ°åº”ç”¨çš„ WAR åŒ…é‡Œé¢ã€‚å½“ç„¶ï¼Œè¿™æ˜¯é…ç½® DispatcherServlet çš„æ–¹æ³•ä¹‹ä¸€ã€‚ä½†æ˜¯ï¼Œå€ŸåŠ©äº Servlet 3 è§„èŒƒå’Œ Spring 3.1 çš„åŠŸèƒ½å¢å¼ºï¼Œè¿™ç§æ–¹å¼å·²ç»ä¸æ˜¯å”¯ä¸€çš„æ–¹æ¡ˆäº†ï¼Œè¿™ä¹Ÿä¸æ˜¯æˆ‘ä»¬æœ¬ç« æ‰€ä½¿ç”¨çš„é…ç½®æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬ä¼šä½¿ç”¨ Java å°† DispatcherServlet é…ç½®åœ¨ Servlet å®¹å™¨ä¸­ï¼Œè€Œä¸ä¼šå†ä½¿ç”¨ web.xml æ–‡ä»¶ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç¤ºäº†æ‰€éœ€çš„ Java ç±»ã€‚</p>
<center>ç¨‹åºæ¸…å• 5.1ã€€é…ç½® DispatcherServlet</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.config;<span class="keyword">import</span> org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;<span class="keyword">import</span> spittr.web.WebConfig;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpitterWebInitializer</span> <span class="keyword">extends</span> <span class="title">AbstractAnnotationConfigDispatcherServletInitializer</span> </span>&#123;    <span class="meta">@Override</span>    <span class="keyword">protected</span> String[] getServletMappings() &#123;        <span class="keyword">return</span> <span class="keyword">new</span> String[] &#123; <span class="string">&quot;/&quot;</span> &#125;;    &#125;    <span class="meta">@Override</span>    <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;        <span class="keyword">return</span> <span class="keyword">new</span> Class&lt;?&gt;[] &#123; RootConfig.class &#125;;    &#125;    <span class="meta">@Override</span>    <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;        <span class="keyword">return</span> <span class="keyword">new</span> Class&lt;?&gt;[] &#123; WebConfig.class &#125;;    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘ä»¬æ·±å…¥ä»‹ç»ç¨‹åºæ¸…å• 5.1 ä¹‹å‰ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“ spittr åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ã€‚è¿™ä¸ªç±»çš„åå­—æ˜¯ <code>SpittrWebAppInitializer</code>ï¼Œå®ƒä½äºåä¸º <code>spittr.config</code> çš„åŒ…ä¸­ã€‚æˆ‘ç¨åä¼šå¯¹å…¶è¿›è¡Œä»‹ç»ï¼ˆåœ¨ 5.1.3 å°èŠ‚ä¸­ï¼‰ï¼Œä½†ç°åœ¨ï¼Œä½ åªéœ€è¦çŸ¥é“æˆ‘ä»¬æ‰€è¦åˆ›å»ºçš„åº”ç”¨åä¸º Spittrã€‚</p>
<p>è¦ç†è§£ç¨‹åºæ¸…å• 5.1 æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæˆ‘ä»¬å¯èƒ½åªéœ€è¦çŸ¥é“æ‰©å±• <code>AbstractAnnotationConfigDispatcherServletInitializer </code>çš„ä»»æ„ç±»éƒ½ä¼šè‡ªåŠ¨åœ°é…ç½® <code>DispatcherServlet</code>å’Œ Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ŒSpring çš„åº”ç”¨ä¸Šä¸‹æ–‡ä¼šä½äºåº”ç”¨ç¨‹åºçš„ Servlet ä¸Šä¸‹æ–‡ä¹‹ä¸­ã€‚</p>
<p><code>AbstractAnnotationConfigDispatcherServletInitializer</code> å‰–æ</p>
<p>å¦‚æœä½ åšæŒè¦äº†è§£æ›´å¤šç»†èŠ‚çš„è¯ï¼Œé‚£å°±çœ‹è¿™é‡Œå§ã€‚åœ¨ Servlet 3.0 ç¯å¢ƒä¸­ï¼Œå®¹å™¨ä¼šåœ¨ç±»è·¯å¾„ä¸­æŸ¥æ‰¾å®ç° <code>javax.servlet.ServletContainerInitializer</code> æ¥å£çš„ç±»ï¼Œå¦‚æœèƒ½å‘ç°çš„è¯ï¼Œå°±ä¼šç”¨å®ƒæ¥é…ç½® Servlet å®¹å™¨ã€‚</p>
<p>Spring æä¾›äº†è¿™ä¸ªæ¥å£çš„å®ç°ï¼Œåä¸º <code>SpringServletContainerInitializer</code>ï¼Œè¿™ä¸ªç±»åè¿‡æ¥åˆä¼šæŸ¥æ‰¾å®ç° <code>WebApplicationInitializer</code> çš„ç±»å¹¶å°†é…ç½®çš„ä»»åŠ¡äº¤ç»™å®ƒä»¬æ¥å®Œæˆã€‚Spring 3.2 å¼•å…¥äº†ä¸€ä¸ªä¾¿åˆ©çš„ <code>WebApplicationInitializer</code> åŸºç¡€å®ç°ï¼Œä¹Ÿå°±æ˜¯ <code>AbstractAnnotationConfigDispatcherServletInitializer</code> ã€‚å› ä¸ºæˆ‘ä»¬çš„ <code>SpittrWebAppInitializer</code> æ‰©å±•äº† <code>AbstractAnnotationConfigDispatcherServletInitializer</code>ï¼ˆåŒæ—¶ä¹Ÿå°±å®ç°äº† <code>WebApplicationInitializer</code>ï¼‰ï¼Œå› æ­¤å½“éƒ¨ç½²åˆ° Servlet 3.0 å®¹å™¨ä¸­çš„æ—¶å€™ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨å‘ç°å®ƒï¼Œå¹¶ç”¨å®ƒæ¥é…ç½® Servlet ä¸Šä¸‹æ–‡ã€‚</p>
<p>å°½ç®¡å®ƒçš„åå­—å¾ˆé•¿ï¼Œä½†æ˜¯ <code>AbstractAnnotationConfigDispatcherServletInitializer</code> ä½¿ç”¨èµ·æ¥å¾ˆç®€ä¾¿ã€‚åœ¨ç¨‹åºæ¸…å• 5.1 ä¸­ï¼ŒSpittrWebAppInitializer é‡å†™äº†ä¸‰ä¸ªæ–¹æ³•ã€‚</p>
<p>ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯ <code>getServletMappings()</code>ï¼Œå®ƒä¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªè·¯å¾„æ˜ å°„åˆ° <code>DispatcherServlet</code> ä¸Šã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒæ˜ å°„çš„æ˜¯ â€œ/â€ï¼Œè¿™è¡¨ç¤ºå®ƒä¼šæ˜¯åº”ç”¨çš„é»˜è®¤ <code>Servlet</code>ã€‚å®ƒä¼šå¤„ç†è¿›å…¥åº”ç”¨çš„æ‰€æœ‰è¯·æ±‚ã€‚</p>
<p>ä¸ºäº†ç†è§£å…¶ä»–çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬é¦–å…ˆè¦ç†è§£ <code>DispatcherServlet</code> å’Œä¸€ä¸ª <code>Servlet</code> ç›‘å¬å™¨ï¼ˆä¹Ÿå°±æ˜¯ <code>ContextLoaderListener</code>ï¼‰çš„å…³ç³»ã€‚</p>
<p>ä¸¤ä¸ªåº”ç”¨ä¸Šä¸‹æ–‡ä¹‹é—´çš„æ•…äº‹</p>
<p>å½“ <code>DispatcherServlet</code> å¯åŠ¨çš„æ—¶å€™ï¼Œå®ƒä¼šåˆ›å»º Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œå¹¶åŠ è½½é…ç½®æ–‡ä»¶æˆ–é…ç½®ç±»ä¸­æ‰€å£°æ˜çš„ beanã€‚åœ¨ç¨‹åºæ¸…å• 5.1 çš„ <code>getServletConfigClasses()</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è¦æ±‚ <code>DispatcherServlet</code> åŠ è½½åº”ç”¨ä¸Šä¸‹æ–‡æ—¶ï¼Œä½¿ç”¨å®šä¹‰åœ¨ <code>WebConfig</code> é…ç½®ç±»ï¼ˆä½¿ç”¨ Java é…ç½®ï¼‰ä¸­çš„ beanã€‚</p>
<p>ä½†æ˜¯åœ¨Spring Webåº”ç”¨ä¸­ï¼Œé€šå¸¸è¿˜ä¼šæœ‰å¦å¤–ä¸€ä¸ªåº”ç”¨ä¸Šä¸‹æ–‡ã€‚å¦å¤–çš„è¿™ä¸ªåº”ç”¨ä¸Šä¸‹æ–‡æ˜¯ç”± <code>ContextLoaderListener</code> åˆ›å»ºçš„ã€‚</p>
<p>æˆ‘ä»¬å¸Œæœ› <code>DispatcherServlet</code> åŠ è½½åŒ…å« Web ç»„ä»¶çš„ beanï¼Œå¦‚æ§åˆ¶å™¨ã€è§†å›¾è§£æå™¨ä»¥åŠå¤„ç†å™¨æ˜ å°„ï¼Œè€Œ <code>ContextLoaderListener</code> è¦åŠ è½½åº”ç”¨ä¸­çš„å…¶ä»– beanã€‚è¿™äº› bean é€šå¸¸æ˜¯é©±åŠ¨åº”ç”¨åç«¯çš„ä¸­é—´å±‚å’Œæ•°æ®å±‚ç»„ä»¶ã€‚</p>
<p>å®é™…ä¸Šï¼Œ<code>AbstractAnnotationConfigDispatcherServletInitializer</code> ä¼šåŒæ—¶åˆ›å»º <code>DispatcherServlet</code> å’Œ <code>ContextLoaderListener</code>ã€‚<code>GetServletConfigClasses()</code> æ–¹æ³•è¿”å›çš„å¸¦æœ‰ <code>@Configuration</code> æ³¨è§£çš„ç±»å°†ä¼šç”¨æ¥å®šä¹‰<code> DispatcherServlet</code> åº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ beanã€‚<code>getRootConfigClasses()</code> æ–¹æ³•è¿”å›çš„å¸¦æœ‰ <code>@Configuration</code> æ³¨è§£çš„ç±»å°†ä¼šç”¨æ¥é…ç½® <code>ContextLoaderListener</code> åˆ›å»ºçš„åº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ beanã€‚</p>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæ ¹é…ç½®å®šä¹‰åœ¨ <code>RootConfig</code> ä¸­ï¼Œ<code>DispatcherServlet</code> çš„é…ç½®å£°æ˜åœ¨ <code>WebConfig</code> ä¸­ã€‚ç¨åæˆ‘ä»¬å°†ä¼šçœ‹åˆ°è¿™ä¸¤ä¸ªç±»çš„å†…å®¹ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé€šè¿‡ <code>AbstractAnnotationConfigDispatcherServletInitializer</code> æ¥é…ç½® <code>DispatcherServlet</code> æ˜¯ä¼ ç»Ÿ <code>web.xml</code> æ–¹å¼çš„æ›¿ä»£æ–¹æ¡ˆã€‚å¦‚æœä½ æ„¿æ„çš„è¯ï¼Œå¯ä»¥åŒæ—¶åŒ…å« <code>web.xml</code> å’Œ <code>AbstractAnnotationConfigDispatcherServletInitializer</code>ï¼Œä½†è¿™å…¶å®å¹¶æ²¡æœ‰å¿…è¦ã€‚</p>
<p>å¦‚æœæŒ‰ç…§è¿™ç§æ–¹å¼é…ç½® <code>DispatcherServlet</code>ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>web.xml</code> çš„è¯ï¼Œé‚£å”¯ä¸€é—®é¢˜åœ¨äºå®ƒåªèƒ½éƒ¨ç½²åˆ°æ”¯æŒ <code>Servlet 3.0</code> çš„æœåŠ¡å™¨ä¸­æ‰èƒ½æ­£å¸¸å·¥ä½œï¼Œå¦‚ Tomcat 7 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚<code>Servlet 3.0</code> è§„èŒƒåœ¨ 2009 å¹´ 12 æœˆä»½å°±å‘å¸ƒäº†ï¼Œå› æ­¤å¾ˆæœ‰å¯èƒ½ä½ ä¼šå°†åº”ç”¨éƒ¨ç½²åˆ°æ”¯æŒ <code>Servlet 3.0</code> çš„ <code>Servlet</code> å®¹å™¨ä¹‹ä¸­ã€‚</p>
<p>å¦‚æœä½ è¿˜æ²¡æœ‰ä½¿ç”¨æ”¯æŒ <code>Servlet 3.0</code> çš„æœåŠ¡å™¨ï¼Œé‚£ä¹ˆåœ¨ <code>AbstractAnnotationConfigDispatcherServletInitializer</code> å­ç±»ä¸­é…ç½® <code>DispatcherServlet</code> çš„æ–¹æ³•å°±ä¸é€‚åˆä½ äº†ã€‚ä½ åˆ«æ— é€‰æ‹©ï¼Œåªèƒ½ä½¿ç”¨ <code>web.xml</code> äº†ã€‚æˆ‘ä»¬å°†ä¼šåœ¨ç¬¬ 7 ç« å­¦ä¹  <code>web.xml</code> å’Œå…¶ä»–é…ç½®é€‰é¡¹ã€‚ä½†ç°åœ¨ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ç¨‹åºæ¸…å• 5.1 ä¸­æ‰€å¼•ç”¨çš„ <code>WebConfig</code> å’Œ <code>RootConfig</code>ï¼Œäº†è§£ä¸€ä¸‹å¦‚ä½•å¯ç”¨ <code>Spring MVC</code>ã€‚</p>
<p>å¯ç”¨ <code>Spring MVC</code></p>
<p>æˆ‘ä»¬æœ‰å¤šç§æ–¹å¼æ¥é…ç½® <code>DispatcherServlet</code>ï¼Œä¸ä¹‹ç±»ä¼¼ï¼Œå¯ç”¨ <code>Spring MVC</code> ç»„ä»¶çš„æ–¹æ³•ä¹Ÿä¸ä»…ä¸€ç§ã€‚ä»¥å‰ï¼ŒSpring æ˜¯ä½¿ç”¨ XML è¿›è¡Œé…ç½®çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>&lt;mvc:annotation-driven&gt;</code> å¯ç”¨æ³¨è§£é©±åŠ¨çš„ <code>Spring MVC</code>ã€‚</p>
<p>æˆ‘ä»¬ä¼šåœ¨ç¬¬ 7 ç« è®¨è®º <code>Spring MVC</code> é…ç½®å¯é€‰é¡¹çš„æ—¶å€™ï¼Œå†è®¨è®º <code>&lt;mvc:annotation-driven&gt;</code>ã€‚ä¸è¿‡ï¼Œç°åœ¨æˆ‘ä»¬ä¼šè®© <code>Spring MVC</code> çš„æ­å»ºè¿‡ç¨‹å°½å¯èƒ½ç®€å•å¹¶åŸºäº Javaè¿›è¡Œé…ç½®ã€‚</p>
<p>æˆ‘ä»¬æ‰€èƒ½åˆ›å»ºçš„æœ€ç®€å•çš„ <code>Spring MVC</code> é…ç½®å°±æ˜¯ä¸€ä¸ªå¸¦æœ‰ <code>@EnableWebMvc</code> æ³¨è§£çš„ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.web;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;<span class="meta">@Configuration</span><span class="meta">@EnableWebMvcpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™å¯ä»¥è¿è¡Œèµ·æ¥ï¼Œå®ƒçš„ç¡®èƒ½å¤Ÿå¯ç”¨ <code>Spring MVC</code>ï¼Œä½†è¿˜æœ‰ä¸å°‘é—®é¢˜è¦è§£å†³ï¼š</p>
<ul>
<li>æ²¡æœ‰é…ç½®è§†å›¾è§£æå™¨ã€‚å¦‚æœè¿™æ ·çš„è¯ï¼ŒSpring é»˜è®¤ä¼šä½¿ç”¨ <code>BeanNameViewResolver</code>ï¼Œè¿™ä¸ªè§†å›¾è§£æå™¨ä¼šæŸ¥æ‰¾ ID ä¸è§†å›¾åç§°åŒ¹é…çš„ beanï¼Œå¹¶ä¸”æŸ¥æ‰¾çš„ bean è¦å®ç° View æ¥å£ï¼Œå®ƒä»¥è¿™æ ·çš„æ–¹å¼æ¥è§£æè§†å›¾ã€‚</li>
<li>æ²¡æœ‰å¯ç”¨ç»„ä»¶æ‰«æã€‚è¿™æ ·çš„ç»“æœå°±æ˜¯ï¼ŒSpring åªèƒ½æ‰¾åˆ°æ˜¾å¼å£°æ˜åœ¨é…ç½®ç±»ä¸­çš„æ§åˆ¶å™¨ã€‚</li>
<li>è¿™æ ·é…ç½®çš„è¯ï¼Œ<code>DispatcherServlet</code> ä¼šæ˜ å°„ä¸ºåº”ç”¨çš„é»˜è®¤ <code>Servlet</code>ï¼Œæ‰€ä»¥å®ƒä¼šå¤„ç†æ‰€æœ‰çš„è¯·æ±‚ï¼ŒåŒ…æ‹¬å¯¹é™æ€èµ„æºçš„è¯·æ±‚ï¼Œå¦‚å›¾ç‰‡å’Œæ ·å¼è¡¨ï¼ˆåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™å¯èƒ½å¹¶ä¸æ˜¯ä½ æƒ³è¦çš„æ•ˆæœï¼‰ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ <code>WebConfig</code> è¿™ä¸ªæœ€å°çš„ <code>Spring MVC</code> é…ç½®ä¸Šå†åŠ ä¸€äº›å†…å®¹ï¼Œä»è€Œè®©å®ƒå˜å¾—çœŸæ­£æœ‰ç”¨ã€‚å¦‚ä¸‹ç¨‹åºæ¸…å•ä¸­çš„ <code>WebConfig</code> è§£å†³äº†ä¸Šé¢æ‰€è¿°çš„é—®é¢˜ã€‚</p>
<center>ç¨‹åºæ¸…å• 5.2ã€€æœ€å°ä½†å¯ç”¨çš„ Spring MVC é…ç½®</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.web;<span class="keyword">import</span> org.springframework.context.annotation.Bean;<span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.web.servlet.ViewResolver;<span class="keyword">import</span> org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer;<span class="keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;<span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;<span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;<span class="keyword">import</span> org.springframework.web.servlet.view.InternalResourceViewResolver;<span class="meta">@Configuration</span><span class="meta">@EnableWebMvc</span> <span class="comment">// å¯ç”¨ Spring mvc@ComponentScan(&quot;spittr.web&quot;) // å¯ç”¨ç»„ä»¶æ‰«æpublic class WebConfig extends WebMvcConfigurerAdapter &#123;    // é…ç½® jsp è§†å›¾è§£æå™¨    @Bean    public ViewResolver viewResolver() &#123;        InternalResourceViewResolver resolver = new InternalResourceViewResolver();        resolver.setPrefix(&quot;/WEB-INF/views/&quot;);        resolver.setSuffix(&quot;.jsp&quot;);        return resolver;    &#125;  	    // é…ç½®é™æ€èµ„æºçš„å¤„ç†    @Override    public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) &#123;        configurer.enable();    &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ç¨‹åºæ¸…å• 5.2 ä¸­ç¬¬ä¸€ä»¶éœ€è¦æ³¨æ„çš„äº‹æƒ…æ˜¯ WebConfig ç°åœ¨æ·»åŠ äº† <code>@ComponentScan</code> æ³¨è§£ï¼Œå› æ­¤å°†ä¼šæ‰«æ <code>spitter.web</code> åŒ…æ¥æŸ¥æ‰¾ç»„ä»¶ã€‚ç¨åä½ å°±ä¼šçœ‹åˆ°ï¼Œæˆ‘ä»¬æ‰€ç¼–å†™çš„æ§åˆ¶å™¨å°†ä¼šå¸¦æœ‰ <code>@Controller</code> æ³¨è§£ï¼Œè¿™ä¼šä½¿å…¶æˆä¸ºç»„ä»¶æ‰«ææ—¶çš„å€™é€‰ beanã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨é…ç½®ç±»ä¸­æ˜¾å¼å£°æ˜ä»»ä½•çš„æ§åˆ¶å™¨ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª <code>ViewResolver bean</code>ã€‚æ›´å…·ä½“æ¥è®²ï¼Œæ˜¯ <code>InternalResourceViewResolver</code>ã€‚æˆ‘ä»¬å°†ä¼šåœ¨ç¬¬ 6 ç« æ›´ä¸ºè¯¦ç»†åœ°è®¨è®ºè§†å›¾è§£æå™¨ã€‚æˆ‘ä»¬åªéœ€è¦çŸ¥é“å®ƒä¼šæŸ¥æ‰¾ <code>JSP</code> æ–‡ä»¶ï¼Œåœ¨æŸ¥æ‰¾çš„æ—¶å€™ï¼Œå®ƒä¼šåœ¨è§†å›¾åç§°ä¸ŠåŠ ä¸€ä¸ªç‰¹å®šçš„å‰ç¼€å’Œåç¼€ï¼ˆä¾‹å¦‚ï¼Œåä¸º home çš„è§†å›¾å°†ä¼šè§£æä¸º <code>/WEB-INF/views/home.jsp</code>ï¼‰ã€‚</p>
<p>æœ€åï¼Œæ–°çš„ <code>WebConfig</code> ç±»è¿˜æ‰©å±•äº† <code>WebMvcConfigurerAdapter</code> å¹¶é‡å†™äº†å…¶ <code>configureDefaultServletHandling()</code> æ–¹æ³•ã€‚é€šè¿‡è°ƒç”¨<code>DefaultServletHandlerConfigurer</code> çš„ enable() æ–¹æ³•ï¼Œæˆ‘ä»¬è¦æ±‚ <code>DispatcherServlet</code> å°†å¯¹é™æ€èµ„æºçš„è¯·æ±‚è½¬å‘åˆ° <code>Servlet</code> å®¹å™¨ä¸­é»˜è®¤çš„ <code>Servlet</code> ä¸Šï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>DispatcherServlet</code> æœ¬èº«æ¥å¤„ç†æ­¤ç±»è¯·æ±‚ã€‚</p>
<p><code>WebConfig</code> å·²ç»å°±ç»ªï¼Œé‚£ <code>RootConfig</code> å‘¢ï¼Ÿå› ä¸ºæœ¬ç« èšç„¦äº Web å¼€å‘ï¼Œè€Œ Web ç›¸å…³çš„é…ç½®é€šè¿‡ <code>DispatcherServlet</code> åˆ›å»ºçš„åº”ç”¨ä¸Šä¸‹æ–‡éƒ½å·²ç»é…ç½®å¥½äº†ï¼Œå› æ­¤ç°åœ¨çš„ <code>RootConfig</code> ç›¸å¯¹å¾ˆç®€å•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.config;<span class="keyword">import</span> java.util.regex.Pattern;<span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;<span class="keyword">import</span> org.springframework.context.annotation.ComponentScan.Filter;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.context.annotation.FilterType;<span class="keyword">import</span> org.springframework.context.annotation.Import;<span class="keyword">import</span> org.springframework.core.type.filter.RegexPatternTypeFilter;<span class="keyword">import</span> spittr.config.RootConfig.WebPackage;<span class="meta">@Configuration</span><span class="meta">@Import(DataConfig.class)</span><span class="meta">@ComponentScan(basePackages=&#123;&quot;spittr&quot;&#125;,     excludeFilters=&#123;        @Filter(type=FilterType.CUSTOM, value=WebPackage.class)    &#125;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RootConfig</span> </span>&#123;  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WebPackage</span> <span class="keyword">extends</span> <span class="title">RegexPatternTypeFilter</span> </span>&#123;    <span class="function"><span class="keyword">public</span> <span class="title">WebPackage</span><span class="params">()</span> </span>&#123;      <span class="keyword">super</span>(Pattern.compile(<span class="string">&quot;spittr\\.web&quot;</span>));    &#125;      &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ <code>RootConfig</code> ä½¿ç”¨äº† <code>@ComponentScan</code> æ³¨è§£ã€‚è¿™æ ·çš„è¯ï¼Œåœ¨æœ¬ä¹¦ä¸­ï¼Œæˆ‘ä»¬å°±æœ‰å¾ˆå¤šæœºä¼šç”¨é Web çš„ç»„ä»¶æ¥å……å®å®Œå–„ <code>RootConfig</code>ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå·²ç»å¯ä»¥å¼€å§‹ä½¿ç”¨ <code>Spring MVC</code> æ„å»º Web åº”ç”¨äº†ã€‚æ­¤æ—¶ï¼Œæœ€å¤§çš„é—®é¢˜åœ¨äºï¼Œæˆ‘ä»¬è¦æ„å»ºçš„åº”ç”¨åˆ°åº•æ˜¯ä»€ä¹ˆã€‚</p>
<h4 id="Spittr-åº”ç”¨ç®€ä»‹"><a href="#Spittr-åº”ç”¨ç®€ä»‹" class="headerlink" title="Spittr åº”ç”¨ç®€ä»‹"></a>Spittr åº”ç”¨ç®€ä»‹</h4><p>ä¸ºäº†å®ç°åœ¨çº¿ç¤¾äº¤çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å°†è¦æ„å»ºä¸€ä¸ªç®€å•çš„å¾®åšï¼ˆmicrobloggingï¼‰åº”ç”¨ã€‚åœ¨å¾ˆå¤šæ–¹é¢ï¼Œæˆ‘ä»¬æ‰€æ„å»ºçš„åº”ç”¨ä¸æœ€æ—©çš„å¾®åšåº”ç”¨ Twitter å¾ˆç±»ä¼¼ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šæ·»åŠ ä¸€äº›å°çš„å˜åŒ–ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ Spring æŠ€æœ¯æ¥æ„å»ºè¿™ä¸ªåº”ç”¨ã€‚</p>
<p>å› ä¸ºä» Twitter å€Ÿé‰´äº†çµæ„Ÿå¹¶ä¸”é€šè¿‡ Spring æ¥è¿›è¡Œå®ç°ï¼Œæ‰€ä»¥å®ƒå°±æœ‰äº†ä¸€ä¸ªåå­—ï¼š<code>Spitter</code>ã€‚å†è¿›ä¸€æ­¥ï¼Œåº”ç”¨ç½‘ç«™å‘½åä¸­æµè¡Œçš„æ¨¡å¼ï¼Œå¦‚ <code>Flickr</code>ï¼Œæˆ‘ä»¬å»æ‰å­—æ¯ eï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å°†è¿™ä¸ªåº”ç”¨ç§°ä¸º <code>Spittr</code>ã€‚è¿™ä¸ªåç§°ä¹Ÿæœ‰åŠ©äºåŒºåˆ†åº”ç”¨åç§°å’Œé¢†åŸŸç±»å‹ï¼Œå› ä¸ºæˆ‘ä»¬å°†ä¼šåˆ›å»ºä¸€ä¸ªåä¸º <code>Spitter</code> çš„é¢†åŸŸç±»ã€‚</p>
<p>Spittr åº”ç”¨æœ‰ä¸¤ä¸ªåŸºæœ¬çš„é¢†åŸŸæ¦‚å¿µï¼šSpitterï¼ˆåº”ç”¨çš„ç”¨æˆ·ï¼‰å’Œ Spittleï¼ˆç”¨æˆ·å‘å¸ƒçš„ç®€çŸ­çŠ¶æ€æ›´æ–°ï¼‰ã€‚å½“æˆ‘ä»¬åœ¨ä¹¦ä¸­å®Œå–„ Spittr åº”ç”¨çš„åŠŸèƒ½æ—¶ï¼Œå°†ä¼šä»‹ç»è¿™ä¸¤ä¸ªé¢†åŸŸæ¦‚å¿µã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šæ„å»ºåº”ç”¨çš„ Web å±‚ï¼Œåˆ›å»ºå±•ç° Spittle çš„æ§åˆ¶å™¨ä»¥åŠå¤„ç†ç”¨æˆ·æ³¨å†Œæˆä¸º Spitter çš„è¡¨å•ã€‚</p>
<p>èˆå°å·²ç»æ­å»ºå®Œæˆäº†ã€‚æˆ‘ä»¬å·²ç»é…ç½®äº† <code>DispatcherServlet</code>ï¼Œå¯ç”¨äº†åŸºæœ¬çš„ <code>Spring MVC</code> ç»„ä»¶å¹¶ç¡®å®šäº†ç›®æ ‡åº”ç”¨ã€‚è®©æˆ‘ä»¬è¿›å…¥æœ¬ç« çš„æ ¸å¿ƒå†…å®¹ï¼šä½¿ç”¨ <code>Spring MVC</code> æ§åˆ¶å™¨å¤„ç† Web è¯·æ±‚ã€‚</p>
<h3 id="ç¼–å†™åŸºæœ¬çš„æ§åˆ¶å™¨"><a href="#ç¼–å†™åŸºæœ¬çš„æ§åˆ¶å™¨" class="headerlink" title="ç¼–å†™åŸºæœ¬çš„æ§åˆ¶å™¨"></a>ç¼–å†™åŸºæœ¬çš„æ§åˆ¶å™¨</h3><p>åœ¨ <code>Spring MVC</code> ä¸­ï¼Œæ§åˆ¶å™¨åªæ˜¯æ–¹æ³•ä¸Šæ·»åŠ äº† <code>@RequestMapping</code> æ³¨è§£çš„ç±»ï¼Œè¿™ä¸ªæ³¨è§£å£°æ˜äº†å®ƒä»¬æ‰€è¦å¤„ç†çš„è¯·æ±‚ã€‚</p>
<p>å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°½å¯èƒ½ç®€å•ï¼Œå‡è®¾æ§åˆ¶å™¨ç±»è¦å¤„ç†å¯¹ â€œ/â€ çš„è¯·æ±‚ï¼Œå¹¶æ¸²æŸ“åº”ç”¨çš„é¦–é¡µã€‚ç¨‹åºæ¸…å• 5.3 æ‰€ç¤ºçš„ <code>HomeController</code> å¯èƒ½æ˜¯æœ€ç®€å•çš„ <code>Spring MVC</code> æ§åˆ¶å™¨ç±»äº†ã€‚</p>
<center>ç¨‹åºæ¸…å• 5.3ã€€HomeControllerï¼šè¶…çº§ç®€å•çš„æ§åˆ¶å™¨</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.web;<span class="keyword">import</span> <span class="keyword">static</span> org.springframework.web.bind.annotation.RequestMethod.*;<span class="keyword">import</span> org.springframework.stereotype.Controller;<span class="keyword">import</span> org.springframework.ui.Model;<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<span class="meta">@Controllerpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> </span>&#123;  <span class="meta">@RequestMapping(value=&quot;/&quot;, method=GET)</span>  <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">(Model model)</span> </span>&#123;    <span class="keyword">return</span> <span class="string">&quot;home&quot;</span>;  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ä½ å¯èƒ½æ³¨æ„åˆ°çš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯ <code>HomeController</code> å¸¦æœ‰ <code>@Controller</code> æ³¨è§£ã€‚å¾ˆæ˜¾ç„¶è¿™ä¸ªæ³¨è§£æ˜¯ç”¨æ¥å£°æ˜æ§åˆ¶å™¨çš„ï¼Œä½†å®é™…ä¸Šè¿™ä¸ªæ³¨è§£å¯¹ <code>Spring MVC</code> æœ¬èº«çš„å½±å“å¹¶ä¸å¤§ã€‚</p>
<p><code>HomeController</code> æ˜¯ä¸€ä¸ªæ„é€ å‹ï¼ˆstereotypeï¼‰çš„æ³¨è§£ï¼Œå®ƒåŸºäº@Component æ³¨è§£ã€‚åœ¨è¿™é‡Œï¼Œå®ƒçš„ç›®çš„å°±æ˜¯è¾…åŠ©å®ç°ç»„ä»¶æ‰«æã€‚å› ä¸º <code>HomeController</code> å¸¦æœ‰ <code>@Controller</code> æ³¨è§£ï¼Œå› æ­¤ç»„ä»¶æ‰«æå™¨ä¼šè‡ªåŠ¨æ‰¾åˆ° <code>HomeController</code>ï¼Œå¹¶å°†å…¶å£°æ˜ä¸º Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ä¸€ä¸ª beanã€‚</p>
<p>å…¶å®ï¼Œä½ ä¹Ÿå¯ä»¥è®© <code>HomeController</code> å¸¦æœ‰ <code>@Component</code> æ³¨è§£ï¼Œå®ƒæ‰€å®ç°çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯åœ¨è¡¨æ„æ€§ä¸Šå¯èƒ½ä¼šå·®ä¸€äº›ï¼Œæ— æ³•ç¡®å®š <code>HomeController</code> æ˜¯ä»€ä¹ˆç»„ä»¶ç±»å‹ã€‚</p>
<p><code>HomeController</code> å”¯ä¸€çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ home() æ–¹æ³•ï¼Œå¸¦æœ‰ <code>@RequestMapping</code> æ³¨è§£ã€‚å®ƒçš„ value å±æ€§æŒ‡å®šäº†è¿™ä¸ªæ–¹æ³•æ‰€è¦å¤„ç†çš„è¯·æ±‚è·¯å¾„ï¼Œmethod å±æ€§ç»†åŒ–äº†å®ƒæ‰€å¤„ç†çš„ HTTP æ–¹æ³•ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå½“æ”¶åˆ°å¯¹ â€œ/â€ çš„ HTTP GET è¯·æ±‚æ—¶ï¼Œå°±ä¼šè°ƒç”¨ home() æ–¹æ³•ã€‚</p>
<p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œhome() æ–¹æ³•å…¶å®å¹¶æ²¡æœ‰åšå¤ªå¤šçš„äº‹æƒ…ï¼šå®ƒè¿”å›äº†ä¸€ä¸ª String ç±»å‹çš„ â€œhomeâ€ã€‚è¿™ä¸ª String å°†ä¼šè¢« <code>Spring MVC</code> è§£è¯»ä¸ºè¦æ¸²æŸ“çš„è§†å›¾åç§°ã€‚<code>DispatcherServlet</code> ä¼šè¦æ±‚è§†å›¾è§£æå™¨å°†è¿™ä¸ªé€»è¾‘åç§°è§£æä¸ºå®é™…çš„è§†å›¾ã€‚</p>
<p>é‰´äºæˆ‘ä»¬é…ç½® <code>InternalResourceViewResolver</code> çš„æ–¹å¼ï¼Œè§†å›¾å â€œhomeâ€ å°†ä¼šè§£æä¸º â€œ<code>/WEB-INF/views/home.jsp</code>â€ è·¯å¾„çš„ JSPã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ä¼šè®© <code>Spittr</code> åº”ç”¨çš„é¦–é¡µç›¸å½“ç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<center>ç¨‹åºæ¸…å• 5.4ã€€Spittr åº”ç”¨çš„é¦–é¡µï¼Œå®šä¹‰ä¸ºä¸€ä¸ªç®€å•çš„ JSP</center>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix=<span class="string">&quot;c&quot;</span> %&gt;&lt;%@ page session=<span class="string">&quot;false&quot;</span> %&gt;&lt;html&gt;  &lt;head&gt;    &lt;title&gt;Spitter&lt;/title&gt;    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span>           type=<span class="string">&quot;text/css&quot;</span>           href=<span class="string">&quot;&lt;c:url value=&quot;</span>/resources/style.css<span class="string">&quot; /&gt;&quot;</span> &gt;  &lt;/head&gt;  &lt;body&gt;    &lt;h1&gt;Welcome to Spitter&lt;/h1&gt;    &lt;a href=<span class="string">&quot;&lt;c:url value=&quot;</span>/spittles<span class="string">&quot; /&gt;&quot;</span>&gt;Spittles&lt;/a&gt; |     &lt;a href=<span class="string">&quot;&lt;c:url value=&quot;</span>/spitter/register<span class="string">&quot; /&gt;&quot;</span>&gt;Register&lt;/a&gt;  &lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª JSP å¹¶æ²¡æœ‰å¤ªå¤šéœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚å®ƒåªæ˜¯æ¬¢è¿åº”ç”¨çš„ç”¨æˆ·ï¼Œå¹¶æä¾›äº†ä¸¤ä¸ªé“¾æ¥ï¼šä¸€ä¸ªæ˜¯æŸ¥çœ‹ Spittle åˆ—è¡¨ï¼Œå¦ä¸€ä¸ªæ˜¯åœ¨åº”ç”¨ä¸­è¿›è¡Œæ³¨å†Œã€‚å›¾ 5.2 å±•ç°äº†æ­¤æ—¶çš„é¦–é¡µæ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚</p>
<p>åœ¨æœ¬ç« å®Œæˆä¹‹å‰ï¼Œæˆ‘ä»¬å°†ä¼šå®ç°å¤„ç†è¿™äº›è¯·æ±‚çš„æ§åˆ¶å™¨æ–¹æ³•ã€‚ä½†ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¯¹è¿™ä¸ªæ§åˆ¶å™¨å‘èµ·ä¸€äº›è¯·æ±‚ï¼Œçœ‹ä¸€ä¸‹å®ƒæ˜¯å¦èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚æµ‹è¯•æ§åˆ¶å™¨æœ€ç›´æ¥çš„åŠæ³•å¯èƒ½å°±æ˜¯æ„å»ºå¹¶éƒ¨ç½²åº”ç”¨ï¼Œç„¶åé€šè¿‡æµè§ˆå™¨å¯¹å…¶è¿›è¡Œè®¿é—®ï¼Œä½†æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•å¯èƒ½ä¼šç»™ä½ æ›´å¿«çš„åé¦ˆå’Œæ›´ä¸€è‡´çš„ç‹¬ç«‹ç»“æœã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªé’ˆå¯¹ <code>HomeController</code> çš„æµ‹è¯•ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211021183533119.png" alt="image-20211021183533119"></p>
<center>å›¾ 5.2ã€€å½“å‰çš„ Spittr é¦–é¡µ</center>

<h4 id="æµ‹è¯•æ§åˆ¶å™¨"><a href="#æµ‹è¯•æ§åˆ¶å™¨" class="headerlink" title="æµ‹è¯•æ§åˆ¶å™¨"></a>æµ‹è¯•æ§åˆ¶å™¨</h4><p>è®©æˆ‘ä»¬å†å®¡è§†ä¸€ä¸‹ <code>HomeController</code>ã€‚å¦‚æœä½ çœ¼ç¥ä¸å¤ªå¥½çš„è¯ï¼Œä½ ç”šè‡³å¯èƒ½æ³¨æ„ä¸åˆ°è¿™äº›æ³¨è§£ï¼Œæ‰€çœ‹åˆ°çš„ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„ <code>POJO</code>ã€‚æˆ‘ä»¬éƒ½çŸ¥é“æµ‹è¯• <code>POJO</code> æ˜¯å¾ˆå®¹æ˜“çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªç®€å•çš„ç±»æ¥æµ‹è¯• <code>HomeController</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<center>ç¨‹åºæ¸…å• 5.5ã€€HomeControllerTestï¼šæµ‹è¯• HomeController</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.web;<span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;<span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;<span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.setup.MockMvcBuilders.*;<span class="keyword">import</span> org.junit.Test;<span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;<span class="keyword">import</span> spittr.web.HomeController;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeControllerTest</span> </span>&#123;  <span class="meta">@Test</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHomePage</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;    HomeController controller = <span class="keyword">new</span> HomeController();    assertEquals(<span class="string">&quot;home&quot;</span>, controller.home())  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºæ¸…å• 5.5 ä¸­çš„æµ‹è¯•å¾ˆç®€å•ï¼Œä½†å®ƒåªæµ‹è¯•äº† home() æ–¹æ³•ä¸­ä¼šå‘ç”Ÿä»€ä¹ˆã€‚åœ¨æµ‹è¯•ä¸­ä¼šç›´æ¥è°ƒç”¨ home() æ–¹æ³•ï¼Œå¹¶æ–­è¨€è¿”å›åŒ…å« â€œhomeâ€ å€¼çš„ Stringã€‚å®ƒå®Œå…¨æ²¡æœ‰ç«™åœ¨ <code>Spring MVC</code> æ§åˆ¶å™¨çš„è§†è§’è¿›è¡Œæµ‹è¯•ã€‚è¿™ä¸ªæµ‹è¯•æ²¡æœ‰æ–­è¨€å½“æ¥æ”¶åˆ°é’ˆå¯¹ â€œ/â€ çš„ GET è¯·æ±‚æ—¶ä¼šè°ƒç”¨ home() æ–¹æ³•ã€‚å› ä¸ºå®ƒè¿”å›çš„å€¼å°±æ˜¯ â€œhomeâ€ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰çœŸæ­£åˆ¤æ–­ home æ˜¯è§†å›¾çš„åç§°ã€‚</p>
<p>ä¸è¿‡ä» Spring 3.2 å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§æ§åˆ¶å™¨çš„æ–¹å¼æ¥æµ‹è¯• <code>Spring MVC</code> ä¸­çš„æ§åˆ¶å™¨äº†ï¼Œè€Œä¸ä»…ä»…æ˜¯ä½œä¸º <code>POJO</code> è¿›è¡Œæµ‹è¯•ã€‚Spring ç°åœ¨åŒ…å«äº†ä¸€ç§ <code>mock Spring MVC</code> å¹¶é’ˆå¯¹æ§åˆ¶å™¨æ‰§è¡Œ HTTP è¯·æ±‚çš„æœºåˆ¶ã€‚è¿™æ ·çš„è¯ï¼Œåœ¨æµ‹è¯•æ§åˆ¶å™¨çš„æ—¶å€™ï¼Œå°±æ²¡æœ‰å¿…è¦å†å¯åŠ¨ Web æœåŠ¡å™¨å’Œ Web æµè§ˆå™¨äº†ã€‚</p>
<p>ä¸ºäº†é˜è¿°å¦‚ä½•æµ‹è¯• <code>Spring MVC</code> çš„æ§åˆ¶å™¨ï¼Œæˆ‘ä»¬é‡å†™ <code>HomeControllerTest</code> å¹¶ä½¿ç”¨ <code>Spring MVC</code> ä¸­æ–°çš„æµ‹è¯•ç‰¹æ€§ã€‚ç¨‹åºæ¸…å• 5.6 å±•ç°äº†æ–°çš„ <code>HomeControllerTest</code>ã€‚</p>
<center>ç¨‹åºæ¸…å• 5.6ã€€æ”¹è¿›  HomeControllerTest</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.web;<span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;<span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;<span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.setup.MockMvcBuilders.*;<span class="keyword">import</span> org.junit.Test;<span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;<span class="keyword">import</span> spittr.web.HomeController;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeControllerTest</span> </span>&#123;  <span class="meta">@Test</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHomePage</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;    HomeController controller = <span class="keyword">new</span> HomeController();    MockMvc mockMvc = standaloneSetup(controller).build(); <span class="comment">//æ­å»º MocMvc    mockMvc.perform(get(&quot;/&quot;)). // å¯¹ &quot;/&quot; æ‰§è¡Œ GET è¯·æ±‚        andExpect(view().name(&quot;home&quot;)); // é¢„æœŸå¾—åˆ° home è§†å›¾  &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>å°½ç®¡æ–°ç‰ˆæœ¬çš„æµ‹è¯•åªæ¯”ä¹‹å‰ç‰ˆæœ¬å¤šäº†å‡ è¡Œä»£ç ï¼Œä½†æ˜¯å®ƒæ›´åŠ å®Œæ•´åœ°æµ‹è¯•äº† <code>HomeController</code>ã€‚è¿™æ¬¡æˆ‘ä»¬ä¸æ˜¯ç›´æ¥è°ƒç”¨ home() æ–¹æ³•å¹¶æµ‹è¯•å®ƒçš„è¿”å›å€¼ï¼Œè€Œæ˜¯å‘èµ·äº†å¯¹ â€œ/â€ çš„ GET è¯·æ±‚ï¼Œå¹¶æ–­è¨€ç»“æœè§†å›¾çš„åç§°ä¸º homeã€‚å®ƒé¦–å…ˆä¼ é€’ä¸€ä¸ª <code>HomeController</code> å®ä¾‹åˆ° <code>MockMvcBuilders.standaloneSetup()</code> å¹¶è°ƒç”¨ build() æ¥æ„å»º <code>MockMvc</code> å®ä¾‹ã€‚ç„¶åå®ƒä½¿ç”¨ <code>MockMvc</code> å®ä¾‹æ¥æ‰§è¡Œé’ˆå¯¹ â€œ/â€ çš„ GET è¯·æ±‚å¹¶è®¾ç½®æœŸæœ›å¾—åˆ°çš„è§†å›¾åç§°ã€‚</p>
<h4 id="å®šä¹‰ç±»çº§åˆ«çš„è¯·æ±‚å¤„ç†"><a href="#å®šä¹‰ç±»çº§åˆ«çš„è¯·æ±‚å¤„ç†" class="headerlink" title="å®šä¹‰ç±»çº§åˆ«çš„è¯·æ±‚å¤„ç†"></a>å®šä¹‰ç±»çº§åˆ«çš„è¯·æ±‚å¤„ç†</h4><p>ç°åœ¨ï¼Œå·²ç»ä¸º <code>HomeController</code> ç¼–å†™äº†æµ‹è¯•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åšä¸€äº›é‡æ„ï¼Œå¹¶é€šè¿‡æµ‹è¯•æ¥ä¿è¯ä¸ä¼šå¯¹åŠŸèƒ½é€ æˆä»€ä¹ˆç ´åã€‚æˆ‘ä»¬å¯ä»¥åšçš„ä¸€ä»¶äº‹å°±æ˜¯æ‹†åˆ† <code>@RequestMapping</code>ï¼Œå¹¶å°†å…¶è·¯å¾„æ˜ å°„éƒ¨åˆ†æ”¾åˆ°ç±»çº§åˆ«ä¸Šã€‚ç¨‹åºæ¸…å• 5.7 å±•ç¤ºäº†è¿™ä¸ªè¿‡ç¨‹ã€‚</p>
<center>ç¨‹åºæ¸…å• 5.7ã€€æ‹†åˆ† HomeController ä¸­çš„ @RequestMapping</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.web;<span class="keyword">import</span> <span class="keyword">static</span> org.springframework.web.bind.annotation.RequestMethod.*;<span class="keyword">import</span> org.springframework.stereotype.Controller;<span class="keyword">import</span> org.springframework.ui.Model;<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<span class="meta">@Controller</span><span class="meta">@RequestMapping(&quot;/&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> </span>&#123;  <span class="meta">@RequestMapping(method = GET)</span>  <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">(Model model)</span> </span>&#123;    <span class="keyword">return</span> <span class="string">&quot;home&quot;</span>;  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªæ–°ç‰ˆæœ¬çš„ <code>HomeController</code> ä¸­ï¼Œè·¯å¾„ç°åœ¨è¢«è½¬ç§»åˆ°ç±»çº§åˆ«çš„ <code>@RequestMapping</code> ä¸Šï¼Œè€Œ HTTP æ–¹æ³•ä¾ç„¶æ˜ å°„åœ¨æ–¹æ³•çº§åˆ«ä¸Šã€‚å½“æ§åˆ¶å™¨åœ¨ç±»çº§åˆ«ä¸Šæ·»åŠ  <code>@RequestMapping</code> æ³¨è§£æ—¶ï¼Œè¿™ä¸ªæ³¨è§£ä¼šåº”ç”¨åˆ°æ§åˆ¶å™¨çš„æ‰€æœ‰å¤„ç†å™¨æ–¹æ³•ä¸Šã€‚å¤„ç†å™¨æ–¹æ³•ä¸Šçš„ <code>@RequestMapping</code> æ³¨è§£ä¼šå¯¹ç±»çº§åˆ«ä¸Šçš„ <code>@RequestMapping</code> çš„å£°æ˜è¿›è¡Œè¡¥å……ã€‚</p>
<p>å°± <code>HomeController</code> è€Œè¨€ï¼Œè¿™é‡Œåªæœ‰ä¸€ä¸ªæ§åˆ¶å™¨æ–¹æ³•ã€‚ä¸ç±»çº§åˆ«çš„ <code>@RequestMapping</code> åˆå¹¶ä¹‹åï¼Œè¿™ä¸ªæ–¹æ³•çš„ <code>@RequestMapping</code> è¡¨æ˜ home() å°†ä¼šå¤„ç†å¯¹ â€œ/â€ è·¯å¾„çš„ GET è¯·æ±‚ã€‚</p>
<p>æ¢è¨€ä¹‹ï¼Œæˆ‘ä»¬å…¶å®æ²¡æœ‰æ”¹å˜ä»»ä½•åŠŸèƒ½ï¼Œåªæ˜¯å°†ä¸€äº›ä»£ç æ¢äº†ä¸ªåœ°æ–¹ï¼Œä½†æ˜¯ HomeController æ‰€åšçš„äº‹æƒ…å’Œä»¥å‰æ˜¯ä¸€æ ·çš„ã€‚å› ä¸ºæˆ‘ä»¬ç°åœ¨æœ‰äº†æµ‹è¯•ï¼Œæ‰€ä»¥å¯ä»¥ç¡®ä¿åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰å¯¹åŸæœ‰çš„åŠŸèƒ½é€ æˆç ´åã€‚</p>
<p>å½“æˆ‘ä»¬åœ¨ä¿®æ”¹ <code>@RequestMapping</code> æ—¶ï¼Œè¿˜å¯ä»¥å¯¹ <code>HomeController</code> åšå¦å¤–ä¸€ä¸ªå˜æ›´ã€‚<code>@RequestMapping</code> çš„ value å±æ€§èƒ½å¤Ÿæ¥å—ä¸€ä¸ª String ç±»å‹çš„æ•°ç»„ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ç»™å®ƒè®¾ç½®çš„éƒ½æ˜¯ä¸€ä¸ª String ç±»å‹çš„ <code>/</code>ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†å®ƒæ˜ å°„åˆ°å¯¹ <code>/homepage</code> çš„è¯·æ±‚ï¼Œåªéœ€å°†ç±»çº§åˆ«çš„ <code>@RequestMapping</code> æ”¹ä¸ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span><span class="meta">@RequestMapping(&#123;&quot;/&quot;, &quot;homepage&quot;&#125;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeController</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œ<code>HomeController</code> çš„ home() æ–¹æ³•èƒ½å¤Ÿæ˜ å°„åˆ°å¯¹ <code>/</code> å’Œ <code>/homepage</code> çš„ GET è¯·æ±‚ã€‚</p>
<h4 id="ä¼ é€’æ¨¡å‹æ•°æ®åˆ°è§†å›¾ä¸­"><a href="#ä¼ é€’æ¨¡å‹æ•°æ®åˆ°è§†å›¾ä¸­" class="headerlink" title="ä¼ é€’æ¨¡å‹æ•°æ®åˆ°è§†å›¾ä¸­"></a>ä¼ é€’æ¨¡å‹æ•°æ®åˆ°è§†å›¾ä¸­</h4><p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œå°±ç¼–å†™è¶…çº§ç®€å•çš„æ§åˆ¶å™¨æ¥è¯´ï¼ŒHomeController å·²ç»æ˜¯ä¸€ä¸ªä¸é”™çš„æ ·ä¾‹äº†ã€‚ä½†æ˜¯å¤§å¤šæ•°çš„æ§åˆ¶å™¨å¹¶ä¸æ˜¯è¿™ä¹ˆç®€å•ã€‚åœ¨ <code>Spittr</code> åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªé¡µé¢å±•ç°æœ€è¿‘æäº¤çš„ <code>Spittle</code> åˆ—è¡¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„æ–¹æ³•æ¥å¤„ç†è¿™ä¸ªé¡µé¢ã€‚</p>
<p>é¦–å…ˆï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªæ•°æ®è®¿é—®çš„ <code>Repository</code>ã€‚ä¸ºäº†å®ç°è§£è€¦ä»¥åŠé¿å…é™·å…¥æ•°æ®åº“è®¿é—®çš„ç»†èŠ‚ä¹‹ä¸­ï¼Œæˆ‘ä»¬å°† <code>Repository</code> å®šä¹‰ä¸ºä¸€ä¸ªæ¥å£ï¼Œå¹¶åœ¨ç¨åå®ç°å®ƒï¼ˆç¬¬ 10 ç« ä¸­ï¼‰ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªèƒ½å¤Ÿè·å– <code>Spittle</code> åˆ—è¡¨çš„ <code>Repository</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºçš„ <code>SpittleRepository</code> åŠŸèƒ½å·²ç»è¶³å¤Ÿäº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> data;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> spittr.Spittle;<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpittleRepository</span> </span>&#123;    <span class="function">List&lt;Spittle&gt; <span class="title">findSpittles</span><span class="params">(<span class="keyword">long</span> max, <span class="keyword">int</span> count)</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p><code>findSpittles()</code> æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ã€‚å…¶ä¸­ <code>max</code> å‚æ•°ä»£è¡¨æ‰€è¿”å›çš„ <code>Spittle</code> ä¸­ï¼Œ<code>Spittle ID</code> å±æ€§çš„æœ€å¤§å€¼ï¼Œè€Œ count å‚æ•°è¡¨æ˜è¦è¿”å›å¤šå°‘ä¸ª <code>Spittle</code> å¯¹è±¡ã€‚ä¸ºäº†è·å¾—æœ€æ–°çš„ 20 ä¸ª <code>Spittle</code> å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è°ƒç”¨ <code>findSpittles()</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Spittle&gt; recent = spittlerepository.findSpittles(<span class="keyword">long</span>.MAX_VALUE, <span class="number">20</span>);</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬è®© Spittle ç±»å°½å¯èƒ½çš„ç®€å•ï¼Œå¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å• 5.8 æ‰€ç¤ºã€‚å®ƒçš„å±æ€§åŒ…æ‹¬æ¶ˆæ¯å†…å®¹ã€æ—¶é—´æˆ³ä»¥åŠ Spittle å‘å¸ƒæ—¶å¯¹åº”çš„ç»çº¬åº¦ã€‚</p>
<center>ç¨‹åºæ¸…å• 5.8ã€€Spittle ç±»ï¼šåŒ…å«æ¶ˆæ¯å†…å®¹ã€æ—¶é—´æˆ³å’Œä½ç½®ä¿¡æ¯</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr;<span class="keyword">import</span> java.util.Date;<span class="keyword">import</span> org.apache.commons.lang3.builder.EqualsBuilder;<span class="keyword">import</span> org.apache.commons.lang3.builder.HashCodeBuilder;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Spittle</span> </span>&#123;  <span class="keyword">private</span> <span class="keyword">final</span> Long id;  <span class="keyword">private</span> <span class="keyword">final</span> String message;  <span class="keyword">private</span> <span class="keyword">final</span> Date time;  <span class="keyword">private</span> Double latitude;  <span class="keyword">private</span> Double longitude;  <span class="function"><span class="keyword">public</span> <span class="title">Spittle</span><span class="params">(String message, Date time)</span> </span>&#123;    <span class="keyword">this</span>(<span class="keyword">null</span>, message, time, <span class="keyword">null</span>, <span class="keyword">null</span>);  &#125;    <span class="function"><span class="keyword">public</span> <span class="title">Spittle</span><span class="params">(Long id, String message, Date time, Double longitude, Double latitude)</span> </span>&#123;    <span class="keyword">this</span>.id = id;    <span class="keyword">this</span>.message = message;    <span class="keyword">this</span>.time = time;    <span class="keyword">this</span>.longitude = longitude;    <span class="keyword">this</span>.latitude = latitude;  &#125;  <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> id;  &#125;  <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> message;  &#125;  <span class="function"><span class="keyword">public</span> Date <span class="title">getTime</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> time;  &#125;    <span class="function"><span class="keyword">public</span> Double <span class="title">getLongitude</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> longitude;  &#125;    <span class="function"><span class="keyword">public</span> Double <span class="title">getLatitude</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> latitude;  &#125;    <span class="meta">@Override</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object that)</span> </span>&#123;    <span class="keyword">return</span> EqualsBuilder.reflectionEquals(<span class="keyword">this</span>, that, <span class="string">&quot;id&quot;</span>, <span class="string">&quot;time&quot;</span>);  &#125;    <span class="meta">@Override</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> HashCodeBuilder.reflectionHashCode(<span class="keyword">this</span>, <span class="string">&quot;id&quot;</span>, <span class="string">&quot;time&quot;</span>);  &#125;  &#125;</span><br></pre></td></tr></table></figure>

<p>å°±å¤§éƒ¨åˆ†å†…å®¹æ¥çœ‹ï¼ŒSpittle å°±æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ <code>POJO</code> æ•°æ®å¯¹è±¡â€”â€”æ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„ã€‚å”¯ä¸€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ Apache Common Lang åŒ…æ¥å®ç° <code>equals()</code> å’Œ <code>hashCode()</code> æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•é™¤äº†å¸¸è§„çš„ä½œç”¨ä»¥å¤–ï¼Œå½“æˆ‘ä»¬ä¸ºæ§åˆ¶å™¨çš„å¤„ç†å™¨æ–¹æ³•ç¼–å†™æµ‹è¯•æ—¶ï¼Œå®ƒä»¬ä¹Ÿæ˜¯æœ‰ç”¨çš„ã€‚</p>
<p>æ—¢ç„¶æˆ‘ä»¬è¯´åˆ°äº†æµ‹è¯•ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç»§ç»­è®¨è®ºè¿™ä¸ªè¯é¢˜å¹¶ä¸ºæ–°çš„æ§åˆ¶å™¨æ–¹æ³•ç¼–å†™æµ‹è¯•ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•ä½¿ç”¨ Spring çš„ <code>MockMvc</code> æ¥æ–­è¨€æ–°çš„å¤„ç†å™¨æ–¹æ³•ä¸­ä½ æ‰€æœŸæœ›çš„è¡Œä¸ºã€‚</p>
<center>ç¨‹åºæ¸…å• 5.9ã€€æµ‹è¯• SpittleController å¤„ç†é’ˆå¯¹ â€œ/spittlesâ€ çš„ GET è¯·æ±‚</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Testpublic</span> <span class="function"><span class="keyword">void</span> <span class="title">shouldShowRecentSpittles</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;  List&lt;Spittle&gt; expectedSpittles = createSpittleList(<span class="number">20</span>);  SpittleRepository mockRepository = mock(SpittleRepository.class);  when(mockRepository.findSpittles(Long.MAX_VALUE, <span class="number">20</span>))      .thenReturn(expectedSpittles);  SpittleController controller = <span class="keyword">new</span> SpittleController(mockRepository);  MockMvc mockMvc = standaloneSetup(controller)      .setSingleView(<span class="keyword">new</span> InternalResourceView(<span class="string">&quot;/WEB-INF/views/spittles.jsp&quot;</span>))      .build();  mockMvc.perform(get(<span class="string">&quot;/spittles&quot;</span>))     .andExpect(view().name(<span class="string">&quot;spittles&quot;</span>))     .andExpect(model().attributeExists(<span class="string">&quot;spittleList&quot;</span>))     .andExpect(model().attribute(<span class="string">&quot;spittleList&quot;</span>,                 hasItems(expectedSpittles.toArray())));&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæµ‹è¯•é¦–å…ˆä¼šåˆ›å»º <code>SpittleRepository</code> æ¥å£çš„mockå®ç°ï¼Œè¿™ä¸ªå®ç°ä¼šä»å®ƒçš„ <code>findSpittles()</code> æ–¹æ³•ä¸­è¿”å› 20 ä¸ª Spittle å¯¹è±¡ã€‚ç„¶åï¼Œå®ƒå°†è¿™ä¸ª Repository æ³¨å…¥åˆ°ä¸€ä¸ªæ–°çš„ <code>SpittleController</code> å®ä¾‹ä¸­ï¼Œç„¶ååˆ›å»º <code>MockMvc</code> å¹¶ä½¿ç”¨è¿™ä¸ªæ§åˆ¶å™¨ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ <code>HomeController</code> ä¸åŒï¼Œè¿™ä¸ªæµ‹è¯•åœ¨ <code>MockMvc</code> æ„é€ å™¨ä¸Šè°ƒç”¨äº† <code>setSingleView()</code>ã€‚è¿™æ ·çš„è¯ï¼Œmock æ¡†æ¶å°±ä¸ç”¨è§£ææ§åˆ¶å™¨ä¸­çš„è§†å›¾åäº†ã€‚åœ¨å¾ˆå¤šåœºæ™¯ä¸­ï¼Œå…¶å®æ²¡æœ‰å¿…è¦è¿™æ ·åšã€‚ä½†æ˜¯å¯¹äºè¿™ä¸ªæ§åˆ¶å™¨æ–¹æ³•ï¼Œè§†å›¾åä¸è¯·æ±‚è·¯å¾„æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œè¿™æ ·æŒ‰ç…§é»˜è®¤çš„è§†å›¾è§£æè§„åˆ™æ—¶ï¼Œ<code>MockMvc</code> å°±ä¼šå‘ç”Ÿå¤±è´¥ï¼Œå› ä¸ºæ— æ³•åŒºåˆ†è§†å›¾è·¯å¾„å’Œæ§åˆ¶å™¨çš„è·¯å¾„ã€‚åœ¨è¿™ä¸ªæµ‹è¯•ä¸­ï¼Œæ„å»º <code>InternalResourceView</code> æ—¶æ‰€è®¾ç½®çš„å®é™…è·¯å¾„æ˜¯æ— å…³ç´§è¦çš„ï¼Œä½†æˆ‘ä»¬å°†å…¶è®¾ç½®ä¸ºä¸ <code>InternalResourceViewResolver</code> é…ç½®ä¸€è‡´ã€‚</p>
<p>è¿™ä¸ªæµ‹è¯•å¯¹ â€œ/spittlesâ€ å‘èµ· GET è¯·æ±‚ï¼Œç„¶åæ–­è¨€è§†å›¾çš„åç§°ä¸º spittles å¹¶ä¸”æ¨¡å‹ä¸­åŒ…å«åä¸º <code>spittleList</code> çš„å±æ€§ï¼Œåœ¨ <code>spittleList</code> ä¸­åŒ…å«é¢„æœŸçš„å†…å®¹ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœæ­¤æ—¶è¿è¡Œæµ‹è¯•çš„è¯ï¼Œå®ƒå°†ä¼šå¤±è´¥ã€‚å®ƒä¸æ˜¯è¿è¡Œå¤±è´¥ï¼Œè€Œæ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šå¤±è´¥ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰ç¼–å†™ <code>SpittleController</code>ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åˆ›å»º <code>SpittleController</code>ï¼Œè®©å®ƒæ»¡è¶³ç¨‹åºæ¸…å• 5.9 çš„é¢„æœŸã€‚å¦‚ä¸‹çš„ <code>SpittleController</code> å®ç°å°†ä¼šæ»¡è¶³ä»¥ä¸Šæµ‹è¯•çš„è¦æ±‚ã€‚</p>
<center>ç¨‹åºæ¸…å• 5.10ã€€SpittleControllerï¼šåœ¨æ¨¡å‹ä¸­æ”¾å…¥æœ€æ–°çš„ spittle åˆ—è¡¨</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.web;<span class="keyword">import</span> java.util.Date;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.stereotype.Controller;<span class="keyword">import</span> org.springframework.ui.Model;<span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;<span class="keyword">import</span> spittr.Spittle;<span class="keyword">import</span> spittr.data.SpittleRepository;<span class="meta">@Controller</span><span class="meta">@RequestMapping(&quot;/spittles&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpittleController</span> </span>&#123;    <span class="keyword">private</span> SpittleRepository spittleRepository;  <span class="meta">@Autowired</span>  <span class="function"><span class="keyword">public</span> <span class="title">SpittleController</span><span class="params">(SpittleRepository spittleRepository)</span> </span>&#123;    <span class="keyword">this</span>.spittleRepository = spittleRepository;  &#125;  <span class="meta">@RequestMapping(method=RequestMethod.GET)</span>  <span class="function"><span class="keyword">public</span> String <span class="title">spittles</span><span class="params">(Model model)</span> </span>&#123;    model.addAttribute(spittleRepository.findSpittles(Long.MAX_VALUE, <span class="number">20</span>);    <span class="keyword">return</span> <span class="string">&quot;spittles&quot;</span>;  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>SpittleController</code> æœ‰ä¸€ä¸ªæ„é€ å™¨ï¼Œè¿™ä¸ªæ„é€ å™¨ä½¿ç”¨äº† <code>@Autowired</code> æ³¨è§£ï¼Œç”¨æ¥æ³¨å…¥ <code>SpittleRepository</code>ã€‚è¿™ä¸ª <code>SpittleRepository</code> éšååˆç”¨åœ¨ <code>spittles()</code> æ–¹æ³•ä¸­ï¼Œç”¨æ¥è·å–æœ€æ–°çš„ spittle åˆ—è¡¨ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨ <code>spittles()</code> æ–¹æ³•ä¸­ç»™å®šäº†ä¸€ä¸ª <code>Model</code> ä½œä¸ºå‚æ•°ã€‚è¿™æ ·ï¼Œ<code>spittles()</code> æ–¹æ³•å°±èƒ½å°† <code>Repository</code> ä¸­è·å–åˆ°çš„ <code>Spittle</code> åˆ—è¡¨å¡«å……åˆ°æ¨¡å‹ä¸­ã€‚<code>Model</code> å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª Mapï¼ˆä¹Ÿå°±æ˜¯ key-value å¯¹çš„é›†åˆï¼‰ï¼Œå®ƒä¼šä¼ é€’ç»™è§†å›¾ï¼Œè¿™æ ·æ•°æ®å°±èƒ½æ¸²æŸ“åˆ°å®¢æˆ·ç«¯äº†ã€‚å½“è°ƒç”¨ <code>addAttribute()</code> æ–¹æ³•å¹¶ä¸”ä¸æŒ‡å®š key çš„æ—¶å€™ï¼Œé‚£ä¹ˆkey ä¼šæ ¹æ®å€¼çš„å¯¹è±¡ç±»å‹æ¨æ–­ç¡®å®šã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ª <code>List&lt;Spittle&gt;</code>ï¼Œå› æ­¤ï¼Œé”®å°†ä¼šæ¨æ–­ä¸º <code>spittleList</code>ã€‚</p>
<p><code>spittles()</code> æ–¹æ³•æ‰€åšçš„æœ€åä¸€ä»¶äº‹æ˜¯è¿”å› <code>spittles</code> ä½œä¸ºè§†å›¾çš„åå­—ï¼Œè¿™ä¸ªè§†å›¾ä¼šæ¸²æŸ“æ¨¡å‹ã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›æ˜¾å¼å£°æ˜æ¨¡å‹çš„ key çš„è¯ï¼Œé‚£ä¹Ÿå°½å¯ä»¥è¿›è¡ŒæŒ‡å®šã€‚ä¾‹å¦‚ï¼Œä¸‹é¢è¿™ä¸ªç‰ˆæœ¬çš„ spittles() æ–¹æ³•ä¸ç¨‹åºæ¸…å• 5.10 ä¸­çš„æ–¹æ³•ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(method=RequestMethod.GET)</span><span class="function"><span class="keyword">public</span> String <span class="title">spittles</span><span class="params">(Model model)</span> </span>&#123;    model.addAttribute(<span class="string">&quot;spittleList&quot;</span>, spittleRepository.findSpittles(Long.MAX_VALUE, <span class="number">20</span>));    <span class="keyword">return</span> <span class="string">&quot;spittles&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ å¸Œæœ›ä½¿ç”¨é Spring ç±»å‹çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ <code>java.util.Map</code> æ¥ä»£æ›¿ Modelã€‚ä¸‹é¢è¿™ä¸ªç‰ˆæœ¬çš„ spittles() æ–¹æ³•ä¸ä¹‹å‰çš„ç‰ˆæœ¬åœ¨åŠŸèƒ½ä¸Šæ˜¯ä¸€æ ·çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(method=RequestMethod.GET)</span><span class="function"><span class="keyword">public</span> String <span class="title">spittles</span><span class="params">(Map model)</span> </span>&#123;    model.put(<span class="string">&quot;spittleList&quot;</span>, spittleRepository.findSpittles(Long.MAX_VALUE, <span class="number">20</span>));    <span class="keyword">return</span> <span class="string">&quot;spittles&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>æ—¢ç„¶æˆ‘ä»¬ç°åœ¨æåˆ°äº†å„ç§å¯æ›¿ä»£çš„æ–¹æ¡ˆï¼Œé‚£ä¸‹é¢è¿˜æœ‰å¦å¤–ä¸€ç§æ–¹å¼æ¥ç¼–å†™ spittles() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(method=RequestMethod.GET)</span><span class="function"><span class="keyword">public</span> List&lt;Spittle&gt; <span class="title">spittles</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> spittleRepository.findSpittles(Long.MAX_VALUE, <span class="number">20</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç‰ˆæœ¬ä¸å…¶ä»–çš„ç‰ˆæœ¬æœ‰äº›å·®åˆ«ã€‚å®ƒå¹¶æ²¡æœ‰è¿”å›è§†å›¾åç§°ï¼Œä¹Ÿæ²¡æœ‰æ˜¾å¼åœ°è®¾å®šæ¨¡å‹ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯ Spittle åˆ—è¡¨ã€‚å½“å¤„ç†å™¨æ–¹æ³•åƒè¿™æ ·è¿”å›å¯¹è±¡æˆ–é›†åˆæ—¶ï¼Œè¿™ä¸ªå€¼ä¼šæ”¾åˆ°æ¨¡å‹ä¸­ï¼Œæ¨¡å‹çš„ key ä¼šæ ¹æ®å…¶ç±»å‹æ¨æ–­å¾—å‡ºï¼ˆåœ¨æœ¬ä¾‹ä¸­ï¼Œä¹Ÿå°±æ˜¯ spittleListï¼‰ã€‚</p>
<p>è€Œé€»è¾‘è§†å›¾çš„åç§°å°†ä¼šæ ¹æ®è¯·æ±‚è·¯å¾„æ¨æ–­å¾—å‡ºã€‚å› ä¸ºè¿™ä¸ªæ–¹æ³•å¤„ç†é’ˆå¯¹ â€œ/spittlesâ€ çš„ GET è¯·æ±‚ï¼Œå› æ­¤è§†å›¾çš„åç§°å°†ä¼šæ˜¯ spittlesï¼ˆå»æ‰å¼€å¤´çš„æ–œçº¿ï¼‰ã€‚</p>
<p>ä¸ç®¡ä½ é€‰æ‹©å“ªç§æ–¹å¼æ¥ç¼–å†™ spittles() æ–¹æ³•ï¼Œæ‰€è¾¾æˆçš„ç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚æ¨¡å‹ä¸­ä¼šå­˜å‚¨ä¸€ä¸ª Spittle åˆ—è¡¨ï¼Œkey ä¸º spittleListï¼Œç„¶åè¿™ä¸ªåˆ—è¡¨ä¼šå‘é€åˆ°åä¸º spittles çš„è§†å›¾ä¸­ã€‚æŒ‰ç…§æˆ‘ä»¬é…ç½® InternalResourceViewResolverçš„æ–¹å¼ï¼Œè§†å›¾çš„ JSP å°†ä¼šæ˜¯ â€œ/WEB-INF/views/spittles.jspâ€ã€‚</p>
<p>ç°åœ¨ï¼Œæ•°æ®å·²ç»æ”¾åˆ°äº†æ¨¡å‹ä¸­ï¼Œåœ¨ <code>JSP</code> ä¸­è¯¥å¦‚ä½•è®¿é—®å®ƒå‘¢ï¼Ÿå®é™…ä¸Šï¼Œå½“è§†å›¾æ˜¯ <code>JSP</code> çš„æ—¶å€™ï¼Œæ¨¡å‹æ•°æ®ä¼šä½œä¸ºè¯·æ±‚å±æ€§æ”¾åˆ°è¯·æ±‚ï¼ˆrequestï¼‰ä¹‹ä¸­ã€‚å› æ­¤ï¼Œåœ¨ <code>spittles.jsp</code> æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨ <code>JST</code>Lï¼ˆJava Server Pages Standard Tag Libraryï¼‰çš„ <code>&lt;c:forEach&gt;</code> æ ‡ç­¾æ¸²æŸ“ spittle åˆ—è¡¨ï¼š</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">&quot;$&#123;spittleList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;spittle&quot;</span> &gt;  &lt;li id=<span class="string">&quot;spittle_&lt;c:out value=&quot;</span>spittle.id<span class="string">&quot;/&gt;&quot;</span>&gt;    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;spittleMessage&quot;</span>&gt;&lt;c:out value=<span class="string">&quot;$&#123;spittle.message&#125;&quot;</span> /&gt;&lt;/div&gt;    &lt;div&gt;      &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;spittleTime&quot;</span>&gt;&lt;c:out value=<span class="string">&quot;$&#123;spittle.time&#125;&quot;</span> /&gt;&lt;/span&gt;      &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;spittleLocation&quot;</span>&gt;(&lt;c:out value=<span class="string">&quot;$&#123;spittle.latitude&#125;&quot;</span> /&gt;, &lt;c:out value=<span class="string">&quot;$&#123;spittle.longitude&#125;&quot;</span> /&gt;)&lt;/span&gt;    &lt;/div&gt;  &lt;/li&gt;&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<p>å›¾ 5.3 ä¸ºæ˜¾ç¤ºæ•ˆæœï¼Œèƒ½å¤Ÿè®©ä½ å¯¹å®ƒåœ¨ Web æµè§ˆå™¨ä¸­æ˜¯ä»€ä¹ˆæ ·å­æœ‰ä¸ªå¯è§†åŒ–çš„å°è±¡ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211022100737079.png" alt="image-20211022100737079"></p>
<center>å›¾ 5.3ã€€æ§åˆ¶å™¨ä¸­çš„ Spittle æ¨¡å‹æ•°æ®å°†ä¼šä½œä¸ºè¯·æ±‚å‚æ•°ï¼Œå¹¶åœ¨Webé¡µé¢ä¸Šæ¸²æŸ“ä¸ºåˆ—
    è¡¨çš„å½¢å¼</center>


<p>å°½ç®¡ <code>SpittleController</code> å¾ˆç®€å•ï¼Œä½†æ˜¯å®ƒä¾ç„¶æ¯” <code>HomeController</code> æ›´è¿›ä¸€æ­¥äº†ã€‚ä¸è¿‡ï¼Œ<code>SpittleController</code> å’Œ <code>HomeController</code> éƒ½æ²¡æœ‰å¤„ç†ä»»ä½•å½¢å¼çš„è¾“å…¥ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ‰©å±• <code>SpittleController</code>ï¼Œè®©å®ƒä»å®¢æˆ·ç«¯æ¥å—ä¸€äº›è¾“å…¥ã€‚</p>
<h3 id="æ¥å—è¯·æ±‚çš„è¾“å…¥"><a href="#æ¥å—è¯·æ±‚çš„è¾“å…¥" class="headerlink" title="æ¥å—è¯·æ±‚çš„è¾“å…¥"></a>æ¥å—è¯·æ±‚çš„è¾“å…¥</h3><p>æœ‰äº› Web åº”ç”¨æ˜¯åªè¯»çš„ã€‚äººä»¬åªèƒ½é€šè¿‡æµè§ˆå™¨åœ¨ç«™ç‚¹ä¸Šé—²é€›ï¼Œé˜…è¯»æœåŠ¡å™¨å‘é€åˆ°æµè§ˆå™¨ä¸­çš„å†…å®¹ã€‚ä¸è¿‡ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ã€‚ä¼—å¤šçš„ Web åº”ç”¨å…è®¸ç”¨æˆ·å‚ä¸è¿›å»ï¼Œå°†æ•°æ®å‘é€å›æœåŠ¡å™¨ã€‚å¦‚æœæ²¡æœ‰è¿™é¡¹èƒ½åŠ›çš„è¯ï¼Œé‚£ Web å°†å®Œå…¨æ˜¯å¦ä¸€ç•ªæ™¯è±¡ã€‚</p>
<p>Spring MVC å…è®¸ä»¥å¤šç§æ–¹å¼å°†å®¢æˆ·ç«¯ä¸­çš„æ•°æ®ä¼ é€åˆ°æ§åˆ¶å™¨çš„å¤„ç†å™¨æ–¹æ³•ä¸­ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>æŸ¥è¯¢å‚æ•°ï¼ˆQuery Parameterï¼‰ã€‚</li>
<li>è¡¨å•å‚æ•°ï¼ˆForm Parameterï¼‰ã€‚</li>
<li>è·¯å¾„å˜é‡ï¼ˆPath Variableï¼‰ã€‚</li>
</ul>
<p>ä½ å°†ä¼šçœ‹åˆ°å¦‚ä½•ç¼–å†™æ§åˆ¶å™¨å¤„ç†è¿™äº›ä¸åŒæœºåˆ¶çš„è¾“å…¥ã€‚ä½œä¸ºå¼€å§‹ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å¦‚ä½•å¤„ç†å¸¦æœ‰æŸ¥è¯¢å‚æ•°çš„è¯·æ±‚ï¼Œè¿™ä¹Ÿæ˜¯å®¢æˆ·ç«¯å¾€æœåŠ¡å™¨ç«¯å‘é€æ•°æ®æ—¶ï¼Œæœ€ç®€å•å’Œæœ€ç›´æ¥çš„æ–¹å¼ã€‚</p>
<h4 id="å¤„ç†æŸ¥è¯¢å‚æ•°"><a href="#å¤„ç†æŸ¥è¯¢å‚æ•°" class="headerlink" title="å¤„ç†æŸ¥è¯¢å‚æ•°"></a>å¤„ç†æŸ¥è¯¢å‚æ•°</h4><p>åœ¨ <code>Spittr</code> åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¤„ç†çš„ä¸€ä»¶äº‹å°±æ˜¯å±•ç°åˆ†é¡µçš„ Spittle åˆ—è¡¨ã€‚åœ¨ç°åœ¨çš„ <code>SpittleController</code> ä¸­ï¼Œå®ƒåªèƒ½å±•ç°æœ€æ–°çš„ <code>Spittle</code>ï¼Œå¹¶æ²¡æœ‰åŠæ³•å‘å‰ç¿»é¡µæŸ¥çœ‹ä»¥å‰ç¼–å†™çš„ <code>Spittle</code> å†å²è®°å½•ã€‚å¦‚æœä½ æƒ³è®©ç”¨æˆ·æ¯æ¬¡éƒ½èƒ½æŸ¥çœ‹æŸä¸€é¡µçš„ <code>Spittle</code> å†å²ï¼Œé‚£ä¹ˆå°±éœ€è¦æä¾›ä¸€ç§æ–¹å¼è®©ç”¨æˆ·ä¼ é€’å‚æ•°è¿›æ¥ï¼Œè¿›è€Œç¡®å®šè¦å±•ç°å“ªäº› Spittle é›†åˆã€‚</p>
<p>åœ¨ç¡®å®šè¯¥å¦‚ä½•å®ç°æ—¶ï¼Œå‡è®¾æˆ‘ä»¬è¦æŸ¥çœ‹æŸä¸€é¡µ <code>Spittle</code> åˆ—è¡¨ï¼Œè¿™ä¸ªåˆ—è¡¨ä¼šæŒ‰ç…§æœ€æ–°çš„ <code>Spittle</code> åœ¨å‰çš„æ–¹å¼è¿›è¡Œæ’åºã€‚å› æ­¤ï¼Œä¸‹ä¸€é¡µä¸­ç¬¬ä¸€æ¡çš„ ID è‚¯å®šä¼šæ—©äºå½“å‰é¡µæœ€åä¸€æ¡çš„ IDã€‚æ‰€ä»¥ï¼Œä¸ºäº†æ˜¾ç¤ºä¸‹ä¸€é¡µçš„ <code>Spittle</code>ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ª <code>Spittle</code> çš„ ID ä¼ å…¥è¿›æ¥ï¼Œè¿™ä¸ª ID è¦æ°å¥½å°äºå½“å‰é¡µæœ€åä¸€æ¡ Spittle çš„ IDã€‚å¦å¤–ï¼Œä½ è¿˜å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‚æ•°æ¥ç¡®å®šè¦å±•ç°çš„ Spittle æ•°é‡ã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸ªåˆ†é¡µçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬æ‰€ç¼–å†™çš„å¤„ç†å™¨æ–¹æ³•è¦æ¥å—å¦‚ä¸‹çš„å‚æ•°ï¼š</p>
<ul>
<li>before å‚æ•°ï¼ˆè¡¨æ˜ç»“æœä¸­æ‰€æœ‰ Spittle çš„ID å‡åº”è¯¥åœ¨è¿™ä¸ªå€¼ä¹‹å‰ï¼‰ã€‚</li>
<li>count å‚æ•°ï¼ˆè¡¨æ˜åœ¨ç»“æœä¸­è¦åŒ…å«çš„ Spittle æ•°é‡ï¼‰ã€‚</li>
</ul>
<p>ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å°†ç¨‹åºæ¸…å• 5.10 ä¸­çš„ spittles() æ–¹æ³•æ›¿æ¢ä¸ºä½¿ç”¨ before å’Œ count å‚æ•°çš„æ–° spittles() æ–¹æ³•ã€‚æˆ‘ä»¬é¦–å…ˆæ·»åŠ ä¸€ä¸ªæµ‹è¯•ï¼Œè¿™ä¸ªæµ‹è¯•åæ˜ äº†æ–° spittles() æ–¹æ³•çš„åŠŸèƒ½ã€‚</p>
<center>ç¨‹åºæ¸…å• 5.11ã€€ç”¨æ¥æµ‹è¯•åˆ†é¡µ Spittle åˆ—è¡¨çš„æ–°æ–¹æ³•</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Testpublic</span> <span class="function"><span class="keyword">void</span> <span class="title">shouldShowPagedSpittles</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;  List&lt;Spittle&gt; expectedSpittles = createSpittleList(<span class="number">50</span>);  SpittleRepository mockRepository = mock(SpittleRepository.class);  when(mockRepository.findSpittles(<span class="number">238900</span>, <span class="number">50</span>)) <span class="comment">// é¢„æœŸçš„ max å’Œ count å‚æ•°      .thenReturn(expectedSpittles);    SpittleController controller = new SpittleController(mockRepository);  MockMvc mockMvc = standaloneSetup(controller)      .setSingleView(new InternalResourceView(&quot;/WEB-INF/views/spittles.jsp&quot;))      .build();  mockMvc.perform(get(&quot;/spittles?max=238900&amp;count=50&quot;)) // ä¼ å…¥ max å’Œ count å‚æ•°    .andExpect(view().name(&quot;spittles&quot;))    .andExpect(model().attributeExists(&quot;spittleList&quot;))    .andExpect(model().attribute(&quot;spittleList&quot;,                hasItems(expectedSpittles.toArray())));&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæµ‹è¯•æ–¹æ³•ä¸ç¨‹åºæ¸…å• 5.9 ä¸­çš„æµ‹è¯•æ–¹æ³•å…³é”®åŒºåˆ«åœ¨äºå®ƒé’ˆå¯¹ â€œ/spittlesâ€ å‘é€ GET è¯·æ±‚ï¼ŒåŒæ—¶è¿˜ä¼ å…¥äº† max å’Œ count å‚æ•°ã€‚å®ƒæµ‹è¯•äº†è¿™äº›å‚æ•°å­˜åœ¨æ—¶çš„å¤„ç†å™¨æ–¹æ³•ï¼Œè€Œå¦ä¸€ä¸ªæµ‹è¯•æ–¹æ³•åˆ™æµ‹è¯•äº†æ²¡æœ‰è¿™äº›å‚æ•°æ—¶çš„æƒ…æ™¯ã€‚è¿™ä¸¤ä¸ªæµ‹è¯•å°±ç»ªåï¼Œæˆ‘ä»¬å°±èƒ½ç¡®ä¿ä¸ç®¡æ§åˆ¶å™¨å‘ç”Ÿä»€ä¹ˆæ ·çš„å˜åŒ–ï¼Œå®ƒéƒ½èƒ½å¤Ÿå¤„ç†è¿™ä¸¤ç§ç±»å‹çš„è¯·æ±‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(method=RequestMethod.GET)</span><span class="function"><span class="keyword">public</span> List&lt;Spittle&gt; <span class="title">spittles</span><span class="params">(    <span class="meta">@RequestParam(&quot;max&quot;)</span> <span class="keyword">long</span> max,    <span class="meta">@RequestParam(&quot;count&quot;)</span> <span class="keyword">int</span> count)</span> </span>&#123;  <span class="keyword">return</span> spittleRepository.findSpittles(max, count);&#125;</span><br></pre></td></tr></table></figure>

<p><code>SpittleController</code> ä¸­çš„å¤„ç†å™¨æ–¹æ³•è¦åŒæ—¶å¤„ç†æœ‰å‚æ•°å’Œæ²¡æœ‰å‚æ•°çš„åœºæ™¯ï¼Œé‚£æˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œè®©å®ƒèƒ½æ¥å—å‚æ•°ï¼ŒåŒæ—¶ï¼Œå¦‚æœè¿™äº›å‚æ•°åœ¨è¯·æ±‚ä¸­ä¸å­˜åœ¨çš„è¯ï¼Œå°±ä½¿ç”¨é»˜è®¤å€¼ <code>Long.MAX_VALUE</code> å’Œ 20ã€‚<code>@RequestParam</code> æ³¨è§£çš„<code> defaultValue</code> å±æ€§å¯ä»¥å®Œæˆè¿™é¡¹ä»»åŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(method=RequestMethod.GET)</span><span class="function"><span class="keyword">public</span> List&lt;Spittle&gt; <span class="title">spittles</span><span class="params">(    <span class="meta">@RequestParam(value=&quot;max&quot;, defaultValue=MAX_LONG_AS_STRING)</span> <span class="keyword">long</span> max,    <span class="meta">@RequestParam(value=&quot;count&quot;, defaultValue=&quot;20&quot;)</span> <span class="keyword">int</span> count)</span> </span>&#123;  <span class="keyword">return</span> spittleRepository.findSpittles(max, count);&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œå¦‚æœ max å‚æ•°æ²¡æœ‰æŒ‡å®šçš„è¯ï¼Œå®ƒå°†ä¼šæ˜¯ Long ç±»å‹çš„æœ€å¤§å€¼ã€‚å› ä¸ºæŸ¥è¯¢å‚æ•°éƒ½æ˜¯ String ç±»å‹çš„ï¼Œå› æ­¤ <code>defaultValue</code> å±æ€§éœ€è¦ String ç±»å‹çš„å€¼ã€‚å› æ­¤ï¼Œä½¿ç”¨ <code>Long.MAX_VALUE</code> æ˜¯ä¸è¡Œçš„ã€‚æˆ‘ä»¬å¯ä»¥å°†<code> Long.MAX_VALUE</code> è½¬æ¢ä¸ºåä¸º <code>MAX_LONG_AS_STRING</code> çš„ String ç±»å‹å¸¸é‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String MAX_LONG_AS_STRING = Long.toString(Long.MAX_VALUE);</span><br></pre></td></tr></table></figure>

<p>å°½ç®¡ <code>defaultValue</code> å±æ€§ç»™å®šçš„æ˜¯ String ç±»å‹çš„å€¼ï¼Œä½†æ˜¯å½“ç»‘å®šåˆ°æ–¹æ³•çš„ max å‚æ•°æ—¶ï¼Œå®ƒä¼šè½¬æ¢ä¸º Long ç±»å‹ã€‚</p>
<p>å¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰ count å‚æ•°çš„è¯ï¼Œcount å‚æ•°çš„é»˜è®¤å€¼å°†ä¼šè®¾ç½®ä¸º 20ã€‚</p>
<p>è¯·æ±‚ä¸­çš„æŸ¥è¯¢å‚æ•°æ˜¯å¾€æ§åˆ¶å™¨ä¸­ä¼ é€’ä¿¡æ¯çš„å¸¸ç”¨æ‰‹æ®µã€‚å¦å¤–ä¸€ç§æ–¹å¼ä¹Ÿå¾ˆæµè¡Œï¼Œå°¤å…¶æ˜¯åœ¨æ„å»ºé¢å‘èµ„æºçš„æ§åˆ¶å™¨æ—¶ï¼Œè¿™ç§æ–¹å¼å°±æ˜¯å°†ä¼ é€’å‚æ•°ä½œä¸ºè¯·æ±‚è·¯å¾„çš„ä¸€éƒ¨åˆ†ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•å°†è·¯å¾„å˜é‡ä½œä¸ºè¯·æ±‚è·¯å¾„çš„ä¸€éƒ¨åˆ†ï¼Œä»è€Œå®ç°ä¿¡æ¯çš„è¾“å…¥ã€‚</p>
<h4 id="é€šè¿‡è·¯å¾„å‚æ•°æ¥å—è¾“å…¥"><a href="#é€šè¿‡è·¯å¾„å‚æ•°æ¥å—è¾“å…¥" class="headerlink" title="é€šè¿‡è·¯å¾„å‚æ•°æ¥å—è¾“å…¥"></a>é€šè¿‡è·¯å¾„å‚æ•°æ¥å—è¾“å…¥</h4><p>å‡è®¾æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéœ€è¦æ ¹æ®ç»™å®šçš„ ID æ¥å±•ç°æŸä¸€ä¸ª Spittle è®°å½•ã€‚å…¶ä¸­ä¸€ç§æ–¹æ¡ˆå°±æ˜¯ç¼–å†™å¤„ç†å™¨æ–¹æ³•ï¼Œé€šè¿‡ä½¿ç”¨ <code>@RequestParam</code> æ³¨è§£ï¼Œè®©å®ƒæ¥å— ID ä½œä¸ºæŸ¥è¯¢å‚æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/show&quot;, method=RequestMethod.GET)</span><span class="function"><span class="keyword">public</span> String <span class="title">spittle</span><span class="params">(    <span class="meta">@RequestParam(&quot;spittle_id&quot;)</span> <span class="keyword">long</span> spittleId,     Model model)</span> </span>&#123;  model.addAttribute(spittleRepository.findOne(spittleId));  <span class="keyword">return</span> <span class="string">&quot;spittle&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå¤„ç†å™¨æ–¹æ³•å°†ä¼šå¤„ç†å½¢å¦‚ â€œ/spittles/show?spittle_id=12345â€ è¿™æ ·çš„è¯·æ±‚ã€‚å°½ç®¡è¿™ä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯ä»é¢å‘èµ„æºçš„è§’åº¦æ¥çœ‹è¿™å¹¶ä¸ç†æƒ³ã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œè¦è¯†åˆ«çš„èµ„æºï¼ˆSpittleï¼‰åº”è¯¥é€šè¿‡ URL è·¯å¾„è¿›è¡Œæ ‡ç¤ºï¼Œè€Œä¸æ˜¯é€šè¿‡æŸ¥è¯¢å‚æ•°ã€‚å¯¹ â€œ/spittles/12345â€ å‘èµ· GET è¯·æ±‚è¦ä¼˜äºå¯¹ â€œ/spittles/show?spittle_id=12345â€ å‘èµ·è¯·æ±‚ã€‚å‰è€…èƒ½å¤Ÿè¯†åˆ«å‡ºè¦æŸ¥è¯¢çš„èµ„æºï¼Œè€Œåè€…æè¿°çš„æ˜¯å¸¦æœ‰å‚æ•°çš„ä¸€ä¸ªæ“ä½œâ€”â€”æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ HTTP å‘èµ·çš„RPCã€‚</p>
<p>æ—¢ç„¶å·²ç»ä»¥é¢å‘èµ„æºçš„æ§åˆ¶å™¨ä½œä¸ºç›®æ ‡ï¼Œé‚£æˆ‘ä»¬å°†è¿™ä¸ªéœ€æ±‚è½¬æ¢ä¸ºä¸€ä¸ªæµ‹è¯•ã€‚ç¨‹åºæ¸…å• 5.12 å±•ç°äº†ä¸€ä¸ªæ–°çš„æµ‹è¯•æ–¹æ³•ï¼Œå®ƒä¼šæ–­è¨€ <code>SpittleController</code> ä¸­å¯¹é¢å‘èµ„æºè¯·æ±‚çš„å¤„ç†ã€‚</p>
<center>ç¨‹åºæ¸…å• 5.12ã€€æµ‹è¯•å¯¹æŸä¸ª Spittle çš„è¯·æ±‚ï¼Œå…¶ä¸­ ID è¦åœ¨è·¯å¾„å˜é‡ä¸­æŒ‡å®š</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Testpublic</span> <span class="function"><span class="keyword">void</span> <span class="title">testSpittle</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;    Spittle expectedSpittle = <span class="keyword">new</span> Spittle(<span class="string">&quot;Hello&quot;</span>, <span class="keyword">new</span> Date());    SpittleRepository mockRepository = mock(SpittleRepository.class);    when(mockRepository.findOne(<span class="number">12345</span>)).thenReturn(expectedSpittle);    SpittleController controller = <span class="keyword">new</span> SpittleController(mockRepository);    MockMvc mockMvc = standaloneSetup(controller).build();    mockMvc.perform(get(<span class="string">&quot;/spittles/12345&quot;</span>))        .andExpect(view().name(<span class="string">&quot;spittle&quot;</span>))        .andExpect(model().attributeExists(<span class="string">&quot;spittle&quot;</span>))        .andExpect(model().attribute(<span class="string">&quot;spittle&quot;</span>, expectedSpittle));&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæµ‹è¯•æ„å»ºäº†ä¸€ä¸ª mock Repositoryã€ä¸€ä¸ªæ§åˆ¶å™¨å’Œ <code>MockMvc</code>ï¼Œè¿™ä¸æœ¬ç« ä¸­æˆ‘ä»¬æ‰€ç¼–å†™çš„å…¶ä»–æµ‹è¯•å¾ˆç±»ä¼¼ã€‚è¿™ä¸ªæµ‹è¯•ä¸­æœ€é‡è¦çš„éƒ¨åˆ†æ˜¯æœ€åå‡ è¡Œï¼Œå®ƒå¯¹ â€œ/spittles/12345â€ å‘èµ· GET è¯·æ±‚ï¼Œç„¶åæ–­è¨€è§†å›¾çš„åç§°æ˜¯ spittleï¼Œå¹¶ä¸”é¢„æœŸçš„ Spittle å¯¹è±¡æ”¾åˆ°äº†æ¨¡å‹ä¹‹ä¸­ã€‚å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰ä¸ºè¿™ç§è¯·æ±‚å®ç°å¤„ç†å™¨æ–¹æ³•ï¼Œå› æ­¤è¿™ä¸ªè¯·æ±‚å°†ä¼šå¤±è´¥ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸º <code>SpittleController</code> æ·»åŠ æ–°çš„æ–¹æ³•æ¥ä¿®æ­£è¿™ä¸ªå¤±è´¥çš„æµ‹è¯•ã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåœ¨æˆ‘ä»¬ç¼–å†™çš„æ§åˆ¶å™¨ä¸­ï¼Œæ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜ å°„åˆ°äº†ï¼ˆé€šè¿‡ <code>@RequestMapping</code>ï¼‰é™æ€å®šä¹‰å¥½çš„è·¯å¾„ä¸Šã€‚ä½†æ˜¯ï¼Œå¦‚æœæƒ³è®©è¿™ä¸ªæµ‹è¯•é€šè¿‡çš„è¯ï¼Œæˆ‘ä»¬ç¼–å†™çš„ <code>@RequestMapping</code> è¦åŒ…å«å˜é‡éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†ä»£è¡¨äº† Spittle IDã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ç§è·¯å¾„å˜é‡ï¼Œ<code>Spring MVC</code> å…è®¸æˆ‘ä»¬åœ¨ <code>@RequestMapping</code> è·¯å¾„ä¸­æ·»åŠ å ä½ç¬¦ã€‚å ä½ç¬¦çš„åç§°è¦ç”¨å¤§æ‹¬å·ï¼ˆâ€œ{â€ å’Œ â€œ}â€ï¼‰æ‹¬èµ·æ¥ã€‚è·¯å¾„ä¸­çš„å…¶ä»–éƒ¨åˆ†è¦ä¸æ‰€å¤„ç†çš„è¯·æ±‚å®Œå…¨åŒ¹é…ï¼Œä½†æ˜¯å ä½ç¬¦éƒ¨åˆ†å¯ä»¥æ˜¯ä»»æ„çš„å€¼ã€‚</p>
<p>ä¸‹é¢çš„å¤„ç†å™¨æ–¹æ³•ä½¿ç”¨äº†å ä½ç¬¦ï¼Œå°† Spittle ID ä½œä¸ºè·¯å¾„çš„ä¸€éƒ¨åˆ†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/&#123;spittleId&#125;&quot;, method=RequestMethod.GET)</span><span class="function"><span class="keyword">public</span> String <span class="title">spittle</span><span class="params">(    <span class="meta">@PathVariable(&quot;spittleId&quot;)</span> <span class="keyword">long</span> spittleId,     Model model)</span> </span>&#123;  model.addAttribute(spittleRepository.findOne(spittleId));  <span class="keyword">return</span> <span class="string">&quot;spittle&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼Œå®ƒå°±èƒ½å¤Ÿå¤„ç†é’ˆå¯¹ â€œ/spittles/12345â€ çš„è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯ç¨‹åºæ¸…å• 5.12 ä¸­çš„è·¯å¾„æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œspittle() æ–¹æ³•çš„ <code>spittleId</code> å‚æ•°ä¸Šæ·»åŠ äº† <code>@PathVariable(&quot;spittleId&quot;)</code> æ³¨è§£ï¼Œè¿™è¡¨æ˜åœ¨è¯·æ±‚è·¯å¾„ä¸­ï¼Œä¸ç®¡å ä½ç¬¦éƒ¨åˆ†çš„å€¼æ˜¯ä»€ä¹ˆéƒ½ä¼šä¼ é€’åˆ°å¤„ç†å™¨æ–¹æ³•çš„ <code>spittleId</code> å‚æ•°ä¸­ã€‚å¦‚æœå¯¹ <code>â€œ/spittles/54321â€</code> å‘é€ GET è¯·æ±‚ï¼Œé‚£ä¹ˆå°†ä¼šæŠŠ â€œ54321â€ ä¼ é€’è¿›æ¥ï¼Œä½œä¸º <code>spittleId</code> çš„å€¼ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨æ ·ä¾‹ä¸­ <code>spittleId</code> è¿™ä¸ªè¯å‡ºç°äº†å¥½å‡ æ¬¡ï¼šå…ˆæ˜¯åœ¨ <code>@RequestMapping</code> çš„è·¯å¾„ä¸­ï¼Œç„¶åä½œä¸º <code>@PathVariable</code> å±æ€§çš„å€¼ï¼Œæœ€ååˆä½œä¸ºæ–¹æ³•çš„å‚æ•°åç§°ã€‚å› ä¸ºæ–¹æ³•çš„å‚æ•°åç¢°å·§ä¸å ä½ç¬¦çš„åç§°ç›¸åŒï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å»æ‰ <code>@PathVariable</code> ä¸­çš„ value å±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/&#123;spittleId&#125;&quot;, method=RequestMethod.GET)</span><span class="function"><span class="keyword">public</span> String <span class="title">spittle</span><span class="params">(<span class="meta">@PathVariable</span> <span class="keyword">long</span> spittleId, Model model)</span> </span>&#123;  model.addAttribute(spittleRepository.findOne(spittleId));  <span class="keyword">return</span> <span class="string">&quot;spittle&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ <code>@PathVariable</code> ä¸­æ²¡æœ‰ value å±æ€§çš„è¯ï¼Œå®ƒä¼šå‡è®¾å ä½ç¬¦çš„åç§°ä¸æ–¹æ³•çš„å‚æ•°åç›¸åŒã€‚è¿™èƒ½å¤Ÿè®©ä»£ç ç¨å¾®ç®€æ´ä¸€äº›ï¼Œå› ä¸ºä¸å¿…é‡å¤å†™å ä½ç¬¦çš„åç§°äº†ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ æƒ³è¦é‡å‘½åå‚æ•°æ—¶ï¼Œå¿…é¡»è¦åŒæ—¶ä¿®æ”¹å ä½ç¬¦çš„åç§°ï¼Œä½¿å…¶äº’ç›¸åŒ¹é…ã€‚</p>
<p>spittle() æ–¹æ³•ä¼šå°†å‚æ•°ä¼ é€’åˆ° SpittleRepository çš„ findOne() æ–¹æ³•ä¸­ï¼Œç”¨æ¥è·å–æŸä¸ª Spittle å¯¹è±¡ï¼Œç„¶åå°† Spittle å¯¹è±¡æ·»åŠ åˆ°æ¨¡å‹ä¸­ã€‚æ¨¡å‹çš„ key å°†ä¼šæ˜¯ spittleï¼Œè¿™æ˜¯æ ¹æ®ä¼ é€’åˆ° addAttribute() æ–¹æ³•ä¸­çš„ç±»å‹æ¨æ–­å¾—åˆ°çš„ã€‚</p>
<p>è¿™æ · Spittle å¯¹è±¡ä¸­çš„æ•°æ®å°±å¯ä»¥æ¸²æŸ“åˆ°è§†å›¾ä¸­äº†ï¼Œæ­¤æ—¶éœ€è¦å¼•ç”¨è¯·æ±‚ä¸­ key ä¸º spittle çš„å±æ€§ï¼ˆä¸æ¨¡å‹çš„ key ä¸€è‡´ï¼‰ã€‚å¦‚ä¸‹ä¸ºæ¸²æŸ“ Spittle çš„ JSP è§†å›¾ç‰‡æ®µï¼š</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;spittleView&quot;</span>&gt;  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;spittleMessage&quot;</span>&gt;&lt;c:out value=<span class="string">&quot;$&#123;spittle.message&#125;&quot;</span> /&gt;&lt;/div&gt;  &lt;div&gt;    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;spittleTime&quot;</span>&gt;&lt;c:out value=<span class="string">&quot;$&#123;spittle.time&#125;&quot;</span> /&gt;&lt;/span&gt;  &lt;/div&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè§†å›¾å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ï¼Œå®ƒçš„å±å¹•æˆªå›¾å¦‚å›¾ 5.4 æ‰€ç¤ºã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211022103627696.png" alt="image-20211022103627696"></p>
<center>å›¾ 5.4ã€€åœ¨æµè§ˆå™¨ä¸­å±•ç°ä¸€ä¸ª spittle</center>

<p>å¦‚æœä¼ é€’è¯·æ±‚ä¸­å°‘é‡çš„æ•°æ®ï¼Œé‚£æŸ¥è¯¢å‚æ•°å’Œè·¯å¾„å˜é‡æ˜¯å¾ˆåˆé€‚çš„ã€‚ä½†é€šå¸¸æˆ‘ä»¬è¿˜éœ€è¦ä¼ é€’å¾ˆå¤šçš„æ•°æ®ï¼ˆä¹Ÿè®¸æ˜¯è¡¨å•æäº¤çš„æ•°æ®ï¼‰ï¼Œé‚£æŸ¥è¯¢å‚æ•°æ˜¾å¾—æœ‰äº›ç¬¨æ‹™å’Œå—é™äº†ã€‚ä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•ç¼–å†™æ§åˆ¶å™¨æ–¹æ³•æ¥å¤„ç†è¡¨å•æäº¤ã€‚</p>
<h3 id="å¤„ç†è¡¨å•"><a href="#å¤„ç†è¡¨å•" class="headerlink" title="å¤„ç†è¡¨å•"></a>å¤„ç†è¡¨å•</h3><p>Web åº”ç”¨çš„åŠŸèƒ½é€šå¸¸å¹¶ä¸å±€é™äºä¸ºç”¨æˆ·æ¨é€å†…å®¹ã€‚å¤§å¤šæ•°çš„åº”ç”¨å…è®¸ç”¨æˆ·å¡«å……è¡¨å•å¹¶å°†æ•°æ®æäº¤å›åº”ç”¨ä¸­ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å®ç°ä¸ç”¨æˆ·çš„äº¤äº’ã€‚åƒæä¾›å†…å®¹ä¸€æ ·ï¼Œ Spring MVC çš„æ§åˆ¶å™¨ä¹Ÿä¸ºè¡¨å•å¤„ç†æä¾›äº†è‰¯å¥½çš„æ”¯æŒã€‚</p>
<p>ä½¿ç”¨è¡¨å•åˆ†ä¸ºä¸¤ä¸ªæ–¹é¢ï¼šå±•ç°è¡¨å•ä»¥åŠå¤„ç†ç”¨æˆ·é€šè¿‡è¡¨å•æäº¤çš„æ•°æ®ã€‚åœ¨ <code>Spittr</code> åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸ªè¡¨å•è®©æ–°ç”¨æˆ·è¿›è¡Œæ³¨å†Œã€‚<code>SpitterController</code> æ˜¯ä¸€ä¸ªæ–°çš„æ§åˆ¶å™¨ï¼Œç›®å‰åªæœ‰ä¸€ä¸ªè¯·æ±‚å¤„ç†çš„æ–¹æ³•æ¥å±•ç°æ³¨å†Œè¡¨å•ã€‚</p>
<center>ç¨‹åºæ¸…å• 5.13ã€€SpitterControllerï¼šå±•ç°ä¸€ä¸ªè¡¨å•ï¼Œå…è®¸ç”¨æˆ·æ³¨å†Œè¯¥åº”ç”¨</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.web;<span class="keyword">import</span> <span class="keyword">static</span> org.springframework.web.bind.annotation.RequestMethod.*;<span class="keyword">import</span> javax.validation.Valid;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.stereotype.Controller;<span class="keyword">import</span> org.springframework.ui.Model;<span class="keyword">import</span> org.springframework.validation.Errors;<span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<span class="keyword">import</span> spittr.Spitter;<span class="keyword">import</span> spittr.data.SpitterRepository;<span class="meta">@Controller</span><span class="meta">@RequestMapping(&quot;/spitter&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpitterController</span> </span>&#123;  <span class="meta">@RequestMapping(value=&quot;/register&quot;, method=GET)</span>  <span class="function"><span class="keyword">public</span> String <span class="title">showRegistrationForm</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="string">&quot;registerForm&quot;</span>;  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p><code>showRegistrationForm()</code> æ–¹æ³•çš„ <code>@RequestMapping</code> æ³¨è§£ä»¥åŠç±»çº§åˆ«ä¸Šçš„ <code>@RequestMapping</code> æ³¨è§£ç»„åˆèµ·æ¥ï¼Œå£°æ˜äº†è¿™ä¸ªæ–¹æ³•è¦å¤„ç†çš„æ˜¯é’ˆå¯¹ â€œ/spitter/registerâ€ çš„ GET è¯·æ±‚ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œæ²¡æœ‰ä»»ä½•è¾“å…¥å¹¶ä¸”åªæ˜¯è¿”å›åä¸º <code>registerForm</code> çš„é€»è¾‘è§†å›¾ã€‚æŒ‰ç…§æˆ‘ä»¬é…ç½®<code>InternalResourceViewResolver</code>çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å°†ä¼šä½¿ç”¨ â€œ/WEB-INF/ views/registerForm.jspâ€ è¿™ä¸ª <code>JSP</code> æ¥æ¸²æŸ“æ³¨å†Œè¡¨å•ã€‚</p>
<p>å°½ç®¡ <code>showRegistrationForm()</code> æ–¹æ³•éå¸¸ç®€å•ï¼Œä½†æµ‹è¯•ä¾ç„¶éœ€è¦è¦†ç›–åˆ°å®ƒã€‚å› ä¸ºè¿™ä¸ªæ–¹æ³•å¾ˆç®€å•ï¼Œæ‰€ä»¥å®ƒçš„æµ‹è¯•ä¹Ÿæ¯”è¾ƒç®€å•ã€‚</p>
<center>ç¨‹åºæ¸…å• 5.14ã€€æµ‹è¯•å±•ç°è¡¨å•çš„æ§åˆ¶å™¨æ–¹æ³•</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Testpublic</span> <span class="function"><span class="keyword">void</span> <span class="title">shouldShowRegistration</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;    SpitterRepository mockRepository = mock(SpitterRepository.class);    SpitterController controller = <span class="keyword">new</span> SpitterController(mockRepository);    MockMvc mockMvc = standaloneSetup(controller).build();    mockMvc.perform(get(<span class="string">&quot;/spitter/register&quot;</span>))        .andExpect(view().name(<span class="string">&quot;registerForm&quot;</span>));&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæµ‹è¯•æ–¹æ³•ä¸é¦–é¡µæ§åˆ¶å™¨çš„æµ‹è¯•éå¸¸ç±»ä¼¼ã€‚å®ƒå¯¹ â€œ/spitter/registerâ€ å‘é€GETè¯·æ±‚ï¼Œç„¶åæ–­è¨€ç»“æœçš„è§†å›¾åä¸º registerFormã€‚</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å›åˆ°è§†å›¾ä¸Šã€‚å› ä¸ºè§†å›¾çš„åç§°ä¸º <code>registerForm</code>ï¼Œæ‰€ä»¥ <code>JSP</code> çš„åç§°éœ€è¦æ˜¯ <code>registerForm.jsp</code>ã€‚è¿™ä¸ª <code>JSP</code> å¿…é¡»è¦åŒ…å«ä¸€ä¸ª <code>HTML &lt;form&gt;</code> æ ‡ç­¾ï¼Œåœ¨è¿™ä¸ªæ ‡ç­¾ä¸­ç”¨æˆ·è¾“å…¥æ³¨å†Œåº”ç”¨çš„ä¿¡æ¯ã€‚å¦‚ä¸‹å°±æ˜¯æˆ‘ä»¬ç°åœ¨æ‰€è¦ä½¿ç”¨çš„ <code>JSP</code>ã€‚</p>
<center>ç¨‹åºæ¸…å• 5.15ã€€æ¸²æŸ“æ³¨å†Œè¡¨å•çš„ JSP</center>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;&lt;%@ page session=&quot;false&quot; %&gt;<span class="tag">&lt;<span class="name">html</span>&gt;</span>  <span class="tag">&lt;<span class="name">head</span>&gt;</span>    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Spitter<span class="tag">&lt;/<span class="name">title</span>&gt;</span>    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>           <span class="attr">href</span>=<span class="string">&quot;&lt;c:url value=&quot;</span>/<span class="attr">resources</span>/<span class="attr">style.css</span>&quot; /&gt;</span>&quot; &gt;  <span class="tag">&lt;/<span class="name">head</span>&gt;</span>  <span class="tag">&lt;<span class="name">body</span>&gt;</span>    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Register<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span>      First Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;firstName&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>      Last Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>      Email: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>      Username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>      Password: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Register&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">form</span>&gt;</span>  <span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ª <code>JSP</code> éå¸¸åŸºç¡€ã€‚å®ƒçš„ HTML è¡¨å•åŸŸä¸­è®°å½•ç”¨æˆ·çš„åå­—ã€å§“æ°ã€ç”¨æˆ·åä»¥åŠå¯†ç ï¼Œç„¶åè¿˜åŒ…å«ä¸€ä¸ªæäº¤è¡¨å•çš„æŒ‰é’®ã€‚åœ¨æµè§ˆå™¨æ¸²æŸ“ä¹‹åï¼Œå®ƒçš„æ ·å­å¤§è‡´å¦‚å›¾ 5.5 æ‰€ç¤ºã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¿™é‡Œçš„ <code>&lt;form&gt;</code> æ ‡ç­¾ä¸­å¹¶æ²¡æœ‰è®¾ç½® action å±æ€§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“è¡¨å•æäº¤æ—¶ï¼Œå®ƒä¼šæäº¤åˆ°ä¸å±•ç°æ—¶ç›¸åŒçš„ URL è·¯å¾„ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¼šæäº¤åˆ° â€œ/spitter/registerâ€ ä¸Šã€‚</p>
<p>è¿™å°±æ„å‘³ç€éœ€è¦åœ¨æœåŠ¡å™¨ç«¯å¤„ç†è¯¥ HTTP POST è¯·æ±‚ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨ Spitter-Controller ä¸­å†æ·»åŠ ä¸€ä¸ªæ–¹æ³•æ¥å¤„ç†è¿™ä¸ªè¡¨å•æäº¤ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211022105250379.png" alt="image-20211022105250379"></p>
<h4 id="ç¼–å†™å¤„ç†è¡¨å•çš„æ§åˆ¶å™¨"><a href="#ç¼–å†™å¤„ç†è¡¨å•çš„æ§åˆ¶å™¨" class="headerlink" title="ç¼–å†™å¤„ç†è¡¨å•çš„æ§åˆ¶å™¨"></a>ç¼–å†™å¤„ç†è¡¨å•çš„æ§åˆ¶å™¨</h4><p>å½“å¤„ç†æ³¨å†Œè¡¨å•çš„ POST è¯·æ±‚æ—¶ï¼Œæ§åˆ¶å™¨éœ€è¦æ¥å—è¡¨å•æ•°æ®å¹¶å°†è¡¨å•æ•°æ®ä¿å­˜ä¸º <code>Spitter</code> å¯¹è±¡ã€‚æœ€åï¼Œä¸ºäº†é˜²æ­¢é‡å¤æäº¤ï¼ˆç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨çš„åˆ·æ–°æŒ‰é’®æœ‰å¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼‰ï¼Œåº”è¯¥å°†æµè§ˆå™¨é‡å®šå‘åˆ°æ–°åˆ›å»ºç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯é¡µé¢ã€‚è¿™äº›è¡Œä¸ºé€šè¿‡ä¸‹é¢çš„ <code>shouldProcessRegistration()</code> è¿›è¡Œäº†æµ‹è¯•ã€‚</p>
<center>ç¨‹åºæ¸…å• 5.16ã€€æµ‹è¯•å¤„ç†è¡¨å•çš„æ§åˆ¶å™¨æ–¹æ³•</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Testpublic</span> <span class="function"><span class="keyword">void</span> <span class="title">shouldProcessRegistration</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;  SpitterRepository mockRepository = mock(SpitterRepository.class);  Spitter unsaved = <span class="keyword">new</span> Spitter(<span class="string">&quot;jbauer&quot;</span>, <span class="string">&quot;24hours&quot;</span>, <span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;Bauer&quot;</span>, <span class="string">&quot;jbauer@ctu.gov&quot;</span>);  Spitter saved = <span class="keyword">new</span> Spitter(<span class="number">24L</span>, <span class="string">&quot;jbauer&quot;</span>, <span class="string">&quot;24hours&quot;</span>, <span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;Bauer&quot;</span>, <span class="string">&quot;jbauer@ctu.gov&quot;</span>);  when(mockRepository.save(unsaved)).thenReturn(saved);    SpitterController controller = <span class="keyword">new</span> SpitterController(mockRepository);  MockMvc mockMvc = standaloneSetup(controller).build();  mockMvc.perform(post(<span class="string">&quot;/spitter/register&quot;</span>)         .param(<span class="string">&quot;firstName&quot;</span>, <span class="string">&quot;Jack&quot;</span>)         .param(<span class="string">&quot;lastName&quot;</span>, <span class="string">&quot;Bauer&quot;</span>)         .param(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;jbauer&quot;</span>)         .param(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;24hours&quot;</span>)         .param(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;jbauer@ctu.gov&quot;</span>))         .andExpect(redirectedUrl(<span class="string">&quot;/spitter/jbauer&quot;</span>));    verify(mockRepository, atLeastOnce()).save(unsaved);&#125;</span><br></pre></td></tr></table></figure>

<p>æ˜¾ç„¶ï¼Œè¿™ä¸ªæµ‹è¯•æ¯”å±•ç°æ³¨å†Œè¡¨å•çš„æµ‹è¯•å¤æ‚å¾—å¤šã€‚åœ¨æ„å»ºå®Œ <code>SpitterRepository</code> çš„ mock å®ç°ä»¥åŠæ‰€è¦æ‰§è¡Œçš„æ§åˆ¶å™¨å’Œ <code>MockMvc</code> ä¹‹åï¼Œ <code>shouldProcessRegistration()</code> å¯¹ â€œ/spitter/registerâ€ å‘èµ·äº†ä¸€ä¸ªPOSTè¯·æ±‚ã€‚ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æˆ·ä¿¡æ¯ä»¥å‚æ•°çš„å½¢å¼æ”¾åˆ° request ä¸­ï¼Œä»è€Œæ¨¡æ‹Ÿæäº¤çš„è¡¨å•ã€‚</p>
<p>åœ¨å¤„ç† POST ç±»å‹çš„è¯·æ±‚æ—¶ï¼Œåœ¨è¯·æ±‚å¤„ç†å®Œæˆåï¼Œæœ€å¥½è¿›è¡Œä¸€ä¸‹é‡å®šå‘ï¼Œè¿™æ ·æµè§ˆå™¨çš„åˆ·æ–°å°±ä¸ä¼šé‡å¤æäº¤è¡¨å•äº†ã€‚åœ¨è¿™ä¸ªæµ‹è¯•ä¸­ï¼Œé¢„æœŸè¯·æ±‚ä¼šé‡å®šå‘åˆ° â€œ/spitter/jbauerâ€ï¼Œä¹Ÿå°±æ˜¯æ–°å»ºç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯é¡µé¢ã€‚</p>
<p>æœ€åï¼Œæµ‹è¯•ä¼šæ ¡éªŒ SpitterRepository çš„ mock å®ç°æœ€ç»ˆä¼šçœŸæ­£ç”¨æ¥ä¿å­˜è¡¨å•ä¸Šä¼ å…¥çš„æ•°æ®ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥å®ç°å¤„ç†è¡¨å•æäº¤çš„æ§åˆ¶å™¨æ–¹æ³•ã€‚é€šè¿‡ shouldProcess-Registration() æ–¹æ³•ï¼Œæˆ‘ä»¬å¯èƒ½è®¤ä¸ºè¦æ»¡è¶³è¿™ä¸ªéœ€æ±‚éœ€è¦åšå¾ˆå¤šçš„å·¥ä½œã€‚ä½†æ˜¯ï¼Œåœ¨å¦‚ä¸‹çš„ç¨‹åºæ¸…å•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–°çš„ SpitterController å¹¶æ²¡æœ‰åšå¤ªå¤šçš„äº‹æƒ…ã€‚</p>
<center>ç¨‹åºæ¸…å• 5.17ã€€å¤„ç†æ‰€æäº¤çš„è¡¨å•å¹¶æ³¨å†Œæ–°ç”¨æˆ·</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.web;<span class="keyword">import</span> <span class="keyword">static</span> org.springframework.web.bind.annotation.RequestMethod.*;<span class="keyword">import</span> javax.validation.Valid;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.stereotype.Controller;<span class="keyword">import</span> org.springframework.ui.Model;<span class="keyword">import</span> org.springframework.validation.Errors;<span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<span class="keyword">import</span> spittr.Spitter;<span class="keyword">import</span> spittr.data.SpitterRepository;<span class="meta">@Controller</span><span class="meta">@RequestMapping(&quot;/spitter&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpitterController</span> </span>&#123;  <span class="keyword">private</span> SpitterRepository spitterRepository;  <span class="meta">@Autowired</span>  <span class="function"><span class="keyword">public</span> <span class="title">SpitterController</span><span class="params">(SpitterRepository spitterRepository)</span> </span>&#123;    <span class="keyword">this</span>.spitterRepository = spitterRepository;  &#125;    <span class="meta">@RequestMapping(value=&quot;/register&quot;, method=GET)</span>  <span class="function"><span class="keyword">public</span> String <span class="title">showRegistrationForm</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="string">&quot;registerForm&quot;</span>;  &#125;    <span class="meta">@RequestMapping(value=&quot;/register&quot;, method=POST)</span>  <span class="function"><span class="keyword">public</span> String <span class="title">processRegistration</span><span class="params">(Spitter spitter)</span> </span>&#123;    spitterRepository.save(spitter);    <span class="keyword">return</span> <span class="string">&quot;redirect:/spitter/&quot;</span> + spitter.getUsername();  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„ <code>showRegistrationForm()</code> æ–¹æ³•ä¾ç„¶è¿˜åœ¨ï¼Œä¸è¿‡è¯·æ³¨æ„æ–°åˆ›å»ºçš„ <code>processRegistration()</code> æ–¹æ³•ï¼Œå®ƒæ¥å—ä¸€ä¸ª <code>Spitter</code> å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå¯¹è±¡æœ‰ <code>firstName</code>ã€<code>lastName</code>ã€<code>username</code> å’Œ <code>password</code> å±æ€§ï¼Œè¿™äº›å±æ€§å°†ä¼šä½¿ç”¨è¯·æ±‚ä¸­åŒåçš„å‚æ•°è¿›è¡Œå¡«å……ã€‚</p>
<p>å½“ä½¿ç”¨ <code>Spitter</code> å¯¹è±¡è°ƒç”¨ <code>processRegistration()</code> æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè¿›è€Œè°ƒç”¨ <code>SpitterRepository</code> çš„ <code>save()</code> æ–¹æ³•ï¼Œ<code>SpitterRepository</code> æ˜¯åœ¨ <code>SpitterController</code> çš„æ„é€ å™¨ä¸­æ³¨å…¥è¿›æ¥çš„ã€‚</p>
<p>processRegistration() æ–¹æ³•åšçš„æœ€åä¸€ä»¶äº‹å°±æ˜¯è¿”å›ä¸€ä¸ª String ç±»å‹ï¼Œç”¨æ¥æŒ‡å®šè§†å›¾ã€‚ä½†æ˜¯è¿™ä¸ªè§†å›¾æ ¼å¼å’Œä»¥å‰æˆ‘ä»¬æ‰€çœ‹åˆ°çš„è§†å›¾æœ‰æ‰€ä¸åŒã€‚è¿™é‡Œä¸ä»…è¿”å›äº†è§†å›¾çš„åç§°ä¾›è§†å›¾è§£æå™¨æŸ¥æ‰¾ç›®æ ‡è§†å›¾ï¼Œè€Œä¸”è¿”å›çš„å€¼è¿˜å¸¦æœ‰é‡å®šå‘çš„æ ¼å¼ã€‚</p>
<p>å½“ <code>InternalResourceViewResolver</code> çœ‹åˆ°è§†å›¾æ ¼å¼ä¸­çš„ â€œredirect:â€ å‰ç¼€æ—¶ï¼Œå®ƒå°±çŸ¥é“è¦å°†å…¶è§£æä¸ºé‡å®šå‘çš„è§„åˆ™ï¼Œè€Œä¸æ˜¯è§†å›¾çš„åç§°ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒå°†ä¼šé‡å®šå‘åˆ°ç”¨æˆ·åŸºæœ¬ä¿¡æ¯çš„é¡µé¢ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ <code>Spitter.username</code> å±æ€§çš„å€¼ä¸º â€œjbauerâ€ï¼Œé‚£ä¹ˆè§†å›¾å°†ä¼šé‡å®šå‘åˆ° â€œ/spitter/jbauerâ€ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé™¤äº† â€œredirect:â€ï¼Œ<code>InternalResourceViewResolver</code> è¿˜èƒ½è¯†åˆ« â€œforward:â€ å‰ç¼€ã€‚å½“å®ƒå‘ç°è§†å›¾æ ¼å¼ä¸­ä»¥ â€œforward:â€ ä½œä¸ºå‰ç¼€æ—¶ï¼Œè¯·æ±‚å°†ä¼šå‰å¾€ï¼ˆforwardï¼‰æŒ‡å®šçš„URLè·¯å¾„ï¼Œè€Œä¸å†æ˜¯é‡å®šå‘ã€‚</p>
<p>ä¸‡äº‹ä¿±å¤‡ï¼ç°åœ¨ï¼Œç¨‹åºæ¸…å• 5.16 ä¸­çš„æµ‹è¯•åº”è¯¥èƒ½å¤Ÿé€šè¿‡äº†ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„ä»»åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œå› ä¸ºæˆ‘ä»¬é‡å®šå‘åˆ°äº†ç”¨æˆ·åŸºæœ¬ä¿¡æ¯é¡µé¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¾€ <code>SpitterController</code> ä¸­æ·»åŠ ä¸€ä¸ªå¤„ç†å™¨æ–¹æ³•ï¼Œç”¨æ¥å¤„ç†å¯¹åŸºæœ¬ä¿¡æ¯é¡µé¢çš„è¯·æ±‚ã€‚å¦‚ä¸‹çš„ <code>showSpitterProfile()</code> å°†ä¼šå®Œæˆè¿™é¡¹ä»»åŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/&#123;username&#125;&quot;, method=GET)</span><span class="function"><span class="keyword">public</span> String <span class="title">showSpitterProfile</span><span class="params">(<span class="meta">@PathVariable</span> String username, Model model)</span> </span>&#123;  Spitter spitter = spitterRepository.findByUsername(username);  model.addAttribute(spitter);  <span class="keyword">return</span> <span class="string">&quot;profile&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>SpitterRepository é€šè¿‡ç”¨æˆ·åè·å–ä¸€ä¸ª Spitter å¯¹è±¡ï¼ŒshowSpitterProfile() å¾—åˆ°è¿™ä¸ªå¯¹è±¡å¹¶å°†å…¶æ·»åŠ åˆ°æ¨¡å‹ä¸­ï¼Œç„¶åè¿”å› profileï¼Œä¹Ÿå°±æ˜¯åŸºæœ¬ä¿¡æ¯é¡µé¢çš„é€»è¾‘è§†å›¾åã€‚åƒæœ¬ç« å±•ç°çš„å…¶ä»–è§†å›¾ä¸€æ ·ï¼Œç°åœ¨çš„åŸºæœ¬ä¿¡æ¯è§†å›¾éå¸¸ç®€å•ï¼š</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;Your Profile&lt;/h1&gt;&lt;c:out value=<span class="string">&quot;$&#123;spitter.username&#125;&quot;</span> /&gt;&lt;br/&gt;&lt;c:out value=<span class="string">&quot;$&#123;spitter.firstName&#125;&quot;</span> /&gt; &lt;c:out value=<span class="string">&quot;$&#123;spitter.lastName&#125;&quot;</span> /&gt;&lt;br/&gt;&lt;c:out value=<span class="string">&quot;$&#123;spitter.email&#125;&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<p>å›¾ 5.6 å±•ç°äº†åœ¨ Web æµè§ˆå™¨ä¸­æ¸²æŸ“çš„åŸºæœ¬ä¿¡æ¯é¡µé¢ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211022110423300.png" alt="image-20211022110423300"></p>
<center>å›¾ 5.6ã€€Spittr çš„åŸºæœ¬ä¿¡æ¯é¡µå±•ç°äº†ç”¨æˆ·çš„æƒ…å†µï¼Œè¿™äº›ä¿¡æ¯æ˜¯ç”± SpitterController å¡«å……åˆ°æ¨¡å‹ä¸­çš„</center>

<p>å¦‚æœè¡¨å•ä¸­æ²¡æœ‰å‘é€ <code>username</code> æˆ– <code>password </code>çš„è¯ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œå¦‚æœ <code>firstName</code> æˆ– <code>lastName</code> çš„å€¼ä¸ºç©ºæˆ–å¤ªé•¿çš„è¯ï¼Œåˆä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ä¸ºè¡¨å•æäº¤æ·»åŠ æ ¡éªŒï¼Œä»è€Œé¿å…æ•°æ®å‘ˆç°çš„ä¸ä¸€è‡´æ€§ã€‚</p>
<h4 id="æ ¡éªŒè¡¨å•"><a href="#æ ¡éªŒè¡¨å•" class="headerlink" title="æ ¡éªŒè¡¨å•"></a>æ ¡éªŒè¡¨å•</h4><p>å¦‚æœç”¨æˆ·åœ¨æäº¤è¡¨å•çš„æ—¶å€™ï¼Œ<code>username</code> æˆ– <code>password</code> æ–‡æœ¬åŸŸä¸ºç©ºçš„è¯ï¼Œé‚£ä¹ˆå°†ä¼šå¯¼è‡´åœ¨æ–°å»º <code>Spitter</code> å¯¹è±¡ä¸­ï¼Œ<code>username</code> æˆ– <code>password</code> æ˜¯ç©ºçš„ Stringã€‚è‡³å°‘è¿™æ˜¯ä¸€ç§æ€ªå¼‚çš„è¡Œä¸ºã€‚å¦‚æœè¿™ç§ç°è±¡ä¸å¤„ç†çš„è¯ï¼Œè¿™å°†ä¼šå‡ºç°å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºä¸ç®¡æ˜¯è°åªè¦æäº¤ä¸€ä¸ªç©ºçš„è¡¨å•å°±èƒ½ç™»å½•åº”ç”¨ã€‚</p>
<p>åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜åº”è¯¥é˜»æ­¢ç”¨æˆ·æäº¤ç©ºçš„ <code>firstName</code> å’Œ / æˆ– <code>lastName</code>ï¼Œä½¿åº”ç”¨ä»…åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿æŒåŒ¿åæ€§ã€‚æœ‰ä¸ªå¥½çš„åŠæ³•å°±æ˜¯é™åˆ¶è¿™äº›è¾“å…¥åŸŸå€¼çš„é•¿åº¦ï¼Œä¿æŒå®ƒä»¬çš„å€¼åœ¨ä¸€ä¸ªåˆç†çš„é•¿åº¦èŒƒå›´ï¼Œé¿å…è¿™äº›è¾“å…¥åŸŸçš„è¯¯ç”¨ã€‚</p>
<p>æœ‰ç§å¤„ç†æ ¡éªŒçš„æ–¹å¼éå¸¸åˆçº§ï¼Œé‚£å°±æ˜¯åœ¨ <code>processRegistration()</code> æ–¹æ³•ä¸­æ·»åŠ ä»£ç æ¥æ£€æŸ¥å€¼çš„åˆæ³•æ€§ï¼Œå¦‚æœå€¼ä¸åˆæ³•çš„è¯ï¼Œå°±å°†æ³¨å†Œè¡¨å•é‡æ–°æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆç®€çŸ­çš„æ–¹æ³•ï¼Œå› æ­¤ï¼Œæ·»åŠ ä¸€äº›é¢å¤–çš„ if è¯­å¥ä¹Ÿä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œå¯¹å§ï¼Ÿ</p>
<p>ä¸å…¶è®©æ ¡éªŒé€»è¾‘å¼„ä¹±æˆ‘ä»¬çš„å¤„ç†å™¨æ–¹æ³•ï¼Œè¿˜ä¸å¦‚ä½¿ç”¨ Spring å¯¹ Java æ ¡éªŒ <code>API</code>ï¼ˆJava Validation APIï¼Œåˆç§° <code>JSR-303</code>ï¼‰çš„æ”¯æŒã€‚ä» Spring 3.0 å¼€å§‹ï¼Œåœ¨ <code>Spring MVC</code> ä¸­æä¾›äº†å¯¹ Java æ ¡éªŒ API çš„æ”¯æŒã€‚åœ¨ <code>Spring MVC</code> ä¸­è¦ä½¿ç”¨ Java æ ¡éªŒ API çš„è¯ï¼Œå¹¶ä¸éœ€è¦ä»€ä¹ˆé¢å¤–çš„é…ç½®ã€‚åªè¦ä¿è¯åœ¨ç±»è·¯å¾„ä¸‹åŒ…å«è¿™ä¸ª Java API çš„å®ç°å³å¯ï¼Œæ¯”å¦‚ Hibernate Validatorã€‚</p>
<p>Javaæ ¡éªŒ API å®šä¹‰äº†å¤šä¸ªæ³¨è§£ï¼Œè¿™äº›æ³¨è§£å¯ä»¥æ”¾åˆ°å±æ€§ä¸Šï¼Œä»è€Œé™åˆ¶è¿™äº›å±æ€§çš„å€¼ã€‚æ‰€æœ‰çš„æ³¨è§£éƒ½ä½äº <code>javax.validation.constraints</code> åŒ…ä¸­ã€‚è¡¨ 5.1 åˆ—å‡ºäº†è¿™äº›æ ¡éªŒæ³¨è§£ã€‚</p>
<table>
<thead>
<tr>
<th>æ³¨ã€€ã€€è§£</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>@AssertFalse</td>
<td>æ‰€æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ Boolean ç±»å‹ï¼Œå¹¶ä¸”å€¼ä¸º false</td>
</tr>
<tr>
<td>@AssertTrue</td>
<td>æ‰€æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ Boolean ç±»å‹ï¼Œå¹¶ä¸”å€¼ä¸º true</td>
</tr>
<tr>
<td>@DecimalMax</td>
<td>æ‰€æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯æ•°å­—ï¼Œå¹¶ä¸”å®ƒçš„å€¼è¦å°äºæˆ–ç­‰äºç»™å®šçš„ BigDecimalString å€¼</td>
</tr>
<tr>
<td>@DecimalMin</td>
<td>æ‰€æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯æ•°å­—ï¼Œå¹¶ä¸”å®ƒçš„å€¼è¦å¤§äºæˆ–ç­‰äºç»™å®šçš„ BigDecimalString å€¼</td>
</tr>
<tr>
<td>@Digits</td>
<td>æ‰€æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯æ•°å­—ï¼Œå¹¶ä¸”å®ƒçš„å€¼å¿…é¡»æœ‰æŒ‡å®šçš„ä½æ•°</td>
</tr>
<tr>
<td>@Future</td>
<td>æ‰€æ³¨è§£çš„å…ƒç´ çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ</td>
</tr>
<tr>
<td>@Max</td>
<td>æ‰€æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯æ•°å­—ï¼Œå¹¶ä¸”å®ƒçš„å€¼è¦å°äºæˆ–ç­‰äºç»™å®šçš„å€¼</td>
</tr>
<tr>
<td>@Min</td>
<td>æ‰€æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯æ•°å­—ï¼Œå¹¶ä¸”å®ƒçš„å€¼è¦å¤§äºæˆ–ç­‰äºç»™å®šçš„å€¼</td>
</tr>
<tr>
<td>@NotNull</td>
<td>æ‰€æ³¨è§£å…ƒç´ çš„å€¼å¿…é¡»ä¸èƒ½ä¸º null</td>
</tr>
<tr>
<td>@Null</td>
<td>æ‰€æ³¨è§£å…ƒç´ çš„å€¼å¿…é¡»ä¸º null</td>
</tr>
<tr>
<td>@Past</td>
<td>æ‰€æ³¨è§£çš„å…ƒç´ çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå·²è¿‡å»çš„æ—¥æœŸ</td>
</tr>
<tr>
<td>@Pattern</td>
<td>æ‰€æ³¨è§£çš„å…ƒç´ çš„å€¼å¿…é¡»åŒ¹é…ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼</td>
</tr>
<tr>
<td>@Size</td>
<td>æ‰€æ³¨è§£çš„å…ƒç´ çš„å€¼å¿…é¡»æ˜¯ Stringã€é›†åˆæˆ–æ•°ç»„ï¼Œå¹¶ä¸”å®ƒçš„é•¿åº¦è¦ç¬¦åˆç»™å®šçš„èŒƒå›´</td>
</tr>
</tbody></table>
<p>é™¤äº†è¡¨ 5.1 ä¸­çš„æ³¨è§£ï¼ŒJava æ ¡éªŒ API çš„å®ç°å¯èƒ½è¿˜ä¼šæä¾›é¢å¤–çš„æ ¡éªŒæ³¨è§£ã€‚åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„é™åˆ¶æ¡ä»¶ã€‚ä½†å°±æˆ‘ä»¬æ¥è®²ï¼Œå°†ä¼šå…³æ³¨äºä¸Šè¡¨ä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒé™åˆ¶æ¡ä»¶ã€‚</p>
<p>è¯·è€ƒè™‘è¦æ·»åŠ åˆ° Spitter åŸŸä¸Šçš„é™åˆ¶æ¡ä»¶ï¼Œä¼¼ä¹éœ€è¦ä½¿ç”¨ @NotNull å’Œ @Size æ³¨è§£ã€‚æˆ‘ä»¬æ‰€è¦åšçš„äº‹æƒ…å°±æ˜¯å°†è¿™äº›æ³¨è§£æ·»åŠ åˆ° Spitter çš„å±æ€§ä¸Šã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº† Spitter ç±»ï¼Œå®ƒçš„å±æ€§å·²ç»æ·»åŠ äº†æ ¡éªŒæ³¨è§£ã€‚</p>
<center>ç¨‹åºæ¸…å• 5.18ã€€Spitterï¼šåŒ…å«äº†è¦æäº¤åˆ° Spittle POST è¯·æ±‚ä¸­çš„åŸŸ</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr;<span class="keyword">import</span> javax.validation.constraints.NotNull;<span class="keyword">import</span> javax.validation.constraints.Size;<span class="keyword">import</span> org.apache.commons.lang3.builder.EqualsBuilder;<span class="keyword">import</span> org.apache.commons.lang3.builder.HashCodeBuilder;<span class="keyword">import</span> org.hibernate.validator.constraints.Email;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Spitter</span> </span>&#123;    <span class="keyword">private</span> Long id;    <span class="meta">@NotNull</span>    <span class="meta">@Size(min=5, max=16)</span>    <span class="keyword">private</span> String username;    <span class="meta">@NotNull</span>    <span class="meta">@Size(min=5, max=25)</span>    <span class="keyword">private</span> String password;    <span class="meta">@NotNull</span>    <span class="meta">@Size(min=2, max=30)</span>    <span class="keyword">private</span> String firstName;    <span class="meta">@NotNull</span>    <span class="meta">@Size(min=2, max=30)</span>    <span class="keyword">private</span> String lastName;    <span class="meta">@NotNull</span>    <span class="meta">@Email</span>    <span class="keyword">private</span> String email;    ...&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œ<code>Spitter</code> çš„æ‰€æœ‰å±æ€§éƒ½æ·»åŠ äº† <code>@NotNull</code> æ³¨è§£ï¼Œä»¥ç¡®ä¿å®ƒä»¬çš„å€¼ä¸ä¸º nullã€‚ç±»ä¼¼åœ°ï¼Œå±æ€§ä¸Šä¹Ÿæ·»åŠ äº† <code>@Size</code> æ³¨è§£ä»¥é™åˆ¶å®ƒä»¬çš„é•¿åº¦åœ¨æœ€å¤§å€¼å’Œæœ€å°å€¼ä¹‹é—´ã€‚å¯¹ <code>Spittr</code> åº”ç”¨æ¥è¯´ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·å¿…é¡»è¦å¡«å®Œæ³¨å†Œè¡¨å•ï¼Œå¹¶ä¸”å€¼çš„é•¿åº¦è¦åœ¨ç»™å®šçš„èŒƒå›´å†…ã€‚</p>
<p>æˆ‘ä»¬å·²ç»ä¸º <code>Spitter</code> æ·»åŠ äº†æ ¡éªŒæ³¨è§£ï¼Œæ¥ä¸‹æ¥éœ€è¦ä¿®æ”¹ <code>processRegistration()</code> æ–¹æ³•æ¥åº”ç”¨æ ¡éªŒåŠŸèƒ½ã€‚å¯ç”¨æ ¡éªŒåŠŸèƒ½çš„ <code>processRegistration()</code> å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/register&quot;, method=POST)</span><span class="function"><span class="keyword">public</span> String <span class="title">processRegistration</span><span class="params">(    <span class="meta">@Valid</span> Spitter spitter,     Errors errors)</span> </span>&#123;    <span class="keyword">if</span> (errors.hasErrors()) &#123;        <span class="keyword">return</span> <span class="string">&quot;registerForm&quot;</span>;    &#125;    spitterRepository.save(spitter);    <span class="keyword">return</span> <span class="string">&quot;redirect:/spitter/&quot;</span> + spitter.getUsername();  &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ç¨‹åºæ¸…å• 5.17 ä¸­æœ€åˆçš„ <code>processRegistration()</code> æ–¹æ³•ç›¸æ¯”ï¼Œè¿™é‡Œæœ‰äº†å¾ˆå¤§çš„å˜åŒ–ã€‚<code>Spitter</code> å‚æ•°æ·»åŠ äº† <code>@Valid</code> æ³¨è§£ï¼Œè¿™ä¼šå‘ŠçŸ¥ Springï¼Œéœ€è¦ç¡®ä¿è¿™ä¸ªå¯¹è±¡æ»¡è¶³æ ¡éªŒé™åˆ¶ã€‚</p>
<p>åœ¨ Spitter å±æ€§ä¸Šæ·»åŠ æ ¡éªŒé™åˆ¶å¹¶ä¸èƒ½é˜»æ­¢è¡¨å•æäº¤ã€‚å³ä¾¿ç”¨æˆ·æ²¡æœ‰å¡«å†™æŸä¸ªåŸŸæˆ–è€…æŸä¸ªåŸŸæ‰€ç»™å®šçš„å€¼è¶…å‡ºäº†æœ€å¤§é•¿åº¦ï¼Œ<code>processRegistration()</code> æ–¹æ³•ä¾ç„¶ä¼šè¢«è°ƒç”¨ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±éœ€è¦å¤„ç†æ ¡éªŒçš„é”™è¯¯ï¼Œå°±åƒåœ¨ <code>processRegistration()</code> æ–¹æ³•ä¸­æ‰€çœ‹åˆ°çš„é‚£æ ·ã€‚</p>
<p>å¦‚æœæœ‰æ ¡éªŒå‡ºç°é”™è¯¯çš„è¯ï¼Œé‚£ä¹ˆè¿™äº›é”™è¯¯å¯ä»¥é€šè¿‡ Errors å¯¹è±¡è¿›è¡Œè®¿é—®ï¼Œç°åœ¨è¿™ä¸ªå¯¹è±¡å·²ä½œä¸º processRegistration() æ–¹æ³•çš„å‚æ•°ã€‚ï¼ˆå¾ˆé‡è¦ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œ Errors å‚æ•°è¦ç´§è·Ÿåœ¨å¸¦æœ‰ @Valid æ³¨è§£çš„å‚æ•°åé¢ï¼Œ@Valid æ³¨è§£æ‰€æ ‡æ³¨çš„å°±æ˜¯è¦æ£€éªŒçš„å‚æ•°ã€‚ï¼‰processRegistration() æ–¹æ³•æ‰€åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯è°ƒç”¨ <code>Errors.hasErrors()</code> æ¥æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ã€‚</p>
<p>å¦‚æœæœ‰é”™è¯¯çš„è¯ï¼Œ<code>Errors.hasErrors()</code> å°†ä¼šè¿”å›åˆ° <code>registerForm</code>ï¼Œä¹Ÿå°±æ˜¯æ³¨å†Œè¡¨å•çš„è§†å›¾ã€‚è¿™èƒ½å¤Ÿè®©ç”¨æˆ·çš„æµè§ˆå™¨é‡æ–°å›åˆ°æ³¨å†Œè¡¨å•é¡µé¢ï¼Œæ‰€ä»¥ä»–ä»¬èƒ½å¤Ÿä¿®æ­£é”™è¯¯ï¼Œç„¶åé‡æ–°å°è¯•æäº¤ã€‚ç°åœ¨ï¼Œä¼šæ˜¾ç¤ºç©ºçš„è¡¨å•ï¼Œä½†æ˜¯åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨è¡¨å•ä¸­æ˜¾ç¤ºæœ€åˆæäº¤çš„å€¼å¹¶å°†æ ¡éªŒé”™è¯¯åé¦ˆç»™ç”¨æˆ·ã€‚</p>
<p>å¦‚æœæ²¡æœ‰é”™è¯¯çš„è¯ï¼ŒSpitter å¯¹è±¡å°†ä¼šé€šè¿‡ Repository è¿›è¡Œä¿å­˜ï¼Œæ§åˆ¶å™¨ä¼šåƒä¹‹å‰é‚£æ ·é‡å®šå‘åˆ°åŸºæœ¬ä¿¡æ¯é¡µé¢ã€‚</p>
<h3 id="å°ç»“-4"><a href="#å°ç»“-4" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ä¸ºç¼–å†™åº”ç”¨ç¨‹åºçš„ Web éƒ¨åˆ†å¼€äº†ä¸€ä¸ªå¥½å¤´ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒSpring æœ‰ä¸€ä¸ªå¼ºå¤§çµæ´»çš„ Web æ¡†æ¶ã€‚å€ŸåŠ©äºæ³¨è§£ï¼Œ<code>Spring MVC</code> æä¾›äº†è¿‘ä¼¼äº <code>POJO</code> çš„å¼€å‘æ¨¡å¼ï¼Œè¿™ä½¿å¾—å¼€å‘å¤„ç†è¯·æ±‚çš„æ§åˆ¶å™¨å˜å¾—éå¸¸ç®€å•ï¼ŒåŒæ—¶ä¹Ÿæ˜“äºæµ‹è¯•ã€‚</p>
<p>å½“ç¼–å†™æ§åˆ¶å™¨çš„å¤„ç†å™¨æ–¹æ³•æ—¶ï¼Œ<code>Spring MVC</code> æå…¶çµæ´»ã€‚æ¦‚æ‹¬æ¥è®²ï¼Œå¦‚æœä½ çš„å¤„ç†å™¨æ–¹æ³•éœ€è¦å†…å®¹çš„è¯ï¼Œåªéœ€å°†å¯¹åº”çš„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè€Œå®ƒä¸éœ€è¦çš„å†…å®¹ï¼Œåˆ™æ²¡æœ‰å¿…è¦å‡ºç°åœ¨å‚æ•°åˆ—è¡¨ä¸­ã€‚è¿™æ ·ï¼Œå°±ä¸ºè¯·æ±‚å¤„ç†å¸¦æ¥äº†æ— é™çš„å¯èƒ½æ€§ï¼ŒåŒæ—¶è¿˜èƒ½ä¿æŒä¸€ç§ç®€å•çš„ç¼–ç¨‹æ¨¡å‹ã€‚</p>
<p>å°½ç®¡æœ¬ç« ä¸­çš„å¾ˆå¤šå†…å®¹éƒ½æ˜¯å…³äºæ§åˆ¶å™¨çš„è¯·æ±‚å¤„ç†çš„ï¼Œä½†æ˜¯æ¸²æŸ“å“åº”åŒæ ·ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ <code>JSP</code> çš„æ–¹å¼ï¼Œç®€å•äº†è§£äº†å¦‚ä½•ä¸ºæ§åˆ¶å™¨ç¼–å†™è§†å›¾ã€‚ä½†æ˜¯å°± <code>Spring MVC</code> çš„è§†å›¾æ¥è¯´ï¼Œå®ƒå¹¶ä¸é™äºæœ¬ç« æ‰€çœ‹åˆ°çš„ç®€å• <code>JSP</code>ã€‚</p>
<p>åœ¨æ¥ä¸‹æ¥çš„ç¬¬ 6 ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šæ›´æ·±å…¥åœ°å­¦ä¹  Spring è§†å›¾ï¼ŒåŒ…æ‹¬å¦‚ä½•åœ¨ <code>JSP</code> ä¸­ä½¿ç”¨ Spring æ ‡ç­¾åº“ã€‚æˆ‘ä»¬è¿˜ä¼šå­¦ä¹ å¦‚ä½•å€ŸåŠ© Apache Tiles ä¸ºè§†å›¾æ·»åŠ ä¸€è‡´çš„å¸ƒå±€ç»“æ„ã€‚åŒæ—¶ï¼Œè¿˜ä¼šäº†è§£ <code>Thymeleaf</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„ <code>JSP</code> æ›¿ä»£æ–¹æ¡ˆï¼ŒSpring ä¸ºå…¶æä¾›äº†å†…ç½®çš„æ”¯æŒã€‚</p>
<h2 id="æ¸²æŸ“Webè§†å›¾"><a href="#æ¸²æŸ“Webè§†å›¾" class="headerlink" title="æ¸²æŸ“Webè§†å›¾"></a>æ¸²æŸ“Webè§†å›¾</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>å°†æ¨¡å‹æ•°æ®æ¸²æŸ“ä¸º HTML</li>
<li>ä½¿ç”¨ <code>JSP</code> è§†å›¾</li>
<li>é€šè¿‡ tiles å®šä¹‰è§†å›¾å¸ƒå±€</li>
<li>ä½¿ç”¨ Thymeleaf è§†å›¾</li>
</ul>
<p>ä¸Šä¸€ç« ä¸»è¦å…³æ³¨äºå¦‚ä½•ç¼–å†™å¤„ç† Web è¯·æ±‚çš„æ§åˆ¶å™¨ã€‚æˆ‘ä»¬ä¹Ÿåˆ›å»ºäº†ä¸€äº›ç®€å•çš„è§†å›¾ï¼Œç”¨æ¥æ¸²æŸ“æ§åˆ¶å™¨äº§ç”Ÿçš„æ¨¡å‹æ•°æ®ï¼Œä½†æˆ‘ä»¬å¹¶æ²¡æœ‰èŠ±å¤ªå¤šæ—¶é—´è®¨è®ºè§†å›¾ï¼Œä¹Ÿæ²¡æœ‰è®¨è®ºæ§åˆ¶å™¨å®Œæˆè¯·æ±‚åˆ°ç»“æœæ¸²æŸ“åˆ°ç”¨æˆ·çš„æµè§ˆå™¨ä¸­çš„è¿™æ®µæ—¶é—´å†…åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Œè€Œè¿™æ­£æ˜¯æœ¬ç« çš„ä¸»è¦å†…å®¹ã€‚</p>
<h3 id="ç†è§£è§†å›¾è§£æ"><a href="#ç†è§£è§†å›¾è§£æ" class="headerlink" title="ç†è§£è§†å›¾è§£æ"></a>ç†è§£è§†å›¾è§£æ</h3><p>åœ¨ç¬¬ 5 ç« ä¸­ï¼Œæˆ‘ä»¬æ‰€ç¼–å†™çš„æ§åˆ¶å™¨æ–¹æ³•éƒ½æ²¡æœ‰ç›´æ¥äº§ç”Ÿæµè§ˆå™¨ä¸­æ¸²æŸ“æ‰€éœ€çš„ HTMLã€‚è¿™äº›æ–¹æ³•åªæ˜¯å°†ä¸€äº›æ•°æ®å¡«å……åˆ°æ¨¡å‹ä¸­ï¼Œç„¶åå°†æ¨¡å‹ä¼ é€’ç»™ä¸€ä¸ªç”¨æ¥æ¸²æŸ“çš„è§†å›¾ã€‚è¿™äº›æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª String ç±»å‹çš„å€¼ï¼Œè¿™ä¸ªå€¼æ˜¯è§†å›¾çš„é€»è¾‘åç§°ï¼Œä¸ä¼šç›´æ¥å¼•ç”¨å…·ä½“çš„è§†å›¾å®ç°ã€‚å°½ç®¡æˆ‘ä»¬ä¹Ÿç¼–å†™äº†å‡ ä¸ªç®€å•çš„ Java Server Pageï¼ˆ<code>JSP</code>ï¼‰è§†å›¾ï¼Œä½†æ˜¯æ§åˆ¶å™¨å¹¶ä¸å…³å¿ƒè¿™äº›ã€‚</p>
<p>å°†æ§åˆ¶å™¨ä¸­è¯·æ±‚å¤„ç†çš„é€»è¾‘å’Œè§†å›¾ä¸­çš„æ¸²æŸ“å®ç°è§£è€¦æ˜¯<code> Spring MVC</code> çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ã€‚å¦‚æœæ§åˆ¶å™¨ä¸­çš„æ–¹æ³•ç›´æ¥è´Ÿè´£äº§ç”Ÿ HTML çš„è¯ï¼Œå°±å¾ˆéš¾åœ¨ä¸å½±å“è¯·æ±‚å¤„ç†é€»è¾‘çš„å‰æä¸‹ï¼Œç»´æŠ¤å’Œæ›´æ–°è§†å›¾ã€‚æ§åˆ¶å™¨æ–¹æ³•å’Œè§†å›¾çš„å®ç°ä¼šåœ¨æ¨¡å‹å†…å®¹ä¸Šè¾¾æˆä¸€è‡´ï¼Œè¿™æ˜¯ä¸¤è€…çš„æœ€å¤§å…³è”ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä¸¤è€…åº”è¯¥ä¿æŒè¶³å¤Ÿçš„è·ç¦»ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ§åˆ¶å™¨åªé€šè¿‡é€»è¾‘è§†å›¾åæ¥äº†è§£è§†å›¾çš„è¯ï¼Œé‚£ Spring è¯¥å¦‚ä½•ç¡®å®šä½¿ç”¨å“ªä¸€ä¸ªè§†å›¾å®ç°æ¥æ¸²æŸ“æ¨¡å‹å‘¢ï¼Ÿè¿™å°±æ˜¯ Spring è§†å›¾è§£æå™¨çš„ä»»åŠ¡äº†ã€‚</p>
<p>åœ¨ç¬¬ 5 ç« ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åä¸º <code>InternalResourceViewResolver</code> çš„è§†å›¾è§£æå™¨ã€‚åœ¨å®ƒçš„é…ç½®ä¸­ï¼Œä¸ºäº†å¾—åˆ°è§†å›¾çš„åå­—ï¼Œä¼šä½¿ç”¨ â€œ/WEB-INF/views/â€ å‰ç¼€å’Œ â€œ.jspâ€ åç¼€ï¼Œä»è€Œç¡®å®šæ¥æ¸²æŸ“æ¨¡å‹çš„ <code>JSP</code> æ–‡ä»¶çš„ç‰©ç†ä½ç½®ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹ä¸€ä¸‹è§†å›¾è§£æçš„åŸºç¡€çŸ¥è¯†ä»¥åŠ Spring æä¾›çš„å…¶ä»–è§†å›¾è§£æå™¨ã€‚</p>
<p><code>Spring MVC</code> å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>ViewResolver</code> çš„æ¥å£ï¼Œå®ƒå¤§è‡´å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ViewResolver</span> </span>&#123;    <span class="function">View <span class="title">resolveViewName</span><span class="params">(String viewName, Local local)</span> <span class="keyword">throws</span> Exception</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç»™ resolveViewName() æ–¹æ³•ä¼ å…¥ä¸€ä¸ªè§†å›¾åå’Œ Locale å¯¹è±¡æ—¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª View å®ä¾‹ã€‚View æ˜¯å¦å¤–ä¸€ä¸ªæ¥å£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">View</span> </span>&#123;    <span class="function">String <span class="title">getContentType</span><span class="params">()</span></span>;    <span class="function"><span class="keyword">void</span> <span class="title">render</span><span class="params">(Map&lt;String, ?&gt; model,               HttpServletRequest, request,               HttpServletResponse response)</span> <span class="keyword">throws</span> Exception</span>;&#125;</span><br></pre></td></tr></table></figure>

<p><code>View</code> æ¥å£çš„ä»»åŠ¡å°±æ˜¯æ¥å—æ¨¡å‹ä»¥åŠ <code>Servlet</code> çš„ request å’Œ response å¯¹è±¡ï¼Œå¹¶å°†è¾“å‡ºç»“æœæ¸²æŸ“åˆ° response ä¸­ã€‚</p>
<p>è¿™çœ‹èµ·æ¥éå¸¸ç®€å•ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯ç¼–å†™ <code>ViewResolver</code> å’Œ <code>View</code> çš„å®ç°ï¼Œå°†è¦æ¸²æŸ“çš„å†…å®¹æ”¾åˆ° response ä¸­ï¼Œè¿›è€Œå±•ç°åˆ°ç”¨æˆ·çš„æµè§ˆå™¨ä¸­ã€‚å¯¹å§ï¼Ÿ</p>
<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦è¿™ä¹ˆéº»çƒ¦ã€‚å°½ç®¡æˆ‘ä»¬å¯ä»¥ç¼–å†™ <code>ViewResolver</code> å’Œ <code>View</code> çš„å®ç°ï¼Œåœ¨æœ‰äº›ç‰¹å®šçš„åœºæ™¯ä¸‹ï¼Œè¿™æ ·åšä¹Ÿæ˜¯æœ‰å¿…è¦çš„ï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è®²ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å…³å¿ƒè¿™äº›æ¥å£ã€‚æˆ‘åœ¨è¿™é‡ŒæåŠè¿™äº›æ¥å£åªæ˜¯ä¸ºäº†è®©ä½ å¯¹è§†å›¾è§£æå†…éƒ¨å¦‚ä½•å·¥ä½œæœ‰æ‰€äº†è§£ã€‚Spring æä¾›äº†å¤šä¸ªå†…ç½®çš„å®ç°ï¼Œå¦‚è¡¨ 6.1 æ‰€ç¤ºï¼Œå®ƒä»¬èƒ½å¤Ÿé€‚åº”å¤§å¤šæ•°çš„åœºæ™¯ ã€‚</p>
<center>è¡¨ 6.1ã€€Spring è‡ªå¸¦äº† 13 ä¸ªè§†å›¾è§£æå™¨ï¼Œèƒ½å¤Ÿå°†é€»è¾‘è§†å›¾åè½¬æ¢ä¸ºç‰©ç†å®ç°</center>

<table>
<thead>
<tr>
<th>è§†å›¾è§£æå™¨</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td><code>BeanNameViewResolver</code></td>
<td>å°†è§†å›¾è§£æä¸º Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ beanï¼Œå…¶ä¸­ bean çš„ ID ä¸è§†å›¾çš„åå­—ç›¸åŒ</td>
</tr>
<tr>
<td><code>ContentNegotiatingViewResolver</code></td>
<td>é€šè¿‡è€ƒè™‘å®¢æˆ·ç«¯éœ€è¦çš„å†…å®¹ç±»å‹æ¥è§£æè§†å›¾ï¼Œå§”æ‰˜ç»™å¦å¤–ä¸€ä¸ªèƒ½å¤Ÿäº§ç”Ÿå¯¹åº”å†…å®¹ç±»å‹çš„è§†å›¾è§£æå™¨</td>
</tr>
<tr>
<td><code>FreeMarkerViewResolver</code></td>
<td>å°†è§†å›¾è§£æä¸º <code>FreeMarker</code> æ¨¡æ¿</td>
</tr>
<tr>
<td><code>InternalResourceViewResolver</code></td>
<td>å°†è§†å›¾è§£æä¸º Web åº”ç”¨çš„å†…éƒ¨èµ„æºï¼ˆä¸€èˆ¬ä¸º <code>JSP</code>ï¼‰</td>
</tr>
<tr>
<td><code>JasperReportsViewResolver</code></td>
<td>å°†è§†å›¾è§£æä¸º <code>JasperReports</code> å®šä¹‰</td>
</tr>
<tr>
<td><code>ResourceBundleViewResolver</code></td>
<td>å°†è§†å›¾è§£æä¸ºèµ„æº bundleï¼ˆä¸€èˆ¬ä¸ºå±æ€§æ–‡ä»¶ï¼‰</td>
</tr>
<tr>
<td><code>TilesViewResolver</code></td>
<td>å°†è§†å›¾è§£æä¸º Apache Tile å®šä¹‰ï¼Œå…¶ä¸­tile IDä¸è§†å›¾åç§°ç›¸åŒã€‚æ³¨æ„æœ‰ä¸¤ä¸ªä¸åŒçš„ <code>TilesViewResolver</code> å®ç°ï¼Œåˆ†åˆ«å¯¹åº”äºTiles 2.0 å’Œ Tiles 3.0</td>
</tr>
<tr>
<td><code>UrlBasedViewResolver</code></td>
<td>ç›´æ¥æ ¹æ®è§†å›¾çš„åç§°è§£æè§†å›¾ï¼Œè§†å›¾çš„åç§°ä¼šåŒ¹é…ä¸€ä¸ªç‰©ç†è§†å›¾çš„å®šä¹‰</td>
</tr>
<tr>
<td><code>VelocityLayoutViewResolver</code></td>
<td>å°†è§†å›¾è§£æä¸º Velocity å¸ƒå±€ï¼Œä»ä¸åŒçš„Velocityæ¨¡æ¿ä¸­ç»„åˆé¡µé¢</td>
</tr>
<tr>
<td><code>VelocityViewResolver</code></td>
<td>å°†è§†å›¾è§£æä¸º Velocity æ¨¡æ¿</td>
</tr>
<tr>
<td><code>XmlViewResolver</code></td>
<td>å°†è§†å›¾è§£æä¸ºç‰¹å®š XML æ–‡ä»¶ä¸­çš„ bean å®šä¹‰ã€‚ç±»ä¼¼äº <code>BeanNameViewResolver</code></td>
</tr>
<tr>
<td><code>XsltViewResolver</code></td>
<td>å°†è§†å›¾è§£æä¸º <code>XSLT</code> è½¬æ¢åçš„ç»“æœ</td>
</tr>
</tbody></table>
<p>Spring 4 å’Œ Spring 3.2 æ”¯æŒè¡¨ 6.1ä¸­ çš„æ‰€æœ‰è§†å›¾è§£æå™¨ã€‚Spring 3.1 æ”¯æŒé™¤ Tiles 3 <code>TilesViewResolver</code> ä¹‹å¤–çš„æ‰€æœ‰è§†å›¾è§£æå™¨ã€‚</p>
<p>æˆ‘ä»¬æ²¡æœ‰è¶³å¤Ÿçš„ç¯‡å¹…ä»‹ç» Spring æ‰€æä¾›çš„ 13 ç§è§†å›¾è§£æå™¨ã€‚è¿™å…¶å®ä¹Ÿæ²¡ä»€ä¹ˆï¼Œå› ä¸ºåœ¨å¤§å¤šæ•°åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬åªä¼šç”¨åˆ°å…¶ä¸­å¾ˆå°‘çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>å¯¹äºè¡¨ 6.1 ä¸­çš„å¤§éƒ¨åˆ†è§†å›¾è§£æå™¨æ¥è®²ï¼Œæ¯ä¸€é¡¹éƒ½å¯¹åº” Java Web åº”ç”¨ä¸­ç‰¹å®šçš„æŸç§è§†å›¾æŠ€æœ¯ã€‚<code>InternalResourceViewResolver</code> ä¸€èˆ¬ä¼šç”¨äº <code>JSP</code>ï¼Œ <code>TilesViewResolver</code> ç”¨äº Apache Tiles è§†å›¾ï¼Œè€Œ <code>FreeMarkerViewResolver</code> å’Œ <code>VelocityViewResolver</code> åˆ†åˆ«å¯¹åº” <code>FreeMarker</code> å’Œ Velocity æ¨¡æ¿è§†å›¾ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå…³æ³¨ä¸å¤§å¤šæ•° Java å¼€å‘äººå‘˜æœ€æ¯æ¯ç›¸å…³çš„è§†å›¾æŠ€æœ¯ã€‚å› ä¸ºå¤§å¤šæ•° Java Web åº”ç”¨éƒ½ä¼šç”¨åˆ° <code>JSP</code>ï¼Œæˆ‘ä»¬é¦–å…ˆå°†ä¼šä»‹ç» <code>InternalResourceViewResolver</code>ï¼Œè¿™ä¸ªè§†å›¾è§£æå™¨ä¸€èˆ¬ä¼šç”¨æ¥è§£æ <code>JSP</code> è§†å›¾ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¼šä»‹ç» <code>TilesViewResolver</code>ï¼Œæ§åˆ¶ <code>JSP</code> é¡µé¢çš„å¸ƒå±€ã€‚</p>
<p>åœ¨æœ¬ç« çš„æœ€åï¼Œæˆ‘ä»¬å°†ä¼šçœ‹ä¸€ä¸ªæ²¡æœ‰åˆ—åœ¨è¡¨ 6.1 ä¸­çš„è§†å›¾è§£æå™¨ã€‚<code>Thymeleaf</code> æ˜¯ä¸€ç§ç”¨æ¥æ›¿ä»£ <code>JSP</code> çš„æ–°å…´æŠ€æœ¯ï¼ŒSpring æä¾›äº†ä¸ <code>Thymeleaf</code> çš„åŸç”Ÿæ¨¡æ¿ï¼ˆnatural templateï¼‰åä½œçš„è§†å›¾è§£æå™¨ï¼Œè¿™ç§æ¨¡æ¿ä¹‹æ‰€ä»¥å¾—åˆ°è¿™æ ·çš„ç§°å‘¼æ˜¯å› ä¸ºå®ƒæ›´åƒæ˜¯æœ€ç»ˆäº§ç”Ÿçš„ HTMLï¼Œè€Œä¸æ˜¯é©±åŠ¨å®ƒä»¬çš„ Java ä»£ç ã€‚<code>Thymelea</code>f æ˜¯ä¸€ç§éå¸¸ä»¤äººå…´å¥‹çš„è§†å›¾æ–¹æ¡ˆï¼Œæ‰€ä»¥ä½ å°½å¯ä»¥å…ˆå¾€åç¿»å‡ é¡µï¼Œå» 6.4 èŠ‚çœ‹ä¸€ä¸‹åœ¨ Spring ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨å®ƒçš„ã€‚</p>
<p>å¦‚æœä½ ä¾ç„¶åœç•™åœ¨æœ¬é¡µçš„è¯ï¼Œé‚£ä¹ˆä½ å¯èƒ½çŸ¥é“ <code>JSP</code> æ›¾ç»æ˜¯ï¼Œè€Œä¸”ç°åœ¨ä¾ç„¶è¿˜æ˜¯ Java é¢†åŸŸå ä¸»å¯¼åœ°ä½çš„è§†å›¾æŠ€æœ¯ã€‚åœ¨ä»¥å‰çš„é¡¹ç›®ä¸­ï¼Œä¹Ÿè®¸ä½ ä½¿ç”¨è¿‡ <code>JSP</code>ï¼Œå°†æ¥æœ‰å¯èƒ½è¿˜ä¼šç»§ç»­ä½¿ç”¨è¿™é¡¹æŠ€æœ¯ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ <code>Spring MVC</code>ä¸­ä½¿ç”¨ <code>JSP</code> è§†å›¾ã€‚</p>
<h3 id="åˆ›å»º-JSP-è§†å›¾"><a href="#åˆ›å»º-JSP-è§†å›¾" class="headerlink" title="åˆ›å»º JSP è§†å›¾"></a>åˆ›å»º <code>JSP</code> è§†å›¾</h3><p>ä¸ç®¡ä½ æ˜¯å¦ç›¸ä¿¡ï¼ŒJava Server Pages ä½œä¸º Java Web åº”ç”¨ç¨‹åºçš„è§†å›¾æŠ€æœ¯å·²ç»è¶…è¿‡ 15 å¹´äº†ã€‚å°½ç®¡å¼€å§‹çš„æ—¶å€™å®ƒå¾ˆä¸‘é™‹ï¼Œåªæ˜¯ç±»ä¼¼æ¨¡æ¿æŠ€æœ¯ï¼ˆå¦‚ Microsoft çš„ Active Server Pagesï¼‰çš„ Java ç‰ˆæœ¬ï¼Œä½† <code>JSP</code> è¿™äº›å¹´åœ¨ä¸æ–­è¿›åŒ–ï¼ŒåŒ…å«äº†å¯¹è¡¨è¾¾å¼è¯­è¨€å’Œè‡ªå®šä¹‰æ ‡ç­¾åº“çš„æ”¯æŒã€‚</p>
<p>Spring æä¾›äº†ä¸¤ç§æ”¯æŒ <code>JSP</code> è§†å›¾çš„æ–¹å¼ï¼š</p>
<ul>
<li><code>InternalResourceViewResolver</code> ä¼šå°†è§†å›¾åè§£æä¸º <code>JSP</code> æ–‡ä»¶ã€‚å¦å¤–ï¼Œå¦‚æœåœ¨ä½ çš„ <code>JSP</code> é¡µé¢ä¸­ä½¿ç”¨äº† <code>JSP</code> æ ‡å‡†æ ‡ç­¾åº“ï¼ˆJava Server Pages Standard Tag Libraryï¼Œ<code>JSTL</code>ï¼‰çš„è¯ï¼Œ<code>InternalResourceViewResolver</code> èƒ½å¤Ÿå°†è§†å›¾åè§£æä¸º <code>JstlView</code> å½¢å¼çš„ <code>JSP</code> æ–‡ä»¶ï¼Œä»è€Œå°† <code>JSTL</code> æœ¬åœ°åŒ–å’Œèµ„æº bundle å˜é‡æš´éœ²ç»™ <code>JSTL</code> çš„æ ¼å¼åŒ– ï¼ˆformattingï¼‰å’Œä¿¡æ¯ï¼ˆmessageï¼‰æ ‡ç­¾ã€‚</li>
<li>Spring æä¾›äº†ä¸¤ä¸ª <code>JSP</code> æ ‡ç­¾åº“ï¼Œä¸€ä¸ªç”¨äºè¡¨å•åˆ°æ¨¡å‹çš„ç»‘å®šï¼Œå¦ä¸€ä¸ªæä¾›äº†é€šç”¨çš„å·¥å…·ç±»ç‰¹æ€§ã€‚</li>
</ul>
<p>ä¸ç®¡ä½ ä½¿ç”¨ <code>JSTL</code>ï¼Œè¿˜æ˜¯å‡†å¤‡ä½¿ç”¨ Spring çš„ <code>JSP</code> æ ‡ç­¾åº“ï¼Œé…ç½®è§£æ <code>JSP</code> çš„è§†å›¾è§£æå™¨éƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚å°½ç®¡ Spring è¿˜æœ‰å…¶ä»–çš„å‡ ä¸ªè§†å›¾è§£æå™¨éƒ½èƒ½å°†è§†å›¾åæ˜ å°„ä¸º <code>JSP</code> æ–‡ä»¶ï¼Œä½†å°±è¿™é¡¹ä»»åŠ¡æ¥è®²ï¼Œ<code>InternalResourceViewResolver</code> æ˜¯æœ€ç®€å•å’Œæœ€å¸¸ç”¨çš„è§†å›¾è§£æå™¨ã€‚</p>
<p>æˆ‘ä»¬åœ¨ç¬¬ 5 ç« å·²ç»æ¥è§¦åˆ°äº†å¦‚ä½•é…ç½® <code>InternalResourceViewResolver</code>ã€‚ä½†æ˜¯åœ¨é‚£é‡Œï¼Œæˆ‘ä»¬åªæ˜¯åŒ†å¿™ä½“éªŒäº†ä¸€ä¸‹ï¼Œä»¥ä¾¿äºæŸ¥çœ‹æ§åˆ¶å™¨åœ¨æµè§ˆå™¨ä¸­çš„æ•ˆæœã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¼šæ›´åŠ ä»”ç»†åœ°äº†è§£ <code>InternalResourceViewResolver</code>ï¼Œçœ‹çœ‹å¦‚ä½•è®©å®ƒå®Œå…¨å¬å‘½äºæˆ‘ä»¬ã€‚</p>
<h4 id="é…ç½®é€‚ç”¨äº-JSP-çš„è§†å›¾è§£æå™¨"><a href="#é…ç½®é€‚ç”¨äº-JSP-çš„è§†å›¾è§£æå™¨" class="headerlink" title="é…ç½®é€‚ç”¨äº JSP çš„è§†å›¾è§£æå™¨"></a>é…ç½®é€‚ç”¨äº <code>JSP</code> çš„è§†å›¾è§£æå™¨</h4><p>æœ‰ä¸€äº›è§†å›¾è§£æå™¨ï¼Œå¦‚ ResourceBundleViewResolver ä¼šç›´æ¥å°†é€»è¾‘è§†å›¾åæ˜ å°„ä¸ºç‰¹å®šçš„ View æ¥å£å®ç°ï¼Œè€Œ <code>InternalResourceViewResolver</code> æ‰€é‡‡å–çš„æ–¹å¼å¹¶ä¸é‚£ä¹ˆç›´æ¥ã€‚å®ƒéµå¾ªä¸€ç§çº¦å®šï¼Œä¼šåœ¨è§†å›¾åä¸Šæ·»åŠ å‰ç¼€å’Œåç¼€ï¼Œè¿›è€Œç¡®å®šä¸€ä¸ª Web åº”ç”¨ä¸­è§†å›¾èµ„æºçš„ç‰©ç†è·¯å¾„ã€‚</p>
<p>ä½œä¸ºæ ·ä¾‹ï¼Œè€ƒè™‘ä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼Œå‡è®¾é€»è¾‘è§†å›¾åä¸º homeã€‚é€šç”¨çš„å®è·µæ˜¯å°† <code>JSP</code> æ–‡ä»¶æ”¾åˆ° Web åº”ç”¨çš„ WEB-INF ç›®å½•ä¸‹ï¼Œé˜²æ­¢å¯¹å®ƒçš„ç›´æ¥è®¿é—®ã€‚å¦‚æœæˆ‘ä»¬å°†æ‰€æœ‰çš„ <code>JSP</code> æ–‡ä»¶éƒ½æ”¾åœ¨ â€œ/WEB-INF/views/â€ ç›®å½•ä¸‹ï¼Œå¹¶ä¸” home é¡µçš„ <code>JSP</code> åä¸º <code>home.jsp</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç¡®å®šç‰©ç†è§†å›¾çš„è·¯å¾„å°±æ˜¯é€»è¾‘è§†å›¾å home å†åŠ ä¸Š â€œ/WEB-INF/views/â€ å‰ç¼€å’Œ â€œ.jspâ€ åç¼€ã€‚å¦‚å›¾ 6.1 æ‰€ç¤ºã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211022204227004.png" alt="image-20211022204227004"></p>
<center>å›¾ 6.1ã€€InternalResourceViewResolverè§£æè§†å›¾æ—¶ï¼Œä¼šåœ¨è§†å›¾åä¸Šæ·»åŠ å‰ç¼€å’Œåç¼€</center>

<p>å½“ä½¿ç”¨ @Bean æ³¨è§£çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼é…ç½® <code>InternalResourceViewResolver</code>ï¼Œä½¿å…¶åœ¨è§£æè§†å›¾æ—¶ï¼Œéµå¾ªä¸Šè¿°çš„çº¦å®šã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">ViewResolver <span class="title">viewResolver</span><span class="params">()</span> </span>&#123;    InternalResourceViewResolver resolver = <span class="keyword">new</span> InternalResourceViewResolver();    resolver.setPrefix(<span class="string">&quot;WEB-INF/views&quot;</span>);    resolver.setSuffix(<span class="string">&quot;.jsp&quot;</span>);    <span class="keyword">return</span> resolver;&#125;</span><br></pre></td></tr></table></figure>

<p>ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆï¼Œå¦‚æœä½ æ›´å–œæ¬¢ä½¿ç”¨åŸºäº XML çš„ Spring é…ç½®ï¼Œé‚£ä¹ˆå¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼é…ç½® <code>InternalResourceViewResolver</code>ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;ViewResolver&quot;</span>       <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>      <span class="attr">P:prefix</span>=<span class="string">&quot;WEB-INF/views&quot;</span>      <span class="attr">P:suffix</span>=<span class="string">&quot;.jsp&quot;</span></span></span><br></pre></td></tr></table></figure>

<p><code>InternalResourceViewResolver</code> é…ç½®å°±ç»ªä¹‹åï¼Œå®ƒå°±ä¼šå°†é€»è¾‘è§†å›¾åè§£æä¸º <code>JSP</code> æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li><p>home å°†ä¼šè§£æä¸º â€œ/WEB-INF/views/home.jspâ€</p>
</li>
<li><p>productList å°†ä¼šè§£æä¸º â€œ/WEB-INF/views/productList.jspâ€</p>
</li>
<li><p>books/detail å°†ä¼šè§£æä¸º â€œ/WEB-INF/views/books/detail.jspâ€</p>
</li>
</ul>
<p>è®©æˆ‘ä»¬é‡ç‚¹çœ‹ä¸€ä¸‹æœ€åä¸€ä¸ªæ ·ä¾‹ã€‚å½“é€»è¾‘è§†å›¾åä¸­åŒ…å«æ–œçº¿æ—¶ï¼Œè¿™ä¸ªæ–œçº¿ä¹Ÿä¼šå¸¦åˆ°èµ„æºçš„è·¯å¾„åä¸­ã€‚å› æ­¤ï¼Œå®ƒä¼šå¯¹åº”åˆ° prefixå±æ€§æ‰€å¼•ç”¨ç›®å½•çš„å­ç›®å½•ä¸‹çš„ JSP æ–‡ä»¶ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†è§†å›¾æ¨¡æ¿ç»„ç»‡ä¸ºå±‚çº§ç›®å½•ç»“æ„ï¼Œè€Œä¸æ˜¯å°†å®ƒä»¬éƒ½æ”¾åˆ°åŒä¸€ä¸ªç›®å½•ä¹‹ä¸­ã€‚</p>
<p>è§£æ JSTL è§†å›¾</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯¹ <code>InternalResourceViewResolver</code> çš„é…ç½®éƒ½å¾ˆåŸºç¡€å’Œç®€å•ã€‚å®ƒæœ€ç»ˆä¼šå°†é€»è¾‘è§†å›¾åè§£æä¸º <code>InternalResourceView</code> å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹ä¼šå¼•ç”¨ <code>JSP</code>æ–‡ä»¶ã€‚ä½†æ˜¯å¦‚æœè¿™äº› <code>JSP</code> ä½¿ç”¨ <code>JSTL</code> æ ‡ç­¾æ¥å¤„ç†æ ¼å¼åŒ–å’Œä¿¡æ¯çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šå¸Œæœ› <code>InternalResourceViewResolver</code> å°†è§†å›¾è§£æä¸º <code>JstlView</code>ã€‚</p>
<p><code>JSTL</code> çš„æ ¼å¼åŒ–æ ‡ç­¾éœ€è¦ä¸€ä¸ª Locale å¯¹è±¡ï¼Œä»¥ä¾¿äºæ°å½“åœ°æ ¼å¼åŒ–åœ°åŸŸç›¸å…³çš„å€¼ï¼Œå¦‚æ—¥æœŸå’Œè´§å¸ã€‚ä¿¡æ¯æ ‡ç­¾å¯ä»¥å€ŸåŠ© Spring çš„ä¿¡æ¯èµ„æºå’Œ Localeï¼Œä»è€Œé€‰æ‹©é€‚å½“çš„ä¿¡æ¯æ¸²æŸ“åˆ° HTML ä¹‹ä¸­ã€‚é€šè¿‡è§£æ <code>JstlView</code>ï¼Œ<code>JSTL</code> èƒ½å¤Ÿè·å¾— Locale å¯¹è±¡ä»¥åŠ Spring ä¸­é…ç½®çš„ä¿¡æ¯èµ„æºã€‚</p>
<p>å¦‚æœæƒ³è®© <code>InternalResourceViewResolver</code> å°†è§†å›¾è§£æä¸º <code>JstlView</code>ï¼Œè€Œä¸æ˜¯ <code>InternalResourceView</code> çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è®¾ç½®å®ƒçš„ <code>viewClass</code> å±æ€§å³å¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">ViewResolver <span class="title">viewResolver</span><span class="params">()</span> </span>&#123;    InternalResourceViewResolver resolver = <span class="keyword">new</span> InternalResourceViewResolver();    resolver.setPrefix(<span class="string">&quot;WEB-INF/views/&quot;</span>);    resolver.setSuffix(<span class="string">&quot;.jsp&quot;</span>);    resolver.setViewClass(org.springframework.web.servlet.view.JstlView.class);    <span class="keyword">return</span> resovler;&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨XMLå®Œæˆè¿™ä¸€ä»»åŠ¡ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;viewResolver&quot;</span>       <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlewt.view.InternalResourceViewResolver&quot;</span>      <span class="attr">p:prefix</span>=<span class="string">&quot;WEB-INF/view&quot;</span>      <span class="attr">p:suffix</span>=<span class="string">&quot;.jsp&quot;</span>      <span class="attr">p:viewClass</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡ä½¿ç”¨ Java é…ç½®è¿˜æ˜¯ä½¿ç”¨ XMLï¼Œéƒ½èƒ½ç¡®ä¿ JSTL çš„æ ¼å¼åŒ–å’Œä¿¡æ¯æ ‡ç­¾èƒ½å¤Ÿè·å¾— Locale å¯¹è±¡ä»¥åŠ Spring ä¸­é…ç½®çš„ä¿¡æ¯èµ„æºã€‚</p>
<h4 id="ä½¿ç”¨-Spring-çš„-JSP-åº“"><a href="#ä½¿ç”¨-Spring-çš„-JSP-åº“" class="headerlink" title="ä½¿ç”¨ Spring çš„ JSP åº“"></a>ä½¿ç”¨ Spring çš„ JSP åº“</h4><p>å½“ä¸º JSP æ·»åŠ åŠŸèƒ½æ—¶ï¼Œæ ‡ç­¾åº“æ˜¯ä¸€ç§å¾ˆå¼ºå¤§çš„æ–¹å¼ï¼Œèƒ½å¤Ÿé¿å…åœ¨è„šæœ¬å—ä¸­ç›´æ¥ç¼–å†™ Java ä»£ç ã€‚Spring æä¾›äº†ä¸¤ä¸ª JSP æ ‡ç­¾åº“ï¼Œç”¨æ¥å¸®åŠ©å®šä¹‰ Spring MVC Web çš„è§†å›¾ã€‚å…¶ä¸­ä¸€ä¸ªæ ‡ç­¾åº“ä¼šç”¨æ¥æ¸²æŸ“ HTML è¡¨å•æ ‡ç­¾ï¼Œè¿™äº›æ ‡ç­¾å¯ä»¥ç»‘å®š model ä¸­çš„æŸä¸ªå±æ€§ã€‚å¦å¤–ä¸€ä¸ªæ ‡ç­¾åº“åŒ…å«äº†ä¸€äº›å·¥å…·ç±»æ ‡ç­¾ï¼Œæˆ‘ä»¬éšæ—¶éƒ½å¯ä»¥éå¸¸ä¾¿åˆ©åœ°ä½¿ç”¨å®ƒä»¬ã€‚</p>
<p>åœ¨è¿™ä¸¤ä¸ªæ ‡ç­¾åº“ä¸­ï¼Œä½ å¯èƒ½ä¼šå‘ç°è¡¨å•ç»‘å®šçš„æ ‡ç­¾åº“æ›´åŠ æœ‰ç”¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±ä»è¿™ä¸ªæ ‡ç­¾åº“å¼€å§‹å­¦ä¹  Spring çš„ JSP æ ‡ç­¾ã€‚æˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•å°† Spittr åº”ç”¨çš„æ³¨å†Œè¡¨å•ç»‘å®šåˆ°æ¨¡å‹ä¸Šï¼Œè¿™æ ·è¡¨å•å°±å¯ä»¥é¢„å…ˆå¡«å……å€¼ï¼Œå¹¶ä¸”åœ¨è¡¨å•æäº¤å¤±è´¥åï¼Œèƒ½å¤Ÿå±•ç°æ ¡éªŒé”™è¯¯ã€‚</p>
<p>å°†è¡¨å•ç»‘å®šåˆ°æ¨¡å‹ä¸Š</p>
<p>Springçš„è¡¨å•ç»‘å®š JSP æ ‡ç­¾åº“åŒ…å«äº†14ä¸ªæ ‡ç­¾ï¼Œå®ƒä»¬ä¸­çš„å¤§å¤šæ•°éƒ½ç”¨æ¥æ¸²æŸ“ HTML ä¸­çš„è¡¨å•æ ‡ç­¾ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬ä¸åŸç”Ÿ HTML æ ‡ç­¾çš„åŒºåˆ«åœ¨äºå®ƒä»¬ä¼šç»‘å®šæ¨¡å‹ä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œèƒ½å¤Ÿæ ¹æ®æ¨¡å‹ä¸­å¯¹è±¡çš„å±æ€§å¡«å……å€¼ã€‚æ ‡ç­¾åº“ä¸­è¿˜åŒ…å«äº†ä¸€ä¸ªä¸ºç”¨æˆ·å±•ç°é”™è¯¯çš„æ ‡ç­¾ï¼Œå®ƒä¼šå°†é”™è¯¯ä¿¡æ¯æ¸²æŸ“åˆ°æœ€ç»ˆçš„ HTML ä¹‹ä¸­ã€‚</p>
<p>ä¸ºäº†ä½¿ç”¨è¡¨å•ç»‘å®šåº“ï¼Œéœ€è¦åœ¨ JSP é¡µé¢ä¸­å¯¹å…¶è¿›è¡Œå£°æ˜ï¼š</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib url=<span class="string">&quot;http://www.springframework.org/tags/form&quot;</span> prefix=<span class="string">&quot;sf&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„ï¼Œæˆ‘å°†å‰ç¼€æŒ‡å®šä¸º â€œsfâ€ï¼Œä½†é€šå¸¸ä¹Ÿå¯èƒ½ä½¿ç”¨ â€œformâ€ å‰ç¼€ã€‚ä½ å¯ä»¥é€‰æ‹©ä»»æ„å–œæ¬¢çš„å‰ç¼€ï¼Œæˆ‘ä¹‹æ‰€ä»¥é€‰æ‹© â€œsfâ€ æ˜¯å› ä¸ºå®ƒå¾ˆç®€æ´ã€æ˜“äºè¾“å…¥ï¼Œå¹¶ä¸”è¿˜æ˜¯ Spring  form çš„ç®€å†™å½¢å¼ã€‚åœ¨æœ¬ä¹¦ä¸­ï¼Œå½“ä½¿ç”¨è¡¨å•ç»‘å®šåº“çš„æ—¶å€™ï¼Œæˆ‘ä¼šä¸€ç›´ä½¿ç”¨â€œsfâ€å‰ç¼€ã€‚</p>
<p>åœ¨å£°æ˜å®Œè¡¨å•ç»‘å®šæ ‡ç­¾åº“ä¹‹åï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ 14 ä¸ªç›¸å…³çš„æ ‡ç­¾äº†ã€‚å¦‚è¡¨ 6.2 æ‰€ç¤ºã€‚</p>
<center>è¡¨ 6.2ã€€å€ŸåŠ© Spring è¡¨å•ç»‘å®šæ ‡ç­¾åº“ä¸­æ‰€åŒ…å«çš„æ ‡ç­¾ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°†æ¨¡å‹å¯¹è±¡ç»‘å®šåˆ°æ¸²æŸ“åçš„ HTML è¡¨å•ä¸­</center>

<table>
<thead>
<tr>
<th align="left">JSP æ ‡ç­¾</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>&lt;sf:checkbox&gt;</code></td>
<td>æ¸²æŸ“æˆä¸€ä¸ªHTML  <code>&lt;input&gt;</code> æ ‡ç­¾ï¼Œå…¶ä¸­ type å±æ€§è®¾ç½®ä¸º checkbox</td>
</tr>
<tr>
<td align="left"><code>&lt;sf:checkboxes&gt;</code></td>
<td>æ¸²æŸ“æˆå¤šä¸ªHTML <code>&lt;input&gt;</code>æ ‡ç­¾ï¼Œå…¶ä¸­ type å±æ€§è®¾ç½®ä¸º checkbox</td>
</tr>
<tr>
<td align="left"><code>&lt;sf:errors&gt;</code></td>
<td>åœ¨ä¸€ä¸ªHTML <code>&lt;span&gt;</code>ä¸­æ¸²æŸ“è¾“å…¥åŸŸçš„é”™è¯¯</td>
</tr>
<tr>
<td align="left"><code>&lt;sf:form&gt;</code></td>
<td>æ¸²æŸ“æˆä¸€ä¸ªHTML <code>&lt;form&gt;</code>æ ‡ç­¾ï¼Œå¹¶ä¸ºå…¶å†…éƒ¨æ ‡ç­¾æš´éœ²ç»‘å®šè·¯å¾„ï¼Œç”¨äºæ•°æ®ç»‘å®š</td>
</tr>
<tr>
<td align="left"><code>&lt;sf:hidden&gt; </code></td>
<td>æ¸²æŸ“æˆä¸€ä¸ªHTML <code>&lt;input&gt;</code>æ ‡ç­¾ï¼Œå…¶ä¸­ type å±æ€§è®¾ç½®ä¸º hidden</td>
</tr>
<tr>
<td align="left"><code>&lt;sf:input&gt;</code></td>
<td>æ¸²æŸ“æˆä¸€ä¸ªHTML <code>&lt;input&gt;</code>æ ‡ç­¾ï¼Œå…¶ä¸­ type å±æ€§è®¾ç½®ä¸º text</td>
</tr>
<tr>
<td align="left"><code>&lt;sf:label&gt;</code></td>
<td>æ¸²æŸ“æˆä¸€ä¸ªHTML <code>&lt;label&gt;</code>æ ‡ç­¾</td>
</tr>
<tr>
<td align="left"><code>&lt;sf:option&gt;</code></td>
<td>æ¸²æŸ“æˆä¸€ä¸ªHTML <code>&lt;option&gt;</code>æ ‡ç­¾ï¼Œå…¶ selected å±æ€§æ ¹æ®æ‰€ç»‘å®šçš„å€¼è¿›è¡Œè®¾ç½®</td>
</tr>
<tr>
<td align="left"><code>&lt;sf:options&gt;</code></td>
<td>æŒ‰ç…§ç»‘å®šçš„é›†åˆã€æ•°ç»„æˆ–Mapï¼Œæ¸²æŸ“æˆä¸€ä¸ªHTML<code> &lt;option&gt;</code>æ ‡ç­¾çš„åˆ—è¡¨</td>
</tr>
<tr>
<td align="left"><code>&lt;sf:password&gt;</code></td>
<td>æ¸²æŸ“æˆä¸€ä¸ªHTML <code>&lt;input&gt;</code>æ ‡ç­¾ï¼Œå…¶ä¸­ type å±æ€§è®¾ç½®ä¸º password</td>
</tr>
<tr>
<td align="left"><code>&lt;sf:radiobutton&gt;</code></td>
<td>æ¸²æŸ“æˆä¸€ä¸ªHTML <code>&lt;input&gt;</code>æ ‡ç­¾ï¼Œå…¶ä¸­ type å±æ€§è®¾ç½®ä¸º radio</td>
</tr>
<tr>
<td align="left"><code>&lt;sf:radiobuttons&gt; </code></td>
<td>æ¸²æŸ“æˆå¤šä¸ªHTML <code>&lt;input&gt;</code>æ ‡ç­¾ï¼Œå…¶ä¸­ type å±æ€§è®¾ç½®ä¸º radio</td>
</tr>
<tr>
<td align="left"><code>&lt;sf:select&gt; </code></td>
<td>æ¸²æŸ“ä¸ºä¸€ä¸ªHTML <code>&lt;select&gt;</code>æ ‡ç­¾</td>
</tr>
<tr>
<td align="left"><code>&lt;sf:textarea&gt; </code></td>
<td>æ¸²æŸ“ä¸ºä¸€ä¸ªHTML <code>&lt;textarea&gt;</code>æ ‡ç­¾</td>
</tr>
</tbody></table>
<p>è¦åœ¨ä¸€ä¸ªæ ·ä¾‹ä¸­ä»‹ç»æ‰€æœ‰çš„è¿™äº›æ ‡ç­¾æ˜¯å¾ˆå›°éš¾çš„ï¼Œå¦‚æœä¸€å®šè¦è¿™æ ·åšçš„è¯ï¼Œè‚¯å®šä¹Ÿä¼šéå¸¸ç‰µå¼ºã€‚å°± Spittr æ ·ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬åªä¼šç”¨åˆ°é€‚åˆäº Spittr åº”ç”¨ä¸­æ³¨å†Œè¡¨å•çš„æ ‡ç­¾ã€‚å…·ä½“æ¥è®²ï¼Œä¹Ÿå°±æ˜¯ <code>&lt;sf:form&gt;</code>ã€<code>&lt;sf:input&gt;</code> å’Œ <code>&lt;sf:password&gt;</code>ã€‚åœ¨æ³¨å†Œ JSP ä¸­ä½¿ç”¨è¿™äº›æ ‡ç­¾åï¼Œæ‰€å¾—åˆ°çš„ç¨‹åºå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;sf:form method=<span class="string">&quot;POST&quot;</span> commandName=<span class="string">&quot;spitter&quot;</span>&gt;	First Name: &lt;sf:input path=<span class="string">&quot;firstName&quot;</span> /&gt;&lt;br/&gt;    Last Name: &lt;sf:input path=<span class="string">&quot;lastName&quot;</span> /&gt;&lt;br/&gt;    Email: &lt;sf:input path=<span class="string">&quot;email&quot;</span> /&gt;&lt;br/&gt;    Username: &lt;sf:input path=<span class="string">&quot;username&quot;</span> /&gt;&lt;br/&gt;    Password: &lt;sf:password path=<span class="string">&quot;password&quot;</span> /&gt;&lt;br/&gt;    &lt;input type=<span class="string">&quot;submit&quot;</span> Value=<span class="string">&quot;Register&quot;</span> /&gt;&lt;/sf:form&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;sf:form&gt;</code> ä¼šæ¸²æŸ“ä¼šä¸€ä¸ª HTML  <code>&lt;form&gt;</code> æ ‡ç­¾ï¼Œä½†å®ƒä¹Ÿä¼šé€šè¿‡ <code>commandName</code> å±æ€§æ„å»ºé’ˆå¯¹æŸä¸ªæ¨¡å‹å¯¹è±¡çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚åœ¨å…¶ä»–çš„è¡¨å•ç»‘å®šæ ‡ç­¾ä¸­ï¼Œä¼šå¼•ç”¨è¿™ä¸ªæ¨¡å‹å¯¹è±¡çš„å±æ€§ã€‚</p>
<p>åœ¨ä¹‹å‰çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°† <code>commandName</code> å±æ€§è®¾ç½®ä¸º <code>spitter</code>ã€‚å› æ­¤ï¼Œåœ¨æ¨¡å‹ä¸­å¿…é¡»è¦æœ‰ä¸€ä¸ª key ä¸º <code>spitter</code> çš„å¯¹è±¡ï¼Œå¦åˆ™çš„è¯ï¼Œè¡¨å•ä¸èƒ½æ­£å¸¸æ¸²æŸ“ï¼ˆä¼šå‡ºç° <code>JSP</code> é”™è¯¯ï¼‰ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹ <code>SpitterController</code>ï¼Œä»¥ç¡®ä¿æ¨¡å‹ä¸­å­˜åœ¨ä»¥ <code>spitter</code> ä¸º key çš„ <code>Spitter</code> å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/register&quot;, method=GET)</span><span class="function"><span class="keyword">public</span> String <span class="title">showRegistrationForm</span><span class="params">(Model model)</span> </span>&#123;    model.addAttribute(<span class="keyword">new</span> Spitter());    <span class="keyword">return</span> <span class="string">&quot;registerForm&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹åçš„ showRegistrationForm() æ–¹æ³•ä¸­ï¼Œæ–°å¢äº†ä¸€ä¸ª Spitter å®ä¾‹åˆ°æ¨¡å‹ä¸­ã€‚æ¨¡å‹ä¸­çš„ key æ˜¯æ ¹æ®å¯¹è±¡ç±»å‹æ¨æ–­å¾—åˆ°çš„ï¼Œä¹Ÿå°±æ˜¯ spitterï¼Œä¸æˆ‘ä»¬æ‰€éœ€è¦çš„å®Œå…¨ä¸€è‡´ã€‚</p>
<p>å›åˆ°è¿™ä¸ªè¡¨å•ä¸­ï¼Œå‰å››ä¸ªè¾“å…¥åŸŸå°† HTML <code>&lt;input&gt;</code>æ ‡ç­¾æ”¹æˆäº†<code>&lt;sf:input&gt;</code>ã€‚è¿™ä¸ªæ ‡ç­¾ä¼šæ¸²æŸ“æˆä¸€ä¸ª HTML <code>&lt;input&gt;</code>æ ‡ç­¾ï¼Œå¹¶ä¸” type å±æ€§å°†ä¼šè®¾ç½®ä¸º textã€‚æˆ‘ä»¬åœ¨è¿™é‡Œè®¾ç½®äº† path å±æ€§ï¼Œ<code>&lt;input&gt;</code>æ ‡ç­¾çš„ value å±æ€§å€¼å°†ä¼šè®¾ç½®ä¸ºæ¨¡å‹å¯¹è±¡ä¸­ path å±æ€§æ‰€å¯¹åº”çš„å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨æ¨¡å‹ä¸­ Spitter å¯¹è±¡çš„ firstName å±æ€§å€¼ä¸º Jackï¼Œé‚£ä¹ˆ<code> &lt;sf:input path=&quot;firstName&quot;/&gt;</code> æ‰€æ¸²æŸ“çš„ <code>&lt;input&gt;</code> æ ‡ç­¾ä¸­ï¼Œä¼šå­˜åœ¨ value=â€Jackâ€ã€‚</p>
<p>å¯¹äº password è¾“å…¥åŸŸï¼Œæˆ‘ä»¬ä½¿ç”¨<code>&lt;sf:password&gt;</code>æ¥ä»£æ›¿ <code>&lt;sf:input&gt;</code>ã€‚<code>&lt;sf:password&gt;</code> ä¸ <code>&lt;sf:input&gt;</code> ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒæ‰€æ¸²æŸ“çš„ HTML <code>&lt;input&gt;</code> æ ‡ç­¾ä¸­ï¼Œä¼šå°†  type å±æ€§è®¾ç½®ä¸º passwordï¼Œè¿™æ ·å½“è¾“å…¥çš„æ—¶å€™ï¼Œå®ƒçš„å€¼ä¸ä¼šç›´æ¥æ˜æ–‡æ˜¾ç¤ºã€‚</p>
<p>ä¸ºäº†å¸®åŠ©è¯»è€…äº†è§£æœ€ç»ˆçš„ HTML çœ‹èµ·æ¥æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œå‡è®¾æœ‰ä¸ªç”¨æˆ·å·²ç»æäº¤äº†è¡¨å•ï¼Œä½†å€¼éƒ½æ˜¯ä¸åˆæ³•çš„ã€‚æ ¡éªŒå¤±è´¥åï¼Œç”¨æˆ·ä¼šè¢«é‡å®šå‘åˆ°æ³¨å†Œè¡¨å•ï¼Œæœ€ç»ˆçš„HTML <code>&lt;form&gt;</code>å…ƒç´ å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;spitter&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/spitter/spitter/register&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span>    First Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;firstName&quot;</span> <span class="attr">name</span>=<span class="string">&quot;firstName&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;J&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>    Last Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;B&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>    Email: <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jack&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>    Username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jack&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>    Password: <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Register&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä» Spring 3.1 å¼€å§‹ï¼Œ<code>&lt;sf:input&gt;</code> æ ‡ç­¾èƒ½å¤Ÿå…è®¸æˆ‘ä»¬æŒ‡å®š type å±æ€§ï¼Œè¿™æ ·çš„è¯ï¼Œé™¤äº†å…¶ä»–å¯é€‰çš„ç±»å‹å¤–ï¼Œè¿˜èƒ½æŒ‡å®š HTML 5 ç‰¹å®šç±»å‹çš„æ–‡æœ¬åŸŸï¼Œå¦‚ dateã€range å’Œ emailã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼æŒ‡å®š email åŸŸï¼š</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Email: &lt;sf:input path=<span class="string">&quot;email&quot;</span> type=<span class="string">&quot;email&quot;</span> /&gt;&lt;br/&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æ‰€æ¸²æŸ“å¾—åˆ°çš„ HTML å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Email: <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jack&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç›¸å¯¹äºæ ‡å‡†çš„ HTML æ ‡ç­¾ï¼Œä½¿ç”¨ Springçš„è¡¨å•ç»‘å®šæ ‡ç­¾èƒ½å¤Ÿå¸¦æ¥ä¸€å®šçš„åŠŸèƒ½æå‡ï¼Œåœ¨æ ¡éªŒå¤±è´¥åï¼Œè¡¨å•ä¸­ä¼šé¢„å…ˆå¡«å……ä¹‹å‰è¾“å…¥çš„å€¼ã€‚ä½†æ˜¯ï¼Œè¿™ä¾ç„¶æ²¡æœ‰å‘Šè¯‰ç”¨æˆ·é”™åœ¨ä»€ä¹ˆåœ°æ–¹ã€‚ä¸ºäº†æŒ‡å¯¼ç”¨æˆ·çŸ«æ­£é”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>&lt;sf:errors&gt;</code>ã€‚</p>
<p>å±•ç°é”™è¯¯</p>
<p>å¦‚æœå­˜åœ¨æ ¡éªŒé”™è¯¯çš„è¯ï¼Œè¯·æ±‚ä¸­ä¼šåŒ…å«é”™è¯¯çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æ˜¯ä¸æ¨¡å‹æ•°æ®æ”¾åˆ°ä¸€èµ·çš„ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯åˆ°æ¨¡å‹ä¸­å°†è¿™äº›æ•°æ®æŠ½å–å‡ºæ¥ï¼Œå¹¶å±•ç°ç»™ç”¨æˆ·ã€‚<code>&lt;sf:errors&gt;</code> èƒ½å¤Ÿè®©è¿™é¡¹ä»»åŠ¡å˜å¾—å¾ˆç®€å•ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å°† <code>&lt;sf:errors&gt;</code> ç”¨åˆ° <code>registerForm.jsp</code> ä¸­çš„ä»£ç ç‰‡æ®µï¼š</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;sf:form method=<span class="string">&quot;POST&quot;</span> commandName=<span class="string">&quot;spitter&quot;</span>&gt;	First Name: &lt;sf:input path=<span class="string">&quot;firstName&quot;</span> /&gt;    &lt;sf:errors path=<span class="string">&quot;firstName&quot;</span>/&gt;&lt;br/&gt;    ...&lt;/sf:form&gt;</span><br></pre></td></tr></table></figure>

<p>å°½ç®¡æˆ‘åªå±•ç°äº†å°† <code>&lt;sf:errors&gt;</code> ç”¨åˆ° First Name è¾“å…¥åŸŸçš„åœºæ™¯ï¼Œä½†æ˜¯å®ƒå¯ä»¥æŒ‰ç…§åŒæ ·ç®€å•çš„æ–¹å¼ç”¨åˆ°æ³¨å†Œè¡¨å•çš„å…¶ä»–è¾“å…¥åŸŸä¸­ã€‚åœ¨è¿™é‡Œï¼Œå®ƒçš„ path å±æ€§è®¾ç½®æˆäº† firstNameï¼Œä¹Ÿå°±æ˜¯æŒ‡å®šäº†è¦æ˜¾ç¤º Spitter æ¨¡å‹å¯¹è±¡ä¸­å“ªä¸ªå±æ€§çš„é”™è¯¯ã€‚å¦‚æœ firstName å±æ€§æ²¡æœ‰é”™è¯¯çš„è¯ï¼Œé‚£ä¹ˆ <code>&lt;sf:errors&gt;</code> ä¸ä¼šæ¸²æŸ“ä»»ä½•å†…å®¹ã€‚ä½†å¦‚æœæœ‰æ ¡éªŒé”™è¯¯çš„è¯ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šåœ¨ä¸€ä¸ª HTML <code>&lt;span&gt;</code> æ ‡ç­¾ä¸­æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·æäº¤å­—æ¯ â€œJâ€ ä½œä¸ºåå­—çš„è¯ï¼Œé‚£ä¹ˆå¦‚ä¸‹çš„ HTML ç‰‡æ®µå°±æ˜¯é’ˆå¯¹ First Name è¾“å…¥åŸŸæ‰€æ˜¾ç¤ºçš„å†…å®¹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">First Name:<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;firstName&quot;</span> <span class="attr">name</span>=<span class="string">&quot;firstName&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;J&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;firstName.errors&quot;</span>&gt;</span>size must be between 2 and 30<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥ä¸ºç”¨æˆ·å±•ç°é”™è¯¯ä¿¡æ¯ï¼Œè¿™æ ·ä»–ä»¬å°±èƒ½ä¿®æ­£è¿™äº›é”™è¯¯äº†ã€‚æˆ‘ä»¬å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼Œä¿®æ”¹é”™è¯¯çš„æ ·å¼ï¼Œä½¿å…¶æ›´åŠ çªå‡ºæ˜¾ç¤ºã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¯ä»¥è®¾ç½® cssClass å±æ€§ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sf:form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">commandName</span>=<span class="string">&quot;spitter:&quot;</span>&gt;</span>    First Name: <span class="tag">&lt;<span class="name">sf:input</span> <span class="attr">path</span>=<span class="string">&quot;firstName&quot;</span> /&gt;</span>    <span class="tag">&lt;<span class="name">sf:errors</span> <span class="attr">path</span>=<span class="string">&quot;firstName&quot;</span> <span class="attr">cssClass</span>=<span class="string">&quot;error&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>    ...<span class="tag">&lt;/<span class="name">sf:form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åŒæ ·ï¼Œç®€å•èµ·è§ï¼Œæˆ‘åªä¼šå±•ç°å¦‚ä½•ä¸º firstName è¾“å…¥åŸŸçš„ <code>&lt;sf:errors&gt;</code> è®¾ç½® cssClass å±æ€§ã€‚ä½ å¯ä»¥å°†å…¶ç”¨åˆ°å…¶ä»–çš„è¾“å…¥åŸŸä¸Šã€‚</p>
<p>ç°åœ¨ errors çš„ <code>&lt;span&gt;</code> ä¼šæœ‰ä¸€ä¸ªå€¼ä¸º error çš„ class å±æ€§ã€‚å‰©ä¸‹éœ€è¦åšçš„å°±æ˜¯ä¸ºè¿™ä¸ªç±»å®šä¹‰ CSS æ ·å¼ã€‚å¦‚ä¸‹å°±æ˜¯ä¸€ä¸ªç®€å•çš„ CSS æ ·å¼ï¼Œå®ƒä¼šå°†é”™è¯¯ä¿¡æ¯æ¸²æŸ“ä¸ºçº¢è‰²ï¼šå›¾ 6.2 å±•ç°äº†è¿™ä¸ªè¡¨å•æ­¤æ—¶åœ¨æµè§ˆå™¨ä¸­çš„æ˜¾å¼æ•ˆæœã€‚</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">span</span><span class="selector-class">.error</span> &#123;    <span class="attribute">color</span>: red;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211101142028132.png" alt="image-20211101142028132"></p>
<center>å›¾ 6.2ã€€åœ¨è¡¨å•è¾“å…¥åŸŸçš„æ—è¾¹å±•ç°æ ¡éªŒé”™è¯¯ä¿¡æ¯</center>

<p>åœ¨è¾“å…¥åŸŸçš„æ—è¾¹å±•ç°é”™è¯¯ä¿¡æ¯æ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹å¼ï¼Œè¿™æ ·èƒ½å¤Ÿå¼•èµ·ç”¨æˆ·çš„å…³æ³¨ï¼Œæé†’ä»–ä»¬ä¿®æ­£é”™è¯¯ã€‚ä½†è¿™æ ·ä¹Ÿä¼šå¸¦æ¥å¸ƒå±€çš„é—®é¢˜ã€‚å¦å¤–ä¸€ç§å¤„ç†æ ¡éªŒé”™è¯¯æ–¹å¼å°±æ˜¯å°†æ‰€æœ‰çš„é”™è¯¯ä¿¡æ¯åœ¨åŒä¸€ä¸ªåœ°æ–¹è¿›è¡Œæ˜¾ç¤ºã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç§»é™¤æ¯ä¸ªè¾“å…¥åŸŸä¸Šçš„ <code>&lt;sf:errors&gt;</code> å…ƒç´ ï¼Œå¹¶å°†å…¶æ”¾åˆ°è¡¨å•çš„é¡¶éƒ¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sf:form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">commandName</span>=<span class="string">&quot;spitter&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">sf:errors</span> <span class="attr">path</span>=<span class="string">&quot;*&quot;</span> <span class="attr">element</span>=<span class="string">&quot;div&quot;</span> <span class="attr">cssClass</span>=<span class="string">&quot;errors&quot;</span> /&gt;</span>    ...<span class="tag">&lt;/<span class="name">sf:form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª <code>&lt;sf:errors&gt;</code> ä¸ä¹‹å‰ç›¸æ¯”ï¼Œå€¼å¾—æ³¨æ„çš„ä¸åŒä¹‹å¤„åœ¨äºå®ƒçš„ path è¢«è®¾ç½®æˆäº† â€œ*â€ã€‚è¿™æ˜¯ä¸€ä¸ªé€šé…ç¬¦é€‰æ‹©å™¨ï¼Œä¼šå‘Šè¯‰ <code>&lt;sf:errors&gt;</code> å±•ç°æ‰€æœ‰å±æ€§çš„æ‰€æœ‰é”™è¯¯ã€‚</p>
<p>åŒæ ·éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å°† element å±æ€§è®¾ç½®æˆäº† divã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé”™è¯¯éƒ½ä¼šæ¸²æŸ“åœ¨ä¸€ä¸ª HTML <code>&lt;span&gt;</code> æ ‡ç­¾ä¸­ï¼Œå¦‚æœåªæ˜¾ç¤ºä¸€ä¸ªé”™è¯¯çš„è¯ï¼Œè¿™æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦æ¸²æŸ“æ‰€æœ‰è¾“å…¥åŸŸçš„é”™è¯¯çš„è¯ï¼Œå¾ˆå¯èƒ½è¦å±•ç°ä¸æ­¢ä¸€ä¸ªé”™è¯¯ï¼Œè¿™æ—¶å€™ä½¿ç”¨ <code>&lt;span&gt;</code> æ ‡ç­¾ï¼ˆè¡Œå†…å…ƒç´ ï¼‰å°±ä¸åˆé€‚äº†ã€‚åƒ <code>&lt;div&gt;</code> è¿™æ ·çš„å—çº§å…ƒç´ ä¼šæ›´ä¸ºåˆé€‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°† element å±æ€§è®¾ç½®ä¸º divï¼Œè¿™æ ·çš„è¯ï¼Œé”™è¯¯å°±ä¼šæ¸²æŸ“åœ¨ä¸€ä¸ª <code>&lt;div&gt;</code> æ ‡ç­¾ä¸­ã€‚</p>
<p>åƒä¹‹å‰ä¸€æ ·ï¼ŒcssClass å±æ€§è¢«è®¾ç½® errorsï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½ä¸º <code>&lt;div&gt;</code> è®¾ç½®æ ·å¼ã€‚å¦‚ä¸‹ä¸º <code>&lt;div&gt;</code> çš„ CSS æ ·å¼ï¼Œå®ƒå…·æœ‰çº¢è‰²çš„è¾¹æ¡†å’Œæµ…çº¢è‰²çš„èƒŒæ™¯ï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span><span class="selector-class">.errors</span> &#123;    <span class="attribute">background-color</span>: <span class="number">#ffcccc</span>;    <span class="attribute">border</span>: <span class="number">2px</span> solid red;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨è¡¨å•çš„ä¸Šæ–¹æ˜¾ç¤ºæ‰€æœ‰çš„é”™è¯¯ï¼Œè¿™æ ·é¡µé¢å¸ƒå±€å¯èƒ½ä¼šæ›´åŠ å®¹æ˜“ä¸€äº›ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰ç€é‡æ˜¾ç¤ºéœ€è¦ä¿®æ­£çš„è¾“å…¥åŸŸã€‚é€šè¿‡ä¸ºæ¯ä¸ªè¾“å…¥åŸŸè®¾ç½® cssErrorClass å±æ€§ï¼Œè¿™ä¸ªé—®é¢˜å¾ˆå®¹æ˜“è§£å†³ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æ¯ä¸ª label éƒ½æ›¿æ¢ä¸º <code>&lt;sf: label&gt;</code>ï¼Œå¹¶è®¾ç½®å®ƒçš„ cssErrorClass å±æ€§ã€‚å¦‚ä¸‹å°±æ˜¯åšå®Œå¿…è¦ä¿®æ”¹åçš„ First Name è¾“å…¥åŸŸï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sf:form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">commandName</span>=<span class="string">&quot;spitter&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">sf:label</span> <span class="attr">path</span>=<span class="string">&quot;firstName&quot;</span> <span class="attr">cssErrorClass</span>=<span class="string">&quot;error&quot;</span>&gt;</span>First Name<span class="tag">&lt;/<span class="name">sf:label</span>&gt;</span>    <span class="tag">&lt;<span class="name">sf:input</span> <span class="attr">path</span>=<span class="string">&quot;firstName&quot;</span> <span class="attr">cssErrorClass</span>=<span class="string">&quot;error&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;/<span class="name">sf:form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;sf: label&gt;</code> æ ‡ç­¾åƒå…¶ä»–çš„è¡¨å•ç»‘å®šæ ‡ç­¾ä¸€æ ·ï¼Œä½¿ç”¨ path æ¥æŒ‡å®šå®ƒå±äºæ¨¡å‹å¯¹è±¡ä¸­çš„å“ªä¸ªå±æ€§ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†å…¶è®¾ç½®ä¸º firstNameï¼Œå› æ­¤å®ƒä¼šç»‘å®š Spitter å¯¹è±¡çš„ firstName å±æ€§ã€‚å‡è®¾æ²¡æœ‰æ ¡éªŒé”™è¯¯çš„è¯ï¼Œå®ƒå°†ä¼šæ¸²æŸ“ä¸ºå¦‚ä¸‹çš„ HTML<code>&lt;label&gt;</code> å…ƒç´ ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;firstName&quot;</span>&gt;</span>First Name<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å°±å…¶è‡ªèº«æ¥è¯´ï¼Œè®¾ç½® <code>&lt;sf:label&gt;</code> çš„ path å±æ€§å¹¶æ²¡æœ‰å®Œæˆå¤ªå¤šçš„åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜åŒæ—¶è®¾ç½®äº† cssErrorClass å±æ€§ã€‚å¦‚æœå®ƒæ‰€ç»‘å®šçš„å±æ€§æœ‰ä»»ä½•é”™è¯¯çš„è¯ï¼Œåœ¨æ¸²æŸ“å¾—åˆ°çš„ <code>&lt;label&gt;</code> å…ƒç´ ä¸­ï¼Œclass å±æ€§å°†ä¼šè¢«è®¾ç½®ä¸º errorï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;firstName&quot;</span> <span class="attr">class</span>=<span class="string">&quot;error&quot;</span>&gt;</span>First Name<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ä¹‹ç±»ä¼¼ï¼Œ<code>&lt;sf:input&gt;</code> æ ‡ç­¾çš„ cssErrorClass å±æ€§è¢«è®¾ç½®ä¸º errorã€‚å¦‚æœæœ‰ä»»ä½•æ ¡éªŒé”™è¯¯çš„è¯ï¼Œåœ¨æ¸²æŸ“å¾—åˆ°çš„ <code>&lt;input&gt;</code> æ ‡ç­¾ä¸­ï¼Œclass å±æ€§å°†ä¼šè¢«è®¾ç½®ä¸º errorã€‚ç°åœ¨æˆ‘ä»¬å·²ç»ä¸ºæ–‡æœ¬æ ‡è®°å’Œè¾“å…¥åŸŸè®¾ç½®äº†æ ·å¼ï¼Œè¿™æ ·å½“å‡ºç°é”™è¯¯çš„æ—¶å€™ï¼Œä¼šå°†ç”¨æˆ·çš„æ³¨æ„åŠ›è½¬ç§»åˆ°æ­¤å¤„ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„ CSS ä¼šå°†æ–‡æœ¬æ ‡è®°æ¸²æŸ“ä¸ºçº¢è‰²ï¼Œå¹¶å°†è¾“å…¥åŸŸè®¾ç½®ä¸ºæµ…çº¢è‰²èƒŒæ™¯ï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">label</span><span class="selector-class">.error</span>&#123;	<span class="attribute">color</span>: red;&#125;<span class="selector-tag">input</span><span class="selector-class">.error</span> &#123;	<span class="attribute">background-color</span>: <span class="number">#ffcccc</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†å¾ˆå¥½çš„æ–¹å¼ä¸ºç”¨æˆ·å±•ç°é”™è¯¯ä¿¡æ¯ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åšå¦å¤–ä¸€ä»¶äº‹æƒ…ï¼Œèƒ½å¤Ÿè®©è¿™äº›é”™è¯¯ä¿¡æ¯æ›´åŠ æ˜“è¯»ã€‚é‡æ–°çœ‹ä¸€ä¸‹ <code>Spitter</code> ç±»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ ¡éªŒæ³¨è§£ä¸Šè®¾ç½® message å±æ€§ï¼Œä½¿å…¶å¼•ç”¨å¯¹ç”¨æˆ·æ›´ä¸ºå‹å¥½çš„ä¿¡æ¯ï¼Œè€Œè¿™äº›ä¿¡æ¯å¯ä»¥å®šä¹‰åœ¨å±æ€§æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NotNull</span><span class="meta">@Size(min=5, max=16, message=&quot;&#123;username.size&#125;&quot;)</span><span class="keyword">private</span> String username;<span class="meta">@NotNull</span><span class="meta">@Size(min=5, max=25, message=&quot;&#123;password.size&#125;&quot;)</span><span class="keyword">private</span> String password;<span class="meta">@NotNull</span><span class="meta">@Size(min=2, max=30, message=&quot;&#123;firstName.size&#125;&quot;)</span><span class="keyword">private</span> String firstName;<span class="meta">@NotNull</span><span class="meta">@Size(min=2, max=30, message=&quot;&#123;lastName.size&#125;&quot;)</span><span class="keyword">private</span> String lastName;<span class="meta">@NotNull</span><span class="meta">@Email(message=&quot;&#123;email.valid&#125;&quot;)</span><span class="keyword">private</span> String email;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºä¸Šé¢æ¯ä¸ªåŸŸï¼Œæˆ‘ä»¬éƒ½å°†å…¶ <code>@Size</code> æ³¨è§£çš„ message è®¾ç½®ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²æ˜¯ç”¨å¤§æ‹¬å·æ‹¬èµ·æ¥çš„ã€‚å¦‚æœæ²¡æœ‰å¤§æ‹¬å·çš„è¯ï¼Œmessage ä¸­çš„å€¼å°†ä¼šä½œä¸ºå±•ç°ç»™ç”¨æˆ·çš„é”™è¯¯ä¿¡æ¯ã€‚ä½†æ˜¯ä½¿ç”¨äº†å¤§æ‹¬å·ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨çš„å°±æ˜¯å±æ€§æ–‡ä»¶ä¸­çš„æŸä¸€ä¸ªå±æ€§ï¼Œè¯¥å±æ€§åŒ…å«äº†å®é™…çš„ä¿¡æ¯ã€‚</p>
<p>æ¥ä¸‹æ¥éœ€è¦åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªåä¸º <code>ValidationMessages.properties</code> çš„æ–‡ä»¶ï¼Œå¹¶å°†å…¶æ”¾åœ¨æ ¹ç±»è·¯å¾„ä¹‹ä¸‹ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">firstName.size</span>=<span class="string">First name must be between &#123;min&#125; and &#123;max&#125; characters long.lastName.size=Last name must be between &#123;min&#125; and &#123;max&#125; characters long.username.size=Username must be between &#123;min&#125; and &#123;max&#125; characters long.password.size=Password must be between &#123;min&#125; and &#123;max&#125; characters long.email.valid=The email address must be valid.</span></span><br></pre></td></tr></table></figure>

<p><code>ValidationMessages.properties</code> æ–‡ä»¶ä¸­æ¯æ¡ä¿¡æ¯çš„ key å€¼å¯¹åº”äºæ³¨è§£ä¸­ message å±æ€§å ä½ç¬¦çš„å€¼ã€‚åŒæ—¶ï¼Œæœ€å°å’Œæœ€å¤§é•¿åº¦æ²¡æœ‰ç¡¬ç¼–ç åœ¨<br> <code>ValidationMessages.properties</code> æ–‡ä»¶ä¸­ï¼Œåœ¨è¿™ä¸ªç”¨æˆ·å‹å¥½çš„ä¿¡æ¯ä¸­ä¹Ÿæœ‰è‡ªå·±çš„å ä½ç¬¦â€”â€” {min} å’Œ {max}â€”â€”å®ƒä»¬ä¼šå¼•ç”¨ @Size æ³¨è§£ä¸Šæ‰€è®¾ç½®çš„ min å’Œ max å±æ€§ã€‚</p>
<p>å½“ç”¨æˆ·æäº¤çš„æ³¨å†Œè¡¨å•æ ¡éªŒå¤±è´¥çš„è¯ï¼Œä»–ä»¬åœ¨æµè§ˆå™¨ä¸­åº”è¯¥å¯ä»¥çœ‹åˆ°å›¾ 6.3 æ‰€ç¤ºçš„ç•Œé¢ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211101144543984.png" alt="image-20211101144543984"></p>
<center>å›¾ 6.3ã€€æ˜¾ç¤ºæ ¡éªŒé”™è¯¯ï¼Œå…¶ä¸­è¿™äº›å¯¹ç”¨æˆ·å‹å¥½çš„ä¿¡æ¯æ˜¯ä»å±æ€§æ–‡ä»¶ä¸­è·å–åˆ°çš„</center>

<p>å°†è¿™äº›é”™è¯¯ä¿¡æ¯æŠ½å–åˆ°å±æ€§æ–‡ä»¶ä¸­è¿˜ä¼šå¸¦æ¥ä¸€ä¸ªå¥½å¤„ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºåœ°åŸŸç›¸å…³çš„å±æ€§æ–‡ä»¶ï¼Œä¸ºç”¨æˆ·å±•ç°ç‰¹å®šè¯­è¨€å’Œåœ°åŸŸçš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·çš„æµè§ˆå™¨è®¾ç½®æˆäº†è¥¿ç­ç‰™è¯­ï¼Œé‚£ä¹ˆå°±åº”è¯¥ç”¨è¥¿ç­ç‰™è¯­å±•ç°é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªåä¸º Validation<code>Errors_es.properties</code> çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">firstName.size</span>=<span class="string">El nombre debe tener entre &#123;min&#125; y &#123;max&#125; caracteres largos.lastName.size=El apellido debe tener entre &#123;min&#125; y &#123;max&#125; caracteres largos.username.size=El nombre de usuario debe tener entre &#123;min&#125; y &#123;max&#125; caracteres.password.size=La contraseÃ±a debe tener entre &#123;min&#125; y &#123;max&#125; caracteres.email.valid=La direcciÃ³n de correo electrÃ³nico debe ser vÃ¡lida.</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥æŒ‰éœ€åˆ›å»ºä»»æ„æ•°é‡çš„ <code>ValidationMessages.properties</code> æ–‡ä»¶ï¼Œä½¿å…¶æ¶µç›–æˆ‘ä»¬æƒ³æ”¯æŒçš„æ‰€æœ‰è¯­è¨€å’Œåœ°åŸŸã€‚</p>
<p>Spring é€šç”¨çš„æ ‡ç­¾åº“</p>
<p>é™¤äº†è¡¨å•ç»‘å®šæ ‡ç­¾åº“ä¹‹å¤–ï¼ŒSpring è¿˜æä¾›äº†æ›´ä¸ºé€šç”¨çš„ <code>JSP</code> æ ‡ç­¾åº“ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªæ ‡ç­¾åº“æ˜¯ Spring ä¸­æœ€æ—©çš„æ ‡ç­¾åº“ã€‚è¿™ä¹ˆå¤šå¹´æ¥ï¼Œå®ƒæœ‰æ‰€å˜åŒ–ï¼Œä½†æ˜¯åœ¨æœ€æ—©ç‰ˆæœ¬çš„ Spring ä¸­ï¼Œå®ƒå°±å·²ç»å­˜åœ¨äº†ã€‚</p>
<p>è¦ä½¿ç”¨ Spring é€šç”¨çš„æ ‡ç­¾åº“ï¼Œæˆ‘ä»¬å¿…é¡»è¦åœ¨é¡µé¢ä¸Šå¯¹å…¶è¿›è¡Œå£°æ˜ï¼š</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib url=<span class="string">&quot;http://www.springframework.org/tags&quot;</span> prefix=<span class="string">&quot;s&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸å…¶ä»– <code>JSP</code> æ ‡ç­¾åº“ä¸€æ ·ï¼Œprefix å¯ä»¥æ˜¯ä»»æ„ä½ æ‰€å–œæ¬¢çš„å€¼ã€‚åœ¨è¿™é‡Œï¼Œé€šç”¨çš„åšæ³•æ˜¯å°†è¿™ä¸ªæ ‡ç­¾åº“çš„å‰ç¼€è®¾ç½®ä¸º springã€‚ä½†æ˜¯ï¼Œæˆ‘å°†å…¶è®¾ç½®ä¸º â€œsâ€ï¼Œå› ä¸ºå®ƒæ›´åŠ ç®€æ´ï¼Œæ›´æ˜“äºé˜…è¯»å’Œè¾“å…¥ã€‚</p>
<p>æ ‡ç­¾åº“å£°æ˜ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¡¨ 6.3 ä¸­çš„åä¸ª <code>JSP</code> æ ‡ç­¾äº†ã€‚</p>
<center>è¡¨ 6.3ã€€Spring çš„ JSP æ ‡ç­¾åº“ä¸­æä¾›äº†å¤šä¸ªä¾¿åˆ©çš„æ ‡ç­¾ï¼Œè¿˜åŒ…æ‹¬ä¸€äº›é—ç•™çš„æ•°æ®ç»‘å®šæ ‡ç­¾</center>

<table>
<thead>
<tr>
<th><code>JSP</code> æ ‡ç­¾</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;s:bind&gt;</code></td>
<td>å°†ç»‘å®šå±æ€§çš„çŠ¶æ€å¯¼å‡ºåˆ°ä¸€ä¸ªåä¸º status çš„é¡µé¢ä½œç”¨åŸŸå±æ€§ä¸­ï¼Œä¸ <code>&lt;s:path&gt;</code> ç»„åˆä½¿ç”¨è·å–ç»‘å®šå±æ€§çš„å€¼</td>
</tr>
<tr>
<td><code>&lt;s:escapeBody&gt;</code></td>
<td>å°†æ ‡ç­¾ä½“ä¸­çš„å†…å®¹è¿›è¡Œ HTML å’Œ / æˆ– JavaScript è½¬ä¹‰</td>
</tr>
<tr>
<td><code>&lt;s:hasBindErrors&gt;</code></td>
<td>æ ¹æ®æŒ‡å®šæ¨¡å‹å¯¹è±¡ï¼ˆåœ¨è¯·æ±‚å±æ€§ä¸­ï¼‰æ˜¯å¦æœ‰ç»‘å®šé”™è¯¯ï¼Œæœ‰æ¡ä»¶åœ°æ¸²æŸ“å†…å®¹</td>
</tr>
<tr>
<td><code>&lt;s:htmlEscape&gt;</code></td>
<td>ä¸ºå½“å‰é¡µé¢è®¾ç½®é»˜è®¤çš„ HTML è½¬ä¹‰å€¼</td>
</tr>
<tr>
<td><code>&lt;s:message&gt;</code></td>
<td>åŸŸæˆ–åº”ç”¨ä½œç”¨åŸŸçš„å˜é‡ï¼ˆé€šè¿‡ä½¿ç”¨ var å’Œ scope å±æ€§å®ç°ï¼‰</td>
</tr>
<tr>
<td><code>&lt;s:nestedPath&gt;</code></td>
<td>è®¾ç½®åµŒå…¥å¼çš„ pathï¼Œç”¨äº <code>&lt;s:bind&gt;</code> ä¹‹ä¸­</td>
</tr>
<tr>
<td><code>&lt;s:theme&gt;</code></td>
<td>æ ¹æ®ç»™å®šçš„ç¼–ç è·å–ä¸»é¢˜ä¿¡æ¯ï¼Œç„¶åè¦ä¹ˆè¿›è¡Œæ¸²æŸ“ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ï¼Œè¦ä¹ˆå°†å…¶è®¾ç½®ä¸ºé¡µé¢ä½œç”¨åŸŸã€è¯·æ±‚ä½œç”¨åŸŸã€ä¼šè¯ä½œç”¨åŸŸæˆ–åº”ç”¨ä½œç”¨åŸŸçš„å˜é‡ï¼ˆé€šè¿‡ä½¿ç”¨ var å’Œ scope å±æ€§å®ç°ï¼‰</td>
</tr>
<tr>
<td><code>&lt;s:transform&gt;</code></td>
<td>ä½¿ç”¨å‘½ä»¤å¯¹è±¡çš„å±æ€§ç¼–è¾‘å™¨è½¬æ¢å‘½ä»¤å¯¹è±¡ä¸­ä¸åŒ…å«çš„å±æ€§</td>
</tr>
<tr>
<td><code>&lt;s:url&gt;</code></td>
<td>åˆ›å»ºç›¸å¯¹äºä¸Šä¸‹æ–‡çš„ URLï¼Œæ”¯æŒ URI æ¨¡æ¿å˜é‡ä»¥åŠ HTML/XML/JavaScript è½¬ä¹‰ã€‚å¯ä»¥æ¸²æŸ“URLï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ï¼Œä¹Ÿå¯ä»¥å°†å…¶è®¾ç½®ä¸ºé¡µé¢ä½œç”¨åŸŸã€è¯·æ±‚ä½œç”¨åŸŸã€ä¼šè¯ä½œç”¨åŸŸæˆ–åº”ç”¨ä½œç”¨åŸŸçš„å˜é‡ï¼ˆé€šè¿‡ä½¿ç”¨ var å’Œ scope å±æ€§å®ç°ï¼‰</td>
</tr>
<tr>
<td><code>&lt;s:eval&gt;</code></td>
<td>è®¡ç®—ç¬¦åˆ Spring è¡¨è¾¾å¼è¯­è¨€ï¼ˆSpring Expression Languageï¼Œ<code>SpEL</code>ï¼‰è¯­æ³•çš„æŸä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œç„¶åè¦ä¹ˆè¿›è¡Œæ¸²æŸ“ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ï¼Œè¦ä¹ˆå°†å…¶è®¾ç½®ä¸ºé¡µé¢ä½œç”¨åŸŸã€è¯·æ±‚ä½œç”¨åŸŸã€ä¼šè¯ä½œç”¨åŸŸæˆ–åº”ç”¨ä½œç”¨åŸŸçš„å˜é‡ï¼ˆé€šè¿‡ä½¿ç”¨ var å’Œ scope å±æ€§å®ç°ï¼‰</td>
</tr>
</tbody></table>
<p>è¡¨ 6.3 ä¸­çš„ä¸€äº›æ ‡ç­¾å·²ç»è¢« Spring è¡¨å•ç»‘å®šæ ‡ç­¾åº“æ·˜æ±°äº†ã€‚ä¾‹å¦‚ï¼Œ<code>&lt;s:bind&gt;</code> æ ‡ç­¾å°±æ˜¯ Spring æœ€åˆæ‰€æä¾›çš„è¡¨å•ç»‘å®šæ ‡ç­¾ï¼Œå®ƒæ¯”æˆ‘ä»¬åœ¨å‰é¢æ‰€ä»‹ç»çš„æ ‡ç­¾å¤æ‚å¾—å¤šã€‚</p>
<p>å› ä¸ºè¿™äº›æ ‡ç­¾åº“çš„è¡Œä¸ºæ¯”è¡¨å•ç»‘å®šæ ‡ç­¾å°‘å¾—å¤šï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šè¯¦ç»†ä»‹ç»æ¯ä¸ªæ ‡ç­¾ï¼Œè€Œæ˜¯å¿«é€Ÿä»‹ç»å‡ ä¸ªæœ€ä¸ºæœ‰ç”¨çš„æ ‡ç­¾ï¼Œå…¶ä½™çš„ç•™ç»™è¯»è€…è‡ªè¡Œå»å­¦ä¹ å’Œæ¢ç´¢ã€‚ï¼ˆå³ä¾¿ä½ ä»¬ä¼šç”¨åˆ°å®ƒä»¬ï¼Œå¾ˆå¯èƒ½ä¹Ÿä¸ä¼šé‚£ä¹ˆé¢‘ç¹ã€‚ï¼‰</p>
<p>å±•ç°å›½é™…åŒ–ä¿¡æ¯</p>
<p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ <code>JSP</code> æ¨¡æ¿åŒ…å«äº†å¾ˆå¤šç¡¬ç¼–ç çš„æ–‡æœ¬ã€‚è¿™å…¶å®ä¹Ÿç®—ä¸ä¸Šä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä½ è¦ä¿®æ”¹è¿™äº›æ–‡æœ¬çš„è¯ï¼Œå°±ä¸é‚£ä¹ˆå®¹æ˜“äº†ã€‚è€Œä¸”ï¼Œæ²¡æœ‰åŠæ³•æ ¹æ®ç”¨æˆ·çš„è¯­è¨€è®¾ç½®å›½é™…åŒ–è¿™äº›æ–‡æœ¬ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘é¦–é¡µä¸­çš„æ¬¢è¿ä¿¡æ¯ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>    welcom to Spittr!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹è¿™ä¸ªä¿¡æ¯çš„å”¯ä¸€åŠæ³•æ˜¯æ‰“å¼€ <code>home.jsp</code>ï¼Œç„¶åå¯¹å…¶è¿›è¡Œå˜æ›´ã€‚æˆ‘è§‰å¾—ï¼Œè¿™ç®—ä¸ä¸Šä»€ä¹ˆå¤§äº‹ã€‚ä½†æ˜¯ï¼Œåº”ç”¨ä¸­çš„æ–‡æœ¬æ•£å¸ƒåˆ°å¤šä¸ªæ¨¡æ¿ä¸­ï¼Œå¦‚æœè¦å¤§è§„æ¨¡ä¿®æ”¹åº”ç”¨çš„ä¿¡æ¯æ—¶ï¼Œä½ éœ€è¦ä¿®æ”¹å¤§é‡çš„ <code>JSP</code> æ–‡ä»¶ã€‚</p>
<p>å¦å¤–ä¸€ä¸ªæ›´ä¸ºé‡è¦çš„é—®é¢˜åœ¨äºï¼Œä¸ç®¡ä½ é€‰æ‹©ä»€ä¹ˆæ ·çš„æ¬¢è¿ä¿¡æ¯ï¼Œæ‰€æœ‰çš„ç”¨æˆ·éƒ½ä¼šçœ‹åˆ°åŒæ ·çš„ä¿¡æ¯ã€‚Web æ˜¯å…¨çƒæ€§çš„ç½‘ç»œï¼Œä½ æ‰€æ„å»ºçš„åº”ç”¨å¾ˆå¯èƒ½ä¼šæœ‰å…¨çƒåŒ–ç”¨æˆ·ã€‚å› æ­¤ï¼Œæœ€å¥½èƒ½å¤Ÿä½¿ç”¨ç”¨æˆ·çš„è¯­è¨€ä¸å…¶è¿›è¡Œäº¤æµï¼Œè€Œä¸æ˜¯åªä½¿ç”¨æŸä¸€ç§è¯­è¨€ã€‚</p>
<p>å¯¹äºæ¸²æŸ“æ–‡æœ¬æ¥è¯´ï¼Œæ˜¯å¾ˆå¥½çš„æ–¹æ¡ˆï¼Œæ–‡æœ¬èƒ½å¤Ÿä½äºä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§æ–‡ä»¶ä¸­ã€‚å€ŸåŠ© <code>&lt;s:message&gt;</code>ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç¡¬ç¼–ç çš„æ¬¢è¿ä¿¡æ¯æ›¿æ¢ä¸ºå¦‚ä¸‹çš„å½¢å¼ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>    <span class="tag">&lt;<span class="name">s:message</span> <span class="attr">code</span>=<span class="string">&quot;spittr.welcome&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æŒ‰ç…§è¿™é‡Œçš„æ–¹å¼ï¼Œ<code>&lt;s:message&gt;</code> å°†ä¼šæ ¹æ® key ä¸º <code>spittr.welcome</code> çš„ä¿¡æ¯æºæ¥æ¸²æŸ“æ–‡æœ¬ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ› <code>&lt;s:message&gt;</code> èƒ½å¤Ÿæ­£å¸¸å®Œæˆä»»åŠ¡çš„è¯ï¼Œå°±éœ€è¦é…ç½®ä¸€ä¸ªè¿™æ ·çš„ä¿¡æ¯æºã€‚</p>
<p>Spring æœ‰å¤šä¸ªä¿¡æ¯æºçš„ç±»ï¼Œå®ƒä»¬éƒ½å®ç°äº† <code>MessageSource</code> æ¥å£ã€‚åœ¨è¿™äº›ç±»ä¸­ï¼Œæ›´ä¸ºå¸¸è§å’Œæœ‰ç”¨çš„æ˜¯ <code>ResourceBundleMessageSource</code>ã€‚å®ƒä¼šä»ä¸€ä¸ªå±æ€§æ–‡ä»¶ä¸­åŠ <br>è½½ä¿¡æ¯ï¼Œè¿™ä¸ªå±æ€§æ–‡ä»¶çš„åç§°æ˜¯æ ¹æ®åŸºç¡€åç§°ï¼ˆbase nameï¼‰è¡ç”Ÿè€Œæ¥çš„ã€‚å¦‚ä¸‹çš„ @Bean æ–¹æ³•é…ç½®äº† <code>ResourceBundleMessageSource</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">messageSource <span class="title">messageSource</span><span class="params">()</span> </span>&#123;    ResourceBundleMessageSource messageSource = <span class="keyword">new</span> ResourceBundleMessageSource();    messageSource.setBasename(<span class="string">&quot;message&quot;</span>);    <span class="keyword">return</span> messageSource;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ª bean å£°æ˜ä¸­ï¼Œæ ¸å¿ƒåœ¨äºè®¾ç½® <code>basename</code> å±æ€§ã€‚ä½ å¯ä»¥å°†å…¶è®¾ç½®ä¸ºä»»æ„ä½ å–œæ¬¢çš„å€¼ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘å°†å…¶è®¾ç½®ä¸º <code>message</code>ã€‚å°†å…¶è®¾ç½®ä¸º <code>message</code> åï¼Œ <code>ResourceBundleMessageSource</code> å°±ä¼šè¯•å›¾åœ¨æ ¹è·¯å¾„çš„å±æ€§æ–‡ä»¶ä¸­è§£æä¿¡æ¯ï¼Œè¿™äº›å±æ€§æ–‡ä»¶çš„åç§°æ˜¯æ ¹æ®è¿™ä¸ªåŸºç¡€åç§°è¡ç”Ÿå¾—åˆ°çš„ã€‚</p>
<p>å¦å¤–çš„å¯é€‰æ–¹æ¡ˆæ˜¯ä½¿ç”¨ <code>ReloadableResourceBundleMessageSource</code>ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼ä¸ <code>ResourceBundleMessageSource</code> éå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒèƒ½å¤Ÿé‡æ–°åŠ è½½ä¿¡æ¯å±æ€§ï¼Œè€Œä¸å¿…é‡æ–°ç¼–è¯‘æˆ–é‡å¯åº”ç”¨ã€‚å¦‚ä¸‹æ˜¯é…ç½® <code>ReloadableResourceBundleMessageSource</code> çš„æ ·ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MessageSource <span class="title">messageSource</span><span class="params">()</span> </span>&#123;    ReloadableResourceBundleMessageSource messageSource = <span class="keyword">new</span> ReloadableResourceBundleMessageSource();    messageSource.setBasename(<span class="string">&quot;file:///etc/spittr/messages&quot;</span>);    messageSource.setCacheSeconds(<span class="number">10</span>);    <span class="keyword">return</span> messageSource;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„å…³é”®åŒºåˆ«åœ¨äº <code>basename</code> å±æ€§è®¾ç½®ä¸ºåœ¨åº”ç”¨çš„å¤–éƒ¨æŸ¥æ‰¾ï¼ˆè€Œä¸æ˜¯åƒ <code>ResourceBundleMessageSource</code> é‚£æ ·åœ¨ç±»è·¯å¾„ä¸‹æŸ¥æ‰¾ï¼‰ã€‚<code>basename</code> å±æ€§å¯ä»¥è®¾ç½®ä¸ºåœ¨ç±»è·¯å¾„ä¸‹ï¼ˆä»¥ â€œclasspath:â€ ä½œä¸ºå‰ç¼€ï¼‰ã€æ–‡ä»¶ç³»ç»Ÿä¸­ï¼ˆä»¥ â€œfile:â€ ä½œä¸ºå‰ç¼€ï¼‰æˆ– Web åº”ç”¨çš„æ ¹è·¯å¾„ä¸‹ï¼ˆæ²¡æœ‰å‰ç¼€ï¼‰æŸ¥æ‰¾å±æ€§ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å°†å…¶é…ç½®ä¸ºåœ¨æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿçš„ â€œ/etc/spittrâ€ ç›®å½•ä¸‹çš„å±æ€§æ–‡ä»¶ä¸­æŸ¥æ‰¾ä¿¡æ¯ï¼Œå¹¶ä¸”åŸºç¡€çš„æ–‡ä»¶åä¸º â€œmessageâ€ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºè¿™äº›å±æ€§æ–‡ä»¶ã€‚é¦–å…ˆï¼Œåˆ›å»ºé»˜è®¤çš„å±æ€§æ–‡ä»¶ï¼Œåä¸º <code>messages. properties</code>ã€‚å®ƒè¦ä¹ˆä½äºæ ¹ç±»è·¯å¾„ä¸‹ï¼ˆå¦‚æœä½¿ç”¨ <code>ResourceBundleMessageSource</code> çš„è¯ï¼‰ï¼Œè¦ä¹ˆä½äº <code>pathname</code> å±æ€§æŒ‡å®šçš„è·¯å¾„ä¸‹ï¼ˆå¦‚æœä½¿ç”¨ <code>ReloadableResourceBundleMessageSource</code> çš„è¯ï¼‰ã€‚å¯¹ <code>spittr.welcome</code> ä¿¡æ¯æ¥è®²ï¼Œå®ƒéœ€è¦å¦‚ä¸‹çš„æ¡ç›®ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spittr.welcome</span>=<span class="string">Welcome to Spittr!</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ ä¸å†åˆ›å»ºå…¶ä»–ä¿¡æ¯æ–‡ä»¶çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰€åšçš„äº‹æƒ…å°±æ˜¯å°† <code>JSP</code> ä¸­ç¡¬ç¼–ç çš„ä¿¡æ¯æŠ½å–åˆ°äº†å±æ€§æ–‡ä»¶ä¸­ï¼Œä¾ç„¶ä½œä¸ºç¡¬ç¼–ç çš„ä¿¡æ¯ã€‚å®ƒèƒ½å¤Ÿè®©æˆ‘ä»¬ä¸€ç«™å¼åœ°ä¿®æ”¹åº”ç”¨ä¸­çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä½†æ˜¯å®ƒæ‰€å®Œæˆçš„ä»»åŠ¡å¹¶ä¸é™äºæ­¤ã€‚</p>
<p>æˆ‘ä»¬å·²ç»å…·å¤‡äº†å¯¹ä¿¡æ¯è¿›è¡Œå›½é™…åŒ–çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦ä¸ºè¯­è¨€è®¾ç½®ä¸ºè¥¿ç­ç‰™è¯­çš„ç”¨æˆ·å±•ç°è¥¿ç­ç‰™è¯­çš„æ¬¢è¿ä¿¡æ¯ï¼Œé‚£ä¹ˆéœ€è¦åˆ›å»ºå¦å¤–ä¸€ä¸ªåä¸º <code>messages_es. properties</code> çš„å±æ€§æ–‡ä»¶ï¼Œå¹¶åŒ…å«å¦‚ä¸‹çš„æ¡ç›®ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spittr.welcome</span>=<span class="string">Bienvenidos a Spittr!</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†ä¸€ä»¶äº†ä¸èµ·çš„äº‹æƒ…ã€‚æˆ‘ä»¬çš„åº”ç”¨ç›®å‰åªæ˜¯å¤šäº†å‡ ä¸ª <code>&lt;s:message&gt;</code> æ ‡ç­¾ä»¥åŠè¯­è¨€ç›¸å…³çš„å±æ€§æ–‡ä»¶ï¼Œè¿˜æ²¡æœ‰å®Œå…¨å®ç°å›½é™…åŒ–ï¼æˆ‘å°†åº”ç”¨å…¶ä»–éƒ¨åˆ†çš„å›½é™…åŒ–ç•™ç»™è¯»è€…å»å®Œæˆã€‚</p>
<p>åˆ›å»º URL</p>
<p><code>&lt;s:url&gt;</code> æ˜¯ä¸€ä¸ªå¾ˆå°çš„æ ‡ç­¾ã€‚å®ƒä¸»è¦çš„ä»»åŠ¡å°±æ˜¯åˆ›å»º URLï¼Œç„¶åå°†å…¶èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡æˆ–è€…æ¸²æŸ“åˆ°å“åº”ä¸­ã€‚å®ƒæ˜¯ <code>JSTL</code> ä¸­ <code>&lt;c:url&gt;</code> æ ‡ç­¾çš„æ›¿ä»£è€…ï¼Œä½†æ˜¯å®ƒå…·å¤‡å‡ é¡¹ç‰¹æ®Šçš„æŠ€å·§ã€‚</p>
<p>æŒ‰ç…§å…¶æœ€ç®€å•çš„å½¢å¼ï¼Œ<code>&lt;s:url&gt;</code> ä¼šæ¥å—ä¸€ä¸ªç›¸å¯¹äº <code>Servlet</code> ä¸Šä¸‹æ–‡çš„ URLï¼Œå¹¶åœ¨æ¸²æŸ“çš„æ—¶å€™ï¼Œé¢„å…ˆæ·»åŠ ä¸Š <code>Servlet</code> ä¸Šä¸‹æ–‡è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘å¦‚ä¸‹<code>&lt;s:url&gt;</code>çš„åŸºæœ¬ç”¨æ³•ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:url</span> <span class="attr">href</span>=<span class="string">&quot;/spitter/register/register&quot;</span> <span class="attr">var</span>=<span class="string">&quot;registerUrl&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;request&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå¸Œæœ›åœ¨ URL ä¸Šæ·»åŠ å‚æ•°çš„è¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨<code>&lt;s:param&gt;</code>æ ‡ç­¾ã€‚æ¯”å¦‚ï¼Œå¦‚ä¸‹çš„<code>&lt;s:url&gt;</code>ä½¿ç”¨ä¸¤ä¸ªå†…åµŒçš„<code>&lt;s:param&gt;</code>æ ‡ç­¾ï¼Œæ¥è®¾ç½® â€œ/spittlesâ€ çš„ max å’Œ count å‚æ•°ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:url</span> <span class="attr">href</span>=<span class="string">&quot;/spittles&quot;</span> <span class="attr">var</span>=<span class="string">&quot;spittlesUrl&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">&quot;max&quot;</span> <span class="attr">value</span>=<span class="string">&quot;60&quot;</span>/&gt;</span>    <span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">&quot;count&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">s:url</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰çœ‹åˆ°<code>&lt;s:url&gt;</code>èƒ½å¤Ÿå®ç°ï¼Œè€Œ <code>JSTL</code> çš„<code>&lt;c:url&gt;</code>æ— æ³•å®ç°çš„åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åˆ›å»ºå¸¦æœ‰è·¯å¾„ï¼ˆpathï¼‰å‚æ•°çš„ URL è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬è¯¥å¦‚ä½•è®¾ç½® <code>href</code> å±æ€§ï¼Œä½¿å…¶å…·æœ‰è·¯å¾„å˜é‡çš„å ä½ç¬¦å‘¢ï¼Ÿ</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦ä¸ºç‰¹å®šç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯é¡µé¢åˆ›å»ºä¸€ä¸ªURLã€‚é‚£æ²¡æœ‰é—®é¢˜ï¼Œ<code>&lt;s:param&gt;</code>æ ‡ç­¾å¯ä»¥æ‰¿æ‹…æ­¤ä»»ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:url</span> <span class="attr">href</span>=<span class="string">&quot;/spitter/&#123;username&#125;&quot;</span> <span class="attr">var</span>=<span class="string">&quot;spitterUrl&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jbauer&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">s:url</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ href å±æ€§ä¸­çš„å ä½ç¬¦åŒ¹é… <code>&lt;s:param&gt;</code> ä¸­æ‰€æŒ‡å®šçš„å‚æ•°æ—¶ï¼Œè¿™ä¸ªå‚æ•°å°†ä¼šæ’å…¥åˆ°å ä½ç¬¦çš„ä½ç½®ä¸­ã€‚å¦‚æœ <code>&lt;s:param&gt;</code> å‚æ•°æ— æ³•åŒ¹é… href ä¸­çš„ä»»ä½•å ä½ç¬¦ï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°å°†ä¼šä½œä¸ºæŸ¥è¯¢å‚æ•°ã€‚</p>
<p><code>&lt;s:url&gt;</code> æ ‡ç­¾è¿˜å¯ä»¥è§£å†³ URL çš„è½¬ä¹‰éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å¸Œæœ›å°†æ¸²æŸ“å¾—åˆ°çš„ URL å†…å®¹å±•ç°åœ¨ Web é¡µé¢ä¸Šï¼ˆè€Œä¸æ˜¯ä½œä¸ºè¶…é“¾æ¥ï¼‰ï¼Œé‚£ä¹ˆä½ åº”è¯¥è¦æ±‚ <code>&lt;s:url&gt;</code> è¿›è¡Œ HTML è½¬ä¹‰ï¼Œè¿™éœ€è¦å°† htmlEscape å±æ€§è®¾ç½®ä¸º trueã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„ <code>&lt;s:url&gt;</code> å°†ä¼šæ¸²æŸ“ HTML è½¬ä¹‰åçš„ URLï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:url</span> <span class="attr">value</span>=<span class="string">&quot;/spittles&quot;</span> <span class="attr">htmlEscape</span>=<span class="string">&quot;true&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">&quot;max&quot;</span> <span class="attr">value</span>=<span class="string">&quot;60&quot;</span>/&gt;</span>    <span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">&quot;count&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">s:url</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ‰€æ¸²æŸ“çš„ URL ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/spitter/spittles?max=60<span class="symbol">&amp;amp;</span>count=20</span><br></pre></td></tr></table></figure>

<p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ å¸Œæœ›åœ¨ JavaScript ä»£ç ä¸­ä½¿ç”¨ URL çš„è¯ï¼Œé‚£ä¹ˆåº”è¯¥å°† javaScriptEscape å±æ€§è®¾ç½®ä¸º trueï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:url</span> <span class="attr">value</span>=<span class="string">&quot;/spittles&quot;</span> <span class="attr">var</span>=<span class="string">&quot;spittlesJSUrl&quot;</span> <span class="attr">javaScriptEscape</span>=<span class="string">&quot;true&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">&quot;max&quot;</span> <span class="attr">value</span>=<span class="string">&quot;60&quot;</span>/&gt;</span>    <span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">&quot;count&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">s:url</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">	<span class="keyword">var</span> spittlesUrl = <span class="string">&quot;$&#123;spittlesJSUrl&#125;&quot;</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¼šæ¸²æŸ“å¦‚ä¸‹çš„ç»“æœåˆ°å“åº”ä¹‹ä¸­ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">	<span class="keyword">var</span> spittlesUrl = <span class="string">&quot;\/spitter\/spittles?max=60&amp;count=20&quot;</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ—¢ç„¶æåˆ°äº†è½¬ä¹‰ï¼Œæœ‰ä¸€ä¸ªæ ‡ç­¾ä¸“é—¨ç”¨æ¥è½¬ä¹‰å†…å®¹ï¼Œè€Œä¸æ˜¯è½¬ä¹‰æ ‡ç­¾ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ã€‚</p>
<p>è½¬ä¹‰å†…å®¹</p>
<p><code>&lt;s:escapeBody&gt;</code> æ ‡ç­¾æ˜¯ä¸€ä¸ªé€šç”¨çš„è½¬ä¹‰æ ‡ç­¾ã€‚å®ƒä¼šæ¸²æŸ“æ ‡ç­¾ä½“ä¸­å†…åµŒçš„å†…å®¹ï¼Œå¹¶ä¸”åœ¨å¿…è¦çš„æ—¶å€™è¿›è¡Œè½¬ä¹‰ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾ä½ å¸Œæœ›åœ¨é¡µé¢ä¸Šå±•ç°ä¸€ä¸ª HTML ä»£ç ç‰‡æ®µã€‚ä¸ºäº†æ­£ç¡®æ˜¾ç¤ºï¼Œæˆ‘ä»¬éœ€è¦å°† â€œ&lt;â€ å’Œ â€œ&gt;â€ å­—ç¬¦æ›¿æ¢ä¸º â€œ<code>&amp;lt;</code>â€œ å’Œ â€œ<code>&amp;gt;</code>â€ï¼Œå¦åˆ™çš„è¯ï¼Œæµè§ˆå™¨å°†ä¼šåƒè§£æé¡µé¢ä¸Šå…¶ä»– HTML é‚£æ ·è§£æè¿™æ®µ HTML å†…å®¹ã€‚</p>
<p>å½“ç„¶ï¼Œæ²¡æœ‰äººç¦æ­¢æˆ‘ä»¬æ‰‹åŠ¨å°†å…¶è½¬ä¹‰ä¸º  â€œ<code>&amp;lt;</code>â€œ å’Œ â€œ<code>&amp;gt;</code>â€ï¼Œä½†æ˜¯è¿™å¾ˆçƒ¦çï¼Œå¹¶ä¸”ä»£ç éš¾ä»¥é˜…è¯»ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>&lt;s:escapeBody&gt;</code>ï¼Œå¹¶è®© Spring å®Œæˆè¿™é¡¹ä»»åŠ¡ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:escapeBody</span> <span class="attr">htmlEscape</span>=<span class="string">&quot;true&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>        Hello    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">s:escapeBody</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å®ƒå°†ä¼šåœ¨å“åº”ä½“ä¸­æ¸²æŸ“æˆå¦‚ä¸‹çš„å†…å®¹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&amp;lt;</span>h1<span class="symbol">&amp;gt;</span>Hello<span class="symbol">&amp;lt;</span><span class="symbol">&amp;gt;</span></span><br></pre></td></tr></table></figure>

<p>è™½ç„¶è½¬ä¹‰åçš„æ ¼å¼çœ‹èµ·æ¥å¾ˆéš¾è¯»ï¼Œä½†æµè§ˆå™¨ä¼šå¾ˆä¹æ„å°†å…¶è½¬æ¢ä¸ºæœªè½¬ä¹‰çš„HTMLï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸Œæœ›ç”¨æˆ·èƒ½å¤Ÿçœ‹åˆ°çš„æ ·å­ã€‚</p>
<p>é€šè¿‡è®¾ç½® <code>javaScriptEscape</code> å±æ€§ï¼Œ<code>&lt;s:escapeBody&gt;</code> æ ‡ç­¾è¿˜æ”¯æŒ JavaScript è½¬ä¹‰ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:escapeBody</span> <span class="attr">javaScriptEscape</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">s:escapeBody</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;s:escapeBody&gt;</code> åªå®Œæˆä¸€ä»¶äº‹ï¼Œå¹¶ä¸”å®Œæˆå¾—éå¸¸å¥½ã€‚ä¸ <code>&lt;s:url&gt;</code> ä¸åŒï¼Œå®ƒåªä¼šæ¸²æŸ“å†…å®¹ï¼Œå¹¶ä¸èƒ½å°†å†…å®¹è®¾ç½®ä¸ºå˜é‡ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ <code>JSP</code> æ¥å®šä¹‰ Spring è§†å›¾ï¼Œç°åœ¨è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹å¦‚ä½•ä½¿å…¶åœ¨å®¡ç¾ä¸Šæ›´åŠ æœ‰å¸å¼•åŠ›ã€‚æˆ‘ä»¬å¯ä»¥åœ¨é¡µé¢ä¸Šå¢åŠ ä¸€äº›é€šç”¨çš„å…ƒç´ ï¼Œæ¯”å¦‚æ·»åŠ åŒ…å«ç«™ç‚¹ Logo çš„å¤´éƒ¨ã€ä½¿ç”¨æ ·å¼å¹¶åœ¨åº•éƒ¨å±•ç°ç‰ˆæƒä¿¡æ¯ã€‚æˆ‘ä»¬ä¸ä¼šåœ¨ <code>Spittr</code> åº”ç”¨ä¸­çš„æ¯ä¸ª <code>JSP</code> éƒ½è¿›è¡Œè¿™æ ·çš„ä¿®æ”¹ï¼Œè€Œæ˜¯å€ŸåŠ© Apache Tiles æ¥ä¸ºæ¨¡æ¿å®ç°ä¸€äº›é€šç”¨ä¸”å¯é‡ç”¨çš„å¸ƒå±€ã€‚</p>
<h3 id="ä½¿ç”¨-Apache-Tiles-è§†å›¾å®šä¹‰å¸ƒå±€"><a href="#ä½¿ç”¨-Apache-Tiles-è§†å›¾å®šä¹‰å¸ƒå±€" class="headerlink" title="ä½¿ç”¨ Apache Tiles è§†å›¾å®šä¹‰å¸ƒå±€"></a>ä½¿ç”¨ Apache Tiles è§†å›¾å®šä¹‰å¸ƒå±€</h3><p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¾ˆå°‘å…³å¿ƒåº”ç”¨ä¸­ Web é¡µé¢çš„å¸ƒå±€é—®é¢˜ã€‚æ¯ä¸ª <code>JSP</code> å®Œå…¨è´Ÿè´£å®šä¹‰è‡ªèº«çš„å¸ƒå±€ï¼Œåœ¨è¿™æ–¹é¢å…¶å®è¿™äº› <code>JSP</code> ä¹Ÿæ²¡æœ‰åšå¤ªå¤šå·¥ä½œã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æƒ³ä¸ºåº”ç”¨ä¸­çš„æ‰€æœ‰é¡µé¢å®šä¹‰ä¸€ä¸ªé€šç”¨çš„å¤´éƒ¨å’Œåº•éƒ¨ã€‚æœ€åŸå§‹çš„æ–¹å¼å°±æ˜¯æŸ¥æ‰¾æ¯ä¸ª <code>JSP</code> æ¨¡æ¿ï¼Œå¹¶ä¸ºå…¶æ·»åŠ å¤´éƒ¨å’Œåº•éƒ¨çš„ HTMLã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•çš„æ‰©å±•æ€§å¹¶ä¸å¥½ï¼Œä¹Ÿéš¾ä»¥ç»´æŠ¤ã€‚ä¸ºæ¯ä¸ªé¡µé¢æ·»åŠ è¿™äº›å…ƒç´ ä¼šæœ‰ä¸€äº›åˆå§‹æˆæœ¬ï¼Œè€Œåç»­çš„æ¯æ¬¡å˜æ›´éƒ½ä¼šè€—è´¹ç±»ä¼¼çš„æˆæœ¬ã€‚</p>
<p>æ›´å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨å¸ƒå±€å¼•æ“ï¼Œå¦‚ <code>Apache Tiles</code>ï¼Œå®šä¹‰é€‚ç”¨äºæ‰€æœ‰é¡µé¢çš„é€šç”¨é¡µé¢å¸ƒå±€ã€‚<code>Spring MVC</code> ä»¥è§†å›¾è§£æå™¨çš„å½¢å¼ä¸º <code>Apache Tiles</code> æä¾›äº†æ”¯æŒï¼Œè¿™ä¸ªè§†å›¾è§£æå™¨èƒ½å¤Ÿå°†é€»è¾‘è§†å›¾åè§£æä¸º <code>Tile</code> å®šä¹‰ã€‚</p>
<h4 id="é…ç½®-Tiles-è§†å›¾è§£æå™¨"><a href="#é…ç½®-Tiles-è§†å›¾è§£æå™¨" class="headerlink" title="é…ç½® Tiles è§†å›¾è§£æå™¨"></a>é…ç½® Tiles è§†å›¾è§£æå™¨</h4><p>ä¸ºäº†åœ¨ Spring ä¸­ä½¿ç”¨ Tilesï¼Œéœ€è¦é…ç½®å‡ ä¸ª beanã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ª <code>TilesConfigurer bean</code>ï¼Œå®ƒä¼šè´Ÿè´£å®šä½å’ŒåŠ è½½ Tile å®šä¹‰å¹¶åè°ƒç”Ÿæˆ Tilesã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦ <code>TilesViewResolver bean</code> å°†é€»è¾‘è§†å›¾åç§°è§£æä¸º Tile å®šä¹‰ã€‚</p>
<p>è¿™ä¸¤ä¸ªç»„ä»¶åˆæœ‰ä¸¤ç§å½¢å¼ï¼šé’ˆå¯¹ Apache Tiles 2 å’Œ Apache Tiles 3 åˆ†åˆ«éƒ½æœ‰è¿™ä¹ˆä¸¤ä¸ªç»„ä»¶ã€‚è¿™ä¸¤ç»„ Tiles ç»„ä»¶ä¹‹é—´æœ€ä¸ºæ˜æ˜¾çš„åŒºåˆ«åœ¨äºåŒ…åã€‚é’ˆå¯¹ Apache Tiles 2 çš„ <code>TilesConfigurer/TilesViewResolver</code> ä½äº <code>org.springframework.web.servlet.view.tiles2</code> åŒ…ä¸­ï¼Œè€Œé’ˆå¯¹ Tiles 3 çš„ç»„ä»¶ä½äº <code>org.springframework.web.servlet.view.tiles3</code> åŒ…ä¸­ã€‚å¯¹äºè¯¥ä¾‹å­æ¥è®²ï¼Œå‡è®¾æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Tiles 3ã€‚</p>
<p>é¦–å…ˆï¼Œé…ç½® <code>TilesConfigurer</code> æ¥è§£æ Tile å®šä¹‰ã€‚</p>
<center>ç¨‹åºæ¸…å• 6.1ã€€é…ç½® TilesConfigurer æ¥è§£æå®šä¹‰</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">TilesConfigurer <span class="title">tilesConfigurer</span><span class="params">()</span> </span>&#123;    TilesConfigurer tiles = <span class="keyword">new</span> TilesConfigurer();    tiles.setDefinitions(<span class="keyword">new</span> String[] &#123;<span class="string">&quot;/WEB-INF/layout/tiles.xml&quot;</span>&#125;);    tiles.setCheckRefresh(<span class="keyword">true</span>);    <span class="keyword">return</span> tiles;&#125;</span><br></pre></td></tr></table></figure>

<p>å½“é…ç½® <code>TilesConfigurer</code> çš„æ—¶å€™ï¼Œæ‰€è¦è®¾ç½®çš„æœ€é‡è¦çš„å±æ€§å°±æ˜¯ definitionsã€‚è¿™ä¸ªå±æ€§æ¥å—ä¸€ä¸ª String ç±»å‹çš„æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸ªæ¡ç›®éƒ½æŒ‡å®šä¸€ä¸ª Tile å®šä¹‰çš„ XML æ–‡ä»¶ã€‚å¯¹äº <code>Spittr</code> åº”ç”¨æ¥è®²ï¼Œæˆ‘ä»¬è®©å®ƒåœ¨ â€œ/WEB-INF/layout/â€ ç›®å½•ä¸‹æŸ¥æ‰¾ <code>tiles.xml</code>ã€‚</p>
<p>å…¶å®æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šå¤šä¸ª Tile å®šä¹‰æ–‡ä»¶ï¼Œç”šè‡³èƒ½å¤Ÿåœ¨è·¯å¾„ä½ç½®ä¸Šä½¿ç”¨é€šé…ç¬¦ï¼Œå½“ç„¶åœ¨ä¸Šä¾‹ä¸­æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨è¯¥åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ±‚ <code>TilesConfigurer</code> åŠ è½½ â€œ/WEB-INF/â€ ç›®å½•ä¸‹çš„æ‰€æœ‰åå­—ä¸º <code>tiles.xml</code> çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼è®¾ç½® <code>definitions</code> å±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">titles.setDefinitions(<span class="keyword">new</span> String[] &#123;<span class="string">&quot;WEB-INF/**/tiles.xml&quot;</span>&#125;);</span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Ant é£æ ¼çš„é€šé…ç¬¦ï¼ˆ**ï¼‰ï¼Œæ‰€ä»¥ <code>TilesConfigurer</code> ä¼šéå† â€œWEB-INF/â€ çš„æ‰€æœ‰å­ç›®å½•æ¥æŸ¥æ‰¾ Tile å®šä¹‰ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ¥é…ç½® <code>TilesViewResolver</code>ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆåŸºæœ¬çš„ bean å®šä¹‰ï¼Œæ²¡æœ‰ä»€ä¹ˆè¦è®¾ç½®çš„å±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">ViewResolver <span class="title">viewResolver</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> TilesViewResolver();&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æ›´å–œæ¬¢ XML é…ç½®çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„å½¢å¼é…ç½® <code>TilesConfigurer</code> å’Œ <code>TilesViewResolver</code>ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;tilesConfigurer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.tiles3.TilesConfigurer&quot;</span>&gt;</span>	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;definitions&quot;</span>&gt;</span>    	<span class="tag">&lt;<span class="name">list</span>&gt;</span>        	<span class="tag">&lt;<span class="name">value</span>&gt;</span>/WEB-INF/layout/tiles.xml<span class="tag">&lt;/<span class="name">value</span>&gt;</span>            <span class="tag">&lt;<span class="name">value</span>&gt;</span>/WEB-INF/views/**/tiles.xml<span class="tag">&lt;/<span class="name">value</span>&gt;</span>        <span class="tag">&lt;/<span class="name">list</span>&gt;</span>    <span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;viewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.tiles3.TilesViewResolver&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>TilesConfigurer</code> ä¼šåŠ è½½ Tile å®šä¹‰å¹¶ä¸ Apache Tiles åä½œï¼Œè€Œ <code>TilesViewResolver</code> ä¼šå°†é€»è¾‘è§†å›¾åç§°è§£æä¸ºå¼•ç”¨ Tile å®šä¹‰çš„è§†å›¾ã€‚å®ƒæ˜¯é€šè¿‡æŸ¥æ‰¾ä¸é€»è¾‘è§†å›¾åç§°ç›¸åŒ¹é…çš„ Tile å®šä¹‰å®ç°è¯¥åŠŸèƒ½çš„ã€‚æˆ‘ä»¬éœ€è¦åˆ›å»ºå‡ ä¸ª Tile å®šä¹‰ä»¥äº†è§£å®ƒæ˜¯å¦‚ä½•è¿è½¬çš„ã€‚</p>
<p>å®šä¹‰ Tiles</p>
<p>Apache Tiles æä¾›äº†ä¸€ä¸ªæ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆdocument type definitionï¼ŒDTDï¼‰ï¼Œç”¨æ¥åœ¨ XML æ–‡ä»¶ä¸­æŒ‡å®šTileçš„å®šä¹‰ã€‚æ¯ä¸ªå®šä¹‰ä¸­éœ€è¦åŒ…å«ä¸€ä¸ª <code>&lt;definition&gt;</code> å…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ ä¼šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ª <code>&lt;put-attribute&gt;</code> å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„ XML æ–‡æ¡£ä¸º Spittr åº”ç”¨å®šä¹‰äº†å‡ ä¸ª Tilesã€‚</p>
<center>ç¨‹åºæ¸…å• 6.2ã€€ä¸º Spittr åº”ç”¨å®šä¹‰ Tile</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">tiles-definitions</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//Apache Software Foundation//DTD Tiles Configuration 3.0//EN&quot;</span> <span class="meta-string">&quot;http://tiles.apache.org/dtds/tiles-config_3_0.dtd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">tiles-definitions</span>&gt;</span>	<span class="tag">&lt;<span class="name">definition</span> <span class="attr">name</span>=<span class="string">&quot;base&quot;</span> <span class="attr">template</span>=<span class="string">&quot;/WEB-INF/layout/page.jsp&quot;</span>&gt;</span>    	<span class="tag">&lt;<span class="name">put-attribute</span> <span class="attr">name</span>=<span class="string">&quot;header&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/layout/header.jsp&quot;</span>/&gt;</span>        <span class="tag">&lt;<span class="name">put-attribute</span> <span class="attr">name</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/layout/footer.jsp&quot;</span>/&gt;</span>    <span class="tag">&lt;/<span class="name">definition</span>&gt;</span>    <span class="tag">&lt;<span class="name">definition</span> <span class="attr">name</span>=<span class="string">&quot;home&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;base&quot;</span>&gt;</span>    	<span class="tag">&lt;<span class="name">put-attribute</span> <span class="attr">name</span>=<span class="string">&quot;body&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/views/home.jsp&quot;</span>/&gt;</span>    <span class="tag">&lt;/<span class="name">definition</span>&gt;</span>    <span class="tag">&lt;<span class="name">definition</span> <span class="attr">name</span>=<span class="string">&quot;registerForm&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;base&quot;</span>&gt;</span>    	<span class="tag">&lt;<span class="name">put-attribute</span> <span class="attr">name</span>=<span class="string">&quot;body&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/views/registerForm.jsp&quot;</span>/&gt;</span>    <span class="tag">&lt;/<span class="name">definition</span>&gt;</span>    <span class="tag">&lt;<span class="name">definition</span> <span class="attr">name</span>=<span class="string">&quot;profile&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;base&quot;</span>&gt;</span>    	<span class="tag">&lt;<span class="name">put-attribute</span> <span class="attr">name</span>=<span class="string">&quot;body&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/views/profile.jsp&quot;</span>/&gt;</span>    <span class="tag">&lt;/<span class="name">definition</span>&gt;</span>    <span class="tag">&lt;<span class="name">definition</span> <span class="attr">name</span>=<span class="string">&quot;spittles&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;base&quot;</span>&gt;</span>    	<span class="tag">&lt;<span class="name">put-attribute</span> <span class="attr">name</span>=<span class="string">&quot;body&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/views/spittles.jsp&quot;</span>/&gt;</span>    <span class="tag">&lt;/<span class="name">definition</span>&gt;</span>    <span class="tag">&lt;<span class="name">definition</span> <span class="attr">name</span>=<span class="string">&quot;spittle&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;base&quot;</span>&gt;</span>    	<span class="tag">&lt;<span class="name">put-attribute</span> <span class="attr">name</span>=<span class="string">&quot;body&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/view/spittle.jsp&quot;</span>/&gt;</span>    <span class="tag">&lt;/<span class="name">definition</span>&gt;</span><span class="tag">&lt;/<span class="name">tiles-definitions</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¯ä¸ª <code>&lt;definition&gt;</code> å…ƒç´ éƒ½å®šä¹‰äº†ä¸€ä¸ª <code>Tile</code>ï¼Œå®ƒæœ€ç»ˆå¼•ç”¨çš„æ˜¯ä¸€ä¸ª <code>JSP</code> æ¨¡æ¿ã€‚åœ¨åä¸º base çš„ Tile ä¸­ï¼Œæ¨¡æ¿å¼•ç”¨çš„æ˜¯ â€œ/WEB-INF/layout/page.jspâ€ã€‚æŸä¸ª Tile å¯èƒ½è¿˜ä¼šå¼•ç”¨å…¶ä»–çš„ JSP æ¨¡æ¿ï¼Œä½¿è¿™äº› JSP æ¨¡æ¿åµŒå…¥åˆ°ä¸»æ¨¡æ¿ä¸­ã€‚å¯¹äº base Tile æ¥è®²ï¼Œå®ƒå¼•ç”¨çš„æ˜¯ä¸€ä¸ªå¤´éƒ¨ JSP æ¨¡æ¿å’Œä¸€ä¸ªåº•éƒ¨ JSP æ¨¡æ¿ã€‚</p>
<p>base Tile æ‰€å¼•ç”¨çš„ page.jsp æ¨¡æ¿å¦‚ä¸‹é¢ç¨‹åºæ¸…å•æ‰€ç¤ºã€‚</p>
<center>ç¨‹åºæ¸…å• 6.3ã€€ä¸»å¸ƒå±€æ¨¡æ¿ï¼šå¼•ç”¨å…¶ä»–æ¨¡æ¿æ¥åˆ›å»ºè§†å›¾</center>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://www.springframework.org/tags&quot;</span> prefix=<span class="string">&quot;s&quot;</span> %&gt;&lt;%@ taglib uri=<span class="string">&quot;http://tiles.apache.org/tags-tiles&quot;</span> prefix=<span class="string">&quot;t&quot;</span> %&gt;&lt;%@ page session=<span class="string">&quot;false&quot;</span> %&gt;&lt;html&gt;    &lt;head&gt;        &lt;titile&gt;Spittr&lt;/titile&gt;        &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;&lt;s:url value=&quot;</span>/resource/style.css<span class="string">&quot;/&gt;&quot;</span>&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;div id=<span class="string">&quot;header&quot;</span>&gt;            &lt;t:insertAttribute name=<span class="string">&quot;header&quot;</span>/&gt;        &lt;/div&gt;        &lt;div id=<span class="string">&quot;content&quot;</span>&gt;            &lt;t:insertAttribute name=<span class="string">&quot;body&quot;</span>/&gt;        &lt;/div&gt;        &lt;div id=<span class="string">&quot;footer&quot;</span>&gt;            &lt;t:insertAttribute name=<span class="string">&quot;footer&quot;</span>/&gt;        &lt;/div&gt;    &lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;t:insertAttribute&gt;</code> JSP æ ‡ç­¾æ¥æ’å…¥å…¶ä»–çš„æ¨¡æ¿ã€‚åœ¨è¿™é‡Œï¼Œç”¨å®ƒæ¥æ’å…¥åä¸º headerã€body å’Œ footer çš„æ¨¡æ¿ã€‚æœ€ç»ˆï¼Œå®ƒä¼šå½¢æˆå›¾ 6.4 æ‰€ç¤ºçš„å¸ƒå±€ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211101164020716.png" alt="image-20211101164020716"></p>
<center>å›¾ 6.4ã€€é€šç”¨çš„å¸ƒå±€ï¼Œå®šä¹‰äº†å¤´éƒ¨ã€ä¸»ä½“åŒºä»¥åŠåº•éƒ¨</center>

<p>åœ¨ base Tile å®šä¹‰ä¸­ï¼Œheader å’Œ footer å±æ€§åˆ†åˆ«è¢«è®¾ç½®ä¸ºå¼•ç”¨ â€œ/WEBINF/layout/ header. jspâ€ å’Œ â€œ/WEB-INF/layout/footer.jspâ€ã€‚ä½†æ˜¯ body å±æ€§å‘¢ï¼Ÿå®ƒæ˜¯åœ¨å“ªé‡Œè®¾ç½®çš„å‘¢ï¼Ÿ</p>
<p>åœ¨è¿™é‡Œï¼Œbase Tile ä¸ä¼šæœŸæœ›å•ç‹¬ä½¿ç”¨ã€‚å®ƒä¼šä½œä¸ºåŸºç¡€å®šä¹‰ï¼ˆè¿™æ˜¯å…¶åå­—çš„æ¥å†ï¼‰ï¼Œä¾›å…¶ä»–çš„ Tile å®šä¹‰æ‰©å±•ã€‚åœ¨ç¨‹åºæ¸…å• 6.2 çš„å…¶ä½™å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ä»–çš„ Tile å®šä¹‰éƒ½æ˜¯æ‰©å±•è‡ª base Tileã€‚å®ƒæ„å‘³ç€å®ƒä»¬ä¼šç»§æ‰¿å…¶ header å’Œ footer å±æ€§çš„è®¾ç½®ï¼ˆå½“ç„¶ï¼ŒTile å®šä¹‰ä¸­ä¹Ÿå¯ä»¥è¦†ç›–æ‰è¿™äº›å±æ€§ï¼‰ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªéƒ½è®¾ç½®äº† body å±æ€§ï¼Œç”¨æ¥æŒ‡å®šæ¯ä¸ª Tile ç‰¹æœ‰çš„ JSP æ¨¡æ¿ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å…³æ³¨ä¸€ä¸‹ home Tileï¼Œå®ƒæ‰©å±•äº† baseã€‚å› ä¸ºå®ƒæ‰©å±•äº† baseï¼Œå› æ­¤å®ƒä¼šç»§æ‰¿ base ä¸­çš„æ¨¡æ¿å’Œæ‰€æœ‰çš„å±æ€§ã€‚å°½ç®¡ home Tile å®šä¹‰ç›¸å¯¹æ¥è¯´å¾ˆç®€å•ï¼Œä½†æ˜¯å®ƒå®é™…ä¸ŠåŒ…å«äº†å¦‚ä¸‹çš„å®šä¹‰ï¼š</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;definition name=<span class="string">&quot;home&quot;</span> template=<span class="string">&quot;/WEB-INF/layout/page.jsp&quot;</span>&gt;	&lt;put-attribute name=<span class="string">&quot;header&quot;</span> value=<span class="string">&quot;/WEB-INF/layout/header.jsp&quot;</span>/&gt;    &lt;put-attribute name=<span class="string">&quot;footer&quot;</span> value=<span class="string">&quot;/WEB-INF/layout/footer.jsp&quot;</span>/&gt;    &lt;put-attribute name=<span class="string">&quot;body&quot;</span> value=<span class="string">&quot;/WEB-INF/views/home.jsp&quot;</span>/&gt;&lt;/definition&gt;</span><br></pre></td></tr></table></figure>

<p>å±æ€§æ‰€å¼•ç”¨çš„æ¯ä¸ªæ¨¡æ¿æ˜¯å¾ˆç®€å•çš„ï¼Œå¦‚ä¸‹æ˜¯ header.jsp æ¨¡æ¿ï¼š</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://www.springframework.org/tags&quot;</span> prefix=<span class="string">&quot;s&quot;</span> %&gt;&lt;a href=<span class="string">&quot;&lt;s:url value=&quot;</span>/<span class="string">&quot;/&gt;&quot;</span>&gt;&lt;img src=<span class="string">&quot;&lt;s:url value=&quot;</span>/resources<span class="string">&quot;/&gt;/imgages/spittr_logo_50.png&quot;</span> border=<span class="string">&quot;0&quot;</span>/&gt;&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>footer.jsp æ¨¡æ¿æ›´ä¸ºç®€å•ï¼š</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Copyright &amp;copy; Craig Walls</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸ªæ‰©å±•è‡ª base çš„ Tile éƒ½å®šä¹‰äº†è‡ªå·±çš„ä¸»ä½“åŒºæ¨¡æ¿ï¼Œæ‰€ä»¥æ¯ä¸ªéƒ½ä¼šä¸å…¶ä»–çš„æœ‰æ‰€åŒºåˆ«ã€‚ä½†æ˜¯ä¸ºäº†å®Œæ•´åœ°äº†è§£ home Tileï¼Œå¦‚ä¸‹å±•ç°äº† home.jspï¼š</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix=<span class="string">&quot;c&quot;</span> %&gt;&lt;%@ page session=<span class="string">&quot;false&quot;</span> %&gt;&lt;h1&gt;    Welcome to Spittr&lt;/h1&gt;&lt;a href=<span class="string">&quot;&lt;c:url value=&quot;</span>/spittles<span class="string">&quot;/&gt;&quot;</span>&gt;Spittles&lt;/a&gt;&lt;a href=<span class="string">&quot;&lt;c:url value=&quot;</span>/spitter/register<span class="string">&quot;/&gt;&quot;</span>&gt;Register&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„å…³é”®ç‚¹åœ¨äºé€šç”¨çš„å…ƒç´ æ”¾åˆ°äº† page.jspã€header.jsp ä»¥åŠ footer.jsp ä¸­ï¼Œå…¶ä»–çš„ Tile æ¨¡æ¿ä¸­ä¸å†åŒ…å«è¿™éƒ¨åˆ†å†…å®¹ã€‚è¿™ä½¿å¾—å®ƒä»¬èƒ½å¤Ÿè·¨é¡µé¢é‡ç”¨ï¼Œè¿™äº›å…ƒç´ çš„ç»´æŠ¤ä¹Ÿå¾—ä»¥ç®€åŒ–ã€‚</p>
<p>è¦æƒ³çœ‹ä¸€ä¸‹è¿™äº›å…ƒç´ ç»„åˆåœ¨ä¸€èµ·çš„æ ·å­ï¼Œé‚£ä¹ˆå¯ä»¥çœ‹ä¸€ä¸‹å›¾ 6.5ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œå®ƒåŒ…å«äº†ä¸€äº›æ ·å¼å’Œå›¾åƒä»¥å¢åŠ åº”ç”¨çš„ç¾è§‚æ€§ã€‚æˆ‘ä»¬ä¸æ˜¯ä¸“é—¨è®¨è®ºä½¿ç”¨ Tiles å®ç°é¡µé¢å¸ƒå±€çš„ï¼Œå› æ­¤åœ¨æœ¬èŠ‚ä¸­ä¸ä¼šæ¶µç›–æ‰€æœ‰çš„ç»†èŠ‚ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é¡µé¢ä¸Šçš„å„ç§ç»„ä»¶é€šè¿‡ Tile å®šä¹‰ç»„åˆåœ¨äº†ä¸€èµ·ï¼Œå¹¶ä¸”æ¸²æŸ“å‡ºäº† Spittr åº”ç”¨çš„ä¸»é¡µã€‚</p>
<p>åœ¨ Java Web åº”ç”¨é¢†åŸŸï¼ŒJSP é•¿æœŸä»¥æ¥éƒ½æ˜¯å æ®ä¸»å¯¼åœ°ä½çš„æ–¹æ¡ˆã€‚ä½†æ˜¯ï¼Œåœ¨è¿™ä¸ªé¢†åŸŸæœ‰äº†æ–°çš„ç«äº‰è€…ï¼Œä¹Ÿå°±æ˜¯ Thymeleafã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ Spring MVC åº”ç”¨ä¸­ä½¿ç”¨ Thymeleafã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211101170930669.png" alt="image-20211101170930669"></p>
<center>å›¾ 6.5ã€€Spittr é¦–é¡µï¼Œé€šè¿‡ Apache Tiles è¿›è¡Œçš„å¸ƒå±€</center>

<h3 id="ä½¿ç”¨-Thymeleaf"><a href="#ä½¿ç”¨-Thymeleaf" class="headerlink" title="ä½¿ç”¨  Thymeleaf"></a>ä½¿ç”¨  Thymeleaf</h3><p>å°½ç®¡ JSP å·²ç»å­˜åœ¨äº†å¾ˆé•¿çš„æ—¶é—´ï¼Œå¹¶ä¸”åœ¨ Java Web æœåŠ¡å™¨ä¸­æ— å¤„ä¸åœ¨ï¼Œä½†æ˜¯å®ƒå´å­˜åœ¨ä¸€äº›ç¼ºé™·ã€‚JSP æœ€æ˜æ˜¾çš„é—®é¢˜åœ¨äºå®ƒçœ‹èµ·æ¥åƒ HTML æˆ– XMLï¼Œä½†å®ƒå…¶å®ä¸Šå¹¶ä¸æ˜¯ã€‚å¤§å¤šæ•°çš„ JSP æ¨¡æ¿éƒ½æ˜¯é‡‡ç”¨ HTML çš„å½¢å¼ï¼Œä½†æ˜¯åˆæºæ‚ä¸Šäº†å„ç§ JSP æ ‡ç­¾åº“çš„æ ‡ç­¾ï¼Œä½¿å…¶å˜å¾—å¾ˆæ··ä¹±ã€‚</p>
<p>è¿™äº›æ ‡ç­¾åº“èƒ½å¤Ÿä»¥å¾ˆä¾¿åˆ©çš„æ–¹å¼ä¸º JSP å¸¦æ¥åŠ¨æ€æ¸²æŸ“çš„å¼ºå¤§åŠŸèƒ½ï¼Œä½†æ˜¯å®ƒä¹Ÿæ‘§æ¯äº†æˆ‘ä»¬æƒ³ç»´æŒä¸€ä¸ªæ ¼å¼è‰¯å¥½çš„æ–‡æ¡£çš„å¯èƒ½æ€§ã€‚ä½œä¸ºä¸€ä¸ªæç«¯çš„æ ·ä¾‹ï¼Œå¦‚ä¸‹çš„ JSP æ ‡ç­¾ç”šè‡³ä½œä¸º HTML å‚æ•°çš„å€¼ï¼š</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;text&quot;</span> value=<span class="string">&quot;&lt;c:out value=&quot;</span>$&#123;thing.name&#125;<span class="string">&quot;/&gt;&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>æ ‡ç­¾åº“å’Œ JSP ç¼ºä¹è‰¯å¥½æ ¼å¼çš„ä¸€ä¸ªå‰¯ä½œç”¨å°±æ˜¯å®ƒå¾ˆå°‘èƒ½å¤Ÿä¸å…¶äº§ç”Ÿçš„ HTML ç±»ä¼¼ã€‚æ‰€ä»¥ï¼Œåœ¨ Web æµè§ˆå™¨æˆ– HTML ç¼–è¾‘å™¨ä¸­æŸ¥çœ‹æœªç»æ¸²æŸ“çš„ JSP æ¨¡æ¿æ˜¯éå¸¸ä»¤äººå›°æƒ‘çš„ï¼Œè€Œä¸”å¾—åˆ°çš„ç»“æœçœ‹ä¸Šå»ä¹Ÿéå¸¸ä¸‘é™‹ã€‚è¿™ä¸ªç»“æœæ˜¯ä¸å®Œæ•´çš„â€”â€”åœ¨è§†è§‰ä¸Šè¿™ç®€ç›´å°±æ˜¯ä¸€åœºç¾éš¾ï¼å› ä¸º JSP å¹¶ä¸æ˜¯çœŸæ­£çš„ HTMLï¼Œå¾ˆå¤šæµè§ˆå™¨å’Œç¼–è¾‘å™¨å±•ç°çš„æ•ˆæœéƒ½å¾ˆéš¾åœ¨å®¡ç¾ä¸Šæ¥è¿‘æ¨¡æ¿æœ€ç»ˆæ‰€æ¸²æŸ“å‡ºæ¥çš„æ•ˆæœã€‚</p>
<p>åŒæ—¶ï¼ŒJSP è§„èŒƒæ˜¯ä¸ Servlet è§„èŒƒç´§å¯†è€¦åˆçš„ã€‚è¿™æ„å‘³ç€å®ƒåªèƒ½ç”¨åœ¨åŸºäº Servlet çš„ Web åº”ç”¨ä¹‹ä¸­ã€‚JSP æ¨¡æ¿ä¸èƒ½ä½œä¸ºé€šç”¨çš„æ¨¡æ¿ï¼ˆå¦‚æ ¼å¼åŒ– Emailï¼‰ï¼Œä¹Ÿä¸èƒ½ç”¨äºé Servlet çš„ Web åº”ç”¨ã€‚</p>
<p>å¤šå¹´æ¥ï¼Œåœ¨ Java åº”ç”¨ä¸­ï¼Œæœ‰å¤šä¸ªé¡¹ç›®è¯•å›¾æŒ‘æˆ˜ JSP åœ¨è§†å›¾é¢†åŸŸçš„ç»Ÿæ²»æ€§åœ°ä½ã€‚æœ€æ–°çš„æŒ‘æˆ˜è€…æ˜¯ Thymeleafï¼Œå®ƒå±•ç°äº†ä¸€äº›åˆ‡å®çš„æ‰¿è¯ºï¼Œæ˜¯ä¸€é¡¹å¾ˆä»¤äººå…´å¥‹çš„å¯é€‰æ–¹æ¡ˆã€‚Thymeleaf æ¨¡æ¿æ˜¯åŸç”Ÿçš„ï¼Œä¸ä¾èµ–äºæ ‡ç­¾åº“ã€‚å®ƒèƒ½åœ¨æ¥å—åŸå§‹ HTML çš„åœ°æ–¹è¿›è¡Œç¼–è¾‘å’Œæ¸²æŸ“ã€‚å› ä¸ºå®ƒæ²¡æœ‰ ä¸Servlet è§„èŒƒè€¦åˆï¼Œå› æ­¤ Thymeleaf æ¨¡æ¿èƒ½å¤Ÿè¿›å…¥ JSP æ‰€æ— æ³•æ¶‰è¶³çš„é¢†åŸŸã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ Spring MVC ä¸­ä½¿ç”¨ Thymeleafã€‚</p>
<h4 id="é…ç½®-Thymeleaf-è§†å›¾è§£æå™¨"><a href="#é…ç½®-Thymeleaf-è§†å›¾è§£æå™¨" class="headerlink" title="é…ç½® Thymeleaf è§†å›¾è§£æå™¨"></a>é…ç½® Thymeleaf è§†å›¾è§£æå™¨</h4><p>ä¸ºäº†è¦åœ¨ Spring ä¸­ä½¿ç”¨ Thymeleafï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ä¸‰ä¸ªå¯ç”¨ Thymeleaf ä¸ Spring é›†æˆçš„ beanï¼š</p>
<ul>
<li>ThymeleafViewResolverï¼šå°†é€»è¾‘è§†å›¾åç§°è§£æä¸º Thymeleaf æ¨¡æ¿è§†å›¾ï¼›</li>
<li>SpringTemplateEngineï¼šå¤„ç†æ¨¡æ¿å¹¶æ¸²æŸ“ç»“æœï¼›</li>
<li>TemplateResolverï¼šåŠ è½½Thymeleafæ¨¡æ¿ã€‚</li>
</ul>
<p>å¦‚ä¸‹ä¸ºå£°æ˜è¿™äº› bean çš„ Java é…ç½®ã€‚</p>
<center>ç¨‹åºæ¸…å• 6.4ã€€ä½¿ç”¨ Java ä»£ç çš„æ–¹å¼ï¼Œé…ç½® Spring å¯¹ Thymeleaf çš„æ”¯æŒ</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">ViewResolver <span class="title">viewResolver</span><span class="params">(SpringTemplateEngine templateEngine)</span> </span>&#123;  ThymeleafViewResolver viewResolver = <span class="keyword">new</span> ThymeleafViewResolver(); <span class="comment">// thymeleaf è§†å›¾è§£æå™¨  viewResolver.setTemplateEngine(templateEngine);  return viewResolver;&#125;@Beanpublic SpringTemplateEngine templateEngine(TemplateResolver templateResolver) &#123;  SpringTemplateEngine templateEngine = new SpringTemplateEngine(); // æ¨¡æ¿å¼•æ“  templateEngine.setTemplateResolver(templateResolver);  return templateEngine;&#125;@Beanpublic TemplateResolver templateResolver() &#123;  TemplateResolver templateResolver = new ServletContextTemplateResolver(); // æ¨¡æ¿è§£æå™¨  templateResolver.setPrefix(&quot;/WEB-INF/views/&quot;);  templateResolver.setSuffix(&quot;.html&quot;);  templateResolver.setTemplateMode(&quot;HTML5&quot;);  return templateResolver;&#125; </span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æ›´æ„¿æ„ä½¿ç”¨ XML æ¥é…ç½® beanï¼Œé‚£ä¹ˆå¦‚ä¸‹çš„å£°æ˜èƒ½å¤Ÿå®Œæˆè¯¥ä»»åŠ¡ã€‚</p>
<center>ç¨‹åºæ¸…å• 6.5ã€€ä½¿ç”¨ XML çš„æ–¹å¼ï¼Œé…ç½® Spring å¯¹ Thymeleaf çš„æ”¯æŒ</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;viewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.thymeleaf.spring3.view.ThymeleafViewResolver&quot;</span>      <span class="attr">p:templateEngine-ref</span>=<span class="string">&quot;templateEngine&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;templateEngine&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.thymeleaf.spring3.SpringTemplateEngine&quot;</span>      <span class="attr">p:templateResolver-ref</span>=<span class="string">&quot;templateResolver&quot;</span> /&gt;</span>            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;templateResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.thymeleaf.templateResolver.ServletContextTemplateResolver&quot;</span>      <span class="attr">p:prefix</span>=<span class="string">&quot;/WEB-INF/templates/&quot;</span>      <span class="attr">p:suffix</span>=<span class="string">&quot;.html&quot;</span>      <span class="attr">p:templateMode</span>=<span class="string">&quot;HTML5&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡ä½¿ç”¨å“ªç§é…ç½®æ–¹å¼ï¼Œ<code>Thymeleaf</code> éƒ½å·²ç»å‡†å¤‡å°±ç»ªäº†ï¼Œå®ƒå¯ä»¥å°†å“åº”ä¸­çš„æ¨¡æ¿æ¸²æŸ“åˆ° <code>Spring MVC</code> æ§åˆ¶å™¨æ‰€å¤„ç†çš„è¯·æ±‚ä¸­ã€‚</p>
<p><code>ThymeleafViewResolver</code> æ˜¯ <code>Spring MVC</code> ä¸­ <code>ViewResolver</code> çš„ä¸€ä¸ª å®ç°ç±»ã€‚åƒå…¶ä»–çš„è§†å›¾è§£æå™¨ä¸€æ ·ï¼Œå®ƒä¼šæ¥å—ä¸€ä¸ªé€»è¾‘è§†å›¾åç§°ï¼Œå¹¶å°†å…¶è§£æä¸ºè§†å›¾ã€‚ä¸è¿‡åœ¨è¯¥åœºæ™¯ä¸‹ï¼Œè§†å›¾ä¼šæ˜¯ä¸€ä¸ª <code>Thymeleaf</code> æ¨¡æ¿ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ <code>ThymeleafViewResolver bean</code> ä¸­æ³¨å…¥äº†ä¸€ä¸ªå¯¹ <code>SpringTemplateEngine bean</code> çš„å¼•ç”¨ã€‚<code>SpringTemplateEngine</code> ä¼šåœ¨ Spring ä¸­å¯ç”¨ <code>Thymeleaf</code> å¼•æ“ï¼Œç”¨æ¥è§£ææ¨¡æ¿ï¼Œå¹¶åŸºäºè¿™äº›æ¨¡æ¿æ¸²æŸ“ç»“æœã€‚å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¸ºå…¶æ³¨å…¥äº†ä¸€ä¸ª <code>TemplateResolver bean</code> çš„å¼•ç”¨ã€‚</p>
<p><code>TemplateResolver</code> ä¼šæœ€ç»ˆå®šä½å’ŒæŸ¥æ‰¾æ¨¡æ¿ã€‚ä¸ä¹‹å‰é…ç½® <code>InternalResourceViewResolver</code> ç±»ä¼¼ï¼Œå®ƒä½¿ç”¨äº† prefix å’Œ suffix å±æ€§ã€‚å‰ç¼€å’Œåç¼€å°†ä¼šä¸é€»è¾‘è§†å›¾åç»„åˆä½¿ç”¨ï¼Œè¿›è€Œå®šä½ <code>Thymeleaf</code> å¼•æ“ã€‚å®ƒçš„ <code>templateMode</code> å±æ€§è¢«è®¾ç½®æˆäº† <code>HTML 5</code>ï¼Œè¿™è¡¨æ˜æˆ‘ä»¬é¢„æœŸè¦è§£æçš„æ¨¡æ¿ä¼šæ¸²æŸ“æˆ <code>HTML 5</code> è¾“å‡ºã€‚</p>
<p>æ‰€æœ‰çš„ <code>Thymeleaf bean</code> éƒ½å·²ç»é…ç½®å®Œæˆäº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬è¯¥åˆ›å»ºå‡ ä¸ªè§†å›¾äº†ã€‚</p>
<h4 id="å®šä¹‰-Thymeleaf-æ¨¡æ¿"><a href="#å®šä¹‰-Thymeleaf-æ¨¡æ¿" class="headerlink" title="å®šä¹‰ Thymeleaf æ¨¡æ¿"></a>å®šä¹‰ Thymeleaf æ¨¡æ¿</h4><p>Thymeleaf åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå°±æ˜¯ HTML æ–‡ä»¶ï¼Œä¸ JSPä¸åŒï¼Œå®ƒæ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„æ ‡ç­¾æˆ–æ ‡ç­¾åº“ã€‚Thymeleaf ä¹‹æ‰€ä»¥èƒ½å¤Ÿå‘æŒ¥ä½œç”¨ï¼Œæ˜¯å› ä¸ºå®ƒé€šè¿‡è‡ªå®šä¹‰çš„å‘½åç©ºé—´ï¼Œä¸ºæ ‡å‡†çš„ HTML æ ‡ç­¾é›†åˆæ·»åŠ  Thymeleaf å±æ€§ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº† home.htmlï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ Thymeleaf å‘½åç©ºé—´çš„é¦–é¡µæ¨¡æ¿ã€‚</p>
<center>ç¨‹åºæ¸…å• 6.6ã€€home.htmlï¼šä½¿ç”¨ Thymeleaf å‘½åç©ºé—´çš„é¦–é¡µæ¨¡æ¿å¼•æ“</center>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span>      <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">head</span>&gt;</span>    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Spitter<span class="tag">&lt;/<span class="name">title</span>&gt;</span>    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>           <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>           <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/resources/style.css&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">link</span>&gt;</span>  <span class="tag">&lt;/<span class="name">head</span>&gt;</span>  <span class="tag">&lt;<span class="name">body</span>&gt;</span>    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span>&gt;</span>      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to Spitter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/spittles&#125;&quot;</span>&gt;</span>Spittles<span class="tag">&lt;/<span class="name">a</span>&gt;</span> |       <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/spitter/register&#125;&quot;</span>&gt;</span>Register<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  <span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¦–é¡µæ¨¡æ¿ç›¸å¯¹æ¥è®²å¾ˆç®€å•ï¼Œåªä½¿ç”¨äº† <code>th:href</code> å±æ€§ã€‚è¿™ä¸ªå±æ€§ä¸å¯¹åº”çš„åŸç”Ÿ HTML å±æ€§å¾ˆç±»ä¼¼ï¼Œä¹Ÿå°±æ˜¯ <code>href</code> å±æ€§ï¼Œå¹¶ä¸”å¯ä»¥æŒ‰ç…§ç›¸åŒçš„æ–¹å¼æ¥ä½¿ç”¨ã€‚<code>th:href</code> å±æ€§çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºå®ƒçš„å€¼ä¸­å¯ä»¥åŒ…å« Thymeleaf è¡¨è¾¾å¼ï¼Œç”¨æ¥è®¡ç®—åŠ¨æ€çš„å€¼ã€‚å®ƒä¼šæ¸²æŸ“æˆä¸€ä¸ªæ ‡å‡†çš„ href å±æ€§ï¼Œå…¶ä¸­ä¼šåŒ…å«åœ¨æ¸²æŸ“æ—¶åŠ¨æ€åˆ›å»ºå¾—åˆ°çš„å€¼ã€‚è¿™æ˜¯ Thymeleaf å‘½åç©ºé—´ä¸­å¾ˆå¤šå±æ€§çš„è¿è¡Œæ–¹å¼ï¼šå®ƒä»¬å¯¹åº”æ ‡å‡†çš„ HTML å±æ€§ï¼Œå¹¶ä¸”å…·æœ‰ç›¸åŒçš„åç§°ï¼Œä½†æ˜¯ä¼šæ¸²æŸ“ä¸€äº›è®¡ç®—åå¾—åˆ°çš„å€¼ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œä½¿ç”¨ <code>th:href</code> å±æ€§çš„ä¸‰ä¸ªåœ°æ–¹éƒ½ç”¨åˆ°äº† <code>@&#123;&#125;</code> è¡¨è¾¾å¼ï¼Œç”¨æ¥è®¡ç®—ç›¸å¯¹äº URL çš„è·¯å¾„ï¼ˆå°±åƒåœ¨ JSP é¡µé¢ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä½¿ç”¨çš„ JSTL <code>&lt;c:url&gt;</code> æ ‡ç­¾æˆ– Spring æ ‡ç­¾ç±»ä¼¼ï¼‰ã€‚</p>
<p>å°½ç®¡ home.html æ˜¯ä¸€ä¸ªç›¸å½“ç®€å•çš„ Thymeleaf æ¨¡æ¿ï¼Œä½†æ˜¯å®ƒä¾ç„¶å¾ˆæœ‰ä»·å€¼ï¼Œè¿™åœ¨äºå®ƒä¸çº¯ HTML æ¨¡æ¿éå¸¸æ¥è¿‘ã€‚å”¯ä¸€çš„åŒºåˆ«ä¹‹å¤„åœ¨äº th:href å±æ€§ï¼Œå¦åˆ™çš„è¯ï¼Œå®ƒå°±æ˜¯åŸºç¡€ä¸”åŠŸèƒ½ä¸°å¯Œçš„ HTML æ–‡ä»¶ã€‚</p>
<p>è¿™æ„å‘³ç€ Thymeleaf æ¨¡æ¿ä¸ JSP ä¸åŒï¼Œå®ƒèƒ½å¤ŸæŒ‰ç…§åŸå§‹çš„æ–¹å¼è¿›è¡Œç¼–è¾‘ç”šè‡³æ¸²æŸ“ï¼Œè€Œä¸å¿…ç»è¿‡ä»»ä½•ç±»å‹çš„å¤„ç†å™¨ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬éœ€è¦ Thymeleaf æ¥å¤„ç†æ¨¡æ¿å¹¶æ¸²æŸ“å¾—åˆ°æœ€ç»ˆæœŸæœ›çš„è¾“å‡ºã€‚å³ä¾¿å¦‚æ­¤ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•ç‰¹æ®Šçš„å¤„ç†ï¼Œhome.html ä¹Ÿèƒ½å¤ŸåŠ è½½åˆ° Web æµè§ˆå™¨ä¸­ï¼Œå¹¶ä¸”çœ‹ä¸Šå»ä¸å®Œæ•´æ¸²æŸ“çš„æ•ˆæœå¾ˆç±»ä¼¼ã€‚ä¸ºäº†æ›´åŠ æ¸…æ™°åœ°é˜è¿°è¿™ä¸€ç‚¹ï¼Œå›¾ 6.6 å¯¹æ¯”äº† home.jspï¼ˆä¸Šæ–¹ï¼‰å’Œ home.htmlï¼ˆä¸‹æ–¹ï¼‰åœ¨ Web æµè§ˆå™¨ä¸­çš„æ˜¾ç¤ºæ•ˆæœã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ Web æµè§ˆå™¨ä¸­ï¼ŒJSP æ¨¡æ¿çš„æ¸²æŸ“æ•ˆæœå¾ˆç³Ÿç³•ã€‚å°½ç®¡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€äº›ç†Ÿæ‚‰çš„å…ƒç´ ï¼Œä½†æ˜¯ JSP æ ‡ç­¾åº“çš„å£°æ˜ä¹Ÿæ˜¾ç¤ºäº†å‡ºæ¥ã€‚åœ¨é“¾æ¥å‰å‡ºç°äº†ä¸€äº›ä»¤äººè´¹è§£çš„æœªé—­åˆæ ‡è®°ï¼Œè¿™æ˜¯ Web æµè§ˆå™¨æ²¡æœ‰æ­£å¸¸è§£æ <code>&lt;s:url&gt;</code> æ ‡ç­¾çš„ç»“æœã€‚</p>
<p>ä¸ä¹‹ç›¸åï¼ŒThymeleaf æ¨¡æ¿çš„æ¸²æŸ“æ•ˆæœåŸºæœ¬ä¸Šæ²¡æœ‰ä»»ä½•é”™è¯¯ã€‚ç¨å¾®æœ‰ç‚¹é—®é¢˜çš„æ˜¯é“¾æ¥éƒ¨åˆ†ï¼ŒWeb æµè§ˆå™¨å¹¶ä¸ä¼šåƒå¤„ç† href å±æ€§é‚£æ ·å¤„ç† th:hrefï¼Œæ‰€ä»¥é“¾æ¥å¹¶æ²¡æœ‰æ¸²æŸ“ä¸ºé“¾æ¥çš„æ ·å­ã€‚é™¤äº†è¿™äº›ç»†å¾®çš„é—®é¢˜ï¼Œæ¨¡æ¿çš„æ¸²æŸ“æ•ˆæœä¸æˆ‘ä»¬çš„é¢„æœŸå®Œå…¨ç¬¦åˆã€‚</p>
<p>åƒ home.jsp è¿™æ ·çš„æ¨¡æ¿ä½œä¸º Thymeleaf å…¥é—¨æ˜¯å¾ˆåˆé€‚çš„ã€‚ä½†æ˜¯ Spring çš„ JSP æ ‡ç­¾æ‰€æ“…é•¿çš„æ˜¯è¡¨å•ç»‘å®šã€‚å¦‚æœæˆ‘ä»¬æŠ›å¼ƒ JSP çš„è¯ï¼Œé‚£æ˜¯ä¸æ˜¯ä¹Ÿè¦æŠ›å¼ƒè¡¨å•ç»‘å®šå‘¢ï¼Ÿä¸å¿…æ‹…å¿ƒã€‚Thymeleaf æä¾›äº†ä¸ä¹‹ç›¸åŒ¹æ•Œçš„åŠŸèƒ½ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211102141648596.png" alt="image-20211102141648596"></p>
<center>å›¾ 6.6ã€€Thymeleaf æ¨¡æ¿ä¸ JSP ä¸åŒï¼Œå®ƒæ˜¯ HTMLï¼Œå¯ä»¥åƒ HTML é‚£æ ·è¿›è¡Œæ¸²æŸ“å’Œç¼–è¾‘</center>



<p>å€ŸåŠ© Thymeleaf å®ç°è¡¨å•ç»‘å®š</p>
<p>è¡¨å•ç»‘å®šæ˜¯ Spring MVC çš„ä¸€é¡¹é‡è¦ç‰¹æ€§ã€‚å®ƒèƒ½å¤Ÿå°†è¡¨å•æäº¤çš„æ•°æ®å¡«å……åˆ°å‘½ä»¤å¯¹è±¡ä¸­ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™æ§åˆ¶å™¨ï¼Œè€Œåœ¨å±•ç°è¡¨å•çš„æ—¶å€™ï¼Œè¡¨å•ä¸­ä¹Ÿä¼šå¡«å……å‘½ä»¤å¯¹è±¡ä¸­çš„å€¼ã€‚å¦‚æœæ²¡æœ‰è¡¨å•ç»‘å®šåŠŸèƒ½çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿ HTML è¡¨å•åŸŸè¦æ˜ å°„åç«¯å‘½ä»¤å¯¹è±¡ä¸­çš„å±æ€§ï¼Œå¹¶ä¸”åœ¨æ ¡éªŒå¤±è´¥åå±•ç°è¡¨å•çš„æ—¶å€™ï¼Œè¿˜è¦è´Ÿè´£ç¡®ä¿è¾“å…¥åŸŸä¸­å€¼è¦è®¾ç½®ä¸ºå‘½ä»¤å¯¹è±¡çš„å±æ€§ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæœ‰è¡¨å•ç»‘å®šçš„è¯ï¼Œå®ƒå°±ä¼šè´Ÿè´£è¿™äº›äº‹æƒ…äº†ã€‚ä¸ºäº†å¤ä¹ ä¸€ä¸‹è¡¨å•ç»‘å®šæ˜¯å¦‚ä½•è¿è¡Œçš„ï¼Œä¸‹é¢å±•ç°äº†åœ¨ registration.jsp ä¸­çš„ First Name è¾“å…¥åŸŸï¼š</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;sf:label path=<span class="string">&quot;firstName&quot;</span> cssErrorClass=<span class="string">&quot;error&quot;</span>&gt;First Name&lt;/sf:label&gt;&lt;sf:input path=<span class="string">&quot;firstName&quot;</span> cassErrorClass=<span class="string">&quot;error&quot;</span> /&gt;&lt;br/&gt;</span><br></pre></td></tr></table></figure>

<p> åœ¨è¿™é‡Œï¼Œè°ƒç”¨äº† Spring è¡¨å•ç»‘å®šæ ‡ç­¾åº“çš„ <code>&lt;sf:input&gt;</code> æ ‡ç­¾ï¼Œå®ƒä¼šæ¸²æŸ“å‡ºä¸€ä¸ª HTML input æ ‡ç­¾ï¼Œå¹¶ä¸”å…¶ value å±æ€§è®¾ç½®ä¸ºåç«¯å¯¹è±¡ firstName å±æ€§çš„å€¼ã€‚å®ƒè¿˜ä½¿ç”¨äº† Spring çš„ <code>&lt;sf:label&gt;</code> æ ‡ç­¾åŠå…¶ cssErrorClass å±æ€§ï¼Œå¦‚æœå‡ºç°æ ¡éªŒé”™è¯¯çš„è¯ï¼Œä¼šå°†æ–‡æœ¬æ ‡è®°æ¸²æŸ“ä¸ºçº¢è‰²ã€‚</p>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬æœ¬èŠ‚è®¨è®ºçš„å¹¶ä¸æ˜¯ JSPï¼Œè€Œæ˜¯ä½¿ç”¨ Thymeleaf æ›¿æ¢ JSPã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ Spring çš„ JSP æ ‡ç­¾å®ç°è¡¨å•ç»‘å®šï¼Œè€Œæ˜¯ä½¿ç”¨ Thymeleaf çš„ Spring æ–¹è¨€ã€‚</p>
<p>ä½œä¸ºé˜è¿°çš„æ ·ä¾‹ï¼Œè¯·å‚è€ƒå¦‚ä¸‹çš„ Thymeleaf æ¨¡æ¿ç‰‡æ®µï¼Œå®ƒä¼šæ¸²æŸ“ First Name è¾“å…¥åŸŸï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;#fields.hasErrors[&#x27;firstName&#x27;]&#125;?&#x27;error&#x27;&quot;</span>&gt;</span>First Name<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;firstName&#125;&quot;</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;#fields.hasErrors[&#x27;firstName&#x27;]&#125;?&#x27;error&#x27;&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸å†ä½¿ç”¨ Spring JSP æ ‡ç­¾ä¸­çš„ <code>cssClassName</code> å±æ€§ï¼Œè€Œæ˜¯åœ¨æ ‡å‡†çš„ HTML æ ‡ç­¾ä¸Šä½¿ç”¨ <code>th:class</code> å±æ€§ã€‚<code>th:class</code> å±æ€§ä¼šæ¸²æŸ“ä¸ºä¸€ä¸ª class å±æ€§ï¼Œå®ƒçš„å€¼æ˜¯æ ¹æ®ç»™å®šçš„è¡¨è¾¾å¼è®¡ç®—å¾—åˆ°çš„ã€‚åœ¨ä¸Šé¢çš„è¿™ä¸¤ä¸ª <code>th:class</code> å±æ€§ä¸­ï¼Œå®ƒä¼šç›´æ¥æ£€æŸ¥ firstName åŸŸæœ‰æ²¡æœ‰æ ¡éªŒé”™è¯¯ã€‚å¦‚æœæœ‰çš„è¯ï¼Œclass å±æ€§åœ¨æ¸²æŸ“æ—¶çš„å€¼ä¸º errorã€‚å¦‚æœè¿™ä¸ªåŸŸæ²¡æœ‰é”™è¯¯çš„è¯ï¼Œå°†ä¸ä¼šæ¸²æŸ“ class å±æ€§ã€‚</p>
<p><code>&lt;input&gt;</code> æ ‡ç­¾ä½¿ç”¨äº† <code>th:field</code> å±æ€§ï¼Œç”¨æ¥å¼•ç”¨åç«¯å¯¹è±¡çš„ firstName åŸŸã€‚è¿™å¯èƒ½ä¸ä½ çš„é¢„æœŸæœ‰ç‚¹å·®åˆ«ã€‚åœ¨ Thymeleaf æ¨¡æ¿ä¸­ï¼Œ æˆ‘ä»¬åœ¨å¾ˆå¤šæƒ…å†µä¸‹æ‰€ä½¿ç”¨çš„å±æ€§éƒ½å¯¹åº”äºæ ‡å‡†çš„ HTML å±æ€§ï¼Œå› æ­¤è²Œä¼¼ä½¿ç”¨ th:value å±æ€§æ¥è®¾ç½®æ ‡ç­¾çš„ value å±æ€§æ‰æ˜¯åˆç†çš„ã€‚</p>
<p>å…¶å®ä¸ç„¶ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯åœ¨å°†è¿™ä¸ªè¾“å…¥åŸŸç»‘å®šåˆ°åç«¯å¯¹è±¡çš„ firstName å±æ€§ä¸Šï¼Œå› æ­¤ä½¿ç”¨ th:field å±æ€§å¼•ç”¨ firstName åŸŸã€‚é€šè¿‡ä½¿ç”¨ th:fieldï¼Œæˆ‘ä»¬å°† value å±æ€§è®¾ç½®ä¸º firstName çš„å€¼ï¼Œ åŒæ—¶è¿˜ä¼šå°† name å±æ€§è®¾ç½®ä¸º firstNameã€‚</p>
<p>ä¸ºäº†é˜è¿° Thymeleaf æ˜¯å¦‚ä½•å®é™…è¿è¡Œçš„ï¼Œå¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç¤ºäº†å®Œæ•´çš„æ³¨å†Œè¡¨å•æ¨¡æ¿ã€‚</p>
<center>ç¨‹åºæ¸…å• 6.7ã€€æ³¨å†Œé¡µé¢ï¼Œä½¿ç”¨ Thymeleaf å°†ä¸€ä¸ªè¡¨å•ç»‘å®šåˆ°å‘½ä»¤å¯¹è±¡ä¸Š</center>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;spitter&#125;&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;errors&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#fields.hasErrors(&#x27;*&#x27;)&#125;&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">ul</span>&gt;</span>      <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;err : $&#123;#fields.errors(&#x27;*&#x27;)&#125;&quot;</span>           <span class="attr">th:text</span>=<span class="string">&quot;$&#123;err&#125;&quot;</span>&gt;</span>Input is incorrect      <span class="tag">&lt;/<span class="name">li</span>&gt;</span>    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span>  <span class="tag">&lt;/<span class="name">div</span>&gt;</span>  <span class="tag">&lt;<span class="name">label</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;#fields.hasErrors(&#x27;firstName&#x27;)&#125;? &#x27;error&#x27;&quot;</span>&gt;</span>First Name<span class="tag">&lt;/<span class="name">label</span>&gt;</span>:   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;firstName&#125;&quot;</span>  <span class="attr">th:class</span>=<span class="string">&quot;$&#123;#fields.hasErrors(&#x27;firstName&#x27;)&#125;? &#x27;error&#x27;&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>    <span class="tag">&lt;<span class="name">label</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;#fields.hasErrors(&#x27;lastName&#x27;)&#125;? &#x27;error&#x27;&quot;</span>&gt;</span>Last Name<span class="tag">&lt;/<span class="name">label</span>&gt;</span>:   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;lastName&#125;&quot;</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;#fields.hasErrors(&#x27;lastName&#x27;)&#125;? &#x27;error&#x27;&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>    <span class="tag">&lt;<span class="name">label</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;#fields.hasErrors(&#x27;email&#x27;)&#125;? &#x27;error&#x27;&quot;</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span>:   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;email&#125;&quot;</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;#fields.hasErrors(&#x27;email&#x27;)&#125;? &#x27;error&#x27;&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>    <span class="tag">&lt;<span class="name">label</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;#fields.hasErrors(&#x27;username&#x27;)&#125;? &#x27;error&#x27;&quot;</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span>:   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;username&#125;&quot;</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;#fields.hasErrors(&#x27;username&#x27;)&#125;? &#x27;error&#x27;&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>    <span class="tag">&lt;<span class="name">label</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;#fields.hasErrors(&#x27;password&#x27;)&#125;? &#x27;error&#x27;&quot;</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span>:   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;password&#125;&quot;</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;#fields.hasErrors(&#x27;password&#x27;)&#125;? &#x27;error&#x27;&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Register&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¨‹åºæ¸…å• 6.7 ä½¿ç”¨äº†ç›¸åŒçš„ Thymeleaf å±æ€§å’Œ <code>*&#123;&#125;</code> è¡¨è¾¾å¼ï¼Œä¸ºæ‰€æœ‰çš„è¡¨å•åŸŸç»‘å®šåç«¯å¯¹è±¡ã€‚è¿™å…¶å®é‡å¤äº†æˆ‘ä»¬åœ¨ First Name åŸŸä¸­æ‰€åšçš„äº‹æƒ…ã€‚</p>
<p>ä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„æˆ‘ä»¬åœ¨è¡¨å•çš„é¡¶éƒ¨äº†ä¹Ÿä½¿ç”¨äº† Thymeleafï¼Œå®ƒä¼šç”¨æ¥æ¸²æŸ“æ‰€æœ‰çš„é”™è¯¯ã€‚å…ƒç´ ä½¿ç”¨ th:if å±æ€§æ¥æ£€æŸ¥æ˜¯å¦æœ‰æ ¡éªŒé”™è¯¯ã€‚å¦‚æœæœ‰çš„è¯ï¼Œä¼šæ¸²æŸ“ï¼Œå¦åˆ™çš„è¯ï¼Œå®ƒå°†ä¸ä¼šæ¸²æŸ“ã€‚</p>
<p>åœ¨ <code>&lt;div&gt;</code> ä¸­ï¼Œä¼šä½¿ç”¨ä¸€ä¸ªæ— é¡ºåºçš„åˆ—è¡¨æ¥å±•ç°æ¯é¡¹é”™è¯¯ã€‚<code>&lt;li&gt;</code> æ ‡ç­¾ä¸Šçš„ <code>th:each</code> å±æ€§å°†ä¼šé€šçŸ¥ <code>Thymeleaf</code> ä¸ºæ¯é¡¹é”™è¯¯éƒ½æ¸²æŸ“ä¸€ä¸ª <code>&lt;li&gt;</code>ï¼Œåœ¨æ¯æ¬¡è¿­ä»£ä¸­ä¼šå°†å½“å‰é”™è¯¯è®¾ç½®åˆ°ä¸€ä¸ªåä¸º err çš„å˜é‡ä¸­ã€‚</p>
<p><code>&lt;li&gt;</code> æ ‡ç­¾è¿˜æœ‰ä¸€ä¸ª <code>th:text</code> å±æ€§ã€‚è¿™ä¸ªå‘½ä»¤ä¼šé€šçŸ¥ Thymeleaf è®¡ç®—æŸä¸€ä¸ªè¡¨è¾¾å¼ï¼ˆåœ¨æœ¬ä¾‹ä¸­ï¼Œä¹Ÿå°±æ˜¯ err å˜é‡ï¼‰å¹¶å°†å®ƒçš„å€¼æ¸²æŸ“ä¸º <code>&lt;li&gt;</code> æ ‡ç­¾çš„å†…å®¹ä½“ã€‚å®é™…ä¸Šçš„æ•ˆæœå°±æ˜¯æ¯é¡¹é”™è¯¯å¯¹åº”ä¸€ä¸ª <code>&lt;li&gt;</code> å…ƒç´ ï¼Œå¹¶å±•ç°é”™è¯¯çš„æ–‡æœ¬ã€‚</p>
<p>ä½ å¯èƒ½ä¼šæƒ³çŸ¥é“ <code>$&#123;&#125;</code> å’Œ <code>*&#123;&#125;</code> æ‹¬èµ·æ¥çš„è¡¨è¾¾å¼åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚<code>$&#123;&#125;</code> è¡¨è¾¾å¼ï¼ˆå¦‚ <code>$&#123;spitter&#125;</code>ï¼‰æ˜¯å˜é‡è¡¨è¾¾å¼ï¼ˆvariable expressionï¼‰ã€‚ä¸€èˆ¬æ¥è®²ï¼Œå®ƒä»¬ä¼šæ˜¯<a target="_blank" rel="noopener" href="http://commons.apache.org/proper/commons-ognl/">å¯¹è±¡å›¾å¯¼èˆªè¯­è¨€ï¼ˆObject-Graph Navigation Languageï¼ŒOGNLï¼‰è¡¨è¾¾å¼</a> ã€‚ä½†åœ¨ä½¿ç”¨ Spring çš„æ—¶å€™ï¼Œå®ƒä»¬æ˜¯ SpEL è¡¨è¾¾å¼ã€‚åœ¨ <code>$&#123;spitter&#125;</code> è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒä¼šè§£æä¸º key ä¸º spitter çš„ model å±æ€§ã€‚</p>
<p>è€Œå¯¹äº <code>*&#123;&#125;</code> è¡¨è¾¾å¼ï¼Œå®ƒä»¬æ˜¯é€‰æ‹©è¡¨è¾¾å¼ï¼ˆselection expressionï¼‰ã€‚å˜é‡è¡¨è¾¾å¼æ˜¯åŸºäºæ•´ä¸ª SpEL ä¸Šä¸‹æ–‡è®¡ç®—çš„ï¼Œè€Œé€‰æ‹©è¡¨è¾¾å¼æ˜¯åŸºäºæŸä¸€ä¸ªé€‰ä¸­å¯¹è±¡è®¡ç®—çš„ã€‚åœ¨æœ¬ä¾‹çš„è¡¨å•ä¸­ï¼Œé€‰ä¸­å¯¹è±¡å°±æ˜¯ <form> æ ‡ç­¾ä¸­ th:object å±æ€§æ‰€è®¾ç½®çš„å¯¹è±¡ï¼šæ¨¡å‹ä¸­çš„ Spitter å¯¹è±¡ã€‚å› æ­¤ï¼Œ<code>*&#123;firstName&#125;</code> è¡¨è¾¾å¼å°±ä¼šè®¡ç®—ä¸º Spitter å¯¹è±¡çš„ firstName å±æ€§ã€‚</form></p>
<h3 id="å°ç»“-5"><a href="#å°ç»“-5" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å¤„ç†è¯·æ±‚åªæ˜¯ Spring MVC åŠŸèƒ½çš„ä¸€éƒ¨åˆ†ã€‚å¦‚æœæ§åˆ¶å™¨æ‰€äº§ç”Ÿçš„ç»“æœæƒ³è¦è®©äººçœ‹åˆ°ï¼Œé‚£ä¹ˆå®ƒä»¬äº§ç”Ÿçš„æ¨¡å‹æ•°æ®å°±è¦æ¸²æŸ“åˆ°è§†å›¾ä¸­ï¼Œå¹¶å±•ç°åˆ°ç”¨æˆ·çš„ Web æµè§ˆå™¨ä¸­ã€‚Spring çš„è§†å›¾æ¸²æŸ“æ˜¯å¾ˆçµæ´»çš„ï¼Œå¹¶æä¾›äº†å¤šä¸ªå†…ç½®çš„å¯é€‰æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ä¼ ç»Ÿçš„ Java Server Pages ä»¥åŠæµè¡Œçš„ Apache Tiles å¸ƒå±€å¼•æ“ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¿«é€Ÿäº†è§£äº†ä¸€ä¸‹ Spring æ‰€æä¾›çš„è§†å›¾å’Œè§†å›¾è§£æå¯é€‰æ–¹æ¡ˆã€‚æˆ‘ä»¬è¿˜æ·±å…¥å­¦ä¹ äº†å¦‚ä½•åœ¨ Spring MVC ä¸­ä½¿ç”¨ JSP å’Œ Apache Tilesã€‚</p>
<p>æˆ‘ä»¬è¿˜çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ Thymeleaf ä½œä¸º Spring MVC åº”ç”¨çš„è§†å›¾å±‚ï¼Œå®ƒè¢«è§†ä¸º JSP çš„æ›¿ä»£æ–¹æ¡ˆã€‚Thymeleaf æ˜¯ä¸€é¡¹å¾ˆæœ‰å¸å¼•åŠ›çš„æŠ€æœ¯ï¼Œå› ä¸ºå®ƒèƒ½åˆ›å»ºåŸå§‹çš„æ¨¡æ¿ï¼Œè¿™äº›æ¨¡æ¿æ˜¯çº¯ HTMLï¼Œèƒ½åƒé™æ€ HTML é‚£æ ·ä»¥åŸå§‹çš„æ–¹å¼ç¼–å†™å’Œé¢„è§ˆï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶æ¸²æŸ“åŠ¨æ€æ¨¡å‹æ•°æ®ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒThymeleaf æ˜¯ä¸ Servlet æ²¡æœ‰è€¦åˆå…³ç³»çš„ï¼Œè¿™æ ·å®ƒå°±èƒ½å¤Ÿç”¨åœ¨ JSP æ‰€ä¸èƒ½ä½¿ç”¨çš„é¢†åŸŸä¸­ã€‚</p>
<p>Spittr åº”ç”¨çš„è§†å›¾å®šä¹‰å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å·²ç»å…·æœ‰äº†ä¸€ä¸ªè™½ç„¶å¾®å°ä½†æ˜¯å¯éƒ¨ç½²ä¸”å…·æœ‰ä¸€å®šåŠŸèƒ½çš„ Spring MVC Web åº”ç”¨ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ç‰¹æ€§éœ€è¦æ›´æ–°è¿›æ¥ï¼Œå¦‚æ•°æ®æŒä¹…åŒ–å’Œå®‰å…¨æ€§ï¼Œæˆ‘ä»¬ä¼šåœ¨åˆé€‚çš„æ—¶å€™å…³æ³¨è¿™äº›ç‰¹æ€§ã€‚ä½†ç°åœ¨ï¼Œè¿™ä¸ªåº”ç”¨å¼€å§‹å˜å¾—æœ‰æ¨¡æœ‰æ ·äº†ã€‚</p>
<p>åœ¨æ·±å…¥å­¦ä¹ åº”ç”¨çš„æŠ€æœ¯æ ˆä¹‹å‰ï¼Œåœ¨ä¸‹ä¸€ç« æˆ‘ä»¬å°†ä¼šç»§ç»­è®¨è®º Spring MVCï¼Œå­¦ä¹ è¿™ä¸ªæ¡†æ¶ä¸­ä¸€äº›æ›´ä¸ºæœ‰ç”¨å’Œé«˜çº§çš„åŠŸèƒ½ã€‚</p>
<h2 id="Spring-MVC-çš„é«˜çº§æŠ€æœ¯"><a href="#Spring-MVC-çš„é«˜çº§æŠ€æœ¯" class="headerlink" title="Spring MVC çš„é«˜çº§æŠ€æœ¯"></a>Spring MVC çš„é«˜çº§æŠ€æœ¯</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>Spring MVC é…ç½®çš„æ›¿ä»£æ–¹æ¡ˆ</li>
<li>å¤„ç†æ–‡ä»¶ä¸Šä¼ </li>
<li>åœ¨æ§åˆ¶å™¨ä¸­å¤„ç†å¼‚å¸¸</li>
<li>ä½¿ç”¨ flash å±æ€§</li>
</ul>
<p>ç¨ç­‰ï¼Œè¿˜æ²¡æœ‰ç»“æŸï¼ </p>
<p>å¦‚æœä½ åœ¨ç”µè§†è´­ç‰©èŠ‚ç›®ä¸Šçœ‹è¿‡ä¸€äº›å°å‘æ˜æˆ–äº§å“å¹¿å‘Šçš„è¯ï¼Œä½ å¯èƒ½å¬è¿‡ç±»ä¼¼è¿™æ ·çš„è¯ã€‚åœ¨å¹¿å‘Šæè¿°å®Œäº§å“å¹¶å®£ç§°å®ƒèƒ½å¤Ÿåšä»€ä¹ˆä¹‹åï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¬åˆ°â€œç¨ç­‰ï¼Œè¿˜æ²¡æœ‰ç»“æŸï¼â€ï¼Œç„¶åå¹¿å‘Šä¼šç»§ç»­å‘Šè¯‰æˆ‘ä»¬äº§å“è¿˜æœ‰ä»€ä¹ˆä»¤äººæ¿€åŠ¨çš„ç‰¹æ€§ã€‚</p>
<p>åœ¨å¾ˆå¤šæ–¹é¢ï¼ŒSpring MVCï¼ˆå…¶å®ï¼Œæ•´ä¸ª Spring ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ä¹Ÿæœ‰â€œè¿˜æ²¡æœ‰ ç»“æŸï¼â€è¿™æ ·çš„æ„Ÿè§‰ã€‚å°±åœ¨æˆ‘ä»¬è§‰å¾—å·²ç»æŒæ¡äº† Spring MVC èƒ½å¤Ÿåšä»€ä¹ˆä¹‹åï¼Œæˆ‘ä»¬ä¼šå‘ç°å®ƒæ‰€èƒ½åšçš„è¿˜ä¸æ­¢å¦‚æ­¤ã€‚</p>
<p>åœ¨ç¬¬ 5 ç« ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº† Spring MVC çš„åŸºç¡€çŸ¥è¯†ï¼Œä»¥åŠå¦‚ä½•ç¼–å†™æ§åˆ¶å™¨æ¥å¤„ç†å„ç§è¯·æ±‚ã€‚åŸºäºè¿™äº›çŸ¥è¯†ï¼Œæˆ‘ä»¬åœ¨ç¬¬ 6 ç« å­¦ä¹ äº†å¦‚ä½•åˆ›å»º JSP å’Œ Thymeleaf è§†å›¾ï¼Œè¿™äº›è§†å›¾ä¼šå°†æ¨¡å‹æ•°æ®å±•ç°ç»™ç”¨æˆ·ã€‚ä½ å¯èƒ½è®¤ä¸ºæˆ‘ä»¬å·²ç»æŒæ¡äº† Spring MVC çš„å…¨éƒ¨çŸ¥è¯†ã€‚ä½†æ˜¯ç¨ç­‰ï¼è¿˜æ²¡æœ‰ç»“æŸï¼</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šç»§ç»­ Spring MVC çš„è¯é¢˜ï¼Œæœ¬ç« æ‰€ä»‹ç»çš„ç‰¹æ€§å·²ç»è¶…å‡ºäº†ç¬¬ 5 ç« å’Œç¬¬ 6 ç« åŸºç¡€çŸ¥è¯†çš„èŒƒç•´ã€‚æˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•ç¼–å†™æ§åˆ¶å™¨æ¥å¤„ç†æ–‡ä»¶ä¸Šä¼ ã€å¦‚ä½•å¤„ç†æ§åˆ¶å™¨æ‰€æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä»¥åŠå¦‚ä½•åœ¨æ¨¡å‹ä¸­ä¼ é€’æ•°æ®ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨é‡å®šå‘ï¼ˆredirectï¼‰ä¹‹åä¾ç„¶å­˜æ´»ã€‚</p>
<p>ä½†é¦–å…ˆï¼Œæˆ‘è¦å…‘ç°ä¸€ä¸ªæ‰¿è¯ºã€‚åœ¨ç¬¬ 5 ç« ä¸­ï¼Œæˆ‘å¿«é€Ÿå±•ç°äº†å¦‚ä½•é€šè¿‡ <code>AbstractAnnotationConfigDispatcherServletInitializer</code> æ­å»º Spring MVCï¼Œå½“æ—¶æˆ‘æ‰¿è¯ºä¼šä¸ºè¯»è€…å±•ç°å…¶ä»–çš„é…ç½®æ–¹æ¡ˆã€‚æ‰€ä»¥ï¼Œåœ¨ä»‹ç»æ–‡ä»¶ä¸Šä¼ å’Œå¼‚å¸¸å¤„ç†ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆèŠ±ä¸€ç‚¹æ—¶é—´æ¢è®¨ä¸€ä¸‹å¦‚ä½•ç”¨å…¶ä»–çš„æ–¹å¼æ¥æ­å»º <code>DispatcherServlet</code> å’Œ  <code>ContextLoaderListener</code>ã€‚</p>
<h3 id="Spring-MVC-é…ç½®çš„æ›¿ä»£æ–¹æ¡ˆ"><a href="#Spring-MVC-é…ç½®çš„æ›¿ä»£æ–¹æ¡ˆ" class="headerlink" title="Spring MVC  é…ç½®çš„æ›¿ä»£æ–¹æ¡ˆ"></a>Spring MVC  é…ç½®çš„æ›¿ä»£æ–¹æ¡ˆ</h3><p>åœ¨ç¬¬ 5 ç« ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æ‰©å±• <code>AbstractAnnotationConfigDispatcherServletInitializer</code> å¿«é€Ÿæ­å»ºäº† Spring MVC ç¯å¢ƒã€‚åœ¨è¿™ä¸ªä¾¿åˆ©çš„åŸºç¡€ç±»ä¸­ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦åŸºæœ¬çš„ <code>DispatcherServlet</code> å’Œ <code>ContextLoaderListener</code> ç¯å¢ƒï¼Œå¹¶ä¸” Spring é…ç½®æ˜¯ä½¿ç”¨ Java çš„ï¼Œè€Œä¸æ˜¯ XMLã€‚</p>
<p>å°½ç®¡å¯¹å¾ˆå¤š Spring åº”ç”¨æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ç§å®‰å…¨çš„å‡è®¾ï¼Œä½†æ˜¯å¹¶ä¸ä¸€å®šæ€»èƒ½æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ã€‚é™¤äº† <code>DispatcherServlet</code> ä»¥å¤–ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦é¢å¤–çš„ <code>Servlet</code> å’Œ <code>Filter</code>ï¼›æˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦å¯¹ <code>DispatcherServlet</code> æœ¬èº«åšä¸€äº›é¢å¤–çš„é…ç½®ï¼›æˆ–è€…ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å°†åº”ç”¨éƒ¨ç½²åˆ° Servlet 3.0 ä¹‹å‰çš„å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆè¿˜éœ€è¦å°† <code>DispatcherServlet</code> é…ç½®åˆ°ä¼ ç»Ÿçš„ <code>web.xml</code> ä¸­ã€‚</p>
<h4 id="è‡ªå®šä¹‰-DispatcherServlet-é…ç½®"><a href="#è‡ªå®šä¹‰-DispatcherServlet-é…ç½®" class="headerlink" title="è‡ªå®šä¹‰ DispatcherServlet é…ç½®"></a>è‡ªå®šä¹‰ DispatcherServlet é…ç½®</h4><p>è™½ç„¶ä»ç¨‹åºæ¸…å• 7.1 çš„å¤–è§‚ä¸Šä¸ä¸€å®šèƒ½å¤Ÿçœ‹å¾—å‡ºæ¥ï¼Œä½†æ˜¯ <code>AbstractAnnotationConfigDispatcherServletInitializer</code> æ‰€å®Œæˆçš„äº‹æƒ…å…¶å®æ¯”çœ‹ä¸Šå»è¦å¤šã€‚åœ¨ <code>SpittrWebAppInitializer</code> ä¸­æˆ‘ä»¬æ‰€ç¼–å†™çš„ä¸‰ä¸ªæ–¹æ³•ä»…ä»…æ˜¯å¿…é¡»è¦é‡è½½çš„ abstract æ–¹æ³•ã€‚ä½†å®é™…ä¸Šè¿˜æœ‰æ›´å¤šçš„æ–¹æ³•å¯ä»¥è¿›è¡Œé‡è½½ï¼Œä»è€Œå®ç°é¢å¤–çš„é…ç½®ã€‚</p>
<p>æ­¤ç±»çš„æ–¹æ³•ä¹‹ä¸€å°±æ˜¯ <code>customizeRegistration()</code>ã€‚åœ¨ <code>AbstractAnnotationConfigDispatcherServletInitializer</code> å°† <code>DispatcherServlet</code> æ³¨å†Œåˆ° Servlet å®¹å™¨ä¸­ä¹‹åï¼Œå°±ä¼šè°ƒç”¨ <code>customizeRegistration()</code>ï¼Œå¹¶å°† Servlet æ³¨å†Œåå¾—åˆ°çš„ <code>Registration.Dynamic</code> ä¼ é€’è¿›æ¥ã€‚é€šè¿‡é‡è½½ <code>customizeRegistration()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ <code>DispatcherServlet</code> è¿›è¡Œé¢å¤–çš„é…ç½®ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨æœ¬ç« ç¨åçš„å†…å®¹ä¸­ï¼ˆ7.2 èŠ‚ï¼‰ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•åœ¨ Spring MVC ä¸­å¤„ç† <code>multipart</code> è¯·æ±‚å’Œæ–‡ä»¶ä¸Šä¼ ã€‚å¦‚æœè®¡åˆ’ä½¿ç”¨ Servlet 3.0 å¯¹ <code>multipart</code> é…ç½®çš„æ”¯æŒï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨ <code>DispatcherServlet</code> çš„ registration æ¥å¯ç”¨ <code>multipart</code> è¯·æ±‚ã€‚æˆ‘ä»¬å¯ä»¥é‡è½½ <code>customizeRegistration()</code> æ–¹æ³•æ¥è®¾ç½® <code>MultipartConfigElement</code>ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">customizeRegistration</span><span class="params">(Dynamic registration)</span> </span>&#123;  registration.setMultipartConfig(    <span class="keyword">new</span> MultipartConfigElement(<span class="string">&quot;/tmp/spittr/uploads&quot;</span>);  );&#125;</span><br></pre></td></tr></table></figure>

<p>å€ŸåŠ© <code>customizeRegistration()</code> æ–¹æ³•ä¸­çš„ <code>ServletRegistration.Dynamic</code>ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå®Œæˆå¤šé¡¹ä»»åŠ¡ï¼ŒåŒ…æ‹¬é€šè¿‡è°ƒç”¨ <code>setLoadOnStartup()</code> è®¾ç½® <code>load-on-startup</code> ä¼˜å…ˆçº§ï¼Œé€šè¿‡ <code>setInitParameter()</code> è®¾ç½®åˆå§‹åŒ–å‚æ•°ï¼Œé€šè¿‡è°ƒç”¨ <code>setMultipartConfig()</code> é…ç½® Servlet 3.0 å¯¹ <code>multipart</code> çš„æ”¯æŒã€‚åœ¨å‰é¢çš„æ ·ä¾‹ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†å¯¹ <code>multipart</code> çš„æ”¯æŒï¼Œå°†ä¸Šä¼ æ–‡ä»¶çš„ä¸´æ—¶å­˜å‚¨ç›®å½•è®¾ç½®åœ¨ <code>/tmp/spittr/uploads</code> ä¸­ã€‚</p>
<h4 id="æ·»åŠ å…¶ä»–çš„-Servlet-å’Œ-Filter"><a href="#æ·»åŠ å…¶ä»–çš„-Servlet-å’Œ-Filter" class="headerlink" title="æ·»åŠ å…¶ä»–çš„ Servlet å’Œ Filter"></a>æ·»åŠ å…¶ä»–çš„ Servlet å’Œ Filter</h4><p>æŒ‰ç…§ <code>AbstractAnnotationConfigDispatcherServletInitializer</code> çš„å®šä¹‰ï¼Œå®ƒä¼šåˆ›å»º <code>DispatcherServlet</code> å’Œ <code>ContextLoaderListener</code>ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³æ³¨å†Œå…¶ä»–çš„ Servletã€ Filter æˆ– Listener çš„è¯ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>åŸºäº Java çš„åˆå§‹åŒ–å™¨ï¼ˆinitializerï¼‰çš„ä¸€ä¸ªå¥½å¤„å°±åœ¨äºæˆ‘ä»¬å¯ä»¥å®šä¹‰ä»»æ„æ•°é‡çš„åˆå§‹åŒ–å™¨ç±»ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å¾€ Web å®¹å™¨ä¸­æ³¨å†Œå…¶ä»–ç»„ä»¶çš„è¯ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªæ–°çš„åˆå§‹åŒ–å™¨å°±å¯ä»¥äº†ã€‚æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å®ç° Spring çš„ <code>WebApplicationInitializer</code> æ¥å£ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¦‚ä½•åˆ›å»º WebApplicationInitializer å®ç°å¹¶æ³¨å†Œä¸€ä¸ª Servletã€‚</p>
<center>ç¨‹åºæ¸…å•7.1ã€€é€šè¿‡å®ç° `WebApplicationInitializer` æ¥æ³¨å†Œ Servlet</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myapp.config;<span class="keyword">import</span> javax.servlet.ServletContext;<span class="keyword">import</span> javax.servlet.ServletException;<span class="keyword">import</span> javax.servlet.ServletRegistration.Dynamic;<span class="keyword">import</span> org.springframework.web.WebApplicationInitializer;<span class="keyword">import</span> com.myapp.MyServlet;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServletInitializer</span> <span class="keyword">extends</span> <span class="title">WebApplicationInitializer</span> </span>&#123;    <span class="meta">@Override</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartup</span><span class="params">(ServletContext servletContext)</span> <span class="keyword">throws</span> ServletException </span>&#123;    Dynamic myServlet = servlectContext.addServlet(<span class="string">&quot;myServlet&quot;</span>, MyServlet.class);        myServlect.addMapping(<span class="string">&quot;/custom/**&quot;</span>);  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºæ¸…å• 7.1 æ˜¯ç›¸å½“åŸºç¡€çš„ Servlet æ³¨å†Œåˆå§‹åŒ–å™¨ç±»ã€‚å®ƒæ³¨å†Œäº†ä¸€ä¸ª Servlet å¹¶å°†å…¶æ˜ å°„åˆ°ä¸€ä¸ªè·¯å¾„ä¸Šã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥æ‰‹åŠ¨æ³¨å†Œ DispatcherServletã€‚ï¼ˆä½†è¿™å¹¶æ²¡æœ‰å¿…è¦ï¼Œå› ä¸º <code>AbstractAnnotationConfigDispatcherServletInitializer</code> æ²¡ç”¨å¤ªå¤šä»£ç å°±å°†è¿™é¡¹ä»»åŠ¡å®Œæˆå¾—å¾ˆæ¼‚äº®ã€‚ï¼‰</p>
<p>ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ›å»ºæ–°çš„ <code>WebApplicationInitializer</code> å®ç°æ¥æ³¨å†Œ Listener å’Œ Filterã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¦‚ä½•æ³¨å†Œ Filterã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overridepublic</span> <span class="function"><span class="keyword">void</span> <span class="title">onStartup</span><span class="params">(ServlectContext servletContext)</span> <span class="keyword">throws</span> ServletException </span>&#123;  javax.servlet.FilterRegistration.Dynamic filter = servletContext.addFilter(<span class="string">&quot;myFilter&quot;</span>, MyFilter.class);    filter.addMappingForUrlPatterns(<span class="keyword">null</span>, <span class="keyword">false</span>, <span class="string">&quot;/custom/**&quot;</span>);&#125; </span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦å°†åº”ç”¨éƒ¨ç½²åˆ°æ”¯æŒ Servlet 3.0 çš„å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆ <code>WebApplicationInitializer</code> æä¾›äº†ä¸€ç§é€šç”¨çš„æ–¹å¼ï¼Œå®ç°åœ¨ Java ä¸­æ³¨å†Œ Servletã€Filter å’Œ Listenerã€‚ä¸è¿‡ï¼Œå¦‚æœä½ åªæ˜¯æ³¨å†Œ Filterï¼Œ å¹¶ä¸”è¯¥ Filter åªä¼šæ˜ å°„åˆ° DispatcherServlet ä¸Šçš„è¯ï¼Œé‚£ä¹ˆåœ¨ <code>AbstractAnnotationConfigDispatcherServletInitializer</code> ä¸­è¿˜æœ‰ä¸€ç§å¿«æ·æ–¹å¼ã€‚</p>
<p>ä¸ºäº†æ³¨å†Œ Filter å¹¶å°†å…¶æ˜ å°„åˆ° <code>DispatcherServlet</code>ï¼Œæ‰€éœ€è¦åšçš„ä»…ä»…æ˜¯é‡è½½ <code>AbstractAnnotationConfigDispatcherServletInitializer</code> çš„ <code>getServletFilters()</code> æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œåœ¨å¦‚ä¸‹çš„ä»£ç ä¸­ï¼Œé‡è½½äº† <code>AbstractAnnotationConfigDispatcherServletInitializer</code> çš„ <code>getServletFilters()</code> æ–¹æ³•ä»¥æ³¨å†Œ Filterï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> Filter() getServletFilters() &#123;  <span class="keyword">return</span> <span class="keyword">new</span> Filter[] &#123; <span class="keyword">new</span> MyFilter() &#125;;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦å°†åº”ç”¨éƒ¨ç½²åˆ° Servlet 3.0 å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆ Spring æä¾›äº†å¤šç§æ–¹å¼æ¥æ³¨å†Œ Servletï¼ˆåŒ…æ‹¬ DispatcherServletï¼‰ã€Filter å’Œ Listenerï¼Œè€Œä¸å¿…åˆ›å»º web.xml æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä¸æƒ³é‡‡å–ä»¥ä¸Šæ‰€è¿°æ–¹æ¡ˆçš„è¯ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚å‡è®¾ä½ éœ€è¦å°†åº”ç”¨éƒ¨ç½²åˆ°ä¸æ”¯æŒ Servlet 3.0 çš„å®¹å™¨ä¸­ï¼ˆæˆ–è€…ä½ åªæ˜¯å¸Œæœ›ä½¿ç”¨ web.xml æ–‡ä»¶ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®Œå…¨å¯ä»¥æŒ‰ç…§ä¼ ç»Ÿçš„æ–¹å¼ï¼Œé€šè¿‡ web.xml é…ç½® Spring MVCã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¯¥æ€ä¹ˆåšã€‚</p>
<h4 id="åœ¨-web-xml-ä¸­å£°æ˜-DispatcherServlet"><a href="#åœ¨-web-xml-ä¸­å£°æ˜-DispatcherServlet" class="headerlink" title="åœ¨ web.xml ä¸­å£°æ˜ DispatcherServlet"></a>åœ¨ web.xml ä¸­å£°æ˜ DispatcherServlet</h4><p>åœ¨å…¸å‹çš„ Spring MVC åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¼šéœ€è¦ DispatcherServlet å’Œ ContextLoaderListenerã€‚<code>AbstractAnnotationConfigDispatcherServletInitializer</code> ä¼šè‡ªåŠ¨æ³¨å†Œå®ƒä»¬ï¼Œä½†æ˜¯å¦‚æœéœ€è¦åœ¨ <code>web.xml</code> ä¸­æ³¨å†Œçš„è¯ï¼Œé‚£å°±éœ€è¦æˆ‘ä»¬è‡ªå·±æ¥å®Œæˆè¿™é¡¹ä»»åŠ¡äº†ã€‚ å¦‚ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ <code>web.xml</code> æ–‡ä»¶ï¼Œå®ƒæŒ‰ç…§ä¼ ç»Ÿçš„æ–¹å¼æ­å»ºäº† DispatcherServlet å’Œ ContextLoaderListenerã€‚</p>
<center>ç¨‹åºæ¸…å• 7.3ã€€åœ¨ web.xml ä¸­æ­å»º Spring MVC</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">version</span>=<span class="string">&quot;2.5&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee      http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span> &gt;</span>  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span>    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/spring/root-context.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span>    <span class="tag">&lt;<span class="name">listener</span>&gt;</span>    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>      org.springframework.web.context.ContextLoaderListener    <span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span>  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span>    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span>    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>appServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>      org.springframework.web.servlet.DispatcherServlet    <span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span>    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span>  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span>    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span>    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>appServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å°±åƒæˆ‘åœ¨ç¬¬ 5 ç« æ›¾ç»ä»‹ç»è¿‡çš„ï¼ŒContextLoaderListener å’Œ DispatcherServlet å„è‡ªéƒ½ä¼šåŠ è½½ä¸€ä¸ª Spring åº”ç”¨ä¸Šä¸‹æ–‡ã€‚ä¸Šä¸‹æ–‡å‚æ•° contextConfigLocation æŒ‡å®šäº†ä¸€ä¸ª XML æ–‡ä»¶çš„åœ°å€ï¼Œè¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†æ ¹åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œå®ƒä¼šè¢« ContextLoaderListener åŠ è½½ã€‚å¦‚ç¨‹åºæ¸…å• 7.3 æ‰€ç¤ºï¼Œæ ¹ä¸Šä¸‹æ–‡ä¼šä» <code>/WEB-INF/spring/root-context.xml</code> ä¸­åŠ è½½ bean å®šä¹‰ã€‚</p>
<p>DispatcherServlet ä¼šæ ¹æ® Servlet çš„åå­—æ‰¾åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶åŸºäºè¯¥æ–‡ä»¶åŠ è½½åº”ç”¨ä¸Šä¸‹æ–‡ã€‚åœ¨ç¨‹åºæ¸…å• 7.3 ä¸­ï¼ŒServlet çš„åå­—æ˜¯ <code>appServlet</code>ï¼Œå› æ­¤ DispatcherServlet ä¼šä» <code>/WEB-INF/appServlet-context.xml</code> æ–‡ä»¶ä¸­åŠ è½½å…¶åº”ç”¨ä¸Šä¸‹æ–‡ã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›æŒ‡å®š DispatcherServlet é…ç½®æ–‡ä»¶çš„ä½ç½®çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ Servlet ä¸ŠæŒ‡å®šä¸€ä¸ª contextConfigLocation åˆå§‹åŒ–å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„é…ç½®ä¸­ï¼ŒDispatcherServlet ä¼šä» <code>/WEB-INF/spring/appServlet/servlet-context.xml</code> åŠ è½½å®ƒçš„ beanï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span>  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>appServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>    org.springframework.web.servlet.DispatcherServlet  <span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span>  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span>    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>      /WEB-INF/spring/appServlet/servlet-context.xml    <span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>  <span class="tag">&lt;/<span class="name">init-parma</span>&gt;</span>  <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œä¸Šé¢é˜è¿°çš„éƒ½æ˜¯å¦‚ä½•è®© DispatcherServlet å’Œ ContextLoaderListener ä» XML ä¸­åŠ è½½å„è‡ªçš„åº”ç”¨ä¸Šä¸‹æ–‡ã€‚ä½†æ˜¯ï¼Œåœ¨æœ¬ä¹¦ä¸­çš„å¤§éƒ¨åˆ†å†…å®¹ä¸­ï¼Œæˆ‘ä»¬éƒ½æ›´å€¾å‘äºä½¿ç”¨ Java é…ç½®è€Œä¸æ˜¯ XML é…ç½®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è®© Spring MVC åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä»å¸¦æœ‰ @Configuration æ³¨è§£çš„ç±»ä¸ŠåŠ è½½é…ç½®ã€‚</p>
<p>è¦åœ¨ Spring MVC ä¸­ä½¿ç”¨åŸºäº Java çš„é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰ DispatcherServlet å’Œ ContextLoaderListener ä½¿ç”¨ AnnotationConfigWebApplicationContextï¼Œè¿™æ˜¯ä¸€ ä¸ª WebApplicationContext çš„å®ç°ç±»ï¼Œå®ƒä¼šåŠ è½½ Java é…ç½®ç±»ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ XMLã€‚è¦å®ç°è¿™ç§é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½® contextClass ä¸Šä¸‹æ–‡å‚æ•°ä»¥åŠ DispatcherServlet çš„åˆå§‹åŒ–å‚æ•°ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç° äº†ä¸€ä¸ªæ–°çš„ web.xmlï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œå®ƒæ‰€æ­å»ºçš„ Spring MVC ä½¿ç”¨åŸºäº Java çš„ Spring é…ç½®ï¼š</p>
<center>ç¨‹åºæ¸…å•7.4ã€€è®¾ç½® web.xml ä½¿ç”¨åŸºäºJavaçš„é…ç½®</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">version</span>=<span class="string">&quot;2.5&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee      http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span> &gt;</span>  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span>    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextClass<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>      org.springframework.web.context.support.AnnotationConfigWebApplicationContext    <span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span>    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span>    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>      com.habuma.spitter.config.RootConfig    <span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span>    <span class="tag">&lt;<span class="name">listener</span>&gt;</span>    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>      org.springframework.web.context.ContextLoaderListener    <span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span>  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span>    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span>    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>appServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>      org.springframework.web.servlet.DispatcherServlet    <span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span>    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span>      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextClass<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>        org.springframework.web.context.support.AnnotationConfigWebApplicationContext      <span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span>    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span>      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>        com.habuma.spitter.config.WebConfigConfig      <span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span>    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span>  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span>    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span>    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>appServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•ä»¥å¤šç§ä¸åŒçš„æ–¹å¼æ¥æ­å»º Spring MVCï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šçœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ Spring MVC æ¥å¤„ç†æ–‡ä»¶ä¸Šä¼ ã€‚</p>
<h3 id="å¤„ç†-multipart-å½¢å¼çš„æ•°æ®"><a href="#å¤„ç†-multipart-å½¢å¼çš„æ•°æ®" class="headerlink" title="å¤„ç† multipart å½¢å¼çš„æ•°æ®"></a>å¤„ç† multipart å½¢å¼çš„æ•°æ®</h3><p>åœ¨ Web åº”ç”¨ä¸­ï¼Œå…è®¸ç”¨æˆ·ä¸Šä¼ å†…å®¹æ˜¯å¾ˆå¸¸è§çš„éœ€æ±‚ã€‚åœ¨ Facebook å’Œ Flickr è¿™æ ·çš„ç½‘ç«™ä¸­ï¼Œç”¨æˆ·é€šå¸¸ä¼šä¸Šä¼ ç…§ç‰‡å’Œè§†é¢‘ï¼Œå¹¶ä¸å®¶äººå’Œæœ‹å‹åˆ†äº«ã€‚è¿˜æœ‰ä¸€äº›æœåŠ¡å…è®¸ç”¨æˆ·ä¸Šä¼ ç…§ç‰‡ï¼Œç„¶åæŒ‰ç…§ä¼ ç»Ÿæ–¹å¼å°†å…¶æ‰“å°åœ¨çº¸ä¸Šï¼Œæˆ–è€…ç”¨åœ¨ T æ¤è¡«å’Œå’–å•¡æ¯ä¸Šã€‚</p>
<p>Spittr åº”ç”¨åœ¨ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ–‡ä»¶ä¸Šä¼ ã€‚å½“æ–°ç”¨æˆ·æ³¨å†Œåº”ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›ä»–ä»¬èƒ½å¤Ÿä¸Šä¼ ä¸€å¼ å›¾ç‰‡ï¼Œä»è€Œä¸ä»–ä»¬çš„ä¸ªäººä¿¡æ¯ç›¸å…³è”ã€‚å½“ç”¨æˆ·æäº¤æ–°çš„ Spittle æ—¶ï¼Œé™¤äº†æ–‡æœ¬æ¶ˆæ¯ä»¥å¤–ï¼Œä»–ä»¬å¯èƒ½è¿˜ä¼šä¸Šä¼ ä¸€ å¼ ç…§ç‰‡ã€‚</p>
<p>ä¸€èˆ¬è¡¨å•æäº¤æ‰€å½¢æˆçš„è¯·æ±‚ç»“æœæ˜¯å¾ˆç®€å•çš„ï¼Œå°±æ˜¯ä»¥ <code>&amp;</code> ç¬¦åˆ†å‰²çš„å¤šä¸ª name-value å¯¹ã€‚ä¾‹å¦‚ï¼Œå½“åœ¨ Spittr åº”ç”¨ä¸­æäº¤æ³¨å†Œè¡¨å•æ—¶ï¼Œè¯·æ±‚ä¼šå¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firstName=Charless&amp;lastName=Xavier&amp;email=professor%<span class="number">40</span>xmen.org&amp;username=professorx&amp;password=letmein01</span><br></pre></td></tr></table></figure>

<p>å°½ç®¡è¿™ç§ç¼–ç å½¢å¼å¾ˆç®€å•ï¼Œå¹¶ä¸”å¯¹äºå…¸å‹çš„åŸºäºæ–‡æœ¬çš„è¡¨å•æäº¤ä¹Ÿè¶³å¤Ÿæ»¡è¶³è¦æ±‚ï¼Œä½†æ˜¯å¯¹äºä¼ é€äºŒè¿›åˆ¶æ•°æ®ï¼Œå¦‚ä¸Šä¼ å›¾ç‰‡ï¼Œå°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒäº†ã€‚ä¸ä¹‹ä¸åŒçš„æ˜¯ï¼Œmultipart æ ¼å¼çš„æ•°æ®ä¼šå°†ä¸€ä¸ªè¡¨å•æ‹†åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼ˆpartï¼‰ï¼Œæ¯ä¸ªéƒ¨åˆ†å¯¹åº”ä¸€ä¸ªè¾“å…¥åŸŸã€‚åœ¨ä¸€èˆ¬çš„è¡¨å•è¾“å…¥åŸŸä¸­ï¼Œå®ƒæ‰€å¯¹åº”çš„éƒ¨åˆ†ä¸­ä¼šæ”¾ç½®æ–‡æœ¬å‹æ•°æ®ï¼Œä½†æ˜¯å¦‚æœä¸Šä¼ æ–‡ä»¶çš„è¯ï¼Œå®ƒæ‰€å¯¹åº”çš„éƒ¨åˆ†å¯ä»¥æ˜¯äºŒè¿›åˆ¶ï¼Œä¸‹é¢å±•ç°äº† multipart çš„è¯·æ±‚ä½“ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-----------WebKitFormBoundaryqgkaBn8lHJCuNmiWContent-Disposition: form-data; name=<span class="string">&quot;firstName&quot;</span>Charles-----------WebKitFormBoundaryqgkaBn8lHJCuNmiWContent-Disposition: form-data; name=<span class="string">&quot;lastName&quot;</span>Xavier-----------WebKitFormBoundaryqgkaBn8lHJCuNmiWContent-Disposition: form-data; name=<span class="string">&quot;email&quot;</span>charles@xmen.com-----------WebKitFormBoundaryqgkaBn8lHJCuNmiW<span class="string">&quot;Content-Disposition: form-data; name=&quot;</span>username<span class="string">&quot;professorx-----------WebKitFormBoundaryqgkaBn8lHJCuNmiWContent-Disposition: form-data; name=&quot;</span>password<span class="string">&quot;letmeinO1-----------WebKitFormBoundaryqgkaBn8lHJCuNmiWContent-Disposition: form-data; name=&quot;</span>profilePicture<span class="string">&quot;; filename=&quot;</span>me.jpg<span class="string">&quot;Content-Type: image/jpeg  [[ Binary image data goes here ]]-----------WebKitFormBoundaryqgkaBn8lHJCuNmiW--</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ª multipart çš„è¯·æ±‚ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° profilePicture éƒ¨åˆ†ä¸å…¶ä»–éƒ¨åˆ†æ˜æ˜¾ä¸åŒã€‚é™¤äº†å…¶ä»–å†…å®¹ä»¥å¤–ï¼Œå®ƒè¿˜æœ‰è‡ªå·±çš„ Content-Type å¤´ï¼Œè¡¨æ˜å®ƒæ˜¯ä¸€ä¸ª JPEG å›¾ç‰‡ã€‚å°½ç®¡ä¸ä¸€å®šé‚£ä¹ˆæ˜æ˜¾ï¼Œä½† profilePicture éƒ¨åˆ†çš„è¯·æ±‚ä½“æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œè€Œä¸æ˜¯ç®€å•çš„æ–‡æœ¬ã€‚</p>
<p>å°½ç®¡ multipart è¯·æ±‚çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†åœ¨ Spring MVC ä¸­å¤„ç†å®ƒä»¬å´å¾ˆå®¹æ˜“ã€‚åœ¨ç¼–å†™æ§åˆ¶å™¨æ–¹æ³•å¤„ç†æ–‡ä»¶ä¸Šä¼ ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»è¦é…ç½®ä¸€ä¸ª multipart è§£æå™¨ï¼Œé€šè¿‡å®ƒæ¥å‘Šè¯‰ DispatcherServlet è¯¥å¦‚ä½•è¯»å– multipart è¯·æ±‚ã€‚</p>
<h4 id="é…ç½®-multipart-è§£æå™¨"><a href="#é…ç½®-multipart-è§£æå™¨" class="headerlink" title="é…ç½® multipart è§£æå™¨"></a>é…ç½® multipart è§£æå™¨</h4><p>DispatcherServlet å¹¶æ²¡æœ‰å®ç°ä»»ä½•è§£æ multipart è¯·æ±‚æ•°æ®çš„åŠŸèƒ½ã€‚å®ƒå°†è¯¥ä»»åŠ¡å§”æ‰˜ç»™äº† Spring ä¸­ MultipartResolver ç­–ç•¥æ¥å£çš„å®ç°ï¼Œé€šè¿‡è¿™ä¸ªå®ç°ç±»æ¥è§£æ multipart è¯·æ±‚ä¸­çš„å†…å®¹ã€‚ä» Spring 3.1 å¼€ å§‹ï¼ŒSpring å†…ç½®äº†ä¸¤ä¸ª MultipartResolver çš„å®ç°ä¾›æˆ‘ä»¬é€‰æ‹©ï¼š</p>
<ul>
<li><code>CommonsMultipartResolver</code>ï¼šä½¿ç”¨ Jakarta Commons FileUpload è§£æ multipart è¯·æ±‚ï¼›</li>
<li><code>StandardServletMultipartResolver</code>ï¼šä¾èµ–äº Servlet 3.0 å¯¹ multipart è¯·æ±‚çš„æ”¯æŒï¼ˆå§‹äº Spring 3.1ï¼‰ã€‚</li>
</ul>
<p>ä¸€èˆ¬æ¥è®²ï¼Œåœ¨è¿™ä¸¤è€…ä¹‹ é—´ï¼ŒStandardServletMultipartResolver å¯èƒ½ä¼šæ˜¯ä¼˜é€‰çš„æ–¹æ¡ˆã€‚å®ƒä½¿ç”¨ Servlet æ‰€æä¾›çš„åŠŸèƒ½æ”¯æŒï¼Œå¹¶ä¸éœ€è¦ä¾èµ–ä»»ä½•å…¶ä»–çš„é¡¹ç›®ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦å°†åº”ç”¨éƒ¨ç½²åˆ° Servlet 3.0 ä¹‹å‰çš„å®¹å™¨ä¸­ï¼Œæˆ–è€…è¿˜æ²¡æœ‰ä½¿ç”¨ Spring 3.1 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå¯èƒ½å°±éœ€è¦ CommonsMultipartResolver äº†ã€‚</p>
<p>ä½¿ç”¨ Servlet 3.0 è§£æ multipart è¯·æ±‚</p>
<p>å…¼å®¹ Servlet 3.0 çš„ StandardServletMultipartResolver æ²¡æœ‰æ„é€ å™¨å‚æ•°ï¼Œä¹Ÿæ²¡æœ‰è¦è®¾ç½®çš„å±æ€§ã€‚è¿™æ ·ï¼Œåœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œå°†å…¶å£°æ˜ä¸º bean å°±ä¼šéå¸¸ç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MultipartResolver <span class="title">multipartResolver</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;  <span class="keyword">return</span> <span class="keyword">new</span> StandardServletMultipartResolver();&#125;</span><br></pre></td></tr></table></figure>

<p>æ—¢ç„¶è¿™ä¸ª @Bean æ–¹æ³•å¦‚æ­¤ç®€å•ï¼Œä½ å¯èƒ½å°±ä¼šæ€€ç–‘æˆ‘ä»¬åˆ°åº•è¯¥å¦‚ä½•é™åˆ¶ <code>StandardServletMultipartResolver</code> çš„å·¥ä½œæ–¹å¼å‘¢ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦é™åˆ¶ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„å¤§å°ï¼Œè¯¥æ€ä¹ˆå®ç°ï¼Ÿå¦‚æœæˆ‘ä»¬æƒ³è¦æŒ‡å®šæ–‡ä»¶åœ¨ä¸Šä¼ æ—¶ï¼Œä¸´æ—¶å†™å…¥ç›®å½•åœ¨ä»€ä¹ˆä½ç½®çš„è¯ï¼Œè¯¥å¦‚ä½•å®ç°ï¼Ÿå› ä¸ºæ²¡æœ‰å±æ€§å’Œæ„é€ å™¨å‚æ•°ï¼Œ<code>StandardServletMultipartResolver</code> çš„åŠŸèƒ½çœ‹èµ·æ¥ä¼¼ä¹æœ‰äº›å—é™ã€‚</p>
<p>å…¶å®å¹¶ä¸æ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬æ˜¯æœ‰åŠæ³•é…ç½® <code>StandardServletMultipartResolver</code> çš„é™åˆ¶æ¡ä»¶çš„ã€‚åªä¸è¿‡ä¸æ˜¯åœ¨ Spring ä¸­é…ç½® <code>StandardServletMultipartResolver</code>ï¼Œ è€Œæ˜¯è¦åœ¨ Servlet ä¸­æŒ‡å®š multipart çš„é…ç½®ã€‚è‡³å°‘ï¼Œæˆ‘ä»¬å¿…é¡»è¦æŒ‡å®šåœ¨æ–‡ä»¶ä¸Šä¼ çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€å†™å…¥çš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„ã€‚å¦‚æœä¸è®¾å®šè¿™ä¸ªæœ€åŸºæœ¬é…ç½®çš„è¯ï¼Œ<code>StandardServletMultipartResolver</code> å°±æ— æ³•æ­£å¸¸å·¥ä½œã€‚å…·ä½“æ¥è®²ï¼Œæˆ‘ä»¬å¿…é¡»è¦åœ¨ <code>web.xml</code> æˆ– Servlet åˆå§‹åŒ–ç±»ä¸­ï¼Œå°† multipart çš„å…·ä½“ç»†èŠ‚ä½œä¸º <code>DispatcherServlet</code> é…ç½®çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬é‡‡ç”¨ Servlet åˆå§‹åŒ–ç±»çš„æ–¹å¼æ¥é…ç½® DispatcherServlet çš„è¯ï¼Œè¿™ä¸ªåˆå§‹åŒ–ç±»åº”è¯¥å·²ç»å®ç°äº† <code>WebApplicationInitializer</code>ï¼Œé‚£æˆ‘ä»¬å¯ä»¥åœ¨ Servlet registration ä¸Šè°ƒç”¨ <code>setMultipartConfig()</code> æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ª <code>MultipartConfigElement</code> å®ä¾‹ã€‚å¦‚ä¸‹æ˜¯æœ€åŸºæœ¬çš„ DispatcherServlet multipart é…ç½®ï¼Œå®ƒå°†ä¸´æ—¶è·¯å¾„è®¾ç½®ä¸º <code>/tmp/spittr/uploads</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DispatcherServlet ds = <span class="keyword">new</span> DispatchServlet();Dynamic registration = context.addServlet(<span class="string">&quot;appServlet&quot;</span>, ds);registration.addMapping(<span class="string">&quot;/&quot;</span>);registration.setMultipartConfig(<span class="keyword">new</span> MultipartConfigElement(<span class="string">&quot;/tmp/spittr/uploads&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬é…ç½® DispatcherServlet çš„ Servlet åˆå§‹åŒ–ç±»ç»§æ‰¿äº† <code>AbstractAnnotationConfigDispatcherServletInitializer</code> æˆ– <code>AbstractDispatcherServletInitializer</code> çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸ä¼šç›´æ¥åˆ›å»º DispatcherServlet  å®ä¾‹å¹¶å°†å…¶æ³¨å†Œåˆ° Servlet ä¸Šä¸‹æ–‡ä¸­ã€‚è¿™æ ·çš„è¯ï¼Œå°†ä¸ä¼šæœ‰å¯¹ Dynamic Servlet registration çš„å¼•ç”¨ä¾›æˆ‘ä»¬ä½¿ç”¨äº†ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡è½½ <code>customizeRegistration()</code> æ–¹æ³•ï¼ˆå®ƒä¼šå¾—åˆ°ä¸€ä¸ª Dynamic ä½œä¸ºå‚æ•°ï¼‰æ¥é…ç½® multipart çš„å…·ä½“ç»†èŠ‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">customizeRegistration</span><span class="params">(Dynamic registration)</span> </span>&#123;  registration.setMultipartConfig(    <span class="keyword">new</span> MultipartConfigElement(<span class="string">&quot;/tmp/spittr/uploads&quot;</span>);  );&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰€ä½¿ç”¨æ˜¯åªæœ‰ä¸€ä¸ªå‚æ•°çš„ MultipartConfigElement æ„é€ å™¨ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šçš„æ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªç»å¯¹ç›®å½•ï¼Œä¸Šä¼ æ–‡ä»¶å°†ä¼šä¸´æ—¶å†™å…¥è¯¥ç›®å½•ä¸­ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å…¶ä»–çš„æ„é€ å™¨æ¥é™åˆ¶ä¸Šä¼ æ–‡ä»¶çš„å¤§å°ã€‚é™¤äº†ä¸´æ—¶è·¯å¾„çš„ä½ ç½®ï¼Œå…¶ä»–çš„æ„é€ å™¨æ‰€èƒ½æ¥å—çš„å‚æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸Šä¼ æ–‡ä»¶çš„æœ€å¤§å®¹é‡ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚é»˜è®¤æ˜¯æ²¡æœ‰é™åˆ¶çš„ã€‚</li>
<li>æ•´ä¸ª multipart è¯·æ±‚çš„æœ€å¤§å®¹é‡ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œä¸ä¼šå…³å¿ƒæœ‰å¤šå°‘ä¸ª part ä»¥åŠæ¯ä¸ª part çš„å¤§å°ã€‚é»˜è®¤æ˜¯æ²¡æœ‰é™åˆ¶çš„ã€‚</li>
<li>åœ¨ä¸Šä¼ çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ–‡ä»¶å¤§å°è¾¾åˆ°äº†ä¸€ä¸ªæŒ‡å®šæœ€å¤§å®¹é‡ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œå°†ä¼šå†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶è·¯å¾„ä¸­ã€‚é»˜è®¤å€¼ä¸º 0ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰ä¸Šä¼ çš„æ–‡ä»¶éƒ½ä¼šå†™å…¥åˆ°ç£ç›˜ä¸Šã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³é™åˆ¶æ–‡ä»¶çš„å¤§å°ä¸è¶…è¿‡ 2MBï¼Œæ•´ä¸ªè¯·æ±‚ä¸è¶…è¿‡ 4MBï¼Œè€Œä¸”æ‰€æœ‰çš„æ–‡ä»¶éƒ½è¦å†™åˆ°ç£ç›˜ä¸­ã€‚ä¸‹é¢çš„ä»£ç ä½¿ç”¨ MultipartConfigElement è®¾ç½®äº†è¿™äº›ä¸´ç•Œå€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">customizeRegistration</span><span class="params">(Dynamic registration)</span> </span>&#123;  registration.setMultipartConfig(    <span class="keyword">new</span> MultipartConfigElement(<span class="string">&quot;/tmp/spittr/uploads&quot;</span>,      <span class="number">2097152</span>, <span class="number">4194304</span>, <span class="number">0</span>);  );&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ›´ä¸ºä¼ ç»Ÿçš„ web.xml æ¥é…ç½® <code>MultipartConfigElement</code> çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>&lt;servlet&gt;</code> ä¸­çš„ <code>&lt;multipart-config&gt;</code> å…ƒç´ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span>  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>appServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>    org.springframework.web.servlet.DispatchServlet  <span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span>  <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span>  <span class="tag">&lt;<span class="name">multipart-config</span>&gt;</span>    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/tmp/spittr/upload<span class="tag">&lt;/<span class="name">location</span>&gt;</span>    <span class="tag">&lt;<span class="name">max-file-size</span>&gt;</span>2097152<span class="tag">&lt;/<span class="name">max-file-size</span>&gt;</span>    <span class="tag">&lt;<span class="name">max-request-size</span>&gt;</span>4194304<span class="tag">&lt;/<span class="name">max-request-size</span>&gt;</span>  <span class="tag">&lt;/<span class="name">multipart-config</span>&gt;</span><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;multipart-config&gt;</code> çš„é»˜è®¤å€¼ä¸ <code>MultipartConfigElement</code> ç›¸åŒã€‚ä¸ <code>MultipartConfigElement</code> ä¸€æ ·ï¼Œå¿…é¡»è¦é…ç½®çš„æ˜¯ <code>&lt;location&gt;</code>ã€‚</p>
<p><strong>é…ç½® Jakarta Commons FileUpload multipart è§£æå™¨</strong></p>
<p>é€šå¸¸æ¥è®²ï¼Œ<code>StandardServletMultipartResolver</code> ä¼šæ˜¯æœ€ä½³çš„é€‰æ‹©ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦å°†åº”ç”¨éƒ¨ç½²åˆ°é Servlet 3.0 çš„å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆå°±å¾—éœ€è¦æ›¿ä»£çš„æ–¹æ¡ˆã€‚å¦‚æœå–œæ¬¢çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™è‡ªå·±çš„ <code>MultipartResolver</code> å®ç°ã€‚ä¸è¿‡ï¼Œé™¤éæƒ³è¦åœ¨å¤„ç† multipart è¯·æ±‚çš„æ—¶å€™æ‰§è¡Œç‰¹å®šçš„é€»è¾‘ï¼Œå¦åˆ™çš„è¯ï¼Œæ²¡æœ‰å¿…è¦è¿™æ ·åšã€‚Spring å†…ç½®äº† <code>CommonsMultipartResolver</code>ï¼Œå¯ä»¥ä½œä¸º <code>StandardServletMultipartResolver</code> çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p>
<p>å°† <code>CommonsMultipartResolver</code> å£°æ˜ä¸º Spring bean çš„æœ€ç®€å•æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MultipartResolver <span class="title">multipartResolver</span><span class="params">()</span> </span>&#123;  <span class="keyword">return</span> <span class="keyword">new</span> MultipartResolver();&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ <code>StandardServletMultipartResolver</code> æœ‰æ‰€ä¸åŒï¼Œ<code>CommonsMultipartResolver</code> ä¸ä¼šå¼ºåˆ¶è¦æ±‚è®¾ç½®ä¸´æ—¶æ–‡ä»¶è·¯å¾„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè·¯å¾„å°±æ˜¯ Servlet å®¹å™¨çš„ä¸´æ—¶ç›®å½•ã€‚ä¸è¿‡ï¼Œé€šè¿‡è®¾ç½® <code>uploadTempDir</code> å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æŒ‡å®šä¸ºä¸€ä¸ªä¸åŒçš„ä½ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MultipartResolver <span class="title">multipartResolver</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;  CommonsMultipartResolver multipartResolver = <span class="keyword">new</span> CommonsMultipartResolver();  multipartResolver.setUploadTempDir(    <span class="keyword">new</span> FileSystemResource(<span class="string">&quot;/tmp/spittr/uploads&quot;</span>);  );  <span class="keyword">return</span> multipartResolver;&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ç›¸åŒçš„æ–¹å¼æŒ‡å®šå…¶ä»–çš„ multipart ä¸Šä¼ ç»†èŠ‚ï¼Œä¹Ÿå°±æ˜¯è®¾ç½® <code>CommonsMultipartResolver</code> çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„é…ç½®å°±ç­‰ä»·äºæˆ‘ä»¬åœ¨å‰æ–‡é€šè¿‡ <code>MultipartConfigElement</code> æ‰€é…ç½®çš„ <code>StandardServletMultipartResolver</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MultipartResolver <span class="title">multipartResolver</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;  CommonsMultipartResolver multipartResolver = <span class="keyword">new</span> CommonsMultipartResolver();  multipartResolver.setUploadTempDir(    <span class="keyword">new</span> FileSystemResource(<span class="string">&quot;/tmp/spittr/uploads&quot;</span>));  multipartResolver.setMaxUploadSize(<span class="number">2097152</span>);  multipartResolver.setMaxInMemorySize(<span class="number">0</span>);  <span class="keyword">return</span> multipartResolver;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†æœ€å¤§çš„æ–‡ä»¶å®¹é‡è®¾ç½®ä¸º 2 MBï¼Œæœ€å¤§çš„å†…å­˜å¤§å°è®¾ç½®ä¸º 0 å­—èŠ‚ã€‚è¿™ä¸¤ä¸ªå±æ€§ç›´æ¥å¯¹åº”äº <code>MultipartConfigElement</code> çš„ç¬¬äºŒä¸ªå’Œç¬¬å››ä¸ªæ„é€ å™¨å‚æ•°ï¼Œè¡¨æ˜ä¸èƒ½ä¸Šä¼ è¶…è¿‡ 2 MB çš„æ–‡ä»¶ï¼Œå¹¶ä¸”ä¸ç®¡æ–‡ä»¶çš„å¤§å°å¦‚ä½•ï¼Œæ‰€æœ‰çš„æ–‡ä»¶éƒ½ä¼šå†™åˆ°ç£ç›˜ä¸­ã€‚ä½†æ˜¯ä¸ <code>MultipartConfigElement</code> æœ‰æ‰€ä¸åŒï¼Œæˆ‘ä»¬æ— æ³•è®¾å®š multipart è¯·æ±‚æ•´ä½“çš„æœ€å¤§å®¹é‡ã€‚</p>
<h4 id="å¤„ç†-multipart-è¯·æ±‚"><a href="#å¤„ç†-multipart-è¯·æ±‚" class="headerlink" title="å¤„ç† multipart è¯·æ±‚"></a>å¤„ç† multipart è¯·æ±‚</h4><p>ç°åœ¨å·²ç»åœ¨ Spring ä¸­ï¼ˆæˆ– Servlet å®¹å™¨ä¸­ï¼‰é…ç½®å¥½äº†å¯¹ <code>mutipart</code> è¯·æ±‚çš„å¤„ç†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥ç¼–å†™æ§åˆ¶å™¨æ–¹æ³•æ¥æ¥æ”¶ä¸Šä¼ çš„æ–‡ä»¶ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæœ€å¸¸è§çš„æ–¹å¼å°±æ˜¯åœ¨æŸä¸ªæ§åˆ¶å™¨æ–¹æ³•å‚æ•°ä¸Šæ·»åŠ  <code>@RequestPart</code> æ³¨è§£ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬å…è®¸ç”¨æˆ·åœ¨æ³¨å†Œ Spittr åº”ç”¨çš„æ—¶å€™ä¸Šä¼ ä¸€å¼ å›¾ç‰‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ä¿®æ”¹è¡¨å•ï¼Œä»¥å…è®¸ç”¨æˆ·é€‰æ‹©è¦ä¸Šä¼ çš„å›¾ç‰‡ï¼ŒåŒæ—¶è¿˜éœ€è¦ä¿®æ”¹ <code>SpitterController</code> ä¸­çš„ <code>processRegistration()</code> æ–¹æ³•æ¥æ¥æ”¶ä¸Šä¼ çš„å›¾ç‰‡ã€‚å¦‚ä¸‹çš„ä»£ç ç‰‡æ®µæ¥æºäº Thymeleaf æ³¨å†Œè¡¨å•è§†å›¾ï¼ˆ<code>registrationForm.html</code>ï¼‰ï¼Œç€é‡å¼ºè°ƒäº†è¡¨å•æ‰€éœ€çš„ä¿®æ”¹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;spitter&#125;&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span>    ...  <span class="tag">&lt;<span class="name">label</span>&gt;</span>Profile Picture<span class="tag">&lt;/<span class="name">label</span>&gt;</span>:  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;profilePicture&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/jpeg,image/png,image/gif&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>  ...  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;form&gt;</code> æ ‡ç­¾ç°åœ¨å°† <code>enctype</code> å±æ€§è®¾ç½®ä¸º <code>multipart/form-data</code>ï¼Œè¿™ä¼šå‘Šè¯‰æµè§ˆå™¨ä»¥ multipart æ•°æ®çš„å½¢å¼æäº¤è¡¨å•ï¼Œè€Œä¸æ˜¯ä»¥è¡¨å•æ•°æ®çš„å½¢å¼è¿›è¡Œæäº¤ã€‚åœ¨ multipart ä¸­ï¼Œæ¯ä¸ªè¾“å…¥åŸŸéƒ½ä¼šå¯¹åº”ä¸€ä¸ª partã€‚</p>
<p>é™¤äº†æ³¨å†Œè¡¨å•ä¸­å·²æœ‰çš„è¾“å…¥åŸŸï¼Œæˆ‘ä»¬è¿˜æ·»åŠ äº†ä¸€ä¸ªæ–°çš„åŸŸï¼Œå…¶ type ä¸º fileã€‚è¿™èƒ½å¤Ÿè®©ç”¨æˆ·é€‰æ‹©è¦ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶ã€‚accept å±æ€§ç”¨æ¥å°†æ–‡ä»¶ç±»å‹é™åˆ¶ä¸º JPEGã€PNG ä»¥åŠ GIF å›¾ç‰‡ã€‚æ ¹æ®å…¶ name å±æ€§ï¼Œå›¾ç‰‡æ•°æ®å°†ä¼šå‘é€åˆ° multipart è¯·æ±‚ä¸­çš„ <code>profilePicture</code> part ä¹‹ä¸­ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ <code>processRegistration()</code> æ–¹æ³•ï¼Œä½¿å…¶èƒ½å¤Ÿæ¥å—ä¸Šä¼ çš„å›¾ç‰‡ã€‚å…¶ä¸­ä¸€ç§æ–¹å¼æ˜¯æ·»åŠ  byte æ•°ç»„å‚æ•°ï¼Œå¹¶ä¸ºå…¶æ·»åŠ  <code>@RequestPart</code> æ³¨è§£ã€‚å¦‚ä¸‹ä¸ºç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/register&quot;, method=POST)</span><span class="function"><span class="keyword">public</span> String <span class="title">processRegistration</span><span class="params">(    <span class="meta">@RequestPart(&quot;profilePicture&quot;)</span> <span class="keyword">byte</span>[]  profilePicture,    <span class="meta">@Valid</span> Spittr spittr,    Errors errors)</span> </span>&#123;  ...&#125; </span><br></pre></td></tr></table></figure>

<p>å½“æ³¨å†Œè¡¨å•æäº¤çš„æ—¶å€™ï¼ŒprofilePicture å±æ€§å°†ä¼šç»™å®šä¸€ä¸ª byte æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„ä¸­åŒ…å«äº†è¯·æ±‚ä¸­å¯¹åº” part çš„æ•°æ®ï¼ˆé€šè¿‡ @RequestPart æŒ‡å®šï¼‰ã€‚å¦‚æœç”¨æˆ·æäº¤è¡¨å•çš„æ—¶å€™æ²¡æœ‰é€‰æ‹©æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°ç»„ä¼šæ˜¯ç©ºï¼ˆè€Œä¸æ˜¯ nullï¼‰ã€‚è·å–åˆ°å›¾ç‰‡æ•°æ®åï¼ŒprocessRegistration() æ–¹æ³•å‰©ä¸‹çš„ä»»åŠ¡å°±æ˜¯å°†æ–‡ä»¶ä¿å­˜åˆ°æŸä¸ªä½ç½®ã€‚</p>
<p>æˆ‘ä»¬å°†ä¼šç¨åè®¨è®ºå¦‚ä½•ä¿å­˜æ–‡ä»¶ã€‚ä½†é¦–å…ˆï¼Œæƒ³ä¸€ä¸‹ï¼Œå¯¹äºæäº¤çš„å›¾ç‰‡æ•°æ®æˆ‘ä»¬éƒ½äº†è§£å“ªäº›ä¿¡æ¯å‘¢ã€‚æˆ–è€…ï¼Œæ›´ä¸ºé‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬è¿˜ä¸çŸ¥é“äº›ä»€ä¹ˆå‘¢ï¼Ÿå°½ç®¡æˆ‘ä»¬å·²ç»å¾—åˆ°äº† byte æ•°ç»„å½¢å¼çš„å›¾ç‰‡æ•°æ®ï¼Œå¹¶ä¸”æ ¹æ®å®ƒèƒ½å¤Ÿå¾—åˆ°å›¾ç‰‡çš„å¤§å°ï¼Œä½†æ˜¯å¯¹äºå…¶ä»–å†…å®¹æˆ‘ä»¬å°±ä¸€æ— æ‰€çŸ¥äº†ã€‚æˆ‘ä»¬ä¸çŸ¥é“æ–‡ä»¶çš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œç”šè‡³ä¸çŸ¥é“åŸå§‹çš„æ–‡ä»¶åæ˜¯ä»€ä¹ˆã€‚ä½ éœ€è¦åˆ¤æ–­å¦‚ä½•å°† byte æ•°ç»„è½¬æ¢ä¸ºå¯å­˜å‚¨çš„æ–‡ä»¶ã€‚</p>
<p>æ¥å— <code>MultipartFile</code></p>
<p>ä½¿ç”¨ä¸Šä¼ æ–‡ä»¶çš„åŸå§‹ byte æ¯”è¾ƒç®€å•ä½†æ˜¯åŠŸèƒ½æœ‰é™ã€‚å› æ­¤ï¼ŒSpring è¿˜æä¾›äº† <code>MultipartFile</code> æ¥å£ï¼Œå®ƒä¸ºå¤„ç† multipart æ•°æ®æä¾›äº†å†…å®¹æ›´ä¸ºä¸°å¯Œçš„å¯¹è±¡ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº† <code>MultipartFile</code> æ¥å£çš„æ¦‚å†µã€‚</p>
<center>ç¨‹åºæ¸…å• 7.5ã€€Spring æ‰€æä¾›çš„ MultipartFile æ¥å£ï¼Œç”¨æ¥å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.web.multipart<span class="keyword">import</span> java.io.File;<span class="keyword">import</span> java.io.IOException;<span class="keyword">import</span> java.io.InputStream;<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MultipartFile</span> </span>&#123;  <span class="function">String <span class="title">getName</span><span class="params">()</span></span>;  <span class="function">String <span class="title">getOriginalFilename</span><span class="params">()</span></span>;  <span class="function">String <span class="title">getContentType</span><span class="params">()</span></span>;  <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;  <span class="function"><span class="keyword">long</span> <span class="title">getSize</span><span class="params">()</span></span>;  <span class="keyword">byte</span>[] getBytes() <span class="keyword">throws</span> IOException;  <span class="function">InputStream <span class="title">getInputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;  <span class="function"><span class="keyword">void</span> <span class="title">transferTo</span><span class="params">(File dest)</span> <span class="keyword">throws</span> IOException</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒMultipartFile æä¾›äº†è·å–ä¸Šä¼ æ–‡ä»¶ byte çš„æ–¹å¼ï¼Œä½†æ˜¯å®ƒæ‰€æä¾›çš„åŠŸèƒ½å¹¶ä¸ä»…é™äºæ­¤ï¼Œè¿˜èƒ½è·å¾—åŸå§‹çš„æ–‡ä»¶åã€å¤§å°ä»¥åŠå†…å®¹ç±»å‹ã€‚å®ƒè¿˜æä¾›äº†ä¸€ä¸ª InputStreamï¼Œç”¨æ¥å°†æ–‡ä»¶æ•°æ®ä»¥æµçš„æ–¹å¼è¿›è¡Œè¯»å–ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œ<code>MultipartFile</code> è¿˜æä¾›äº†ä¸€ä¸ªä¾¿åˆ©çš„ <code>transferTo()</code> æ–¹ æ³•ï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å°†ä¸Šä¼ çš„æ–‡ä»¶å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚ä½œä¸ºæ ·ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>processRegistration()</code> æ–¹æ³•ä¸­æ·»åŠ å¦‚ä¸‹çš„å‡ è¡Œä»£ç ï¼Œä»è€Œå°†ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profilePicture.tranferTo(<span class="keyword">new</span> File(<span class="string">&quot;/data/spittr/&quot;</span> + profilePicture.getOriginalFilename()));</span><br></pre></td></tr></table></figure>

<p>å°†æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­æ˜¯éå¸¸ç®€å•çš„ï¼Œä½†æ˜¯è¿™éœ€è¦æˆ‘ä»¬å¯¹è¿™äº›æ–‡ä»¶è¿›è¡Œç®¡ç†ã€‚æˆ‘ä»¬éœ€è¦ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œç¡®ä¿å½“å‡ºç°ç¡¬ä»¶æ•…éšœæ—¶ï¼Œæ–‡ä»¶è¿›è¡Œäº†å¤‡ä»½ï¼Œè¿˜éœ€è¦åœ¨é›†ç¾¤çš„å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´å¤„ç†è¿™äº›å›¾ç‰‡æ–‡ä»¶çš„åŒæ­¥ã€‚</p>
<p><strong>å°†æ–‡ä»¶ä¿å­˜åˆ° Amazon S3 ä¸­</strong></p>
<p>å¦å¤–ä¸€ç§æ–¹æ¡ˆå°±æ˜¯è®©åˆ«äººæ¥è´Ÿè´£å¤„ç†è¿™äº›äº‹æƒ…ã€‚å¤šåŠ å‡ è¡Œä»£ç ï¼Œæˆ‘ä»¬å°±èƒ½å°†å›¾ç‰‡ä¿å­˜åˆ°äº‘ç«¯ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„ç¨‹åºæ¸…å•æ‰€å±•ç°çš„ <code>saveImage()</code> æ–¹æ³•èƒ½å¤Ÿå°†ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜åˆ° Amazon S3 ä¸­ï¼Œæˆ‘ä»¬åœ¨ <code>processRegistration()</code> ä¸­å¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•ã€‚</p>
<center>ç¨‹åºæ¸…å• 7.6ã€€å°† MultipartFile ä¿å­˜åˆ° Amazon S3 ä¸­</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveImage</span><span class="params">(MultipartFile image)</span> <span class="keyword">throws</span> ImageUploadException </span>&#123;  <span class="keyword">try</span> &#123;    AWSCredentials awsCredentials = <span class="keyword">new</span> AWSCredentials(s3AccessKey, s2SecretKey);    S3Service s3 = <span class="keyword">new</span> ResetS3Service(awsCredentials);        S3Bucket bucket = s3.getBucket(<span class="string">&quot;spittrImages&quot;</span>);    S3Object imageObject = <span class="keyword">new</span> S3Object(image.getOriginalFilename);        imageObject.setDataInputStream(image.getInputStream());    imageObject.setContentLength(image.getSize());    imageObject.setContentType(image.getContentType());        AccessControlList acl = <span class="keyword">new</span> AccessControlList();    acl.setOwner(bucket.getOwner());    acl.grantPermission(GroupGrants.ALL_USERS, Permission.PERMISSION_READ);    imageObject.setAcl(acl);        s3.putObject(bucket, imageObject);  &#125; <span class="keyword">catch</span> (Exception e) &#123;    <span class="keyword">throw</span> <span class="keyword">new</span> ImageUploadException(<span class="string">&quot;Unable to save image&quot;</span>, e);  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºæ¸…å• 7.6 å°† MultipartFile ä¿å­˜åˆ° Amazon S3 ä¸­ saveImage() æ–¹æ³•æ‰€åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯æ„å»º Amazon Web Serviceï¼ˆAWSï¼‰å‡­è¯ã€‚ä¸ºäº†å®Œæˆè¿™ä¸€ç‚¹ï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ª S3 Access Key å’Œ S3 Secret Access Keyã€‚å½“æ³¨å†Œ S3 æœåŠ¡çš„æ—¶å€™ï¼ŒAmazon ä¼šå°†å…¶æä¾›ç»™ä½ ã€‚å®ƒä»¬ä¼šé€šè¿‡å€¼æ³¨å…¥çš„æ–¹å¼æä¾›ç»™ SpitterControllerã€‚</p>
<p>AWS å‡­è¯å‡†å¤‡å¥½åï¼Œ<code>saveImage()</code> æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª JetS3t çš„ RestS3Service å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥æ“ä½œ S3 æ–‡ä»¶ç³»ç»Ÿã€‚å®ƒè·å– spitterImages bucket çš„å¼•ç”¨å¹¶åˆ›å»ºç”¨æ¥åŒ…å«å›¾ç‰‡çš„ S3Object å¯¹è±¡ï¼Œæ¥ä¸‹æ¥å°†å›¾ç‰‡æ•°æ®å¡«å……åˆ° S3Objectã€‚</p>
<p>åœ¨è°ƒç”¨ putObject() æ–¹æ³•å°†å›¾ç‰‡æ•°æ®å†™åˆ° S3 ä¹‹å‰ï¼ŒsaveImage() æ–¹æ³•è®¾ç½®äº† S3Object çš„æƒé™ï¼Œä»è€Œå…è®¸æ‰€æœ‰çš„ç”¨æˆ·æŸ¥çœ‹å®ƒã€‚è¿™æ˜¯å¾ˆé‡è¦çš„ â€”â€” å¦‚æœæ²¡æœ‰å®ƒçš„è¯ï¼Œè¿™äº›å›¾ç‰‡å¯¹æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„ç”¨æˆ·å°±æ˜¯ä¸å¯è§çš„ã€‚æœ€åï¼Œå¦‚æœå‡ºç°ä»»ä½•é—®é¢˜çš„è¯ï¼Œå°†ä¼šæŠ›å‡º ImageUploadException å¼‚å¸¸ã€‚</p>
<p><strong>ä»¥ Part çš„å½¢å¼æ¥å—ä¸Šä¼ çš„æ–‡ä»¶</strong></p>
<p>å¦‚æœä½ éœ€è¦å°†åº”ç”¨éƒ¨ç½²åˆ° Servlet 3.0 çš„å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆä¼šæœ‰ MultipartFile çš„ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆã€‚Spring MVC ä¹Ÿèƒ½æ¥å— <code>javax.servlet.http.Part</code> ä½œä¸ºæ§åˆ¶å™¨æ–¹æ³•çš„å‚æ•°ã€‚å¦‚æœä½¿ç”¨ Part æ¥æ›¿æ¢ <code>MultipartFile</code> çš„è¯ï¼Œé‚£ä¹ˆ <code>processRegistration()</code> çš„æ–¹æ³•ç­¾åå°†ä¼šå˜æˆå¦‚ä¸‹çš„å½¢å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/register&quot;, method=POST)</span><span class="function"><span class="keyword">public</span> String <span class="title">processRegistration</span><span class="params">(    <span class="meta">@RequestPart(&quot;profilePicture&quot;)</span> Part profilePicture,    <span class="meta">@Valid</span> Spittr spittr,    Errors errors)</span> </span>&#123;  ...&#125; </span><br></pre></td></tr></table></figure>

<p>å°±ä¸»ä½“æ¥è¨€ï¼ˆä¸å¼€ç©ç¬‘åœ°è¯´ï¼‰ï¼ŒPart æ¥å£ä¸ MultipartFile å¹¶æ²¡æœ‰å¤ªå¤§çš„å·®åˆ«ã€‚åœ¨å¦‚ä¸‹çš„ç¨‹åºæ¸…å•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Part æ¥å£çš„æœ‰ä¸€äº›æ–¹æ³•å…¶å®æ˜¯ä¸ MultipartFile ç›¸å¯¹åº”çš„ã€‚</p>
<center>ç¨‹åºæ¸…å• 7.7ã€€Part æ¥å£ï¼šSpring MultipartFile çš„æ›¿ä»£æ–¹æ¡ˆ</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javax.servlet.http;<span class="keyword">import</span> java.io.*;<span class="keyword">import</span> java.util.*;<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Part</span> </span>&#123;  <span class="function">InputStream <span class="title">getInputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;  <span class="function">String <span class="title">getContentType</span><span class="params">()</span></span>;  <span class="function">String <span class="title">getName</span><span class="params">()</span></span>;  <span class="function">String <span class="title">getSubmittedFileName</span><span class="params">()</span></span>;  <span class="function"><span class="keyword">long</span> <span class="title">getSize</span><span class="params">()</span></span>;  <span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(String fileName)</span> <span class="keyword">throws</span> IOException</span>;  <span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;  <span class="function">String <span class="title">getHeader</span><span class="params">(String name)</span></span>;  <span class="function">Collection&lt;String&gt; <span class="title">getHeaders</span><span class="params">(String name)</span></span>;  <span class="function">Collection&lt;String&gt; <span class="title">getHeaderNames</span><span class="params">()</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒPart æ–¹æ³•çš„åç§°ä¸ MultipartFile æ–¹æ³•çš„åç§°æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚æœ‰ä¸€äº›æ¯”è¾ƒç±»ä¼¼ï¼Œä½†æ˜¯ç¨æœ‰å·®å¼‚ï¼Œæ¯”å¦‚ getSubmittedFileName() å¯¹åº”äº getOriginalFilename()ã€‚ç±»ä¼¼åœ°ï¼Œwrite() å¯¹åº”äº transferTo()ï¼Œå€ŸåŠ©è¯¥æ–¹æ³•æˆ‘ä»¬èƒ½å¤Ÿå°†ä¸Šä¼ çš„æ–‡ä»¶å†™å…¥æ–‡ä»¶ç³»ç»Ÿä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profilePicture.write(<span class="string">&quot;/data/spittr/&quot;</span> + profilePicture.getOriginalFilename());</span><br></pre></td></tr></table></figure>

<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœåœ¨ç¼–å†™æ§åˆ¶å™¨æ–¹æ³•çš„æ—¶å€™ï¼Œé€šè¿‡ Part å‚æ•°çš„å½¢å¼æ¥å—æ–‡ä»¶ä¸Šä¼ ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰å¿…è¦é…ç½® <code>MultipartResolver</code> äº†ã€‚åªæœ‰ä½¿ç”¨ <code>MultipartFile</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰éœ€è¦ <code>MultipartResolver</code>ã€‚</p>
<h3 id="å¤„ç†å¼‚å¸¸"><a href="#å¤„ç†å¼‚å¸¸" class="headerlink" title="å¤„ç†å¼‚å¸¸"></a>å¤„ç†å¼‚å¸¸</h3><p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œåœ¨ Spittr åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å‡è®¾æ‰€æœ‰çš„åŠŸèƒ½éƒ½æ­£å¸¸è¿è¡Œã€‚ä½†æ˜¯å¦‚æœæŸä¸ªåœ°æ–¹å‡ºé”™çš„è¯ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå½“å¤„ç†è¯·æ±‚çš„æ—¶å€™ï¼ŒæŠ›å‡ºå¼‚å¸¸è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿå¦‚æœå‘ç”Ÿäº†è¿™æ ·çš„æƒ…å†µï¼Œè¯¥ç»™å®¢æˆ·ç«¯ä»€ä¹ˆå“åº”å‘¢ï¼Ÿ</p>
<p>ä¸ç®¡å‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Œä¸ç®¡æ˜¯å¥½çš„è¿˜æ˜¯åçš„ï¼ŒServlet è¯·æ±‚çš„è¾“å‡ºéƒ½æ˜¯ä¸€ä¸ª Servlet å“åº”ã€‚å¦‚æœåœ¨è¯·æ±‚å¤„ç†çš„æ—¶å€™ï¼Œå‡ºç°äº†å¼‚å¸¸ï¼Œé‚£å®ƒçš„è¾“å‡ºä¾ç„¶ä¼šæ˜¯ Servlet å“åº”ã€‚å¼‚å¸¸å¿…é¡»è¦ä»¥æŸç§æ–¹å¼è½¬æ¢ä¸ºå“åº”ã€‚</p>
<p>Spring æä¾›äº†å¤šç§æ–¹å¼å°†å¼‚å¸¸è½¬æ¢ä¸ºå“åº”ï¼š</p>
<ul>
<li>ç‰¹å®šçš„ Spring å¼‚å¸¸å°†ä¼šè‡ªåŠ¨æ˜ å°„ä¸ºæŒ‡å®šçš„ HTTP çŠ¶æ€ç ï¼›</li>
<li>å¼‚å¸¸ä¸Šå¯ä»¥æ·»åŠ  <code>@ResponseStatus</code> æ³¨è§£ï¼Œä»è€Œå°†å…¶æ˜ å°„ä¸ºæŸä¸€ä¸ª HTTP çŠ¶æ€ç ï¼›</li>
<li>åœ¨æ–¹æ³•ä¸Šå¯ä»¥æ·»åŠ  <code>@ExceptionHandler</code> æ³¨è§£ï¼Œä½¿å…¶ç”¨æ¥å¤„ç†å¼‚å¸¸ã€‚</li>
</ul>
<p>å¤„ç†å¼‚å¸¸çš„æœ€ç®€å•æ–¹å¼å°±æ˜¯å°†å…¶æ˜ å°„åˆ° HTTP çŠ¶æ€ç ä¸Šï¼Œè¿›è€Œæ”¾åˆ°å“åº”ä¹‹ä¸­ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•å°†å¼‚å¸¸æ˜ å°„ä¸ºæŸä¸€ä¸ª HTTP çŠ¶æ€ç ã€‚</p>
<h4 id="å°†å¼‚å¸¸æ˜ å°„ä¸º-HTTP-çŠ¶æ€ç "><a href="#å°†å¼‚å¸¸æ˜ å°„ä¸º-HTTP-çŠ¶æ€ç " class="headerlink" title="å°†å¼‚å¸¸æ˜ å°„ä¸º HTTP çŠ¶æ€ç "></a>å°†å¼‚å¸¸æ˜ å°„ä¸º HTTP çŠ¶æ€ç </h4><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring ä¼šå°†è‡ªèº«çš„ä¸€äº›å¼‚å¸¸è‡ªåŠ¨è½¬æ¢ä¸ºåˆé€‚çš„çŠ¶æ€ç ã€‚è¡¨ 7.1 åˆ—å‡ºäº†è¿™äº›æ˜ å°„å…³ç³»ã€‚</p>
<center>è¡¨ 7.1ã€€Spring çš„ä¸€äº›å¼‚å¸¸ä¼šé»˜è®¤æ˜ å°„ä¸º HTTP çŠ¶æ€ç </center>

<table>
<thead>
<tr>
<th>Spring å¼‚å¸¸</th>
<th>HTTP çŠ¶æ€ç </th>
</tr>
</thead>
<tbody><tr>
<td>BindException</td>
<td>400 - Bad Request</td>
</tr>
<tr>
<td>ConversionNotSupportedException</td>
<td>500 - Internal Server Error</td>
</tr>
<tr>
<td>HttpMediaTypeNotAcceptableException</td>
<td>406 - Not Acceptable</td>
</tr>
<tr>
<td>HttpMediaTypeNotSupportedException</td>
<td>415 - Unsupported Media Type</td>
</tr>
<tr>
<td>HttpMessageNotReadableException</td>
<td>400 - Bad Request</td>
</tr>
<tr>
<td>HttpMessageNotWritableException</td>
<td>500 - Internal Server Error</td>
</tr>
<tr>
<td>HttpRequestMethodNotSupportedException</td>
<td>405 - Method Not Allowed</td>
</tr>
<tr>
<td>MethodArgumentNotValidException</td>
<td>400 - Bad Request</td>
</tr>
<tr>
<td>MissingServletRequestParameterException</td>
<td>400 - Bad Request</td>
</tr>
<tr>
<td>MissingServletRequestPartException</td>
<td>400 - Bad Request</td>
</tr>
<tr>
<td>NoSuchRequestHandlingMethodException</td>
<td>404 - Not Found</td>
</tr>
<tr>
<td>TypeMismatchException</td>
<td>400 - Bad Request</td>
</tr>
</tbody></table>
<p>è¡¨ 7.1 ä¸­çš„å¼‚å¸¸ä¸€èˆ¬ä¼šç”± Spring è‡ªèº«æŠ›å‡ºï¼Œä½œä¸º DispatcherServlet å¤„ç†è¿‡ç¨‹ä¸­æˆ–æ‰§è¡Œæ ¡éªŒæ—¶å‡ºç°é—®é¢˜çš„ç»“æœã€‚ä¾‹å¦‚ï¼Œå¦‚æœ DispatcherServlet æ— æ³•æ‰¾åˆ°é€‚åˆå¤„ç†è¯·æ±‚çš„æ§åˆ¶å™¨æ–¹æ³•ï¼Œé‚£ä¹ˆå°†ä¼šæŠ›å‡º NoSuchRequestHandlingMethod-Exception å¼‚å¸¸ï¼Œæœ€ç»ˆçš„ç»“æœå°±æ˜¯äº§ç”Ÿ 404 çŠ¶æ€ç çš„å“åº”ï¼ˆNot Foundï¼‰ã€‚</p>
<p>å°½ç®¡è¿™äº›å†…ç½®çš„æ˜ å°„æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œä½†æ˜¯å¯¹äºåº”ç”¨æ‰€æŠ›å‡ºçš„å¼‚å¸¸å®ƒä»¬å°±æ— èƒ½ä¸ºåŠ›äº†ã€‚å¹¸å¥½ï¼ŒSpring æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œèƒ½å¤Ÿé€šè¿‡ @ResponseStatus æ³¨è§£å°†å¼‚å¸¸æ˜ å°„ä¸º HTTP çŠ¶æ€ç ã€‚</p>
<p>ä¸ºäº†é˜è¿°è¿™é¡¹åŠŸèƒ½ï¼Œè¯·å‚è€ƒ SpittleController ä¸­å¦‚ä¸‹çš„è¯·æ±‚å¤„ç†æ–¹æ³•ï¼Œå®ƒå¯èƒ½ä¼šäº§ç”Ÿ HTTP 404 çŠ¶æ€ï¼ˆä½†ç›®å‰è¿˜æ²¡æœ‰å®ç°ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/&#123;spittleId&#125;&quot;, method=RequestMethod.GET)</span><span class="function"><span class="keyword">public</span> String <span class="title">spittle</span><span class="params">(    <span class="meta">@PathVariable(&quot;spittleId&quot;)</span> <span class="keyword">long</span> spittleId,     Model model)</span> </span>&#123;  Spittle spittle = spittleRepository.findOne(spittleId);  <span class="keyword">if</span> (spittle == <span class="keyword">null</span>) &#123;    <span class="keyword">throw</span> <span class="keyword">new</span> SpittleNotFoundException();  &#125;  model.addAttribute(spittle);  <span class="keyword">return</span> <span class="string">&quot;spittle&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œä¼šä» SpittleRepository ä¸­ï¼Œé€šè¿‡ ID æ£€ç´¢ Spittle å¯¹è±¡ã€‚å¦‚æœ findOne() æ–¹æ³•èƒ½å¤Ÿè¿”å› Spittle å¯¹è±¡çš„è¯ï¼Œé‚£ä¹ˆä¼šå°† Spittle æ”¾åˆ°æ¨¡å‹ä¸­ï¼Œç„¶ååä¸º spittle çš„è§†å›¾ä¼šè´Ÿè´£å°†å…¶æ¸²æŸ“åˆ°å“åº”ä¹‹ä¸­ã€‚ä½†æ˜¯å¦‚æœ findOne() æ–¹æ³•è¿”å› null çš„è¯ï¼Œé‚£ä¹ˆå°†ä¼šæŠ›å‡º <code>SpittleNotFoundException</code> å¼‚å¸¸ã€‚ç°åœ¨ <code>SpittleNotFoundException</code> å°±æ˜¯ä¸€ä¸ªç®€å•çš„éæ£€æŸ¥å‹å¼‚å¸¸ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.web;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpittleNotFoundException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè°ƒç”¨ spittle() æ–¹æ³•æ¥å¤„ç†è¯·æ±‚ï¼Œå¹¶ä¸”ç»™å®š ID è·å–åˆ°çš„ç»“æœä¸ºç©ºï¼Œé‚£ä¹ˆ <code>SpittleNotFoundException</code>ï¼ˆé»˜è®¤ï¼‰å°†ä¼šäº§ç”Ÿ 500 çŠ¶æ€ç ï¼ˆInternal Server Errorï¼‰çš„å“åº”ã€‚å®é™…ä¸Šï¼Œå¦‚æœå‡ºç°ä»»ä½•æ²¡æœ‰æ˜ å°„çš„å¼‚å¸¸ï¼Œå“åº”éƒ½ä¼šå¸¦æœ‰ 500 çŠ¶æ€ç ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ˜ å°„ <code>SpittleNotFoundException</code> å¯¹è¿™ç§é»˜è®¤è¡Œä¸ºè¿›è¡Œå˜æ›´ã€‚</p>
<p>å½“æŠ›å‡º <code>SpittleNotFoundException</code> å¼‚å¸¸æ—¶ï¼Œè¿™æ˜¯ä¸€ç§è¯·æ±‚èµ„æºæ²¡æœ‰æ‰¾åˆ°çš„åœºæ™¯ã€‚å¦‚æœèµ„æºæ²¡æœ‰æ‰¾åˆ°çš„è¯ï¼ŒHTTP çŠ¶æ€ç  404 æ˜¯æœ€ä¸ºç²¾ç¡®çš„å“åº”çŠ¶æ€ç ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ <code>@ResponseStatus</code> æ³¨è§£å°† <code>SpittleNotFoundException</code> æ˜ å°„ä¸º HTTP çŠ¶æ€ç  404ã€‚</p>
<center>ç¨‹åºæ¸…å• 7.8ã€€@ResponseStatus æ³¨è§£ï¼šå°†å¼‚å¸¸æ˜ å°„ä¸ºç‰¹å®šçš„çŠ¶æ€ç </center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.web;<span class="keyword">import</span> org.springframework.http.HttpStatus;<span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseStatus;<span class="meta">@ResponseStatus(value=HttpStatus.NOT_FOUND, reason=&quot;Spittle Not Found&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpittleNotFoundException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨å¼•å…¥ <code>@ResponseStatus</code> æ³¨è§£ä¹‹åï¼Œå¦‚æœæ§åˆ¶å™¨æ–¹æ³•æŠ›å‡º <code>SpittleNotFoundException</code> å¼‚å¸¸çš„è¯ï¼Œå“åº”å°†ä¼šå…·æœ‰ 404 çŠ¶æ€ç ï¼Œè¿™æ˜¯å› ä¸º Spittle Not Foundã€‚</p>
<h4 id="ç¼–å†™å¼‚å¸¸å¤„ç†çš„æ–¹æ³•"><a href="#ç¼–å†™å¼‚å¸¸å¤„ç†çš„æ–¹æ³•" class="headerlink" title="ç¼–å†™å¼‚å¸¸å¤„ç†çš„æ–¹æ³•"></a>ç¼–å†™å¼‚å¸¸å¤„ç†çš„æ–¹æ³•</h4><p>åœ¨å¾ˆå¤šçš„åœºæ™¯ä¸‹ï¼Œå°†å¼‚å¸¸æ˜ å°„ä¸ºçŠ¶æ€ç æ˜¯å¾ˆç®€å•çš„æ–¹æ¡ˆï¼Œå¹¶ä¸”å°±åŠŸèƒ½æ¥è¯´ä¹Ÿè¶³å¤Ÿäº†ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³åœ¨å“åº”ä¸­ä¸ä»…è¦åŒ…æ‹¬çŠ¶æ€ç ï¼Œè¿˜è¦åŒ…å«æ‰€äº§ç”Ÿçš„é”™è¯¯ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæ­¤æ—¶çš„è¯ï¼Œæˆ‘ä»¬å°±ä¸èƒ½å°†å¼‚å¸¸è§†ä¸º HTTP é”™è¯¯äº†ï¼Œè€Œæ˜¯è¦æŒ‰ç…§å¤„ç†è¯·æ±‚çš„æ–¹å¼æ¥å¤„ç†å¼‚å¸¸äº†ã€‚</p>
<p>ä½œä¸ºæ ·ä¾‹ï¼Œå‡è®¾ç”¨æˆ·è¯•å›¾åˆ›å»ºçš„ Spittle ä¸å·²åˆ›å»ºçš„ Spittle æ–‡æœ¬å®Œå…¨ç›¸åŒï¼Œé‚£ä¹ˆ <code>SpittleRepository</code> çš„ save() æ–¹æ³•å°†ä¼šæŠ›å‡º DuplicateSpittle Exception å¼‚å¸¸ã€‚è¿™æ„å‘³ç€ SpittleController çš„ saveSpittle() æ–¹æ³•å¯èƒ½éœ€è¦å¤„ç†è¿™ä¸ªå¼‚å¸¸ã€‚å¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºï¼ŒsaveSpittle() æ–¹æ³•å¯ä»¥ç›´æ¥å¤„ç†è¿™ä¸ªå¼‚å¸¸ã€‚</p>
<center>ç¨‹åºæ¸…å• 7.9ã€€åœ¨å¤„ç†è¯·æ±‚çš„æ–¹æ³•ä¸­ç›´æ¥å¤„ç†å¼‚å¸¸</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(method=RequestMethod.POST)</span><span class="function"><span class="keyword">public</span> String <span class="title">saveSpittle</span><span class="params">(SpittleForm form, Model model)</span> </span>&#123;  <span class="keyword">try</span> &#123;    spittleRepository.save(<span class="keyword">new</span> Spittle(<span class="keyword">null</span>, form.getMessage(), <span class="keyword">new</span> Date(),         form.getLongitude(), form.getLatitude()));    <span class="keyword">return</span> <span class="string">&quot;redirect:/spittles&quot;</span>;  &#125; <span class="keyword">catch</span> (DuplicateSpittleException e) &#123;    <span class="keyword">return</span> <span class="string">&quot;error/duplicate&quot;</span>;  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºæ¸…å• 7.9 ä¸­å¹¶æ²¡æœ‰ç‰¹åˆ«ä¹‹å¤„ï¼Œå®ƒåªæ˜¯åœ¨ Java ä¸­å¤„ç†å¼‚å¸¸çš„åŸºæœ¬æ ·ä¾‹ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿå°±æ²¡ä»€ä¹ˆäº†ã€‚</p>
<p>å®ƒè¿è¡Œèµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•æœ‰äº›å¤æ‚ã€‚è¯¥æ–¹æ³•å¯ä»¥æœ‰ä¸¤ä¸ªè·¯å¾„ï¼Œæ¯ä¸ªè·¯å¾„ä¼šæœ‰ä¸åŒçš„è¾“å‡ºã€‚å¦‚æœèƒ½è®© saveSpittle() æ–¹æ³•åªå…³æ³¨æ­£ç¡®çš„è·¯å¾„ï¼Œè€Œè®©å…¶ä»–æ–¹æ³•å¤„ç†å¼‚å¸¸çš„è¯ï¼Œé‚£ä¹ˆå®ƒå°±èƒ½ç®€å•ä¸€äº›ã€‚</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬é¦–å…ˆå°† saveSpittle() æ–¹æ³•ä¸­çš„å¼‚å¸¸å¤„ç†æ–¹æ³•å‰¥ç¦»æ‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(method=RequestMethod.POST)</span><span class="function"><span class="keyword">public</span> String <span class="title">saveSpittle</span><span class="params">(SpittleForm form, Model model)</span> </span>&#123;  spittleRepository.save(<span class="keyword">new</span> Spittle(<span class="keyword">null</span>, form.getMessage(), <span class="keyword">new</span> Date(),     form.getLongitude(), form.getLatitude()));  <span class="keyword">return</span> <span class="string">&quot;redirect:/spittles&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒsaveSpittle() æ–¹æ³•ç®€å•äº†è®¸å¤šã€‚å› ä¸ºå®ƒåªå…³æ³¨æˆåŠŸä¿å­˜ Spittle çš„æƒ…å†µï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªæ‰§è¡Œè·¯å¾„ï¼Œå¾ˆå®¹æ˜“ç†è§£ï¼ˆå’Œæµ‹è¯•ï¼‰ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¸º SpittleController æ·»åŠ ä¸€ä¸ªæ–°çš„æ–¹æ³•ï¼Œå®ƒä¼šå¤„ç†æŠ›å‡º DuplicateSpittleException çš„æƒ…å†µï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(DuplicateSpittleException.class)</span><span class="function"><span class="keyword">public</span> String <span class="title">handleDuplicateSpittle</span><span class="params">()</span> </span>&#123;  <span class="keyword">return</span> <span class="string">&quot;error/duplicate&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>handleDuplicateSpittle() æ–¹æ³•ä¸Šæ·»åŠ äº† @ExceptionHandler æ³¨è§£ï¼Œå½“æŠ›å‡º  DuplicateSpittleException å¼‚å¸¸çš„æ—¶å€™ï¼Œå°†ä¼šå§”æ‰˜è¯¥æ–¹æ³•æ¥å¤„ç†ã€‚å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ª Stringï¼Œè¿™ä¸å¤„ç†è¯·æ±‚çš„æ–¹æ³•æ˜¯ä¸€è‡´çš„ï¼ŒæŒ‡å®šäº†è¦æ¸²æŸ“çš„é€»è¾‘è§†å›¾åï¼Œå®ƒèƒ½å¤Ÿå‘Šè¯‰ç”¨æˆ·ä»–ä»¬æ­£åœ¨è¯•å›¾åˆ›å»ºä¸€æ¡é‡å¤çš„æ¡ç›®ã€‚</p>
<p>å¯¹äº @ExceptionHandler æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•æ¥è¯´ï¼Œæ¯”è¾ƒæœ‰æ„æ€çš„ä¸€ç‚¹åœ¨äºå®ƒèƒ½å¤„ç†åŒä¸€ä¸ªæ§åˆ¶å™¨ä¸­æ‰€æœ‰å¤„ç†å™¨æ–¹æ³•æ‰€æŠ›å‡ºçš„å¼‚å¸¸ã€‚æ‰€ä»¥ï¼Œå°½ç®¡æˆ‘ä»¬ä»saveSpittle() ä¸­æŠ½å–ä»£ç åˆ›å»ºäº† handleDuplicateSpittle() æ–¹æ³•ï¼Œä½†æ˜¯å®ƒèƒ½å¤Ÿå¤„ç† SpittleController ä¸­æ‰€æœ‰æ–¹æ³•æ‰€æŠ›å‡ºçš„ DuplicateSpittleException å¼‚å¸¸ã€‚æˆ‘ä»¬ä¸ç”¨åœ¨æ¯ä¸€ä¸ªå¯èƒ½æŠ›å‡º DuplicateSpittleException çš„æ–¹æ³•ä¸­æ·»åŠ å¼‚å¸¸å¤„ç†ä»£ç ï¼Œè¿™ä¸€ä¸ªæ–¹æ³•å°±æ¶µç›–äº†æ‰€æœ‰çš„åŠŸèƒ½ã€‚</p>
<p>æ—¢ç„¶ @ExceptionHandler æ³¨è§£æ‰€æ ‡æ³¨çš„æ–¹æ³•èƒ½å¤Ÿå¤„ç†åŒä¸€ä¸ªæ§åˆ¶å™¨ç±»ä¸­æ‰€æœ‰å¤„ç†å™¨æ–¹æ³•çš„å¼‚å¸¸ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šé—®æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•èƒ½å¤Ÿå¤„ç†æ‰€æœ‰æ§åˆ¶å™¨ä¸­å¤„ç†å™¨æ–¹æ³•æ‰€æŠ›å‡ºçš„å¼‚å¸¸å‘¢ã€‚ä» Spring 3.2 å¼€å§‹ï¼Œè¿™è‚¯å®šæ˜¯èƒ½å¤Ÿå®ç°çš„ï¼Œæˆ‘ä»¬åªéœ€å°†å…¶å®šä¹‰åˆ°æ§åˆ¶å™¨é€šçŸ¥ç±»ä¸­å³å¯ã€‚</p>
<p>ä»€ä¹ˆæ˜¯æ§åˆ¶å™¨é€šçŸ¥æ–¹æ³•ï¼Ÿå¾ˆé«˜å…´ä½ ä¼šé—®è¿™æ ·çš„é—®é¢˜ï¼Œå› ä¸ºè¿™å°±æ˜¯æˆ‘ä»¬ä¸‹é¢è¦è®²çš„å†…å®¹ã€‚</p>
<h3 id="ä¸ºæ§åˆ¶å™¨æ·»åŠ é€šçŸ¥"><a href="#ä¸ºæ§åˆ¶å™¨æ·»åŠ é€šçŸ¥" class="headerlink" title="ä¸ºæ§åˆ¶å™¨æ·»åŠ é€šçŸ¥"></a>ä¸ºæ§åˆ¶å™¨æ·»åŠ é€šçŸ¥</h3><p>å¦‚æœæ§åˆ¶å™¨ç±»çš„ç‰¹å®šåˆ‡é¢èƒ½å¤Ÿè¿ç”¨åˆ°æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ‰€æœ‰æ§åˆ¶å™¨ä¸­ï¼Œé‚£ä¹ˆè¿™å°†ä¼šä¾¿åˆ©å¾ˆå¤šã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœè¦åœ¨å¤šä¸ªæ§åˆ¶å™¨ä¸­å¤„ç†å¼‚å¸¸ï¼Œé‚£ @ExceptionHandler æ³¨è§£æ‰€æ ‡æ³¨çš„æ–¹æ³•æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ä¸è¿‡ï¼Œå¦‚æœå¤šä¸ªæ§åˆ¶å™¨ç±»ä¸­éƒ½ä¼šæŠ›å‡ºæŸä¸ªç‰¹å®šçš„å¼‚å¸¸ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šå‘ç°è¦åœ¨æ‰€æœ‰çš„æ§åˆ¶å™¨æ–¹æ³•ä¸­é‡å¤ç›¸åŒçš„ @Exception-Handler æ–¹æ³•ã€‚æˆ–è€…ï¼Œä¸ºäº†é¿å…é‡å¤ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªåŸºç¡€çš„æ§åˆ¶å™¨ç±»ï¼Œæ‰€æœ‰æ§åˆ¶å™¨ç±»è¦æ‰©å±•è¿™ä¸ªç±»ï¼Œä»è€Œç»§æ‰¿é€šç”¨çš„ @ExceptionHandler æ–¹æ³•ã€‚</p>
<p>Spring 3.2 ä¸ºè¿™ç±»é—®é¢˜å¼•å…¥äº†ä¸€ä¸ªæ–°çš„è§£å†³æ–¹æ¡ˆï¼šæ§åˆ¶å™¨é€šçŸ¥ã€‚æ§åˆ¶å™¨é€šçŸ¥ï¼ˆcontroller adviceï¼‰æ˜¯ä»»æ„å¸¦æœ‰ @ControllerAdvice æ³¨è§£çš„ç±»ï¼Œè¿™ä¸ªç±»ä¼šåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå¦‚ä¸‹ç±»å‹çš„æ–¹æ³•ï¼š</p>
<ul>
<li>@ExceptionHandler æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ï¼›</li>
<li>@InitBinder æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ï¼›</li>
<li>@ModelAttribute æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ã€‚</li>
</ul>
<p>åœ¨å¸¦æœ‰ @ControllerAdvice æ³¨è§£çš„ç±»ä¸­ï¼Œä»¥ä¸Šæ‰€è¿°çš„è¿™äº›æ–¹æ³•ä¼šè¿ç”¨åˆ°æ•´ä¸ªåº”ç”¨ç¨‹åºæ‰€æœ‰æ§åˆ¶å™¨ä¸­å¸¦æœ‰ @RequestMapping æ³¨è§£çš„æ–¹æ³•ä¸Šã€‚</p>
<p>@ControllerAdvice æ³¨è§£æœ¬èº«å·²ç»ä½¿ç”¨äº† @Componentï¼Œå› æ­¤@ControllerAdvice æ³¨è§£æ‰€æ ‡æ³¨çš„ç±»å°†ä¼šè‡ªåŠ¨è¢«ç»„ä»¶æ‰«æè·å–åˆ°ï¼Œå°±åƒå¸¦æœ‰ @Component æ³¨è§£çš„ç±»ä¸€æ ·ã€‚</p>
<p>@ControllerAdvice æœ€ä¸ºå®ç”¨çš„ä¸€ä¸ªåœºæ™¯å°±æ˜¯å°†æ‰€æœ‰çš„ @ExceptionHandler æ–¹æ³•æ”¶é›†åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œè¿™æ ·æ‰€æœ‰æ§åˆ¶å™¨çš„å¼‚å¸¸å°±èƒ½åœ¨ä¸€ä¸ªåœ°æ–¹è¿›è¡Œä¸€è‡´çš„å¤„ç†ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³å°† DuplicateSpittleException çš„å¤„ç†æ–¹æ³•ç”¨åˆ°æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ‰€æœ‰æ§åˆ¶å™¨ä¸Šã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°çš„ AppWideExceptionHandler å°±èƒ½å®Œæˆè¿™ä¸€ä»»åŠ¡ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¦æœ‰ @ControllerAdvice æ³¨è§£çš„ç±»ã€‚</p>
<center>ç¨‹åºæ¸…å• 7.10ã€€ä½¿ç”¨ @ControllerAdviceï¼Œä¸ºæ‰€æœ‰çš„æ§åˆ¶å™¨å¤„ç†å¼‚å¸¸</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.web;<span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;<span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;<span class="meta">@ControllerAdvicepublic</span> <span class="class"><span class="keyword">class</span> <span class="title">AppWideExceptionHandler</span> </span>&#123;  <span class="meta">@ExceptionHandler(DuplicateSpittleException.class)</span>  <span class="function"><span class="keyword">public</span> String <span class="title">handleNotFound</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="string">&quot;error/duplicate&quot;</span>;  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œå¦‚æœä»»æ„çš„æ§åˆ¶å™¨æ–¹æ³•æŠ›å‡ºäº† DuplicateSpittleExceptionï¼Œä¸ç®¡è¿™ä¸ªæ–¹æ³•ä½äºå“ªä¸ªæ§åˆ¶å™¨ä¸­ï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ª duplicateSpittleHandler() æ–¹æ³•æ¥å¤„ç†å¼‚å¸¸ã€‚æˆ‘ä»¬å¯ä»¥åƒç¼–å†™ @RequestMapping æ³¨è§£çš„æ–¹æ³•é‚£æ ·æ¥ç¼–å†™ @Exception-Handler æ³¨è§£çš„æ–¹æ³•ã€‚å¦‚ç¨‹åºæ¸…å• 7.10 æ‰€ç¤ºï¼Œå®ƒè¿”å› <code>error/duplicate</code> ä½œä¸ºé€»è¾‘è§†å›¾åï¼Œå› æ­¤å°†ä¼šä¸ºç”¨æˆ·å±•ç°ä¸€ä¸ªå‹å¥½çš„å‡ºé”™é¡µé¢ã€‚</p>
<h3 id="è·¨é‡å®šå‘è¯·æ±‚ä¼ é€’æ•°æ®"><a href="#è·¨é‡å®šå‘è¯·æ±‚ä¼ é€’æ•°æ®" class="headerlink" title="è·¨é‡å®šå‘è¯·æ±‚ä¼ é€’æ•°æ®"></a>è·¨é‡å®šå‘è¯·æ±‚ä¼ é€’æ•°æ®</h3><p>åœ¨ 5.4.1 å°èŠ‚ä¸­ï¼Œåœ¨å¤„ç†å®Œ POST è¯·æ±‚åï¼Œé€šå¸¸æ¥è®²ä¸€ä¸ªæœ€ä½³å®è·µå°±æ˜¯æ‰§è¡Œä¸€ä¸‹é‡å®šå‘ã€‚é™¤äº†å…¶ä»–çš„ä¸€äº›å› ç´ å¤–ï¼Œè¿™æ ·åšèƒ½å¤Ÿé˜²æ­¢ç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨çš„åˆ·æ–°æŒ‰é’®æˆ–åé€€ç®­å¤´æ—¶ï¼Œå®¢æˆ·ç«¯é‡æ–°æ‰§è¡Œå±é™©çš„ POST è¯·æ±‚ã€‚</p>
<p>åœ¨ç¬¬ 5 ç« ï¼Œåœ¨æ§åˆ¶å™¨æ–¹æ³•è¿”å›çš„è§†å›¾åç§°ä¸­ï¼Œæˆ‘ä»¬å€ŸåŠ© äº† <code>redirect:</code> å‰ç¼€çš„åŠ›é‡ã€‚å½“æ§åˆ¶å™¨æ–¹æ³•è¿”å›çš„ String å€¼ ä»¥ <code>redirect:</code> å¼€å¤´çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ª String ä¸æ˜¯ç”¨æ¥æŸ¥æ‰¾è§†å›¾çš„ï¼Œè€Œæ˜¯ç”¨æ¥æŒ‡å¯¼æµè§ˆå™¨è¿›è¡Œé‡å®šå‘çš„è·¯å¾„ã€‚æˆ‘ä»¬å¯ä»¥å›å¤´çœ‹ä¸€ä¸‹ç¨‹åºæ¸…å• 5.17ï¼Œå¯ä»¥çœ‹åˆ° processRegistration() æ–¹æ³•è¿”å›çš„ <code>redirect:String</code> å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">&quot;redirect:/spitter/&quot;</span> + spitter.getUsername();</span><br></pre></td></tr></table></figure>

<p><code>redirect: </code>å‰ç¼€èƒ½å¤Ÿè®©é‡å®šå‘åŠŸèƒ½å˜å¾—éå¸¸ç®€å•ã€‚ä½ å¯èƒ½ä¼šæƒ³ Spring å¾ˆéš¾å†è®©é‡å®šå‘åŠŸèƒ½å˜å¾—æ›´ç®€å•äº†ã€‚ä½†æ˜¯ï¼Œè¯·ç¨ç­‰ï¼šSpring ä¸ºé‡å®šå‘åŠŸèƒ½è¿˜æä¾›äº†ä¸€äº›å…¶ä»–çš„è¾…åŠ©åŠŸèƒ½ã€‚</p>
<p>å…·ä½“æ¥è®²ï¼Œæ­£åœ¨å‘èµ·é‡å®šå‘åŠŸèƒ½çš„æ–¹æ³•è¯¥å¦‚ä½•å‘é€æ•°æ®ç»™é‡å®šå‘çš„ç›®æ ‡æ–¹æ³•å‘¢ï¼Ÿä¸€èˆ¬æ¥è®²ï¼Œå½“ä¸€ä¸ªå¤„ç†å™¨æ–¹æ³•å®Œæˆä¹‹åï¼Œè¯¥æ–¹æ³•æ‰€æŒ‡å®šçš„æ¨¡å‹æ•°æ®å°†ä¼šå¤åˆ¶åˆ°è¯·æ±‚ä¸­ï¼Œå¹¶ä½œä¸ºè¯·æ±‚ä¸­çš„å±æ€§ï¼Œè¯·æ±‚ä¼šè½¬å‘ï¼ˆforwardï¼‰åˆ°è§†å›¾ä¸Šè¿›è¡Œæ¸²æŸ“ã€‚å› ä¸ºæ§åˆ¶å™¨æ–¹æ³•å’Œè§†å›¾æ‰€å¤„ç†çš„æ˜¯åŒä¸€ä¸ªè¯·æ±‚ï¼Œæ‰€ä»¥åœ¨è½¬å‘çš„è¿‡ç¨‹ä¸­ï¼Œè¯·æ±‚å±æ€§èƒ½å¤Ÿå¾—ä»¥ä¿å­˜ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚å›¾ 7.1 æ‰€ç¤ºï¼Œå½“æ§åˆ¶å™¨çš„ç»“æœæ˜¯é‡å®šå‘çš„è¯ï¼ŒåŸå§‹çš„è¯·æ±‚å°±ç»“æŸäº†ï¼Œå¹¶ä¸”ä¼šå‘èµ·ä¸€ä¸ªæ–°çš„ GET è¯·æ±‚ã€‚åŸå§‹è¯·æ±‚ä¸­æ‰€å¸¦æœ‰çš„æ¨¡å‹æ•°æ®ä¹Ÿå°±éšç€è¯·æ±‚ä¸€èµ·æ¶ˆäº¡äº†ã€‚åœ¨æ–°çš„è¯·æ±‚å±æ€§ä¸­ï¼Œæ²¡æœ‰ä»»ä½•çš„æ¨¡å‹æ•°æ®ï¼Œè¿™ä¸ªè¯·æ±‚å¿…é¡»è¦è‡ªå·±è®¡ç®—æ•°æ®ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211102210046054.png" alt="image-20211102210046054"></p>
<center>å›¾ 7.1ã€€æ¨¡å‹çš„å±æ€§æ˜¯ä»¥è¯·æ±‚å±æ€§çš„å½¢å¼å­˜æ”¾åœ¨è¯·æ±‚ä¸­çš„ï¼Œåœ¨é‡å®šå‘åæ— æ³•å­˜æ´»</center>

<p>æ˜¾ç„¶ï¼Œå¯¹äºé‡å®šå‘æ¥è¯´ï¼Œæ¨¡å‹å¹¶ä¸èƒ½ç”¨æ¥ä¼ é€’æ•°æ®ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿæœ‰ä¸€äº›å…¶ä»–æ–¹æ¡ˆï¼Œèƒ½å¤Ÿä»å‘èµ·é‡å®šå‘çš„æ–¹æ³•ä¼ é€’æ•°æ®ç»™å¤„ç†é‡å®šå‘æ–¹æ³•ä¸­ï¼š</p>
<ul>
<li>ä½¿ç”¨ URL æ¨¡æ¿ä»¥è·¯å¾„å˜é‡å’Œ/æˆ–æŸ¥è¯¢å‚æ•°çš„å½¢å¼ä¼ é€’æ•°æ®ï¼›</li>
<li>é€šè¿‡ flash å±æ€§å‘é€æ•°æ®ã€‚</li>
</ul>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ Spring å¦‚ä½•å¸®åŠ©æˆ‘ä»¬é€šè¿‡è·¯å¾„å˜é‡å’Œ <code>/</code> æˆ–æŸ¥è¯¢å‚æ•°çš„å½¢å¼ä¼ é€’æ•°æ®ã€‚</p>
<h4 id="é€šè¿‡-URL-æ¨¡æ¿è¿›è¡Œé‡å®šå‘"><a href="#é€šè¿‡-URL-æ¨¡æ¿è¿›è¡Œé‡å®šå‘" class="headerlink" title="é€šè¿‡ URL æ¨¡æ¿è¿›è¡Œé‡å®šå‘"></a>é€šè¿‡ URL æ¨¡æ¿è¿›è¡Œé‡å®šå‘</h4><p>é€šè¿‡è·¯å¾„å˜é‡å’ŒæŸ¥è¯¢å‚æ•°ä¼ é€’æ•°æ®çœ‹èµ·æ¥éå¸¸ç®€å•ã€‚ä¾‹å¦‚ï¼Œåœ¨ç¨‹åºæ¸…å• 5.19 ä¸­ï¼Œæˆ‘ä»¬ä»¥è·¯å¾„å˜é‡çš„å½¢å¼ä¼ é€’äº†æ–°åˆ›å»º Spitter çš„ usernameã€‚ä½†æ˜¯æŒ‰ç…§ç°åœ¨çš„å†™æ³•ï¼Œusername çš„å€¼æ˜¯ç›´æ¥è¿æ¥åˆ°é‡å®šå‘ String ä¸Šçš„ã€‚è¿™èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯è¿˜è¿œè¿œä¸èƒ½è¯´æ²¡æœ‰é—®é¢˜ã€‚å½“æ„å»º URL æˆ– SQL æŸ¥è¯¢è¯­å¥çš„æ—¶å€™ï¼Œä½¿ç”¨ String è¿æ¥æ˜¯å¾ˆå±é™©çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">&quot;redirect:/spitter/&#123;username&#125;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†è¿æ¥ String çš„æ–¹å¼æ¥æ„å»ºé‡å®šå‘ URLï¼ŒSpring è¿˜æä¾›äº†ä½¿ç”¨æ¨¡æ¿çš„æ–¹å¼æ¥å®šä¹‰é‡å®šå‘ URLã€‚ä¾‹å¦‚ï¼Œåœ¨ç¨‹åºæ¸…å• 5.19 ä¸­ï¼ŒprocessRegistration() æ–¹æ³•çš„æœ€åä¸€è¡Œå¯ä»¥æ”¹å†™ä¸ºå¦‚ä¸‹çš„å½¢å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/register&quot;, method=POST)</span>;<span class="function"><span class="keyword">public</span> String <span class="title">processRegistration</span><span class="params">(    Spitter spitter, Model model)</span> </span>&#123;  spitterRepository.save(spitter);    model.addAttribute(<span class="string">&quot;username&quot;</span>, spitter.getUsername());  <span class="keyword">return</span> <span class="string">&quot;redirect:/spitter/&#123;username&#125;&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œusername ä½œä¸ºå ä½ç¬¦å¡«å……åˆ°äº† URL æ¨¡æ¿ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿æ¥åˆ°é‡å®šå‘ String ä¸­ï¼Œæ‰€ä»¥ username ä¸­æ‰€æœ‰çš„ä¸å®‰å…¨å­—ç¬¦éƒ½ä¼šè¿›è¡Œè½¬ä¹‰ã€‚è¿™æ ·ä¼šæ›´åŠ å®‰å…¨ï¼Œè¿™é‡Œå…è®¸ç”¨æˆ·è¾“å…¥ä»»ä½•æƒ³è¦çš„å†…å®¹ä½œä¸º usernameï¼Œå¹¶ä¼šå°†å…¶é™„åŠ åˆ°è·¯å¾„ä¸Šã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæ¨¡å‹ä¸­æ‰€æœ‰å…¶ä»–çš„åŸå§‹ç±»å‹å€¼éƒ½å¯ä»¥æ·»åŠ åˆ° URL ä¸­ä½œä¸ºæŸ¥è¯¢å‚æ•°ã€‚ä½œä¸ºæ ·ä¾‹ï¼Œå‡è®¾é™¤äº† username ä»¥å¤–ï¼Œæ¨¡å‹ä¸­è¿˜è¦åŒ…å«æ–°åˆ›å»º Spitter å¯¹è±¡çš„ id å±æ€§ï¼Œé‚£ processRegistration() æ–¹æ³•å¯ä»¥æ”¹å†™ä¸ºå¦‚ä¸‹çš„å½¢å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/register&quot;, method=POST)</span><span class="function"><span class="keyword">public</span> String <span class="title">processRegistration</span><span class="params">(    Spitter spitter, Model model)</span> </span>&#123;  spitterRepository.save(spitter);  model.addAttribute(<span class="string">&quot;username&quot;</span>, spitter.getUsername());  model.addAttribute(<span class="string">&quot;spitterId&quot;</span>, spitter.getId());  <span class="keyword">return</span> <span class="string">&quot;redirect:/spitter/&#123;username&#125;&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€è¿”å›çš„é‡å®šå‘ String å¹¶æ²¡æœ‰å¤ªå¤§çš„å˜åŒ–ã€‚ä½†æ˜¯ï¼Œå› ä¸ºæ¨¡å‹ä¸­çš„ spitterId å±æ€§æ²¡æœ‰åŒ¹é…é‡å®šå‘ URL ä¸­çš„ä»»ä½•å ä½ç¬¦ï¼Œæ‰€ä»¥å®ƒä¼šè‡ªåŠ¨ä»¥æŸ¥è¯¢å‚æ•°çš„å½¢å¼é™„åŠ åˆ°é‡å®šå‘ URL ä¸Šã€‚</p>
<p>å¦‚æœ username å±æ€§çš„å€¼æ˜¯ habuma å¹¶ä¸” spitterId å±æ€§çš„å€¼æ˜¯ 42ï¼Œé‚£ä¹ˆç»“æœå¾—åˆ°çš„é‡å®šå‘ URL è·¯å¾„å°†ä¼šæ˜¯ <code>/spitter/habuma?spitterId=42</code>ã€‚</p>
<p>é€šè¿‡è·¯å¾„å˜é‡å’ŒæŸ¥è¯¢å‚æ•°çš„å½¢å¼è·¨é‡å®šå‘ä¼ é€’æ•°æ®æ˜¯å¾ˆç®€å•ç›´æ¥çš„æ–¹å¼ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€å®šçš„é™åˆ¶ã€‚å®ƒåªèƒ½ç”¨æ¥å‘é€ç®€å•çš„å€¼ï¼Œå¦‚ String å’Œæ•°å­—çš„å€¼ã€‚åœ¨ URL ä¸­ï¼Œå¹¶æ²¡æœ‰åŠæ³•å‘é€æ›´ä¸ºå¤æ‚çš„å€¼ï¼Œä½†è¿™æ­£æ˜¯ flash å±æ€§èƒ½å¤Ÿæä¾›å¸®åŠ©çš„é¢†åŸŸã€‚</p>
<h4 id="ä½¿ç”¨-flash-å±æ€§"><a href="#ä½¿ç”¨-flash-å±æ€§" class="headerlink" title="ä½¿ç”¨ flash å±æ€§"></a>ä½¿ç”¨ flash å±æ€§</h4><p>å‡è®¾æˆ‘ä»¬ä¸æƒ³åœ¨é‡å®šå‘ä¸­å‘é€ username æˆ– ID äº†ï¼Œè€Œæ˜¯è¦å‘é€å®é™…çš„ Spitter å¯¹è±¡ã€‚å¦‚æœæˆ‘ä»¬åªå‘é€ ID çš„è¯ï¼Œé‚£ä¹ˆå¤„ç†é‡å®šå‘çš„æ–¹æ³•è¿˜éœ€è¦ä»æ•°æ®åº“ä¸­æŸ¥æ‰¾æ‰èƒ½å¾—åˆ° Spitter å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œåœ¨é‡å®šå‘ä¹‹å‰ï¼Œæˆ‘ä»¬å…¶å®å·²ç»å¾—åˆ°äº† Spitter å¯¹è±¡ã€‚ä¸ºä»€ä¹ˆä¸å°†å…¶å‘é€ç»™å¤„ç†é‡å®šå‘çš„æ–¹æ³•ï¼Œå¹¶å°†å…¶å±•ç°å‡ºæ¥å‘¢ï¼Ÿ</p>
<p>Spitter å¯¹è±¡è¦æ¯” String å’Œ int æ›´ä¸ºå¤æ‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½åƒè·¯å¾„å˜é‡æˆ–æŸ¥è¯¢å‚æ•°é‚£ä¹ˆå®¹æ˜“åœ°å‘é€ Spitter å¯¹è±¡ã€‚å®ƒåªèƒ½è®¾ç½®ä¸ºæ¨¡å‹ä¸­çš„å±æ€§ã€‚</p>
<p>ä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘ä»¬å‰é¢æ‰€è®¨è®ºçš„é‚£æ ·ï¼Œæ¨¡å‹æ•°æ®æœ€ç»ˆæ˜¯ä»¥è¯·æ±‚å‚æ•°çš„å½¢å¼å¤åˆ¶åˆ°è¯·æ±‚ä¸­çš„ï¼Œå½“é‡å®šå‘å‘ç”Ÿçš„æ—¶å€™ï¼Œè¿™äº›æ•°æ®å°±ä¼šä¸¢å¤±ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°† Spitter å¯¹è±¡æ”¾åˆ°ä¸€ä¸ªä½ç½®ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨é‡å®šå‘çš„è¿‡ç¨‹ä¸­å­˜æ´»ä¸‹æ¥ã€‚</p>
<p>æœ‰ä¸ªæ–¹æ¡ˆæ˜¯å°† Spitter æ”¾åˆ°ä¼šè¯ä¸­ã€‚ä¼šè¯èƒ½å¤Ÿé•¿æœŸå­˜åœ¨ï¼Œå¹¶ä¸”èƒ½å¤Ÿè·¨å¤šä¸ªè¯·æ±‚ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨é‡å®šå‘å‘ç”Ÿä¹‹å‰å°† Spitter æ”¾åˆ°ä¼šè¯ä¸­ï¼Œå¹¶åœ¨é‡å®šå‘åï¼Œä»ä¼šè¯ä¸­å°†å…¶å–å‡ºã€‚å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜è¦è´Ÿè´£åœ¨é‡å®šå‘ååœ¨ä¼šè¯ä¸­å°†å…¶æ¸…ç†æ‰ã€‚</p>
<p>å®é™…ä¸Šï¼ŒSpring ä¹Ÿè®¤ä¸ºå°†è·¨é‡å®šå‘å­˜æ´»çš„æ•°æ®æ”¾åˆ°ä¼šè¯ä¸­æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„æ–¹å¼ã€‚ä½†æ˜¯ï¼ŒSpring è®¤ä¸ºæˆ‘ä»¬å¹¶ä¸éœ€è¦ç®¡ç†è¿™äº›æ•°æ®ï¼Œç›¸åï¼ŒSpring æä¾›äº†å°†æ•°æ®å‘é€ä¸º flash å±æ€§ï¼ˆflash attributeï¼‰çš„åŠŸèƒ½ã€‚ æŒ‰ç…§å®šä¹‰ï¼Œflash å±æ€§ä¼šä¸€ç›´æºå¸¦è¿™äº›æ•°æ®ç›´åˆ°ä¸‹ä¸€æ¬¡è¯·æ±‚ï¼Œç„¶åæ‰ä¼šæ¶ˆå¤±ã€‚</p>
<p>Spring æä¾›äº†é€šè¿‡ RedirectAttributes è®¾ç½® flash å±æ€§çš„æ–¹æ³•ï¼Œè¿™æ˜¯ Spring 3.1 å¼•å…¥çš„ Model çš„ä¸€ä¸ªå­æ¥å£ã€‚RedirectAttributes æä¾›äº† Model çš„æ‰€æœ‰åŠŸèƒ½ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å‡ ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥è®¾ç½® flash å±æ€§çš„ã€‚ å…·ä½“æ¥è®²ï¼ŒRedirect-Attributes æä¾›äº†ä¸€ç»„ addFlashAttribute() æ–¹æ³•æ¥æ·»åŠ  flash å±æ€§ã€‚é‡æ–°çœ‹ä¸€ ä¸‹ processRegistration() æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ addFlashAttribute() å°† Spitter å¯¹è±¡æ·»åŠ åˆ°æ¨¡å‹ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/register&quot;, method=POST)</span><span class="function"><span class="keyword">public</span> String <span class="title">processRegistration</span><span class="params">(    Spitter spitter, RedirectAttribute model)</span> </span>&#123;  spitterRespository.save(spitter);  model.addAttribute(<span class="string">&quot;username&quot;</span>, spitter.getUsername());  model.addFlashAttribute(<span class="string">&quot;spitter&quot;</span>, spitter);  <span class="keyword">return</span> <span class="string">&quot;redirect:/spitter/&#123;username&#125;&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæˆ‘ä»¬ä¼ é€’äº†ä¸€ä¸ª Spitter å¯¹è±¡ç»™ addFlashAttribute() æ–¹æ³•ï¼Œæ‰€ä»¥æ¨æ–­å¾—åˆ°çš„ key å°†ä¼šæ˜¯ spitterã€‚</p>
<p>åœ¨é‡å®šå‘æ‰§è¡Œä¹‹å‰ï¼Œæ‰€æœ‰çš„ flash å±æ€§éƒ½ä¼šå¤åˆ¶åˆ°ä¼šè¯ä¸­ã€‚åœ¨é‡å®šå‘åï¼Œå­˜åœ¨ä¼šè¯ä¸­çš„ flash å±æ€§ä¼šè¢«å–å‡ºï¼Œå¹¶ä»ä¼šè¯è½¬ç§»åˆ°æ¨¡å‹ä¹‹ä¸­ã€‚å¤„ç†é‡å®šå‘çš„æ–¹æ³•å°±èƒ½ä»æ¨¡å‹ä¸­è®¿é—® Spitter å¯¹è±¡äº†ï¼Œå°±åƒè·å–å…¶ä»–çš„æ¨¡å‹å¯¹è±¡ä¸€æ ·ã€‚å›¾ 7.2 é˜è¿°äº†å®ƒæ˜¯å¦‚ä½•è¿è¡Œçš„ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211102210830105.png" alt="image-20211102210830105"></p>
<center>å›¾ 7.2ã€€flash å±æ€§ä¿å­˜åœ¨ä¼šè¯ä¸­ï¼Œç„¶åå†æ”¾åˆ°æ¨¡å‹ä¸­ï¼Œå› æ­¤èƒ½å¤Ÿåœ¨é‡å®šå‘çš„è¿‡ç¨‹ä¸­å­˜æ´»</center>

<p>ä¸ºäº†å®Œæˆ flash å±æ€§çš„æµç¨‹ï¼Œå¦‚ä¸‹å±•ç°äº†æ›´æ–°ç‰ˆæœ¬çš„ showSpitterProfile() æ–¹æ³•ï¼Œåœ¨ä»æ•°æ®åº“ä¸­æŸ¥æ‰¾ä¹‹å‰ï¼Œå®ƒä¼šé¦–å…ˆä»æ¨¡å‹ä¸­æ£€æŸ¥ Spitter å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/&#123;username&#125;&quot;, method=GET)</span><span class="function"><span class="keyword">public</span> String <span class="title">showSpitterProfile</span><span class="params">(    <span class="meta">@PathVariable</span> String username, Model model)</span> </span>&#123;  <span class="keyword">if</span> (!model.containsAttribute(<span class="string">&quot;spitter&quot;</span>)) &#123;    model.addAttribute(spitterRepository.findByUsername(username));  &#125;  <span class="keyword">return</span> <span class="string">&quot;profile&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒshowSpitterProfile() æ–¹æ³•æ‰€åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯æ£€æŸ¥æ˜¯å¦å­˜æœ‰ key ä¸º spitter çš„ model å±æ€§ã€‚å¦‚æœæ¨¡å‹ä¸­åŒ…å« spitter å±æ€§ï¼Œé‚£å°±ä»€ä¹ˆéƒ½ä¸ç”¨åšäº†ã€‚è¿™é‡Œé¢åŒ…å«çš„ Spitter å¯¹è±¡å°†ä¼šä¼ é€’åˆ°è§†å›¾ä¸­è¿›è¡Œæ¸²æŸ“ã€‚ä½†æ˜¯å¦‚æœæ¨¡å‹ä¸­ä¸åŒ…å« spitter å±æ€§çš„è¯ï¼Œé‚£ä¹ˆ showSpitterProfile() å°†ä¼šä» Repository ä¸­æŸ¥æ‰¾ Spitterï¼Œå¹¶å°†å…¶å­˜æ”¾åˆ°æ¨¡å‹ä¸­ã€‚</p>
<h3 id="å°ç»“-6"><a href="#å°ç»“-6" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>åœ¨ Spring ä¸­ï¼Œæ€»æ˜¯ä¼šæœ‰ â€œè¿˜æ²¡æœ‰ç»“æŸâ€ çš„æ„Ÿè§‰ï¼šæ›´å¤šçš„ç‰¹æ€§ã€æ›´å¤šçš„é€‰æ‹©ä»¥åŠå®ç°å¼€å‘ç›®æ ‡çš„æ›´å¤šæ–¹å¼ã€‚Spring MVC æœ‰å¾ˆå¤šåŠŸèƒ½å’ŒæŠ€å·§ã€‚</p>
<p>å½“ç„¶ï¼ŒSpring MVC çš„ç¯å¢ƒæ­å»ºæ˜¯æœ‰å¤šç§å¯é€‰æ–¹æ¡ˆçš„ä¸€ä¸ªé¢†åŸŸã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆçœ‹äº†ä¸€ä¸‹æ­å»º Spring MVC ä¸­ DispatcherServlet å’Œ ContextLoaderListener çš„å¤šç§æ–¹å¼ã€‚æˆ‘ä»¬è¿˜çœ‹åˆ°äº†å¦‚ä½•è°ƒæ•´ DispatcherServlet çš„æ³¨å†ŒåŠŸèƒ½ä»¥åŠå¦‚ä½•æ³¨å†Œè‡ªå®šä¹‰çš„ Servlet å’Œ Filterã€‚å¦‚æœä½ éœ€è¦å°†åº”ç”¨éƒ¨ç½²åˆ°æ›´è€çš„åº”ç”¨æœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬è¿˜å¿«é€Ÿäº†è§£äº†å¦‚ä½•ä½¿ç”¨ web.xml å£°æ˜ DispatcherServlet å’Œ  ContextLoaderListenerã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬äº†è§£äº†å¦‚ä½•å¤„ç† Spring MVC æ§åˆ¶å™¨æ‰€æŠ›å‡ºçš„å¼‚å¸¸ã€‚å°½ç®¡å¸¦æœ‰ @RequestMapping æ³¨è§£çš„æ–¹æ³•å¯ä»¥åœ¨è‡ªèº«çš„ä»£ç ä¸­å¤„ç†å¼‚å¸¸ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†å¼‚å¸¸å¤„ç†çš„ä»£ç æŠ½å–åˆ°å•ç‹¬çš„æ–¹æ³•ä¸­ï¼Œé‚£ä¹ˆæ§åˆ¶å™¨çš„ä»£ç ä¼šæ•´æ´å¾—å¤šã€‚</p>
<p>ä¸ºäº†é‡‡ç”¨ä¸€è‡´çš„æ–¹å¼å¤„ç†é€šç”¨çš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬åœ¨åº”ç”¨çš„æ‰€æœ‰æ§åˆ¶å™¨ä¸­å¤„ç†å¼‚å¸¸ï¼ŒSpring 3.2 å¼•å…¥äº† @ControllerAdviceï¼Œå®ƒæ‰€åˆ›å»ºçš„ç±»èƒ½å¤Ÿå°†æ§åˆ¶å™¨çš„é€šç”¨è¡Œä¸ºæŠ½å–åˆ°åŒä¸€ä¸ªåœ°æ–¹ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬çœ‹äº†ä¸€ä¸‹å¦‚ä½•è·¨é‡å®šå‘ä¼ é€’æ•°æ®ï¼ŒåŒ…æ‹¬ Spring å¯¹ flash å±æ€§çš„æ”¯æŒï¼šç±»ä¼¼äºæ¨¡å‹çš„å±æ€§ï¼Œä½†æ˜¯èƒ½åœ¨é‡å®šå‘åå­˜æ´»ä¸‹æ¥ã€‚è¿™æ ·çš„è¯ï¼Œå°±èƒ½é‡‡ç”¨éå¸¸æ°å½“çš„æ–¹å¼ä¸º POST è¯·æ±‚æ‰§è¡Œä¸€ä¸ªé‡å®šå‘å›åº”ï¼Œè€Œä¸”èƒ½å¤Ÿå°†å¤„ç† POST è¯·æ±‚æ—¶çš„æ¨¡å‹æ•°æ®ä¼ é€’è¿‡æ¥ï¼Œç„¶ååœ¨é‡å®šå‘åä½¿ç”¨æˆ–å±•ç°è¿™äº›æ¨¡å‹æ•°æ®ã€‚</p>
<p>å¦‚æœä½ è¿˜æœ‰ç–‘æƒ‘çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥å‘Šè¯‰ä½ ï¼Œè¿™å°±æ˜¯æˆ‘æ‰€è¯´çš„â€œæ›´å¤šçš„åŠŸèƒ½â€ï¼å…¶å®ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰è®¨è®ºåˆ° Spring MVC çš„æ¯ä¸ªæ–¹é¢ã€‚æˆ‘ä»¬å°†ä¼šåœ¨ç¬¬ 16 ç« ä¸­é‡æ–°è®¨è®º Spring MVCï¼Œåˆ°æ—¶ä½ ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨å®ƒæ¥åˆ›å»º REST APIã€‚</p>
<p>ä½†ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä¼šæš‚æ—¶æ”¾ä¸‹ Spring MVCï¼Œçœ‹ä¸€ä¸‹ Spring Web Flowï¼Œè¿™æ˜¯ä¸€ä¸ªæ„å»ºåœ¨ Spring MVC ä¹‹ä¸Šçš„æµç¨‹æ¡†æ¶ï¼Œå®ƒèƒ½å¤Ÿå¼•å¯¼ç”¨æˆ·æ‰§è¡Œä¸€ç³»åˆ—å‘å¯¼æ­¥éª¤ã€‚</p>
<h2 id="ä½¿ç”¨Spring-Web-Flow"><a href="#ä½¿ç”¨Spring-Web-Flow" class="headerlink" title="ä½¿ç”¨Spring Web Flow"></a>ä½¿ç”¨Spring Web Flow</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li><p>åˆ›å»ºä¼šè¯å¼çš„ Web åº”ç”¨ç¨‹åº</p>
</li>
<li><p>å®šä¹‰æµç¨‹çŠ¶æ€å’Œè¡Œä¸º</p>
</li>
<li><p>ä¿æŠ¤ Web æµç¨‹</p>
</li>
</ul>
<p>å…³äºäº’è”ç½‘ï¼Œå¾ˆå¥‡å¦™çš„ä¸€ä»¶äº‹å°±æ˜¯å®ƒå¾ˆå®¹æ˜“è®©ä½ è¿·å¤±ã€‚æœ‰å¦‚æ­¤ä¹‹å¤šçš„å†…å®¹å¯ä»¥æŸ¥çœ‹å’Œé˜…è¯»ï¼Œè€Œè¶…é“¾æ¥æ˜¯äº’è”ç½‘å¼ºå¤§é­”åŠ›çš„æ ¸å¿ƒã€‚æ— æ€ªä¹å°†å…¶ç§°ä¸ºç½‘ï¼Œæ­£å¦‚èœ˜è››ç»‡å‡ºçš„ç½‘ï¼Œå®ƒä¼šå°†ç»è¿‡çš„ä»»ä½•ä¸œè¥¿å›°ä½ã€‚æˆ‘å¿…é¡»æ‰¿è®¤ï¼šä¹‹æ‰€ä»¥åœ¨ç¼–å†™æ­¤ä¹¦æ—¶èŠ±è´¹äº†å¦‚æ­¤å¤šçš„æ—¶é—´ï¼Œå…¶ä¸­çš„ä¸€ä¸ªåŸå› å°±æ˜¯æˆ‘æ›¾ç»è¿·å¤±åœ¨ç»´åŸºç™¾ç§‘æ— ä¼‘æ— æ­¢çš„é“¾æ¥ä¹‹ä¸­ã€‚</p>
<p>æœ‰æ—¶å€™ï¼ŒWebåº”ç”¨ç¨‹åºéœ€è¦æ§åˆ¶ç½‘ç»œå†²æµªè€…çš„æ–¹å‘ï¼Œå¼•å¯¼ä»–ä»¬ä¸€æ­¥æ­¥åœ°è®¿é—®åº”ç”¨ã€‚æ¯”è¾ƒå…¸å‹çš„ä¾‹å­å°±æ˜¯ç”µå­å•†åŠ¡ç«™ç‚¹çš„ç»“è´¦æµç¨‹ï¼Œä»è´­ç‰©è½¦å¼€å§‹ï¼Œåº”ç”¨ç¨‹åºä¼šå¼•å¯¼ä½ ä¾æ¬¡ç»è¿‡æ´¾é€è¯¦æƒ…ã€è´¦å•ä¿¡æ¯ä»¥åŠæœ€ç»ˆçš„è®¢å•ç¡®è®¤æµç¨‹ã€‚</p>
<p>Spring Web Flow æ˜¯ä¸€ä¸ª Web æ¡†æ¶ï¼Œå®ƒé€‚ç”¨äºå…ƒç´ æŒ‰è§„å®šæµç¨‹è¿è¡Œçš„ç¨‹åºã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šæ¢ç´¢ Spring Web Flow å¹¶äº†è§£å®ƒå¦‚ä½•åº”ç”¨äº Spring Web æ¡†æ¶å¹³å°ã€‚</p>
<p>å…¶å®æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½• Web æ¡†æ¶ç¼–å†™æµç¨‹åŒ–çš„åº”ç”¨ç¨‹åºã€‚æˆ‘æ›¾ç»çœ‹åˆ°è¿‡ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œåœ¨ Struts ä¸­æ„å»ºäº†ç‰¹å®šçš„æµç¨‹ã€‚ä½†æ˜¯è¿™æ ·å°±æ²¡æœ‰åŠæ³•å°†æµç¨‹ä¸å®ç°åˆ†å¼€äº†ï¼Œä½ ä¼šå‘ç°æµç¨‹çš„å®šä¹‰åˆ†æ•£åœ¨ç»„æˆæµç¨‹çš„å„ä¸ªå…ƒç´ ä¸­ã€‚æ²¡æœ‰åœ°æ–¹èƒ½å¤Ÿå®Œæ•´åœ°æè¿°æ•´ä¸ªæµç¨‹ã€‚</p>
<p>Spring Web Flow æ˜¯ Spring MVC çš„æ‰©å±•ï¼Œå®ƒæ”¯æŒå¼€å‘åŸºäºæµç¨‹çš„åº”ç”¨ç¨‹åºã€‚å®ƒå°†æµç¨‹çš„å®šä¹‰ä¸å®ç°æµç¨‹è¡Œä¸ºçš„ç±»å’Œè§†å›¾åˆ†ç¦»å¼€æ¥ã€‚</p>
<p>åœ¨ä»‹ç» Spring Web Flow çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†æš‚æ—¶æ”¾ä¸‹ Spittr æ ·ä¾‹å¹¶ä½¿ç”¨ç”ŸæˆæŠ«è¨è®¢å•çš„æ–° Web åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬ä¼šä½¿ç”¨ Spring Web Flow æ¥å®šä¹‰è®¢å•æµç¨‹ã€‚</p>
<p>ä½¿ç”¨ Spring Web Flow çš„ç¬¬ä¸€æ­¥æ˜¯åœ¨é¡¹ç›®ä¸­å®‰è£…å®ƒã€‚è®©æˆ‘ä»¬ä»è¿™é‡Œå¼€å§‹å§ã€‚</p>
<h3 id="åœ¨-Spring-ä¸­é…ç½®-Web-Flow"><a href="#åœ¨-Spring-ä¸­é…ç½®-Web-Flow" class="headerlink" title="åœ¨  Spring  ä¸­é…ç½®  Web Flow"></a>åœ¨  Spring  ä¸­é…ç½®  Web Flow</h3><p>Spring Web Flow æ˜¯æ„å»ºäº Spring MVC åŸºç¡€ä¹‹ä¸Šçš„ã€‚è¿™æ„å‘³ç€æ‰€æœ‰çš„æµç¨‹è¯·æ±‚éƒ½éœ€è¦é¦–å…ˆç»è¿‡ Spring MVC çš„ DispatcherServletã€‚æˆ‘ä»¬éœ€è¦åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­é…ç½®ä¸€äº› bean æ¥å¤„ç†æµç¨‹è¯·æ±‚å¹¶æ‰§è¡Œæµç¨‹ã€‚</p>
<p>ç°åœ¨ï¼Œè¿˜ä¸æ”¯æŒåœ¨ Java ä¸­é…ç½® Spring Web Flowï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ«æ— é€‰æ‹©ï¼Œåªèƒ½åœ¨ XML ä¸­å¯¹å…¶è¿›è¡Œé…ç½®ã€‚æœ‰ä¸€äº› bean ä¼šä½¿ç”¨ Spring Web Flow çš„ Spring é…ç½®æ–‡ä»¶å‘½åç©ºé—´æ¥è¿›è¡Œå£°æ˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸Šä¸‹æ–‡å®šä¹‰XMLæ–‡ä»¶ä¸­æ·»åŠ è¿™ä¸ªå‘½åç©ºé—´å£°æ˜ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:flow</span>=<span class="string">&quot;http://www.springframework.org/schema/webflow-config&quot;</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/webflow-config    http://www.springframework.org/schema/webflow-config/spring-webflow-config-2.3.xsd   http://www.springframework.org/schema/beans    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨å£°æ˜äº†å‘½åç©ºé—´ä¹‹åï¼Œæˆ‘ä»¬å°±ä¸ºè£…é… Web Flow çš„ bean åšå¥½äº†å‡†å¤‡ï¼Œè®©æˆ‘ä»¬ä»æµç¨‹æ‰§è¡Œå™¨ï¼ˆflow executorï¼‰å¼€å§‹å§ã€‚</p>
<h4 id="è£…é…æµç¨‹æ‰§è¡Œå™¨"><a href="#è£…é…æµç¨‹æ‰§è¡Œå™¨" class="headerlink" title="è£…é…æµç¨‹æ‰§è¡Œå™¨"></a>è£…é…æµç¨‹æ‰§è¡Œå™¨</h4><p>æ­£å¦‚å…¶åå­—æ‰€ç¤ºï¼Œæµç¨‹æ‰§è¡Œå™¨ï¼ˆflow executorï¼‰é©±åŠ¨æµç¨‹çš„æ‰§è¡Œã€‚å½“ç”¨æˆ·è¿›å…¥ä¸€ä¸ªæµç¨‹æ—¶ï¼Œæµç¨‹æ‰§è¡Œå™¨ä¼šä¸ºç”¨æˆ·åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªæµç¨‹æ‰§è¡Œå®ä¾‹ã€‚å½“æµç¨‹æš‚åœçš„æ—¶å€™ï¼ˆå¦‚ä¸ºç”¨æˆ·å±•ç¤ºè§†å›¾æ—¶ï¼‰ï¼Œæµç¨‹æ‰§è¡Œå™¨ä¼šåœ¨ç”¨æˆ·æ‰§è¡Œæ“ä½œåæ¢å¤æµç¨‹ã€‚</p>
<p>åœ¨ Spring ä¸­ï¼Œ<code>&lt;flow:flow-executor&gt;</code>å…ƒç´ ä¼šåˆ›å»ºä¸€ä¸ªæµç¨‹æ‰§è¡Œå™¨ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">flow:flow-executor</span> <span class="attr">id</span>=<span class="string">&quot;flowExecutor&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>å°½ç®¡æµç¨‹æ‰§è¡Œå™¨è´Ÿè´£åˆ›å»ºå’Œæ‰§è¡Œæµç¨‹ï¼Œä½†å®ƒå¹¶ä¸è´Ÿè´£åŠ è½½æµç¨‹å®šä¹‰ã€‚è¿™ä¸ªè´£ä»»è½åœ¨äº†æµç¨‹æ³¨å†Œè¡¨ï¼ˆflow registryï¼‰èº«ä¸Šï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šåˆ›å»ºå®ƒã€‚</p>
<h4 id="é…ç½®æµç¨‹æ³¨å†Œè¡¨"><a href="#é…ç½®æµç¨‹æ³¨å†Œè¡¨" class="headerlink" title="é…ç½®æµç¨‹æ³¨å†Œè¡¨"></a>é…ç½®æµç¨‹æ³¨å†Œè¡¨</h4><p>æµç¨‹æ³¨å†Œè¡¨ï¼ˆflow registryï¼‰çš„å·¥ä½œæ˜¯åŠ è½½æµç¨‹å®šä¹‰å¹¶è®©æµç¨‹æ‰§è¡Œå™¨èƒ½å¤Ÿä½¿ç”¨å®ƒä»¬ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ Spring ä¸­ä½¿ç”¨ <code>&lt;flow:flow-registry&gt;</code> é…ç½®æµç¨‹æ³¨å†Œè¡¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">flow:flow-registry</span> <span class="attr">id</span>=<span class="string">&quot;flowRegistry&quot;</span> <span class="attr">base-path</span>=<span class="string">&quot;/WEB-INF/flows&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">flow:flow-location-pattern</span> <span class="attr">value</span>=<span class="string">&quot;*-flow.xml&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">flow:flow-registry</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œçš„å£°æ˜ä¸­ï¼Œæµç¨‹æ³¨å†Œè¡¨ä¼šåœ¨ <code>/WEB-INF/flows</code> ç›®å½•ä¸‹æŸ¥æ‰¾æµç¨‹å®šä¹‰ï¼Œè¿™æ˜¯é€šè¿‡ base-path å±æ€§æŒ‡æ˜çš„ã€‚ä¾æ® <code>&lt;flow:flow-location-pattern&gt;</code> å…ƒç´ çš„å€¼ï¼Œä»»ä½•æ–‡ä»¶åä»¥ <code>-flow.xml</code> ç»“å°¾çš„ XML æ–‡ä»¶éƒ½å°†è§†ä¸ºæµç¨‹å®šä¹‰ã€‚</p>
<p>æ‰€æœ‰çš„æµç¨‹éƒ½æ˜¯é€šè¿‡å…¶ ID æ¥è¿›è¡Œå¼•ç”¨çš„ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† <code>&lt;flow:flow-location-pattern&gt;</code> å…ƒç´ ï¼Œæµç¨‹çš„ ID å°±æ˜¯ç›¸å¯¹äº base-path çš„è·¯å¾„ â€”â€” æˆ–è€…åŒæ˜Ÿå·æ‰€ä»£è¡¨çš„è·¯å¾„ã€‚å›¾ 8.1 å±•ç¤ºäº†ç¤ºä¾‹ä¸­çš„æµç¨‹ ID æ˜¯å¦‚ä½•è®¡ç®—çš„ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211103203654783.png" alt="image-20211103203654783"></p>
<center>å›¾ 8.1ã€€åœ¨ä½¿ç”¨æµç¨‹å®šä½æ¨¡å¼çš„æ—¶å€™ï¼Œæµç¨‹å®šä¹‰æ–‡ä»¶ç›¸å¯¹äºåŸºæœ¬è·¯å¾„çš„è·¯å¾„å°†è¢«ç”¨ä½œæµç¨‹çš„ ID</center>

<p>ä½œä¸ºå¦ä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å»é™¤ <code>base-path</code> å±æ€§ï¼Œè€Œæ˜¾å¼å£°æ˜æµç¨‹å®šä¹‰æ–‡ä»¶çš„ä½ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">flow:flow-registry</span> <span class="attr">id</span>=<span class="string">&quot;flowRegistry&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">flow:flow-location</span> <span class="attr">path</span>=<span class="string">&quot;/WEB-INF/flows/springpizza.xml&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">flow:flow-registry</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œä½¿ç”¨äº† <code>&lt;flow:flow-location&gt;</code> è€Œä¸æ˜¯ <code>&lt;flow:flow-location-pattern/&gt;</code>ï¼Œpath å±æ€§ç›´æ¥æŒ‡æ˜äº† <code>/WEB-INF/flows/springpizza.xml</code> ä½œä¸ºæµç¨‹å®šä¹‰ã€‚å½“æˆ‘ä»¬è¿™æ ·é…ç½®çš„è¯ï¼Œæµç¨‹çš„ ID æ˜¯ä»æµç¨‹å®šä¹‰æ–‡ä»¶çš„æ–‡ä»¶åä¸­è·å¾—çš„ï¼Œåœ¨è¿™é‡Œå°±æ˜¯ springpizzaã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›æ›´æ˜¾å¼åœ°æŒ‡å®šæµç¨‹ IDï¼Œé‚£ä½ å¯ä»¥é€šè¿‡å…ƒç´ çš„ id å±æ€§æ¥è¿›è¡Œè®¾ç½®ã€‚ä¾‹å¦‚ï¼Œè¦å°† pizza ä½œä¸ºæµç¨‹ IDï¼Œå¯ä»¥åƒè¿™æ ·é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">flow:flow-registry</span> <span class="attr">id</span>=<span class="string">&quot;flowRegistry&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">flow:flow-location</span> <span class="attr">id</span>=<span class="string">&quot;pizza&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/WEB-INF/flows/springpizza.xml&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">flow:flow-registry</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="å¤„ç†æµç¨‹è¯·æ±‚"><a href="#å¤„ç†æµç¨‹è¯·æ±‚" class="headerlink" title="å¤„ç†æµç¨‹è¯·æ±‚"></a>å¤„ç†æµç¨‹è¯·æ±‚</h4><p>æˆ‘ä»¬åœ¨å‰ä¸€ç« æ›¾ç»çœ‹åˆ°ï¼ŒDispatcherServlet ä¸€èˆ¬å°†è¯·æ±‚åˆ†å‘ç»™æ§åˆ¶å™¨ã€‚ä½†æ˜¯å¯¹äºæµç¨‹è€Œè¨€ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª FlowHandlerMapping æ¥å¸®åŠ© DispatcherServlet å°†æµç¨‹è¯·æ±‚å‘é€ç»™ Spring Web Flowã€‚</p>
<p>åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼ŒFlowHandlerMapping çš„é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.webflow.mvc.servlet.FlowHandlerMapping&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;flowRegistry&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;flowRegistry&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥çœ‹åˆ°ï¼ŒFlowHandlerMapping è£…é…äº†æµç¨‹æ³¨å†Œè¡¨çš„å¼•ç”¨ï¼Œè¿™æ ·å®ƒå°±èƒ½çŸ¥é“å¦‚ä½•å°†è¯·æ±‚çš„ URL åŒ¹é…åˆ°æµç¨‹ä¸Šã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ª ID ä¸º pizza çš„æµç¨‹ï¼Œ FlowHandlerMapping å°±ä¼šçŸ¥é“å¦‚æœè¯·æ±‚çš„ URL æ¨¡å¼ï¼ˆç›¸å¯¹äºåº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡è·¯å¾„ï¼‰æ˜¯ â€œ/pizzaâ€ çš„è¯ï¼Œå°±è¦å°†å…¶åŒ¹é…åˆ°è¿™ä¸ªæµç¨‹ä¸Šã€‚</p>
<p>ç„¶è€Œï¼ŒFlowHandlerMapping çš„å·¥ä½œä»…ä»…æ˜¯å°†æµç¨‹è¯·æ±‚å®šå‘åˆ° Spring Web Flow ä¸Šï¼Œå“åº”è¯·æ±‚çš„æ˜¯ FlowHandlerAdapterã€‚FlowHandlerAdapter ç­‰åŒäº Spring MVC çš„æ§åˆ¶å™¨ï¼Œå®ƒä¼šå“åº”å‘é€çš„æµç¨‹è¯·æ±‚å¹¶å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚FlowHandlerAdapter å¯ä»¥åƒä¸‹é¢è¿™æ ·è£…é…æˆä¸€ä¸ª Spring beanï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.webflow.mvc.servlet.FlowHandlerAdapter&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;flowExecutor&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;flowExecutor&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå¤„ç†é€‚é…å™¨æ˜¯ DispatcherServlet å’Œ Spring Web Flow ä¹‹é—´çš„æ¡¥æ¢ã€‚å®ƒä¼šå¤„ç†æµç¨‹è¯·æ±‚å¹¶ç®¡ç†åŸºäºè¿™äº›è¯·æ±‚çš„æµç¨‹ã€‚åœ¨è¿™é‡Œï¼Œå®ƒè£…é…äº†æµç¨‹æ‰§è¡Œå™¨çš„å¼•ç”¨ï¼Œè€Œåè€…æ˜¯ä¸ºæ‰€å¤„ç†çš„è¯·æ±‚æ‰§è¡Œæµç¨‹çš„ã€‚</p>
<p>æˆ‘ä»¬å·²ç»é…ç½®äº† Spring Web Flow æ‰€éœ€çš„ bean å’Œç»„ä»¶ã€‚å‰©ä¸‹å°±æ˜¯çœŸæ­£å®šä¹‰æµç¨‹äº†ã€‚æˆ‘ä»¬éšåå°†ä¼šè¿›è¡Œè¿™é¡¹å·¥ä½œã€‚ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ç»„æˆæµç¨‹çš„å…ƒç´ ã€‚</p>
<h3 id="æµç¨‹çš„ç»„ä»¶"><a href="#æµç¨‹çš„ç»„ä»¶" class="headerlink" title="æµç¨‹çš„ç»„ä»¶"></a>æµç¨‹çš„ç»„ä»¶</h3><p>åœ¨ Spring Web Flow ä¸­ï¼Œæµç¨‹æ˜¯ç”±ä¸‰ä¸ªä¸»è¦å…ƒç´ å®šä¹‰çš„ï¼šçŠ¶æ€ã€è½¬ç§»å’Œæµç¨‹æ•°æ®ã€‚çŠ¶æ€ï¼ˆStateï¼‰æ˜¯æµç¨‹ä¸­äº‹ä»¶å‘ç”Ÿçš„åœ°ç‚¹ã€‚å¦‚æœä½ å°†æµç¨‹æƒ³è±¡æˆå…¬è·¯æ—…è¡Œï¼Œé‚£çŠ¶æ€å°±æ˜¯è·¯é€”ä¸Šçš„åŸé•‡ã€è·¯è¾¹é¥­åº—ä»¥åŠé£æ™¯ç‚¹ã€‚æµç¨‹ä¸­çš„çŠ¶æ€æ˜¯ä¸šåŠ¡é€»è¾‘æ‰§è¡Œã€åšå‡ºå†³ç­–æˆ–å°†é¡µé¢å±•ç°ç»™ç”¨æˆ·çš„åœ°æ–¹ï¼Œè€Œä¸æ˜¯åœ¨å…¬è·¯æ—…è¡Œä¸­ä¹° Doritos è–¯ç‰‡å’Œå¥æ€¡å¯ä¹çš„æ‰€åœ¨ã€‚</p>
<p>å¦‚æœæµç¨‹çŠ¶æ€å°±åƒå…¬è·¯æ—…è¡Œä¸­åœä¸‹æ¥çš„åœ°ç‚¹ï¼Œé‚£è½¬ç§»ï¼ˆtransitionï¼‰å°±æ˜¯è¿æ¥è¿™äº›ç‚¹çš„å…¬è·¯ã€‚åœ¨æµç¨‹ä¸­ï¼Œä½ é€šè¿‡è½¬ç§»çš„æ–¹å¼ä»ä¸€ä¸ªçŠ¶æ€åˆ°å¦ä¸€ä¸ªçŠ¶æ€ã€‚</p>
<p>å½“ä½ åœ¨åŸé•‡ä¹‹é—´æ—…è¡Œçš„æ—¶å€™ï¼Œä½ å¯èƒ½è¦ä¹°ä¸€äº›çºªå¿µå“ï¼Œç•™ä¸‹ä¸€äº›è®°å¿†å¹¶åœ¨è·¯ä¸Šå–ä¸€äº›ç©ºçš„é›¶é£Ÿè¢‹ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨æµç¨‹å¤„ç†ä¸­ï¼Œå®ƒè¦æ”¶é›†ä¸€äº›æ•°æ®ï¼šæµç¨‹çš„å½“å‰çŠ¶å†µã€‚æˆ‘å¾ˆæƒ³å°†å…¶ç§°ä¸ºæµç¨‹çš„çŠ¶æ€ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬è®¨è®ºæµç¨‹çš„æ—¶å€™çŠ¶æ€ï¼ˆstateï¼‰å·²ç»æœ‰äº†å¦å¤–çš„å«ä¹‰ã€‚</p>
<p>è®©æˆ‘ä»¬ä»”ç»†çœ‹ä¸€ä¸‹åœ¨ Spring Web Flow ä¸­è¿™ä¸‰ä¸ªå…ƒç´ æ˜¯å¦‚ä½•å®šä¹‰çš„ã€‚</p>
<h4 id="çŠ¶æ€"><a href="#çŠ¶æ€" class="headerlink" title="çŠ¶æ€"></a>çŠ¶æ€</h4><p>Spring Web Flow å®šä¹‰äº†äº”ç§ä¸åŒç±»å‹çš„çŠ¶æ€ï¼Œå¦‚è¡¨ 8.1 æ‰€ç¤ºã€‚é€šè¿‡é€‰æ‹© Spring Web Flow çš„çŠ¶æ€å‡ ä¹å¯ä»¥æŠŠä»»æ„çš„å®‰æ’åŠŸèƒ½æ„é€ æˆä¼šè¯å¼çš„ Web åº”ç”¨ã€‚å°½ç®¡å¹¶ä¸æ˜¯æ‰€æœ‰çš„æµç¨‹éƒ½éœ€è¦è¡¨ 8.1 æ‰€æè¿°çš„çŠ¶æ€ï¼Œä½†æœ€ç»ˆä½ å¯èƒ½ä¼šç»å¸¸ä½¿ç”¨å®ƒä»¬ä¸­çš„å¤§å¤šæ•°ã€‚</p>
<center>è¡¨ 8.1ã€€Spring Web Flow å¯ä¾›é€‰æ‹©çš„çŠ¶æ€</center>

<table>
<thead>
<tr>
<th>çŠ¶ æ€ ç±» å‹</th>
<th>å®ƒæ˜¯ç”¨æ¥åšä»€ä¹ˆçš„</th>
</tr>
</thead>
<tbody><tr>
<td>è¡Œä¸ºï¼ˆActionï¼‰</td>
<td>è¡Œä¸ºçŠ¶æ€æ˜¯æµç¨‹é€»è¾‘å‘ç”Ÿçš„åœ°æ–¹</td>
</tr>
<tr>
<td>å†³ç­–ï¼ˆDecisionï¼‰</td>
<td>å†³ç­–çŠ¶æ€å°†æµç¨‹åˆ†æˆä¸¤ä¸ªæ–¹å‘ï¼Œå®ƒä¼šåŸºäºæµç¨‹æ•°æ®çš„è¯„ä¼°ç»“æœç¡®å®šæµç¨‹æ–¹å‘</td>
</tr>
<tr>
<td>ç»“æŸï¼ˆEndï¼‰</td>
<td>ç»“æŸçŠ¶æ€æ˜¯æµç¨‹çš„æœ€åä¸€ç«™ã€‚ä¸€æ—¦è¿›å…¥EndçŠ¶æ€ï¼Œæµç¨‹å°±ä¼šç»ˆæ­¢</td>
</tr>
<tr>
<td>å­æµç¨‹ï¼ˆSubflowï¼‰</td>
<td>å­æµç¨‹çŠ¶æ€ä¼šåœ¨å½“å‰æ­£åœ¨è¿è¡Œçš„æµç¨‹ä¸Šä¸‹æ–‡ä¸­å¯åŠ¨ä¸€ä¸ªæ–°çš„æµç¨‹</td>
</tr>
<tr>
<td>è§†å›¾ï¼ˆViewï¼‰</td>
<td>è§†å›¾çŠ¶æ€ä¼šæš‚åœæµç¨‹å¹¶é‚€è¯·ç”¨æˆ·å‚ä¸æµç¨‹</td>
</tr>
</tbody></table>
<p>ç¨åæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•å°†è¿™äº›ä¸åŒç±»å‹çš„çŠ¶æ€ç»„åˆèµ·æ¥å½¢æˆä¸€ä¸ªå®Œæ•´çš„æµç¨‹ã€‚ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹è¿™äº›æµç¨‹å…ƒç´ åœ¨ Spring Web Flow å®šä¹‰ä¸­æ˜¯å¦‚ä½•è¡¨ç°çš„ã€‚</p>
<p>è§†å›¾çŠ¶æ€</p>
<p>è§†å›¾çŠ¶æ€ç”¨äºä¸ºç”¨æˆ·å±•ç°ä¿¡æ¯å¹¶ä½¿ç”¨æˆ·åœ¨æµç¨‹ä¸­å‘æŒ¥ä½œç”¨ã€‚å®é™…çš„è§†å›¾å®ç°å¯ä»¥æ˜¯ Spring æ”¯æŒçš„ä»»æ„è§†å›¾ç±»å‹ï¼Œä½†é€šå¸¸æ˜¯ç”¨ JSP æ¥å®ç°çš„ã€‚</p>
<p>åœ¨æµç¨‹å®šä¹‰çš„ XML æ–‡ä»¶ä¸­ï¼Œ<code>&lt;view-state&gt;</code> ç”¨äºå®šä¹‰è§†å›¾çŠ¶æ€ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view-state</span> <span class="attr">id</span>=<span class="string">&quot;welcome&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ä¸­ï¼Œid å±æ€§æœ‰ä¸¤ä¸ªå«ä¹‰ã€‚å®ƒåœ¨æµç¨‹å†…æ ‡ç¤ºè¿™ä¸ªçŠ¶æ€ã€‚é™¤æ­¤ä»¥å¤–ï¼Œå› ä¸ºåœ¨è¿™é‡Œæ²¡æœ‰åœ¨å…¶ä»–åœ°æ–¹æŒ‡å®šè§†å›¾ï¼Œæ‰€ä»¥å®ƒä¹ŸæŒ‡å®šäº†æµç¨‹åˆ°è¾¾è¿™ä¸ªçŠ¶æ€æ—¶è¦å±•ç°çš„é€»è¾‘è§†å›¾åä¸º welcomeã€‚</p>
<p>å¦‚æœä½ æ„¿æ„æ˜¾å¼æŒ‡å®šå¦å¤–ä¸€ä¸ªè§†å›¾åï¼Œé‚£å¯ä»¥ä½¿ç”¨ view å±æ€§åšåˆ°è¿™ä¸€ç‚¹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view-state</span> <span class="attr">id</span>=<span class="string">&quot;welcome&quot;</span> <span class="attr">view</span>=<span class="string">&quot;greeting&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæµç¨‹ä¸ºç”¨æˆ·å±•ç°äº†ä¸€ä¸ªè¡¨å•ï¼Œä½ å¯èƒ½å¸Œæœ›æŒ‡æ˜è¡¨å•æ‰€ç»‘å®šçš„å¯¹è±¡ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¯ä»¥è®¾ç½® model å±æ€§ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view-state</span> <span class="attr">id</span>=<span class="string">&quot;takepayment&quot;</span> <span class="attr">model</span>=<span class="string">&quot;flowScope.paymentDetails&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬æŒ‡å®š takePayment è§†å›¾ä¸­çš„è¡¨å•å°†ç»‘å®šæµç¨‹ä½œç”¨åŸŸå†…çš„ paymentDetails å¯¹è±¡ã€‚ï¼ˆç¨åï¼Œæˆ‘ä»¬å°†ä¼šæ›´è¯¦ç»†åœ°ä»‹ç»æµç¨‹ä½œç”¨åŸŸå’Œæ•°æ®ã€‚ï¼‰</p>
<p>è¡Œä¸ºçŠ¶æ€</p>
<p>è§†å›¾çŠ¶æ€ä¼šæ¶‰åŠåˆ°æµç¨‹åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ï¼Œè€Œè¡Œä¸ºçŠ¶æ€åˆ™æ˜¯åº”ç”¨ç¨‹åºè‡ªèº«åœ¨æ‰§è¡Œä»»åŠ¡ã€‚è¡Œä¸ºçŠ¶æ€ä¸€èˆ¬ä¼šè§¦å‘ Spring æ‰€ç®¡ç† bean çš„ä¸€äº›æ–¹æ³•å¹¶æ ¹æ®æ–¹æ³•è°ƒç”¨çš„æ‰§è¡Œç»“æœè½¬ç§»åˆ°å¦ä¸€ä¸ªçŠ¶æ€ã€‚</p>
<p>åœ¨æµç¨‹å®šä¹‰ XML ä¸­ï¼Œè¡Œä¸ºçŠ¶æ€ä½¿ç”¨ <code>&lt;action-state&gt;</code> å…ƒç´ æ¥å£°æ˜ã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action-state</span> <span class="attr">id</span>=<span class="string">&quot;saveOrder&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">evaluate</span> <span class="attr">expression</span>=<span class="string">&quot;pizzaFlowActions.saveOrder(order)&quot;</span> /&gt;</span>  <span class="tag">&lt;<span class="name">transition</span> <span class="attr">to</span>=<span class="string">&quot;thankYou&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">action-state</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å°½ç®¡ä¸æ˜¯ä¸¥æ ¼éœ€è¦çš„ï¼Œä½†æ˜¯ <code>&lt;action-state&gt;</code> å…ƒç´ ä¸€èˆ¬éƒ½ä¼šæœ‰ä¸€ä¸ª <code>&lt;evaluate&gt;</code> ä½œä¸ºå­å…ƒç´ ã€‚<code>&lt;evaluate&gt;</code> å…ƒç´ ç»™å‡ºäº†è¡Œä¸ºçŠ¶æ€è¦åšçš„äº‹æƒ…ã€‚expression å±æ€§æŒ‡å®šäº†è¿›å…¥è¿™ä¸ªçŠ¶æ€æ—¶è¦è¯„ä¼°çš„è¡¨è¾¾å¼ã€‚åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œç»™å‡ºçš„ expression æ˜¯ SpEL è¡¨è¾¾å¼ï¼Œå®ƒè¡¨æ˜å°†ä¼šæ‰¾åˆ° ID ä¸º pizzaFlowActions çš„ bean å¹¶è°ƒç”¨å…¶ <code>saveOrder()</code> æ–¹æ³•ã€‚</p>
<p>Spring Web Flow ä¸è¡¨è¾¾å¼è¯­è¨€</p>
<p>åœ¨è¿™å‡ å¹´ä»¥æ¥ï¼ŒSpring Web Flow åœ¨é€‰æ‹©çš„è¡¨è¾¾å¼è¯­è¨€æ–¹é¢ï¼Œç»è¿‡äº†ä¸€äº›å˜åŒ–ã€‚åœ¨ 1.0 ç‰ˆæœ¬çš„æ—¶å€™ï¼ŒSpring Web Flow ä½¿ç”¨çš„æ˜¯å¯¹è±¡å›¾å¯¼èˆªè¯­è¨€ï¼ˆObject-Graph Navigation Language ï¼ŒOGNLï¼‰ã€‚éšåçš„ 2.0 ç‰ˆæœ¬åˆæ¢æˆäº†ç»Ÿä¸€è¡¨è¾¾å¼è¯­è¨€ï¼ˆUnified Expression Language ï¼ŒUnified ELï¼‰ã€‚åœ¨ 2.1 ç‰ˆæœ¬ä¸­ï¼ŒSpring Web Flow ä½¿ç”¨çš„æ˜¯ SpELã€‚</p>
<p>å°½ç®¡å¯ä»¥ä½¿ç”¨ä¸Šè¿°çš„ä»»æ„è¡¨è¾¾å¼è¯­è¨€æ¥é…ç½® Spring Web Flowï¼Œä½† SpEL æ˜¯é»˜è®¤å’Œæ¨èä½¿ç”¨çš„è¡¨è¾¾å¼è¯­è¨€ã€‚å› æ­¤ï¼Œå½“å®šä¹‰æµç¨‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©ä½¿ç”¨ SpELï¼Œå¿½ç•¥æ‰å…¶ä»–çš„å¯é€‰æ–¹æ¡ˆã€‚</p>
<p>å†³ç­–çŠ¶æ€</p>
<p>æœ‰å¯èƒ½æµç¨‹ä¼šå®Œå…¨æŒ‰ç…§çº¿æ€§æ‰§è¡Œï¼Œä»ä¸€ä¸ªçŠ¶æ€è¿›å…¥å¦ä¸€ä¸ªçŠ¶æ€ï¼Œæ²¡æœ‰å…¶ä»–çš„æ›¿ä»£è·¯çº¿ã€‚ä½†æ˜¯æ›´å¸¸è§çš„æƒ…å†µæ˜¯æµç¨‹åœ¨æŸä¸€ä¸ªç‚¹æ ¹æ®æµç¨‹çš„å½“å‰æƒ…å†µè¿›å…¥ä¸åŒçš„åˆ†æ”¯ã€‚</p>
<p>å†³ç­–çŠ¶æ€èƒ½å¤Ÿåœ¨æµç¨‹æ‰§è¡Œæ—¶äº§ç”Ÿä¸¤ä¸ªåˆ†æ”¯ã€‚å†³ç­–çŠ¶æ€å°†è¯„ä¼°ä¸€ä¸ª Boolean ç±»å‹çš„è¡¨è¾¾å¼ï¼Œç„¶ååœ¨ä¸¤ä¸ªçŠ¶æ€è½¬ç§»ä¸­é€‰æ‹©ä¸€ä¸ªï¼Œè¿™è¦å–å†³äºè¡¨è¾¾å¼ä¼šè®¡ç®—å‡º true è¿˜æ˜¯ falseã€‚åœ¨ XML æµç¨‹å®šä¹‰ä¸­ï¼Œå†³ç­–çŠ¶æ€é€šè¿‡ <code>&lt;decision-state&gt;</code> å…ƒç´ è¿›è¡Œå®šä¹‰ã€‚å…¸å‹çš„å†³ç­–çŠ¶æ€ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">decision-state</span> <span class="attr">id</span>=<span class="string">&quot;checkDeliveryArea&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;pizzaFlowActions.checkDeliveryArea(customer.zipCode)&quot;</span>      <span class="attr">then</span>=<span class="string">&quot;addCustomer&quot;</span>      <span class="attr">else</span>=<span class="string">&quot;deliveryWarning&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">decision-state</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œ<code>&lt;decision-state&gt;</code> å¹¶ä¸æ˜¯ç‹¬ç«‹å®Œæˆå·¥ä½œçš„ã€‚<code>&lt;if&gt;</code> å…ƒç´ æ˜¯å†³ç­–çŠ¶æ€çš„æ ¸å¿ƒã€‚è¿™æ˜¯è¡¨è¾¾å¼è¿›è¡Œè¯„ä¼°çš„åœ°æ–¹ï¼Œå¦‚æœè¡¨è¾¾å¼ç»“æœä¸º trueï¼Œæµç¨‹å°†è½¬ç§»åˆ° then å±æ€§æŒ‡å®šçš„çŠ¶æ€ä¸­ï¼Œå¦‚æœç»“æœä¸º falseï¼Œæµç¨‹å°†ä¼šè½¬ç§»åˆ° else å±æ€§æŒ‡å®šçš„çŠ¶æ€ä¸­ã€‚</p>
<p>å­æµç¨‹çŠ¶æ€</p>
<p>ä½ å¯èƒ½ä¸ä¼šå°†åº”ç”¨ç¨‹åºçš„æ‰€æœ‰é€»è¾‘å†™åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œè€Œæ˜¯å°†å…¶åˆ†æ•£åˆ°å¤šä¸ªç±»ã€æ–¹æ³•ä»¥åŠå…¶ä»–ç»“æ„ä¸­ã€‚</p>
<p>åŒæ ·ï¼Œå°†æµç¨‹åˆ†æˆç‹¬ç«‹çš„éƒ¨åˆ†æ˜¯ä¸ªä¸é”™çš„ä¸»æ„ã€‚<code>&lt;subflow-state&gt;</code> å…è®¸åœ¨ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„æµç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªæµç¨‹ã€‚è¿™ç±»ä¼¼äºåœ¨ä¸€ä¸ªæ–¹æ³•ä¸­è°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•ã€‚</p>
<p><code>&lt;subflow-state&gt;</code> å¯ä»¥è¿™æ ·å£°æ˜ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">subflow-state</span> <span class="attr">id</span>=<span class="string">&quot;order&quot;</span> <span class="attr">subflow</span>=<span class="string">&quot;pizza/order&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">value</span>=<span class="string">&quot;order&quot;</span> /&gt;</span>  <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;orderCreated&quot;</span> <span class="attr">to</span>=<span class="string">&quot;payment&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">subflow-state</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œ<code>&lt;input&gt;</code> å…ƒç´ ç”¨äºä¼ é€’è®¢å•å¯¹è±¡ä½œä¸ºå­æµç¨‹çš„è¾“å…¥ã€‚å¦‚æœå­æµç¨‹ç»“æŸçš„ <code>&lt;end-state&gt;</code> çŠ¶æ€ ID ä¸º orderCreatedï¼Œé‚£ä¹ˆæµç¨‹å°†ä¼šè½¬ç§»åˆ°åä¸º payment çš„çŠ¶æ€ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘æœ‰ç‚¹è¶…å‡ºè¿›åº¦äº†ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰è®¨è®ºåˆ° <code>&lt;end-state&gt;</code> å…ƒç´ å’Œè½¬ç§»ã€‚æˆ‘ä»¬å¾ˆå¿«å°±ä¼šåœ¨ 8.2.2 å°èŠ‚ä»‹ç»è½¬ç§»ã€‚å¯¹äºç»“æŸçŠ¶æ€ï¼Œè¿™æ­£æ˜¯æ¥ä¸‹æ¥è¦ä»‹ç»çš„ã€‚</p>
<p>ç»“æŸçŠ¶æ€</p>
<p>æœ€åï¼Œæ‰€æœ‰çš„æµç¨‹éƒ½è¦ç»“æŸã€‚è¿™å°±æ˜¯å½“æµç¨‹è½¬ç§»åˆ°ç»“æŸçŠ¶æ€æ—¶æ‰€åšçš„ã€‚<code>&lt;end-state&gt;</code> å…ƒç´ æŒ‡å®šäº†æµç¨‹çš„ç»“æŸï¼Œå®ƒä¸€èˆ¬ä¼šæ˜¯è¿™æ ·å£°æ˜çš„ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">end-state</span> <span class="attr">id</span>=<span class="string">&quot;customerReady&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“åˆ°è¾¾ <code>&lt;end-state&gt;</code> çŠ¶æ€ï¼Œæµç¨‹ä¼šç»“æŸã€‚æ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆå–å†³äºå‡ ä¸ªå› ç´ ï¼š</p>
<ul>
<li>å¦‚æœç»“æŸçš„æµç¨‹æ˜¯ä¸€ä¸ªå­æµç¨‹ï¼Œé‚£è°ƒç”¨å®ƒçš„æµç¨‹å°†ä¼šä» <code>&lt;subflow-state&gt;</code> å¤„ç»§ç»­æ‰§è¡Œã€‚<code>&lt;end-state&gt;</code> çš„ ID å°†ä¼šç”¨ä½œäº‹ä»¶è§¦å‘ä» <code>&lt;subflow-state&gt;</code> å¼€å§‹çš„è½¬ç§»ã€‚</li>
<li>å¦‚æœ <code>&lt;end-state&gt;</code> è®¾ç½®äº† view å±æ€§ï¼ŒæŒ‡å®šçš„è§†å›¾å°†ä¼šè¢«æ¸²æŸ“ã€‚è§†å›¾å¯ä»¥æ˜¯ç›¸å¯¹äºæµç¨‹è·¯å¾„çš„è§†å›¾æ¨¡æ¿ï¼Œå¦‚æœæ·»åŠ  â€œexternalRedirect:â€ å‰ç¼€çš„è¯ï¼Œå°†ä¼šé‡å®šå‘åˆ°æµç¨‹å¤–éƒ¨çš„é¡µé¢ï¼Œå¦‚æœæ·»åŠ  â€œflowRedirect:â€ å°†é‡å®šå‘åˆ°å¦ä¸€ä¸ªæµç¨‹ä¸­ã€‚</li>
<li>å¦‚æœç»“æŸçš„æµç¨‹ä¸æ˜¯å­æµç¨‹ï¼Œä¹Ÿæ²¡æœ‰æŒ‡å®š view å±æ€§ï¼Œé‚£è¿™ä¸ªæµç¨‹åªæ˜¯ä¼šç»“æŸè€Œå·²ã€‚æµè§ˆå™¨æœ€åå°†ä¼šåŠ è½½æµç¨‹çš„åŸºæœ¬URLåœ°å€ï¼Œå½“å‰å·²æ²¡æœ‰æ´»åŠ¨çš„æµç¨‹ï¼Œæ‰€ä»¥ä¼šå¼€å§‹ä¸€ä¸ªæ–°çš„æµç¨‹å®ä¾‹ã€‚</li>
</ul>
<p>éœ€è¦æ„è¯†åˆ°æµç¨‹å¯èƒ½ä¼šæœ‰ä¸æ­¢ä¸€ä¸ªç»“æŸçŠ¶æ€ã€‚å­æµç¨‹çš„ç»“æŸçŠ¶æ€ ID ç¡®å®šäº†æ¿€æ´»çš„äº‹ä»¶ï¼Œæ‰€ä»¥ä½ å¯èƒ½ä¼šå¸Œæœ›é€šè¿‡å¤šç§ç»“æŸçŠ¶æ€æ¥ç»“æŸå­æµç¨‹ï¼Œä»è€Œèƒ½å¤Ÿåœ¨è°ƒç”¨æµç¨‹ä¸­è§¦å‘ä¸åŒçš„äº‹ä»¶ã€‚å³ä½¿ä¸æ˜¯åœ¨å­æµç¨‹ä¸­ï¼Œä¹Ÿæœ‰å¯èƒ½åœ¨ç»“æŸæµç¨‹åï¼Œæ ¹æ®æµç¨‹çš„æ‰§è¡Œæƒ…å†µæœ‰å¤šä¸ªæ˜¾ç¤ºé¡µé¢ä¾›é€‰æ‹©ã€‚</p>
<p>ç°åœ¨ï¼Œå·²ç»çœ‹å®Œäº†æµç¨‹ä¸­çš„å„ä¸ªçŠ¶æ€ï¼Œæˆ‘ä»¬åº”å½“çœ‹ä¸€ä¸‹æµç¨‹æ˜¯å¦‚ä½•åœ¨çŠ¶æ€é—´è¿ç§»çš„ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨æµç¨‹ä¸­é€šè¿‡å®šä¹‰è½¬ç§»æ¥å®Œæˆé“è·¯é“ºè®¾çš„ã€‚</p>
<h4 id="è½¬ç§»"><a href="#è½¬ç§»" class="headerlink" title="è½¬ç§»"></a>è½¬ç§»</h4><p>æ­£å¦‚æˆ‘åœ¨å‰é¢æ‰€æåˆ°çš„ï¼Œè½¬ç§»è¿æ¥äº†æµç¨‹ä¸­çš„çŠ¶æ€ã€‚æµç¨‹ä¸­é™¤ç»“æŸçŠ¶æ€ä¹‹å¤–çš„æ¯ä¸ªçŠ¶æ€ï¼Œè‡³å°‘éƒ½éœ€è¦ä¸€ä¸ªè½¬ç§»ï¼Œè¿™æ ·å°±èƒ½å¤ŸçŸ¥é“ä¸€æ—¦è¿™ä¸ªçŠ¶æ€å®Œæˆæ—¶æµç¨‹è¦å»å‘å“ªé‡Œã€‚çŠ¶æ€å¯ä»¥æœ‰å¤šä¸ªè½¬ç§»ï¼Œåˆ†åˆ«å¯¹åº”äºå½“å‰çŠ¶æ€ç»“æŸæ—¶å¯ä»¥æ‰§è¡Œçš„ä¸åŒçš„è·¯å¾„ã€‚</p>
<p>è½¬ç§»ä½¿ç”¨ <code>&lt;transition&gt;</code> å…ƒç´ æ¥è¿›è¡Œå®šä¹‰ï¼Œå®ƒä¼šä½œä¸ºå„ç§çŠ¶æ€å…ƒç´ ï¼ˆ<code>&lt;action-state&gt;</code>ã€<code>&lt;view-state&gt;</code>ã€<code>&lt;subflow-state&gt;</code>ï¼‰çš„å­å…ƒç´ ã€‚æœ€ç®€å•çš„å½¢å¼å°±æ˜¯ <code>&lt;transition&gt;</code> å…ƒç´ åœ¨æµç¨‹ä¸­æŒ‡å®šä¸‹ä¸€ä¸ªçŠ¶æ€ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">to</span>=<span class="string">&quot;customerReady&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>å±æ€§ to ç”¨äºæŒ‡å®šæµç¨‹çš„ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚å¦‚æœ <code>&lt;transition&gt; </code>åªä½¿ç”¨äº† to å±æ€§ï¼Œé‚£è¿™ä¸ªè½¬ç§»å°±ä¼šæ˜¯å½“å‰çŠ¶æ€çš„é»˜è®¤è½¬ç§»é€‰é¡¹ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–å¯ç”¨è½¬ç§»çš„è¯ï¼Œå°±ä¼šä½¿ç”¨å®ƒã€‚</p>
<p>æ›´å¸¸è§çš„è½¬ç§»å®šä¹‰æ˜¯åŸºäºäº‹ä»¶çš„è§¦å‘æ¥è¿›è¡Œçš„ã€‚åœ¨è§†å›¾çŠ¶æ€ï¼Œäº‹ä»¶é€šå¸¸ä¼šæ˜¯ç”¨æˆ·é‡‡å–çš„åŠ¨ä½œã€‚åœ¨è¡Œä¸ºçŠ¶æ€ï¼Œäº‹ä»¶æ˜¯è¯„ä¼°è¡¨è¾¾å¼å¾—åˆ°çš„ç»“æœã€‚è€Œåœ¨å­æµç¨‹çŠ¶æ€ï¼Œäº‹ä»¶å–å†³äºå­æµç¨‹ç»“æŸçŠ¶æ€çš„ IDã€‚åœ¨ä»»æ„çš„äº‹ ä»¶ä¸­ï¼ˆè¿™é‡Œæ²¡æœ‰ä»»ä½•æ­§ä¹‰ï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨ on å±æ€§æ¥æŒ‡å®šè§¦å‘è½¬ç§»çš„äº‹ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;phoneEntered&quot;</span> <span class="attr">to</span>=<span class="string">&quot;lookupCustomer&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œå¦‚æœè§¦å‘äº† phoneEntered äº‹ä»¶ï¼Œæµç¨‹å°†ä¼šè¿›å…¥ lookupCustomer çŠ¶æ€ã€‚</p>
<p>åœ¨æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œæµç¨‹ä¹Ÿå¯ä»¥è¿›å…¥å¦ä¸€ä¸ªçŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé¡¾å®¢çš„è®°å½•æ²¡æœ‰æ‰¾åˆ°ï¼Œä½ å¯èƒ½å¸Œæœ›æµç¨‹è½¬ç§»åˆ°ä¸€ä¸ªå±•ç°æ³¨å†Œè¡¨å•çš„è§†å›¾çŠ¶æ€ã€‚ä»¥ä¸‹çš„ä»£ç ç‰‡æ®µæ˜¾ç¤ºäº†è¿™ç§ç±»å‹çš„è½¬ç§»ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">on-exception</span>=<span class="string">&quot;com.springinaction.pizza.service.CustomerNotFoundException&quot;</span>            <span class="attr">to</span>=<span class="string">&quot;registraction&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>å±æ€§ on-exception ç±»ä¼¼äºonå±æ€§ï¼Œåªä¸è¿‡å®ƒæŒ‡å®šäº†è¦å‘ç”Ÿè½¬ç§»çš„å¼‚å¸¸è€Œä¸æ˜¯ä¸€ä¸ªäº‹ä»¶ã€‚åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼ŒCustomerNotFoundException å¼‚å¸¸å°†å¯¼è‡´æµç¨‹è½¬ç§»åˆ° registrationForm çŠ¶æ€ã€‚</p>
<p>å…¨å±€è½¬ç§»</p>
<p>åœ¨åˆ›å»ºå®Œæµç¨‹ä¹‹åï¼Œä½ å¯èƒ½ä¼šå‘ç°æœ‰ä¸€äº›çŠ¶æ€ä½¿ç”¨äº†ä¸€äº›é€šç”¨çš„è½¬ç§»ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨æ•´ä¸ªæµç¨‹ä¸­åˆ°å¤„éƒ½æœ‰å¦‚ä¸‹çš„ <code>&lt;transition&gt;</code> è¯ï¼Œ æˆ‘ä¸€ç‚¹ä¹Ÿä¸æ„Ÿè§‰æ„å¤–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;cancel&quot;</span> <span class="attr">to</span>=<span class="string">&quot;endState&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸å…¶åœ¨å¤šä¸ªçŠ¶æ€ä¸­éƒ½é‡å¤é€šç”¨çš„è½¬ç§»ï¼Œæˆ‘ä»¬å¯ä»¥å°† <code>&lt;transition&gt;</code> å…ƒç´ ä½œä¸ºçš„å­å…ƒç´ ï¼ŒæŠŠå®ƒä»¬å®šä¹‰ä¸ºå…¨å±€è½¬ç§»ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">global-transitions</span>&gt;</span>  <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;cancel&quot;</span> <span class="attr">to</span>=<span class="string">&quot;endState&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">global-transitions</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å®šä¹‰å®Œè¿™ä¸ªå…¨å±€è½¬ç§»åï¼Œæµç¨‹ä¸­çš„æ‰€æœ‰çŠ¶æ€éƒ½ä¼šé»˜è®¤æ‹¥æœ‰è¿™ä¸ªcancelè½¬ç§»ã€‚</p>
<p>æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡äº†çŠ¶æ€å’Œè½¬ç§»ã€‚åœ¨æˆ‘ä»¬å¼€å§‹ç¼–å†™æµç¨‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æµç¨‹æ•°æ®ï¼Œè¿™æ˜¯Webæµç¨‹ä¸‰å…ƒç´ ä¸­çš„å¦ä¸€ä¸ªæˆå‘˜ã€‚</p>
<h4 id="æµç¨‹æ•°æ®"><a href="#æµç¨‹æ•°æ®" class="headerlink" title="æµç¨‹æ•°æ®"></a>æµç¨‹æ•°æ®</h4><p>å¦‚æœä½ æ›¾ç»ç©è¿‡é‚£ç§è€å¼çš„åŸºäºæ–‡å­—çš„å†’é™©æ¸¸æˆçš„è¯ï¼Œé‚£ä¹ˆå½“ä»ä¸€ä¸ªåœ°æ–¹è½¬ç§»åˆ°å¦ä¸€ä¸ªåœ°æ–¹æ—¶ï¼Œä½ ä¼šå¶å°”å‘ç°æ•£å¸ƒåœ¨å‘¨å›´çš„ä¸€äº›ä¸œè¥¿ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬æ¡èµ·æ¥å¹¶å¸¦ä¸Šã€‚æœ‰æ—¶å€™ï¼Œä½ ä¼šé©¬ä¸Šéœ€è¦ä¸€ä»¶ä¸œè¥¿ã€‚å…¶ä»–çš„æ—¶å€™ï¼Œä½ ä¼šåœ¨æ•´ä¸ªæ¸¸æˆè¿‡ç¨‹ä¸­å¸¦ç€è¿™äº›ä¸œè¥¿è€Œä¸çŸ¥é“å®ƒä»¬æ˜¯åšä»€ä¹ˆç”¨çš„â€”â€”ç›´åˆ°ä½ åˆ°è¾¾æ¸¸æˆç»“æŸçš„æ—¶å€™æ‰ä¼šå‘ç°å®ƒæ˜¯çœŸæ­£æœ‰ç”¨çš„ã€‚</p>
<p>åœ¨å¾ˆå¤šæ–¹é¢ï¼Œæµç¨‹ä¸è¿™äº›å†’é™©æ¸¸æˆæ˜¯å¾ˆç±»ä¼¼çš„ã€‚å½“æµç¨‹ä»ä¸€ä¸ªçŠ¶æ€è¿›è¡Œåˆ°å¦ä¸€ä¸ªçŠ¶æ€æ—¶ï¼Œå®ƒä¼šå¸¦èµ°ä¸€äº›æ•°æ®ã€‚æœ‰æ—¶å€™ï¼Œè¿™äº›æ•°æ®åªéœ€è¦å¾ˆçŸ­çš„æ—¶é—´ï¼ˆå¯èƒ½åªè¦å±•ç°é¡µé¢ç»™ç”¨æˆ·ï¼‰ã€‚æœ‰æ—¶å€™ï¼Œè¿™äº›æ•°æ®ä¼šåœ¨æ•´ä¸ªæµç¨‹ä¸­ä¼ é€’å¹¶åœ¨æµç¨‹ç»“æŸçš„æ—¶å€™ä½¿ç”¨ã€‚</p>
<p>å£°æ˜å˜é‡</p>
<p>æµç¨‹æ•°æ®ä¿å­˜åœ¨å˜é‡ä¸­ï¼Œè€Œå˜é‡å¯ä»¥åœ¨æµç¨‹çš„å„ä¸ªåœ°æ–¹è¿›è¡Œå¼•ç”¨ã€‚å®ƒèƒ½å¤Ÿä»¥å¤šç§æ–¹å¼åˆ›å»ºã€‚åœ¨æµç¨‹ä¸­åˆ›å»ºå˜é‡çš„æœ€ç®€å•å½¢å¼æ˜¯ä½¿ç”¨ <code>&lt;var&gt;</code> å…ƒç´ ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">var</span> <span class="attr">name</span>=<span class="string">&quot;customer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.springinaction.pizza.domain.Customer&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ Customer å®ä¾‹å¹¶å°†å…¶æ”¾åœ¨åä¸ºcustomer çš„å˜é‡ä¸­ã€‚è¿™ä¸ªå˜é‡å¯ä»¥åœ¨æµç¨‹çš„ä»»æ„çŠ¶æ€è¿›è¡Œè®¿é—®ã€‚</p>
<p>ä½œä¸ºè¡Œä¸ºçŠ¶æ€çš„ä¸€éƒ¨åˆ†æˆ–è€…ä½œä¸ºè§†å›¾çŠ¶æ€çš„å…¥å£ï¼Œä½ æœ‰å¯èƒ½ä¼šä½¿ç”¨ <code>&lt;evaluate&gt;</code> å…ƒç´ æ¥åˆ›å»ºå˜é‡ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">evaluate</span> <span class="attr">result</span>=<span class="string">&quot;viewScope.topppingsList&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;T(com.springinaction.pizza.domain.Topping).asList()&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ<code>&lt;evaluate&gt;</code> å…ƒç´ è®¡ç®—äº†ä¸€ä¸ªè¡¨è¾¾å¼ï¼ˆSpEL è¡¨è¾¾å¼ï¼‰å¹¶å°†ç»“æœæ”¾åˆ°äº†åä¸º toppingsList çš„å˜é‡ä¸­ï¼Œè¿™ä¸ªå˜é‡æ˜¯è§†å›¾ä½œç”¨åŸŸçš„ï¼ˆæˆ‘ä»¬å°†ä¼šåœ¨ç¨åä»‹ç»å…³äºä½œç”¨åŸŸçš„æ›´å¤šæ¦‚å¿µï¼‰ã€‚</p>
<p>ç±»ä¼¼åœ°ï¼Œ<code>&lt;set&gt;</code> å…ƒç´ ä¹Ÿå¯ä»¥è®¾ç½®å˜é‡çš„å€¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">&quot;flowScope.pizza&quot;</span> <span class="attr">value</span>=<span class="string">&quot;new com.springinaction.pizza.domain.Pizza()&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;set&gt;</code> å…ƒç´ ä¸ <code>&lt;evaluate&gt;</code> å…ƒç´ å¾ˆç±»ä¼¼ï¼Œéƒ½æ˜¯å°†å˜é‡è®¾ç½®ä¸ºè¡¨è¾¾å¼è®¡ç®—çš„ç»“æœã€‚è¿™é‡Œï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªæµç¨‹ä½œç”¨åŸŸå†…çš„ pizza å˜é‡ï¼Œå®ƒçš„å€¼æ˜¯ Pizza å¯¹è±¡çš„æ–°å®ä¾‹ã€‚</p>
<p>å½“æˆ‘ä»¬åœ¨ 8.3 å°èŠ‚å¼€å§‹æ„å»ºçœŸå®å·¥ä½œçš„ Web æµç¨‹æ—¶ï¼Œä½ ä¼šçœ‹åˆ°è¿™äº›å…ƒç´ æ˜¯å¦‚ä½•å…·ä½“åº”ç”¨åœ¨å®é™…æµç¨‹ä¸­çš„ã€‚ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å˜é‡çš„æµç¨‹ä½œç”¨åŸŸã€è§†å›¾ä½œç”¨åŸŸä»¥åŠå…¶ä»–çš„ä¸€äº›ä½œç”¨åŸŸæ˜¯ä»€ä¹ˆæ„æ€ã€‚</p>
<p>å®šä¹‰æµç¨‹æ•°æ®çš„ä½œç”¨åŸŸ</p>
<p>æµç¨‹ä¸­æºå¸¦çš„æ•°æ®ä¼šæ‹¥æœ‰ä¸åŒçš„ç”Ÿå‘½ä½œç”¨åŸŸå’Œå¯è§æ€§ï¼Œè¿™å–å†³äºä¿å­˜æ•°æ®çš„å˜é‡æœ¬èº«çš„ä½œç”¨åŸŸã€‚Spring Web Flow å®šä¹‰äº†äº”ç§ä¸åŒä½œç”¨åŸŸï¼Œå¦‚è¡¨ 8.2 æ‰€ç¤ºã€‚</p>
<center>è¡¨ 8.2ã€€Spring Web Flow çš„ä½œç”¨åŸŸ</center>

<table>
<thead>
<tr>
<th>èŒƒã€€ã€€å›´</th>
<th>ç”Ÿå‘½ä½œç”¨åŸŸå’Œå¯è§æ€§</th>
</tr>
</thead>
<tbody><tr>
<td>Conversation</td>
<td>æœ€é«˜å±‚çº§çš„æµç¨‹å¼€å§‹æ—¶åˆ›å»ºï¼Œåœ¨æœ€é«˜å±‚çº§çš„æµç¨‹ç»“æŸæ—¶é”€æ¯ã€‚è¢«æœ€é«˜å±‚çº§çš„æµç¨‹å’Œå…¶æ‰€æœ‰çš„å­æµç¨‹æ‰€å…±äº«</td>
</tr>
<tr>
<td>Flow</td>
<td>å½“æµç¨‹å¼€å§‹æ—¶åˆ›å»ºï¼Œåœ¨æµç¨‹ç»“æŸæ—¶é”€æ¯ã€‚åªæœ‰åœ¨åˆ›å»ºå®ƒçš„æµç¨‹ä¸­æ˜¯å¯è§çš„</td>
</tr>
<tr>
<td>Request</td>
<td>å½“ä¸€ä¸ªè¯·æ±‚è¿›å…¥æµç¨‹æ—¶åˆ›å»ºï¼Œåœ¨æµç¨‹è¿”å›æ—¶é”€æ¯</td>
</tr>
<tr>
<td>Flash</td>
<td>å½“æµç¨‹å¼€å§‹æ—¶åˆ›å»ºï¼Œåœ¨æµç¨‹ç»“æŸæ—¶é”€æ¯ã€‚åœ¨è§†å›¾çŠ¶æ€æ¸²æŸ“åï¼Œå®ƒä¹Ÿä¼šè¢«æ¸…é™¤</td>
</tr>
<tr>
<td>View</td>
<td>å½“è¿›å…¥è§†å›¾çŠ¶æ€æ—¶åˆ›å»ºï¼Œå½“è¿™ä¸ªçŠ¶æ€é€€å‡ºæ—¶é”€æ¯ã€‚åªåœ¨è§†å›¾çŠ¶æ€å†…æ˜¯å¯è§çš„</td>
</tr>
</tbody></table>
<p>å½“ä½¿ç”¨ <code>&lt;var&gt;</code> å…ƒç´ å£°æ˜å˜é‡æ—¶ï¼Œå˜é‡å§‹ç»ˆæ˜¯æµç¨‹ä½œç”¨åŸŸçš„ï¼Œä¹Ÿå°±æ˜¯åœ¨å®šä¹‰å˜é‡çš„æµç¨‹å†…æœ‰æ•ˆã€‚å½“ä½¿ç”¨ <code>&lt;set&gt;</code> æˆ– <code>&lt;evaluate&gt;</code> çš„æ—¶å€™ï¼Œä½œç”¨åŸŸé€šè¿‡ name æˆ– result å±æ€§çš„å‰ç¼€æŒ‡å®šã€‚ä¾‹å¦‚ï¼Œå°†ä¸€ä¸ªå€¼èµ‹ç»™æµç¨‹ä½œç”¨åŸŸçš„ theAnswer å˜é‡ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">&quot;flowScope.theAnswer&quot;</span> <span class="attr">value</span>=<span class="string">&quot;42&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº† Web æµç¨‹çš„æ‰€æœ‰åŸææ–™ã€‚æ˜¯æ—¶å€™å°†å…¶ç»„è£…èµ·æ¥å½¢æˆä¸€ä¸ªæˆç†Ÿä¸”å®Œæ•´åŠŸèƒ½çš„ Web æµç¨‹äº†ã€‚å½“æˆ‘ä»¬è¿™æ ·åšçš„æ—¶å€™ï¼Œè¯·çå¤§ä½ çš„çœ¼ç›è§‚å¯Ÿï¼Œæ¯”å¦‚æˆ‘æ˜¯å¦‚ä½•å°†æ•°æ®å­˜å‚¨åœ¨å„ä½œç”¨åŸŸçš„å˜é‡ä¸­çš„ã€‚</p>
<h3 id="ç»„åˆèµ·æ¥ï¼šæŠ«è¨æµç¨‹"><a href="#ç»„åˆèµ·æ¥ï¼šæŠ«è¨æµç¨‹" class="headerlink" title="ç»„åˆèµ·æ¥ï¼šæŠ«è¨æµç¨‹"></a>ç»„åˆèµ·æ¥ï¼šæŠ«è¨æµç¨‹</h3><p>æ­£å¦‚æˆ‘åœ¨æœ¬ç« å‰é¢æ‰€æåˆ°çš„ï¼Œæˆ‘ä»¬å°†æš‚æ—¶ä¸ç”¨ Spittr åº”ç”¨ç¨‹åºã€‚å–è€Œä»£ä¹‹ï¼Œæˆ‘ä»¬è¢«è¦æ±‚åšä¸€ä¸ªåœ¨çº¿çš„æŠ«è¨è®¢è´­åº”ç”¨ï¼Œé¥¥é¥¿çš„ Web è®¿é—®è€…å¯ä»¥åœ¨è¿™é‡Œè®¢è´­ä»–ä»¬æ‰€å–œæ¬¢çš„æ„å¤§åˆ©æ´¾ã€‚</p>
<p>å®é™…ä¸Šï¼Œè®¢è´­æŠ«è¨çš„è¿‡ç¨‹å¯ä»¥å¾ˆå¥½åœ°å®šä¹‰åœ¨ä¸€ä¸ªæµç¨‹ä¸­ã€‚æˆ‘ä»¬é¦–å…ˆä»æ„å»ºä¸€ä¸ªé«˜å±‚æ¬¡çš„æµç¨‹å¼€å§‹ï¼Œå®ƒå®šä¹‰äº†è®¢è´­æŠ«è¨çš„æ•´ä½“è¿‡ç¨‹ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼šå°†è¿™ä¸ªæµç¨‹æ‹†åˆ†æˆå­æµç¨‹ï¼Œè¿™äº›å­æµç¨‹åœ¨è¾ƒä½çš„å±‚æ¬¡å®šä¹‰äº†ç»†èŠ‚ã€‚</p>
<h4 id="å®šä¹‰åŸºæœ¬æµç¨‹"><a href="#å®šä¹‰åŸºæœ¬æµç¨‹" class="headerlink" title="å®šä¹‰åŸºæœ¬æµç¨‹"></a>å®šä¹‰åŸºæœ¬æµç¨‹</h4><p>ä¸€ä¸ªæ–°çš„æŠ«è¨è¿é”åº— Spizza å†³å®šå…è®¸ç”¨æˆ·åœ¨çº¿è®¢è´­ä»¥å‡è½»åº—é¢ç”µè¯çš„å‹åŠ›ã€‚å½“é¡¾å®¢è®¿é—® Spizza ç«™ç‚¹æ—¶ï¼Œä»–ä»¬éœ€è¦è¿›è¡Œç”¨æˆ·è¯†åˆ«ï¼Œé€‰æ‹©ä¸€ä¸ªæˆ–æ›´å¤šæŠ«è¨æ·»åŠ åˆ°è®¢å•ä¸­ï¼Œæä¾›æ”¯ä»˜ä¿¡æ¯ç„¶åæäº¤è®¢å•å¹¶ç­‰å¾…çƒ­ä¹åˆæ–°é²œçš„æŠ«è¨é€è¿‡æ¥ã€‚å›¾ 8.2 é˜è¿°äº†è¿™ä¸ªæµç¨‹ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211103230004821.png" alt="image-20211103230004821"></p>
<center>å›¾ 8.2ã€€å°†è®¢è´­æŠ«è¨çš„è¿‡ç¨‹å½’ç»“ä¸ºä¸€ä¸ªç®€å•çš„æµç¨‹</center>

<p>å›¾ä¸­çš„æ–¹æ¡†ä»£è¡¨äº†çŠ¶æ€è€Œç®­å¤´ä»£è¡¨äº†è½¬ç§»ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œè®¢è´­æŠ«è¨çš„æ•´ä¸ªæµç¨‹å¾ˆç®€å•ä¸”æ˜¯çº¿æ€§çš„ã€‚åœ¨ Spring Web Flow ä¸­ï¼Œè¡¨ç¤ºè¿™ä¸ªæµç¨‹æ˜¯å¾ˆå®¹æ˜“çš„ã€‚ä½¿è¿™ä¸ªè¿‡ç¨‹å˜å¾—æ›´æœ‰æ„æ€çš„å°±æ˜¯å‰ä¸‰ä¸ªæµç¨‹ä¼šæ¯”å›¾ä¸­çš„ç®€å•æ–¹æ¡†æ›´å¤æ‚ã€‚</p>
<p>ä»¥ä¸‹çš„ç¨‹åºæ¸…å• 8.1 å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Spring Web Flow çš„ XML æµç¨‹å®šä¹‰æ¥å®ç°æŠ«è¨è®¢å•çš„æ•´ä½“æµç¨‹ã€‚</p>
<center>ç¨‹åºæ¸…å• 8.1ã€€æŠ«è¨è®¢å•æµç¨‹å®šä¹‰ä¸º Spring Web Flow</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">flow</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/webflow&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/webflow   http://www.springframework.org/schema/webflow/spring-webflow-2.3.xsd&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">var</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.springinaction.pizza.domain.Order&quot;</span>/&gt;</span>        <span class="tag">&lt;<span class="name">subflow-state</span> <span class="attr">id</span>=<span class="string">&quot;identifyCustomer&quot;</span> <span class="attr">subflow</span>=<span class="string">&quot;pizza/customer&quot;</span>&gt;</span>      <span class="tag">&lt;<span class="name">output</span> <span class="attr">name</span>=<span class="string">&quot;customer&quot;</span> <span class="attr">value</span>=<span class="string">&quot;order.customer&quot;</span>/&gt;</span>      <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;customerReady&quot;</span> <span class="attr">to</span>=<span class="string">&quot;buildOrder&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">subflow-state</span>&gt;</span>        <span class="tag">&lt;<span class="name">subflow-state</span> <span class="attr">id</span>=<span class="string">&quot;buildOrder&quot;</span> <span class="attr">subflow</span>=<span class="string">&quot;pizza/order&quot;</span>&gt;</span>      <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">value</span>=<span class="string">&quot;order&quot;</span>/&gt;</span>      <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;orderCreated&quot;</span> <span class="attr">to</span>=<span class="string">&quot;takePayment&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">subflow-state</span>&gt;</span>    <span class="tag">&lt;<span class="name">subflow-state</span> <span class="attr">id</span>=<span class="string">&quot;takePayment&quot;</span> <span class="attr">subflow</span>=<span class="string">&quot;pizza/payment&quot;</span>&gt;</span>      <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">value</span>=<span class="string">&quot;order&quot;</span>/&gt;</span>      <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;paymentTaken&quot;</span> <span class="attr">to</span>=<span class="string">&quot;saveOrder&quot;</span>/&gt;</span>          <span class="tag">&lt;/<span class="name">subflow-state</span>&gt;</span>            <span class="tag">&lt;<span class="name">action-state</span> <span class="attr">id</span>=<span class="string">&quot;saveOrder&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">evaluate</span> <span class="attr">expression</span>=<span class="string">&quot;pizzaFlowActions.saveOrder(order)&quot;</span> /&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">to</span>=<span class="string">&quot;thankCustomer&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">action-state</span>&gt;</span>        <span class="tag">&lt;<span class="name">view-state</span> <span class="attr">id</span>=<span class="string">&quot;thankCustomer&quot;</span>&gt;</span>      <span class="tag">&lt;<span class="name">transition</span> <span class="attr">to</span>=<span class="string">&quot;endState&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">view-state</span>&gt;</span>    <span class="tag">&lt;<span class="name">end-state</span> <span class="attr">id</span>=<span class="string">&quot;endState&quot;</span> /&gt;</span>        <span class="tag">&lt;<span class="name">global-transitions</span>&gt;</span>      <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;cancel&quot;</span> <span class="attr">to</span>=<span class="string">&quot;endState&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">global-transitions</span>&gt;</span><span class="tag">&lt;/<span class="name">flow</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æµç¨‹å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ order å˜é‡çš„å£°æ˜ã€‚æ¯æ¬¡æµç¨‹å¼€å§‹çš„æ—¶å€™ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ª Order å®ä¾‹ã€‚Order ç±»ä¼šå¸¦æœ‰å…³äºè®¢å•çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…å«é¡¾å®¢ä¿¡æ¯ã€è®¢è´­çš„æŠ«è¨åˆ—è¡¨ä»¥åŠæ”¯ä»˜è¯¦æƒ…ï¼Œå¦‚ä¸‹é¢æ‰€ç¤ºã€‚</p>
<center>ç¨‹åºæ¸…å• 8.2ã€€Order å¸¦æœ‰æŠ«è¨è®¢å•çš„æ‰€æœ‰ç»†èŠ‚ä¿¡æ¯</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springinaction.pizza.domain;<span class="keyword">import</span> java.io.Serializable;<span class="keyword">import</span> java.util.ArrayList;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Configurable;<span class="meta">@Configurable(&quot;order&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;   <span class="keyword">private</span> Customer customer;   <span class="keyword">private</span> List&lt;Pizza&gt; pizzas;   <span class="keyword">private</span> Payment payment;   <span class="function"><span class="keyword">public</span> <span class="title">Order</span><span class="params">()</span> </span>&#123;      pizzas = <span class="keyword">new</span> ArrayList&lt;Pizza&gt;();      customer = <span class="keyword">new</span> Customer();   &#125;   <span class="function"><span class="keyword">public</span> Customer <span class="title">getCustomer</span><span class="params">()</span> </span>&#123;      <span class="keyword">return</span> customer;   &#125;   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomer</span><span class="params">(Customer customer)</span> </span>&#123;      <span class="keyword">this</span>.customer = customer;   &#125;   <span class="function"><span class="keyword">public</span> List&lt;Pizza&gt; <span class="title">getPizzas</span><span class="params">()</span> </span>&#123;      <span class="keyword">return</span> pizzas;   &#125;   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPizzas</span><span class="params">(List&lt;Pizza&gt; pizzas)</span> </span>&#123;      <span class="keyword">this</span>.pizzas = pizzas;   &#125;   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addPizza</span><span class="params">(Pizza pizza)</span> </span>&#123;      pizzas.add(pizza);   &#125;   <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getTotal</span><span class="params">()</span> </span>&#123;      <span class="keyword">return</span> <span class="number">0.0f</span>;<span class="comment">//pricingEngine.calculateOrderTotal(this);   &#125;   public Payment getPayment() &#123;      return payment;   &#125;   public void setPayment(Payment payment) &#123;      this.payment = payment;   &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>æµç¨‹å®šä¹‰çš„ä¸»è¦ç»„æˆéƒ¨åˆ†æ˜¯æµç¨‹çš„çŠ¶æ€ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæµç¨‹å®šä¹‰æ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªçŠ¶æ€ä¹Ÿä¼šæ˜¯æµç¨‹è®¿é—®ä¸­çš„ç¬¬ä¸€ä¸ªçŠ¶æ€ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œä¹Ÿå°±æ˜¯ identifyCustomer çŠ¶æ€ï¼ˆä¸€ä¸ªå­æµç¨‹ï¼‰ã€‚ä½†æ˜¯å¦‚æœä½ æ„¿æ„çš„è¯ï¼Œä½ å¯ä»¥é€šè¿‡ <code>&lt;flow&gt;</code> å…ƒç´ çš„ start-state å±æ€§å°†ä»»æ„çŠ¶æ€æŒ‡å®šä¸ºå¼€å§‹çŠ¶æ€ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">flow</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/webflow&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/webflow     http://www.springframework.org/schema/webflow/spring-webflow-2.3.xsd&quot;</span>  <span class="attr">start-state</span>=<span class="string">&quot;identifyCustomer&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">flow</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¯†åˆ«é¡¾å®¢ã€æ„é€ æŠ«è¨è®¢å•ä»¥åŠæ”¯ä»˜è¿™æ ·çš„æ´»åŠ¨å¤ªå¤æ‚äº†ï¼Œå¹¶ä¸é€‚åˆå°†å…¶å¼ºè¡Œå¡å…¥ä¸€ä¸ªçŠ¶æ€ã€‚è¿™æ˜¯æˆ‘ä»¬ä¸ºä½•åœ¨åé¢å°†å…¶å•ç‹¬å®šä¹‰ä¸ºæµç¨‹çš„åŸå› ã€‚ä½†æ˜¯ä¸ºäº†æ›´å¥½åœ°æ•´ä½“äº†è§£æŠ«è¨æµç¨‹ï¼Œè¿™äº›æ´»åŠ¨éƒ½æ˜¯ä»¥ <code>&lt;subflow-state&gt;</code> å…ƒç´ æ¥è¿›è¡Œå±•ç°çš„ã€‚</p>
<p>æµç¨‹å˜é‡ order å°†åœ¨å‰ä¸‰ä¸ªçŠ¶æ€ä¸­è¿›è¡Œå¡«å……å¹¶åœ¨ç¬¬å››ä¸ªçŠ¶æ€ä¸­è¿›è¡Œä¿å­˜ã€‚identifyCustomer å­æµç¨‹çŠ¶æ€ä½¿ç”¨äº† <code>&lt;output&gt;</code> å…ƒç´ æ¥å¡«å…… order çš„ customer å±æ€§ï¼Œå°†å…¶è®¾ç½®ä¸ºé¡¾å®¢å­æµç¨‹æ”¶åˆ°çš„è¾“å‡ºã€‚buildOrder å’Œ takePayment çŠ¶æ€ä½¿ç”¨äº†ä¸åŒçš„æ–¹å¼ï¼Œå®ƒä»¬ä½¿ç”¨ <code>&lt;input&gt;</code> å°† order æµç¨‹å˜é‡ä½œä¸ºè¾“å…¥ï¼Œè¿™äº›å­æµç¨‹å°±èƒ½åœ¨å…¶å†…éƒ¨å¡«å…… order å¯¹è±¡ã€‚</p>
<p>åœ¨è®¢å•å¾—åˆ°é¡¾å®¢ã€ä¸€äº›æŠ«è¨ä»¥åŠæ”¯ä»˜ç»†èŠ‚åï¼Œå°±å¯ä»¥å¯¹å…¶è¿›è¡Œä¿å­˜äº†ã€‚saveOrder æ˜¯å¤„ç†è¿™ä¸ªä»»åŠ¡çš„è¡Œä¸ºçŠ¶æ€ã€‚å®ƒä½¿ç”¨ <code>&lt;evaluate&gt;</code> æ¥è°ƒç”¨ ID ä¸º pizzaFlowActions çš„ bean çš„ saveOrder() æ–¹æ³•ï¼Œå¹¶å°†ä¿å­˜çš„è®¢å•å¯¹è±¡ä¼ é€’è¿›æ¥ã€‚è®¢å•å®Œæˆä¿å­˜åï¼Œå®ƒä¼šè½¬ç§»åˆ° thankCustomerã€‚</p>
<p>thankCustomer çŠ¶æ€æ˜¯ä¸€ä¸ªç®€å•çš„è§†å›¾çŠ¶æ€ï¼Œåå°ä½¿ç”¨äº† â€œ/WEBINF/flows/pizza/ thankCustomer.jspâ€ è¿™ä¸ª JSP æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<center>ç¨‹åºæ¸…å• 8.3ã€€æ„Ÿè°¢é¡¾å®¢è®¢è´­çš„ JSP è§†å›¾</center>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;html xmlns:jsp=<span class="string">&quot;http://java.sun.com/JSP/Page&quot;</span>&gt;  &lt;jsp:output omit-xml-declaration=<span class="string">&quot;yes&quot;</span> /&gt;  &lt;jsp:directive.page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> /&gt;  &lt;head&gt;&lt;title&gt;Spizza&lt;/title&gt;&lt;/head&gt;  &lt;body&gt;    &lt;h2&gt;Thank you <span class="keyword">for</span> your order!&lt;/h2&gt;    &lt;![CDATA[    &lt;a href=<span class="string">&quot;$&#123;flowExecutionUrl&#125;&amp;_eventId=finished&quot;</span>&gt;Finish&lt;/a&gt;    ]]&gt;  &lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>åœ¨â€œæ„Ÿè°¢â€é¡µé¢ä¸­ï¼Œä¼šæ„Ÿè°¢é¡¾å®¢çš„è®¢è´­å¹¶ä¸ºå…¶æä¾›ä¸€ä¸ªå®Œæˆæµç¨‹çš„é“¾æ¥ã€‚è¿™ä¸ªé“¾æ¥æ˜¯æ•´ä¸ªé¡µé¢ä¸­æœ€æœ‰æ„æ€çš„äº‹æƒ…ï¼Œå› ä¸ºå®ƒå±•ç¤ºäº†ç”¨æˆ·ä¸æµç¨‹äº¤äº’çš„å”¯ä¸€åŠæ³•ã€‚</p>
<p>Spring Web Flow ä¸ºè§†å›¾çš„ç”¨æˆ·æä¾›äº†ä¸€ä¸ª flowExecutionUrl å˜é‡ï¼Œå®ƒåŒ…å«äº†æµç¨‹çš„ URLã€‚ç»“æŸé“¾æ¥å°†ä¸€ä¸ª â€œ_eventIdâ€ å‚æ•°å…³è”åˆ° URL ä¸Šï¼Œä»¥ä¾¿å›åˆ° Web æµç¨‹æ—¶è§¦å‘ finished äº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶å°†ä¼šè®©æµç¨‹åˆ°è¾¾ç»“æŸçŠ¶æ€ã€‚</p>
<p>æµç¨‹å°†ä¼šåœ¨ç»“æŸçŠ¶æ€å®Œæˆã€‚é‰´äºåœ¨æµç¨‹ç»“æŸåæ²¡æœ‰ä¸‹ä¸€æ­¥åšä»€ä¹ˆçš„å…·ä½“ä¿¡æ¯ï¼Œæµç¨‹å°†ä¼šé‡æ–°ä» identifyCustomer çŠ¶æ€å¼€å§‹ï¼Œä»¥å‡†å¤‡æ¥å—å¦ä¸€ä¸ªæŠ«è¨è®¢å•ã€‚</p>
<p>è¿™æ¶µç›–äº†è®¢è´­æŠ«è¨çš„æ•´ä½“æµç¨‹ã€‚ä½†æ˜¯è¿™ä¸ªæµç¨‹å¹¶ä¸ä»…ä»…æ˜¯æˆ‘ä»¬åœ¨ä»£ç æ¸…å• 8.1 ä¸­æ‰€çœ‹åˆ°çš„è¿™äº›ã€‚æˆ‘ä»¬è¿˜éœ€è¦å®šä¹‰ identifyCustomerã€buildOrderã€takePayment è¿™äº›çŠ¶æ€çš„å­æµç¨‹ã€‚è®©æˆ‘ä»¬ä»è¯†åˆ«ç”¨æˆ·å¼€å§‹æ„å»ºè¿™äº›æµç¨‹ã€‚</p>
<h4 id="æ”¶é›†é¡¾å®¢ä¿¡æ¯"><a href="#æ”¶é›†é¡¾å®¢ä¿¡æ¯" class="headerlink" title="æ”¶é›†é¡¾å®¢ä¿¡æ¯"></a>æ”¶é›†é¡¾å®¢ä¿¡æ¯</h4><p>å¦‚æœä½ æ›¾ç»è®¢è´­è¿‡æŠ«è¨ï¼Œä½ å¯èƒ½ä¼šçŸ¥é“æµç¨‹ã€‚ä»–ä»¬é¦–å…ˆä¼šè¯¢é—®ä½ çš„ç”µè¯å·ç ã€‚ç”µè¯å·ç é™¤äº†èƒ½å¤Ÿè®©é€è´§å¸æœºåœ¨æ‰¾ä¸åˆ°ä½ å®¶çš„æ—¶å€™æ‰“ç”µè¯ç»™ä½ ï¼Œè¿˜å¯ä»¥ä½œä¸ºä½ åœ¨è¿™ä¸ªæŠ«è¨åº—çš„æ ‡è¯†ã€‚å¦‚æœä½ æ˜¯å›å¤´å®¢ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªç”µè¯å·ç æ¥æŸ¥æ‰¾ä½ çš„åœ°å€ï¼Œè¿™æ ·ä»–ä»¬å°±çŸ¥é“å°†ä½ çš„è®¢å•æ´¾é€åˆ°ä»€ä¹ˆåœ°æ–¹äº†ã€‚</p>
<p>å¯¹äºä¸€ä¸ªæ–°çš„é¡¾å®¢æ¥è®²ï¼ŒæŸ¥è¯¢ç”µè¯å·ç ä¸ä¼šæœ‰ä»€ä¹ˆç»“æœã€‚æ‰€ä»¥æ¥ä¸‹æ¥ï¼Œä»–ä»¬å°†è¯¢é—®ä½ çš„åœ°å€ã€‚è¿™æ ·ï¼ŒæŠ«è¨åº—çš„äººå°±ä¼šçŸ¥é“ä½ æ˜¯è°ä»¥åŠå°†æŠ«è¨é€åˆ°å“ªé‡Œã€‚ä½†æ˜¯åœ¨é—®ä½ è¦å“ªç§æŠ«è¨ä¹‹å‰ï¼Œä»–ä»¬è¦ç¡®è®¤ä½ çš„åœ°å€åœ¨ä»–ä»¬çš„é…é€èŒƒå›´ä¹‹å†…ã€‚å¦‚æœä¸åœ¨çš„è¯ï¼Œä½ éœ€è¦è‡ªå·±åˆ°åº—é‡Œå¹¶å–èµ°æŠ«è¨ã€‚</p>
<p>åœ¨æ¯ä¸ªæŠ«è¨è®¢å•å¼€å§‹å‰çš„æé—®å’Œå›ç­”é˜¶æ®µå¯ä»¥ç”¨å›¾ 8.3 çš„æµç¨‹å›¾æ¥è¡¨ç¤ºã€‚</p>
<p>è¿™ä¸ªæµç¨‹æ¯”æ•´ä½“çš„æŠ«è¨æµç¨‹æ›´æœ‰æ„æ€ã€‚è¿™ä¸ªæµç¨‹ä¸æ˜¯çº¿æ€§çš„è€Œæ˜¯åœ¨å¥½å‡ ä¸ªåœ°æ–¹æ ¹æ®ä¸åŒçš„æ¡ä»¶æœ‰äº†åˆ†æ”¯ã€‚ä¾‹å¦‚ï¼Œåœ¨æŸ¥æ‰¾é¡¾å®¢åï¼Œæµç¨‹å¯èƒ½ç»“æŸï¼ˆå¦‚æœæ‰¾åˆ°äº†é¡¾å®¢ï¼‰ï¼Œä¹Ÿæœ‰å¯èƒ½è½¬ç§»åˆ°æ³¨å†Œè¡¨å•ï¼ˆå¦‚æœæ²¡æœ‰æ‰¾åˆ°é¡¾å®¢ï¼‰ã€‚åŒæ ·ï¼Œåœ¨ checkDeliveryArea çŠ¶æ€ï¼Œé¡¾å®¢æœ‰å¯èƒ½ä¼šè¢«è­¦å‘Šä¹Ÿæœ‰å¯èƒ½ä¸è¢«è­¦å‘Šä»–ä»¬çš„åœ°å€åœ¨é…é€èŒƒå›´ä¹‹å¤–ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211103231502068.png" alt="image-20211103231502068"></p>
<center>å›¾ 8.3ã€€è¯†åˆ«é¡¾å®¢çš„æµç¨‹æ¯”æŠ«è¨æµç¨‹æœ‰äº†æ›´å¤šçš„åˆ†æ”¯</center>

<p>ä»¥ä¸‹çš„ç¨‹åºæ¸…å•å±•ç¤ºäº†è¯†åˆ«é¡¾å®¢çš„æµç¨‹å®šä¹‰ã€‚</p>
<center>ç¨‹åºæ¸…å• 8.4ã€€ä½¿ç”¨ Web æµç¨‹æ¥è¯†åˆ«é¥¥é¥¿çš„æŠ«è¨é¡¾å®¢</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">flow</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/webflow&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/webflow   http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">required</span>=<span class="string">&quot;true&quot;</span>/&gt;</span>        <span class="comment">&lt;!-- Customer --&gt;</span>    <span class="tag">&lt;<span class="name">view-state</span> <span class="attr">id</span>=<span class="string">&quot;welcome&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;phoneEntered&quot;</span> <span class="attr">to</span>=<span class="string">&quot;lookupCustomer&quot;</span>/&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;cancel&quot;</span> <span class="attr">to</span>=<span class="string">&quot;cancel&quot;</span>/&gt;</span>    <span class="tag">&lt;/<span class="name">view-state</span>&gt;</span>        <span class="tag">&lt;<span class="name">action-state</span> <span class="attr">id</span>=<span class="string">&quot;lookupCustomer&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">evaluate</span> <span class="attr">result</span>=<span class="string">&quot;order.customer&quot;</span> <span class="attr">expression</span>=            <span class="string">&quot;pizzaFlowActions.lookupCustomer(requestParameters.phoneNumber)&quot;</span> /&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">to</span>=<span class="string">&quot;registrationForm&quot;</span> <span class="attr">on-exception</span>=            <span class="string">&quot;com.springinaction.pizza.service.CustomerNotFoundException&quot;</span> /&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">to</span>=<span class="string">&quot;customerReady&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">action-state</span>&gt;</span>        <span class="tag">&lt;<span class="name">view-state</span> <span class="attr">id</span>=<span class="string">&quot;registrationForm&quot;</span> <span class="attr">model</span>=<span class="string">&quot;order&quot;</span> <span class="attr">popup</span>=<span class="string">&quot;true&quot;</span> &gt;</span>        <span class="tag">&lt;<span class="name">on-entry</span>&gt;</span>          <span class="tag">&lt;<span class="name">evaluate</span> <span class="attr">expression</span>=              <span class="string">&quot;order.customer.phoneNumber = requestParameters.phoneNumber&quot;</span> /&gt;</span>        <span class="tag">&lt;/<span class="name">on-entry</span>&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">to</span>=<span class="string">&quot;checkDeliveryArea&quot;</span> /&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;cancel&quot;</span> <span class="attr">to</span>=<span class="string">&quot;cancel&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">view-state</span>&gt;</span>        <span class="tag">&lt;<span class="name">decision-state</span> <span class="attr">id</span>=<span class="string">&quot;checkDeliveryArea&quot;</span>&gt;</span>      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;pizzaFlowActions.checkDeliveryArea(order.customer.zipCode)&quot;</span>           <span class="attr">then</span>=<span class="string">&quot;addCustomer&quot;</span>           <span class="attr">else</span>=<span class="string">&quot;deliveryWarning&quot;</span>/&gt;</span>    <span class="tag">&lt;/<span class="name">decision-state</span>&gt;</span>        <span class="tag">&lt;<span class="name">view-state</span> <span class="attr">id</span>=<span class="string">&quot;deliveryWarning&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;accept&quot;</span> <span class="attr">to</span>=<span class="string">&quot;addCustomer&quot;</span> /&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;cancel&quot;</span> <span class="attr">to</span>=<span class="string">&quot;cancel&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">view-state</span>&gt;</span>        <span class="tag">&lt;<span class="name">action-state</span> <span class="attr">id</span>=<span class="string">&quot;addCustomer&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">evaluate</span> <span class="attr">expression</span>=<span class="string">&quot;pizzaFlowActions.addCustomer(order.customer)&quot;</span> /&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">to</span>=<span class="string">&quot;customerReady&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">action-state</span>&gt;</span>                <span class="comment">&lt;!-- End state --&gt;</span>    <span class="tag">&lt;<span class="name">end-state</span> <span class="attr">id</span>=<span class="string">&quot;cancel&quot;</span> /&gt;</span>    <span class="tag">&lt;<span class="name">end-state</span> <span class="attr">id</span>=<span class="string">&quot;customerReady&quot;</span>&gt;</span>      <span class="tag">&lt;<span class="name">output</span> <span class="attr">name</span>=<span class="string">&quot;customer&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">end-state</span>&gt;</span>    <span class="tag">&lt;<span class="name">global-transitions</span>&gt;</span>      <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;cancel&quot;</span> <span class="attr">to</span>=<span class="string">&quot;cancel&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">global-transitions</span>&gt;</span><span class="tag">&lt;/<span class="name">flow</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæµç¨‹åŒ…å«äº†å‡ ä¸ªæ–°çš„æŠ€å·§ï¼ŒåŒ…æ‹¬æˆ‘ä»¬é¦–æ¬¡ä½¿ç”¨çš„ <code>&lt;decisionstate&gt;</code> å…ƒç´ ã€‚å› ä¸ºå®ƒæ˜¯ pizza æµç¨‹çš„å­æµç¨‹ï¼Œæ‰€ä»¥å®ƒä¹Ÿå¯ä»¥æ¥å— Order å¯¹è±¡ä½œä¸ºè¾“å…¥ã€‚</p>
<p>ä¸å‰é¢ä¸€æ ·ï¼Œæˆ‘ä»¬è¿˜æ˜¯å°†è¿™ä¸ªæµç¨‹çš„å®šä¹‰åˆ†è§£æˆä¸€ä¸ªä¸ªçš„çŠ¶æ€ï¼Œè®©æˆ‘ä»¬ä» welcome çŠ¶æ€å¼€å§‹ã€‚</p>
<p>è¯¢é—®ç”µè¯å·ç </p>
<p>welcome çŠ¶æ€æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„è§†å›¾çŠ¶æ€ï¼Œå®ƒæ¬¢è¿è®¿é—® Spizza ç«™ç‚¹çš„é¡¾å®¢å¹¶è¦æ±‚ä»–ä»¬è¾“å…¥ç”µè¯å·ç ã€‚è¿™ä¸ªçŠ¶æ€å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„ã€‚å®ƒæœ‰ä¸¤ä¸ªè½¬ç§»ï¼šå¦‚æœä»è§†å›¾è§¦å‘ phoneEntered äº‹ä»¶çš„è¯ï¼Œè½¬ç§»ä¼šå°†æµç¨‹å®šå‘åˆ° lookupCustomerï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯åœ¨å…¨å±€è½¬ç§»ä¸­å®šä¹‰çš„ç”¨æ¥å“åº” cancel äº‹ä»¶çš„ cancel è½¬ç§»ã€‚</p>
<p>welcome çŠ¶æ€çš„æœ‰è¶£ä¹‹å¤„åœ¨äºè§†å›¾æœ¬èº«ã€‚è§†å›¾ welcome å®šä¹‰åœ¨ â€œ/WEBINF/flows/ pizza/customer/welcome.jspxâ€ ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<center>ç¨‹åºæ¸…å• 8.5ã€€æ¬¢è¿ç”¨æˆ·å¹¶è¯¢é—®ä»–ä»¬çš„ç”µè¯å·ç </center>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;&lt;%@ taglib prefix=<span class="string">&quot;form&quot;</span> uri=<span class="string">&quot;http://www.springframework.org/tags/form&quot;</span> %&gt;&lt;html&gt;  &lt;head&gt;&lt;title&gt;Spring Pizza&lt;/title&gt;&lt;/head&gt;  &lt;body&gt;    &lt;h2&gt;Welcome to Spring Pizza!!!&lt;/h2&gt;			&lt;form:form&gt;      &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;_flowExecutionKey&quot;</span>              value=<span class="string">&quot;$&#123;flowExecutionKey&#125;&quot;</span>/&gt;		  &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;phoneNumber&quot;</span>/&gt;&lt;br/&gt;      &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;_eventId_phoneEntered&quot;</span> value=<span class="string">&quot;Lookup Customer&quot;</span> /&gt;		&lt;/form:form&gt;	&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç®€å•çš„è¡¨å•æç¤ºç”¨æˆ·è¾“å…¥å…¶ç”µè¯å·ç ã€‚ä½†æ˜¯è¡¨å•ä¸­æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„éƒ¨åˆ†æ¥é©±åŠ¨æµç¨‹ç»§ç»­ã€‚</p>
<p>é¦–å…ˆè¦æ³¨æ„çš„æ˜¯éšè—çš„ <code>_flowExecutionKey</code> è¾“å…¥åŸŸã€‚å½“è¿›å…¥è§†å›¾çŠ¶æ€æ—¶ï¼Œæµç¨‹æš‚åœå¹¶ç­‰å¾…ç”¨æˆ·é‡‡å–ä¸€äº›è¡Œä¸ºã€‚èµ‹äºˆè§†å›¾çš„æµç¨‹æ‰§è¡Œ keyï¼ˆflow execution keyï¼‰å°±æ˜¯ä¸€ç§è¿”å›æµç¨‹çš„â€œå›ç¨‹ç¥¨â€ï¼ˆclaimticketï¼‰ã€‚å½“ç”¨æˆ·æäº¤è¡¨å•æ—¶ï¼Œæµç¨‹æ‰§è¡Œkeyä¼šåœ¨ <code>_flowExecutionKey</code>  è¾“å…¥åŸŸä¸­è¿”å›å¹¶åœ¨æµç¨‹æš‚åœçš„ä½ç½®è¿›è¡Œæ¢å¤ã€‚</p>
<p>è¿˜è¦æ³¨æ„çš„æ˜¯æäº¤æŒ‰é’®çš„åå­—ã€‚æŒ‰é’®åå­—çš„ <em>eventId</em>` éƒ¨åˆ†æ˜¯æä¾›ç»™ Spring Web Flow çš„ä¸€ä¸ªçº¿ç´¢ï¼Œå®ƒè¡¨æ˜äº†æ¥ä¸‹æ¥è¦è§¦å‘äº‹ä»¶ã€‚å½“ç‚¹å‡»è¿™ä¸ªæŒ‰é’®æäº¤è¡¨å•æ—¶ï¼Œä¼šè§¦å‘ phoneEntered äº‹ä»¶è¿›è€Œè½¬ç§»åˆ° lookupCustomerã€‚</p>
<p>æŸ¥æ‰¾é¡¾å®¢</p>
<p>å½“æ¬¢è¿è¡¨å•æäº¤åï¼Œé¡¾å®¢çš„ç”µè¯å·ç å°†åŒ…å«åœ¨è¯·æ±‚å‚æ•°ä¸­å¹¶å‡†å¤‡ç”¨äºæŸ¥è¯¢é¡¾å®¢ã€‚lookupCustomer çŠ¶æ€çš„ <code>&lt;evaluate&gt;</code> å…ƒç´ æ˜¯æŸ¥æ‰¾å‘ç”Ÿçš„åœ°æ–¹ã€‚å®ƒå°†ç”µè¯å·ç ä»è¯·æ±‚å‚æ•°ä¸­æŠ½å–å‡ºæ¥å¹¶ä¼ é€’åˆ° pizzaFlowActions bean çš„ lookupCustomer() æ–¹æ³•ä¸­ã€‚</p>
<p>ç›®å‰ï¼ŒlookupCustomer() çš„å®ç°å¹¶ä¸é‡è¦ã€‚åªéœ€çŸ¥é“å®ƒè¦ä¹ˆè¿”å› Customer å¯¹è±¡ï¼Œè¦ä¹ˆæŠ›å‡º CustomerNotFoundException å¼‚å¸¸ã€‚</p>
<p>åœ¨å‰ä¸€ç§æƒ…å†µä¸‹ï¼ŒCustomer å¯¹è±¡å°†ä¼šè®¾ç½®åˆ° customer å˜é‡ä¸­ï¼ˆé€šè¿‡resultå±æ€§ï¼‰å¹¶ä¸”é»˜è®¤çš„è½¬ç§»å°†æŠŠæµç¨‹å¸¦åˆ° customerReady çŠ¶æ€ã€‚ä½†æ˜¯å¦‚æœä¸èƒ½æ‰¾åˆ°é¡¾å®¢çš„è¯ï¼Œå°†æŠ›å‡º CustomerNotFoundException å¹¶ä¸”æµç¨‹è¢«è½¬ç§»åˆ° registrationForm çŠ¶æ€ã€‚</p>
<p>æ³¨å†Œæ–°é¡¾å®¢</p>
<p>registrationForm çŠ¶æ€æ˜¯è¦æ±‚ç”¨æˆ·å¡«å†™é…é€åœ°å€çš„ã€‚å°±åƒæˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„å…¶ä»–è§†å›¾çŠ¶æ€ï¼Œå®ƒå°†è¢«æ¸²æŸ“æˆ JSPã€‚JSP æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<center>ç¨‹åºæ¸…å• 8.6ã€€æ³¨å†Œæ–°é¡¾å®¢</center>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;&lt;%@ taglib prefix=<span class="string">&quot;form&quot;</span> uri=<span class="string">&quot;http://www.springframework.org/tags/form&quot;</span> %&gt;&lt;html&gt;  &lt;head&gt;&lt;title&gt;Spring Pizza&lt;/title&gt;&lt;/head&gt;  &lt;body&gt;    &lt;h2&gt;Customer Registration&lt;/h2&gt;        &lt;form:form commandName=<span class="string">&quot;order&quot;</span>&gt;      &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;_flowExecutionKey&quot;</span>              value=<span class="string">&quot;$&#123;flowExecutionKey&#125;&quot;</span>/&gt;      &lt;b&gt;Phone number: &lt;/b&gt;&lt;form:input path=<span class="string">&quot;customer.phoneNumber&quot;</span>/&gt;&lt;br/&gt;      &lt;b&gt;Name: &lt;/b&gt;&lt;form:input path=<span class="string">&quot;customer.name&quot;</span>/&gt;&lt;br/&gt;      &lt;b&gt;Address: &lt;/b&gt;&lt;form:input path=<span class="string">&quot;customer.address&quot;</span>/&gt;&lt;br/&gt;      &lt;b&gt;City: &lt;/b&gt;&lt;form:input path=<span class="string">&quot;customer.city&quot;</span>/&gt;&lt;br/&gt;      &lt;b&gt;State: &lt;/b&gt;&lt;form:input path=<span class="string">&quot;customer.state&quot;</span>/&gt;&lt;br/&gt;      &lt;b&gt;Zip Code: &lt;/b&gt;&lt;form:input path=<span class="string">&quot;customer.zipCode&quot;</span>/&gt;&lt;br/&gt;      &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;_eventId_submit&quot;</span>              value=<span class="string">&quot;Submit&quot;</span> /&gt;      &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;_eventId_cancel&quot;</span>              value=<span class="string">&quot;Cancel&quot;</span> /&gt;    &lt;/form:form&gt;	&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™å¹¶éæˆ‘ä»¬åœ¨æµç¨‹ä¸­çœ‹åˆ°çš„ç¬¬ä¸€ä¸ªè¡¨å•ã€‚welcome è§†å›¾çŠ¶æ€ä¹Ÿä¸ºé¡¾å®¢å±•ç°äº†ä¸€ä¸ªè¡¨å•ï¼Œé‚£ä¸ªè¡¨å•å¾ˆç®€å•ï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªè¾“å…¥åŸŸï¼Œä»è¯·æ±‚å‚æ•°ä¸­è·å¾—è¾“å…¥åŸŸçš„å€¼ä¹Ÿå¾ˆç®€å•ã€‚ä½†æ˜¯æ³¨å†Œè¡¨å•å°±æ¯”è¾ƒå¤æ‚äº†ã€‚</p>
<p>åœ¨è¿™é‡Œä¸æ˜¯é€šè¿‡è¯·æ±‚å‚æ•°ä¸€ä¸ªä¸ªåœ°å¤„ç†è¾“å…¥åŸŸï¼Œè€Œæ˜¯ä»¥æ›´å¥½çš„æ–¹å¼å°†è¡¨å•ç»‘å®šåˆ° Customer å¯¹è±¡ä¸Šâ€”â€”è®©æ¡†æ¶æ¥åšæ‰€æœ‰ç¹æ‚çš„å·¥ä½œã€‚</p>
<p>æ£€æŸ¥é…é€åŒºåŸŸ</p>
<p>åœ¨é¡¾å®¢æä¾›å…¶åœ°å€åï¼Œæˆ‘ä»¬éœ€è¦ç¡®è®¤ä»–çš„ä½å€åœ¨é…é€èŒƒå›´ä¹‹å†…ã€‚å¦‚æœ Spizza ä¸èƒ½æ´¾é€ç»™ä»–ä»¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦è®©é¡¾å®¢çŸ¥é“å¹¶å»ºè®®ä»–ä»¬è‡ªå·±åˆ°åº—é¢é‡Œå–èµ°æŠ«è¨ã€‚</p>
<p>ä¸ºäº†åšå‡ºè¿™ä¸ªåˆ¤æ–­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å†³ç­–çŠ¶æ€ã€‚å†³ç­–çŠ¶æ€ checkDeliveryArea æœ‰ä¸€ä¸ª <code>&lt;if&gt;</code> å…ƒç´ ï¼Œå®ƒå°†é¡¾å®¢çš„é‚®æ”¿ç¼–ç ä¼ é€’åˆ° pizzaFlowActions bean çš„ checkDeliveryArea() æ–¹æ³•ä¸­ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•å°†ä¼šè¿”å›ä¸€ä¸ª Boolean å€¼ï¼šå¦‚æœé¡¾å®¢åœ¨é…é€åŒºåŸŸå†…åˆ™ä¸º trueï¼Œå¦åˆ™ä¸º falseã€‚</p>
<p>å¦‚æœé¡¾å®¢åœ¨é…é€åŒºåŸŸå†…çš„è¯ï¼Œé‚£æµç¨‹è½¬ç§»åˆ° addCustomer çŠ¶æ€ã€‚å¦åˆ™ï¼Œé¡¾å®¢è¢«å¸¦å…¥åˆ° deliveryWarning è§†å›¾çŠ¶æ€ã€‚deliveryWarning èƒŒåçš„è§†å›¾å°±æ˜¯ â€œ/WEBINF/<br>flows/pizza/customer/deliveryWarning.jspxâ€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<center>ç¨‹åºæ¸…å• 8.7ã€€å‘ŠçŸ¥é¡¾å®¢ä¸èƒ½å°†æŠ«è¨é…é€åˆ°ä»–ä»¬çš„åœ°å€</center>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;&lt;html&gt;  &lt;head&gt;&lt;title&gt;Spring Pizza&lt;/title&gt;&lt;/head&gt;    &lt;body&gt;		&lt;h2&gt;Delivery Unavailable&lt;/h2&gt;				&lt;p&gt;The address is outside of our delivery area. The order		may still be taken <span class="keyword">for</span> carry-out.&lt;/p&gt;				&lt;a href=<span class="string">&quot;$&#123;flowExecutionUrl&#125;&amp;_eventId=accept&quot;</span>&gt;Accept&lt;/a&gt; | 		&lt;a href=<span class="string">&quot;$&#123;flowExecutionUrl&#125;&amp;_eventId=cancel&quot;</span>&gt;Cancel&lt;/a&gt;  &lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>åœ¨ deliveryWarning.jspx ä¸­ä¸æµç¨‹ç›¸å…³çš„ä¸¤ä¸ªå…³é”®ç‚¹å°±æ˜¯é‚£ä¸¤ä¸ªé“¾æ¥ï¼Œå®ƒä»¬å…è®¸ç”¨æˆ·ç»§ç»­è®¢å•æˆ–è€…å°†å…¶å–æ¶ˆã€‚é€šè¿‡ä½¿ç”¨ä¸ welcome çŠ¶æ€ç›¸åŒçš„ flowExecurtionUrl å˜é‡ï¼Œè¿™äº›é“¾æ¥åˆ†åˆ«è§¦å‘æµç¨‹ä¸­çš„ accept æˆ– cancel äº‹ä»¶ã€‚å¦‚æœå‘é€çš„æ˜¯ accept äº‹ä»¶ï¼Œé‚£ä¹ˆæµç¨‹ä¼šè½¬ç§»åˆ° addCustomer çŠ¶æ€ã€‚å¦åˆ™ï¼Œæ¥ä¸‹æ¥ä¼šæ˜¯å…¨å±€çš„å–æ¶ˆè½¬ç§»ï¼Œå­æµç¨‹å°†ä¼šè½¬ç§»åˆ° cancel ç»“æŸçŠ¶æ€ã€‚</p>
<p>ç¨åæˆ‘ä»¬å°†ä»‹ç»ç»“æŸçŠ¶æ€ã€‚è®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ addCustomer çŠ¶æ€ã€‚</p>
<p>å­˜å‚¨é¡¾å®¢æ•°æ®</p>
<p>å½“æµç¨‹æŠµè¾¾addCustomer çŠ¶æ€æ—¶ï¼Œç”¨æˆ·å·²ç»è¾“å…¥äº†ä»–ä»¬çš„åœ°å€ã€‚ä¸ºäº†å°†æ¥ä½¿ç”¨ï¼Œè¿™ä¸ªåœ°å€éœ€è¦ä»¥æŸç§æ–¹å¼å­˜å‚¨èµ·æ¥ï¼ˆå¯èƒ½ä¼šå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼‰ã€‚addCustomer çŠ¶æ€æœ‰ä¸€ä¸ª <code>&lt;evaluate&gt;</code> å…ƒç´ ï¼Œå®ƒä¼šè°ƒç”¨ pizzaFlowActions bean çš„ addCustomer() æ–¹æ³•ï¼Œå¹¶å°† customer æµç¨‹å‚æ•°ä¼ é€’è¿›å»ã€‚</p>
<p>ä¸€æ—¦è¿™ä¸ªè¿‡ç¨‹å®Œæˆï¼Œä¼šæ‰§è¡Œé»˜è®¤çš„è½¬ç§»ï¼Œæµç¨‹å°†ä¼šè½¬ç§»åˆ° ID ä¸º customerReady çš„ç»“æŸçŠ¶æ€ã€‚</p>
<p>ç»“æŸæµç¨‹</p>
<p>ä¸€èˆ¬æ¥è®²ï¼Œæµç¨‹çš„ç»“æŸçŠ¶æ€å¹¶ä¸ä¼šé‚£ä¹ˆæœ‰æ„æ€ã€‚ä½†æ˜¯è¿™ä¸ªæµç¨‹ä¸­ï¼Œå®ƒä¸ä»…ä»…åªæœ‰ä¸€ä¸ªç»“æŸçŠ¶æ€ï¼Œè€Œæ˜¯ä¸¤ä¸ªã€‚å½“å­æµç¨‹å®Œæˆæ—¶ï¼Œå®ƒä¼šè§¦å‘ä¸€ä¸ªä¸ç»“æŸçŠ¶æ€ ID ç›¸åŒçš„æµç¨‹äº‹ä»¶ã€‚å¦‚æœæµç¨‹åªæœ‰ä¸€ä¸ªç»“æŸçŠ¶æ€çš„è¯ï¼Œé‚£ä¹ˆå®ƒå§‹ç»ˆä¼šè§¦å‘ç›¸åŒçš„äº‹ä»¶ã€‚ä½†æ˜¯å¦‚æœæœ‰ä¸¤ä¸ªæˆ–æ›´å¤šçš„ç»“æŸçŠ¶æ€ï¼Œæµç¨‹èƒ½å¤Ÿå½±å“åˆ°è°ƒç”¨çŠ¶æ€çš„æ‰§è¡Œæ–¹å‘ã€‚</p>
<p>å½“ customer æµç¨‹èµ°å®Œæ‰€æœ‰æ­£å¸¸çš„è·¯å¾„åï¼Œå®ƒæœ€ç»ˆä¼šåˆ°è¾¾ ID ä¸º customerReady çš„ç»“æŸçŠ¶æ€ã€‚å½“è°ƒç”¨å®ƒçš„æŠ«è¨æµç¨‹æ¢å¤æ—¶ï¼Œå®ƒä¼šæ¥æ”¶åˆ°ä¸€ä¸ª customerReady äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶å°†ä½¿å¾—æµç¨‹è½¬ç§»åˆ° buildOrder çŠ¶æ€ã€‚</p>
<p>è¦æ³¨æ„çš„æ˜¯ customerReady ç»“æŸçŠ¶æ€åŒ…å«äº†ä¸€ä¸ª <code>&lt;output&gt;</code> å…ƒç´ ã€‚åœ¨æµç¨‹ä¸­è¿™ä¸ªå…ƒç´ ç­‰åŒäº Java ä¸­çš„ return è¯­å¥ã€‚å®ƒä»å­æµç¨‹ä¸­ä¼ é€’ä¸€äº›æ•°æ®åˆ°è°ƒç”¨æµç¨‹ã€‚åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œ<code>&lt;output&gt;</code> å…ƒç´ è¿”å› customer æµç¨‹å˜é‡ï¼Œè¿™æ ·åœ¨æŠ«è¨æµç¨‹ä¸­ï¼Œå°±èƒ½å¤Ÿå°† identifyCustomer å­æµç¨‹çš„çŠ¶æ€æŒ‡å®šç»™è®¢å•ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœåœ¨è¯†åˆ«é¡¾å®¢æµç¨‹çš„ä»»æ„åœ°æ–¹è§¦å‘äº† cancel äº‹ä»¶ï¼Œå°†ä¼šé€šè¿‡ ID ä¸º cancel çš„ç»“æŸçŠ¶æ€é€€å‡ºæµç¨‹ï¼Œè¿™ä¹Ÿä¼šåœ¨æŠ«è¨æµç¨‹ä¸­è§¦å‘ cancel äº‹ä»¶å¹¶å¯¼è‡´è½¬ç§»ï¼ˆé€šè¿‡å…¨å±€è½¬ç§»ï¼‰åˆ°æŠ«è¨æµç¨‹çš„ç»“æŸçŠ¶æ€ã€‚</p>
<h4 id="æ„å»ºè®¢å•"><a href="#æ„å»ºè®¢å•" class="headerlink" title="æ„å»ºè®¢å•"></a>æ„å»ºè®¢å•</h4><p>åœ¨è¯†åˆ«å®Œé¡¾å®¢ä¹‹åï¼Œä¸»æµç¨‹çš„ä¸‹ä¸€ä»¶äº‹æƒ…å°±æ˜¯ç¡®å®šä»–ä»¬æƒ³è¦ä»€ä¹ˆç±»å‹çš„æŠ«è¨ã€‚è®¢å•å­æµç¨‹å°±æ˜¯ç”¨äºæç¤ºç”¨æˆ·åˆ›å»ºæŠ«è¨å¹¶å°†å…¶æ”¾å…¥è®¢å•ä¸­çš„ï¼Œå¦‚å›¾ 8.4 æ‰€ç¤ºã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211103232230475.png" alt="image-20211103232230475"></p>
<center>å›¾ 8.4ã€€é€šè¿‡è®¢å•å­æµç¨‹æ·»åŠ æŠ«è¨</center>

<p>ä½ å¯ä»¥çœ‹åˆ°ï¼ŒshowOrder çŠ¶æ€ä½äºè®¢å•å­æµç¨‹çš„ä¸­å¿ƒä½ç½®ã€‚è¿™æ˜¯ç”¨æˆ·è¿›å…¥è¿™ä¸ªæµç¨‹æ—¶çœ‹åˆ°çš„ç¬¬ä¸€ä¸ªçŠ¶æ€ï¼Œå®ƒä¹Ÿæ˜¯ç”¨æˆ·åœ¨æ·»åŠ æŠ«è¨åˆ°è®¢å•åè¦è½¬ç§»åˆ°çš„çŠ¶æ€ã€‚å®ƒå±•ç°äº†è®¢å•çš„å½“å‰çŠ¶æ€å¹¶å…è®¸ç”¨æˆ·æ·»åŠ å…¶ä»–çš„æŠ«è¨åˆ°è®¢å•ä¸­ã€‚</p>
<p>è¦æ·»åŠ æŠ«è¨åˆ°è®¢å•æ—¶ï¼Œæµç¨‹ä¼šè½¬ç§»åˆ° createPizza çŠ¶æ€ã€‚è¿™æ˜¯å¦å¤–ä¸€ä¸ªè§†å›¾çŠ¶æ€ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©æŠ«è¨çš„å°ºå¯¸å’Œé¢é¥¼ä¸Šé¢çš„é…æ–™ã€‚åœ¨è¿™é‡Œï¼Œç”¨æˆ·å¯ä»¥æ·»åŠ æˆ–å–æ¶ˆæŠ«è¨ï¼Œä¸¤ç§äº‹ä»¶éƒ½ä¼šä½¿æµç¨‹è½¬ç§»å› showOrder çŠ¶æ€ã€‚</p>
<p>ä» showOrder çŠ¶æ€ï¼Œç”¨æˆ·å¯èƒ½æäº¤è®¢å•ä¹Ÿå¯èƒ½å–æ¶ˆè®¢å•ã€‚ä¸¤ç§é€‰æ‹©éƒ½ä¼šç»“æŸè®¢å•å­æµç¨‹ï¼Œä½†æ˜¯ä¸»æµç¨‹ä¼šæ ¹æ®é€‰æ‹©ä¸åŒè¿›å…¥ä¸åŒçš„æ‰§è¡Œè·¯å¾„ã€‚</p>
<p>å¦‚ä¸‹æ˜¾ç¤ºäº†å¦‚ä½•å°†å›¾ä¸­æ‰€é˜è¿°çš„å†…å®¹è½¬å˜æˆ Spring Web Flow å®šä¹‰ã€‚</p>
<center>ç¨‹åºæ¸…å• 8.8ã€€è®¢å•å­æµç¨‹çš„è§†å›¾çŠ¶æ€ï¼Œç”¨äºå±•ç¤ºè®¢å•å’Œæ·»åŠ æŠ«è¨</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">flow</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/webflow&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/webflow   http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">required</span>=<span class="string">&quot;true&quot;</span> /&gt;</span>        <span class="comment">&lt;!-- Order --&gt;</span>    <span class="tag">&lt;<span class="name">view-state</span> <span class="attr">id</span>=<span class="string">&quot;showOrder&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;createPizza&quot;</span> <span class="attr">to</span>=<span class="string">&quot;createPizza&quot;</span> /&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;checkout&quot;</span> <span class="attr">to</span>=<span class="string">&quot;orderCreated&quot;</span> /&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;cancel&quot;</span> <span class="attr">to</span>=<span class="string">&quot;cancel&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">view-state</span>&gt;</span>    <span class="tag">&lt;<span class="name">view-state</span> <span class="attr">id</span>=<span class="string">&quot;createPizza&quot;</span> <span class="attr">model</span>=<span class="string">&quot;flowScope.pizza&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">on-entry</span>&gt;</span>          <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">&quot;flowScope.pizza&quot;</span>               <span class="attr">value</span>=<span class="string">&quot;new com.springinaction.pizza.domain.Pizza()&quot;</span> /&gt;</span>                        <span class="tag">&lt;<span class="name">evaluate</span> <span class="attr">result</span>=<span class="string">&quot;viewScope.toppingsList&quot;</span>               <span class="attr">expression</span>=<span class="string">&quot;T(com.springinaction.pizza.domain.Topping).asList()&quot;</span> /&gt;</span>        <span class="tag">&lt;/<span class="name">on-entry</span>&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;addPizza&quot;</span> <span class="attr">to</span>=<span class="string">&quot;showOrder&quot;</span>&gt;</span>          <span class="tag">&lt;<span class="name">evaluate</span> <span class="attr">expression</span>=<span class="string">&quot;order.addPizza(flowScope.pizza)&quot;</span> /&gt;</span>        <span class="tag">&lt;/<span class="name">transition</span>&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;cancel&quot;</span> <span class="attr">to</span>=<span class="string">&quot;showOrder&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">view-state</span>&gt;</span>            <span class="comment">&lt;!-- End state --&gt;</span>    <span class="tag">&lt;<span class="name">end-state</span> <span class="attr">id</span>=<span class="string">&quot;cancel&quot;</span> /&gt;</span>    <span class="tag">&lt;<span class="name">end-state</span> <span class="attr">id</span>=<span class="string">&quot;orderCreated&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">flow</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå­æµç¨‹å®é™…ä¸Šä¼šæ“ä½œä¸»æµç¨‹åˆ›å»ºçš„ Order å¯¹è±¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä»¥æŸç§æ–¹å¼å°† Order ä»ä¸»æµç¨‹ä¼ åˆ°å­æµç¨‹ã€‚ä½ å¯èƒ½è¿˜è®°å¾—åœ¨ç¨‹åºæ¸…å• 8.1 ä¸­æˆ‘ä»¬ä½¿ç”¨äº† <code>&lt;input&gt;</code> å…ƒç´ æ¥å°† Order ä¼ é€’è¿›æµç¨‹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥æ¥æ”¶ Order å¯¹è±¡ã€‚å¦‚æœä½ è§‰å¾—è¿™ä¸ªæµç¨‹ä¸Javaä¸­çš„æ–¹æ³•æœ‰ äº›ç±»ä¼¼åœ°è¯ï¼Œé‚£è¿™é‡Œä½¿ç”¨çš„ <code>&lt;input&gt;</code> å…ƒç´ å®é™…ä¸Šå°±å®šä¹‰äº†è¿™ä¸ªå­æµç¨‹çš„ç­¾åã€‚è¿™ä¸ªæµç¨‹éœ€è¦ä¸€ä¸ªåä¸º order çš„å‚æ•°ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ° showOrder çŠ¶æ€ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºæœ¬çš„è§†å›¾çŠ¶æ€å¹¶å…·æœ‰ä¸‰ä¸ªä¸åŒçš„è½¬ç§»ï¼Œåˆ†åˆ«ç”¨äºåˆ›å»ºæŠ«è¨ã€æäº¤è®¢å•ä»¥åŠå–æ¶ˆè®¢å•ã€‚</p>
<p>createPizza çŠ¶æ€æ›´æœ‰æ„æ€ä¸€äº›ã€‚å®ƒçš„è§†å›¾æ˜¯ä¸€ä¸ªè¡¨å•ï¼Œè¿™ä¸ªè¡¨å•å¯ä»¥æ·»åŠ æ–°çš„ Pizza å¯¹è±¡åˆ°è®¢å•ä¸­ã€‚å…ƒç´ æ·»åŠ äº†ä¸€ä¸ªæ–°çš„ Pizza å¯¹è±¡åˆ°æµç¨‹ä½œç”¨åŸŸå†…ï¼Œå½“è¡¨å•æäº¤æ—¶ï¼Œè¡¨å•çš„å†…å®¹ä¼šå¡«å……åˆ°è¯¥å¯¹è±¡ä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªè§†å›¾çŠ¶æ€å¼•ç”¨çš„ model æ˜¯æµç¨‹ä½œç”¨åŸŸå†…çš„åŒä¸€ä¸ª Pizza å¯¹è±¡ã€‚Pizza å¯¹è±¡å°†ç»‘å®šåˆ°åˆ›å»ºæŠ«è¨çš„è¡¨å•ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;form&quot;</span> uri=<span class="string">&quot;http://www.springframework.org/tags/form&quot;</span> %&gt;&lt;div&gt;  &lt;h2&gt;Create Pizza&lt;/h2&gt;  &lt;form:form commandName=<span class="string">&quot;pizza&quot;</span>&gt;    &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;_flowExecutionKey&quot;</span> value=<span class="string">&quot;$&#123;flowExecutionKey&#125;&quot;</span>/&gt;	&lt;b&gt;Size: &lt;/b&gt;&lt;br/&gt;	&lt;form:radiobutton path=<span class="string">&quot;size&quot;</span> label=<span class="string">&quot;Small (12-inch)&quot;</span> value=<span class="string">&quot;SMALL&quot;</span>/&gt;&lt;br/&gt;    &lt;form:radiobutton path=<span class="string">&quot;size&quot;</span> label=<span class="string">&quot;Medium (14-inch)&quot;</span> value=<span class="string">&quot;MEDIUM&quot;</span>/&gt;&lt;br/&gt;    &lt;form:radiobutton path=<span class="string">&quot;size&quot;</span> label=<span class="string">&quot;Large (16-inch)&quot;</span> value=<span class="string">&quot;LARGE&quot;</span>/&gt;&lt;br/&gt;    &lt;form:radiobutton path=<span class="string">&quot;size&quot;</span> label=<span class="string">&quot;Ginormous (20-inch)&quot;</span> value=<span class="string">&quot;GINORMOUS&quot;</span>/&gt;&lt;br/&gt;	&lt;br/&gt;	  	&lt;b&gt;Toppings: &lt;/b&gt;&lt;br/&gt;	&lt;form:checkboxes path=<span class="string">&quot;toppings&quot;</span> items=<span class="string">&quot;$&#123;toppingsList&#125;&quot;</span> delimiter=<span class="string">&quot;&lt;br/&gt;&quot;</span>/&gt;&lt;br/&gt;	&lt;br/&gt;		&lt;input type=<span class="string">&quot;submit&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;button&quot;</span> name=<span class="string">&quot;_eventId_addPizza&quot;</span> value=<span class="string">&quot;Continue&quot;</span>/&gt;	&lt;input type=<span class="string">&quot;submit&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;button&quot;</span> name=<span class="string">&quot;_eventId_cancel&quot;</span> value=<span class="string">&quot;Cancel&quot;</span>/&gt;            &lt;/form:form&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>å½“é€šè¿‡ Continue æŒ‰é’®æäº¤è®¢å•æ—¶ï¼Œå°ºå¯¸å’Œé…æ–™é€‰æ‹©å°†ä¼šç»‘å®šåˆ° Pizza å¯¹è±¡ä¸­å¹¶ä¸”è§¦å‘ addPizza è½¬ç§»ã€‚ä¸è¿™ä¸ªè½¬ç§»å…³è”çš„ <code>&lt;evaluate&gt;</code> å…ƒç´ è¡¨æ˜åœ¨è½¬ç§»åˆ° showOrder çŠ¶æ€ä¹‹å‰ï¼Œæµç¨‹ä½œç”¨åŸŸå†…çš„ Pizza å¯¹è±¡å°†ä¼šä¼ é€’ç»™è®¢å•çš„ addPizza() æ–¹æ³•ä¸­ã€‚</p>
<p>æœ‰ä¸¤ç§æ–¹æ³•æ¥ç»“æŸè¿™ä¸ªæµç¨‹ã€‚ç”¨æˆ·å¯ä»¥ç‚¹å‡» showOrder è§†å›¾ä¸­çš„ Cancel æŒ‰é’®æˆ–è€… Checkout æŒ‰é’®ã€‚è¿™ä¸¤ç§æ“ä½œéƒ½ä¼šä½¿æµç¨‹è½¬ç§»åˆ°ä¸€ä¸ª <code>&lt;end-state&gt;</code>ã€‚ä½†æ˜¯é€‰æ‹©çš„ç»“æŸçŠ¶æ€ id å†³å®šäº†é€€å‡ºè¿™ä¸ªæµç¨‹æ—¶è§¦å‘äº‹ä»¶ï¼Œè¿›è€Œæœ€ç»ˆç¡®å®šäº†ä¸»æµç¨‹çš„ä¸‹ä¸€æ­¥è¡Œä¸ºã€‚ä¸»æµç¨‹è¦ä¹ˆåŸºäº cancel äº‹ä»¶è¦ä¹ˆåŸºäº orderCreated äº‹ä»¶è¿›è¡ŒçŠ¶æ€è½¬ç§»ã€‚åœ¨å‰è€…æƒ…å†µä¸‹ï¼Œå¤–è¾¹çš„ä¸»æµç¨‹ä¼šç»“æŸï¼›åœ¨åè€…æƒ…å†µä¸‹ï¼Œå®ƒå°†è½¬ç§» åˆ° takePayment å­æµç¨‹ï¼Œè¿™ä¹Ÿæ˜¯æ¥ä¸‹æ¥æˆ‘ä»¬è¦çœ‹çš„ã€‚</p>
<h4 id="æ”¯ä»˜"><a href="#æ”¯ä»˜" class="headerlink" title="æ”¯ä»˜"></a>æ”¯ä»˜</h4><p>åƒå…è´¹æŠ«è¨è¿™äº‹å„¿å¹¶ä¸å¸¸è§ã€‚å¦‚æœ Spizza æŠ«è¨åº—è®©ä»–ä»¬çš„é¡¾å®¢ä¸æä¾›æ”¯ä»˜ä¿¡æ¯å°±è®¢è´­æŠ«è¨çš„è¯ï¼Œä¼°è®¡ä»–ä»¬ä¹Ÿç»´æŒä¸äº†å¤šä¹…ã€‚åœ¨æŠ«è¨æµç¨‹è¦ç»“æŸçš„æ—¶å€™ï¼Œæœ€åçš„å­æµç¨‹æç¤ºç”¨æˆ·è¾“å…¥ä»–ä»¬çš„æ”¯ä»˜ä¿¡æ¯ã€‚è¿™ä¸ªç®€å•çš„æµç¨‹å¦‚å›¾ 8.5 æ‰€ç¤ºã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211103232431202.png" alt="image-20211103232431202"></p>
<center>å›¾ 8.5ã€€è®¢è´­æŠ«è¨çš„æœ€åä¸€æ­¥æ˜¯é€šè¿‡æ”¯ä»˜å­</center>

<p>æµç¨‹è®©ç”¨æˆ·è¿›è¡Œæ”¯ä»˜åƒè®¢å•å­æµç¨‹ä¸€æ ·ï¼Œæ”¯ä»˜å­æµç¨‹ä¹Ÿä½¿ç”¨ <code>&lt;input&gt;</code> å…ƒç´ æ¥æ”¶ä¸€ä¸ªOrderå¯¹è±¡ä½œä¸ºè¾“å…¥ã€‚</p>
<p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œè¿›å…¥æ”¯ä»˜å­æµç¨‹çš„æ—¶å€™ï¼Œç”¨æˆ·ä¼šåˆ°è¾¾ takePayment çŠ¶æ€ã€‚è¿™æ˜¯ä¸€ä¸ªè§†å›¾çŠ¶æ€ï¼Œåœ¨è¿™é‡Œç”¨æˆ·å¯ä»¥é€‰æ‹©ä½¿ç”¨ä¿¡ç”¨å¡ã€æ”¯ç¥¨æˆ–ç°é‡‘è¿›è¡Œæ”¯ä»˜ã€‚æäº¤æ”¯ä»˜ä¿¡æ¯åï¼Œå°†è¿›å…¥ verifyPayment çŠ¶æ€ã€‚è¿™æ˜¯ä¸€ä¸ªè¡Œä¸ºçŠ¶æ€ï¼Œå®ƒå°†æ ¡éªŒæ”¯ä»˜ä¿¡æ¯æ˜¯å¦å¯ä»¥æ¥å—ã€‚</p>
<p>ä½¿ç”¨ XML å®šä¹‰çš„æ”¯ä»˜æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<center>ç¨‹åºæ¸…å• 8.10ã€€æ”¯ä»˜å­æµç¨‹æœ‰ä¸€ä¸ªè§†å›¾çŠ¶æ€å’Œä¸€ä¸ªè¡Œä¸ºçŠ¶æ€</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">flow</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/webflow&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/webflow   http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">required</span>=<span class="string">&quot;true&quot;</span>/&gt;</span>        <span class="tag">&lt;<span class="name">view-state</span> <span class="attr">id</span>=<span class="string">&quot;takePayment&quot;</span> <span class="attr">model</span>=<span class="string">&quot;flowScope.paymentDetails&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">on-entry</span>&gt;</span>          <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">&quot;flowScope.paymentDetails&quot;</span>               <span class="attr">value</span>=<span class="string">&quot;new com.springinaction.pizza.domain.PaymentDetails()&quot;</span> /&gt;</span>          <span class="tag">&lt;<span class="name">evaluate</span> <span class="attr">result</span>=<span class="string">&quot;viewScope.paymentTypeList&quot;</span>               <span class="attr">expression</span>=<span class="string">&quot;T(com.springinaction.pizza.domain.PaymentType).asList()&quot;</span> /&gt;</span>        <span class="tag">&lt;/<span class="name">on-entry</span>&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;paymentSubmitted&quot;</span> <span class="attr">to</span>=<span class="string">&quot;verifyPayment&quot;</span> /&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">on</span>=<span class="string">&quot;cancel&quot;</span> <span class="attr">to</span>=<span class="string">&quot;cancel&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">view-state</span>&gt;</span>    <span class="tag">&lt;<span class="name">action-state</span> <span class="attr">id</span>=<span class="string">&quot;verifyPayment&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">evaluate</span> <span class="attr">result</span>=<span class="string">&quot;order.payment&quot;</span> <span class="attr">expression</span>=            <span class="string">&quot;pizzaFlowActions.verifyPayment(flowScope.paymentDetails)&quot;</span> /&gt;</span>        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">to</span>=<span class="string">&quot;paymentTaken&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">action-state</span>&gt;</span>                <span class="comment">&lt;!-- End state --&gt;</span>    <span class="tag">&lt;<span class="name">end-state</span> <span class="attr">id</span>=<span class="string">&quot;cancel&quot;</span> /&gt;</span>    <span class="tag">&lt;<span class="name">end-state</span> <span class="attr">id</span>=<span class="string">&quot;paymentTaken&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">flow</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æµç¨‹è¿›å…¥ takePayment è§†å›¾æ—¶ï¼Œå…ƒç´ å°†æ„å»ºä¸€ä¸ªæ”¯ä»˜è¡¨å•å¹¶ä½¿ç”¨ SpEL è¡¨è¾¾å¼åœ¨æµç¨‹ä½œç”¨åŸŸå†…åˆ›å»ºä¸€ä¸ª PaymentDetails å®ä¾‹ï¼Œè¿™æ˜¯æ”¯æ’‘è¡¨å•çš„å¯¹è±¡ã€‚å®ƒä¹Ÿä¼šåˆ›å»ºè§†å›¾ä½œç”¨åŸŸçš„ paymentTypeList å˜é‡ï¼Œè¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªåˆ—è¡¨åŒ…å«äº† PaymentType æšä¸¾ï¼ˆå¦‚ç¨‹åºæ¸…å• 8.11 æ‰€ç¤ºï¼‰çš„å€¼ã€‚åœ¨è¿™é‡Œï¼ŒSpEL çš„ T() æ“ä½œç”¨äºè·å¾— PaymentType ç±»ï¼Œè¿™æ ·å°±å¯ä»¥è°ƒç”¨é™æ€çš„ asList() æ–¹æ³•ã€‚</p>
<center>ç¨‹åºæ¸…å• 8.11ã€€PaymentType æšä¸¾å®šä¹‰äº†ç”¨æˆ·å¯ç”¨çš„æ”¯ä»˜é€‰é¡¹</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springinaction.pizza.domain;<span class="keyword">import</span> java.util.Arrays;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> org.apache.commons.lang3.text.WordUtils;<span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">PaymentType</span> </span>&#123;  CASH, CHECK, CREDIT_CARD;    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;PaymentType&gt; <span class="title">asList</span><span class="params">()</span> </span>&#123;    PaymentType[] all = PaymentType.values();    <span class="keyword">return</span> Arrays.asList(all);  &#125;    <span class="meta">@Override</span>  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> WordUtils.capitalizeFully(name().replace(<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27; &#x27;</span>));  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨é¢å¯¹æ”¯ä»˜è¡¨å•çš„æ—¶å€™ï¼Œç”¨æˆ·å¯èƒ½æäº¤æ”¯ä»˜ä¹Ÿå¯èƒ½ä¼šå–æ¶ˆã€‚æ ¹æ®åšå‡ºçš„é€‰æ‹©ï¼Œæ”¯ä»˜å­æµç¨‹å°†ä»¥åä¸º paymentTaken æˆ– cancel çš„ <code>&lt;end-state&gt;</code> ç»“æŸã€‚å°±åƒå…¶ä»–çš„å­æµç¨‹ä¸€æ ·ï¼Œä¸è®ºå“ªç§ <code>&lt;end-state&gt;</code> éƒ½ä¼šç»“æŸå­æµç¨‹å¹¶å°†æ§åˆ¶äº¤ç»™ä¸»æµç¨‹ã€‚ä½†æ˜¯æ‰€é‡‡ç”¨ <code>&lt;end-state&gt;</code> çš„ id å°†å†³å®šä¸»æµç¨‹ä¸­æ¥ä¸‹æ¥çš„è½¬ç§»ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ä¾æ¬¡ä»‹ç»äº†æŠ«è¨æµç¨‹åŠå…¶å­æµç¨‹ï¼Œå¹¶çœ‹åˆ°äº† Spring Web Flowçš„å¾ˆå¤šåŠŸèƒ½ã€‚åœ¨æˆ‘ä»¬ç»“æŸ Spring Web Flow è¯é¢˜ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€ä¸‹å¦‚ä½•å¯¹æµç¨‹åŠå…¶çŠ¶æ€çš„è®¿é—®å¢åŠ å®‰å…¨ä¿æŠ¤ã€‚</p>
<p>åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨ Spring Security æ¥ä¿æŠ¤ Spring åº”ç”¨ç¨‹åºã€‚ä½†ç°åœ¨æˆ‘ä»¬è®¨è®ºçš„æ˜¯ Spring Web Flowï¼Œè®©æˆ‘ä»¬å¿«é€Ÿåœ°çœ‹ä¸€ä¸‹ Spring Web Flow æ˜¯å¦‚ä½•ç»“åˆ Spring Security æ”¯æŒæµç¨‹çº§åˆ«çš„å®‰å…¨æ€§çš„ã€‚</p>
<p>Spring Web Flow ä¸­çš„çŠ¶æ€ã€è½¬ç§»ç”šè‡³æ•´ä¸ªæµç¨‹éƒ½å¯ä»¥å€ŸåŠ© <code>&lt;secured&gt;</code> å…ƒç´ å®ç°å®‰å…¨æ€§ï¼Œè¯¥å…ƒç´ ä¼šä½œä¸ºè¿™äº›å…ƒç´ çš„å­å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œä¸ºäº†ä¿æŠ¤å¯¹ä¸€ä¸ªè§†å›¾çŠ¶æ€çš„è®¿é—®ï¼Œä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ <code>&lt;secured&gt;</code>ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view-state</span> <span class="attr">id</span>=<span class="string">&quot;restricted&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">secured</span> <span class="attr">attribute</span>=<span class="string">&quot;ROLE_ADMIN&quot;</span> <span class="attr">match</span>=<span class="string">&quot;all&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">view-state</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æŒ‰ç…§è¿™é‡Œçš„é…ç½®ï¼Œåªæœ‰æˆäºˆ ROLE_ADMIN è®¿é—®æƒé™ï¼ˆå€ŸåŠ© attributes å±æ€§ï¼‰çš„ç”¨æˆ·æ‰èƒ½è®¿é—®è¿™ä¸ªè§†å›¾çŠ¶æ€ã€‚attributes å±æ€§ä½¿ç”¨é€—å·åˆ†éš”çš„æƒé™åˆ—è¡¨æ¥è¡¨æ˜ç”¨æˆ·è¦è®¿é—®æŒ‡å®šçŠ¶æ€ã€è½¬ç§»æˆ–æµç¨‹æ‰€éœ€è¦çš„æƒé™ã€‚match å±æ€§å¯ä»¥è®¾ç½®ä¸º any æˆ– allã€‚å¦‚æœè®¾ç½®ä¸º anyï¼Œé‚£ä¹ˆç”¨æˆ·å¿…é¡»è‡³å°‘å…·æœ‰ä¸€ä¸ª attributes å±æ€§æ‰€åˆ—çš„æƒé™ã€‚ å¦‚æœè®¾ç½®ä¸º allï¼Œé‚£ä¹ˆç”¨æˆ·å¿…é¡»å…·æœ‰æ‰€æœ‰çš„æƒé™ã€‚ä½ å¯èƒ½æƒ³çŸ¥é“ç”¨æˆ·å¦‚ä½•å…·å¤‡ <code>&lt;secured&gt;</code> å…ƒç´ æ‰€æ£€éªŒçš„æƒé™ï¼Œç”šè‡³æœ€å¼€å§‹çš„æ—¶å€™ç”¨æˆ·æ˜¯å¦‚ä½•è¿›è¡Œç™»å½•çš„ï¼Ÿè¿™äº›é—®é¢˜çš„ç­”æ¡ˆå°†åœ¨ç¬¬ 9 ç« ç»™å‡ºã€‚</p>
<h3 id="å°ç»“-7"><a href="#å°ç»“-7" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„ Web åº”ç”¨ç¨‹åºéƒ½æ˜¯è‡ªç”±è®¿é—®çš„ã€‚æœ‰æ—¶å€™ï¼Œå¿…é¡»å¯¹ç”¨æˆ·è¿›è¡ŒæŒ‡å¼•ã€è¯¢é—®é€‚å½“çš„é—®é¢˜å¹¶åŸºäºä»–ä»¬çš„å“åº”å°†å…¶å¼•å¯¼åˆ°ç‰¹å®šé¡µé¢ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºä¸å¤ªåƒä¸€ä¸ªèœå•é€‰é¡¹è€Œæ›´åƒåº”ç”¨ç¨‹åºä¸ç”¨æˆ·ä¹‹é—´çš„å¯¹è¯ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† Spring Web Flowï¼Œå®ƒæ˜¯èƒ½å¤Ÿæ„å»ºä¼šè¯å¼åº”ç”¨ç¨‹åºçš„ Web æ¡†æ¶ã€‚åœ¨ä»‹ç»çš„åŒæ—¶ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªåŸºäºæµç¨‹çš„æŠ«è¨è®¢å•åº”ç”¨ã€‚æˆ‘ä»¬å…ˆå®šä¹‰äº†åº”ç”¨ç¨‹åºçš„æ•´ä½“æµç¨‹ï¼Œä»æ”¶é›†é¡¾å®¢ä¿¡æ¯å¼€å§‹åˆ°ä¿å­˜è®¢å•åˆ°ç³»ç»Ÿä¸­ç»“æŸã€‚</p>
<p>æµç¨‹ç”±å¤šä¸ªçŠ¶æ€å’Œè½¬ç§»ç»„æˆï¼Œå®ƒä»¬å®šä¹‰äº†ä¼šè¯å¦‚ä½•ä»ä¸€ä¸ªçŠ¶æ€åˆ°å¦ä¸€ä¸ªçŠ¶æ€ã€‚çŠ¶æ€æœ¬èº«åˆ†ä¸ºå¥½å¤šç§ï¼šè¡Œä¸ºçŠ¶æ€æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œè§†å›¾çŠ¶æ€æ¶‰åŠåˆ°æµç¨‹ä¸­çš„ç”¨æˆ·ï¼Œå†³ç­–çŠ¶æ€åŠ¨æ€åœ°å¼•å¯¼æµç¨‹æ‰§è¡Œï¼Œç»“æŸçŠ¶æ€è¡¨æ˜æµç¨‹çš„ç»“æŸï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å­æµç¨‹çŠ¶æ€ï¼Œå®ƒä»¬è‡ªèº«æ˜¯é€šè¿‡æµç¨‹æ¥å®šä¹‰ çš„ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬çœ‹åˆ°å¦‚ä½•é™åˆ¶å…·æœ‰ç‰¹å®šæƒé™çš„ç”¨æˆ·æ‰èƒ½è®¿é—®æµç¨‹ã€çŠ¶æ€æˆ–è½¬ç§»ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰ä»‹ç»åº”ç”¨ç¨‹åºå¯¹ç”¨æˆ·çš„è®¤è¯ä»¥åŠå¦‚ä½•æˆäºˆç”¨æˆ·æƒé™ã€‚è¿™å°±æ˜¯ Spring Security èƒ½å¤Ÿå‘æŒ¥ä½œç”¨çš„åœ°æ–¹äº†ï¼Œè€Œ Spring Security å°±æ˜¯æˆ‘ä»¬ç¬¬ 9 ç« å°†è¦ä»‹ç»çš„å†…å®¹ã€‚</p>
<h2 id="ä¿æŠ¤-Web-åº”ç”¨"><a href="#ä¿æŠ¤-Web-åº”ç”¨" class="headerlink" title="ä¿æŠ¤ Web åº”ç”¨"></a>ä¿æŠ¤ Web åº”ç”¨</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>Spring Security ä»‹ç»</li>
<li>ä½¿ç”¨ Servlet è§„èŒƒä¸­çš„ Filter ä¿æŠ¤ Web åº”ç”¨</li>
<li>åŸºäºæ•°æ®åº“å’Œ LDAP è¿›è¡Œè®¤è¯</li>
</ul>
<p>æœ‰ä¸€ç‚¹ä¸çŸ¥é“ä½ æ˜¯å¦åœ¨æ„è¿‡ï¼Œé‚£å°±æ˜¯åœ¨ç”µè§†å‰§ä¸­å¤§å¤šæ•°äººä»ä¸é”é—¨ï¼Ÿè¿™æ˜¯å¸ç©ºè§æƒ¯çš„ç°è±¡ã€‚åœ¨ã€Š<em>Seinfeld</em>ã€‹ä¸­ï¼ŒKramer ç»å¸¸åˆ° Jerry çš„æˆ¿é—´é‡Œå¹¶ä»ä»–çš„å†°ç®±é‡Œæ‹¿ä¸œè¥¿åƒã€‚åœ¨ã€Š<em>Friends</em>ã€‹ä¸­ï¼Œå¾ˆå¤šå‰§ä¸­çš„è§’è‰²ç»å¸¸ä¸æ•²é—¨å°±ä¸å‡æ€ç´¢åœ°è¿›å…¥åˆ«äººçš„æˆ¿é—´ã€‚æœ‰ä¸€æ¬¡åœ¨ä¼¦æ•¦ï¼ŒRoss ç”šè‡³é—¯å…¥ Chandler çš„æ—…é¦†æˆ¿é—´ï¼Œå·®ä¸€ç‚¹å°±æ’è§ Chandler å’Œ Ross å¦¹å¦¹çš„ç§æƒ…ã€‚</p>
<p>åœ¨ã€Š<em>Leave it to Beaver</em>ã€‹çƒ­æ’­çš„æ—¶ä»£ï¼Œäººä»¬ä¸é”é—¨è¿™äº‹å„¿å¹¶ä¸å€¼å¾—å¤§æƒŠå°æ€ªã€‚ä½†æ˜¯åœ¨è¿™ä¸ªéšç§å’Œå®‰å…¨è¢«çœ‹å¾—æå…¶é‡è¦çš„å¹´ä»£ï¼Œçœ‹åˆ°ç”µè§†å‰§ä¸­çš„è§’è‰²å…è®¸åˆ«äººå¤§æ‘‡å¤§æ‘†åœ°è¿›å…¥è‡ªå·±çš„å¯“æ‰€æˆ–å®¶ä¸­ï¼Œå®åœ¨è®©äººéš¾ä»¥ç½®ä¿¡ã€‚</p>
<p>ç°åœ¨ï¼Œä¿¡æ¯å¯èƒ½æ˜¯æˆ‘ä»¬æœ€æœ‰ä»·å€¼çš„ä¸œè¥¿ï¼Œä¸€äº›ä¸æ€€å¥½æ„çš„äººæƒ³å°½åŠæ³•è¯•å›¾å·å·è¿›å…¥ä¸å®‰å…¨çš„åº”ç”¨ç¨‹åºæ¥çªƒå–æˆ‘ä»¬çš„æ•°æ®å’Œèº«ä»½ä¿¡æ¯ã€‚ä½œä¸ºè½¯ä»¶å¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬å¿…é¡»é‡‡å–æªæ–½æ¥ä¿æŠ¤åº”ç”¨ç¨‹åºä¸­çš„ä¿¡æ¯ã€‚æ— è®ºä½ æ˜¯é€šè¿‡ç”¨æˆ·å/å¯†ç æ¥ä¿æŠ¤ç”µå­é‚®ä»¶è´¦å·ï¼Œè¿˜æ˜¯åŸºäºäº¤æ˜“ PIN æ¥ä¿æŠ¤ç»çºªè´¦æˆ·ï¼Œå®‰å…¨æ€§éƒ½æ˜¯ç»å¤§å¤šæ•°åº”ç”¨ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦åˆ‡é¢ ï¼ˆaspectï¼‰ã€‚</p>
<p>æˆ‘æœ‰æ„é€‰æ‹©äº†â€œåˆ‡é¢â€è¿™ä¸ªè¯æ¥æè¿°åº”ç”¨ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚å®‰å…¨æ€§æ˜¯è¶…è¶Šåº”ç”¨ç¨‹åºåŠŸèƒ½çš„ä¸€ä¸ªå…³æ³¨ç‚¹ã€‚åº”ç”¨ç³»ç»Ÿçš„ç»å¤§éƒ¨åˆ†å†…å®¹éƒ½ä¸åº”è¯¥å‚ä¸åˆ°ä¸è‡ªå·±ç›¸å…³çš„å®‰å…¨æ€§å¤„ç†ä¸­ã€‚å°½ç®¡æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨åº”ç”¨ç¨‹åºä¸­ç¼–å†™å®‰å…¨æ€§åŠŸèƒ½ç›¸å…³çš„ä»£ç ï¼ˆè¿™ç§æƒ…å†µå¹¶ä¸å°‘è§ï¼‰ï¼Œä½†æ›´å¥½çš„æ–¹å¼è¿˜æ˜¯å°†å®‰å…¨æ€§ç›¸å…³çš„å…³æ³¨ç‚¹ä¸åº”ç”¨ç¨‹åºæœ¬èº«çš„å…³æ³¨ç‚¹è¿›è¡Œåˆ†ç¦»ã€‚</p>
<p>å¦‚æœä½ è§‰å¾—å®‰å…¨æ€§å¬ä¸Šå»å¥½åƒæ˜¯ä½¿ç”¨é¢å‘åˆ‡é¢æŠ€æœ¯å®ç°çš„ï¼Œé‚£ä½ çŒœå¯¹äº†ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åˆ‡é¢æŠ€æœ¯æ¥æ¢ç´¢ä¿æŠ¤åº”ç”¨ç¨‹åºçš„æ–¹å¼ã€‚ä¸è¿‡æˆ‘ä»¬ä¸å¿…è‡ªå·±å¼€å‘è¿™äº›åˆ‡é¢ â€”â€” æˆ‘ä»¬å°†ä»‹ç» Spring Securityï¼Œè¿™æ˜¯ä¸€ç§åŸºäº Spring AOP å’Œ Servlet è§„èŒƒä¸­çš„ Filter å®ç°çš„å®‰å…¨æ¡†æ¶ã€‚</p>
<h3 id="Spring-Securityç®€ä»‹"><a href="#Spring-Securityç®€ä»‹" class="headerlink" title="Spring Securityç®€ä»‹"></a>Spring Securityç®€ä»‹</h3><p>Spring Security æ˜¯ä¸ºåŸºäº Spring çš„åº”ç”¨ç¨‹åºæä¾›å£°æ˜å¼å®‰å…¨ä¿æŠ¤çš„å®‰å…¨æ€§æ¡†æ¶ã€‚Spring Security æä¾›äº†å®Œæ•´çš„å®‰å…¨æ€§è§£å†³æ–¹æ¡ˆï¼Œå®ƒèƒ½å¤Ÿåœ¨ Web è¯·æ±‚çº§åˆ«å’Œæ–¹æ³•è°ƒç”¨çº§åˆ«å¤„ç†èº«ä»½è®¤è¯å’Œæˆæƒã€‚å› ä¸ºåŸºäº Spring æ¡†æ¶ï¼Œæ‰€ä»¥ Spring Security å……åˆ†åˆ©ç”¨äº†ä¾èµ–æ³¨å…¥ï¼ˆdependency injectionï¼ŒDIï¼‰å’Œé¢å‘åˆ‡é¢çš„æŠ€æœ¯ã€‚</p>
<p>æœ€åˆï¼ŒSpring Security è¢«ç§°ä¸º Acegi Securityã€‚Acegi æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å®‰å…¨æ¡†æ¶ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼šé‚£å°±æ˜¯éœ€è¦å¤§é‡çš„ XML é…ç½®ã€‚æˆ‘ä¸ä¼šå‘ä½ ä»‹ç»è¿™ç§å¤æ‚é…ç½®çš„ç»†èŠ‚ã€‚æ€»ä¹‹ä¸€å¥è¯ï¼Œå…¸å‹çš„ Acegi é…ç½®æœ‰å‡ ç™¾è¡Œ XML æ˜¯å¾ˆå¸¸è§çš„ã€‚</p>
<p>åˆ°äº† 2.0 ç‰ˆæœ¬ï¼ŒAcegi Security æ›´åä¸º Spring Securityã€‚ä½†æ˜¯ 2.0 å‘å¸ƒç‰ˆæœ¬æ‰€å¸¦æ¥çš„ä¸ä»…ä»…æ˜¯è¡¨é¢ä¸Šåå­—çš„å˜åŒ–ã€‚ä¸ºäº†åœ¨ Spring ä¸­é…ç½®å®‰å…¨æ€§ï¼ŒSpring Security å¼•å…¥äº†ä¸€ä¸ªå…¨æ–°çš„ã€ä¸å®‰å…¨æ€§ç›¸å…³çš„ XML å‘½åç©ºé—´ã€‚è¿™ä¸ªæ–°çš„å‘½åç©ºé—´è¿åŒæ³¨è§£å’Œä¸€äº›åˆç†çš„é»˜è®¤è®¾ç½®ï¼Œå°†å…¸å‹çš„å®‰å…¨æ€§é…ç½®ä»å‡ ç™¾è¡Œ XML å‡å°‘åˆ°åå‡ è¡Œã€‚ Spring Security 3.0 èå…¥äº†SpELï¼Œè¿™è¿›ä¸€æ­¥ç®€åŒ–äº†å®‰å…¨æ€§çš„é…ç½®ã€‚</p>
<p>å®ƒçš„æœ€æ–°ç‰ˆæœ¬ä¸º 3.2ï¼ŒSpring Security ä»ä¸¤ä¸ªè§’åº¦æ¥è§£å†³å®‰å…¨æ€§é—®é¢˜ã€‚å®ƒä½¿ç”¨ Servlet è§„èŒƒä¸­çš„ Filter ä¿æŠ¤ Web è¯·æ±‚å¹¶é™åˆ¶ URL çº§åˆ«çš„è®¿é—®ã€‚Spring Security è¿˜èƒ½å¤Ÿä½¿ç”¨ Spring AOP ä¿æŠ¤æ–¹æ³•è°ƒç”¨â€”â€”å€ŸåŠ©äºå¯¹è±¡ä»£ç†å’Œä½¿ç”¨é€šçŸ¥ï¼Œèƒ½å¤Ÿç¡®ä¿åªæœ‰å…·å¤‡é€‚å½“æƒé™çš„ç”¨æˆ·æ‰èƒ½è®¿é—®å®‰å…¨ä¿æŠ¤çš„æ–¹æ³•ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå…³æ³¨å¦‚ä½•å°† Spring Security ç”¨äº Web å±‚çš„å®‰å…¨æ€§ä¹‹ä¸­ã€‚åœ¨ç¨åçš„ç¬¬ 14 ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šé‡æ–°å­¦ä¹  Spring Securityï¼Œäº†è§£å®ƒå¦‚ä½•ä¿æŠ¤æ–¹æ³•çš„è°ƒç”¨ã€‚</p>
<h4 id="ç†è§£-Spring-Security-çš„æ¨¡å—"><a href="#ç†è§£-Spring-Security-çš„æ¨¡å—" class="headerlink" title="ç†è§£ Spring Security çš„æ¨¡å—"></a>ç†è§£ Spring Security çš„æ¨¡å—</h4><p>ä¸ç®¡ä½ æƒ³ä½¿ç”¨ Spring Security ä¿æŠ¤å“ªç§ç±»å‹çš„åº”ç”¨ç¨‹åºï¼Œç¬¬ä¸€ä»¶éœ€è¦åšçš„äº‹å°±æ˜¯å°† Spring Security æ¨¡å—æ·»åŠ åˆ°åº”ç”¨ç¨‹åºçš„ç±»è·¯å¾„ä¸‹ã€‚SpringSecurity 3.2 åˆ†ä¸º 11 ä¸ªæ¨¡å—ï¼Œå¦‚è¡¨ 9.1 æ‰€ç¤ºã€‚</p>
<center>è¡¨ 9.1ã€€ Spring Security è¢«åˆ†æˆäº† 11ä¸ª æ¨¡å—</center>

<table>
<thead>
<tr>
<th>æ¨¡ã€€ã€€å—</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>ACL</td>
<td>æ”¯æŒé€šè¿‡è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆaccess control listï¼ŒACLï¼‰ä¸ºåŸŸå¯¹è±¡æä¾›å®‰å…¨æ€§</td>
</tr>
<tr>
<td>åˆ‡é¢ï¼ˆAspectsï¼‰</td>
<td>ä¸€ä¸ªå¾ˆå°çš„æ¨¡å—ï¼Œå½“ä½¿ç”¨ Spring Security æ³¨è§£æ—¶ï¼Œä¼šä½¿ç”¨åŸºäº AspectJ çš„åˆ‡é¢ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ ‡å‡†çš„ Spring AOP</td>
</tr>
<tr>
<td>CAS å®¢æˆ·ç«¯ï¼ˆCAS Clientï¼‰</td>
<td>æä¾›ä¸ Jasig çš„ä¸­å¿ƒè®¤è¯æœåŠ¡ï¼ˆCentral Authentication Serviceï¼ŒCASï¼‰è¿›è¡Œé›†æˆçš„åŠŸèƒ½</td>
</tr>
<tr>
<td>é…ç½®ï¼ˆConfigurationï¼‰</td>
<td>åŒ…å«é€šè¿‡ XML å’Œ Java é…ç½® Spring Security çš„åŠŸèƒ½æ”¯æŒ</td>
</tr>
<tr>
<td>æ ¸å¿ƒï¼ˆCoreï¼‰</td>
<td>æä¾› Spring Security åŸºæœ¬åº“</td>
</tr>
<tr>
<td>åŠ å¯†ï¼ˆCryptographyï¼‰</td>
<td>æä¾›äº†åŠ å¯†å’Œå¯†ç ç¼–ç çš„åŠŸèƒ½</td>
</tr>
<tr>
<td>LDAP</td>
<td>æ”¯æŒåŸºäº LDAP è¿›è¡Œè®¤è¯</td>
</tr>
<tr>
<td>OpenID</td>
<td>æ”¯æŒä½¿ç”¨ OpenID è¿›è¡Œé›†ä¸­å¼è®¤è¯</td>
</tr>
<tr>
<td>Remoting</td>
<td>æä¾›äº†å¯¹ Spring Remoting çš„æ”¯æŒ</td>
</tr>
<tr>
<td>æ ‡ç­¾åº“ï¼ˆTagLibraryï¼‰</td>
<td>Spring Security çš„ JSP æ ‡ç­¾åº“</td>
</tr>
<tr>
<td>Web</td>
<td>æä¾›äº† Spring Security åŸºäº Filter çš„ Web å®‰å…¨æ€§æ”¯æŒ</td>
</tr>
</tbody></table>
<p>åº”ç”¨ç¨‹åºçš„ç±»è·¯å¾„ä¸‹è‡³å°‘è¦åŒ…å« Core å’Œ Configuration è¿™ä¸¤ä¸ªæ¨¡å—ã€‚</p>
<p>Spring Security ç»å¸¸è¢«ç”¨äºä¿æŠ¤ Web åº”ç”¨ï¼Œè¿™æ˜¾ç„¶ä¹Ÿæ˜¯ Spittr åº”ç”¨çš„åœºæ™¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦æ·»åŠ  Web æ¨¡å—ã€‚åŒæ—¶æˆ‘ä»¬è¿˜ä¼šç”¨åˆ° Spring Security çš„ JSP æ ‡ç­¾åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªæ¨¡å—ä¹Ÿæ·»åŠ è¿›æ¥ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ä¸ºåœ¨ Spring Security ä¸­è¿›è¡Œå®‰å…¨æ€§é…ç½®åšå¥½äº†å‡†å¤‡ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Spring Security çš„ XML å‘½åç©ºé—´ã€‚</p>
<h4 id="è¿‡æ»¤-Web-è¯·æ±‚"><a href="#è¿‡æ»¤-Web-è¯·æ±‚" class="headerlink" title="è¿‡æ»¤ Web è¯·æ±‚"></a>è¿‡æ»¤ Web è¯·æ±‚</h4><p>Spring Security å€ŸåŠ©ä¸€ç³»åˆ— Servlet Filter æ¥æä¾›å„ç§å®‰å…¨æ€§åŠŸèƒ½ã€‚ä½ å¯èƒ½ä¼šæƒ³ï¼Œè¿™æ˜¯å¦æ„å‘³ç€æˆ‘ä»¬éœ€è¦åœ¨ web.xml æˆ– WebApplicationInitializerä¸­ é…ç½®å¤šä¸ª Filter å‘¢ï¼Ÿå®é™…ä¸Šï¼Œå€ŸåŠ©äº Spring çš„å°æŠ€å·§ï¼Œæˆ‘ä»¬åªéœ€é…ç½®ä¸€ä¸ª Filter å°±å¯ä»¥äº†ã€‚</p>
<p>DelegatingFilterProxy æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Servlet Filterï¼Œå®ƒæœ¬èº«æ‰€åšçš„å·¥ä½œå¹¶ä¸å¤šã€‚åªæ˜¯å°†å·¥ä½œå§”æ‰˜ç»™ä¸€ä¸ª javax.servlet.Filter å®ç°ç±»ï¼Œè¿™ä¸ªå®ç°ç±»ä½œä¸ºä¸€ä¸ª <code>&lt;bean&gt;</code> æ³¨å†Œåœ¨ Spring åº”ç”¨çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå¦‚å›¾ 9.1 æ‰€ç¤ºã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211103233600856.png" alt="image-20211103233600856"></p>
<center>å›¾ 9.1ã€€DelegatingFilterProxy æŠŠ Filter çš„å¤„ç†é€»è¾‘å§”æ‰˜ç»™ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰€å®šä¹‰çš„ä¸€ä¸ªä»£ç† Filter bean</center>

<p>å¦‚æœä½ å–œæ¬¢åœ¨ä¼ ç»Ÿçš„ web.xml ä¸­é…ç½® Servlet å’Œ Filter çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>&lt;filter&gt;</code> å…ƒç´ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span>  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>  <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>    org.springframework.web.filter.DelegatingFilteProxy  <span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæœ€é‡è¦çš„æ˜¯ <code>&lt;filter-name&gt;</code> è®¾ç½®æˆäº† springSecurityFilterChainã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬é©¬ä¸Šå°±ä¼šå°† SpringSecurity é…ç½®åœ¨Webå®‰å…¨æ€§ä¹‹ä¸­ï¼Œè¿™é‡Œä¼šæœ‰ä¸€ä¸ªå<br>ä¸º springSecurityFilterChain çš„ Filterbeanï¼ŒDelegatingFilterProxy ä¼šå°†è¿‡æ»¤é€»è¾‘å§”æ‰˜ç»™å®ƒã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›å€ŸåŠ© WebApplicationInitializer ä»¥ Java çš„æ–¹å¼æ¥é…ç½® DelegatingFilterProxy çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ‰©å±•çš„æ–°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spitter.config;<span class="keyword">import</span> org.springframwork.security.web.context.AbstractSecurityWebApplicationInitializer;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityWebInitializer</span> <span class="keyword">extends</span> <span class="title">AbstractSecurityWebApplicationInitializer</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>AbstractSecurityWebApplicationInitializer å®ç°äº† WebApplication-Initializerï¼Œå› æ­¤ Spring ä¼šå‘ç°å®ƒï¼Œå¹¶ç”¨å®ƒåœ¨ Web å®¹å™¨ä¸­æ³¨å†Œ DelegatingFilterProxyã€‚å°½ç®¡æˆ‘ä»¬å¯ä»¥é‡è½½å®ƒçš„ appendFilters() æˆ– insertFilters() æ–¹æ³•æ¥æ³¨å†Œè‡ªå·±é€‰æ‹©çš„ Filterï¼Œä½†æ˜¯è¦æ³¨å†Œ DelegatingFilterProxy çš„è¯ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦é‡è½½ä»»ä½•æ–¹æ³•ã€‚</p>
<p>ä¸ç®¡æˆ‘ä»¬é€šè¿‡ web.xml è¿˜æ˜¯é€šè¿‡ AbstractSecurityWebApplicationInitializer çš„å­ç±»æ¥é…ç½® DelegatingFilterProxyï¼Œå®ƒéƒ½ä¼šæ‹¦æˆªå‘å¾€åº”ç”¨ä¸­çš„è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚å§”æ‰˜ç»™ ID ä¸º springSecurityFilterChain beanã€‚</p>
<p>springSecurityFilterChain æœ¬èº«æ˜¯å¦ä¸€ä¸ªç‰¹æ®Šçš„ Filterï¼Œå®ƒä¹Ÿè¢«ç§°ä¸º FilterChainProxyã€‚å®ƒå¯ä»¥é“¾æ¥ä»»æ„ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–çš„ Filterã€‚Spring Security ä¾èµ–ä¸€ç³»åˆ— Servlet Filter æ¥æä¾›ä¸åŒçš„å®‰å…¨ç‰¹æ€§ã€‚ä½†æ˜¯ï¼Œä½ å‡ ä¹ä¸éœ€è¦çŸ¥é“è¿™äº›ç»†èŠ‚ï¼Œå› ä¸ºä½ ä¸éœ€è¦æ˜¾å¼å£°æ˜ springSecurityFilterChain ä»¥åŠå®ƒæ‰€é“¾æ¥åœ¨ä¸€èµ·çš„å…¶ä»– Filterã€‚å½“æˆ‘ä»¬å¯ç”¨ Web å®‰å…¨æ€§çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºè¿™äº› Filterã€‚</p>
<p>ä¸ºäº†è®© Web å®‰å…¨æ€§è¿è¡Œèµ·æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæœ€ç®€å•çš„å®‰å…¨æ€§é…ç½®ã€‚</p>
<h4 id="ç¼–å†™ç®€å•çš„å®‰å…¨æ€§é…ç½®"><a href="#ç¼–å†™ç®€å•çš„å®‰å…¨æ€§é…ç½®" class="headerlink" title="ç¼–å†™ç®€å•çš„å®‰å…¨æ€§é…ç½®"></a>ç¼–å†™ç®€å•çš„å®‰å…¨æ€§é…ç½®</h4><p>åœ¨ Spring Security çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼ˆåœ¨å…¶è¿˜è¢«ç§°ä¸º Acegi Security ä¹‹æ—¶ï¼‰ï¼Œä¸ºäº†åœ¨ Web åº”ç”¨ä¸­å¯ç”¨ç®€å•çš„å®‰å…¨åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸Šç™¾è¡Œçš„ XML é…ç½®ã€‚Spring  Security 2.0 æä¾›äº†å®‰å…¨æ€§ç›¸å…³çš„ XML é…ç½®å‘½åç©ºé—´ï¼Œè®©æƒ…å†µæœ‰äº†ä¸€äº›å¥½è½¬ã€‚</p>
<p>Spring 3.2 å¼•å…¥äº†æ–°çš„ Java é…ç½®æ–¹æ¡ˆï¼Œå®Œå…¨ä¸å†éœ€è¦é€šè¿‡ XML æ¥é…ç½®å®‰å…¨æ€§åŠŸèƒ½äº†ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº† Spring Security æœ€ç®€å•çš„ Java é…ç½®ã€‚</p>
<center>ç¨‹åºæ¸…å• 9.1ã€€å¯ç”¨ Web å®‰å…¨æ€§åŠŸèƒ½çš„æœ€ç®€å•é…ç½®</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spitter.config;<span class="keyword">import</span> org.springframwork.security.web.context.AbstractSecurityWebApplicationInitializer;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityWebInitializer</span> <span class="keyword">extends</span> <span class="title">AbstractSecurityWebApplicationInitializer</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>é¡¾åæ€ä¹‰ï¼Œ@EnableWebSecurity æ³¨è§£å°†ä¼šå¯ç”¨ Web å®‰å…¨åŠŸèƒ½ã€‚ä½†å®ƒæœ¬èº«å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨å¤„ï¼ŒSpring Security å¿…é¡»é…ç½®åœ¨ä¸€ä¸ªå®ç°äº† WebSecurityConfigurer çš„beanä¸­ï¼Œæˆ–è€…ï¼ˆç®€å•èµ·è§ï¼‰æ‰©å±•WebSecurityConfigurerAdapterã€‚åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œä»»ä½•å®ç°äº† WebSecurityConfigurer çš„ bean éƒ½å¯ä»¥ç”¨æ¥é…ç½® Spring Securityï¼Œä½†æ˜¯æœ€ä¸ºç®€å•çš„æ–¹å¼è¿˜æ˜¯åƒç¨‹åºæ¸…å• 9.1 é‚£æ ·æ‰©å±• WebSecurityConfigurer Adapter ç±»ã€‚</p>
<p>@EnableWebSecurity å¯ä»¥å¯ç”¨ä»»æ„ Web åº”ç”¨çš„å®‰å…¨æ€§åŠŸèƒ½ï¼Œä¸è¿‡ï¼Œå¦‚æœä½ çš„åº”ç”¨ç¢°å·§æ˜¯ä½¿ç”¨ Spring MVC å¼€å‘çš„ï¼Œé‚£ä¹ˆå°±åº”è¯¥è€ƒè™‘ä½¿ç”¨ @EnableWebMvcSecurity æ›¿ä»£å®ƒï¼Œå¦‚ç¨‹åºæ¸…å• 9.2 æ‰€ç¤ºã€‚</p>
<center>ç¨‹åºæ¸…å• 9.2ã€€ä¸º Spring MVC å¯ç”¨ Web å®‰å…¨æ€§åŠŸèƒ½çš„æœ€ç®€å•é…ç½®</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spitter.config;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;<span class="keyword">import</span> org.springframework.security.config.annotation.web.servlet.configuration.EnableWebMvcSecurity;<span class="meta">@Configuration</span><span class="meta">@EnableWebMvcSecuritypublic</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†å…¶ä»–çš„å†…å®¹ä»¥å¤–ï¼Œ@EnableWebMvcSecurity æ³¨è§£è¿˜é…ç½®äº†ä¸€ä¸ª Spring MVC å‚æ•°è§£æè§£æå™¨ï¼ˆargument resolverï¼‰ï¼Œè¿™æ ·çš„è¯å¤„ç†å™¨æ–¹æ³•å°±èƒ½å¤Ÿé€šè¿‡å¸¦æœ‰ @AuthenticationPrincipal æ³¨è§£çš„å‚æ•°è·å¾—è®¤è¯ç”¨æˆ·çš„ principalï¼ˆæˆ– usernameï¼‰ã€‚å®ƒåŒæ—¶è¿˜é…ç½®äº†ä¸€ä¸ª beanï¼Œåœ¨ä½¿ç”¨ Spring è¡¨å•ç»‘å®šæ ‡ç­¾åº“æ¥å®šä¹‰è¡¨å•æ—¶ï¼Œè¿™ä¸ª bean ä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªéšè—çš„è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆcross-site request forgeryï¼ŒCSRFï¼‰token è¾“å…¥åŸŸã€‚</p>
<p>çœ‹èµ·æ¥ä¼¼ä¹å¹¶æ²¡æœ‰åšå¤ªå¤šçš„äº‹æƒ…ï¼Œä½†ç¨‹åºæ¸…å• 9.1 å’Œ 9.2 ä¸­çš„é…ç½®ç±»ä¼šç»™åº”ç”¨äº§ç”Ÿå¾ˆå¤§çš„å½±å“ã€‚å…¶ä¸­ä»»ä½•ä¸€ç§é…ç½®éƒ½ä¼šå°†åº”ç”¨ä¸¥æ ¼é”å®šï¼Œå¯¼è‡´æ²¡æœ‰äººèƒ½å¤Ÿè¿›å…¥è¯¥ç³»ç»Ÿäº†ï¼</p>
<p>å°½ç®¡ä¸æ˜¯ä¸¥æ ¼è¦æ±‚çš„ï¼Œä½†æˆ‘ä»¬å¯èƒ½å¸Œæœ›æŒ‡å®š Web å®‰å…¨çš„ç»†èŠ‚ï¼Œè¿™è¦é€šè¿‡é‡è½½ WebSecurityConfigurerAdapter ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•æ¥å®ç°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡è½½ WebSecurityConfigurerAdapter çš„ä¸‰ä¸ª configure() æ–¹æ³•æ¥é…ç½® Web å®‰å…¨æ€§ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šä½¿ç”¨ä¼ é€’è¿›æ¥çš„å‚æ•°è®¾ç½®è¡Œä¸ºã€‚è¡¨ 9.2 æè¿°äº†è¿™ä¸‰ä¸ªæ–¹æ³•ã€‚</p>
<center>è¡¨ 9.2ã€€é‡è½½ WebSecurityConfigurerAdapter çš„ configure() æ–¹æ³•</center>

<table>
<thead>
<tr>
<th>æ–¹ã€€ã€€æ³•</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>configure(WebSecurity)</td>
<td>é€šè¿‡é‡è½½ï¼Œé…ç½®Spring Securityçš„Filteré“¾</td>
</tr>
<tr>
<td>configure(HttpSecurity)</td>
<td>é€šè¿‡é‡è½½ï¼Œé…ç½®å¦‚ä½•é€šè¿‡æ‹¦æˆªå™¨ä¿æŠ¤è¯·æ±‚</td>
</tr>
<tr>
<td>configure(AuthenticationManagerBuilder)</td>
<td>é€šè¿‡é‡è½½ï¼Œé…ç½®user-detailæœåŠ¡</td>
</tr>
</tbody></table>
<p>è®©æˆ‘ä»¬é‡æ–°çœ‹ä¸€ä¸‹ç¨‹åºæ¸…å• 9.2ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ²¡æœ‰é‡å†™ä¸Šè¿°ä¸‰ä¸ª configure() æ–¹æ³•ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œè¿™å°±è¯´æ˜äº†ä¸ºä»€ä¹ˆåº”ç”¨ç°åœ¨æ˜¯è¢«é”å®šçš„ã€‚å°½ç®¡å¯¹äºæˆ‘ä»¬çš„éœ€æ±‚æ¥è®²é»˜è®¤çš„ Filter é“¾æ˜¯ä¸é”™çš„ï¼Œä½†æ˜¯é»˜è®¤çš„ configure(HttpSecurity) å®é™…ä¸Šç­‰åŒäºå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;  http    .authorizeRequests()    .anyRequest().authorized()    .and()    .formLogin()    .and()    .httpBasic();&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç®€å•çš„é»˜è®¤é…ç½®æŒ‡å®šäº†è¯¥å¦‚ä½•ä¿æŠ¤ HTTP è¯·æ±‚ï¼Œä»¥åŠå®¢æˆ·ç«¯è®¤è¯ç”¨æˆ·çš„æ–¹æ¡ˆã€‚é€šè¿‡è°ƒç”¨ authorizeRequests() å’Œ anyRequest().authenticated() å°±ä¼šè¦æ±‚æ‰€æœ‰è¿›å…¥åº”ç”¨çš„ HTTP è¯·æ±‚éƒ½è¦è¿›è¡Œè®¤è¯ã€‚å®ƒä¹Ÿé…ç½® Spring Security æ”¯æŒåŸºäºè¡¨å•çš„ç™»å½•ä»¥åŠ HTTP Basic æ–¹å¼çš„è®¤è¯ã€‚</p>
<p>åŒæ—¶ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰é‡è½½ configure(AuthenticationManagerBuilder) æ–¹æ³•ï¼Œæ‰€ä»¥æ²¡æœ‰ç”¨æˆ·å­˜å‚¨æ”¯æ’‘è®¤è¯è¿‡ç¨‹ã€‚æ²¡æœ‰ç”¨æˆ·å­˜å‚¨ï¼Œå®é™…ä¸Šå°±ç­‰äºæ²¡æœ‰ç”¨æˆ·ã€‚æ‰€ä»¥ï¼Œåœ¨è¿™é‡Œæ‰€æœ‰çš„è¯·æ±‚éƒ½éœ€è¦è®¤è¯ï¼Œä½†æ˜¯æ²¡æœ‰äººèƒ½å¤Ÿç™»å½•æˆåŠŸã€‚</p>
<p>ä¸ºäº†è®© Spring Security æ»¡è¶³æˆ‘ä»¬åº”ç”¨çš„éœ€æ±‚ï¼Œè¿˜éœ€è¦å†æ·»åŠ ä¸€ç‚¹é…ç½®ã€‚å…·ä½“æ¥è®²ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p>
<ul>
<li>é…ç½®ç”¨æˆ·å­˜å‚¨ï¼›</li>
<li>æŒ‡å®šå“ªäº›è¯·æ±‚éœ€è¦è®¤è¯ï¼Œå“ªäº›è¯·æ±‚ä¸éœ€è¦è®¤è¯ï¼Œä»¥åŠæ‰€éœ€è¦çš„æƒé™ï¼›</li>
<li>æä¾›ä¸€ä¸ªè‡ªå®šä¹‰çš„ç™»å½•é¡µé¢ï¼Œæ›¿ä»£åŸæ¥ç®€å•çš„é»˜è®¤ç™»å½•é¡µã€‚</li>
</ul>
<p>é™¤äº† Spring Security çš„è¿™äº›åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜å¸Œæœ›åŸºäºå®‰å…¨é™åˆ¶ï¼Œæœ‰é€‰æ‹©æ€§åœ°åœ¨ Web è§†å›¾ä¸Šæ˜¾ç¤ºç‰¹å®šçš„å†…å®¹ã€‚</p>
<p>ä½†é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨è®¤è¯çš„è¿‡ç¨‹ä¸­é…ç½®è®¿é—®ç”¨æˆ·æ•°æ®çš„æœåŠ¡ã€‚</p>
<h3 id="é€‰æ‹©æŸ¥è¯¢ç”¨æˆ·è¯¦ç»†ä¿¡æ¯çš„æœåŠ¡"><a href="#é€‰æ‹©æŸ¥è¯¢ç”¨æˆ·è¯¦ç»†ä¿¡æ¯çš„æœåŠ¡" class="headerlink" title="é€‰æ‹©æŸ¥è¯¢ç”¨æˆ·è¯¦ç»†ä¿¡æ¯çš„æœåŠ¡"></a>é€‰æ‹©æŸ¥è¯¢ç”¨æˆ·è¯¦ç»†ä¿¡æ¯çš„æœåŠ¡</h3><p>å‡å¦‚ä½ è®¡åˆ’å»ä¸€ä¸ªç‹¬å®¶ç»è¥çš„é¥­åº—äº«å—ä¸€é¡¿æ™šé¤ï¼Œå½“ç„¶ï¼Œä½ ä¼šæå‰å‡ å‘¨é¢„è®¢ï¼Œä¿è¯åˆ°æ—¶å€™èƒ½æœ‰ä¸€ä¸ªä½ç½®ã€‚å½“åˆ°è¾¾é¥­åº—çš„æ—¶å€™ï¼Œä½ ä¼šå‘Šè¯‰æœåŠ¡å‘˜ä½ çš„åå­—ã€‚ä½†ä»¤äººé—æ†¾çš„æ˜¯ï¼Œé‡Œé¢å¹¶æ²¡æœ‰ä½ çš„é¢„è®¢è®°å½•ã€‚ç¾å¥½çš„å¤œæ™šçœ¼çœ‹å°±è¦æ³¡æ±¤äº†ã€‚ä½†æ˜¯æ²¡æœ‰äººä¼šå¦‚æ­¤è½»æ˜“åœ°æ”¾å¼ƒï¼Œä½ ä¼šè¦æ±‚æœåŠ¡å‘˜å†æ¬¡ç¡®è®¤é¢„è®¢åå•ã€‚æ­¤æ—¶ï¼Œäº‹æƒ…å˜å¾—æœ‰äº›æ€ªå¼‚äº†ã€‚</p>
<p>æœåŠ¡å‘˜è¯´æ²¡æœ‰é¢„è®¢åå•ã€‚ä½ çš„åå­—ä¸åœ¨åå•ä¸Šâ€”â€”åå•ä¸Šæ²¡æœ‰ä»»ä½•äººâ€”â€”å› ä¸ºæ ¹æœ¬å°±ä¸å­˜åœ¨è¿™ä¹ˆä¸ªåå•ã€‚è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆä½ç½®æ˜¯ç©ºçš„ï¼Œä½†æˆ‘ä»¬å´è¿›ä¸å»ã€‚å‡ å‘¨åï¼Œæˆ‘ä»¬ä¹Ÿå°±æ˜ç™½è¿™å®¶é¥­åº—ä¸ºä½•æœ€ç»ˆä¼šå…³é—¨å¤§å‰ï¼Œè¢«ä¸€å®¶å¢¨è¥¿å“¥ç¾é£Ÿåº—æ‰€ä»£æ›¿ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯æ­¤æ—¶æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„ç°çŠ¶ã€‚æˆ‘ä»¬æ²¡æœ‰åŠæ³•è¿›å…¥åº”ç”¨ï¼Œå³ä¾¿ç”¨æˆ·è®¤ä¸ºä»–ä»¬åº”è¯¥èƒ½å¤Ÿç™»å½•è¿›å»ï¼Œä½†å®é™…ä¸Šå´æ²¡æœ‰å…è®¸ä»–ä»¬è®¿é—®åº”ç”¨çš„æ•°æ®è®°å½•ã€‚å› ä¸ºç¼ºå°‘ç”¨æˆ·å­˜å‚¨ï¼Œç°åœ¨çš„åº”ç”¨ç¨‹åºå¤ªå°é—­äº†ï¼Œå˜å¾—ä¸å¯ç”¨ã€‚</p>
<p>æˆ‘ä»¬æ‰€éœ€è¦çš„æ˜¯ç”¨æˆ·å­˜å‚¨ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·åã€å¯†ç ä»¥åŠå…¶ä»–ä¿¡æ¯å­˜å‚¨çš„åœ°æ–¹ï¼Œåœ¨è¿›è¡Œè®¤è¯å†³ç­–çš„æ—¶å€™ï¼Œä¼šå¯¹å…¶è¿›è¡Œæ£€ç´¢ã€‚</p>
<p>å¥½æ¶ˆæ¯æ˜¯ï¼ŒSpring Security éå¸¸çµæ´»ï¼Œèƒ½å¤ŸåŸºäºå„ç§æ•°æ®å­˜å‚¨æ¥è®¤è¯ç”¨æˆ·ã€‚å®ƒå†…ç½®äº†å¤šç§å¸¸è§çš„ç”¨æˆ·å­˜å‚¨åœºæ™¯ï¼Œå¦‚å†…å­˜ã€å…³ç³»å‹æ•°æ®åº“ä»¥åŠ LDAPã€‚ä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥ç¼–å†™å¹¶æ’å…¥è‡ªå®šä¹‰çš„ç”¨æˆ·å­˜å‚¨å®ç°ã€‚</p>
<p>å€ŸåŠ© Spring Security çš„ Java é…ç½®ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°é…ç½®ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å­˜å‚¨æ–¹æ¡ˆã€‚é‚£æˆ‘ä»¬å°±ä»æœ€ç®€å•çš„å¼€å§‹ï¼šåœ¨å†…å­˜ä¸­ç»´æŠ¤ç”¨æˆ·å­˜å‚¨ã€‚</p>
<h4 id="ä½¿ç”¨åŸºäºå†…å­˜çš„ç”¨æˆ·å­˜å‚¨"><a href="#ä½¿ç”¨åŸºäºå†…å­˜çš„ç”¨æˆ·å­˜å‚¨" class="headerlink" title="ä½¿ç”¨åŸºäºå†…å­˜çš„ç”¨æˆ·å­˜å‚¨"></a>ä½¿ç”¨åŸºäºå†…å­˜çš„ç”¨æˆ·å­˜å‚¨</h4><p>å› ä¸ºæˆ‘ä»¬çš„å®‰å…¨é…ç½®ç±»æ‰©å±•äº† WebSecurityConfigurerAdapterï¼Œå› æ­¤é…ç½®ç”¨æˆ·å­˜å‚¨çš„æœ€ç®€å•æ–¹å¼å°±æ˜¯é‡è½½ configure() æ–¹æ³•ï¼Œå¹¶ä»¥ AuthenticationManagerBuilder ä½œä¸ºä¼ å…¥å‚æ•°ã€‚AuthenticationManagerBuilder æœ‰å¤šä¸ªæ–¹æ³•å¯ä»¥ç”¨æ¥é…ç½® Spring Security å¯¹è®¤è¯çš„æ”¯æŒã€‚é€šè¿‡ inMemoryAuthentication() æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¯ç”¨ã€é…ç½®å¹¶ä»»æ„å¡«å……åŸºäºå†…å­˜çš„ç”¨æˆ·å­˜å‚¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨å¦‚ç¨‹åºæ¸…å• 9.3 ä¸­ï¼ŒSecurityConfig é‡è½½äº† configure() æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨ä¸¤ä¸ªç”¨æˆ·æ¥é…ç½®å†…å­˜ç”¨æˆ·å­˜å‚¨ã€‚</p>
<center>ç¨‹åºæ¸…å• 9.3ã€€é…ç½® Spring Security ä½¿ç”¨å†…å­˜ç”¨æˆ·å­˜å‚¨</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.config;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;<span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;<span class="keyword">import</span> org.springframework.security.config.annotation.web.servlet.configuration.EnableWebMvcSecurity;<span class="meta">@Configuration</span><span class="meta">@EnableWebMvcSecuritypublic</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;      <span class="meta">@Override</span>    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;        auth            .inMemoryAuthentication()            .withUser(<span class="string">&quot;user&quot;</span>).password(<span class="string">&quot;password&quot;</span>).roles(<span class="string">&quot;USER&quot;</span>).and()            .withUser(<span class="string">&quot;admin&quot;</span>).password(<span class="string">&quot;password&quot;</span>).roles(<span class="string">&quot;USER&quot;</span>,<span class="string">&quot;ADMIN&quot;</span>);    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œconfigure() æ–¹æ³•ä¸­çš„ AuthenticationManagerBuilder ä½¿ç”¨æ„é€ è€…é£æ ¼çš„æ¥å£æ¥æ„å»ºè®¤è¯é…ç½®ã€‚é€šè¿‡ç®€å•åœ°è°ƒç”¨ inMemoryAuthentication() å°±èƒ½å¯ç”¨å†…å­˜ç”¨æˆ·å­˜å‚¨ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦æœ‰ä¸€äº›ç”¨æˆ·ï¼Œå¦åˆ™çš„è¯ï¼Œè¿™å’Œæ²¡æœ‰ç”¨æˆ·å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ withUser() æ–¹æ³•ä¸ºå†…å­˜ç”¨æˆ·å­˜å‚¨æ·»åŠ æ–°çš„ç”¨æˆ·ï¼Œè¿™ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯ usernameã€‚withUser() æ–¹æ³•è¿”å›çš„æ˜¯ UserDetailsManagerConfigurer.UserDetailsBuilderï¼Œè¿™ä¸ªå¯¹è±¡æä¾›äº†å¤šä¸ªè¿›ä¸€æ­¥é…ç½®ç”¨æˆ·çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬è®¾ç½®ç”¨æˆ·å¯†ç çš„ password() æ–¹æ³•ä»¥åŠä¸ºç»™å®šç”¨æˆ·æˆäºˆä¸€ä¸ªæˆ–å¤šä¸ªè§’è‰²æƒé™çš„ roles() æ–¹æ³•ã€‚</p>
<p>åœ¨ç¨‹åºæ¸…å• 9.3 ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸¤ä¸ªç”¨æˆ·ï¼Œâ€œuserâ€ å’Œ â€œadminâ€ï¼Œå¯†ç å‡ä¸º â€œpasswordâ€ã€‚â€œuserâ€ ç”¨æˆ·å…·æœ‰ USER è§’è‰²ï¼Œè€Œ â€œadminâ€ ç”¨æˆ·å…·æœ‰ ADMIN å’Œ USER ä¸¤ä¸ªè§’è‰²ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œand() æ–¹æ³•èƒ½å¤Ÿå°†å¤šä¸ªç”¨æˆ·çš„é…ç½®è¿æ¥èµ·æ¥ã€‚</p>
<p>é™¤äº† password()ã€roles() å’Œ and() æ–¹æ³•ä»¥å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„å‡ ä¸ªæ–¹æ³•å¯ä»¥ç”¨æ¥é…ç½®å†…å­˜ç”¨æˆ·å­˜å‚¨ä¸­çš„ç”¨æˆ·ä¿¡æ¯ã€‚è¡¨ 9.3 æè¿°äº†UserDetailsManagerConfigurer.UserDetailsBuilder å¯¹è±¡æ‰€æœ‰å¯ç”¨çš„æ–¹æ³•ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œroles() æ–¹æ³•æ˜¯ authorities() æ–¹æ³•çš„ç®€å†™å½¢å¼ã€‚roles() æ–¹æ³•æ‰€ç»™å®šçš„å€¼éƒ½ä¼šæ·»åŠ ä¸€ä¸ª â€œROLE_â€ å‰ç¼€ï¼Œå¹¶å°†å…¶ä½œä¸ºæƒé™æˆäºˆç»™ç”¨æˆ·ã€‚å®é™…ä¸Šï¼Œå¦‚ä¸‹çš„ç”¨æˆ·é…ç½®ä¸ç¨‹åºæ¸…å•9.3æ˜¯ç­‰ä»·çš„</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auth  .inMemoryAuthentication()  .withUser(<span class="string">&quot;user&quot;</span>).password(<span class="string">&quot;password&quot;</span>).authorities(<span class="string">&quot;ROLE_USER&quot;</span>)  .and()  .withUser(<span class="string">&quot;admin&quot;</span>).password(<span class="string">&quot;password&quot;</span>).authorities(<span class="string">&quot;ROLE_USER&quot;</span>, <span class="string">&quot;ROLE_ADMIN&quot;</span>);</span><br></pre></td></tr></table></figure>

<center>è¡¨ 9.3ã€€é…ç½®ç”¨æˆ·è¯¦ç»†ä¿¡æ¯çš„æ–¹æ³•</center>

<table>
<thead>
<tr>
<th>æ–¹ã€€ã€€æ³•</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>accountExpired(boolean)</td>
<td>å®šä¹‰è´¦å·æ˜¯å¦å·²ç»è¿‡æœŸ</td>
</tr>
<tr>
<td>accountLocked(boolean)</td>
<td>å®šä¹‰è´¦å·æ˜¯å¦å·²ç»é”å®š</td>
</tr>
<tr>
<td>and()</td>
<td>ç”¨æ¥è¿æ¥é…ç½®</td>
</tr>
<tr>
<td>authorities(GrantedAuthorityâ€¦)</td>
<td>æˆäºˆæŸä¸ªç”¨æˆ·ä¸€é¡¹æˆ–å¤šé¡¹æƒé™</td>
</tr>
<tr>
<td>authorities(List&lt;? extends GrantedAuthority&gt;)</td>
<td>æˆäºˆæŸä¸ªç”¨æˆ·ä¸€é¡¹æˆ–å¤šé¡¹æƒé™</td>
</tr>
<tr>
<td>authorities(Stringâ€¦)</td>
<td>æˆäºˆæŸä¸ªç”¨æˆ·ä¸€é¡¹æˆ–å¤šé¡¹æƒé™</td>
</tr>
<tr>
<td>credentialsExpired(boolean)</td>
<td>å®šä¹‰å‡­è¯æ˜¯å¦å·²ç»è¿‡æœŸ</td>
</tr>
<tr>
<td>disabled(boolean)</td>
<td>å®šä¹‰è´¦å·æ˜¯å¦å·²è¢«ç¦ç”¨</td>
</tr>
<tr>
<td>password(String)</td>
<td>å®šä¹‰ç”¨æˆ·çš„å¯†ç </td>
</tr>
<tr>
<td>roles(Stringâ€¦)</td>
<td>æˆäºˆæŸä¸ªç”¨æˆ·ä¸€é¡¹æˆ–å¤šé¡¹è§’è‰²</td>
</tr>
</tbody></table>
<p>å¯¹äºè°ƒè¯•å’Œå¼€å‘äººå‘˜æµ‹è¯•æ¥è®²ï¼ŒåŸºäºå†…å­˜çš„ç”¨æˆ·å­˜å‚¨æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œä½†æ˜¯å¯¹äºç”Ÿäº§çº§åˆ«çš„åº”ç”¨æ¥è®²ï¼Œè¿™å°±ä¸æ˜¯æœ€ç†æƒ³çš„å¯é€‰æ–¹æ¡ˆäº†ã€‚ä¸ºäº†ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œé€šå¸¸æœ€å¥½å°†ç”¨æˆ·æ•°æ®ä¿å­˜åœ¨æŸç§ç±»å‹çš„æ•°æ®åº“ä¹‹ä¸­ã€‚</p>
<h4 id="åŸºäºæ•°æ®åº“è¡¨è¿›è¡Œè®¤è¯"><a href="#åŸºäºæ•°æ®åº“è¡¨è¿›è¡Œè®¤è¯" class="headerlink" title="åŸºäºæ•°æ®åº“è¡¨è¿›è¡Œè®¤è¯"></a>åŸºäºæ•°æ®åº“è¡¨è¿›è¡Œè®¤è¯</h4><p>ç”¨æˆ·æ•°æ®é€šå¸¸ä¼šå­˜å‚¨åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œå¹¶é€šè¿‡ JDBC è¿›è¡Œè®¿é—®ã€‚ä¸ºäº†é…ç½® Spring Security ä½¿ç”¨ä»¥ JDBC ä¸ºæ”¯æ’‘çš„ç”¨æˆ·å­˜å‚¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ jdbcAuthentication() æ–¹æ³•ï¼Œæ‰€éœ€çš„æœ€å°‘é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutowiredDataSource</span> dataSource;<span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;  auth    .jdbcAuthentication()    .dataSource(dataSource);&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¿…é¡»è¦é…ç½®çš„åªæ˜¯ä¸€ä¸ª DataSourceï¼Œè¿™æ ·çš„è¯ï¼Œå°±èƒ½è®¿é—®å…³ç³»å‹æ•°æ®åº“äº†ã€‚åœ¨è¿™é‡Œï¼ŒDataSource æ˜¯é€šè¿‡è‡ªåŠ¨è£…é…çš„æŠ€å·§å¾—åˆ°çš„ã€‚</p>
<p>é‡å†™é»˜è®¤çš„ç”¨æˆ·æŸ¥è¯¢åŠŸèƒ½</p>
<p>å°½ç®¡é»˜è®¤çš„æœ€å°‘é…ç½®èƒ½å¤Ÿè®©ä¸€åˆ‡è¿è½¬èµ·æ¥ï¼Œä½†æ˜¯å®ƒå¯¹æˆ‘ä»¬çš„æ•°æ®åº“æ¨¡å¼æœ‰ä¸€äº›è¦æ±‚ã€‚å®ƒé¢„æœŸå­˜åœ¨æŸäº›å­˜å‚¨ç”¨æˆ·æ•°æ®çš„è¡¨ã€‚æ›´å…·ä½“æ¥è¯´ï¼Œä¸‹é¢çš„ä»£ç ç‰‡æ®µæ¥æºäº Spring Security å†…éƒ¨ï¼Œè¿™å—ä»£ç å±•ç°äº†å½“æŸ¥æ‰¾ç”¨æˆ·ä¿¡æ¯æ—¶æ‰€æ‰§è¡Œçš„ SQL æŸ¥è¯¢è¯­å¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEF_USERS_BY_USERNAME_QUERY =  <span class="string">&quot;select username, password, enabled &quot;</span> +  <span class="string">&quot;from users &quot;</span> +  <span class="string">&quot;where username = ?&quot;</span>;<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEF_AUTHORITIES_BY_USERNAME_QUERY =  <span class="string">&quot;select username, authority &quot;</span> +  <span class="string">&quot;from authorities &quot;</span> +  <span class="string">&quot;where username = ?&quot;</span>;<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEF_GROUP_AUTHORITIES_BY_USERNAME_QUERY =  <span class="string">&quot;select g.id, g.group_name, ga.authority &quot;</span> +  <span class="string">&quot;from groups g, group_members gm, group_authorities ga &quot;</span> +  <span class="string">&quot;where gm.username = ? &quot;</span> +  <span class="string">&quot;and g.id = ga.group_id &quot;</span> +  <span class="string">&quot;and g.id = gm.group_id&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¬¬ä¸€ä¸ªæŸ¥è¯¢ä¸­ï¼Œæˆ‘ä»¬è·å–äº†ç”¨æˆ·çš„ç”¨æˆ·åã€å¯†ç ä»¥åŠæ˜¯å¦å¯ç”¨çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šç”¨æ¥è¿›è¡Œç”¨æˆ·è®¤è¯ã€‚æ¥ä¸‹æ¥çš„æŸ¥è¯¢æŸ¥æ‰¾äº†ç”¨æˆ·æ‰€æˆäºˆçš„æƒé™ï¼Œç”¨æ¥è¿›è¡Œé‰´æƒï¼Œæœ€åä¸€ä¸ªæŸ¥è¯¢ä¸­ï¼ŒæŸ¥æ‰¾äº†ç”¨æˆ·ä½œä¸ºç¾¤ç»„çš„æˆå‘˜æ‰€æˆäºˆçš„æƒé™ã€‚</p>
<p>å¦‚æœä½ èƒ½å¤Ÿåœ¨æ•°æ®åº“ä¸­å®šä¹‰å’Œå¡«å……æ»¡è¶³è¿™äº›æŸ¥è¯¢çš„è¡¨ï¼Œé‚£ä¹ˆåŸºæœ¬ä¸Šå°±ä¸éœ€è¦ä½ å†åšä»€ä¹ˆé¢å¤–çš„äº‹æƒ…äº†ã€‚ä½†æ˜¯ï¼Œä¹Ÿæœ‰å¯èƒ½ä½ çš„æ•°æ®åº“ä¸ä¸Šé¢æ‰€è¿°å¹¶ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆä½ å°±ä¼šå¸Œæœ›åœ¨æŸ¥è¯¢ä¸Šæœ‰æ›´å¤šçš„æ§åˆ¶æƒã€‚å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼é…ç½®è‡ªå·±çš„æŸ¥è¯¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;  auth    .jdbcAuthentication()    .dataSource(dataSource)    .usersByUsernameQuery(      <span class="string">&quot;select username, password, true &quot;</span> +      <span class="string">&quot;from Spitter where username=?&quot;</span>)    .authoritiesByUsernameQuery(      <span class="string">&quot;select username, &#x27;ROLE_USER&#x27; from Spitter where username=?&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬åªé‡å†™äº†è®¤è¯å’ŒåŸºæœ¬æƒé™çš„æŸ¥è¯¢è¯­å¥ï¼Œä½†æ˜¯é€šè¿‡è°ƒç”¨ group-AuthoritiesByUsername() æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿå°†ç¾¤ç»„æƒé™é‡å†™ä¸ºè‡ªå®šä¹‰çš„æŸ¥è¯¢è¯­å¥ã€‚</p>
<p>å°†é»˜è®¤çš„ SQL æŸ¥è¯¢æ›¿æ¢ä¸ºè‡ªå®šä¹‰çš„è®¾è®¡æ—¶ï¼Œå¾ˆé‡è¦çš„ä¸€ç‚¹å°±æ˜¯è¦éµå¾ªæŸ¥è¯¢çš„åŸºæœ¬åè®®ã€‚æ‰€æœ‰æŸ¥è¯¢éƒ½å°†ç”¨æˆ·åä½œä¸ºå”¯ä¸€çš„å‚æ•°ã€‚è®¤è¯æŸ¥è¯¢ä¼šé€‰å–ç”¨æˆ·åã€å¯†ç ä»¥åŠå¯ç”¨çŠ¶æ€ä¿¡æ¯ã€‚æƒé™æŸ¥è¯¢ä¼šé€‰å–é›¶è¡Œæˆ–å¤šè¡ŒåŒ…å«è¯¥ç”¨æˆ·ååŠå…¶æƒé™ä¿¡æ¯çš„æ•°æ®ã€‚ç¾¤ç»„æƒé™æŸ¥è¯¢ä¼šé€‰å–é›¶è¡Œæˆ–å¤šè¡Œæ•°æ®ï¼Œæ¯è¡Œæ•°æ®ä¸­éƒ½ä¼šåŒ…å«ç¾¤ç»„ IDã€ç¾¤ç»„åç§°ä»¥åŠæƒé™ã€‚</p>
<p>ä½¿ç”¨è½¬ç åçš„å¯†ç </p>
<p>çœ‹ä¸€ä¸‹ä¸Šé¢çš„è®¤è¯æŸ¥è¯¢ï¼Œå®ƒä¼šé¢„æœŸç”¨æˆ·å¯†ç å­˜å‚¨åœ¨äº†æ•°æ®åº“ä¹‹ä¸­ã€‚è¿™é‡Œå”¯ä¸€çš„é—®é¢˜åœ¨äºå¦‚æœå¯†ç æ˜æ–‡å­˜å‚¨çš„è¯ï¼Œä¼šå¾ˆå®¹æ˜“å—åˆ°é»‘å®¢çš„çªƒå–ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ•°æ®åº“ä¸­çš„å¯†ç è¿›è¡Œäº†è½¬ç çš„è¯ï¼Œé‚£ä¹ˆè®¤è¯å°±ä¼šå¤±è´¥ï¼Œå› ä¸ºå®ƒä¸ç”¨æˆ·æäº¤çš„æ˜æ–‡å¯†ç å¹¶ä¸åŒ¹é…ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ© passwordEncoder() æ–¹æ³•æŒ‡å®šä¸€ä¸ªå¯†ç è½¬ç å™¨ï¼ˆencoderï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;  auth    .jdbcAuthentication()    .dataSource(dataSource)    .usersByUsernameQuery(      <span class="string">&quot;select username, password, true &quot;</span> +      <span class="string">&quot;from Spitter where username=?&quot;</span>)    .authoritiesByUsernameQuery(      <span class="string">&quot;select username, &#x27;ROLE_USER&#x27; from Spitter where username=?&quot;</span>)    .passwordEncoder(<span class="keyword">new</span> StandardPasswordEnconder(<span class="string">&quot;53cr3t&quot;</span>));&#125;</span><br></pre></td></tr></table></figure>

<p>passwordEncoder() æ–¹æ³•å¯ä»¥æ¥å— Spring Security ä¸­ PasswordEncoder æ¥å£çš„ä»»æ„å®ç°ã€‚Spring Security çš„åŠ å¯†æ¨¡å—åŒ…æ‹¬äº†ä¸‰ä¸ªè¿™æ ·çš„å®ç°ï¼šBCryptPasswordEncoderã€NoOpPasswordEncoder å’Œ StandardPasswordEncoderã€‚</p>
<p>ä¸Šè¿°çš„ä»£ç ä¸­ä½¿ç”¨äº† StandardPasswordEncoderï¼Œä½†æ˜¯å¦‚æœå†…ç½®çš„å®ç°æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œä½ å¯ä»¥æä¾›è‡ªå®šä¹‰çš„å®ç°ã€‚PasswordEncoder æ¥å£éå¸¸ç®€å•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PasswordEncoder</span> </span>&#123;  <span class="function">String <span class="title">encode</span><span class="params">(CharSequence rawPassword)</span></span>;  <span class="function"><span class="keyword">boolean</span> <span class="title">matched</span><span class="params">(CharSequence rawPassword, String encodedPassword)</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡ä½ ä½¿ç”¨å“ªä¸€ä¸ªå¯†ç è½¬ç å™¨ï¼Œéƒ½éœ€è¦ç†è§£çš„ä¸€ç‚¹æ˜¯ï¼Œæ•°æ®åº“ä¸­çš„å¯†ç æ˜¯æ°¸è¿œä¸ä¼šè§£ç çš„ã€‚æ‰€é‡‡å–çš„ç­–ç•¥ä¸ä¹‹ç›¸åï¼Œç”¨æˆ·åœ¨ç™»å½•æ—¶è¾“å…¥çš„å¯†ç ä¼šæŒ‰ç…§ç›¸åŒçš„ç®—æ³•è¿›è¡Œè½¬ç ï¼Œç„¶åå†ä¸æ•°æ®åº“ä¸­å·²ç»è½¬ç è¿‡çš„å¯†ç è¿›è¡Œå¯¹æ¯”ã€‚è¿™ä¸ªå¯¹æ¯”æ˜¯åœ¨ PasswordEncoder çš„ matches() æ–¹æ³•ä¸­è¿›è¡Œçš„ã€‚</p>
<h4 id="åŸºäº-LDAP-è¿›è¡Œè®¤è¯"><a href="#åŸºäº-LDAP-è¿›è¡Œè®¤è¯" class="headerlink" title="åŸºäº LDAP è¿›è¡Œè®¤è¯"></a>åŸºäº LDAP è¿›è¡Œè®¤è¯</h4><p>ä¸ºäº†è®© Spring Security ä½¿ç”¨åŸºäº LDAP çš„è®¤è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ldapAuthentication() æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•åœ¨åŠŸèƒ½ä¸Šç±»ä¼¼äº jdbcAuthentication()ï¼Œåªä¸è¿‡æ˜¯ LDAP ç‰ˆæœ¬ã€‚å¦‚ä¸‹çš„ configure() æ–¹æ³•å±•ç°äº† LDAP è®¤è¯çš„ç®€å•é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;  auth    .ldapAuthentication()    .userSearchFilter(<span class="string">&quot;&#123;uid=&#123;0&#125;&#125;&quot;</span>)    .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³• userSearchFilter() å’Œ groupSearchFilter() ç”¨æ¥ä¸ºåŸºç¡€ LDAP æŸ¥è¯¢æä¾›è¿‡æ»¤æ¡ä»¶ï¼Œå®ƒä»¬åˆ†åˆ«ç”¨äºæœç´¢ç”¨æˆ·å’Œç»„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹äºç”¨æˆ·å’Œç»„çš„åŸºç¡€æŸ¥è¯¢éƒ½æ˜¯ç©ºçš„ï¼Œä¹Ÿå°±æ˜¯è¡¨æ˜æœç´¢ä¼šåœ¨ LDAP å±‚çº§ç»“æ„çš„æ ¹å¼€å§‹ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å®šæŸ¥è¯¢åŸºç¡€æ¥æ”¹å˜è¿™ä¸ªé»˜è®¤è¡Œä¸ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;  auth    .ldapAuthentication()    .userSearchBase(<span class="string">&quot;ou=people&quot;</span>);    .userSearchFilter(<span class="string">&quot;&#123;uid=&#123;0&#125;&#125;&quot;</span>)    .groupSearchBase(<span class="string">&quot;ou=groups&quot;</span>);    .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>userSearchBase() å±æ€§ä¸ºæŸ¥æ‰¾ç”¨æˆ·æä¾›äº†åŸºç¡€æŸ¥è¯¢ã€‚åŒæ ·ï¼ŒgroupSearchBase() ä¸ºæŸ¥æ‰¾ç»„æŒ‡å®šäº†åŸºç¡€æŸ¥è¯¢ã€‚æˆ‘ä»¬å£°æ˜ç”¨æˆ·åº”è¯¥åœ¨åä¸º people çš„ç»„ç»‡å•å…ƒä¸‹æœç´¢è€Œä¸æ˜¯ä»æ ¹å¼€å§‹ã€‚è€Œç»„åº”è¯¥åœ¨åä¸º groups çš„ç»„ç»‡å•å…ƒä¸‹æœç´¢ã€‚</p>
<p>é…ç½®å¯†ç æ¯”å¯¹</p>
<p>åŸºäº LDAP è¿›è¡Œè®¤è¯çš„é»˜è®¤ç­–ç•¥æ˜¯è¿›è¡Œç»‘å®šæ“ä½œï¼Œç›´æ¥é€šè¿‡ LDAP æœåŠ¡å™¨è®¤è¯ç”¨æˆ·ã€‚å¦ä¸€ç§å¯é€‰çš„æ–¹å¼æ˜¯è¿›è¡Œæ¯”å¯¹æ“ä½œã€‚è¿™æ¶‰åŠå°†è¾“å…¥çš„å¯†ç å‘é€åˆ° LDAP ç›®å½•ä¸Šï¼Œå¹¶è¦æ±‚æœåŠ¡å™¨å°†è¿™ä¸ªå¯†ç å’Œç”¨æˆ·çš„å¯†ç è¿›è¡Œæ¯”å¯¹ã€‚å› ä¸ºæ¯”å¯¹æ˜¯åœ¨ LDAP æœåŠ¡å™¨å†…å®Œæˆçš„ï¼Œå®é™…çš„å¯†ç èƒ½ä¿æŒç§å¯†ã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›é€šè¿‡å¯†ç æ¯”å¯¹è¿›è¡Œè®¤è¯ï¼Œå¯ä»¥é€šè¿‡å£°æ˜ passwordCompare() æ–¹æ³•æ¥å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;  auth    .ldapAuthentication()    .userSearchBase(<span class="string">&quot;ou=people&quot;</span>);    .userSearchFilter(<span class="string">&quot;&#123;uid=&#123;0&#125;&#125;&quot;</span>)    .groupSearchBase(<span class="string">&quot;ou=groups&quot;</span>);    .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>)    .passwordCompare();&#125;</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ç™»å½•è¡¨å•ä¸­æä¾›çš„å¯†ç å°†ä¼šä¸ç”¨æˆ·çš„ LDAP æ¡ç›®ä¸­çš„ userPassword å±æ€§è¿›è¡Œæ¯”å¯¹ã€‚å¦‚æœå¯†ç è¢«ä¿å­˜åœ¨ä¸åŒçš„å±æ€§ä¸­ï¼Œå¯ä»¥é€šè¿‡ passwordAttribute() æ–¹æ³•æ¥å£°æ˜å¯†ç å±æ€§çš„åç§°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;  auth    .ldapAuthentication()    .userSearchBase(<span class="string">&quot;ou=people&quot;</span>);    .userSearchFilter(<span class="string">&quot;&#123;uid=&#123;0&#125;&#125;&quot;</span>)    .groupSearchBase(<span class="string">&quot;ou=groups&quot;</span>);    .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>)    .passwordCompare()    .passwordEncoder(<span class="keyword">new</span> Md5PasswordEncoder())    .passwordAttribute(<span class="string">&quot;passcode&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šäº†è¦ä¸ç»™å®šå¯†ç è¿›è¡Œæ¯”å¯¹çš„æ˜¯ â€œpasscodeâ€ å±æ€§ã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šå¯†ç è½¬ç å™¨ã€‚åœ¨è¿›è¡ŒæœåŠ¡å™¨ç«¯å¯†ç æ¯”å¯¹æ—¶ï¼Œæœ‰ä¸€ç‚¹éå¸¸å¥½ï¼Œé‚£å°±æ˜¯å®é™…çš„å¯†ç åœ¨æœåŠ¡å™¨ç«¯æ˜¯ç§å¯†çš„ã€‚ä½†æ˜¯è¿›è¡Œå°è¯•çš„å¯†ç è¿˜æ˜¯éœ€è¦é€šè¿‡çº¿è·¯ä¼ è¾“åˆ° LDAP æœåŠ¡å™¨ä¸Šï¼Œè¿™å¯èƒ½ä¼šè¢«é»‘å®¢æ‰€æ‹¦æˆªã€‚ä¸ºäº†é¿å…è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ passwordEncoder() æ–¹æ³•æŒ‡å®šåŠ å¯†ç­–ç•¥ã€‚</p>
<p>åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œå¯†ç ä¼šè¿›è¡Œ MD5 åŠ å¯†ã€‚è¿™éœ€è¦ LDAP æœåŠ¡å™¨ä¸Šå¯†ç ä¹Ÿä½¿ç”¨ MD5 è¿›è¡ŒåŠ å¯†ã€‚</p>
<p>å¼•ç”¨è¿œç¨‹çš„ LDAP æœåŠ¡å™¨</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¿½ç•¥çš„ä¸€ä»¶äº‹å°±æ˜¯ LDAP å’Œå®é™…çš„æ•°æ®åœ¨å“ªé‡Œã€‚æˆ‘ä»¬å¾ˆå¼€å¿ƒåœ°é…ç½® Spring ä½¿ç”¨ LDAP æœåŠ¡å™¨è¿›è¡Œè®¤è¯ï¼Œä½†æ˜¯æœåŠ¡å™¨åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Security çš„ LDAP è®¤è¯å‡è®¾ LDAP æœåŠ¡å™¨ç›‘å¬æœ¬æœºçš„ 33389 ç«¯å£ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ çš„ LDAP æœåŠ¡å™¨åœ¨å¦ä¸€å°æœºå™¨ä¸Šï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ contextSource() æ–¹æ³•æ¥é…ç½®è¿™ä¸ªåœ°å€ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;  auth    .ldapAuthentication()    .userSearchBase(<span class="string">&quot;ou=people&quot;</span>);    .userSearchFilter(<span class="string">&quot;&#123;uid=&#123;0&#125;&#125;&quot;</span>)    .groupSearchBase(<span class="string">&quot;ou=groups&quot;</span>);    .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>)    .contextSource()    .url(<span class="string">&quot;ldap://habuma.com:389/dc=habuma,dc=com&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>contextSource() æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª ContextSourceBuilder å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡é™¤äº†å…¶ä»–åŠŸèƒ½ä»¥å¤–ï¼Œè¿˜æä¾›äº† url() æ–¹æ³•ç”¨æ¥æŒ‡å®š LDAP æœåŠ¡å™¨çš„åœ°å€ã€‚</p>
<p>é…ç½®åµŒå…¥å¼çš„ LDAP æœåŠ¡å™¨</p>
<p>å¦‚æœä½ æ²¡æœ‰ç°æˆçš„ LDAP æœåŠ¡å™¨ä¾›è®¤è¯ä½¿ç”¨ï¼ŒSpring Security è¿˜ä¸ºæˆ‘ä»¬æä¾›äº†åµŒå…¥å¼çš„ LDAP æœåŠ¡å™¨ã€‚æˆ‘ä»¬ä¸å†éœ€è¦è®¾ç½®è¿œç¨‹ LDAP æœåŠ¡å™¨çš„ URLï¼Œåªéœ€é€šè¿‡ root() æ–¹æ³•æŒ‡å®šåµŒå…¥å¼æœåŠ¡å™¨çš„æ ¹å‰ç¼€å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;  auth    .ldapAuthentication()    .userSearchBase(<span class="string">&quot;ou=people&quot;</span>);    .userSearchFilter(<span class="string">&quot;&#123;uid=&#123;0&#125;&#125;&quot;</span>)    .groupSearchBase(<span class="string">&quot;ou=groups&quot;</span>);    .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>)    .contextSource()    .root(<span class="string">&quot;dc=habuma,dc=com&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ LDAP æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå®ƒä¼šå°è¯•åœ¨ç±»è·¯å¾„ä¸‹å¯»æ‰¾LDIF æ–‡ä»¶æ¥åŠ è½½æ•°æ®ã€‚LDIFï¼ˆLDAP Data Interchange Formatï¼ŒLDAPæ•°æ®äº¤æ¢æ ¼å¼ï¼‰æ˜¯ä»¥æ–‡æœ¬æ–‡ä»¶å±•ç° LDAP æ•°æ®çš„æ ‡å‡†æ–¹å¼ã€‚æ¯æ¡è®°å½•å¯ä»¥æœ‰ä¸€è¡Œæˆ–å¤šè¡Œï¼Œæ¯é¡¹åŒ…å«ä¸€ä¸ªåå€¼å¯¹ã€‚è®°å½•ä¹‹é—´é€šè¿‡ç©ºè¡Œè¿›è¡Œåˆ†å‰²ã€‚</p>
<p>å¦‚æœä½ ä¸æƒ³è®© Spring ä»æ•´ä¸ªæ ¹è·¯å¾„ä¸‹æœç´¢ LDIF æ–‡ä»¶çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è°ƒç”¨ ldif() æ–¹æ³•æ¥æ˜ç¡®æŒ‡å®šåŠ è½½å“ªä¸ª LDIF æ–‡ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;  auth    .ldapAuthentication()    .userSearchBase(<span class="string">&quot;ou=people&quot;</span>);    .userSearchFilter(<span class="string">&quot;&#123;uid=&#123;0&#125;&#125;&quot;</span>)    .groupSearchBase(<span class="string">&quot;ou=groups&quot;</span>);    .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>)    .contextSource()    .root(<span class="string">&quot;dc=habuma,dc=com&quot;</span>)    .ldif(<span class="string">&quot;classpath:users.ldif&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ˜ç¡®è¦æ±‚ LDAP æœåŠ¡å™¨ä»ç±»è·¯å¾„æ ¹ç›®å½•ä¸‹çš„users.ldifæ–‡ä»¶ä¸­åŠ è½½å†…å®¹ã€‚å¦‚æœä½ æ¯”è¾ƒå¥½å¥‡çš„è¯ï¼Œå¦‚ä¸‹å°±æ˜¯ä¸€ä¸ªåŒ…å«ç”¨æˆ·æ•°æ® LDIF æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥åŠ è½½åµŒå…¥å¼ LDAP æœåŠ¡å™¨ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dn:</span> <span class="string">ou=groups,dc=habuma,dc=com</span> <span class="attr">objectclass: top objectclass: organizationalUnit ou: groupsdn:</span> <span class="string">ou=people,dc=habuma,dc=com</span> <span class="attr">objectclass: top objectclass: organizationalUnit ou: peopledn:</span> <span class="string">uid=habuma,</span> <span class="string">ou=people,</span> <span class="string">dc=hab\oma,</span> <span class="string">dc=comobjectclass:</span> <span class="attr">topobjectclass: personobjectclass: organizationalPersonobjectclass: inetOrgPersoncn: Craig Wallssn: Wallsuid: habumauserPassword: passworddn:</span> <span class="string">uid=jsmith,ou=people,dc=habuma,dc=comobjectclass:</span> <span class="attr">topobjectclass: personobjectclass: organizationalPersonobjectclass: inetOrgPersoncn: John Smithsn: Smithuid: jsmithuserPassword: passworddn:</span> <span class="string">cn=spittr,outgroups,dc=habuma,dc=comobjectclass:</span> <span class="attr">topobjectclass: groupOfNamescn: spittrmember:</span> <span class="string">uid=habuma,ou=people,dc=habuma,dc=com</span></span><br></pre></td></tr></table></figure>

<p>Spring Security å†…ç½®çš„ç”¨æˆ·å­˜å‚¨éå¸¸ä¾¿åˆ©ï¼Œå¹¶ä¸”æ¶µç›–äº†æœ€ä¸ºå¸¸ç”¨çš„ç”¨æˆ·åœºæ™¯ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ çš„è®¤è¯éœ€æ±‚ä¸æ˜¯é‚£ä¹ˆé€šç”¨çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ›å»ºå¹¶é…ç½®è‡ªå®šä¹‰çš„ç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡äº†ã€‚</p>
<h4 id="é…ç½®è‡ªå®šä¹‰çš„ç”¨æˆ·æœåŠ¡"><a href="#é…ç½®è‡ªå®šä¹‰çš„ç”¨æˆ·æœåŠ¡" class="headerlink" title="é…ç½®è‡ªå®šä¹‰çš„ç”¨æˆ·æœåŠ¡"></a>é…ç½®è‡ªå®šä¹‰çš„ç”¨æˆ·æœåŠ¡</h4><p>å‡è®¾æˆ‘ä»¬éœ€è¦è®¤è¯çš„ç”¨æˆ·å­˜å‚¨åœ¨éå…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œå¦‚ Mongo æˆ– Neo4jï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ªè‡ªå®šä¹‰çš„ UserDetailsService æ¥å£å®ç°ã€‚</p>
<p>UserDetailsService æ¥å£éå¸¸ç®€å•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDetailsService</span> </span>&#123;  <span class="function">UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯å®ç° loadUserByUsername() æ–¹æ³•ï¼Œæ ¹æ®ç»™å®šçš„ç”¨æˆ·åæ¥æŸ¥æ‰¾ç”¨æˆ·ã€‚loadUserByUsername() æ–¹æ³•ä¼šè¿”å›ä»£è¡¨ç»™å®šç”¨æˆ·çš„ UserDetails å¯¹è±¡ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†ä¸€ä¸ª UserDetailsService çš„å®ç°ï¼Œå®ƒä¼šä»ç»™å®šçš„ SpitterRepository å®ç°ä¸­æŸ¥æ‰¾ç”¨æˆ·ã€‚</p>
<center>ç¨‹åºæ¸…å• 9.4ã€€ä» SpitterRepository ä¸­æŸ¥æ‰¾ UserDetails å¯¹è±¡</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.security;<span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;<span class="keyword">import</span> org.springframework.security.core.authority.SimpleGrantAuthority;<span class="keyword">import</span> org.springframework.security.core.userdetails.User;<span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;<span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;<span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;<span class="keyword">import</span> spittr.Spitter;<span class="keyword">import</span> spittr.data.SpitterRepository;<span class="function"><span class="keyword">public</span> class <span class="title">SpitterUserService</span><span class="params">(SpitterRepository spitterRepository)</span> </span>&#123;    <span class="keyword">private</span> <span class="keyword">final</span> SpitterRepository spitterRepository;    <span class="function"><span class="keyword">public</span> <span class="title">SpitterUserService</span><span class="params">(SpitterRepository spitterRepository)</span></span>&#123;    <span class="keyword">this</span>.spitterRepository = spitterRepository;  &#125;    <span class="meta">@Override</span>  <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;    Spitter spitter = spitterRepository.findByUsername(username);    <span class="keyword">if</span> (spitter != <span class="keyword">null</span>) &#123;      List&lt;GrantedAuthority&gt; authorities = <span class="keyword">new</span> ArrayList&lt;&gt;();      authorities.add(<span class="keyword">new</span> SimpleGrantedAuthority(<span class="string">&quot;ROLE_SPITTER&quot;</span>));    &#125;        <span class="keyword">return</span> <span class="keyword">new</span> User(      spitter.getUsername(),      spitter.getPassword(),      authorities);  &#125;  <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(    <span class="string">&quot;User &#x27;&quot;</span> + username + <span class="string">&quot;&#x27; not found.&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>SpitterUserService æœ‰æ„æ€çš„åœ°æ–¹åœ¨äºå®ƒå¹¶ä¸çŸ¥é“ç”¨æˆ·æ•°æ®å­˜å‚¨åœ¨ä»€ä¹ˆåœ°æ–¹ã€‚è®¾ç½®è¿›æ¥çš„ SpitterRepository èƒ½å¤Ÿä»å…³ç³»å‹æ•°æ®åº“ã€æ–‡æ¡£æ•°æ®åº“æˆ–å›¾æ•°æ®ä¸­æŸ¥æ‰¾Spitter å¯¹è±¡ï¼Œç”šè‡³å¯ä»¥ä¼ªé€ ä¸€ä¸ªã€‚SpitterUserService ä¸çŸ¥é“ä¹Ÿä¸ä¼šå…³å¿ƒåº•å±‚æ‰€ä½¿ç”¨çš„æ•°æ®å­˜å‚¨ã€‚å®ƒåªæ˜¯è·å¾— Spitter å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥åˆ›å»º User å¯¹è±¡ã€‚ï¼ˆUser<br>æ˜¯ UserDetails çš„å…·ä½“å®ç°ã€‚ï¼‰</p>
<p>ä¸ºäº†ä½¿ç”¨ SpitterUserService æ¥è®¤è¯ç”¨æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ userDetailsService() æ–¹æ³•å°†å…¶è®¾ç½®åˆ°å®‰å…¨é…ç½®ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutowiredSpitterRepository</span> spitterRepository;<span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;  auth    .userDetailsService(<span class="keyword">new</span> SpitterUserService(spitterRepository));&#125;</span><br></pre></td></tr></table></figure>

<p>userDetailsService() æ–¹æ³•ï¼ˆç±»ä¼¼äº jdbcAuthentication()ã€ldapAuthentication ä»¥åŠ inMemoryAuthentication()ï¼‰ä¼šé…ç½®ä¸€ä¸ªç”¨æˆ·å­˜å‚¨ã€‚ä¸è¿‡ï¼Œè¿™é‡Œæ‰€ä½¿ç”¨çš„ä¸æ˜¯ Spring æ‰€æä¾›çš„ç”¨æˆ·å­˜å‚¨ï¼Œè€Œæ˜¯ä½¿ç”¨ UserDetailsService çš„å®ç°ã€‚</p>
<p>å¦å¤–ä¸€ç§å€¼å¾—è€ƒè™‘çš„æ–¹æ¡ˆå°±æ˜¯ä¿®æ”¹ Spitterï¼Œè®©å…¶å®ç° UserDetailsã€‚è¿™æ ·çš„è¯ï¼ŒloadUserByUsername() å°±èƒ½ç›´æ¥è¿”å› Spitter å¯¹è±¡äº†ï¼Œè€Œä¸å¿…å†å°†å®ƒçš„å€¼å¤åˆ¶åˆ° User å¯¹è±¡ä¸­ã€‚</p>
<h3 id="æ‹¦æˆªè¯·æ±‚"><a href="#æ‹¦æˆªè¯·æ±‚" class="headerlink" title="æ‹¦æˆªè¯·æ±‚"></a>æ‹¦æˆªè¯·æ±‚</h3><p>åœ¨å‰é¢çš„ 9.1.3 å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªç‰¹åˆ«ç®€å•çš„ Spring Security é…ç½®ï¼Œåœ¨è¿™ä¸ªé»˜è®¤çš„é…ç½®ä¸­ï¼Œä¼šè¦æ±‚æ‰€æœ‰è¯·æ±‚éƒ½è¦ç»è¿‡è®¤è¯ã€‚æœ‰äº›äººå¯èƒ½ä¼šè¯´ï¼Œè¿‡å¤šçš„å®‰å…¨æ€§æ€»æ¯”å®‰å…¨æ€§å¤ªå°‘è¦å¥½ã€‚ä½†ä¹Ÿæœ‰ä¸€ç§è¯´æ³•å°±æ˜¯è¦é€‚é‡åœ°åº”ç”¨å®‰å…¨æ€§ã€‚</p>
<p>åœ¨ä»»ä½•åº”ç”¨ä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½éœ€è¦åŒç­‰ç¨‹åº¦åœ°ä¿æŠ¤ã€‚æœ‰äº›è¯·æ±‚éœ€è¦è®¤è¯ï¼Œè€Œå¦ä¸€äº›å¯èƒ½å¹¶ä¸éœ€è¦ã€‚æœ‰äº›è¯·æ±‚å¯èƒ½åªæœ‰å…·å¤‡ç‰¹å®šæƒé™çš„ç”¨æˆ·æ‰èƒ½è®¿é—®ï¼Œæ²¡æœ‰è¿™äº›æƒé™çš„ç”¨æˆ·ä¼šæ— æ³•è®¿é—®ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘ Spittr åº”ç”¨çš„è¯·æ±‚ã€‚é¦–é¡µå½“ç„¶æ˜¯å…¬å¼€çš„ï¼Œä¸éœ€è¦è¿›è¡Œä¿æŠ¤ã€‚ç±»ä¼¼åœ°ï¼Œå› ä¸ºæ‰€æœ‰çš„ Spittle éƒ½æ˜¯å…¬å¼€çš„ï¼Œæ‰€ä»¥å±•ç° Spittle çš„é¡µé¢ä¸éœ€è¦å®‰å…¨æ€§ã€‚ä½†æ˜¯ï¼Œåˆ›å»º Spittle çš„è¯·æ±‚åªæœ‰è®¤è¯ç”¨æˆ·æ‰èƒ½æ‰§è¡Œã€‚åŒæ ·ï¼Œå°½ç®¡ç”¨æˆ·åŸºæœ¬ä¿¡æ¯é¡µé¢æ˜¯å…¬å¼€çš„ï¼Œä¸éœ€è¦è®¤è¯ï¼Œä½†æ˜¯ï¼Œå¦‚æœè¦å¤„ç† â€œ/spitters/meâ€ è¯·æ±‚ï¼Œå¹¶å±•ç°å½“å‰ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯æ—¶ï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡Œè®¤è¯ï¼Œä»è€Œç¡®å®šè¦å±•ç°è°çš„ä¿¡æ¯ã€‚</p>
<p>å¯¹æ¯ä¸ªè¯·æ±‚è¿›è¡Œç»†ç²’åº¦å®‰å…¨æ€§æ§åˆ¶çš„å…³é”®åœ¨äºé‡è½½ configure(HttpSecurity) æ–¹æ³•ã€‚å¦‚ä¸‹çš„ä»£ç ç‰‡æ®µå±•ç°äº†é‡è½½çš„ configure(HttpSecurity) æ–¹æ³•ï¼Œå®ƒä¸ºä¸åŒçš„ URL è·¯å¾„æœ‰é€‰æ‹©åœ°åº”ç”¨å®‰å…¨æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;  http    .authorizeRequests()    .antMatchers(<span class="string">&quot;/spitters/me&quot;</span>).authenticated()    .antMatchers(HttpMethod.POST, <span class="string">&quot;/spittles&quot;</span>).authenticated()    .anyRequest().permitAll();&#125;</span><br></pre></td></tr></table></figure>

<p>configure() æ–¹æ³•ä¸­å¾—åˆ°çš„ HttpSecurity å¯¹è±¡å¯ä»¥åœ¨å¤šä¸ªæ–¹é¢é…ç½® HTTP çš„å®‰å…¨æ€§ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆè°ƒç”¨ authorizeRequests()ï¼Œç„¶åè°ƒç”¨è¯¥æ–¹æ³•æ‰€è¿”å›çš„å¯¹è±¡çš„æ–¹æ³•æ¥é…ç½®è¯·æ±‚çº§åˆ«çš„å®‰å…¨æ€§ç»†èŠ‚ã€‚å…¶ä¸­ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ antMatchers() æŒ‡å®šäº†å¯¹ â€œ/spitters/meâ€ è·¯å¾„çš„è¯·æ±‚éœ€è¦è¿›è¡Œè®¤è¯ã€‚ç¬¬äºŒæ¬¡è°ƒç”¨ antMatchers() æ›´ä¸ºå…·ä½“ï¼Œè¯´æ˜å¯¹ â€œ/spittlesâ€ è·¯å¾„çš„ HTTP POST è¯·æ±‚å¿…é¡»è¦ç»è¿‡è®¤è¯ã€‚æœ€åå¯¹ anyRequests() çš„è°ƒç”¨ä¸­ï¼Œè¯´æ˜å…¶ä»–æ‰€æœ‰çš„è¯·æ±‚éƒ½æ˜¯å…è®¸çš„ï¼Œä¸éœ€è¦è®¤è¯å’Œä»»ä½•çš„æƒé™ã€‚</p>
<p>antMatchers() æ–¹æ³•ä¸­è®¾å®šçš„è·¯å¾„æ”¯æŒ Ant é£æ ¼çš„é€šé…ç¬¦ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰è¿™æ ·ä½¿ç”¨ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨é€šé…ç¬¦æ¥æŒ‡å®šè·¯å¾„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.antMatchers(<span class="string">&quot;/spitter/**&quot;</span>).authenticated();</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ªå¯¹ antMatchers() æ–¹æ³•çš„è°ƒç”¨ä¸­æŒ‡å®šå¤šä¸ªè·¯å¾„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.antMatchers(<span class="string">&quot;/spitter/**&quot;</span>, <span class="string">&quot;/spittles/mine&quot;</span>).authenticated();</span><br></pre></td></tr></table></figure>

<p>antMatchers() æ–¹æ³•æ‰€ä½¿ç”¨çš„è·¯å¾„å¯èƒ½ä¼šåŒ…æ‹¬ Ant é£æ ¼çš„é€šé…ç¬¦ï¼Œè€Œ regexMatchers() æ–¹æ³•åˆ™èƒ½å¤Ÿæ¥å—æ­£åˆ™è¡¨è¾¾å¼æ¥å®šä¹‰è¯·æ±‚è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹ä»£ç ç‰‡æ®µæ‰€ä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼ä¸ â€œ/spitters/**â€ï¼ˆAnté£æ ¼ï¼‰åŠŸèƒ½æ˜¯ç›¸åŒçš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.regexMatchers(<span class="string">&quot;/spitter/.*&quot;</span>).authenticated();</span><br></pre></td></tr></table></figure>

<p>é™¤äº†è·¯å¾„é€‰æ‹©ï¼Œæˆ‘ä»¬è¿˜é€šè¿‡ authenticated() å’Œ permitAll() æ¥å®šä¹‰è¯¥å¦‚ä½•ä¿æŠ¤è·¯å¾„ã€‚authenticated() è¦æ±‚åœ¨æ‰§è¡Œè¯¥è¯·æ±‚æ—¶ï¼Œå¿…é¡»å·²ç»ç™»å½•äº†åº”ç”¨ã€‚å¦‚æœç”¨æˆ·æ²¡æœ‰è®¤è¯çš„è¯ï¼ŒSpring Security çš„ Filter å°†ä¼šæ•è·è¯¥è¯·æ±‚ï¼Œå¹¶å°†ç”¨æˆ·é‡å®šå‘åˆ°åº”ç”¨çš„ç™»å½•é¡µé¢ã€‚åŒæ—¶ï¼ŒpermitAll() æ–¹æ³•å…è®¸è¯·æ±‚æ²¡æœ‰ä»»ä½•çš„å®‰å…¨é™åˆ¶ã€‚</p>
<p>é™¤äº† authenticated() å’Œ permitAll() ä»¥å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„ä¸€äº›æ–¹æ³•èƒ½å¤Ÿç”¨æ¥å®šä¹‰è¯¥å¦‚ä½•ä¿æŠ¤è¯·æ±‚ã€‚è¡¨ 9.4 æè¿°äº†æ‰€æœ‰å¯ç”¨çš„æ–¹æ¡ˆã€‚</p>
<center>è¡¨ 9.4ã€€ç”¨æ¥å®šä¹‰å¦‚ä½•ä¿æŠ¤è·¯å¾„çš„é…ç½®æ–¹æ³•</center>

<table>
<thead>
<tr>
<th>æ–¹ã€€ã€€æ³•</th>
<th>èƒ½å¤Ÿåšä»€ä¹ˆ</th>
</tr>
</thead>
<tbody><tr>
<td>access(String)</td>
<td>å¦‚æœç»™å®šçš„ SpEL è¡¨è¾¾å¼è®¡ç®—ç»“æœä¸º trueï¼Œå°±å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>anonymous()</td>
<td>å…è®¸åŒ¿åç”¨æˆ·è®¿é—®</td>
</tr>
<tr>
<td>authenticated()</td>
<td>å…è®¸è®¤è¯è¿‡çš„ç”¨æˆ·è®¿é—®</td>
</tr>
<tr>
<td>denyAll()</td>
<td>æ— æ¡ä»¶æ‹’ç»æ‰€æœ‰è®¿é—®</td>
</tr>
<tr>
<td>fullyAuthenticated()</td>
<td>å¦‚æœç”¨æˆ·æ˜¯å®Œæ•´è®¤è¯çš„è¯ï¼ˆä¸æ˜¯é€šè¿‡ Remember-me åŠŸèƒ½è®¤è¯çš„ï¼‰ï¼Œå°±å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>hasAnyAuthority(Stringâ€¦)</td>
<td>å¦‚æœç”¨æˆ·å…·å¤‡ç»™å®šæƒé™ä¸­çš„æŸä¸€ä¸ªçš„è¯ï¼Œå°±å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>hasAnyRole(Stringâ€¦)</td>
<td>å¦‚æœç”¨æˆ·å…·å¤‡ç»™å®šè§’è‰²ä¸­çš„æŸä¸€ä¸ªçš„è¯ï¼Œå°±å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>hasAuthority(String)</td>
<td>å¦‚æœç”¨æˆ·å…·å¤‡ç»™å®šæƒé™çš„è¯ï¼Œå°±å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>hasIpAddress(String)</td>
<td>å¦‚æœè¯·æ±‚æ¥è‡ªç»™å®š IP åœ°å€çš„è¯ï¼Œå°±å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>hasRole(String)</td>
<td>å¦‚æœç”¨æˆ·å…·å¤‡ç»™å®šè§’è‰²çš„è¯ï¼Œå°±å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>not()</td>
<td>å¯¹å…¶ä»–è®¿é—®æ–¹æ³•çš„ç»“æœæ±‚å</td>
</tr>
<tr>
<td>permitAll()</td>
<td>æ— æ¡ä»¶å…è®¸è®¿é—®</td>
</tr>
<tr>
<td>rememberMe()</td>
<td>å¦‚æœç”¨æˆ·æ˜¯é€šè¿‡ Remember-me åŠŸèƒ½è®¤è¯çš„ï¼Œå°±å…è®¸è®¿é—®</td>
</tr>
</tbody></table>
<p>é€šè¿‡ä½¿ç”¨è¡¨ 9.4 ä¸­çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ‰€é…ç½®çš„å®‰å…¨æ€§èƒ½å¤Ÿä¸ä»…ä»…é™äºè®¤è¯ç”¨æˆ·ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¹‹å‰çš„ configure() æ–¹æ³•ï¼Œè¦æ±‚ç”¨æˆ·ä¸ä»…éœ€è¦è®¤è¯ï¼Œè¿˜è¦å…·å¤‡ROLE_SPITTER æƒé™ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;  http    .authorizeRequests()    .antMatchers(<span class="string">&quot;/spitters/me&quot;</span>).hasAuthority(<span class="string">&quot;ROLE_SPITTER&quot;</span>)    .antMatchers(HttpMethoed.POST, <span class="string">&quot;/spitters&quot;</span>).hasAuthority(<span class="string">&quot;ROLE_SPITTER&quot;</span>)    .anyRequest().permitAll();&#125;</span><br></pre></td></tr></table></figure>

<p>ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨hasRole()æ–¹æ³•ï¼Œå®ƒä¼šè‡ªåŠ¨ä½¿ç”¨ <code>ROLE_</code> å‰ç¼€ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;  http    .authorizeRequests()    .antMatchers(<span class="string">&quot;/spitters/me&quot;</span>).hasRole(<span class="string">&quot;SPITTER&quot;</span>)    .antMatchers(HttpMethoed.POST, <span class="string">&quot;/spitters&quot;</span>).hasRole(<span class="string">&quot;SPITTER&quot;</span>)    .anyRequest().permitAll();&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å°†ä»»æ„æ•°é‡çš„ antMatchers()ã€regexMatchers() å’Œ anyRequest() è¿æ¥èµ·æ¥ï¼Œä»¥æ»¡è¶³ Web åº”ç”¨å®‰å…¨è§„åˆ™çš„éœ€è¦ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œè¿™äº›è§„åˆ™ä¼šæŒ‰ç…§ç»™å®šçš„é¡ºåºå‘æŒ¥ä½œç”¨ã€‚æ‰€ä»¥ï¼Œå¾ˆé‡è¦çš„ä¸€ç‚¹å°±æ˜¯å°†æœ€ä¸ºå…·ä½“çš„è¯·æ±‚è·¯å¾„æ”¾åœ¨å‰é¢ï¼Œè€Œæœ€ä¸å…·ä½“çš„è·¯å¾„ï¼ˆå¦‚ anyRequest()ï¼‰æ”¾åœ¨æœ€åé¢ã€‚å¦‚æœä¸è¿™æ ·åšçš„è¯ï¼Œé‚£ä¸å…·ä½“çš„è·¯å¾„é…ç½®å°†ä¼šè¦†ç›–æ‰æ›´ä¸ºå…·ä½“çš„è·¯å¾„é…ç½®ã€‚</p>
<h4 id="ä½¿ç”¨Springè¡¨è¾¾å¼è¿›è¡Œå®‰å…¨ä¿æŠ¤"><a href="#ä½¿ç”¨Springè¡¨è¾¾å¼è¿›è¡Œå®‰å…¨ä¿æŠ¤" class="headerlink" title="ä½¿ç”¨Springè¡¨è¾¾å¼è¿›è¡Œå®‰å…¨ä¿æŠ¤"></a>ä½¿ç”¨Springè¡¨è¾¾å¼è¿›è¡Œå®‰å…¨ä¿æŠ¤</h4><p>è¡¨ 9.4 ä¸­çš„å¤§å¤šæ•°æ–¹æ³•éƒ½æ˜¯ä¸€ç»´çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ hasRole() é™åˆ¶æŸä¸ªç‰¹å®šçš„è§’è‰²ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½åœ¨ç›¸åŒçš„è·¯å¾„ä¸ŠåŒæ—¶é€šè¿‡ hasIpAddress() é™åˆ¶ç‰¹å®šçš„ IP åœ°å€ã€‚</p>
<p>å¦å¤–ï¼Œé™¤äº†è¡¨ 9.4 å®šä¹‰çš„æ–¹æ³•ä»¥å¤–ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•ä½¿ç”¨å…¶ä»–çš„æ¡ä»¶ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›é™åˆ¶æŸä¸ªè§’è‰²åªèƒ½åœ¨æ˜ŸæœŸäºŒè¿›è¡Œè®¿é—®çš„è¯ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>åœ¨ç¬¬ 3 ç« ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ Spring è¡¨è¾¾å¼è¯­è¨€ï¼ˆSpring Expression Languageï¼ŒSpELï¼‰ï¼Œå°†å…¶ä½œä¸ºè£…é… bean å±æ€§çš„é«˜çº§æŠ€æœ¯ã€‚</p>
<p>å€ŸåŠ© access() æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°† SpEL ä½œä¸ºå£°æ˜è®¿é—®é™åˆ¶çš„ä¸€ç§æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹å°±æ˜¯ä½¿ç”¨ SpEL è¡¨è¾¾å¼æ¥å£°æ˜å…·æœ‰ â€œROLE_SPITTERâ€ è§’è‰²æ‰èƒ½è®¿â€œ/spitter/meâ€URLï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.antMatchers(<span class="string">&quot;/spitter/me&quot;</span>).access(<span class="string">&quot;hasRole(&#x27;ROLE_SPITTER&#x27;)&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå¯¹ â€œ/spitter/meâ€ çš„å®‰å…¨é™åˆ¶ä¸å¼€å§‹æ—¶çš„æ•ˆæœæ˜¯ç­‰ä»·çš„ï¼Œåªä¸è¿‡è¿™é‡Œä½¿ç”¨äº† SpEL æ¥æè¿°å®‰å…¨è§„åˆ™ã€‚å¦‚æœå½“å‰ç”¨æˆ·è¢«æˆäºˆäº†ç»™å®šè§’è‰²çš„è¯ï¼Œé‚£ hasRole() è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœå°±ä¸º trueã€‚</p>
<p>è®© SpEL æ›´å¼ºå¤§çš„åŸå› åœ¨äºï¼ŒhasRole() ä»…æ˜¯ Spring æ”¯æŒçš„å®‰å…¨ç›¸å…³è¡¨è¾¾å¼ä¸­çš„ä¸€ç§ï¼Œè¡¨ 9.5 åˆ—å‡ºäº† Spring Security æ”¯æŒçš„æ‰€æœ‰ SpEL è¡¨è¾¾å¼ã€‚</p>
<center>è¡¨ 9.5ã€€Spring Security é€šè¿‡ä¸€äº›å®‰å…¨æ€§ç›¸å…³çš„è¡¨è¾¾å¼æ‰©å±•äº† Spring è¡¨è¾¾å¼è¯­è¨€</center>

<table>
<thead>
<tr>
<th>å®‰å…¨è¡¨è¾¾å¼</th>
<th>è®¡ ç®— ç»“ æœ</th>
</tr>
</thead>
<tbody><tr>
<td>authentication</td>
<td>ç”¨æˆ·çš„è®¤è¯å¯¹è±¡</td>
</tr>
<tr>
<td>denyAll</td>
<td>ç»“æœå§‹ç»ˆä¸º false</td>
</tr>
<tr>
<td>hasAnyRole(list of roles)</td>
<td>å¦‚æœç”¨æˆ·è¢«æˆäºˆäº†åˆ—è¡¨ä¸­ä»»æ„çš„æŒ‡å®šè§’è‰²ï¼Œç»“æœä¸º true</td>
</tr>
<tr>
<td>hasRole(role)</td>
<td>å¦‚æœç”¨æˆ·è¢«æˆäºˆäº†æŒ‡å®šçš„è§’è‰²ï¼Œç»“æœä¸º true</td>
</tr>
<tr>
<td>hasIpAddress(IP Address)</td>
<td>å¦‚æœè¯·æ±‚æ¥è‡ªæŒ‡å®š IP çš„è¯ï¼Œç»“æœä¸º true</td>
</tr>
<tr>
<td>isAnonymous()</td>
<td>å¦‚æœå½“å‰ç”¨æˆ·ä¸ºåŒ¿åç”¨æˆ·ï¼Œç»“æœä¸º true</td>
</tr>
<tr>
<td>isAuthenticated()</td>
<td>å¦‚æœå½“å‰ç”¨æˆ·è¿›è¡Œäº†è®¤è¯çš„è¯ï¼Œç»“æœä¸º true</td>
</tr>
<tr>
<td>isFullyAuthenticated()</td>
<td>å¦‚æœå½“å‰ç”¨æˆ·è¿›è¡Œäº†å®Œæ•´è®¤è¯çš„è¯ï¼ˆä¸æ˜¯é€šè¿‡ Remember-me åŠŸèƒ½è¿›è¡Œçš„è®¤è¯ï¼‰ï¼Œç»“æœä¸º true</td>
</tr>
<tr>
<td>isRememberMe()</td>
<td>å¦‚æœå½“å‰ç”¨æˆ·æ˜¯é€šè¿‡ Remember-me è‡ªåŠ¨è®¤è¯çš„ï¼Œç»“æœä¸º true</td>
</tr>
<tr>
<td>permitAll</td>
<td>ç»“æœå§‹ç»ˆä¸º true</td>
</tr>
<tr>
<td>principal</td>
<td>ç”¨æˆ·çš„ principal å¯¹è±¡</td>
</tr>
</tbody></table>
<p>åœ¨æŒæ¡äº† Spring Security çš„ SpEL è¡¨è¾¾å¼åï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿä¸å†å±€é™äºåŸºäºç”¨æˆ·çš„æƒé™è¿›è¡Œè®¿é—®é™åˆ¶äº†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³é™åˆ¶ â€œ/spitter/meâ€ URL çš„è®¿é—®ï¼Œä¸ä»…éœ€è¦ ROLE_SPITTERï¼Œè¿˜éœ€è¦æ¥è‡ªæŒ‡å®šçš„ IP åœ°å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼è°ƒç”¨ access() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.antMatchers(<span class="string">&quot;/spitter/me&quot;</span>).access(<span class="string">&quot;hasRole(&#x27;ROLE_SPITTER&#x27;) and hasIpAddress(&#x27;192.168.1.2&#x27;)&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SpEL å®ç°å„ç§å„æ ·çš„å®‰å…¨æ€§é™åˆ¶ã€‚æˆ‘æ•¢æ‰“èµŒï¼Œä½ å·²ç»åœ¨æƒ³è±¡åŸºäº SpEL æ‰€èƒ½å®ç°çš„é‚£äº›æœ‰è¶£çš„å®‰å…¨æ€§é™åˆ¶äº†ã€‚ä½†ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ Spring Security æ‹¦æˆªè¯·æ±‚çš„å¦å¤–ä¸€ç§æ–¹å¼ï¼šå¼ºåˆ¶é€šé“çš„å®‰å…¨æ€§ã€‚</p>
<h4 id="å¼ºåˆ¶é€šé“çš„å®‰å…¨æ€§"><a href="#å¼ºåˆ¶é€šé“çš„å®‰å…¨æ€§" class="headerlink" title="å¼ºåˆ¶é€šé“çš„å®‰å…¨æ€§"></a>å¼ºåˆ¶é€šé“çš„å®‰å…¨æ€§</h4><p>ä½¿ç”¨ HTTP æäº¤æ•°æ®æ˜¯ä¸€ä»¶å…·æœ‰é£é™©çš„äº‹æƒ…ã€‚å¦‚æœä½¿ç”¨ HTTP å‘é€æ— å…³ç´§è¦çš„ä¿¡æ¯ï¼Œè¿™å¯èƒ½ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ã€‚ä½†æ˜¯å¦‚æœä½ é€šè¿‡ HTTP å‘é€è¯¸å¦‚å¯†ç å’Œä¿¡ç”¨å¡å·è¿™æ ·çš„æ•æ„Ÿä¿¡æ¯çš„è¯ï¼Œé‚£ä½ å°±æ˜¯åœ¨æ‰¾éº»çƒ¦äº†ã€‚é€šè¿‡ HTTP å‘é€çš„æ•°æ®æ²¡æœ‰ç»è¿‡åŠ å¯†ï¼Œé»‘å®¢å°±æœ‰æœºä¼šæ‹¦æˆªè¯·æ±‚å¹¶ä¸”èƒ½å¤Ÿçœ‹åˆ°ä»–ä»¬æƒ³çœ‹çš„æ•°æ®ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ•æ„Ÿä¿¡æ¯è¦é€šè¿‡ HTTPS æ¥åŠ å¯†å‘é€çš„åŸå› ã€‚</p>
<p>ä½¿ç”¨ HTTPS ä¼¼ä¹å¾ˆç®€å•ã€‚ä½ è¦åšçš„äº‹æƒ…åªæ˜¯åœ¨ URL ä¸­çš„ HTTP ååŠ ä¸Šä¸€ä¸ªå­—æ¯ â€œsâ€ å°±å¯ä»¥äº†ã€‚æ˜¯è¿™æ ·å—ï¼Ÿ</p>
<p>è¿™æ˜¯çœŸçš„ï¼Œä½†è¿™æ˜¯æŠŠä½¿ç”¨ HTTPS é€šé“çš„è´£ä»»æ”¾åœ¨äº†é”™è¯¯çš„åœ°æ–¹ã€‚é€šè¿‡æ·»åŠ  â€œsâ€ æˆ‘ä»¬å°±èƒ½å¾ˆå®¹æ˜“åœ°å®ç°é¡µé¢çš„å®‰å…¨æ€§ï¼Œä½†æ˜¯å¿˜è®°æ·»åŠ  â€œsâ€ åŒæ ·ä¹Ÿæ˜¯å¾ˆå®¹æ˜“å‡ºç°çš„ã€‚å¦‚æœæˆ‘ä»¬çš„åº”ç”¨ä¸­æœ‰å¤šä¸ªé“¾æ¥éœ€è¦ HTTPSï¼Œä¼°è®¡åœ¨å…¶ä¸­çš„ä¸€ä¸¤ä¸ªä¸Šå¿˜è®°æ·»åŠ  â€œsâ€ çš„æ¦‚ç‡è¿˜æ˜¯å¾ˆé«˜çš„ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œä½ å¯èƒ½è¿˜ä¼šåœ¨åŸæœ¬å¹¶ä¸éœ€è¦ HTTPS çš„åœ°æ–¹ï¼Œè¯¯ç”¨ HTTPSã€‚</p>
<p>ä¼ é€’åˆ° configure() æ–¹æ³•ä¸­çš„ HttpSecurity å¯¹è±¡ï¼Œé™¤äº†å…·æœ‰ authorizeRequests() æ–¹æ³•ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª requiresChannel() æ–¹æ³•ï¼Œå€ŸåŠ©è¿™ä¸ªæ–¹æ³•èƒ½å¤Ÿä¸ºå„ç§ URL æ¨¡å¼å£°æ˜æ‰€è¦æ±‚çš„é€šé“ã€‚</p>
<p>ä½œä¸ºç¤ºä¾‹ï¼Œå¯ä»¥å‚è€ƒ Spittr åº”ç”¨çš„æ³¨å†Œè¡¨å•ã€‚å°½ç®¡Spittråº”ç”¨ä¸éœ€è¦ä¿¡ç”¨å¡å·ã€ç¤¾ä¼šä¿éšœå·æˆ–å…¶ä»–ç‰¹åˆ«æ•æ„Ÿçš„ä¿¡æ¯ï¼Œä½†ç”¨æˆ·æœ‰å¯èƒ½ä»ç„¶å¸Œæœ›ä¿¡æ¯æ˜¯ç§å¯†çš„ã€‚ä¸ºäº†ä¿è¯æ³¨å†Œè¡¨å•çš„æ•°æ®é€šè¿‡ HTTPS ä¼ é€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é…ç½®ä¸­æ·»åŠ  requiresChannel() æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<center>ç¨‹åºæ¸…å• 9.5ã€€requiresChannel() æ–¹æ³•ä¼šä¸ºé€‰å®šçš„URLå¼ºåˆ¶ä½¿ç”¨ HTTPS</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;  http    .authorizeRequests()    .antMatchers(<span class="string">&quot;/spitter/me&quot;</span>).hasRole(<span class="string">&quot;SPITTER&quot;</span>)    .antMatchers(HttpMethod.POST, <span class="string">&quot;/spittles&quot;</span>).hasRole(<span class="string">&quot;SPITTER&quot;</span>)    .anyRequest().permitAll()    .and()    .requeresChannel()    .antMatchers(<span class="string">&quot;/spitter/form&quot;</span>).requiresSecure();&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸è®ºä½•æ—¶ï¼Œåªè¦æ˜¯å¯¹â€œ/spitter/formâ€çš„è¯·æ±‚ï¼ŒSpring Securityéƒ½è§†ä¸ºéœ€è¦å®‰å…¨é€šé“ï¼ˆé€šè¿‡è°ƒç”¨requiresChannel()ç¡®å®šçš„ï¼‰å¹¶è‡ªåŠ¨å°†è¯·æ±‚é‡å®šå‘åˆ°HTTPSä¸Šã€‚</p>
<p>ä¸ä¹‹ç›¸åï¼Œæœ‰äº›é¡µé¢å¹¶ä¸éœ€è¦é€šè¿‡ HTTPS ä¼ é€ã€‚ä¾‹å¦‚ï¼Œé¦–é¡µä¸åŒ…å«ä»»ä½•æ•æ„Ÿä¿¡æ¯ï¼Œå› æ­¤å¹¶ä¸éœ€è¦é€šè¿‡ HTTPS ä¼ é€ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ requiresInsecure() ä»£æ›¿requiresSecure() æ–¹æ³•ï¼Œå°†é¦–é¡µå£°æ˜ä¸ºå§‹ç»ˆé€šè¿‡ HTTP ä¼ é€ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.antMatchers(<span class="string">&quot;/&quot;</span>).requiresInecure();</span><br></pre></td></tr></table></figure>

<p>å¦‚æœé€šè¿‡ HTTPS å‘é€äº†å¯¹ â€œ/â€ çš„è¯·æ±‚ï¼ŒSpring Security å°†ä¼šæŠŠè¯·æ±‚é‡å®šå‘åˆ°ä¸å®‰å…¨çš„ HTTP é€šé“ä¸Šã€‚</p>
<p>åœ¨å¼ºåˆ¶è¦æ±‚é€šé“æ—¶ï¼Œè·¯å¾„çš„é€‰å–æ–¹æ¡ˆä¸ authorizeRequests() æ˜¯ç›¸åŒçš„ã€‚åœ¨ç¨‹åºæ¸…å• 9.5 ä¸­ï¼Œä½¿ç”¨äº† antMatches()ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ regexMatchers() æ–¹æ³•ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼é€‰å–è·¯å¾„æ¨¡å¼ã€‚</p>
<h4 id="é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ "><a href="#é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ " class="headerlink" title="é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ "></a>é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ </h4><p>æˆ‘ä»¬å¯ä»¥å›å¿†ä¸€ä¸‹ï¼Œå½“ä¸€ä¸ª POST è¯·æ±‚æäº¤åˆ° â€œ/spittlesâ€ ä¸Šæ—¶ï¼ŒSpittleController å°†ä¼šä¸ºç”¨æˆ·åˆ›å»ºä¸€ä¸ªæ–°çš„ Spittle å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™ä¸ª POST è¯·æ±‚æ¥æºäºå…¶ä»–ç«™ç‚¹çš„è¯ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿå¦‚æœåœ¨å…¶ä»–ç«™ç‚¹æäº¤å¦‚ä¸‹è¡¨å•ï¼Œè¿™ä¸ª POST è¯·æ±‚ä¼šé€ æˆä»€ä¹ˆæ ·çš„ç»“æœå‘¢ï¼Ÿ</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">action</span>=<span class="string">&quot;http://www.spittr.com/spittles&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;message&quot;</span> <span class="attr">value</span>=<span class="string">&quot;I&#x27;m stupid!&quot;</span> /&gt;</span>  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Click here to win a new car!&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å‡è®¾ä½ ç¦ä¸ä½è·å¾—ä¸€è¾†æ–°æ±½è½¦çš„è¯±æƒ‘ï¼Œç‚¹å‡»äº†æŒ‰é’®â€”â€”é‚£ä¹ˆä½ å°†ä¼šæäº¤è¡¨å•åˆ°å¦‚ä¸‹åœ°å€ <a target="_blank" rel="noopener" href="http://www.spittr.com/spittles%E3%80%82%E5%A6%82%E6%9E%9C%E4%BD%A0%E5%B7%B2%E7%BB%8F%E7%99%BB%E5%BD%95%E5%88%B0%E4%BA%86">http://www.spittr.com/spittlesã€‚å¦‚æœä½ å·²ç»ç™»å½•åˆ°äº†</a> spittr.comï¼Œé‚£ä¹ˆè¿™å°±ä¼šå¹¿æ’­ä¸€æ¡æ¶ˆæ¯ï¼Œè®©æ¯ä¸ªäººéƒ½çŸ¥é“ä½ åšäº†ä¸€ä»¶è ¢äº‹ã€‚</p>
<p>è¿™æ˜¯è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆcross-site request forgeryï¼ŒCSRFï¼‰çš„ä¸€ä¸ªç®€å•æ ·ä¾‹ã€‚ç®€å•æ¥è®²ï¼Œå¦‚æœä¸€ä¸ªç«™ç‚¹æ¬ºéª—ç”¨æˆ·æäº¤è¯·æ±‚åˆ°å…¶ä»–æœåŠ¡å™¨çš„è¯ï¼Œå°±ä¼šå‘ç”Ÿ CSRF æ”»å‡»ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥æ¶ˆæçš„åæœã€‚å°½ç®¡æäº¤ â€œIâ€™m stupid!â€ è¿™æ ·çš„ä¿¡æ¯åˆ°å¾®åšç«™ç‚¹ç®—ä¸ä¸Šä»€ä¹ˆ CSRF æ”»å‡»çš„æœ€ç³Ÿç³•åœºæ™¯ï¼Œä½†æ˜¯ä½ å¯ä»¥å¾ˆå®¹æ˜“æƒ³åˆ°æ›´ä¸ºä¸¥é‡çš„æ”»å‡»æƒ…æ™¯ï¼Œå®ƒå¯èƒ½ä¼šå¯¹ä½ çš„é“¶è¡Œè´¦å·æ‰§è¡Œéš¾ä»¥é¢„æœŸçš„æ“ä½œã€‚</p>
<p>ä» Spring Security 3.2 å¼€å§‹ï¼Œé»˜è®¤å°±ä¼šå¯ç”¨ CSRF é˜²æŠ¤ã€‚å®é™…ä¸Šï¼Œé™¤éä½ é‡‡å–è¡Œä¸ºå¤„ç†CSRFé˜²æŠ¤æˆ–è€…å°†è¿™ä¸ªåŠŸèƒ½ç¦ç”¨ï¼Œå¦åˆ™çš„è¯ï¼Œåœ¨åº”ç”¨ä¸­æäº¤è¡¨å•æ—¶ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°é—®é¢˜ã€‚</p>
<p>Spring Security é€šè¿‡ä¸€ä¸ªåŒæ­¥ token çš„æ–¹å¼æ¥å®ç° CSRF é˜²æŠ¤çš„åŠŸèƒ½ã€‚å®ƒå°†ä¼šæ‹¦æˆªçŠ¶æ€å˜åŒ–çš„è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼Œé GETã€HEADã€OPTIONS å’Œ TRACE çš„è¯·æ±‚ï¼‰å¹¶æ£€æŸ¥CSRF tokenã€‚å¦‚æœè¯·æ±‚ä¸­ä¸åŒ…å« CSRF token çš„è¯ï¼Œæˆ–è€… token ä¸èƒ½ä¸æœåŠ¡å™¨ç«¯çš„ token ç›¸åŒ¹é…ï¼Œè¯·æ±‚å°†ä¼šå¤±è´¥ï¼Œå¹¶æŠ›å‡º CsrfException å¼‚å¸¸ã€‚</p>
<p>è¿™æ„å‘³ç€åœ¨ä½ çš„åº”ç”¨ä¸­ï¼Œæ‰€æœ‰çš„è¡¨å•å¿…é¡»åœ¨ä¸€ä¸ª <code>_csrf</code> åŸŸä¸­æäº¤tokenï¼Œè€Œä¸”è¿™ä¸ªtokenå¿…é¡»è¦ä¸æœåŠ¡å™¨ç«¯è®¡ç®—å¹¶å­˜å‚¨çš„tokenä¸€è‡´ï¼Œè¿™æ ·çš„è¯å½“è¡¨å•æäº¤çš„æ—¶å€™ï¼Œæ‰èƒ½è¿›è¡ŒåŒ¹é…ã€‚</p>
<p>å¥½æ¶ˆæ¯æ˜¯ï¼ŒSpring Security å·²ç»ç®€åŒ–äº†å°† token æ”¾åˆ°è¯·æ±‚çš„å±æ€§ä¸­è¿™ä¸€ä»»åŠ¡ã€‚å¦‚æœä½ ä½¿ç”¨ Thymeleaf ä½œä¸ºé¡µé¢æ¨¡æ¿çš„è¯ï¼Œåªè¦ <code>&lt;form&gt;</code> æ ‡ç­¾çš„ action å±æ€§æ·»åŠ äº† Thymeleaf å‘½åç©ºé—´å‰ç¼€ï¼Œé‚£ä¹ˆå°±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª<code>_csrf</code> éšè—åŸŸï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/spittles&#125;&quot;</span>&gt;</span>  ...<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½¿ç”¨ JSP ä½œä¸ºé¡µé¢æ¨¡æ¿çš„è¯ï¼Œæˆ‘ä»¬è¦åšçš„äº‹æƒ…éå¸¸ç±»ä¼¼ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;$&#123;_csrf.parameterName&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;_csrf.token&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ›´å¥½çš„åŠŸèƒ½æ˜¯ï¼Œå¦‚æœä½¿ç”¨ Spring çš„è¡¨å•ç»‘å®šæ ‡ç­¾çš„è¯ï¼Œ<code>&lt;sf:form&gt;</code> æ ‡ç­¾ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬æ·»åŠ éšè—çš„ CSRF token æ ‡ç­¾ã€‚</p>
<p>å¤„ç† CSRF çš„å¦å¤–ä¸€ç§æ–¹å¼å°±æ˜¯æ ¹æœ¬ä¸å»å¤„ç†å®ƒã€‚æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®ä¸­é€šè¿‡è°ƒç”¨ csrf().disable() ç¦ç”¨ Spring Security çš„ CSRF é˜²æŠ¤åŠŸèƒ½ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<center>ç¨‹åºæ¸…å• 9.6ã€€æˆ‘ä»¬å¯ä»¥ç¦ç”¨ Spring Security çš„ CSRF é˜²æŠ¤åŠŸèƒ½</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;  http    ...    .csrf()    .disable();&#125;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æé†’çš„æ˜¯ï¼Œç¦ç”¨ CSRF é˜²æŠ¤åŠŸèƒ½é€šå¸¸æ¥è®²å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚å¦‚æœè¿™æ ·åšçš„è¯ï¼Œé‚£ä¹ˆåº”ç”¨å°±ä¼šé¢ä¸´ CSRF æ”»å‡»çš„é£é™©ã€‚åªæœ‰åœ¨æ·±æ€ç†Ÿè™‘ä¹‹åï¼Œæ‰èƒ½ä½¿ç”¨ç¨‹åºæ¸…å• 9.6 ä¸­çš„é…ç½®ã€‚</p>
<p>æˆ‘ä»¬å·²ç»é…ç½®å¥½äº†ç”¨æˆ·å­˜å‚¨ï¼Œä¹Ÿé…ç½®å¥½äº†ä½¿ç”¨ Spring Security æ¥æ‹¦æˆªè¯·æ±‚ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±è¯¥æç¤ºç”¨æˆ·è¾“å…¥å‡­è¯äº†ã€‚</p>
<h3 id="è®¤è¯ç”¨æˆ·"><a href="#è®¤è¯ç”¨æˆ·" class="headerlink" title="è®¤è¯ç”¨æˆ·"></a>è®¤è¯ç”¨æˆ·</h3><p>å¦‚æœä½ ä½¿ç”¨ç¨‹åºæ¸…å• 9.1 ä¸­æœ€ç®€å•çš„ Spring Security é…ç½®çš„è¯ï¼Œé‚£ä¹ˆå°±èƒ½æ— å¿åœ°å¾—åˆ°ä¸€ä¸ªç™»å½•é¡µã€‚å®é™…ä¸Šï¼Œåœ¨é‡å†™ configure(HttpSecurity) ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½èƒ½ä½¿ç”¨ä¸€ä¸ªç®€å•å´åŠŸèƒ½å®Œå¤‡çš„ç™»å½•é¡µã€‚ä½†æ˜¯ï¼Œä¸€æ—¦é‡å†™äº† configure(HttpSecurity) æ–¹æ³•ï¼Œå°±å¤±å»äº†è¿™ä¸ªç®€å•çš„ç™»å½•é¡µé¢ã€‚</p>
<p>ä¸è¿‡ï¼ŒæŠŠè¿™ä¸ªåŠŸèƒ½æ‰¾å›æ¥ä¹Ÿå¾ˆå®¹æ˜“ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯åœ¨ configure(HttpSecurity) æ–¹æ³•ä¸­ï¼Œè°ƒç”¨ formLogin()ï¼Œå¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºã€‚</p>
<p>è¯·æ³¨æ„ï¼Œå’Œå‰é¢ä¸€æ ·ï¼Œè¿™é‡Œè°ƒç”¨ add() æ–¹æ³•æ¥å°†ä¸åŒçš„é…ç½®æŒ‡ä»¤è¿æ¥åœ¨ä¸€èµ·ã€‚å¦‚æœæˆ‘ä»¬è®¿é—®åº”ç”¨çš„ â€œ/loginâ€ é“¾æ¥æˆ–è€…å¯¼èˆªåˆ°éœ€è¦è®¤è¯çš„é¡µé¢ï¼Œé‚£ä¹ˆå°†ä¼šåœ¨æµè§ˆå™¨ä¸­å±•ç°ç™»å½•é¡µé¢ã€‚å¦‚å›¾ 9.2 æ‰€ç¤ºï¼Œåœ¨å®¡ç¾ä¸Šå®ƒæ²¡æœ‰ä»€ä¹ˆä»¤äººå…´å¥‹çš„ï¼Œä½†æ˜¯å®ƒå´èƒ½å®ç°æ‰€éœ€çš„åŠŸèƒ½ã€‚</p>
<center>ç¨‹åºæ¸…å• 9.7ã€€formLogin() æ–¹æ³•å¯ç”¨äº†åŸºæœ¬çš„ç™»å½•é¡µåŠŸèƒ½</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;  http    .formLogin()    .and()    .authorizeRequests()    .antMatchers(<span class="string">&quot;/spitter/me&quot;</span>).hasRole(<span class="string">&quot;SPITTER&quot;</span>)    .antMatchers(HttpMethod.POST, <span class="string">&quot;/spittles&quot;</span>).hasRole(<span class="string">&quot;SPITTER&quot;</span>)    .anyRequest().permitAll()    .and()    .requeresChannel()    .antMatchers(<span class="string">&quot;/spitter/form&quot;</span>).requiresSecure();&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211104153559851.png" alt="image-20211104153559851"></p>
<center>å›¾ 9.2ã€€é»˜è®¤çš„ç™»å½•é¡µåœ¨å®¡ç¾ä¸Šè¿‡äºç®€é™‹ï¼Œä½†æ˜¯åŠŸèƒ½å®Œå¤‡</center>

<p>æˆ‘æ•¢æ‰“èµŒï¼Œä½ è‚¯å®šå¸Œæœ›åœ¨è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸­èƒ½æœ‰ä¸€ä¸ªæ¯”é»˜è®¤ç™»å½•é¡µæ›´æ¼‚äº®çš„ç™»å½•é¡µé¢ã€‚å¦‚æœè¿™ä¸ªæ™®é€šçš„ç™»å½•é¡µé¢ç ´åäº†æˆ‘ä»¬åŸæœ¬ç²¾å¿ƒè®¾è®¡çš„æ¼‚äº®ç«™ç‚¹ï¼Œé‚£çœŸçš„æ˜¯ä»¶å¾ˆä»¤äººé—æ†¾çš„äº‹æƒ…ã€‚æ²¡é—®é¢˜ï¼æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±çœ‹ä¸€ä¸‹å¦‚ä½•ä¸ºåº”ç”¨æ·»åŠ è‡ªå®šä¹‰çš„ç™»å½•é¡µé¢ã€‚</p>
<h4 id="æ·»åŠ è‡ªå®šä¹‰çš„ç™»å½•é¡µ"><a href="#æ·»åŠ è‡ªå®šä¹‰çš„ç™»å½•é¡µ" class="headerlink" title="æ·»åŠ è‡ªå®šä¹‰çš„ç™»å½•é¡µ"></a>æ·»åŠ è‡ªå®šä¹‰çš„ç™»å½•é¡µ</h4><p>åˆ›å»ºè‡ªå®šä¹‰ç™»å½•é¡µçš„ç¬¬ä¸€æ­¥å°±æ˜¯äº†è§£ç™»å½•è¡¨å•ä¸­éƒ½éœ€è¦äº›ä»€ä¹ˆã€‚åªéœ€çœ‹ä¸€ä¸‹é»˜è®¤ç™»å½•é¡µé¢çš„HTMLæºç ï¼Œæˆ‘ä»¬å°±èƒ½äº†è§£éœ€è¦äº›ä»€ä¹ˆï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span>  <span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>Login Page<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span>  <span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">&#x27;document.f.username.focus();&#x27;</span>&gt;</span>  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Login with Username and Password<span class="tag">&lt;/<span class="name">h3</span>&gt;</span>    <span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">&#x27;f&#x27;</span> <span class="attr">th:action</span>=<span class="string">&#x27;/spittr/login&#x27;</span> <span class="attr">method</span>=<span class="string">&#x27;POST&#x27;</span>&gt;</span>   <span class="tag">&lt;<span class="name">table</span>&gt;</span>    <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>User:<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;text&#x27;</span> <span class="attr">name</span>=<span class="string">&#x27;username&#x27;</span> <span class="attr">value</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span>    <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>Password:<span class="tag">&lt;/<span class="name">td</span>&gt;</span>        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;password&#x27;</span> <span class="attr">name</span>=<span class="string">&#x27;password&#x27;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span>    <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&#x27;2&#x27;</span>&gt;</span>        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Login&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span>    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;_csrf&quot;</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5sdf4-dfsd45s-4579-sdhf564fds45&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">table</span>&gt;</span>  <span class="tag">&lt;/<span class="name">form</span>&gt;</span>  <span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„ä¸€ä¸ªå…³é”®ç‚¹æ˜¯ <code>&lt;form&gt;</code> æäº¤åˆ°äº†ä»€ä¹ˆåœ°æ–¹ã€‚åŒæ—¶è¿˜éœ€è¦æ³¨æ„ username å’Œ password è¾“å…¥åŸŸï¼Œåœ¨ä½ çš„ç™»å½•é¡µä¸­ï¼Œéœ€è¦åŒæ ·çš„è¾“å…¥åŸŸã€‚æœ€åï¼Œå‡è®¾æ²¡æœ‰ç¦ç”¨ CSRF çš„è¯ï¼Œè¿˜éœ€è¦ä¿è¯åŒ…å«äº†å€¼ä¸º CSRFtoken çš„ <code>_csrf</code> è¾“å…¥åŸŸã€‚</p>
<p>å¦‚ä¸‹ç¨‹åºæ¸…å•æ‰€å±•ç°çš„ Thymeleaf æ¨¡æ¿æä¾›äº†ä¸€ä¸ªä¸ Spittr åº”ç”¨é£æ ¼ä¸€è‡´çš„ç™»å½•é¡µã€‚</p>
<center>ç¨‹åºæ¸…å• 9.8ã€€ä¸º Spittr åº”ç”¨ç¼–å†™çš„è‡ªå®šä¹‰ç™»å½•é¡µï¼ˆä»¥ Thymeleaf æ¨¡æ¿çš„å½¢å¼ï¼‰</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;html xmlns=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span>      xmlns:th=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;  &lt;head&gt;    &lt;title&gt;Spitter&lt;/title&gt;    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span>           type=<span class="string">&quot;text/css&quot;</span>           th:href=<span class="string">&quot;@&#123;/resources/style.css&#125;&quot;</span>&gt;&lt;/link&gt;  &lt;/head&gt;  &lt;body onload=<span class="string">&#x27;document.f.username.focus();&#x27;</span>&gt;    &lt;div id=<span class="string">&quot;header&quot;</span> th:include=<span class="string">&quot;page :: header&quot;</span>&gt;&lt;/div&gt;  &lt;div id=<span class="string">&quot;content&quot;</span>&gt;      &lt;a th:href=<span class="string">&quot;@&#123;/spitter/register&#125;&quot;</span>&gt;Register&lt;/a&gt;      &lt;form name=<span class="string">&#x27;f&#x27;</span> th:action=<span class="string">&#x27;@&#123;/login&#125;&#x27;</span> method=<span class="string">&#x27;POST&#x27;</span>&gt;   &lt;table&gt;    &lt;tr&gt;&lt;td&gt;User:&lt;/td&gt;&lt;td&gt;        &lt;input type=<span class="string">&#x27;text&#x27;</span> name=<span class="string">&#x27;username&#x27;</span> value=<span class="string">&#x27;&#x27;</span> /&gt;&lt;/td&gt;&lt;/tr&gt;    &lt;tr&gt;&lt;td&gt;Password:&lt;/td&gt;        &lt;td&gt;&lt;input type=<span class="string">&#x27;password&#x27;</span> name=<span class="string">&#x27;password&#x27;</span>/&gt;&lt;/td&gt;&lt;/tr&gt;    &lt;tr&gt;&lt;td colspan=<span class="string">&#x27;2&#x27;</span>&gt;    &lt;input id=<span class="string">&quot;remember_me&quot;</span> name=<span class="string">&quot;remember-me&quot;</span> type=<span class="string">&quot;checkbox&quot;</span>/&gt;    &lt;label <span class="keyword">for</span>=<span class="string">&quot;remember_me&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;inline&quot;</span>&gt;Remember me&lt;/label&gt;&lt;/td&gt;&lt;/tr&gt;    &lt;tr&gt;&lt;td colspan=<span class="string">&#x27;2&#x27;</span>&gt;        &lt;input name=<span class="string">&quot;submit&quot;</span> type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Login&quot;</span>/&gt;&lt;/td&gt;&lt;/tr&gt;   &lt;/table&gt;  &lt;/form&gt;  &lt;/div&gt;  &lt;div id=<span class="string">&quot;footer&quot;</span> th:include=<span class="string">&quot;page :: copy&quot;</span>&gt;&lt;/div&gt;  &lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Thymeleaf æ¨¡æ¿ä¸­ï¼ŒåŒ…å«äº† username å’Œ password è¾“å…¥åŸŸï¼Œå°±åƒé»˜è®¤çš„ç™»å½•é¡µä¸€æ ·ï¼Œå®ƒä¹Ÿæäº¤åˆ°äº†ç›¸å¯¹äºä¸Šä¸‹æ–‡çš„ â€œ/loginâ€ é¡µé¢ä¸Šã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ª Thymeleaf æ¨¡æ¿ï¼Œå› æ­¤éšè—çš„ <code>_csrf</code> åŸŸå°†ä¼šè‡ªåŠ¨æ·»åŠ åˆ°è¡¨å•ä¸­ã€‚</p>
<h4 id="å¯ç”¨HTTP-Basicè®¤è¯"><a href="#å¯ç”¨HTTP-Basicè®¤è¯" class="headerlink" title="å¯ç”¨HTTP Basicè®¤è¯"></a>å¯ç”¨HTTP Basicè®¤è¯</h4><p>å¯¹äºåº”ç”¨ç¨‹åºçš„äººç±»ç”¨æˆ·æ¥è¯´ï¼ŒåŸºäºè¡¨å•çš„è®¤è¯æ˜¯æ¯”è¾ƒç†æƒ³çš„ã€‚ä½†æ˜¯åœ¨ç¬¬ 16 ç« ä¸­ï¼Œå°†ä¼šçœ‹åˆ°å¦‚ä½•å°†æˆ‘ä»¬ Web åº”ç”¨çš„é¡µé¢è½¬åŒ–ä¸º RESTful APIã€‚å½“åº”ç”¨ç¨‹åºçš„ä½¿ç”¨è€…æ˜¯å¦å¤–ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„è¯ï¼Œä½¿ç”¨è¡¨å•æ¥æç¤ºç™»å½•çš„æ–¹å¼å°±ä¸å¤ªé€‚åˆäº†ã€‚</p>
<p>HTTP Basic è®¤è¯ï¼ˆHTTP Basic Authenticationï¼‰ä¼šç›´æ¥é€šè¿‡ HTTP è¯·æ±‚æœ¬èº«ï¼Œå¯¹è¦è®¿é—®åº”ç”¨ç¨‹åºçš„ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚ä½ å¯èƒ½åœ¨ä»¥å‰è§è¿‡ HTTP Basic è®¤è¯ã€‚å½“åœ¨ Web æµè§ˆå™¨ä¸­ä½¿ç”¨æ—¶ï¼Œå®ƒå°†å‘ç”¨æˆ·å¼¹å‡ºä¸€ä¸ªç®€å•çš„æ¨¡æ€å¯¹è¯æ¡†ã€‚</p>
<p>ä½†è¿™åªæ˜¯ Web æµè§ˆå™¨çš„æ˜¾ç¤ºæ–¹å¼ã€‚æœ¬è´¨ä¸Šï¼Œè¿™æ˜¯ä¸€ä¸ª HTTP 401 å“åº”ï¼Œè¡¨æ˜å¿…é¡»è¦åœ¨è¯·æ±‚ä¸­åŒ…å«ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç ã€‚åœ¨ REST å®¢æˆ·ç«¯å‘å®ƒä½¿ç”¨çš„æœåŠ¡è¿›è¡Œè®¤è¯çš„åœºæ™¯ä¸­ï¼Œè¿™ç§æ–¹å¼æ¯”è¾ƒé€‚åˆã€‚</p>
<p>å¦‚æœè¦å¯ç”¨ HTTP Basic è®¤è¯çš„è¯ï¼Œåªéœ€åœ¨ configure() æ–¹æ³•æ‰€ä¼ å…¥çš„ HttpSecurity å¯¹è±¡ä¸Šè°ƒç”¨ httpBasic() å³å¯ã€‚å¦å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡è°ƒç”¨ realmName() æ–¹æ³•æŒ‡å®šåŸŸã€‚å¦‚ä¸‹æ˜¯åœ¨ Spring Security ä¸­å¯ç”¨ HTTP Basic è®¤è¯çš„å…¸å‹é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;  http    .formLogin()    .loginPage(<span class="string">&quot;/login&quot;</span>);    .and()    .httpBasic()    .realmName(<span class="string">&quot;Spittr&quot;</span>)    .and()    ...&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œå’Œå‰é¢ä¸€æ ·ï¼Œåœ¨ configure() æ–¹æ³•ä¸­ï¼Œé€šè¿‡è°ƒç”¨ add() æ–¹æ³•æ¥å°†ä¸åŒçš„é…ç½®æŒ‡ä»¤è¿æ¥åœ¨ä¸€èµ·ã€‚åœ¨ httpBasic() æ–¹æ³•ä¸­ï¼Œå¹¶æ²¡æœ‰å¤ªå¤šçš„å¯é…ç½®é¡¹ï¼Œç”šè‡³ä¸éœ€è¦ä»€ä¹ˆé¢å¤–é…ç½®ã€‚HTTP Basic è®¤è¯è¦ä¹ˆå¼€å¯è¦ä¹ˆå…³é—­ã€‚æ‰€ä»¥ï¼Œä¸å…¶è¿›ä¸€æ­¥ç ”ç©¶è¿™ä¸ªè¯é¢˜ï¼Œè¿˜ä¸å¦‚çœ‹çœ‹å¦‚ä½•é€šè¿‡ Remember-me åŠŸèƒ½å®ç°ç”¨æˆ·çš„è‡ªåŠ¨è®¤è¯ã€‚</p>
<h4 id="å¯ç”¨Remember-meåŠŸèƒ½"><a href="#å¯ç”¨Remember-meåŠŸèƒ½" class="headerlink" title="å¯ç”¨Remember-meåŠŸèƒ½"></a>å¯ç”¨Remember-meåŠŸèƒ½</h4><p>å¯¹äºåº”ç”¨ç¨‹åºæ¥è®²ï¼Œèƒ½å¤Ÿå¯¹ç”¨æˆ·è¿›è¡Œè®¤è¯æ˜¯éå¸¸é‡è¦çš„ã€‚ä½†æ˜¯ç«™åœ¨ç”¨æˆ·çš„è§’åº¦æ¥è®²ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸ç”¨æ¯æ¬¡éƒ½æç¤ºä»–ä»¬ç™»å½•æ˜¯æ›´å¥½çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè®¸å¤šç«™ç‚¹æä¾›äº† Remember-me åŠŸèƒ½ï¼Œä½ åªè¦ç™»å½•è¿‡ä¸€æ¬¡ï¼Œåº”ç”¨å°±ä¼šè®°ä½ä½ ï¼Œå½“å†æ¬¡å›åˆ°åº”ç”¨çš„æ—¶å€™ä½ å°±ä¸éœ€è¦ç™»å½•äº†ã€‚</p>
<p>Spring Security ä½¿å¾—ä¸ºåº”ç”¨æ·»åŠ  Remember-me åŠŸèƒ½å˜å¾—éå¸¸å®¹æ˜“ã€‚ä¸ºäº†å¯ç”¨è¿™é¡¹åŠŸèƒ½ï¼Œåªéœ€åœ¨ configure() æ–¹æ³•æ‰€ä¼ å…¥çš„ HttpSecurity å¯¹è±¡ä¸Šè°ƒç”¨ rememberMe() å³å¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;  http    .formLogin()    .loginPage(<span class="string">&quot;/login&quot;</span>);    .and()    .rememberMe()    .tokenValiditySeconds(<span class="number">2419200</span>)    .key(<span class="string">&quot;spittrKey&quot;</span>)    ...&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ç‚¹ç‰¹æ®Šçš„é…ç½®å°±å¯ä»¥å¯ç”¨ Remember-me åŠŸèƒ½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯é€šè¿‡åœ¨ cookie ä¸­å­˜å‚¨ä¸€ä¸ª token å®Œæˆçš„ï¼Œè¿™ä¸ª token æœ€å¤šä¸¤å‘¨å†…æœ‰æ•ˆã€‚ä½†æ˜¯ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŒ‡å®šè¿™ä¸ª token æœ€å¤šå››å‘¨å†…æœ‰æ•ˆï¼ˆ2,419,200 ç§’ï¼‰ã€‚</p>
<p>å­˜å‚¨åœ¨ cookie ä¸­çš„ token åŒ…å«ç”¨æˆ·åã€å¯†ç ã€è¿‡æœŸæ—¶é—´å’Œä¸€ä¸ªç§é’¥â€”â€”åœ¨å†™å…¥ cookie å‰éƒ½è¿›è¡Œäº† MD5 å“ˆå¸Œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç§é’¥çš„åä¸º SpringSecuredï¼Œä½†åœ¨è¿™é‡Œæˆ‘ä»¬å°†å…¶è®¾ç½®ä¸º spitterKeyï¼Œä½¿å®ƒä¸“é—¨ç”¨äº Spittr åº”ç”¨ã€‚</p>
<p>å¦‚æ­¤ç®€å•ã€‚æ—¢ç„¶ Remember-me åŠŸèƒ½å·²ç»å¯ç”¨ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ç§æ–¹å¼æ¥è®©ç”¨æˆ·è¡¨æ˜ä»–ä»¬å¸Œæœ›åº”ç”¨ç¨‹åºèƒ½å¤Ÿè®°ä½ä»–ä»¬ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œç™»å½•è¯·æ±‚å¿…é¡»åŒ…å«ä¸€ä¸ªåä¸º remember-me çš„å‚æ•°ã€‚åœ¨ç™»å½•è¡¨å•ä¸­ï¼Œå¢åŠ ä¸€ä¸ªç®€å•å¤é€‰æ¡†å°±å¯ä»¥å®Œæˆè¿™ä»¶äº‹æƒ…ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;remember_me&quot;</span> <span class="attr">name</span>=<span class="string">&quot;remember-me&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;remember_me&quot;</span> <span class="attr">class</span>=<span class="string">&quot;inline&quot;</span>&gt;</span>Remember me<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨åº”ç”¨ä¸­ï¼Œä¸ç™»å½•åŒç­‰é‡è¦çš„åŠŸèƒ½å°±æ˜¯é€€å‡ºã€‚å¦‚æœä½ å¯ç”¨ Rememberme åŠŸèƒ½çš„è¯ï¼Œæ›´æ˜¯å¦‚æ­¤ï¼Œå¦åˆ™çš„è¯ï¼Œç”¨æˆ·å°†æ°¸è¿œç™»å½•åœ¨è¿™ä¸ªç³»ç»Ÿä¸­ã€‚æˆ‘ä»¬ä¸‹é¢å°†çœ‹ä¸€ä¸‹å¦‚ä½•æ·»åŠ é€€å‡ºåŠŸèƒ½ã€‚</p>
<h4 id="é€€å‡º"><a href="#é€€å‡º" class="headerlink" title="é€€å‡º"></a>é€€å‡º</h4><p>å…¶å®ï¼ŒæŒ‰ç…§æˆ‘ä»¬çš„é…ç½®ï¼Œé€€å‡ºåŠŸèƒ½å·²ç»å¯ç”¨äº†ï¼Œä¸éœ€è¦å†åšå…¶ä»–çš„é…ç½®äº†ã€‚æˆ‘ä»¬éœ€è¦çš„åªæ˜¯ä¸€ä¸ªä½¿ç”¨è¯¥åŠŸèƒ½çš„é“¾æ¥ã€‚</p>
<p>é€€å‡ºåŠŸèƒ½æ˜¯é€šè¿‡ Servlet å®¹å™¨ä¸­çš„ Filter å®ç°çš„ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ï¼Œè¿™ä¸ª Filter ä¼šæ‹¦æˆªé’ˆå¯¹ â€œ/logoutâ€ çš„è¯·æ±‚ã€‚å› æ­¤ï¼Œä¸ºåº”ç”¨æ·»åŠ é€€å‡ºåŠŸèƒ½åªéœ€æ·»åŠ å¦‚ä¸‹çš„é“¾æ¥å³å¯ï¼ˆå¦‚ä¸‹ä»¥ Thymeleaf ä»£ç ç‰‡æ®µçš„å½¢å¼è¿›è¡Œäº†å±•ç°ï¼‰ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/logout&#125;&quot;</span>&gt;</span>Logout<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ç”¨æˆ·ç‚¹å‡»è¿™ä¸ªé“¾æ¥çš„æ—¶å€™ï¼Œä¼šå‘èµ·å¯¹ â€œ/logoutâ€ çš„è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šè¢« Spring Security çš„ LogoutFilter æ‰€å¤„ç†ã€‚ç”¨æˆ·ä¼šé€€å‡ºåº”ç”¨ï¼Œæ‰€æœ‰çš„ Remember-me token éƒ½ä¼šè¢«æ¸…é™¤æ‰ã€‚åœ¨é€€å‡ºå®Œæˆåï¼Œç”¨æˆ·æµè§ˆå™¨å°†ä¼šé‡å®šå‘åˆ° â€œ/login?logoutâ€ï¼Œä»è€Œå…è®¸ç”¨æˆ·è¿›è¡Œå†æ¬¡ç™»å½•ã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›ç”¨æˆ·è¢«é‡å®šå‘åˆ°å…¶ä»–çš„é¡µé¢ï¼Œå¦‚åº”ç”¨çš„é¦–é¡µï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ configure() ä¸­è¿›è¡Œå¦‚ä¸‹çš„é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;  http    .formLogin()    .loginPage(<span class="string">&quot;/login&quot;</span>);    .and()    .logout()    .logoutSuccessUrl(<span class="string">&quot;/&quot;</span>)    ...&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œå’Œå‰é¢ä¸€æ ·ï¼Œé€šè¿‡add()è¿æ¥èµ·äº†å¯¹ logout() çš„è°ƒç”¨ã€‚logout() æä¾›äº†é…ç½®é€€å‡ºè¡Œä¸ºçš„æ–¹æ³•ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè°ƒç”¨ logoutSuccessUrl() è¡¨æ˜åœ¨é€€å‡ºæˆåŠŸä¹‹åï¼Œæµè§ˆå™¨éœ€è¦é‡å®šå‘åˆ° â€œ/â€ã€‚</p>
<p>é™¤äº† logoutSuccessUrl() æ–¹æ³•ä»¥å¤–ï¼Œä½ å¯èƒ½è¿˜å¸Œæœ›é‡å†™é»˜è®¤çš„ LogoutFilter æ‹¦æˆªè·¯å¾„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ logoutUrl() æ–¹æ³•å®ç°è¿™ä¸€åŠŸèƒ½ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.logout().logoutSuccessUrl(<span class="string">&quot;/&quot;</span>).logoutUrl(<span class="string">&quot;/signout&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•åœ¨å‘èµ·è¯·æ±‚çš„æ—¶å€™ä¿æŠ¤ Web åº”ç”¨ã€‚è¿™å‡è®¾å®‰å…¨æ€§ä¸»è¦æ¶‰åŠé˜»æ­¢ç”¨æˆ·è®¿é—®æ²¡æœ‰æƒé™çš„ URLã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿä¸ç»™ç”¨æˆ·æ˜¾ç¤ºå…¶æ— æƒè®¿é—®çš„è¿æ¥ï¼Œé‚£ä¹ˆè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ€è·¯ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹ä¸€ä¸‹å¦‚ä½•æ·»åŠ è§†å›¾çº§åˆ«çš„å®‰å…¨æ€§ã€‚</p>
<h3 id="ä¿æŠ¤è§†å›¾"><a href="#ä¿æŠ¤è§†å›¾" class="headerlink" title="ä¿æŠ¤è§†å›¾"></a>ä¿æŠ¤è§†å›¾</h3><p>å½“ä¸ºæµè§ˆå™¨æ¸²æŸ“ HTML å†…å®¹æ—¶ï¼Œä½ å¯èƒ½å¸Œæœ›è§†å›¾ä¸­èƒ½å¤Ÿåæ˜ å®‰å…¨é™åˆ¶å’Œç›¸å…³çš„ä¿¡æ¯ã€‚ä¸€ä¸ªç®€å•çš„æ ·ä¾‹å°±æ˜¯æ¸²æŸ“ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼ˆæ¯”å¦‚æ˜¾ç¤ºâ€œæ‚¨å·²ç»ä»¥â€¦â€¦èº«ä»½ç™»å½•â€ï¼‰ã€‚æˆ–è€…ä½ æƒ³æ ¹æ®ç”¨æˆ·è¢«æˆäºˆäº†ä»€ä¹ˆæƒé™ï¼Œæœ‰æ¡ä»¶åœ°æ¸²æŸ“ç‰¹å®šçš„è§†å›¾å…ƒç´ ã€‚</p>
<p>åœ¨ç¬¬ 6 ç« ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†åœ¨ Spring MVC åº”ç”¨ä¸­æ¸²æŸ“è§†å›¾çš„ä¸¤ä¸ªæœ€é‡è¦çš„å¯é€‰æ–¹æ¡ˆï¼šJSP å’Œ Thymeleafã€‚ä¸ç®¡ä½ ä½¿ç”¨å“ªç§æ–¹æ¡ˆï¼Œéƒ½æœ‰åŠæ³•åœ¨è§†å›¾ä¸Šå®ç°å®‰å…¨æ€§ã€‚ Spring Security æœ¬èº«æä¾›äº†ä¸€ä¸ª JSP æ ‡ç­¾åº“ï¼Œè€Œ Thymeleaf é€šè¿‡ç‰¹å®šçš„æ–¹è¨€å®ç°äº†ä¸ Spring Security çš„é›†æˆã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•å°† Spring Security ç”¨åˆ°è§†å›¾ä¸­ï¼Œå°±ä» Spring Security çš„ JSP æ ‡ç­¾åº“å¼€å§‹å§ã€‚</p>
<h4 id="ä½¿ç”¨-Spring-Security-çš„-JSP-æ ‡ç­¾åº“"><a href="#ä½¿ç”¨-Spring-Security-çš„-JSP-æ ‡ç­¾åº“" class="headerlink" title="ä½¿ç”¨ Spring Security çš„ JSP æ ‡ç­¾åº“"></a>ä½¿ç”¨ Spring Security çš„ JSP æ ‡ç­¾åº“</h4><p>Spring Security çš„ JSP æ ‡ç­¾åº“å¾ˆå°ï¼ŒåªåŒ…å«ä¸‰ä¸ªæ ‡ç­¾ï¼Œå¦‚è¡¨ 9.6 æ‰€ç¤ºã€‚</p>
<center>è¡¨ 9.6ã€€Spring Security é€šè¿‡ JSP æ ‡ç­¾åº“åœ¨è§†å›¾å±‚ä¸Šæ”¯æŒå®‰å…¨æ€§</center>

<table>
<thead>
<tr>
<th>JSPæ ‡ç­¾</th>
<th>ä½œã€€ã€€ç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;security:accesscontrollist&gt;</code></td>
<td>å¦‚æœç”¨æˆ·é€šè¿‡è®¿é—®æ§åˆ¶åˆ—è¡¨æˆäºˆäº†æŒ‡å®šçš„æƒé™ï¼Œé‚£ä¹ˆæ¸²æŸ“è¯¥æ ‡ç­¾ä½“ä¸­çš„å†…å®¹</td>
</tr>
<tr>
<td><code>&lt;security:authentication&gt;</code></td>
<td>æ¸²æŸ“å½“å‰ç”¨æˆ·è®¤è¯å¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯</td>
</tr>
<tr>
<td><code>&lt;security:authorize&gt;</code></td>
<td>å¦‚æœç”¨æˆ·è¢«æˆäºˆäº†ç‰¹å®šçš„æƒé™æˆ–è€… SpEL è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœä¸º trueï¼Œé‚£ä¹ˆæ¸²æŸ“è¯¥æ ‡ç­¾ä½“ä¸­çš„å†…å®¹</td>
</tr>
</tbody></table>
<p>ä¸ºäº†ä½¿ç”¨ JSP æ ‡ç­¾åº“ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¯¹åº”çš„JSPä¸­å£°æ˜å®ƒï¼š</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;security&quot;</span> uri=<span class="string">&quot;http://www.springframework.org/security/tags&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>

<p>åªè¦æ ‡ç­¾åº“åœ¨ JSP æ–‡ä»¶ä¸­è¿›è¡Œäº†å£°æ˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å®ƒäº†ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ Spring Security æä¾›çš„è¿™ä¸‰ä¸ªæ ‡ç­¾æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<p>è®¿é—®è®¤è¯ä¿¡æ¯çš„ç»†èŠ‚</p>
<p>å€ŸåŠ© Spring Security JSP æ ‡ç­¾åº“ï¼Œæ‰€èƒ½åšåˆ°çš„æœ€ç®€å•çš„ä¸€ä»¶äº‹æƒ…å°±æ˜¯ä¾¿åˆ©åœ°è®¿é—®ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¯¹äº Web ç«™ç‚¹æ¥è®²ï¼Œåœ¨é¡µé¢é¡¶éƒ¨ä»¥ç”¨æˆ·åæ ‡ç¤ºæ˜¾ç¤ºâ€œæ¬¢è¿â€æˆ–â€œæ‚¨å¥½â€ä¿¡æ¯æ˜¯å¾ˆå¸¸è§çš„ã€‚è¿™æ°æ°æ˜¯ <code>&lt;security:authentication&gt;</code> èƒ½ä¸ºæˆ‘ä»¬æ‰€åšçš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello <span class="tag">&lt;<span class="name">security:authentication</span> <span class="attr">property</span>=<span class="string">&quot;pricipal.username&quot;</span> /&gt;</span>!</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œproperty ç”¨æ¥æ ‡ç¤ºç”¨æˆ·è®¤è¯å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ã€‚å¯ç”¨çš„å±æ€§å–å†³äºç”¨æˆ·è®¤è¯çš„æ–¹å¼ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¾èµ–å‡ ä¸ªé€šç”¨çš„å±æ€§ï¼Œåœ¨ä¸åŒçš„è®¤è¯æ–¹å¼ä¸‹ï¼Œå®ƒä»¬éƒ½æ˜¯å¯ç”¨çš„ï¼Œå¦‚è¡¨ 9.7 æ‰€ç¤ºã€‚</p>
<center>è¡¨ 9.7ã€€ä½¿ç”¨ &lt;security:authentication&gt; JSP æ ‡ç­¾æ¥è®¿é—®ç”¨æˆ·çš„è®¤è¯è¯¦æƒ…</center>

<table>
<thead>
<tr>
<th>è®¤ è¯ å± æ€§</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>authorities</td>
<td>ä¸€ç»„ç”¨äºè¡¨ç¤ºç”¨æˆ·æ‰€æˆäºˆæƒé™çš„ GrantedAuthority å¯¹è±¡</td>
</tr>
<tr>
<td>Credentials</td>
<td>ç”¨äºæ ¸å®ç”¨æˆ·çš„å‡­è¯ï¼ˆé€šå¸¸ï¼Œè¿™ä¼šæ˜¯ç”¨æˆ·çš„å¯†ç ï¼‰</td>
</tr>
<tr>
<td>details</td>
<td>è®¤è¯çš„é™„åŠ ä¿¡æ¯ï¼ˆIP åœ°å€ã€è¯ä»¶åºåˆ—å·ã€ä¼šè¯ ID ç­‰ï¼‰</td>
</tr>
<tr>
<td>principal</td>
<td>ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯å¯¹è±¡</td>
</tr>
</tbody></table>
<p>åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå®é™…ä¸Šæ¸²æŸ“çš„æ˜¯ principal å±æ€§ä¸­åµŒå¥—çš„ username å±æ€§ã€‚å½“åƒå‰é¢ç¤ºä¾‹é‚£æ ·ä½¿ç”¨æ—¶ï¼Œ<code>&lt;security:authentication&gt;</code> å°†åœ¨è§†å›¾ä¸­æ¸²æŸ“å±æ€§çš„å€¼ã€‚ä½†æ˜¯å¦‚æœä½ æ„¿æ„å°†å…¶èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œé‚£åªéœ€è¦åœ¨varå±æ€§ä¸­æŒ‡æ˜å˜é‡çš„åå­—å³å¯ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹å±•ç°äº†å¦‚ä½•å°†å…¶è®¾ç½®ç»™åä¸º loginId çš„å±æ€§ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">security:authentication</span> <span class="attr">property</span>=<span class="string">&quot;principal.username&quot;</span> <span class="attr">var</span>=<span class="string">&quot;loginId&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå˜é‡é»˜è®¤æ˜¯å®šä¹‰åœ¨é¡µé¢ä½œç”¨åŸŸå†…çš„ã€‚ä½†æ˜¯å¦‚æœä½ æ„¿æ„åœ¨å…¶ä»–ä½œç”¨åŸŸå†…åˆ›å»ºå®ƒï¼Œä¾‹å¦‚è¯·æ±‚æˆ–ä¼šè¯ä½œç”¨åŸŸï¼ˆæˆ–è€…æ˜¯èƒ½å¤Ÿåœ¨ javax.servlet.jsp.PageContext ä¸­è·å–çš„å…¶ä»–ä½œç”¨åŸŸï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ scope å±æ€§æ¥å£°æ˜ã€‚ä¾‹å¦‚ï¼Œè¦åœ¨è¯·æ±‚ä½œç”¨åŸŸå†…åˆ›å»ºè¿™ä¸ªå˜é‡ï¼Œé‚£å¯ä»¥ä½¿ç”¨ <code>&lt;security:authentication&gt;</code> æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼æ¥è®¾ç½®ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">security:authentication</span> <span class="attr">property</span>=<span class="string">&quot;principal.username&quot;</span> <span class="attr">var</span>=<span class="string">&quot;loginId&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;request&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;security:authentication&gt;</code> æ ‡ç­¾éå¸¸æœ‰ç”¨ï¼Œä½†è¿™åªæ˜¯ Spring Security JSP æ ‡ç­¾åº“åŠŸèƒ½çš„åŸºç¡€åŠŸèƒ½ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•æ ¹æ®ç”¨æˆ·çš„æƒé™æ¥æ¸²æŸ“å†…å®¹ã€‚</p>
<p>æ¡ä»¶æ€§çš„æ¸²æŸ“å†…å®¹</p>
<p>æœ‰æ—¶å€™è§†å›¾ä¸Šçš„ä¸€éƒ¨åˆ†å†…å®¹éœ€è¦æ ¹æ®ç”¨æˆ·è¢«æˆäºˆäº†ä»€ä¹ˆæƒé™æ¥ç¡®å®šæ˜¯å¦æ¸²æŸ“ã€‚å¯¹äºå·²ç»ç™»å½•çš„ç”¨æˆ·æ˜¾ç¤ºç™»å½•è¡¨å•ï¼Œæˆ–è€…å¯¹è¿˜æœªç™»å½•çš„ç”¨æˆ·æ˜¾ç¤ºä¸ªæ€§åŒ–çš„é—®å€™ä¿¡æ¯éƒ½æ˜¯æ¯«æ— æ„ä¹‰çš„ã€‚</p>
<p>Spring Security çš„ <code>&lt;security:authorize&gt;</code> JSP æ ‡ç­¾èƒ½å¤Ÿæ ¹æ®ç”¨æˆ·è¢«æˆäºˆçš„æƒé™æœ‰æ¡ä»¶åœ°æ¸²æŸ“é¡µé¢çš„éƒ¨åˆ†å†…å®¹ã€‚ä¾‹å¦‚ï¼Œåœ¨ Spittr åº”ç”¨ä¸­ï¼Œå¯¹äºæ²¡æœ‰ ROLE_SPITTER è§’è‰²çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬ä¸ä¼šä¸ºå…¶æ˜¾ç¤ºæ·»åŠ æ–° Spitter è®°å½•çš„è¡¨å•ã€‚ç¨‹åºæ¸…å• 9.9 å±•ç°äº†å¦‚ä½•ä½¿ç”¨ <code>&lt;security:authorize&gt;</code> æ ‡ç­¾æ¥ä¸ºå…·æœ‰ ROLE_SPITTER è§’è‰²çš„ç”¨æˆ·æ˜¾ç¤º Spitter è¡¨å•ã€‚</p>
<center>ç¨‹åºæ¸…å• 9.9ã€€ä½¿ç”¨ &lt;security:authorize&gt; æ ‡ç­¾åŸºäº SpEL è¿›è¡Œæœ‰æ¡ä»¶åœ°æ¸²æŸ“</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;sec:authorize access=<span class="string">&quot;hasRole(&#x27;ROLE_SPITTER&#x27;)&quot;</span>&gt;  &lt;s:url value=<span class="string">&quot;/spittles&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;spittle_url&quot;</span> /&gt;  &lt;sf:form modelAttribute=<span class="string">&quot;spittle&quot;</span> action=<span class="string">&quot;$&#123;spittle_url&#125;&quot;</span>&gt;    &lt;sf:label path=<span class="string">&quot;text&quot;</span>&gt;      &lt;s:message code=<span class="string">&quot;label.spittle&quot;</span> text=<span class="string">&quot;Enter spittle:&quot;</span> /&gt;    &lt;/sf:label&gt;    &lt;sf:textarea path=<span class="string">&quot;text&quot;</span> row=<span class="string">&quot;2&quot;</span> cols=<span class="string">&quot;40&quot;</span> /&gt;    &lt;sf:errors path=<span class="string">&quot;text&quot;</span> /&gt;    &lt;br/&gt;    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;spitItSubmit&quot;</span>&gt;      &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Spit it !&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;status-btn round-btn disabled&quot;</span> /&gt;    &lt;/div&gt;  &lt;/sf:form&gt;&lt;/sec:authorize&gt;</span><br></pre></td></tr></table></figure>

<p>access å±æ€§è¢«èµ‹å€¼ä¸ºä¸€ä¸ª SpEL è¡¨è¾¾å¼ï¼Œè¿™ä¸ªè¡¨è¾¾å¼çš„å€¼å°†ç¡®å®š &lt;security: authorize&gt; æ ‡ç­¾ä¸»ä½“å†…çš„å†…å®¹æ˜¯å¦æ¸²æŸ“ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† hasRole(â€˜ROLE_SPITTERâ€™) è¡¨è¾¾å¼æ¥ç¡®ä¿ç”¨æˆ·å…·æœ‰ ROLE_SPITTER è§’è‰²ã€‚ä½†æ˜¯ï¼Œå½“ä½ è®¾ç½® access å±æ€§æ—¶ï¼Œå¯ä»¥ä»»æ„å‘æŒ¥ SpEL çš„å¼ºå¤§å¨åŠ›ï¼ŒåŒ…æ‹¬è¡¨ 9.5 æ‰€ç¤ºçš„ Spring Security æ‰€æä¾›çš„è¡¨è¾¾å¼ã€‚</p>
<p>å€ŸåŠ©äºè¿™äº›å¯ç”¨çš„è¡¨è¾¾å¼ï¼Œå¯ä»¥æ„é€ å‡ºéå¸¸æœ‰æ„æ€çš„å®‰å…¨æ€§çº¦æŸã€‚ä¾‹å¦‚ï¼Œå‡è®¾åº”ç”¨ä¸­æœ‰ä¸€äº›ç®¡ç†åŠŸèƒ½åªèƒ½å¯¹ç”¨æˆ·åä¸º habuma çš„ç”¨æˆ·å¯ç”¨ã€‚ä¹Ÿè®¸ä½ ä¼šåƒè¿™æ ·ä½¿ç”¨ isAuthenticated() å’Œ principal è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">security:authorize</span> <span class="attr">access</span>=<span class="string">&quot;isAuthenticated and principal.username==&#x27;habuma&#x27;&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/admin&quot;</span>&gt;</span>Administration<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">security:authorize</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ç›¸ä¿¡ä½ èƒ½è®¾è®¡å‡ºæ¯”è¿™ä¸ªæ›´æœ‰æ„æ€çš„è¡¨è¾¾å¼,å¯ä»¥å°½æƒ…å‘æŒ¥ä½ çš„æƒ³è±¡åŠ›æ¥æ„é€ æ›´å¤šçš„å®‰å…¨æ€§çº¦æŸã€‚å€ŸåŠ©äº SpELï¼Œé€‰æ‹©å…¶å®æ˜¯æ— é™çš„ã€‚</p>
<p>ä½†æ˜¯æˆ‘æ„é€ çš„è¿™ä¸ªç¤ºä¾‹è¿˜æœ‰ä¸€ä»¶äº‹è®©äººå¾ˆå›°æƒ‘ã€‚å°½ç®¡æˆ‘æƒ³é™åˆ¶ç®¡ç†åŠŸèƒ½åªèƒ½ç»™ habuma ç”¨æˆ·ï¼Œä½†ä½¿ç”¨ JSP æ ‡ç­¾è¡¨è¾¾å¼å¹¶ä¸è§å¾—ç†æƒ³ã€‚ç¡®å®ï¼Œå®ƒèƒ½åœ¨è§†å›¾ä¸Šé˜»æ­¢é“¾æ¥çš„æ¸²æŸ“ã€‚ä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢åˆ«äººåœ¨æµè§ˆå™¨çš„åœ°å€æ æ‰‹åŠ¨è¾“å…¥â€œ/adminâ€ è¿™ä¸ª URLã€‚</p>
<p>æ ¹æ®æˆ‘ä»¬åœ¨æœ¬ç« å‰é¢æ‰€å­¦ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå®¹æ˜“è§£å†³çš„é—®é¢˜ã€‚åœ¨å®‰å…¨é…ç½®ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªå¯¹ antMatchers() æ–¹æ³•çš„è°ƒç”¨å°†ä¼šä¸¥æ ¼é™åˆ¶å¯¹ â€œ/adminâ€ è¿™ä¸ª URL çš„è®¿é—®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.antMatchers(<span class="string">&quot;/admin&quot;</span>).access(<span class="string">&quot;isAuthenticated and principal.username=&#x27;habuma&#x27;&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œç®¡ç†åŠŸèƒ½å·²ç»è¢«é”å®šäº†ã€‚URL åœ°å€å¾—åˆ°äº†ä¿æŠ¤ï¼Œå¹¶ä¸”åˆ°è¿™ä¸ª URL çš„é“¾æ¥åœ¨ç”¨æˆ·æ²¡æœ‰æˆæƒä½¿ç”¨çš„æƒ…å†µä¸‹ä¸ä¼šæ˜¾ç¤ºã€‚ä½†æ˜¯ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸¤ä¸ªåœ°æ–¹å£°æ˜ SpEL è¡¨è¾¾å¼â€”â€”åœ¨å®‰å…¨é…ç½®ä¸­ä»¥åŠåœ¨ <code>&lt;security:authorize&gt;</code> æ ‡ç­¾çš„ access å±æ€§ä¸­ã€‚æœ‰æ²¡æœ‰åŠæ³•æ¶ˆé™¤è¿™ç§é‡å¤æ€§ï¼Œå¹¶ä¸”è¿˜è¦ç¡®ä¿åªæœ‰è§„åˆ™æ¡ä»¶æ»¡è¶³çš„æƒ…å†µä¸‹æ‰æ¸²æŸ“ç®¡ç†åŠŸèƒ½çš„é“¾æ¥å‘¢ï¼Ÿ</p>
<p>è¿™æ˜¯ <code>&lt;security:authorize&gt;</code> çš„ url å±æ€§æ‰€è¦åšçš„äº‹æƒ…ã€‚å®ƒä¸åƒ access å±æ€§é‚£æ ·æ˜ç¡®å£°æ˜å®‰å…¨æ€§é™åˆ¶ï¼Œurl å±æ€§å¯¹ä¸€ä¸ªç»™å®šçš„ URL æ¨¡å¼ä¼šé—´æ¥å¼•ç”¨å…¶å®‰å…¨æ€§çº¦æŸã€‚é‰´äºæˆ‘ä»¬å·²ç»åœ¨ Spring Security é…ç½®ä¸­ä¸º â€œ/adminâ€ å£°æ˜äº†å®‰å…¨æ€§çº¦æŸï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨ url å±æ€§ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">security:authorize</span> <span class="attr">url</span>=<span class="string">&quot;/admin&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">spring:url</span> <span class="attr">value</span>=<span class="string">&quot;/admin&quot;</span> <span class="attr">var</span>=<span class="string">&quot;admin_url&quot;</span> /&gt;</span>  <span class="tag">&lt;<span class="name">br</span>/&gt;</span>  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;$&#123;admin_url&#125;&quot;</span>&gt;</span>Admin<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">security:authorize</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºåªæœ‰åŸºæœ¬ä¿¡æ¯ä¸­ç”¨æˆ·åä¸º â€œhabumaâ€ çš„å·²è®¤è¯ç”¨æˆ·æ‰èƒ½è®¿é—® â€œ/adminâ€ URLï¼Œæ‰€ä»¥åªæœ‰æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œ<code>&lt;security:authorize&gt;</code> æ ‡ç­¾ä¸»ä½“ä¸­çš„å†…å®¹æ‰ä¼šè¢«æ¸²æŸ“ã€‚æˆ‘ä»¬åªåœ¨ä¸€ä¸ªåœ°æ–¹é…ç½®äº†è¡¨è¾¾å¼ï¼ˆå®‰å…¨é…ç½®ä¸­ï¼‰ï¼Œä½†æ˜¯åœ¨ä¸¤ä¸ªåœ°æ–¹è¿›è¡Œäº†åº”ç”¨ã€‚</p>
<p>Spring Security çš„ JSP æ ‡ç­¾åº“éå¸¸ä¾¿åˆ©ï¼Œå°¤å…¶æ˜¯åªç»™æ»¡è¶³æ¡ä»¶çš„ç”¨æˆ·æ¸²æŸ“ç‰¹å®šçš„è§†å›¾å…ƒç´ æ—¶æ›´æ˜¯å¦‚æ­¤ã€‚å¦‚æœæˆ‘ä»¬é€‰æ‹© Thymeleaf è€Œä¸æ˜¯ JSP ä½œä¸ºè§†å›¾æ–¹æ¡ˆçš„è¯ï¼Œæˆ‘ä»¬å…¶å®è¿˜èƒ½å»¶ç»­è¿™ç§å¥½è¿æ°”ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ° Thymeleaf çš„ Spring æ–¹è¨€èƒ½å¤Ÿè‡ªåŠ¨ä¸ºè¡¨å•æ·»åŠ éšè—çš„ CSRF tokenï¼Œç°åœ¨æˆ‘ä»¬çœ‹ä¸€ä¸‹ Thymeleaf å¦‚ä½•æ”¯æŒ Spring Securityã€‚</p>
<h4 id="ä½¿ç”¨-Thymeleaf-çš„-Spring-Security-æ–¹è¨€"><a href="#ä½¿ç”¨-Thymeleaf-çš„-Spring-Security-æ–¹è¨€" class="headerlink" title="ä½¿ç”¨ Thymeleaf çš„ Spring Security æ–¹è¨€"></a>ä½¿ç”¨ Thymeleaf çš„ Spring Security æ–¹è¨€</h4><p>ä¸ Spring Security çš„ JSP æ ‡ç­¾åº“ç±»ä¼¼ï¼ŒThymeleaf çš„å®‰å…¨æ–¹è¨€æä¾›äº†æ¡ä»¶åŒ–æ¸²æŸ“å’Œæ˜¾ç¤ºè®¤è¯ç»†èŠ‚çš„èƒ½åŠ›ã€‚è¡¨ 9.8 åˆ—å‡ºäº†å®‰å…¨æ–¹è¨€æ‰€æä¾›çš„å±æ€§ã€‚</p>
<p>è¡¨9.8ã€€Thymeleafçš„å®‰å…¨æ–¹è¨€æä¾›äº†ä¸Spring Securityæ ‡ç­¾åº“ç›¸å¯¹åº”çš„å±æ€§</p>
<table>
<thead>
<tr>
<th>å±ã€€ã€€æ€§</th>
<th>ä½œã€€ã€€ç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>sec:authentication</td>
<td>æ¸²æŸ“è®¤è¯å¯¹è±¡çš„å±æ€§ã€‚ç±»ä¼¼äºSpring Securityçš„<a href="sec:authentication/">sec:authentication/</a>JSPæ ‡ç­¾</td>
</tr>
<tr>
<td>sec:authorize</td>
<td>åŸºäºè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœï¼Œæ¡ä»¶æ€§çš„æ¸²æŸ“å†…å®¹ã€‚ç±»ä¼¼äºSpringSecurityçš„<a href="sec:authorize/">sec:authorize/</a>JSPæ ‡ç­¾</td>
</tr>
<tr>
<td>sec:authorize-acl</td>
<td>åŸºäºè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœï¼Œæ¡ä»¶æ€§çš„æ¸²æŸ“å†…å®¹ã€‚ç±»ä¼¼äºSpringSecurityçš„<a href="sec:accesscontrollist/">sec:accesscontrollist/</a> JSPæ ‡ç­¾</td>
</tr>
<tr>
<td>sec:authorize-expr</td>
<td>sec:authorizeå±æ€§çš„åˆ«å</td>
</tr>
<tr>
<td>sec:authorize-url</td>
<td>åŸºäºç»™å®šURLè·¯å¾„ç›¸å…³çš„å®‰å…¨è§„åˆ™ï¼Œæ¡ä»¶æ€§çš„æ¸²æŸ“å†…å®¹ã€‚ç±»ä¼¼äºSpring Securityçš„<a href="sec:authorize/">sec:authorize/</a> JSPæ ‡ç­¾ä½¿ç”¨urlå±æ€§æ—¶çš„åœºæ™¯</td>
</tr>
</tbody></table>
<p>ä¸ºäº†ä½¿ç”¨å®‰å…¨æ–¹è¨€ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿ Thymeleaf Extras Spring Security å·²ç»ä½äºåº”ç”¨çš„ç±»è·¯å¾„ä¸‹ã€‚ç„¶åï¼Œè¿˜éœ€è¦åœ¨é…ç½®ä¸­ä½¿ç”¨ SpringTemplateEngine æ¥æ³¨å†ŒSpringSecurity Dialectã€‚ç¨‹åºæ¸…å• 9.10 æ‰€å±•ç°çš„ @Bean æ–¹æ³•å£°æ˜äº† SpringTemplateEngine beanï¼Œå…¶ä¸­å°±åŒ…å«äº† SpringSecurityDialectã€‚</p>
<center>ç¨‹åºæ¸…å• 9.10ã€€æ³¨å†Œ Thymeleaf çš„ Spring Security å®‰å…¨æ–¹è¨€</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">SpringTemplateEngine <span class="title">templateEngine</span><span class="params">(TemplateResolver templateResolver)</span> </span>&#123;  SpringTemplateEngine templateEngine = <span class="keyword">new</span> SpringTemplateEngine();  templateEngine.setTemplateResolver(templateResolver);  templateEngine.addDialect(<span class="keyword">new</span> SpringSecurityDialect());  <span class="keyword">return</span> templateEngine;&#125;</span><br></pre></td></tr></table></figure>

<p>å®‰å…¨æ–¹è¨€æ³¨å†Œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ Thymeleaf æ¨¡æ¿ä¸­ä½¿ç”¨å®ƒçš„å±æ€§äº†ã€‚é¦–å…ˆï¼Œéœ€è¦åœ¨ä½¿ç”¨è¿™äº›å±æ€§çš„æ¨¡æ¿ä¸­å£°æ˜å®‰å…¨å‘½åç©ºé—´ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span>      <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>      <span class="attr">xmlns:sec</span>=<span class="string">&quot;http://www.thymeleaf.org/thymeleaf-extras-springsecurity3&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæ ‡å‡†çš„ Thymeleaf æ–¹æ³•ä¾æ—§ä¸ä¹‹å‰ä¸€æ ·ï¼Œä½¿ç”¨ th å‰ç¼€ï¼Œå®‰å…¨æ–¹è¨€åˆ™è®¾ç½®ä¸ºä½¿ç”¨ sec å‰ç¼€ã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬å°±èƒ½åœ¨ä»»æ„åˆé€‚çš„åœ°æ–¹ä½¿ç”¨ Thymeleaf å±æ€§äº†ã€‚æ¯”å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦ä¸ºè®¤è¯ç”¨æˆ·æ¸²æŸ“â€œHelloâ€æ–‡æœ¬ã€‚å¦‚ä¸‹çš„ Thymeleaf æ¨¡æ¿ä»£ç ç‰‡æ®µå°±èƒ½å®Œæˆè¿™é¡¹ä»»åŠ¡ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;isAuthenticated&quot;</span>&gt;</span>  Hello <span class="tag">&lt;<span class="name">span</span> <span class="attr">sec:authentication</span>=<span class="string">&quot;name&quot;</span>&gt;</span>someone<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>sec:authorize</code> å±æ€§ä¼šæ¥å—ä¸€ä¸ª SpEL è¡¨è¾¾å¼ã€‚å¦‚æœè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœä¸º trueï¼Œé‚£ä¹ˆå…ƒç´ çš„ä¸»ä½“å†…å®¹å°±ä¼šæ¸²æŸ“ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¡¨è¾¾å¼ä¸º isAuthenticated()ï¼Œæ‰€ä»¥åªæœ‰ç”¨æˆ·å·²ç»è¿›è¡Œäº†è®¤è¯ï¼Œæ‰ä¼šæ¸²æŸ“ <code>&lt;div&gt;</code> æ ‡ç­¾çš„ä¸»ä½“å†…å®¹ã€‚å°±è¿™ä¸ªæ ‡ç­¾çš„ä¸»ä½“å†…å®¹éƒ¨åˆ†è€Œè¨€ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯ä½¿ç”¨è®¤è¯å¯¹è±¡çš„ name å±æ€§æç¤º â€œHelloâ€ æ–‡æœ¬ã€‚</p>
<p>ä½ å¯èƒ½è¿˜è®°å¾—ï¼Œåœ¨ Spring Security ä¸­ï¼Œå€ŸåŠ© <code>&lt;sec:authorize&gt;</code> JSP æ ‡ç­¾çš„ url å±æ€§èƒ½å¤ŸåŸºäºç»™å®š URL çš„æƒé™æœ‰æ¡ä»¶åœ°æ¸²æŸ“å†…å®¹ã€‚åœ¨ Thymeleaf ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>sec:authorize-url</code> å±æ€§å®Œæˆç›¸åŒçš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹ Thymeleaf ä»£ç ç‰‡æ®µæ‰€å®ç°çš„åŠŸèƒ½ä¸ä¹‹å‰ <code>&lt;sec:authorize&gt;</code> JSPæ ‡ç­¾å’Œ url å±æ€§æ‰€å®ç°çš„åŠŸèƒ½æ˜¯ç›¸åŒçš„ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">sec:authorize-url</span>=<span class="string">&quot;/admin&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">br</span>/&gt;</span>  <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/admin&#125;&quot;</span>&gt;</span>Admin<span class="tag">&lt;/&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœç”¨æˆ·æœ‰æƒé™è®¿é—® â€œ/adminâ€ çš„è¯ï¼Œé‚£ä¹ˆåˆ°ç®¡ç†é¡µé¢çš„é“¾æ¥å°±ä¼šæ¸²æŸ“ï¼Œå¦åˆ™çš„è¯ï¼Œè¿™ä¸ªé“¾æ¥å°†ä¸ä¼šæ¸²æŸ“ã€‚</p>
<h3 id="å°ç»“-8"><a href="#å°ç»“-8" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å¯¹äºè®¸å¤šåº”ç”¨è€Œè¨€ï¼Œå®‰å…¨æ€§éƒ½æ˜¯éå¸¸é‡è¦çš„åˆ‡é¢ã€‚Spring Security æä¾›äº†ä¸€ç§ç®€å•ã€çµæ´»ä¸”å¼ºå¤§çš„æœºåˆ¶æ¥ä¿æŠ¤æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚</p>
<p>å€ŸåŠ©äºä¸€ç³»åˆ— Servlet Filterï¼ŒSpring Security èƒ½å¤Ÿæ§åˆ¶å¯¹ Web èµ„æºçš„è®¿é—®ï¼ŒåŒ…æ‹¬ Spring MVC æ§åˆ¶å™¨ã€‚å€ŸåŠ©äº Spring Security çš„ Java é…ç½®æ¨¡å‹ï¼Œæˆ‘ä»¬ä¸å¿…ç›´æ¥å¤„ç† Filterï¼Œèƒ½å¤Ÿéå¸¸ç®€æ´åœ°å£°æ˜ Web å®‰å…¨æ€§åŠŸèƒ½ã€‚</p>
<p>å½“è®¤è¯ç”¨æˆ·æ—¶ï¼ŒSpring Security æä¾›äº†å¤šç§é€‰é¡¹ã€‚æˆ‘ä»¬æ¢è®¨äº†å¦‚ä½•åŸºäºå†…å­˜ç”¨æˆ·åº“ã€å…³ç³»å‹æ•°æ®åº“å’Œ LDAP ç›®å½•æœåŠ¡å™¨æ¥é…ç½®è®¤è¯åŠŸèƒ½ã€‚å¦‚æœè¿™äº›å¯é€‰æ–¹æ¡ˆæ— æ³•æ»¡è¶³è®¤è¯éœ€æ±‚çš„è¯ï¼Œæˆ‘ä»¬è¿˜å­¦ä¹ äº†å¦‚ä½•åˆ›å»ºå’Œé…ç½®è‡ªå®šä¹‰çš„ç”¨æˆ·æœåŠ¡ã€‚</p>
<p>åœ¨å‰é¢çš„å‡ ç« ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•å°†Springè¿ç”¨åˆ°åº”ç”¨ç¨‹åºçš„å‰ç«¯ã€‚åœ¨æ¥ä¸‹æ¥çš„ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šç»§ç»­æ·±å…¥è¿™ä¸ªæŠ€æœ¯æ ˆï¼Œå­¦ä¹  Spring å¦‚ä½•åœ¨åç«¯å‘æŒ¥ä½œç”¨ï¼Œä¸‹ä¸€ç« å°†ä¼šé¦–å…ˆä» Spring çš„ JDBC æŠ½è±¡å¼€å§‹ã€‚</p>
<h1 id="åç«¯ä¸­çš„-Spring"><a href="#åç«¯ä¸­çš„-Spring" class="headerlink" title="åç«¯ä¸­çš„ Spring"></a>åç«¯ä¸­çš„ Spring</h1><p>å°½ç®¡ç”¨æˆ·çœ‹åˆ°çš„å†…å®¹æ˜¯ç”±Webåº”ç”¨æ‰€æä¾›çš„é¡µé¢ï¼Œä½†æ˜¯åœ¨è¿™èƒŒåï¼Œå®é™…çš„å·¥ä½œæ˜¯åœ¨åç«¯æœåŠ¡å™¨ä¸­å‘ç”Ÿçš„ï¼Œåœ¨è¿™é‡Œä¼šå¤„ç†å’ŒæŒä¹…åŒ–æ•°æ®ã€‚ç¬¬3éƒ¨åˆ†å°†ä¼šå…³æ³¨Springå¦‚ä½•å¸®åŠ©æˆ‘ä»¬åœ¨åç«¯å¤„ç†æ•°æ®ã€‚</p>
<p>å¤šå¹´ä»¥æ¥ï¼Œå…³ç³»å‹æ•°æ®åº“ä¸€ç›´æ˜¯ä¼ä¸šçº§åº”ç”¨ä¸­çš„ç»Ÿæ²»è€…ã€‚åœ¨ç¬¬ 10 ç«  â€œé€šè¿‡ Spring å’Œ JDBC å¾æœæ•°æ®åº“â€ ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨ Spring çš„ JDBC æŠ½è±¡æ¥æŸ¥è¯¢å…³ç³»å‹æ•°æ®åº“ï¼Œè¿™è¦æ¯”åŸç”Ÿçš„ JDBC ç®€å•å¾—å¤šã€‚</p>
<p>å¦‚æœä½ ä¸å–œæ¬¢ JDBC é£æ ¼çš„è¯ï¼Œåœ¨ç¬¬ 11 ç«  â€œé€šè¿‡å¯¹è±¡-å…³ç³»æ˜ å°„æŒä¹…åŒ–æ•°æ®â€ ä¸­ï¼Œå°†ä¼šå±•ç°å¦‚ä½•ä¸ ORM æ¡†æ¶è¿›è¡Œé›†æˆï¼Œè¿™äº›æ¡†æ¶åŒ…æ‹¬ Hibernate ä»¥åŠå…¶ä»–çš„ Java æŒä¹…åŒ– APIï¼ˆJava Persistence APIï¼ŒJPAï¼‰å®ç°ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å°†ä¼šçœ‹åˆ°å¦‚ä½•å‘æŒ¥ Spring Data JPA çš„é­”åŠ›ï¼Œåœ¨è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆ Repository å®ç°ã€‚</p>
<p>å…³ç³»å‹æ•°æ®åº“ä¸ä¸€å®šæ˜¯æ‰€æœ‰åœºæ™¯ä¸‹çš„æœ€ä½³é€‰æ‹©ï¼Œå› æ­¤ï¼Œç¬¬ 12 ç« â€œä½¿ç”¨ NoSQL æ•°æ®åº“â€å°†ä¼šç ”ç©¶å…¶ä»–çš„ Spring Data é¡¹ç›®ï¼Œå®ƒä»¬èƒ½å¤ŸæŒä¹…åŒ–å„ç§éå…³ç³»å‹æ•°æ®åº“ä¸­çš„æ•°æ®ï¼ŒåŒ…æ‹¬ MongoDBã€Neo4j å’Œ Redisã€‚</p>
<p>ç¬¬ 13 ç« â€œç¼“å­˜æ•°æ®â€ä¸ºä¸Šè¿°çš„æŒä¹…åŒ–ç« æä¾›äº†ä¸€ä¸ªç¼“å­˜å±‚ï¼Œå¦‚æœæ•°æ®å·²ç»å¯ç”¨çš„è¯ï¼Œå®ƒä¼šé¿å…æ•°æ®åº“æ“ä½œï¼Œä»è€Œæå‡åº”ç”¨çš„æ€§èƒ½ã€‚</p>
<p>ä¸å‰ç«¯ç±»ä¼¼ï¼Œå®‰å…¨æ€§åœ¨åç«¯ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ–¹é¢ã€‚åœ¨ç¬¬ 14 ç« â€œä¿æŠ¤æ–¹æ³•åº”ç”¨â€ä¸­ï¼Œå°†ä¼šæŠŠ Spring Security åº”ç”¨äºåç«¯ï¼Œå®ƒä¼šæ‹¦æˆªæ–¹æ³•çš„è°ƒç”¨å¹¶ç¡®ä¿è°ƒç”¨è€…è¢«æˆäºˆäº†é€‚å½“çš„æƒé™ã€‚</p>
<h2 id="é€šè¿‡-Spring-å’Œ-JDBC-å¾æœæ•°æ®åº“"><a href="#é€šè¿‡-Spring-å’Œ-JDBC-å¾æœæ•°æ®åº“" class="headerlink" title="é€šè¿‡ Spring å’Œ JDBC å¾æœæ•°æ®åº“"></a>é€šè¿‡ Spring å’Œ JDBC å¾æœæ•°æ®åº“</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>å®šä¹‰ Spring å¯¹æ•°æ®è®¿é—®çš„æ”¯æŒ</li>
<li>é…ç½®æ•°æ®åº“èµ„æº</li>
<li>ä½¿ç”¨ Spring çš„ JDBC æ¨¡ç‰ˆ</li>
</ul>
<p>åœ¨æŒæ¡äº† Spring å®¹å™¨çš„æ ¸å¿ƒçŸ¥è¯†ä¹‹åï¼Œæ˜¯æ—¶å€™å°†å®ƒåœ¨å®é™…åº”ç”¨ä¸­è¿›è¡Œä½¿ç”¨äº†ã€‚æ•°æ®æŒä¹…åŒ–æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„èµ·ç‚¹ï¼Œå› ä¸ºå‡ ä¹æ‰€æœ‰çš„ä¼ä¸šçº§åº”ç”¨ç¨‹åºä¸­éƒ½å­˜åœ¨è¿™æ ·çš„éœ€æ±‚ã€‚æˆ‘ä»¬å¯èƒ½éƒ½å¤„ç†è¿‡æ•°æ®åº“è®¿é—®åŠŸèƒ½ï¼Œåœ¨å®é™…çš„å·¥ä½œä¸­ä¹Ÿå‘ç°æ•°æ®è®¿é—®æœ‰ä¸€äº›ä¸è¶³ä¹‹å¤„ã€‚æˆ‘ä»¬å¿…é¡»åˆå§‹åŒ–æ•°æ®è®¿é—®æ¡†æ¶ã€æ‰“å¼€è¿æ¥ã€å¤„ç†å„ç§å¼‚å¸¸å’Œå…³é—­è¿æ¥ã€‚å¦‚æœä¸Šè¿°æ“ä½œå‡ºç°ä»»ä½•é—®é¢˜ï¼Œéƒ½æœ‰å¯èƒ½æŸåæˆ–åˆ é™¤çè´µçš„ä¼ä¸šæ•°æ®ã€‚å¦‚æœä½ è¿˜æœªæ›¾ç»å†è¿‡å› æœªå¦¥å–„å¤„ç†æ•°æ®è®¿é—®è€Œå¸¦æ¥çš„ä¸¥é‡åæœï¼Œé‚£æˆ‘è¦æé†’ä½ è¿™ç»å¯¹ä¸æ˜¯ä»€ä¹ˆå¥½äº‹æƒ…ã€‚</p>
<p>åšäº‹è¦è¿½æ±‚å°½å–„å°½ç¾ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©äº† Springã€‚Spring è‡ªå¸¦äº†ä¸€ç»„æ•°æ®è®¿é—®æ¡†æ¶ï¼Œé›†æˆäº†å¤šç§æ•°æ®è®¿é—®æŠ€æœ¯ã€‚ä¸ç®¡ä½ æ˜¯ç›´æ¥é€šè¿‡ JDBC è¿˜æ˜¯åƒ Hibernate è¿™æ ·çš„å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆobject-relational mappingï¼ŒORMï¼‰æ¡†æ¶å®ç°æ•°æ®æŒä¹…åŒ–ï¼ŒSpring éƒ½èƒ½å¤Ÿå¸®ä½ æ¶ˆé™¤æŒä¹…åŒ–ä»£ç ä¸­é‚£äº›å•è°ƒæ¯ç‡¥çš„æ•°æ®è®¿é—®é€»è¾‘ã€‚æˆ‘ä»¬å¯ä»¥ä¾èµ– Spring æ¥å¤„ç†åº•å±‚çš„æ•°æ®è®¿é—®ï¼Œè¿™æ ·å°±å¯ä»¥ä¸“æ³¨äºåº”ç”¨ç¨‹åºä¸­æ•°æ®çš„ç®¡ç†äº†ã€‚</p>
<p>å½“å¼€å‘ Spittr åº”ç”¨çš„æŒä¹…å±‚çš„æ—¶å€™ï¼Œä¼šé¢ä¸´å¤šç§é€‰æ‹©ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JDBCã€Hibernateã€Java æŒä¹…åŒ– APIï¼ˆJava Persistence APIï¼ŒJPAï¼‰æˆ–è€…å…¶ä»–ä»»æ„çš„æŒä¹…åŒ–æ¡†æ¶ã€‚ä½ å¯èƒ½è¿˜ä¼šè€ƒè™‘ä½¿ç”¨æœ€è¿‘å¾ˆæµè¡Œçš„ NoSQL æ•°æ®åº“ï¼ˆå…¶å®æˆ‘æ›´å–œæ¬¢å°†å…¶ç§°ä¸ºæ— æ¨¡å¼æ•°æ®åº“ï¼‰ã€‚</p>
<p>å¹¸å¥½ï¼Œä¸ç®¡ä½ é€‰æ‹©å“ªç§æŒä¹…åŒ–æ–¹å¼ï¼ŒSpring éƒ½èƒ½å¤Ÿæä¾›æ”¯æŒã€‚åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨äº Spring å¯¹ JDBC çš„æ”¯æŒã€‚ä½†é¦–å…ˆï¼Œæˆ‘ä»¬æ¥ç†Ÿæ‚‰ä¸€ä¸‹ Spring çš„æŒä¹…åŒ–å“²å­¦ï¼Œä»è€Œä¸ºåé¢æ‰“å¥½åŸºç¡€ã€‚</p>
<h3 id="Spring-çš„æ•°æ®è®¿é—®å“²å­¦"><a href="#Spring-çš„æ•°æ®è®¿é—®å“²å­¦" class="headerlink" title="Spring çš„æ•°æ®è®¿é—®å“²å­¦"></a>Spring çš„æ•°æ®è®¿é—®å“²å­¦</h3><p>ä»å‰é¢çš„å‡ ç« å¯ä»¥çœ‹å‡ºï¼ŒSpring çš„ç›®æ ‡ä¹‹ä¸€å°±æ˜¯å…è®¸æˆ‘ä»¬åœ¨å¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼Œèƒ½å¤Ÿéµå¾ªé¢å‘å¯¹è±¡ï¼ˆOOï¼‰åŸåˆ™ä¸­çš„â€œé’ˆå¯¹æ¥å£ç¼–ç¨‹â€ã€‚Spring å¯¹æ•°æ®è®¿é—®çš„æ”¯æŒä¹Ÿä¸ä¾‹å¤–ã€‚</p>
<p>åƒå¾ˆå¤šåº”ç”¨ç¨‹åºä¸€æ ·ï¼ŒSpittr åº”ç”¨éœ€è¦ä»æŸç§ç±»å‹çš„æ•°æ®åº“ä¸­è¯»å–å’Œå†™å…¥æ•°æ®ã€‚ä¸ºäº†é¿å…æŒä¹…åŒ–çš„é€»è¾‘åˆ†æ•£åˆ°åº”ç”¨çš„å„ä¸ªç»„ä»¶ä¸­ï¼Œæœ€å¥½å°†æ•°æ®è®¿é—®çš„åŠŸèƒ½æ”¾åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä¸“æ³¨äºæ­¤é¡¹ä»»åŠ¡çš„ç»„ä»¶ä¸­ã€‚è¿™æ ·çš„ç»„ä»¶é€šå¸¸ç§°ä¸ºæ•°æ®è®¿é—®å¯¹è±¡ï¼ˆdata access objectï¼ŒDAOï¼‰æˆ– Repositoryã€‚</p>
<p>ä¸ºäº†é¿å…åº”ç”¨ä¸ç‰¹å®šçš„æ•°æ®è®¿é—®ç­–ç•¥è€¦åˆåœ¨ä¸€èµ·ï¼Œç¼–å†™è‰¯å¥½çš„ Repository åº”è¯¥ä»¥æ¥å£çš„æ–¹å¼æš´éœ²åŠŸèƒ½ã€‚å›¾ 10.1 å±•ç°äº†è®¾è®¡æ•°æ®è®¿é—®å±‚çš„åˆç†æ–¹å¼ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211101203221220.png" alt="image-20211101203221220"></p>
<center>å›¾ 10.1ã€€æœåŠ¡å¯¹è±¡æœ¬èº«å¹¶ä¸ä¼šå¤„ç†æ•°æ®è®¿é—®ï¼Œè€Œæ˜¯å°†æ•°æ®è®¿é—®å§”æ‰˜ç»™ Repositoryã€‚Repository æ¥å£ç¡®ä¿å…¶ä¸æœåŠ¡å¯¹è±¡çš„æ¾è€¦åˆ</center>

<p>å¦‚å›¾æ‰€ç¤ºï¼ŒæœåŠ¡å¯¹è±¡é€šè¿‡æ¥å£æ¥è®¿é—® Repositoryã€‚è¿™æ ·åšä¼šæœ‰å‡ ä¸ªå¥½å¤„ã€‚ç¬¬ä¸€ï¼Œå®ƒä½¿å¾—æœåŠ¡å¯¹è±¡æ˜“äºæµ‹è¯•ï¼Œå› ä¸ºå®ƒä»¬ä¸å†ä¸ç‰¹å®šçš„æ•°æ®è®¿é—®å®ç°ç»‘å®šåœ¨ä¸€èµ·ã€‚å®é™…ä¸Šï¼Œä½ å¯ä»¥ä¸ºè¿™äº›æ•°æ®è®¿é—®æ¥å£åˆ›å»º mock å®ç°ï¼Œè¿™æ ·æ— éœ€è¿æ¥æ•°æ®åº“å°±èƒ½æµ‹è¯•æœåŠ¡å¯¹è±¡ï¼Œè€Œä¸”ä¼šæ˜¾è‘—æå‡å•å…ƒæµ‹è¯•çš„æ•ˆç‡å¹¶æ’é™¤å› æ•°æ®ä¸ä¸€è‡´æ‰€é€ æˆçš„æµ‹è¯•å¤±è´¥ã€‚</p>
<p>æ­¤å¤–ï¼Œæ•°æ®è®¿é—®å±‚æ˜¯ä»¥æŒä¹…åŒ–æŠ€æœ¯æ— å…³çš„æ–¹å¼æ¥è¿›è¡Œè®¿é—®çš„ã€‚æŒä¹…åŒ–æ–¹å¼çš„é€‰æ‹©ç‹¬ç«‹äº Repositoryï¼ŒåŒæ—¶åªæœ‰æ•°æ®è®¿é—®ç›¸å…³çš„æ–¹æ³•æ‰é€šè¿‡æ¥å£è¿›è¡Œæš´éœ²ã€‚è¿™å¯ä»¥å®ç°çµæ´»çš„è®¾è®¡ï¼Œå¹¶ä¸”åˆ‡æ¢æŒä¹…åŒ–æ¡†æ¶å¯¹åº”ç”¨ç¨‹åºå…¶ä»–éƒ¨åˆ†æ‰€å¸¦æ¥çš„å½±å“æœ€å°ã€‚å¦‚æœå°†æ•°æ®è®¿é—®å±‚çš„å®ç°ç»†èŠ‚æ¸—é€åˆ°åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ä¸­ï¼Œé‚£ä¹ˆæ•´ä¸ªåº”ç”¨ç¨‹åºå°†ä¸æ•°æ®è®¿é—®å±‚è€¦åˆåœ¨ä¸€èµ·ï¼Œä»è€Œå¯¼è‡´åƒµåŒ–çš„è®¾è®¡ã€‚</p>
<p>æ¥å£ä¸ Springï¼šå¦‚æœåœ¨é˜…è¯»äº†ä¸Šé¢å‡ æ®µæ–‡å­—ä¹‹åï¼Œä½ èƒ½æ„Ÿå—åˆ°æˆ‘å€¾å‘äºå°†æŒä¹…å±‚éšè—åœ¨æ¥å£ä¹‹åï¼Œé‚£å¾ˆé«˜å…´æˆ‘çš„ç›®çš„è¾¾åˆ°äº†ã€‚æˆ‘ç›¸ä¿¡æ¥å£æ˜¯å®ç°æ¾è€¦åˆä»£ç çš„å…³é”®ï¼Œå¹¶ä¸”åº”å°†å…¶ç”¨äºåº”ç”¨ç¨‹åºçš„å„ä¸ªå±‚ï¼Œè€Œä¸ä»…ä»…æ˜¯æŒä¹…åŒ–å±‚ã€‚è¿˜è¦è¯´æ˜ä¸€ç‚¹ï¼Œå°½ç®¡ Spring é¼“åŠ±ä½¿ç”¨æ¥å£ï¼Œä½†è¿™å¹¶ä¸æ˜¯å¼ºåˆ¶çš„â€”â€”ä½ å¯ä»¥ä½¿ç”¨ Spring å°† bean ï¼ˆDAOæˆ–å…¶ä»–ç±»å‹ï¼‰ç›´æ¥è£…é…åˆ°å¦ä¸€ä¸ª bean çš„æŸä¸ªå±æ€§ä¸­ï¼Œè€Œä¸éœ€è¦ä¸€å®šé€šè¿‡æ¥å£æ³¨å…¥ã€‚</p>
<p>ä¸ºäº†å°†æ•°æ®è®¿é—®å±‚ä¸åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†éš”ç¦»å¼€æ¥ï¼ŒSpringé‡‡ç”¨çš„æ–¹å¼ä¹‹ä¸€å°±æ˜¯æä¾›ç»Ÿä¸€çš„å¼‚å¸¸ä½“ç³»ï¼Œè¿™ä¸ªå¼‚å¸¸ä½“ç³»ç”¨åœ¨äº†å®ƒæ”¯æŒçš„æ‰€æœ‰æŒä¹…åŒ–æ–¹æ¡ˆä¸­ã€‚</p>
<h4 id="äº†è§£-Spring-çš„æ•°æ®è®¿é—®å¼‚å¸¸ä½“ç³»"><a href="#äº†è§£-Spring-çš„æ•°æ®è®¿é—®å¼‚å¸¸ä½“ç³»" class="headerlink" title="äº†è§£ Spring çš„æ•°æ®è®¿é—®å¼‚å¸¸ä½“ç³»"></a>äº†è§£ Spring çš„æ•°æ®è®¿é—®å¼‚å¸¸ä½“ç³»</h4><p>è¿™é‡Œæœ‰ä¸€ä¸ªå…³äºè·³ä¼è¿åŠ¨å‘˜çš„ç»å…¸ç¬‘è¯ï¼Œè¿™ä¸ªè¿åŠ¨å‘˜è¢«é£å¹ç¦»æ­£å¸¸è·¯çº¿åé™è½åœ¨æ ‘ä¸Šå¹¶é«˜é«˜åœ°æŒ‚åœ¨é‚£é‡Œã€‚åæ¥ï¼Œæœ‰äººè·¯è¿‡ï¼Œè·³ä¼è¿åŠ¨å‘˜å°±é—®ä»–è‡ªå·±åœ¨ä»€ä¹ˆåœ°æ–¹ã€‚è¿‡è·¯äººå›ç­”è¯´ï¼šâ€œä½ åœ¨ç¦»åœ°å¤§çº¦ 20 å°ºçš„ç©ºä¸­ã€‚â€è·³ä¼è¿åŠ¨å‘˜è¯´ï¼šâ€œä½ ä¸€å®šæ˜¯ä¸ªè½¯ä»¶åˆ†æå¸ˆã€‚â€è¿‡è·¯äººå›åº”è¯´â€œä½ è¯´å¯¹äº†ã€‚ä½ æ˜¯æ€ä¹ˆçŸ¥é“çš„å‘¢ï¼Ÿâ€â€œå› ä¸ºä½ è·Ÿæˆ‘è¯´çš„è¯ç™¾åˆ†ç™¾æ­£ç¡®ï¼Œä½†ä¸æ¯«ç”¨å¤„éƒ½æ²¡æœ‰ã€‚â€</p>
<p>è¿™ä¸ªæ•…äº‹å·²ç»å¬è¿‡å¾ˆå¤šéäº†ï¼Œæ¯æ¬¡è¿‡è·¯äººçš„èŒä¸šæˆ–å›½ç±éƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ä½†æ˜¯è¿™ä¸ªæ•…äº‹ä½¿æˆ‘æƒ³èµ·äº† JDBC ä¸­çš„ SQLExceptionã€‚å¦‚æœä½ æ›¾ç»ç¼–å†™è¿‡ JDBC ä»£ç ï¼ˆä¸ä½¿ç”¨ Springï¼‰ï¼Œä½ è‚¯å®šä¼šæ„è¯†åˆ°å¦‚æœä¸å¼ºåˆ¶æ•è· SQLException çš„è¯ï¼Œå‡ ä¹æ— æ³•ä½¿ç”¨ JDBC åšä»»ä½•äº‹æƒ…ã€‚SQLException è¡¨ç¤ºåœ¨å°è¯•è®¿é—®æ•°æ®åº“çš„æ—¶å‡ºç°äº†é—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªå¼‚å¸¸å´æ²¡æœ‰å‘Šè¯‰ä½ å“ªé‡Œå‡ºé”™äº†ä»¥åŠå¦‚ä½•è¿›è¡Œå¤„ç†ã€‚</p>
<p>å¯èƒ½å¯¼è‡´æŠ›å‡º SQLException çš„å¸¸è§é—®é¢˜åŒ…æ‹¬ï¼š</p>
<ul>
<li><p>åº”ç”¨ç¨‹åºæ— æ³•è¿æ¥æ•°æ®åº“ï¼›</p>
</li>
<li><p>è¦æ‰§è¡Œçš„æŸ¥è¯¢å­˜åœ¨è¯­æ³•é”™è¯¯ï¼›</p>
</li>
<li><p>æŸ¥è¯¢ä¸­æ‰€ä½¿ç”¨çš„è¡¨å’Œ/æˆ–åˆ—ä¸å­˜åœ¨ï¼›</p>
</li>
<li><p>è¯•å›¾æ’å…¥æˆ–æ›´æ–°çš„æ•°æ®è¿åäº†æ•°æ®åº“çº¦æŸã€‚</p>
</li>
</ul>
<p>SQLException çš„é—®é¢˜åœ¨äºæ•è·åˆ°å®ƒçš„æ—¶å€™è¯¥å¦‚ä½•å¤„ç†ã€‚äº‹å®ä¸Šï¼Œèƒ½å¤Ÿè§¦å‘ SQLException çš„é—®é¢˜é€šå¸¸æ˜¯ä¸èƒ½åœ¨ catch ä»£ç å—ä¸­è§£å†³çš„ã€‚å¤§å¤šæ•°æŠ›å‡º SQLException çš„æƒ…å†µè¡¨æ˜å‘ç”Ÿäº†è‡´å‘½æ€§é”™è¯¯ã€‚å¦‚æœåº”ç”¨ç¨‹åºä¸èƒ½è¿æ¥åˆ°æ•°æ®åº“ï¼Œè¿™é€šå¸¸æ„å‘³ç€åº”ç”¨ä¸èƒ½ç»§ç»­ä½¿ç”¨äº†ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœæŸ¥è¯¢æ—¶å‡ºç°äº†é”™è¯¯ï¼Œé‚£åœ¨è¿è¡Œæ—¶åŸºæœ¬ä¸Šä¹Ÿæ˜¯æ— èƒ½ä¸ºåŠ›ã€‚</p>
<p>å¦‚æœæ— æ³•ä» SQLException ä¸­æ¢å¤ï¼Œé‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜è¦å¼ºåˆ¶æ•è·å®ƒå‘¢ï¼Ÿ</p>
<p>å³ä½¿å¯¹æŸäº› SQLException æœ‰å¤„ç†æ–¹æ¡ˆï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦æ•è· SQLException å¹¶æŸ¥çœ‹å…¶å±æ€§æ‰èƒ½è·çŸ¥é—®é¢˜æ ¹æºçš„æ›´å¤šä¿¡æ¯ã€‚è¿™æ˜¯å› ä¸º SQLException è¢«è§†ä¸ºå¤„ç†æ•°æ®è®¿é—®æ‰€æœ‰é—®é¢˜çš„é€šç”¨å¼‚å¸¸ã€‚å¯¹äºæ‰€æœ‰çš„æ•°æ®è®¿é—®é—®é¢˜éƒ½ä¼šæŠ›å‡º SQLExceptionï¼Œè€Œä¸æ˜¯å¯¹æ¯ç§å¯èƒ½çš„é—®é¢˜éƒ½ä¼šæœ‰ä¸åŒçš„å¼‚å¸¸ç±»å‹ã€‚</p>
<p>ä¸€äº›æŒä¹…åŒ–æ¡†æ¶æä¾›äº†ç›¸å¯¹ä¸°å¯Œçš„å¼‚å¸¸ä½“ç³»ã€‚ä¾‹å¦‚ï¼ŒHibernate æä¾›äº†äºŒåä¸ªå·¦å³çš„å¼‚å¸¸ï¼Œåˆ†åˆ«å¯¹åº”äºç‰¹å®šçš„æ•°æ®è®¿é—®é—®é¢˜ã€‚è¿™æ ·å°±å¯ä»¥é’ˆå¯¹æƒ³å¤„ç†çš„å¼‚å¸¸ç¼–å†™catch ä»£ç å—ã€‚</p>
<p>å³ä¾¿å¦‚æ­¤ï¼ŒHibernate çš„å¼‚å¸¸æ˜¯å…¶æœ¬èº«æ‰€ç‰¹æœ‰çš„ã€‚æ­£å¦‚å‰é¢æ‰€è¨€ï¼Œæˆ‘ä»¬æƒ³å°†ç‰¹å®šçš„æŒä¹…åŒ–æœºåˆ¶ç‹¬ç«‹äºæ•°æ®è®¿é—®å±‚ã€‚å¦‚æœæŠ›å‡ºäº† Hibernate æ‰€ç‰¹æœ‰çš„å¼‚å¸¸ï¼Œé‚£æˆ‘ä»¬å¯¹ Hibernate çš„ä½¿ç”¨å°†ä¼šæ¸—é€åˆ°åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ã€‚å¦‚æœä¸è¿™æ ·åšçš„è¯ï¼Œæˆ‘ä»¬å°±å¾—æ•è·æŒä¹…åŒ–å¹³å°çš„å¼‚å¸¸ï¼Œç„¶åå°†å…¶ä½œä¸ºå¹³å°æ— å…³çš„å¼‚å¸¸å†æ¬¡æŠ›å‡ºã€‚</p>
<p>ä¸€æ–¹é¢ï¼ŒJDBC çš„å¼‚å¸¸ä½“ç³»è¿‡äºç®€å•äº†â€”â€”å®é™…ä¸Šï¼Œå®ƒç®—ä¸ä¸Šä¸€ä¸ªä½“ç³»ã€‚å¦ä¸€æ–¹é¢ï¼ŒHibernate çš„å¼‚å¸¸ä½“ç³»æ˜¯å…¶æœ¬èº«æ‰€ç‹¬æœ‰çš„ã€‚æˆ‘ä»¬éœ€è¦çš„æ•°æ®è®¿é—®å¼‚å¸¸è¦å…·æœ‰æè¿°æ€§è€Œä¸”åˆä¸ç‰¹å®šçš„æŒä¹…åŒ–æ¡†æ¶æ— å…³ã€‚</p>
<p>Spring æ‰€æä¾›çš„å¹³å°æ— å…³çš„æŒä¹…åŒ–å¼‚å¸¸</p>
<p>Spring JDBC æä¾›çš„æ•°æ®è®¿é—®å¼‚å¸¸ä½“ç³»è§£å†³äº†ä»¥ä¸Šçš„ä¸¤ä¸ªé—®é¢˜ã€‚ä¸åŒäºJDBCï¼ŒSpringæä¾›äº†å¤šä¸ªæ•°æ®è®¿é—®å¼‚å¸¸ï¼Œåˆ†åˆ«æè¿°äº†å®ƒä»¬æŠ›å‡ºæ—¶æ‰€å¯¹åº”çš„é—®é¢˜ã€‚è¡¨ 10.1 å¯¹æ¯”äº† Spring çš„éƒ¨åˆ†æ•°æ®è®¿é—®å¼‚å¸¸ä»¥åŠ JDBC æ‰€æä¾›çš„å¼‚å¸¸ã€‚</p>
<p>ä»è¡¨ä¸­å¯ä»¥çœ‹å‡ºï¼ŒSpring ä¸ºè¯»å–å’Œå†™å…¥æ•°æ®åº“çš„å‡ ä¹æ‰€æœ‰é”™è¯¯éƒ½æä¾›äº†å¼‚å¸¸ã€‚Spring çš„æ•°æ®è®¿é—®å¼‚å¸¸è¦æ¯”è¡¨ 10.1 æ‰€åˆ—çš„è¿˜è¦å¤šã€‚ï¼ˆåœ¨æ­¤æ²¡æœ‰åˆ—å‡ºæ‰€æœ‰çš„å¼‚å¸¸ï¼Œå› ä¸ºæˆ‘ä¸æƒ³è®© JDBC æ˜¾å¾—å¤ªå¯’é…¸ã€‚ï¼‰</p>
<center>è¡¨10.1ã€€JDBCçš„å¼‚å¸¸ä½“ç³»ä¸Springçš„æ•°æ®è®¿é—®å¼‚å¸¸</center>

<table>
<thead>
<tr>
<th>JDBCçš„å¼‚å¸¸</th>
<th>Springçš„æ•°æ®è®¿é—®å¼‚å¸¸</th>
</tr>
</thead>
<tbody><tr>
<td>BatchUpdateException<br>DataTruncation<br>SQLException<br>SQLWarning</td>
<td>BadSqlGrammarException<br>CannotAcquireLockException<br>CannotSerializeTransactionException<br>CannotGetJdbcConnectionException<br>CleanupFailureDataAccessException<br>ConcurrencyFailureException<br>DataAccessException<br>DataAccessResourceFailureException<br>DataIntegrityViolationException<br>DataRetrievalFailureException<br>DataSourceLookupApiUsageException<br>DeadlockLoserDataAccessException<br>SQLWarning DuplicateKeyException<br>EmptyResultDataAccessException<br>IncorrectResultSizeDataAccessException<br>IncorrectUpdateSemanticsDataAccessException<br>InvalidDataAccessApiUsageException<br>InvalidDataAccessResourceUsageException<br>InvalidResultSetAccessException<br>JdbcUpdateAffectedIncorrectNumberOfRowsException<br>LbRetrievalFailureException</td>
</tr>
<tr>
<td>BatchUpdateException<br>DataTruncation<br>SQLException<br>SQLWarning</td>
<td>NonTransientDataAccessResourceException<br>OptimisticLockingFailureException<br>PermissionDeniedDataAccessException<br>PessimisticLockingFailureException<br>QueryTimeoutException<br>RecoverableDataAccessException<br>SQLWarningException<br>SqlXmlFeatureNotImplementedException<br>TransientDataAccessException<br>TransientDataAccessResourceException<br>TypeMismatchDataAccessException<br>UncategorizedDataAccessException<br>UncategorizedSQLException</td>
</tr>
</tbody></table>
<p>å°½ç®¡ Spring çš„å¼‚å¸¸ä½“ç³»æ¯” JDBC ç®€å•çš„ SQLException ä¸°å¯Œå¾—å¤šï¼Œä½†å®ƒå¹¶æ²¡æœ‰ä¸ç‰¹å®šçš„æŒä¹…åŒ–æ–¹å¼ç›¸å…³è”ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Spring æŠ›å‡ºä¸€è‡´çš„å¼‚å¸¸ï¼Œè€Œä¸ç”¨å…³å¿ƒæ‰€é€‰æ‹©çš„æŒä¹…åŒ–æ–¹æ¡ˆã€‚è¿™æœ‰åŠ©äºæˆ‘ä»¬å°†æ‰€é€‰æ‹©æŒä¹…åŒ–æœºåˆ¶ä¸æ•°æ®è®¿é—®å±‚éš”ç¦»å¼€æ¥ã€‚</p>
<p>çœ‹ï¼ä¸ç”¨å†™ catch ä»£ç å—</p>
<p>è¡¨ 10.1 ä¸­æ²¡æœ‰ä½“ç°å‡ºæ¥çš„ä¸€ç‚¹å°±æ˜¯è¿™äº›å¼‚å¸¸éƒ½ç»§æ‰¿è‡ª DataAccessExceptionã€‚DataAccessException çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºå®ƒæ˜¯ä¸€ä¸ªéæ£€æŸ¥å‹å¼‚å¸¸ã€‚æ¢å¥è¯è¯´ï¼Œæ²¡æœ‰å¿…è¦æ•è· Spring æ‰€æŠ›å‡ºçš„æ•°æ®è®¿é—®å¼‚å¸¸ï¼ˆå½“ç„¶ï¼Œå¦‚æœä½ æƒ³æ•è·çš„è¯ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ï¼‰ã€‚</p>
<p>DataAccessException åªæ˜¯ Sping å¤„ç†æ£€æŸ¥å‹å¼‚å¸¸å’Œéæ£€æŸ¥å‹å¼‚å¸¸å“²å­¦çš„ä¸€ä¸ªèŒƒä¾‹ã€‚Spring è®¤ä¸ºè§¦å‘å¼‚å¸¸çš„å¾ˆå¤šé—®é¢˜æ˜¯ä¸èƒ½åœ¨ catch ä»£ç å—ä¸­ä¿®å¤çš„ã€‚Spring ä½¿ç”¨äº†éæ£€æŸ¥å‹å¼‚å¸¸ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶å¼€å‘äººå‘˜ç¼–å†™ catch ä»£ç å—ï¼ˆé‡Œé¢ç»å¸¸æ˜¯ç©ºçš„ï¼‰ã€‚è¿™æŠŠæ˜¯å¦è¦æ•è·å¼‚å¸¸çš„æƒåŠ›ç•™ç»™äº†å¼€å‘äººå‘˜ã€‚</p>
<p>ä¸ºäº†åˆ©ç”¨ Spring çš„æ•°æ®è®¿é—®å¼‚å¸¸ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ Spring æ‰€æ”¯æŒçš„æ•°æ®è®¿é—®æ¨¡æ¿ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ Spring çš„æ¨¡æ¿æ˜¯å¦‚ä½•ç®€åŒ–æ•°æ®è®¿é—®çš„ã€‚</p>
<h4 id="æ•°æ®è®¿é—®æ¨¡æ¿åŒ–"><a href="#æ•°æ®è®¿é—®æ¨¡æ¿åŒ–" class="headerlink" title="æ•°æ®è®¿é—®æ¨¡æ¿åŒ–"></a>æ•°æ®è®¿é—®æ¨¡æ¿åŒ–</h4><p>å¦‚æœä»¥å‰æœ‰æ­ä¹˜é£æœºæ—…è¡Œçš„ç»å†ï¼Œä½ è‚¯å®šä¼šè§‰å¾—æ—…è¡Œä¸­å¾ˆé‡è¦çš„ä¸€ä»¶äº‹å°±æ˜¯å°†è¡Œæä»ä¸€ä¸ªåœ°æ–¹æ¬è¿åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚è¿™ä¸ªè¿‡ç¨‹åŒ…å«å¤šä¸ªæ­¥éª¤ã€‚å½“ä½ åˆ°è¾¾æœºåœºæ—¶ï¼Œç¬¬ä¸€ç«™æ˜¯åˆ°æŸœå°åŠç†è¡Œææ‰˜è¿ã€‚ç„¶åä¿å®‰äººå‘˜å¯¹å…¶è¿›è¡Œå®‰æ£€ä»¥ç¡®ä¿å®‰å…¨ã€‚ä¹‹åè¡Œæå°†é€šè¿‡è¡Œæè½¦è½¬é€åˆ°é£æœºä¸Šã€‚å¦‚æœä½ éœ€è¦ä¸­é€”è½¬æœºï¼Œè¡Œæä¹Ÿè¦è¿›è¡Œä¸­è½¬ã€‚å½“ä½ åˆ°è¾¾ç›®çš„åœ°çš„æ—¶å€™ï¼Œè¡Œæéœ€è¦ä»é£æœºä¸Šå–ä¸‹æ¥å¹¶æ”¾åˆ°ä¼ é€å¸¦ä¸Šã€‚æœ€åï¼Œä½ åˆ°è¡Œæè®¤é¢†åŒºå°†å…¶å–å›ã€‚</p>
<p>å°½ç®¡åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­åŒ…å«å¤šä¸ªæ­¥éª¤ï¼Œä½†æ˜¯æ¶‰åŠåˆ°æ—…å®¢çš„åªæœ‰å‡ ä¸ªã€‚æ‰¿è¿äººè´Ÿè´£æ¨åŠ¨æ•´ä¸ªæµç¨‹ã€‚ä½ åªä¼šåœ¨å¿…è¦çš„æ—¶å€™è¿›è¡Œå‚ä¸ï¼Œå…¶ä½™çš„è¿‡ç¨‹ä¸å¿…å…³å¿ƒã€‚è¿™åæ˜ äº†ä¸€ä¸ªå¼ºå¤§çš„è®¾è®¡æ¨¡å¼ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚</p>
<p>æ¨¡æ¿æ–¹æ³•å®šä¹‰è¿‡ç¨‹çš„ä¸»è¦æ¡†æ¶ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæ•´ä¸ªè¿‡ç¨‹æ˜¯å°†è¡Œæä»å‡ºå‘åœ°è¿é€åˆ°ç›®çš„åœ°ã€‚è¿‡ç¨‹æœ¬èº«æ˜¯å›ºå®šä¸å˜çš„ã€‚å¤„ç†è¡Œæè¿‡ç¨‹ä¸­çš„æ¯ä¸ªäº‹ä»¶éƒ½ä¼šä»¥åŒæ ·çš„æ–¹å¼è¿›è¡Œï¼šæ‰˜è¿æ£€æŸ¥ã€è¿é€åˆ°é£æœºä¸Šç­‰ç­‰ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­çš„æŸäº›æ­¥éª¤æ˜¯å›ºå®šçš„â€”â€”è¿™äº›æ­¥éª¤æ¯æ¬¡éƒ½æ˜¯ä¸€æ ·çš„ã€‚æ¯”å¦‚å½“é£æœºåˆ°è¾¾ç›®çš„åœ°åï¼Œæ‰€æœ‰çš„è¡Œæè¢«å–ä¸‹æ¥å¹¶é€šè¿‡ä¼ é€å¸¦è¿åˆ°å–è¡Œæå¤„ã€‚</p>
<p>åœ¨æŸäº›ç‰¹å®šçš„æ­¥éª¤ä¸Šï¼Œå¤„ç†è¿‡ç¨‹ä¼šå°†å…¶å·¥ä½œå§”æ´¾ç»™å­ç±»æ¥å®Œæˆä¸€äº›ç‰¹å®šå®ç°çš„ç»†èŠ‚ã€‚è¿™æ˜¯è¿‡ç¨‹ä¸­å˜åŒ–çš„éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œå¤„ç†è¡Œææ˜¯ä»ä¹˜å®¢åœ¨æŸœå°æ‰˜è¿è¡Œæå¼€å§‹çš„ã€‚è¿™éƒ¨åˆ†çš„å¤„ç†å¾€å¾€æ˜¯åœ¨æœ€å¼€å§‹çš„æ—¶å€™è¿›è¡Œï¼Œæ‰€ä»¥å®ƒåœ¨å¤„ç†è¿‡ç¨‹ä¸­çš„é¡ºåºæ˜¯å›ºå®šçš„ã€‚ç”±äºæ¯ä½ä¹˜å®¢çš„è¡Œæç™»è®°éƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹çš„å®ç°æ˜¯ç”±æ—…å®¢å†³å®šçš„ã€‚æŒ‰ç…§è½¯ä»¶æ–¹é¢çš„æœ¯è¯­æ¥è®²ï¼Œæ¨¡æ¿æ–¹æ³•å°†è¿‡ç¨‹ä¸­ä¸ç‰¹å®šå®ç°ç›¸å…³çš„éƒ¨åˆ†å§”æ‰˜ç»™æ¥å£ï¼Œè€Œè¿™ä¸ªæ¥å£çš„ä¸åŒå®ç°å®šä¹‰äº†è¿‡ç¨‹ä¸­çš„å…·ä½“è¡Œä¸ºã€‚</p>
<p>è¿™ä¹Ÿæ˜¯ Spring åœ¨æ•°æ®è®¿é—®ä¸­æ‰€ä½¿ç”¨çš„æ¨¡å¼ã€‚ä¸ç®¡æˆ‘ä»¬ä½¿ç”¨ä»€ä¹ˆæ ·çš„æŠ€æœ¯ï¼Œéƒ½éœ€è¦ä¸€äº›ç‰¹å®šçš„æ•°æ®è®¿é—®æ­¥éª¤ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬éƒ½éœ€è¦è·å–ä¸€ä¸ªåˆ°æ•°æ®å­˜å‚¨çš„è¿æ¥å¹¶åœ¨å¤„ç†å®Œæˆåé‡Šæ”¾èµ„æºã€‚è¿™éƒ½æ˜¯åœ¨æ•°æ®è®¿é—®å¤„ç†è¿‡ç¨‹ä¸­çš„å›ºå®šæ­¥éª¤ï¼Œä½†æ˜¯æ¯ç§æ•°æ®è®¿é—®æ–¹æ³•åˆä¼šæœ‰äº›ä¸åŒï¼Œæˆ‘ä»¬ä¼šæŸ¥è¯¢ä¸åŒçš„å¯¹è±¡æˆ–ä»¥ä¸åŒçš„æ–¹å¼æ›´æ–°æ•°æ®ï¼Œè¿™éƒ½æ˜¯æ•°æ®è®¿é—®è¿‡ç¨‹ä¸­å˜åŒ–çš„éƒ¨åˆ†ã€‚</p>
<p>Spring å°†æ•°æ®è®¿é—®è¿‡ç¨‹ä¸­å›ºå®šçš„å’Œå¯å˜çš„éƒ¨åˆ†æ˜ç¡®åˆ’åˆ†ä¸ºä¸¤ä¸ªä¸åŒçš„ç±»ï¼šæ¨¡æ¿ï¼ˆtemplateï¼‰å’Œå›è°ƒï¼ˆcallbackï¼‰ã€‚æ¨¡æ¿ç®¡ç†è¿‡ç¨‹ä¸­å›ºå®šçš„éƒ¨åˆ†ï¼Œè€Œå›è°ƒå¤„ç†è‡ªå®šä¹‰çš„æ•°æ®è®¿é—®ä»£ç ã€‚å›¾ 10.2 å±•ç°äº†è¿™ä¸¤ä¸ªç±»çš„èŒè´£ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211101214636479.png" alt="image-20211101214636479"></p>
<center>å›¾ 10.2ã€€Spring çš„æ•°æ®è®¿é—®æ¨¡æ¿ç±»è´Ÿè´£é€šç”¨çš„æ•°æ®è®¿é—®åŠŸèƒ½ã€‚å¯¹äºåº”ç”¨ç¨‹åºç‰¹å®šçš„ä»»åŠ¡ï¼Œåˆ™ä¼šè°ƒç”¨è‡ªå®šä¹‰çš„å›è°ƒå¯¹è±¡</center>

<p>å¦‚å›¾æ‰€ç¤ºï¼ŒSpring çš„æ¨¡æ¿ç±»å¤„ç†æ•°æ®è®¿é—®çš„å›ºå®šéƒ¨åˆ†â€”â€”äº‹åŠ¡æ§åˆ¶ã€ç®¡ç†èµ„æºä»¥åŠå¤„ç†å¼‚å¸¸ã€‚åŒæ—¶ï¼Œåº”ç”¨ç¨‹åºç›¸å…³çš„æ•°æ®è®¿é—®â€”â€”è¯­å¥ã€ç»‘å®šå‚æ•°ä»¥åŠæ•´ç†ç»“æœé›†â€”â€”åœ¨å›è°ƒçš„å®ç°ä¸­å¤„ç†ã€‚äº‹å®è¯æ˜ï¼Œè¿™æ˜¯ä¸€ä¸ªä¼˜é›…çš„æ¶æ„ï¼Œå› ä¸ºä½ åªéœ€å…³å¿ƒè‡ªå·±çš„æ•°æ®è®¿é—®é€»è¾‘å³å¯ã€‚</p>
<p>é’ˆå¯¹ä¸åŒçš„æŒä¹…åŒ–å¹³å°ï¼ŒSpring æä¾›äº†å¤šä¸ªå¯é€‰çš„æ¨¡æ¿ã€‚å¦‚æœç›´æ¥ä½¿ç”¨ JDBCï¼Œé‚£ä½ å¯ä»¥é€‰æ‹© JdbcTemplateã€‚å¦‚æœä½ å¸Œæœ›ä½¿ç”¨å¯¹è±¡å…³ç³»æ˜ å°„æ¡†æ¶ï¼Œé‚£HibernateTemplate æˆ– JpaTemplate å¯èƒ½ä¼šæ›´é€‚åˆä½ ã€‚è¡¨ 10.2 åˆ—å‡ºäº† Spring æ‰€æä¾›çš„æ‰€æœ‰æ•°æ®è®¿é—®æ¨¡æ¿åŠå…¶ç”¨é€”ã€‚</p>
<center>è¡¨ 10.2ã€€Spring æä¾›çš„æ•°æ®è®¿é—®æ¨¡æ¿ï¼Œåˆ†åˆ«é€‚ç”¨äºä¸åŒçš„æŒä¹…åŒ–æœºåˆ¶</center>

<table>
<thead>
<tr>
<th>æ¨¡æ¿ç±»ï¼ˆorg.springframework.*ï¼‰</th>
<th>ç”¨ã€€ã€€é€”</th>
</tr>
</thead>
<tbody><tr>
<td>jca.cci.core.CciTemplate</td>
<td>JCA CCI è¿æ¥</td>
</tr>
<tr>
<td>jdbc.core.JdbcTemplate</td>
<td>JDBCè¿æ¥</td>
</tr>
<tr>
<td>jdbc.core.namedparam.NamedParameterJdbcTemplate</td>
<td>æ”¯æŒå‘½åå‚æ•°çš„JDBCè¿æ¥</td>
</tr>
<tr>
<td>jdbc.core.simple.SimpleJdbcTemplate</td>
<td>é€šè¿‡Java 5ç®€åŒ–åçš„JDBCè¿æ¥ï¼ˆSpring 3.1ä¸­å·²ç»åºŸå¼ƒï¼‰</td>
</tr>
<tr>
<td>orm.hibernate3.HibernateTemplate</td>
<td>Hibernate 3.xä»¥ä¸Šçš„Session</td>
</tr>
<tr>
<td>orm.ibatis.SqlMapClientTemplate iBATIS</td>
<td>SqlMapå®¢æˆ·ç«¯</td>
</tr>
<tr>
<td>orm.jdo.JdoTemplate</td>
<td>Javaæ•°æ®å¯¹è±¡ï¼ˆJava DataObjectï¼‰å®ç°</td>
</tr>
<tr>
<td>orm.jpa.JpaTemplate</td>
<td>JavaæŒä¹…åŒ–APIçš„å®ä½“ç®¡ç†å™¨</td>
</tr>
</tbody></table>
<p>Spring ä¸ºå¤šç§æŒä¹…åŒ–æ¡†æ¶æä¾›äº†æ”¯æŒï¼Œè¿™é‡Œæ²¡æœ‰é‚£ä¹ˆå¤šçš„ç¯‡å¹…åœ¨æœ¬ç« å¯¹å…¶è¿›è¡Œä¸€ä¸€ä»‹ç»ã€‚å› æ­¤ï¼Œæˆ‘ä¼šå…³æ³¨äºæˆ‘è®¤ä¸ºæœ€ä¸ºå®ç”¨çš„æŒä¹…åŒ–æ–¹æ¡ˆï¼Œè¿™ä¹Ÿæ˜¯è¯»è€…æœ€å¯èƒ½ç”¨åˆ°çš„ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šä»åŸºç¡€çš„ JDBC è®¿é—®å¼€å§‹ï¼Œå› ä¸ºè¿™æ˜¯ä»æ•°æ®åº“ä¸­è¯»å–å’Œå†™å…¥æ•°æ®çš„æœ€åŸºæœ¬æ–¹å¼ã€‚åœ¨ç¬¬ 11 ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šäº†è§£ Hibernate å’Œ JPAï¼Œè¿™æ˜¯æœ€æµè¡Œçš„åŸºäº POJO çš„ ORM æ–¹æ¡ˆã€‚æˆ‘ä»¬ä¼šåœ¨ç¬¬ 12 ç« ç»“æŸ Spring æŒä¹…åŒ–çš„è¯é¢˜ï¼Œåœ¨è¿™ä¸€ç« ä¸­ï¼Œå°†ä¼šçœ‹åˆ° Spring Data é¡¹ç›®æ˜¯å¦‚ä½•è®© Spring æ”¯æŒæ— æ¨¡å¼æ•°æ®çš„ã€‚</p>
<p>ä½†é¦–å…ˆè¦è¯´æ˜çš„æ˜¯ Spring æ‰€æ”¯æŒçš„å¤§å¤šæ•°æŒä¹…åŒ–åŠŸèƒ½éƒ½ä¾èµ–äºæ•°æ®æºã€‚å› æ­¤ï¼Œåœ¨å£°æ˜æ¨¡æ¿å’Œ Repository ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Spring ä¸­é…ç½®ä¸€ä¸ªæ•°æ®æºç”¨æ¥è¿æ¥æ•°æ®åº“ã€‚</p>
<h3 id="é…ç½®æ•°æ®æº"><a href="#é…ç½®æ•°æ®æº" class="headerlink" title="é…ç½®æ•°æ®æº"></a>é…ç½®æ•°æ®æº</h3><p>æ— è®ºé€‰æ‹© Spring çš„å“ªç§æ•°æ®è®¿é—®æ–¹å¼ï¼Œä½ éƒ½éœ€è¦é…ç½®ä¸€ä¸ªæ•°æ®æºçš„å¼•ç”¨ã€‚Spring æä¾›äº†åœ¨ Spring ä¸Šä¸‹æ–‡ä¸­é…ç½®æ•°æ®æº bean çš„å¤šç§æ–¹å¼ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>é€šè¿‡ JDBC é©±åŠ¨ç¨‹åºå®šä¹‰çš„æ•°æ®æºï¼›</li>
<li>é€šè¿‡ JNDI æŸ¥æ‰¾çš„æ•°æ®æºï¼›</li>
<li>è¿æ¥æ± çš„æ•°æ®æºã€‚</li>
</ul>
<p>å¯¹äºå³å°†å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒä¸­çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘å»ºè®®ä½¿ç”¨ä»è¿æ¥æ± è·å–è¿æ¥çš„æ•°æ®æºã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œæˆ‘å€¾å‘äºé€šè¿‡åº”ç”¨æœåŠ¡å™¨çš„JNDIæ¥è·å–æ•°æ®æºã€‚è¯·è®°ä½è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹å¦‚ä½•é…ç½® Spring ä» JNDI ä¸­è·å–æ•°æ®æºã€‚</p>
<h4 id="ä½¿ç”¨-JNDI-æ•°æ®æº"><a href="#ä½¿ç”¨-JNDI-æ•°æ®æº" class="headerlink" title="ä½¿ç”¨ JNDI æ•°æ®æº"></a>ä½¿ç”¨ JNDI æ•°æ®æº</h4><p>Spring åº”ç”¨ç¨‹åºç»å¸¸éƒ¨ç½²åœ¨ Java EE åº”ç”¨æœåŠ¡å™¨ä¸­ï¼Œå¦‚ WebSphereã€JBoss æˆ–ç”šè‡³åƒ Tomcat è¿™æ ·çš„Webå®¹å™¨ä¸­ã€‚è¿™äº›æœåŠ¡å™¨å…è®¸ä½ é…ç½®é€šè¿‡ JNDI è·å–æ•°æ®æºã€‚è¿™ç§é…ç½®çš„å¥½å¤„åœ¨äºæ•°æ®æºå®Œå…¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¹‹å¤–è¿›è¡Œç®¡ç†ï¼Œè¿™æ ·åº”ç”¨ç¨‹åºåªéœ€åœ¨è®¿é—®æ•°æ®åº“çš„æ—¶å€™æŸ¥æ‰¾æ•°æ®æºå°±å¯ä»¥äº†ã€‚å¦å¤–ï¼Œåœ¨åº”ç”¨æœåŠ¡å™¨ä¸­ç®¡ç†çš„æ•°æ®æºé€šå¸¸ä»¥æ± çš„æ–¹å¼ç»„ç»‡ï¼Œä»è€Œå…·å¤‡æ›´å¥½çš„æ€§èƒ½ï¼Œå¹¶ä¸”è¿˜æ”¯æŒç³»ç»Ÿç®¡ç†å‘˜å¯¹å…¶è¿›è¡Œçƒ­åˆ‡æ¢ã€‚</p>
<p>åˆ©ç”¨ Springï¼Œæˆ‘ä»¬å¯ä»¥åƒä½¿ç”¨ Spring bean é‚£æ ·é…ç½® JNDI ä¸­æ•°æ®æºçš„å¼•ç”¨å¹¶å°†å…¶è£…é…åˆ°éœ€è¦çš„ç±»ä¸­ã€‚ä½äº jee å‘½åç©ºé—´ä¸‹çš„<code>&lt;jee:jndilookup&gt;</code>å…ƒç´ å¯ä»¥ç”¨äºæ£€ç´¢ JNDI ä¸­çš„ä»»ä½•å¯¹è±¡ï¼ˆåŒ…æ‹¬æ•°æ®æºï¼‰å¹¶å°†å…¶ä½œä¸º Spring çš„ beanã€‚ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨ç¨‹åºçš„æ•°æ®æºé…ç½®åœ¨ JNDI ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>&lt;jee:jndi-lookup&gt;</code>å…ƒç´ å°†å…¶è£…é…åˆ° Spring ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jee:jndi-lookup</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">jndi-name</span>=<span class="string">&quot;/jdbc/SpitterDS&quot;</span> <span class="attr">resource-ref</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ jndi-name å±æ€§ç”¨äºæŒ‡å®š JNDI ä¸­èµ„æºçš„åç§°ã€‚å¦‚æœåªè®¾ç½®äº† jndi-name å±æ€§ï¼Œé‚£ä¹ˆå°±ä¼šæ ¹æ®æŒ‡å®šçš„åç§°æŸ¥æ‰¾æ•°æ®æºã€‚ä½†æ˜¯ï¼Œå¦‚æœåº”ç”¨ç¨‹åºè¿è¡Œåœ¨ Java åº”ç”¨æœåŠ¡å™¨ä¸­ï¼Œä½ éœ€è¦å°† resource-ref å±æ€§è®¾ç½®ä¸º trueï¼Œè¿™æ ·ç»™å®šçš„ jndi-name å°†ä¼šè‡ªåŠ¨æ·»åŠ  â€œjava:comp/env/â€ å‰ç¼€ã€‚</p>
<p>å¦‚æœæƒ³ä½¿ç”¨ Java é…ç½®çš„è¯ï¼Œé‚£æˆ‘ä»¬å¯ä»¥å€ŸåŠ© JndiObjectFactoryBean ä» JNDI ä¸­æŸ¥æ‰¾ DataSourceï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">JndiObjectFactoryBean <span class="title">dataSource</span><span class="params">()</span> </span>&#123;    JndiObjectFactoryBean jndiObjectFB = <span class="keyword">new</span> JndiObjectFactoryBean();    jndiObjectFB.setJndiName(<span class="string">&quot;jdbc/SpitterDS&quot;</span>);    jndiObjectFB.setResourceRef(<span class="keyword">true</span>);    jndiObjectFB.setProxyInterface(javax.sql.DataSource.class);    <span class="keyword">return</span> jndiObjectFB;&#125;</span><br></pre></td></tr></table></figure>

<p>æ˜¾ç„¶ï¼Œé€šè¿‡ Java é…ç½®è·å– JNDI bean è¦æ›´ä¸ºå¤æ‚ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒJava é…ç½®è¦æ¯” XML é…ç½®ç®€å•ï¼Œä½†æ˜¯è¿™ä¸€æ¬¡æˆ‘ä»¬éœ€è¦å†™æ›´å¤šçš„ Java ä»£ç ã€‚ä½†æ˜¯ï¼Œå¾ˆå®¹æ˜“å°±èƒ½å¤Ÿçœ‹å‡º Java ä»£ç ä¸­ä¸ XML ç›¸å¯¹åº”çš„é…ç½®ï¼ŒJava é…ç½®çš„å†…å®¹å…¶å®ä¹Ÿä¸ç®—å¤šã€‚</p>
<h4 id="ä½¿ç”¨æ•°æ®æºè¿æ¥æ± "><a href="#ä½¿ç”¨æ•°æ®æºè¿æ¥æ± " class="headerlink" title="ä½¿ç”¨æ•°æ®æºè¿æ¥æ± "></a>ä½¿ç”¨æ•°æ®æºè¿æ¥æ± </h4><p>å¦‚æœä½ ä¸èƒ½ä» JNDI ä¸­æŸ¥æ‰¾æ•°æ®æºï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªé€‰æ‹©å°±æ˜¯ç›´æ¥åœ¨ Spring ä¸­é…ç½®æ•°æ®æºè¿æ¥æ± ã€‚å°½ç®¡ Spring å¹¶æ²¡æœ‰æä¾›æ•°æ®æºè¿æ¥æ± å®ç°ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰å¤šé¡¹å¯ç”¨çš„æ–¹æ¡ˆï¼ŒåŒ…æ‹¬å¦‚ä¸‹å¼€æºçš„å®ç°ï¼š</p>
<ul>
<li><p>Apache Commons DBCP (<a target="_blank" rel="noopener" href="http://jakarta.apache.org/commons/dbcp)%EF%BC%9B">http://jakarta.apache.org/commons/dbcp)ï¼›</a></p>
</li>
<li><p>c3p0 (<a target="_blank" rel="noopener" href="http://sourceforge.net/projects/c3p0/">http://sourceforge.net/projects/c3p0/</a>) ï¼›</p>
</li>
<li><p>BoneCP (<a target="_blank" rel="noopener" href="http://jolbox.com/">http://jolbox.com/</a>) ã€‚</p>
</li>
</ul>
<p>è¿™äº›è¿æ¥æ± ä¸­çš„å¤§å¤šæ•°éƒ½èƒ½é…ç½®ä¸º Spring çš„æ•°æ®æºï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¸ Spring è‡ªå¸¦çš„ DriverManagerDataSource æˆ– SingleConnectionDataSource å¾ˆç±»ä¼¼ï¼ˆæˆ‘ä»¬ç¨åä¼šå¯¹å…¶è¿›è¡Œä»‹ç»ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹å°±æ˜¯é…ç½® DBCP BasicDataSource çš„æ–¹å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>      <span class="attr">p:driverClassName</span>=<span class="string">&quot;org.h2.Driver&quot;</span>      <span class="attr">p:url</span>=<span class="string">&quot;jdbc:h2:tcp://localhost/~/spitter&quot;</span>      <span class="attr">p:username</span>=<span class="string">&quot;sa&quot;</span>      <span class="attr">p:password</span>=<span class="string">&quot;&quot;</span>      <span class="attr">p:initialSize</span>=<span class="string">&quot;5&quot;</span>      <span class="attr">p:maxActive</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ å–œæ¬¢ Java é…ç½®çš„è¯ï¼Œè¿æ¥æ± å½¢å¼çš„ DataSource bean å¯ä»¥å£°æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">BasicDataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;    BasicDataSource ds = <span class="keyword">new</span> BasicDataSource();    ds.setDriveClassName(<span class="string">&quot;org.h2.Driver&quot;</span>);    ds.setUrl(<span class="string">&quot;jdbc:h2:tcp://localhost/~/spitter&quot;</span>);    ds.setUsername(<span class="string">&quot;sa&quot;</span>):    ds.setPassword(<span class="string">&quot;&quot;</span>);    ds.setInitialSize(<span class="number">5</span>);    ds.setMaxActive(<span class="number">10</span>);    <span class="keyword">return</span> ds;&#125;</span><br></pre></td></tr></table></figure>

<p>å‰å››ä¸ªå±æ€§æ˜¯é…ç½® BasicDataSource æ‰€å¿…éœ€çš„ã€‚å±æ€§ driverClassName æŒ‡å®šäº† JDBC é©±åŠ¨ç±»çš„å…¨é™å®šç±»åã€‚åœ¨è¿™é‡Œæˆ‘ä»¬é…ç½®çš„æ˜¯ H2 æ•°æ®åº“çš„æ•°æ®æºã€‚å±æ€§ url ç”¨äºè®¾ç½®æ•°æ®åº“çš„ JDBC URLã€‚æœ€åï¼Œusername å’Œ password ç”¨äºåœ¨è¿æ¥æ•°æ®åº“æ—¶è¿›è¡Œè®¤è¯ã€‚</p>
<p>ä»¥ä¸Šå››ä¸ªåŸºæœ¬å±æ€§å®šä¹‰äº† BasicDataSource çš„è¿æ¥ä¿¡æ¯ã€‚é™¤æ­¤ä»¥å¤–ï¼Œè¿˜æœ‰å¤šä¸ªé…ç½®æ•°æ®æºè¿æ¥æ± çš„å±æ€§ã€‚è¡¨ 10.3 åˆ—å‡ºäº† DBCP BasicDataSource æœ€æœ‰ç”¨çš„ä¸€äº›æ± é…ç½®å±æ€§ï¼š</p>
<center>è¡¨10.3ã€€BasicDataSource çš„æ± é…ç½®å±æ€§</center>

<table>
<thead>
<tr>
<th>æ± é…ç½®å±æ€§</th>
<th>æ‰€æŒ‡å®šçš„å†…å®¹</th>
</tr>
</thead>
<tbody><tr>
<td>initialSize</td>
<td>æ± å¯åŠ¨æ—¶åˆ›å»ºçš„è¿æ¥æ•°é‡</td>
</tr>
<tr>
<td>maxActive</td>
<td>åŒä¸€æ—¶é—´å¯ä»æ± ä¸­åˆ†é…çš„æœ€å¤šè¿æ¥æ•°ã€‚å¦‚æœè®¾ç½®ä¸º 0ï¼Œè¡¨ç¤ºæ— é™åˆ¶</td>
</tr>
<tr>
<td>maxIdle</td>
<td>æ± é‡Œä¸ä¼šè¢«é‡Šæ”¾çš„æœ€å¤šç©ºé—²è¿æ¥æ•°ã€‚å¦‚æœè®¾ç½®ä¸º 0ï¼Œè¡¨ç¤ºæ— é™åˆ¶</td>
</tr>
<tr>
<td>maxOpenPreparedStatements</td>
<td>åœ¨åŒä¸€æ—¶é—´èƒ½å¤Ÿä»è¯­å¥æ± ä¸­åˆ†é…çš„é¢„å¤„ç†è¯­å¥ï¼ˆprepared statementï¼‰çš„æœ€å¤§æ•°é‡ã€‚å¦‚æœè®¾ç½®ä¸º 0ï¼Œè¡¨ç¤ºæ— é™åˆ¶</td>
</tr>
<tr>
<td>maxWait</td>
<td>åœ¨æŠ›å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œæ± ç­‰å¾…è¿æ¥å›æ”¶çš„æœ€å¤§æ—¶é—´ï¼ˆå½“æ²¡æœ‰å¯ç”¨è¿æ¥æ—¶ï¼‰ã€‚å¦‚æœè®¾ç½®ä¸º -1ï¼Œè¡¨ç¤ºæ— é™ç­‰å¾…</td>
</tr>
<tr>
<td>minEvictableIdleTimeMillis</td>
<td>è¿æ¥åœ¨æ± ä¸­ä¿æŒç©ºé—²è€Œä¸è¢«å›æ”¶çš„æœ€å¤§æ—¶é—´</td>
</tr>
<tr>
<td>minIdle</td>
<td>åœ¨ä¸åˆ›å»ºæ–°è¿æ¥çš„æƒ…å†µä¸‹ï¼Œæ± ä¸­ä¿æŒç©ºé—²çš„æœ€å°è¿æ¥æ•°</td>
</tr>
<tr>
<td>poolPreparedStatements</td>
<td>æ˜¯å¦å¯¹é¢„å¤„ç†è¯­å¥ï¼ˆprepared statementï¼‰è¿›è¡Œæ± ç®¡ç†ï¼ˆå¸ƒå°”å€¼ï¼‰</td>
</tr>
</tbody></table>
<p>åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œè¿æ¥æ± å¯åŠ¨æ—¶ä¼šåˆ›å»º 5 ä¸ªè¿æ¥ï¼›å½“éœ€è¦çš„æ—¶å€™ï¼Œå…è®¸ BasicDataSource åˆ›å»ºæ–°çš„è¿æ¥ï¼Œä½†æœ€å¤§æ´»è·ƒè¿æ¥æ•°ä¸º 10ã€‚</p>
<h4 id="åŸºäº-JDBC-é©±åŠ¨çš„æ•°æ®æº"><a href="#åŸºäº-JDBC-é©±åŠ¨çš„æ•°æ®æº" class="headerlink" title="åŸºäº JDBC é©±åŠ¨çš„æ•°æ®æº"></a>åŸºäº JDBC é©±åŠ¨çš„æ•°æ®æº</h4><p>åœ¨ Spring ä¸­ï¼Œé€šè¿‡ JDBC é©±åŠ¨å®šä¹‰æ•°æ®æºæ˜¯æœ€ç®€å•çš„é…ç½®æ–¹å¼ã€‚Spring æä¾›äº†ä¸‰ä¸ªè¿™æ ·çš„æ•°æ®æºç±»ï¼ˆå‡ä½äº org.springframework.jdbc.datasource åŒ…ä¸­ï¼‰ä¾›é€‰æ‹©ï¼š</p>
<ul>
<li>DriverManagerDataSourceï¼šåœ¨æ¯ä¸ªè¿æ¥è¯·æ±‚æ—¶éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°å»ºçš„è¿æ¥ã€‚ä¸ DBCP çš„ BasicDataSource ä¸åŒï¼Œç”± DriverManagerDataSource æä¾›çš„è¿æ¥å¹¶æ²¡æœ‰è¿›è¡Œæ± åŒ–ç®¡ç†ï¼›</li>
<li>SimpleDriverDataSourceï¼šä¸ DriverManagerDataSource çš„å·¥ä½œæ–¹å¼ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒç›´æ¥ä½¿ç”¨ JDBC é©±åŠ¨ï¼Œæ¥è§£å†³åœ¨ç‰¹å®šç¯å¢ƒä¸‹çš„ç±»åŠ è½½é—®é¢˜ï¼Œè¿™æ ·çš„ç¯å¢ƒåŒ…æ‹¬ OSGi å®¹å™¨ï¼›</li>
<li>SingleConnectionDataSourceï¼šåœ¨æ¯ä¸ªè¿æ¥è¯·æ±‚æ—¶éƒ½ä¼šè¿”å›åŒä¸€ä¸ªçš„è¿æ¥ã€‚å°½ç®¡ SingleConnectionDataSource ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„è¿æ¥æ± æ•°æ®æºï¼Œä½†æ˜¯ä½ å¯ä»¥å°†å…¶è§†ä¸ºåªæœ‰ä¸€ä¸ªè¿æ¥çš„æ± ã€‚</li>
</ul>
<p>ä»¥ä¸Šè¿™äº›æ•°æ®æºçš„é…ç½®ä¸ DBCPBasicDataSource çš„é…ç½®ç±»ä¼¼ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹å°±æ˜¯é…ç½® DriverManagerDataSource çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;	DBCPBasicDataSource ds = <span class="keyword">new</span> DBCPBasicDataSource();    ds.setDriveClassName(<span class="string">&quot;org.h2.Driver&quot;</span>);    ds.setUrl(<span class="string">&quot;jdbc:h2:tcp://localhost/~/spitter&quot;</span>);    ds.setUsername(<span class="string">&quot;sa&quot;</span>):    ds.setPassword(<span class="string">&quot;&quot;</span>);    <span class="keyword">return</span> ds;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½¿ç”¨ XML çš„è¯ï¼ŒDriverManagerDataSource å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.DriverManagerDataSource&quot;</span>      <span class="attr">p:driverClassName</span>=<span class="string">&quot;org.h2.Driver&quot;</span>      <span class="attr">p:url</span>=<span class="string">&quot;jdbc:h2:tcp://localhost/~/spitter&quot;</span>      <span class="attr">p:username</span>=<span class="string">&quot;sa&quot;</span>      <span class="attr">p:password</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸å…·å¤‡æ± åŠŸèƒ½çš„æ•°æ®æºç›¸æ¯”ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºè¿™äº›æ•°æ®æº bean éƒ½æ²¡æœ‰æä¾›è¿æ¥æ± åŠŸèƒ½ï¼Œæ‰€ä»¥æ²¡æœ‰å¯é…ç½®çš„æ± ç›¸å…³çš„å±æ€§ã€‚</p>
<p>å°½ç®¡è¿™äº›æ•°æ®æºå¯¹äºå°åº”ç”¨æˆ–å¼€å‘ç¯å¢ƒæ¥è¯´æ˜¯ä¸é”™çš„ï¼Œä½†æ˜¯è¦å°†å…¶ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œä½ è¿˜æ˜¯éœ€è¦æ…é‡è€ƒè™‘ã€‚å› ä¸º SingleConnectionDataSource æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œæ‰€ä»¥ä¸é€‚åˆç”¨äºå¤šçº¿ç¨‹çš„åº”ç”¨ç¨‹åºï¼Œæœ€å¥½åªåœ¨æµ‹è¯•çš„æ—¶å€™ä½¿ç”¨ã€‚</p>
<p>è€Œ DriverManagerDataSource å’Œ SimpleDriverDataSource å°½ç®¡æ”¯æŒå¤šçº¿ç¨‹ï¼Œä½†æ˜¯åœ¨æ¯æ¬¡è¯·æ±‚è¿æ¥çš„æ—¶å€™éƒ½ä¼šåˆ›å»ºæ–°è¿æ¥ï¼Œè¿™æ˜¯ä»¥æ€§èƒ½ä¸ºä»£ä»·çš„ã€‚é‰´äºä»¥ä¸Šçš„è¿™äº›é™åˆ¶ï¼Œæˆ‘å¼ºçƒˆå»ºè®®åº”è¯¥ä½¿ç”¨æ•°æ®æºè¿æ¥æ± ã€‚</p>
<h4 id="ä½¿ç”¨åµŒå…¥å¼çš„æ•°æ®æº"><a href="#ä½¿ç”¨åµŒå…¥å¼çš„æ•°æ®æº" class="headerlink" title="ä½¿ç”¨åµŒå…¥å¼çš„æ•°æ®æº"></a>ä½¿ç”¨åµŒå…¥å¼çš„æ•°æ®æº</h4><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæ•°æ®æºæ˜¯æˆ‘æƒ³å¯¹è¯»è€…ä»‹ç»çš„ï¼šåµŒå…¥å¼æ•°æ®åº“ï¼ˆembedded databaseï¼‰ã€‚åµŒå…¥å¼æ•°æ®åº“ä½œä¸ºåº”ç”¨çš„ä¸€éƒ¨åˆ†è¿è¡Œï¼Œè€Œä¸æ˜¯åº”ç”¨è¿æ¥çš„ç‹¬ç«‹æ•°æ®åº“æœåŠ¡å™¨ã€‚å°½ç®¡åœ¨ç”Ÿäº§ç¯å¢ƒçš„è®¾ç½®ä¸­ï¼Œå®ƒå¹¶æ²¡æœ‰å¤ªå¤§çš„ç”¨å¤„ï¼Œä½†æ˜¯å¯¹äºå¼€å‘å’Œæµ‹è¯•æ¥è®²ï¼ŒåµŒå…¥å¼æ•°æ®åº“éƒ½æ˜¯å¾ˆå¥½çš„å¯é€‰æ–¹æ¡ˆã€‚è¿™æ˜¯å› ä¸ºæ¯æ¬¡é‡å¯åº”ç”¨æˆ–è¿è¡Œæµ‹è¯•çš„æ—¶å€™ï¼Œéƒ½èƒ½å¤Ÿé‡æ–°å¡«å……æµ‹è¯•æ•°æ®ã€‚</p>
<p>Spring çš„ jdbc å‘½åç©ºé—´èƒ½å¤Ÿç®€åŒ–åµŒå…¥å¼æ•°æ®åº“çš„é…ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¦‚ä½•ä½¿ç”¨ jdbc å‘½åç©ºé—´æ¥é…ç½®åµŒå…¥å¼çš„ H2 æ•°æ®åº“ï¼Œå®ƒä¼šé¢„å…ˆåŠ è½½ä¸€ç»„æµ‹è¯•æ•°æ®ã€‚</p>
<center>ç¨‹åºæ¸…å• 10.1ã€€ä½¿ç”¨ jdbc å‘½åç©ºé—´é…ç½®åµŒå…¥å¼æ•°æ®åº“</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>	<span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span>	<span class="attr">xmlns:jdbc</span>=<span class="string">&quot;http://www.springframework.org/schema/jdbc&quot;</span>	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/jdbc                         http://www.springframework.org/schema/jdbc/spring-jdbc-3.1.xsd                        http://www.springframework.org/schema/beans                         http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">jdbc:embedded-database</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">type</span>=<span class="string">&quot;H2&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;classpath:spittr/db/jdbc/schema.sql&quot;</span> /&gt;</span>    <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;classpath:spittr/db/jdbc/test-data.sql&quot;</span> /&gt;</span>  <span class="tag">&lt;/<span class="name">jdbc:embedded-database</span>&gt;</span> <span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å°† <code>&lt;jdbc:embedded-database&gt;</code> çš„ type å±æ€§è®¾ç½®ä¸º H2ï¼Œè¡¨æ˜åµŒå…¥å¼æ•°æ®åº“åº”è¯¥æ˜¯ H2 æ•°æ®åº“ï¼ˆè¦ç¡®ä¿ H2 ä½äºåº”ç”¨çš„ç±»è·¯å¾„ä¸‹ï¼‰ã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°† type è®¾ç½®ä¸º DERBYï¼Œä»¥ä½¿ç”¨åµŒå…¥å¼çš„ Apache Derby æ•°æ®åº“ã€‚</p>
<p>åœ¨ <code>&lt;jdbc:embedded-database&gt;</code> ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä¸é…ç½®ä¹Ÿå¯ä»¥é…ç½®å¤šä¸ª <code>&lt;jdbc:script&gt;</code> å…ƒç´ æ¥æ­å»ºæ•°æ®åº“ã€‚ç¨‹åºæ¸…å• 10.1 ä¸­åŒ…å«äº†ä¸¤ä¸ª <code>&lt;jdbc:script&gt;</code> å…ƒç´ ï¼šç¬¬ä¸€ä¸ªå¼•ç”¨äº† schema.sqlï¼Œå®ƒåŒ…å«äº†åœ¨æ•°æ®åº“ä¸­åˆ›å»ºè¡¨çš„ SQLï¼›ç¬¬äºŒä¸ªå¼•ç”¨äº† test-data.sqlï¼Œç”¨æ¥å°†æµ‹è¯•æ•°æ®å¡«å……åˆ°æ•°æ®åº“ä¸­ã€‚</p>
<p>é™¤äº†æ­å»ºåµŒå…¥å¼æ•°æ®åº“ä»¥å¤–ï¼Œ<code>&lt;jdbc:embedded-database&gt;</code> å…ƒç´ è¿˜ä¼šæš´éœ²ä¸€ä¸ªæ•°æ®æºï¼Œæˆ‘ä»¬å¯ä»¥åƒä½¿ç”¨å…¶ä»–çš„æ•°æ®æºé‚£æ ·æ¥ä½¿ç”¨å®ƒã€‚åœ¨è¿™é‡Œï¼Œid å±æ€§è¢«è®¾ç½®æˆäº†dataSourceï¼Œè¿™ä¹Ÿæ˜¯æ‰€æš´éœ²æ•°æ®æºçš„ bean IDã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬éœ€è¦ javax.sql.DataSource çš„æ—¶å€™ï¼Œå°±å¯ä»¥æ³¨å…¥ dataSource beanã€‚</p>
<p>å¦‚æœä½¿ç”¨ Java æ¥é…ç½®åµŒå…¥å¼æ•°æ®åº“æ—¶ï¼Œä¸ä¼šåƒ jdbc å‘½åç©ºé—´é‚£ä¹ˆç®€ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ EmbeddedDatabaseBuilder æ¥æ„å»º DataSourceï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedDatabaseBuilder()        .setType(embeddedDatabaseType.H2)        .addScript(<span class="string">&quot;classpath:schema.sql&quot;</span>)        .addScript(<span class="string">&quot;classpath:test-data.sql&quot;</span>)        .builder();&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒsetType() æ–¹æ³•ç­‰åŒäº <code>&lt;jdbc:embedded-database&gt;</code> å…ƒç´ ä¸­çš„ type å±æ€§ï¼Œæ­¤å¤–ï¼Œæˆ‘ä»¬è¿™é‡Œç”¨ addScript() ä»£æ›¿ <a href="jdbc:script">jdbc:script</a> å…ƒç´ æ¥æŒ‡å®šåˆå§‹åŒ– SQLã€‚</p>
<h4 id="ä½¿ç”¨-profile-é€‰æ‹©æ•°æ®æº"><a href="#ä½¿ç”¨-profile-é€‰æ‹©æ•°æ®æº" class="headerlink" title="ä½¿ç”¨ profile é€‰æ‹©æ•°æ®æº"></a>ä½¿ç”¨ profile é€‰æ‹©æ•°æ®æº</h4><p>æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¤šç§åœ¨ Spring ä¸­é…ç½®æ•°æ®æºçš„æ–¹æ³•ï¼Œæˆ‘ç›¸ä¿¡ä½ å·²ç»æ‰¾åˆ°äº†ä¸€ä¸¤ç§é€‚åˆä½ çš„åº”ç”¨ç¨‹åºçš„é…ç½®æ–¹å¼ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½é¢ä¸´è¿™æ ·ä¸€ç§éœ€æ±‚ï¼Œé‚£å°±æ˜¯åœ¨æŸç§ç¯å¢ƒä¸‹éœ€è¦å…¶ä¸­ä¸€ç§æ•°æ®æºï¼Œè€Œåœ¨å¦å¤–çš„ç¯å¢ƒä¸­éœ€è¦ä¸åŒçš„æ•°æ®æºã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯¹äºå¼€å‘æœŸæ¥è¯´ï¼Œ<code>&lt;jdbc:embedded-database&gt;</code> å…ƒç´ æ˜¯å¾ˆåˆé€‚çš„ï¼Œè€Œåœ¨ QA ç¯å¢ƒä¸­ï¼Œä½ å¯èƒ½å¸Œæœ›ä½¿ç”¨ DBCP çš„ BasicDataSourceï¼Œåœ¨ç”Ÿäº§éƒ¨ç½²ç¯å¢ƒä¸‹ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ <code>&lt;jee:jndi-lookup&gt;</code>ã€‚</p>
<p>æˆ‘ä»¬åœ¨ç¬¬ 3 ç« æ‰€è®¨è®ºçš„ Spring çš„ bean profile ç‰¹æ€§æ°å¥½ç”¨åœ¨è¿™é‡Œï¼Œæ‰€éœ€è¦åšçš„å°±æ˜¯å°†æ¯ä¸ªæ•°æ®æºé…ç½®åœ¨ä¸åŒçš„ profile ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<center>ç¨‹åºæ¸…å• 10.2ã€€å€ŸåŠ© Spring çš„ profile ç‰¹æ€§èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶é€‰æ‹©æ•°æ®æº</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spitter.config;<span class="keyword">import</span> org.apache.commons.dbcp.BasicDataSOurce;<span class="keyword">import</span> javax.sql.DataSource;<span class="keyword">import</span> org.springframework.context.annotation.Bean;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.context.annotation.Profile;<span class="keyword">import</span> org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseBuilder;<span class="keyword">import</span> org.springframework.jdbc.jndi.JnidObjectFactoryBean;<span class="meta">@Configurationpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfiguration</span> </span>&#123;    <span class="meta">@Profile(&quot;development&quot;)</span>    <span class="meta">@Bean</span>    <span class="function"><span class="keyword">public</span> DataSource <span class="title">embeddedDataSource</span><span class="params">()</span> </span>&#123;        <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedDatabaseBuilder()            .setType(EmbeddedDatabaseType.H2)            .addScript(<span class="string">&quot;classpath:schema.sql&quot;</span>)            .addScript(<span class="string">&quot;classpath:test-data.sql&quot;</span>)            .builder();    &#125;    <span class="meta">@Profile(&quot;qa&quot;)</span>    <span class="meta">@Bean</span>    <span class="function"><span class="keyword">public</span> DataSource <span class="title">data</span><span class="params">()</span> </span>&#123;        BasicDataSource ds = <span class="keyword">new</span> BasicDataSource();        ds.setDriveClassName(<span class="string">&quot;org.h2.Driver&quot;</span>);        ds.setUrl(<span class="string">&quot;jdbc:h2:tcp://localhost/~/spitter&quot;</span>);        ds.setUsername(<span class="string">&quot;sa&quot;</span>):        ds.setPassword(<span class="string">&quot;&quot;</span>);        <span class="keyword">return</span> ds;    &#125;    <span class="meta">@Profile(&quot;production&quot;)</span>    <span class="meta">@Bean</span>    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;        JndiObjectFactoryBean jndiObjectFB = <span class="keyword">new</span> JndiObjectFactoryBean();        jndiObjectFB.setJndiName(<span class="string">&quot;jdbc/SpitterDS&quot;</span>);        jndiObjectFB.setResourceRef(<span class="keyword">true</span>);        jndiObjectFB.setProxyInterface(javax.sql.DataSource.class);        <span class="keyword">return</span> (DataSource) jndiObjectFB.getObject();    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä½¿ç”¨ profile åŠŸèƒ½ï¼Œä¼šåœ¨è¿è¡Œæ—¶é€‰æ‹©æ•°æ®æºï¼Œè¿™å–å†³äºå“ªä¸€ä¸ª profile å¤„äºæ¿€æ´»çŠ¶æ€ã€‚å¦‚ç¨‹åºæ¸…å• 10.2 é…ç½®æ‰€ç¤ºï¼Œå½“ä¸”ä»…å½“ development profile å¤„äºæ¿€æ´»çŠ¶æ€æ—¶ï¼Œä¼šåˆ›å»ºåµŒå…¥å¼æ•°æ®åº“ï¼Œå½“ä¸”ä»…å½“ qa profile å¤„äºæ¿€æ´»çŠ¶æ€æ—¶ï¼Œä¼šåˆ›å»º DBCPBasicDataSourceï¼Œå½“ä¸”ä»…å½“ production profile å¤„äºæ¿€æ´»çŠ¶æ€æ—¶ï¼Œä¼šä» JNDI è·å–æ•°æ®æºã€‚</p>
<p>ä¸ºäº†å†…å®¹çš„å®Œæ•´æ€§ï¼Œå¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¦‚ä½•ä½¿ç”¨ Spring XML ä»£æ›¿ Java é…ç½®ï¼Œå®ç°ç›¸åŒçš„ profile é…ç½®ã€‚</p>
<center>ç¨‹åºæ¸…å•10.3ã€€å€ŸåŠ© XML é…ç½®ï¼ŒåŸºäº profile é€‰æ‹©æ•°æ®æº</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>	<span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span>	<span class="attr">xmlns:jdbc</span>=<span class="string">&quot;http://www.springframework.org/schema/jdbc&quot;</span>	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/jdbc                         http://www.springframework.org/schema/jdbc/spring-jdbc-3.1.xsd                        http://www.springframework.org/schema/beans                         http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;development&quot;</span> <span class="attr">c</span>;<span class="attr">as</span>&gt;</span>        <span class="tag">&lt;<span class="name">jdbc:embedded-database</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">type</span>=<span class="string">&quot;H2&quot;</span>&gt;</span>            <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;classpath:spittr/db/jdbc/schema.sql&quot;</span> /&gt;</span>            <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;classpath:spittr/db/jdbc/test-data.sql&quot;</span> /&gt;</span>        <span class="tag">&lt;/<span class="name">jdbc:embedded-database</span>&gt;</span>     <span class="tag">&lt;/<span class="name">beans</span>&gt;</span>    <span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;qa&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>          <span class="attr">p:driverClassName</span>=<span class="string">&quot;org.h2.Driver&quot;</span>          <span class="attr">p:url</span>=<span class="string">&quot;jdbc:h2:tcp://localhost/~/spitter&quot;</span>          <span class="attr">p:username</span>=<span class="string">&quot;sa&quot;</span>          <span class="attr">p:password</span>=<span class="string">&quot;&quot;</span>          <span class="attr">p:initialSize</span>=<span class="string">&quot;5&quot;</span>          <span class="attr">p:maxActive</span>=<span class="string">&quot;10&quot;</span>/&gt;</span>    <span class="tag">&lt;/<span class="name">beans</span>&gt;</span>    <span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;development&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">jee:jndi-lookup</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span>                          <span class="attr">jndi-name</span>=<span class="string">&quot;/jdbc/SpitterDS&quot;</span>                          <span class="attr">resource-ref</span>=<span class="string">&quot;true&quot;</span>/&gt;</span>    <span class="tag">&lt;/<span class="name">beans</span>&gt;</span> <span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å·²ç»é€šè¿‡æ•°æ®æºå»ºç«‹äº†ä¸æ•°æ®åº“çš„è¿æ¥ï¼Œæ¥ä¸‹æ¥è¦å®é™…è®¿é—®æ•°æ®åº“äº†ã€‚å°±åƒæˆ‘åœ¨å‰é¢æ‰€æåˆ°çš„ï¼ŒSpring ä¸ºæˆ‘ä»¬æä¾›äº†å¤šç§ä½¿ç”¨æ•°æ®åº“çš„æ–¹å¼åŒ…æ‹¬ JDBCã€Hibernate ä»¥åŠ Java æŒä¹…åŒ– APIï¼ˆJava Persistence APIï¼ŒJPAï¼‰ã€‚åœ¨ä¸‹ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨ Spring å¯¹ JDBC çš„æ”¯æŒä¸ºåº”ç”¨ç¨‹åºæ„å»ºæŒä¹…å±‚ã€‚å¦‚æœä½ å–œæ¬¢ä½¿ç”¨ Hibernate æˆ– JPAï¼Œé‚£å¯ä»¥ç›´æ¥è·³åˆ°ä¸‹ä¸€ç« ã€‚</p>
<h3 id="åœ¨-Spring-ä¸­ä½¿ç”¨JDBC"><a href="#åœ¨-Spring-ä¸­ä½¿ç”¨JDBC" class="headerlink" title="åœ¨ Spring ä¸­ä½¿ç”¨JDBC"></a>åœ¨ Spring ä¸­ä½¿ç”¨JDBC</h3><p>æŒä¹…åŒ–æŠ€æœ¯æœ‰å¾ˆå¤šç§ï¼Œè€ŒHibernateã€iBATISå’ŒJPAåªæ˜¯å…¶ä¸­çš„å‡ ç§è€Œå·²ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šçš„åº”ç”¨ç¨‹åºä½¿ç”¨æœ€å¤è€çš„æ–¹å¼å°† Java å¯¹è±¡ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼šä»–ä»¬è‡ªé£Ÿå…¶åŠ›ã€‚ä¸ï¼Œç­‰ç­‰ï¼Œè¿™æ˜¯ä»–ä»¬æŒ£é’±çš„é€”å¾„ã€‚è¿™ç§ä¹…ç»è€ƒéªŒå¹¶è¯æ˜è¡Œä¹‹æœ‰æ•ˆçš„æŒä¹…åŒ–æ–¹æ³•å°±æ˜¯å¤è€çš„ JDBCã€‚</p>
<p>ä¸ºä»€ä¹ˆä¸é‡‡ç”¨å®ƒå‘¢ï¼ŸJDBC ä¸è¦æ±‚æˆ‘ä»¬æŒæ¡å…¶ä»–æ¡†æ¶çš„æŸ¥è¯¢è¯­è¨€ã€‚å®ƒæ˜¯å»ºç«‹åœ¨ SQL ä¹‹ä¸Šçš„ï¼Œè€Œ SQL æœ¬èº«å°±æ˜¯æ•°æ®è®¿é—®è¯­è¨€ã€‚æ­¤å¤–ï¼Œä¸å…¶ä»–çš„æŠ€æœ¯ç›¸æ¯”ï¼Œä½¿ç”¨ JDBC èƒ½å¤Ÿæ›´å¥½åœ°å¯¹æ•°æ®è®¿é—®çš„æ€§èƒ½è¿›è¡Œè°ƒä¼˜ã€‚JDBC å…è®¸ä½ ä½¿ç”¨æ•°æ®åº“çš„æ‰€æœ‰ç‰¹æ€§ï¼Œè€Œè¿™æ˜¯å…¶ä»–æ¡†æ¶ä¸é¼“åŠ±ç”šè‡³ç¦æ­¢çš„ã€‚</p>
<p>å†è€…ï¼Œç›¸å¯¹äºæŒä¹…å±‚æ¡†æ¶ï¼ŒJDBC èƒ½å¤Ÿè®©æˆ‘ä»¬åœ¨æ›´ä½çš„å±‚æ¬¡ä¸Šå¤„ç†æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨æ§åˆ¶åº”ç”¨ç¨‹åºå¦‚ä½•è¯»å–å’Œç®¡ç†æ•°æ®ï¼ŒåŒ…æ‹¬è®¿é—®å’Œç®¡ç†æ•°æ®åº“ä¸­å•ç‹¬çš„åˆ—ã€‚è¿™ç§ç»†ç²’åº¦çš„æ•°æ®è®¿é—®æ–¹å¼åœ¨å¾ˆå¤šåº”ç”¨ç¨‹åºä¸­æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚ä¾‹å¦‚åœ¨æŠ¥è¡¨åº”ç”¨ä¸­ï¼Œå¦‚æœå°†æ•°æ®ç»„ç»‡ä¸ºå¯¹è±¡ï¼Œè€Œæ¥ä¸‹æ¥å”¯ä¸€è¦åšçš„å°±æ˜¯å°†å…¶è§£åŒ…ä¸ºåŸå§‹æ•°æ®ï¼Œé‚£å°±æ²¡æœ‰å¤ªå¤§æ„ä¹‰äº†ã€‚</p>
<p>ä½†æ˜¯ JDBC ä¹Ÿä¸æ˜¯åå…¨åç¾çš„ã€‚è™½ç„¶ JDBC å…·æœ‰å¼ºå¤§ã€çµæ´»å’Œå…¶ä»–ä¸€äº›ä¼˜ç‚¹ï¼Œä½†ä¹Ÿæœ‰å…¶ä¸è¶³ä¹‹å¤„ã€‚</p>
<h4 id="åº”å¯¹å¤±æ§çš„-JDBC-ä»£ç "><a href="#åº”å¯¹å¤±æ§çš„-JDBC-ä»£ç " class="headerlink" title="åº”å¯¹å¤±æ§çš„ JDBC ä»£ç "></a>åº”å¯¹å¤±æ§çš„ JDBC ä»£ç </h4><p>å¦‚æœä½¿ç”¨ JDBC æ‰€æä¾›çš„ç›´æ¥æ“ä½œæ•°æ®åº“çš„ APIï¼Œä½ éœ€è¦è´Ÿè´£å¤„ç†ä¸æ•°æ®åº“è®¿é—®ç›¸å…³çš„æ‰€æœ‰äº‹æƒ…ï¼Œå…¶ä¸­åŒ…å«ç®¡ç†æ•°æ®åº“èµ„æºå’Œå¤„ç†å¼‚å¸¸ã€‚å¦‚æœä½ æ›¾ç»ä½¿ç”¨ JDBC å¾€æ•°æ®åº“ä¸­æ’å…¥æ•°æ®ï¼Œé‚£å¦‚ä¸‹ä»£ç å¯¹ä½ åº”è¯¥å¹¶ä¸é™Œç”Ÿï¼š</p>
<center>ç¨‹åºæ¸…å•10.4ã€€ä½¿ç”¨ JDBC åœ¨æ•°æ®åº“é‡Œæ’å…¥ä¸€è¡Œæ•°æ®</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SQL_INSERT_SPITTER =     <span class="string">&quot;insert into spitter (username, password, fullname) values (?, ?, ?)&quot;</span>;<span class="keyword">private</span> DataSource dataSource;<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;    connection conn = <span class="keyword">null</span>;    PreparedStatement stmt = <span class="keyword">null</span>;    <span class="keyword">try</span> &#123;        conn = datasource.getConnection();        stmt = conn.prepareStatement(SQL_INSERT_SPITTER);        stmt.setString(<span class="number">1</span>, spitter.getUsername());        stmt.setString(<span class="number">2</span>, spitter.getPassword());        stmt.setString(<span class="number">3</span>, spitter.getFullName());        stmt.execute();    &#125; <span class="keyword">catch</span> (SQLException e) &#123;        <span class="comment">// do something ... not sure what, though    &#125; finally &#123;        try &#123;            if (stmt != null) &#123;                stmt.close();            &#125;            if (conn != null) &#123;                conn.close();            &#125;        &#125; catch (SQLException e) &#123;            // I&#x27;m even less sure about what todo here        &#125;    &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>çœ‹çœ‹è¿™äº›å¤±æ§çš„ä»£ç ï¼è¿™ä¸ªè¶…è¿‡ 20 è¡Œçš„ä»£ç ä»…ä»…æ˜¯ä¸ºäº†å‘æ•°æ®åº“ä¸­æ’å…¥ä¸€ä¸ªç®€å•çš„å¯¹è±¡ã€‚å¯¹äº JDBC æ“ä½œæ¥è®²ï¼Œè¿™åº”è¯¥æ˜¯æœ€ç®€å•çš„äº†ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆè¦ç”¨è¿™ä¹ˆå¤šè¡Œä»£ç æ‰èƒ½åšå¦‚æ­¤ç®€å•çš„äº‹æƒ…å‘¢ï¼Ÿå®é™…ä¸Šï¼Œå¹¶éå¦‚æ­¤ï¼Œåªæœ‰å‡ è¡Œä»£ç æ˜¯çœŸæ­£ç”¨äºè¿›è¡Œæ’å…¥æ•°æ®çš„ã€‚ä½†æ˜¯ JDBC è¦æ±‚ä½ å¿…é¡»æ­£ç¡®åœ°ç®¡ç†è¿æ¥å’Œè¯­å¥ï¼Œå¹¶ä»¥æŸç§æ–¹å¼å¤„ç†å¯èƒ½æŠ›å‡ºçš„ SQLException å¼‚å¸¸ã€‚</p>
<p>å†æä¸€å¥è¿™ä¸ª SQLException å¼‚å¸¸ï¼šä½ ä¸ä½†ä¸æ¸…æ¥šå¦‚ä½•å¤„ç†å®ƒï¼ˆå› ä¸ºå¹¶ä¸çŸ¥é“å“ªé‡Œå‡ºé”™äº†ï¼‰ï¼Œè€Œä¸”ä½ è¿˜è¦æ•æ‰å®ƒä¸¤æ¬¡ï¼ä½ éœ€è¦åœ¨æ’å…¥è®°å½•å‡ºé”™æ—¶æ•æ‰å®ƒï¼ŒåŒæ—¶ä½ è¿˜éœ€è¦åœ¨å…³é—­è¯­å¥å’Œè¿æ¥å‡ºé”™çš„æ—¶å€™æ•æ‰å®ƒã€‚çœ‹èµ·æ¥æˆ‘ä»¬è¦åšå¾ˆå¤šçš„å·¥ä½œæ¥å¤„ç†å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼Œè€Œè¿™äº›é—®é¢˜é€šå¸¸æ˜¯éš¾ä»¥é€šè¿‡ç¼–ç æ¥å¤„ç†çš„ã€‚</p>
<p>å†æ¥çœ‹ä¸€ä¸‹å¦‚ä¸‹ç¨‹åºæ¸…å•ä¸­çš„ä»£ç ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¼ ç»Ÿçš„ JDBC æ¥æ›´æ–°æ•°æ®åº“ä¸­ Spitter è¡¨çš„ä¸€è¡Œã€‚</p>
<center>ç¨‹åºæ¸…å• 10.5ã€€ä½¿ç”¨ JDBC æ›´æ–°æ•°æ®åº“ä¸­çš„ä¸€è¡Œ</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SQL_UPDATE_SPITTER =     <span class="string">&quot;update spitter set username = ?, password = ?, fullname = ?&quot;</span>    + <span class="string">&quot;where id = ?&quot;</span>;<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;    Connection conn = <span class="keyword">null</span>;    PreparedStatement stmt = <span class="keyword">null</span>;    <span class="keyword">try</span> &#123;        conn = dataSource.getConnection();        stmt = conn.prepareStatement(SQL_UPDATE_SPITTER);        stmt.setString(<span class="number">1</span>, spitter.getUsername());        stmt.setString(<span class="number">2</span>, spitter.getPassword());        stmt.setString(<span class="number">3</span>, spitter.getFullname());        stmt.setLong(<span class="number">4</span>, spitter.getId());        stmt.execute();    &#125; <span class="keyword">catch</span> (SQLException e) &#123;        <span class="comment">// Still not sure what I&#x27;m supposed to do here    &#125; finally &#123;        try &#123;            if (stmt != null) &#123;                stmt.close();            &#125;            if (conn != null) &#123;                conn.close();            &#125;        &#125; catch (SQLException e) &#123;            // or here        &#125;    &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä¹çœ‹ä¸Šå»ï¼Œç¨‹åºæ¸…å• 10.5 å’Œ 10.4 æ˜¯ç›¸åŒçš„ã€‚å®é™…ä¸Šï¼Œé™¤äº† SQL å­—ç¬¦ä¸²å’Œåˆ›å»ºè¯­å¥çš„é‚£ä¸€è¡Œï¼Œå®ƒä»¬æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚åŒæ ·ï¼Œè¿™é‡Œä¹Ÿä½¿ç”¨å¤§é‡ä»£ç æ¥å®Œæˆä¸€ä»¶ç®€å•çš„äº‹æƒ…ï¼Œè€Œä¸”æœ‰å¾ˆå¤šé‡å¤çš„ä»£ç ã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™ä¸ç‰¹å®šä»»åŠ¡ç›¸å…³çš„ä»£ç ã€‚æ¯•ç«Ÿï¼Œè¿™æ‰æ˜¯ç¨‹åºæ¸…å• 10.5 å’Œ 10.4 çš„ä¸åŒä¹‹å¤„ï¼Œå‰©ä¸‹çš„éƒ½æ˜¯æ ·æ¿ä»£ç ã€‚</p>
<p>ä¸ºäº†å®Œæˆå¯¹ JDBC çš„å®Œæ•´ä»‹ç»ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ä»æ•°æ®åº“ä¸­è·å–æ•°æ®ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œå®ƒä¹Ÿä¸ç®€å•ã€‚</p>
<center>ç¨‹åºæ¸…å•10.6ã€€ä½¿ç”¨ JDBC ä»æ•°æ®åº“ä¸­æŸ¥è¯¢ä¸€è¡Œæ•°æ®</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SQL_SELECT_SPITTER =     <span class="string">&quot;select id, username, fullname from spitter where id = ?&quot;</span>;<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findOne</span><span class="params">(Long id)</span> </span>&#123;    Connection conn = <span class="keyword">null</span>;    PreparedStatement stmt = <span class="keyword">null</span>;    ResultSet rs = <span class="keyword">null</span>;    <span class="keyword">try</span> &#123;        conn = dataSource.getConnection();        stmt = conn.prepareStatement(SQL_SELECT_SPITTER);        stmt.setLong(<span class="number">1</span>, id);        rs = stmt.executeQuery();        Spitter spitter = <span class="keyword">null</span>;        <span class="keyword">if</span> (rs.next()) &#123;            spitter = <span class="keyword">new</span> Spitter();            spitter.setId(rs.getLong(<span class="string">&quot;id&quot;</span>));            spitter.setUsername(rs.getString(<span class="string">&quot;username&quot;</span>));            spitter.setPassword(rs.getString(<span class="string">&quot;password&quot;</span>));            spitter.setFullName(rs.getString(<span class="string">&quot;fullname&quot;</span>));        &#125;        <span class="keyword">return</span> spitter;    &#125; <span class="keyword">catch</span> (SQLException e) &#123;        <span class="comment">// Still not sure what I&#x27;m supposed to do here    &#125; finally &#123;        try &#123;            if (stmt != null) &#123;                stmt.close();            &#125;            if (conn != null) &#123;                conn.close();            &#125;        &#125; catch (SQLException e) &#123;            // or here        &#125;    &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç ä¸æ’å…¥å’Œæ›´æ–°çš„æ ·ä¾‹ä¸€æ ·å†—é•¿ï¼Œç”šè‡³æ›´ä¸ºå¤æ‚ã€‚è¿™å°±å¥½åƒ Pareto æ³•åˆ™è¢«å€’äº†è¿‡æ¥ï¼šåªæœ‰ 20% çš„ä»£ç æ˜¯çœŸæ­£ç”¨äºæŸ¥è¯¢æ•°æ®çš„ï¼Œè€Œ 80% ä»£ç éƒ½æ˜¯æ ·æ¿ä»£ç ã€‚</p>
<p>ç°åœ¨ä½ å¯ä»¥çœ‹å‡ºï¼Œå¤§é‡çš„ JDBC ä»£ç éƒ½æ˜¯ç”¨äºåˆ›å»ºè¿æ¥å’Œè¯­å¥ä»¥åŠå¼‚å¸¸å¤„ç†çš„æ ·æ¿ä»£ç ã€‚æ—¢ç„¶å·²ç»å¾—å‡ºäº†è¿™ä¸ªè§‚ç‚¹ï¼Œæˆ‘ä»¬å°†ä¸å†æ¥å—å®ƒçš„æŠ˜ç£¨ï¼Œä»¥åä½ å†ä¹Ÿä¸ä¼šçœ‹åˆ°è¿™æ ·ä»¤äººåŒæ¶çš„ä»£ç äº†ã€‚</p>
<p>ä½†å®é™…ä¸Šï¼Œè¿™äº›æ ·æ¿ä»£ç æ˜¯éå¸¸é‡è¦çš„ã€‚æ¸…ç†èµ„æºå’Œå¤„ç†é”™è¯¯ç¡®ä¿äº†æ•°æ®è®¿é—®çš„å¥å£®æ€§ã€‚å¦‚æœæ²¡æœ‰å®ƒä»¬çš„è¯ï¼Œå°±ä¸ä¼šå‘ç°é”™è¯¯è€Œä¸”èµ„æºä¹Ÿä¼šå¤„äºæ‰“å¼€çš„çŠ¶æ€ï¼Œè¿™å°†ä¼šå¯¼è‡´æ„å¤–çš„ä»£ç å’Œèµ„æºæ³„éœ²ã€‚æˆ‘ä»¬ä¸ä»…éœ€è¦è¿™äº›ä»£ç ï¼Œè€Œä¸”è¿˜è¦ä¿è¯å®ƒæ˜¯æ­£ç¡®çš„ã€‚åŸºäºè¿™æ ·çš„åŸå› ï¼Œæˆ‘ä»¬æ‰éœ€è¦æ¡†æ¶æ¥ä¿è¯è¿™äº›ä»£ç åªå†™ä¸€æ¬¡è€Œä¸”æ˜¯æ­£ç¡®çš„ã€‚</p>
<h4 id="ä½¿ç”¨-JDBC-æ¨¡æ¿"><a href="#ä½¿ç”¨-JDBC-æ¨¡æ¿" class="headerlink" title="ä½¿ç”¨ JDBC æ¨¡æ¿"></a>ä½¿ç”¨ JDBC æ¨¡æ¿</h4><p>Spring çš„ JDBC æ¡†æ¶æ‰¿æ‹…äº†èµ„æºç®¡ç†å’Œå¼‚å¸¸å¤„ç†çš„å·¥ä½œï¼Œä»è€Œç®€åŒ–äº† JDBC ä»£ç ï¼Œè®©æˆ‘ä»¬åªéœ€ç¼–å†™ä»æ•°æ®åº“è¯»å†™æ•°æ®çš„å¿…éœ€ä»£ç ã€‚</p>
<p>æ­£å¦‚å‰é¢å°èŠ‚æ‰€ä»‹ç»è¿‡çš„ï¼ŒSpring å°†æ•°æ®è®¿é—®çš„æ ·æ¿ä»£ç æŠ½è±¡åˆ°æ¨¡æ¿ç±»ä¹‹ä¸­ã€‚Spring ä¸º JDBC æä¾›äº†ä¸‰ä¸ªæ¨¡æ¿ç±»ä¾›é€‰æ‹©ï¼š</p>
<ul>
<li>JdbcTemplateï¼šæœ€åŸºæœ¬çš„ Spring JDBC æ¨¡æ¿ï¼Œè¿™ä¸ªæ¨¡æ¿æ”¯æŒç®€å•çš„ JDBC æ•°æ®åº“è®¿é—®åŠŸèƒ½ä»¥åŠåŸºäºç´¢å¼•å‚æ•°çš„æŸ¥è¯¢ï¼›</li>
<li>NamedParameterJdbcTemplateï¼šä½¿ç”¨è¯¥æ¨¡æ¿ç±»æ‰§è¡ŒæŸ¥è¯¢æ—¶å¯ä»¥å°†å€¼ä»¥å‘½åå‚æ•°çš„å½¢å¼ç»‘å®šåˆ° SQL ä¸­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç®€å•çš„ç´¢å¼•å‚æ•°ï¼›</li>
<li>SimpleJdbcTemplateï¼šè¯¥æ¨¡æ¿ç±»åˆ©ç”¨ Java 5 çš„ä¸€äº›ç‰¹æ€§å¦‚è‡ªåŠ¨è£…ç®±ã€æ³›å‹ä»¥åŠå¯å˜å‚æ•°åˆ—è¡¨æ¥ç®€åŒ– JDBC æ¨¡æ¿çš„ä½¿ç”¨ã€‚</li>
</ul>
<p>ä»¥å‰ï¼Œåœ¨é€‰æ‹©å“ªä¸€ä¸ª JDBC æ¨¡æ¿çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä»”ç»†æƒè¡¡ã€‚ä½†æ˜¯ä» Spring 3.1 å¼€å§‹ï¼Œåšè¿™ä¸ªå†³å®šå˜å¾—å®¹æ˜“å¤šäº†ã€‚SimpleJdbcTemplate å·²ç»è¢«åºŸå¼ƒäº†ï¼Œå…¶ Java 5 çš„ç‰¹æ€§è¢«è½¬ç§»åˆ°äº† JdbcTemplate ä¸­ï¼Œå¹¶ä¸”åªæœ‰åœ¨ä½ éœ€è¦ä½¿ç”¨å‘½åå‚æ•°çš„æ—¶å€™ï¼Œæ‰éœ€è¦ä½¿ç”¨ NamedParameterJdbcTemplateã€‚è¿™æ ·çš„è¯ï¼Œå¯¹äºå¤§å¤šæ•°çš„ JDBC ä»»åŠ¡æ¥è¯´ï¼ŒJdbcTemplate å°±æ˜¯æœ€å¥½çš„å¯é€‰æ–¹æ¡ˆï¼Œè¿™ä¹Ÿæ˜¯æœ¬å°èŠ‚ä¸­æ‰€å…³æ³¨çš„æ–¹æ¡ˆã€‚</p>
<p>ä½¿ç”¨ JdbcTemplate æ¥æ’å…¥æ•°æ®</p>
<p>ä¸ºäº†è®© JdbcTemplate æ­£å¸¸å·¥ä½œï¼Œåªéœ€è¦ä¸ºå…¶è®¾ç½® DataSource å°±å¯ä»¥äº†ï¼Œè¿™ä½¿å¾—åœ¨ Spring ä¸­é…ç½® JdbcTemplate éå¸¸å®¹æ˜“ï¼Œå¦‚ä¸‹é¢çš„ @Bean æ–¹æ³•æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">JdbcTemplate <span class="title">jdbcTemplate</span><span class="params">(DataSource dataSource)</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource);&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼ŒDataSource æ˜¯é€šè¿‡æ„é€ å™¨å‚æ•°æ³¨å…¥è¿›æ¥çš„ã€‚è¿™é‡Œæ‰€å¼•ç”¨çš„ dataSource bean å¯ä»¥æ˜¯ javax.sql.DataSource çš„ä»»æ„å®ç°ï¼ŒåŒ…æ‹¬æˆ‘ä»¬åœ¨ 10.2 å°èŠ‚ä¸­æ‰€åˆ›å»ºçš„ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°† jdbcTemplate è£…é…åˆ° Repository ä¸­å¹¶ä½¿ç”¨å®ƒæ¥è®¿é—®æ•°æ®åº“ã€‚ä¾‹å¦‚ï¼ŒSpitterRepository ä½¿ç”¨äº† JdbcTemplateï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repositorypublic</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcSpitterRepository</span> <span class="keyword">implements</span> <span class="title">SpitterRepository</span> </span>&#123;    <span class="keyword">private</span> JdbcOperations jdbcOperations;        <span class="meta">@Inject</span>    <span class="function"><span class="keyword">public</span> <span class="title">JdbcSpitterRepository</span><span class="params">(JdbcOperations jdbcOperations)</span> </span>&#123;        <span class="keyword">this</span>.jdbcOperations = jdbcOperations;    &#125;    ...&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼ŒJdbcSpitterRepository ç±»ä¸Šä½¿ç”¨äº† @Repository æ³¨è§£ï¼Œè¿™è¡¨æ˜å®ƒå°†ä¼šåœ¨ç»„ä»¶æ‰«æçš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºã€‚å®ƒçš„æ„é€ å™¨ä¸Šä½¿ç”¨äº† @Inject æ³¨è§£ï¼Œå› æ­¤åœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è·å¾—ä¸€ä¸ª JdbcOperations å¯¹è±¡ã€‚JdbcOperations æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰äº† JdbcTemplate æ‰€å®ç°çš„æ“ä½œã€‚é€šè¿‡æ³¨å…¥ JdbcOperationsï¼Œè€Œä¸æ˜¯å…·ä½“çš„ JdbcTemplateï¼Œèƒ½å¤Ÿä¿è¯ JdbcSpitterRepository é€šè¿‡ JdbcOperations æ¥å£è¾¾åˆ°ä¸ JdbcTemplate ä¿æŒæ¾è€¦åˆã€‚</p>
<p>ä½œä¸ºå¦å¤–ä¸€ç§ç»„ä»¶æ‰«æå’Œè‡ªåŠ¨è£…é…çš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥å°† JdbcSpitterRepository æ˜¾å¼å£°æ˜ä¸º Spring ä¸­çš„ beanï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">SpitterRepository <span class="title">spitterRepository</span><span class="params">(JdbcTemplate jdbcTemplate)</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> JdbcSpitterRepository(jdbcTemplate);&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ Repository ä¸­å…·å¤‡å¯ç”¨çš„ JdbcTemplate åï¼Œæˆ‘ä»¬å¯ä»¥æå¤§åœ°ç®€åŒ–ç¨‹åºæ¸…å• 10.4 ä¸­çš„ addSpitter() æ–¹æ³•ã€‚åŸºäº JdbcTemplate çš„ addSpitter() æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<center>ç¨‹åºæ¸…å• 10.7ã€€åŸºäº JdbcTemplate çš„ addSpitter() æ–¹æ³•</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;    jdbcOperations.update(INSERT_SPITTER,                         spitter.getUsername(),                         spitter.getPassword(),                         spitter.getFullName(),                         spitter.getEmail(),                         spitter.isUpdateByEmail());&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç‰ˆæœ¬çš„ addSpitter() æ–¹æ³•ç®€å•å¤šäº†ã€‚è¿™é‡Œæ²¡æœ‰äº†åˆ›å»ºè¿æ¥å’Œè¯­å¥çš„ä»£ç ï¼Œä¹Ÿæ²¡æœ‰å¼‚å¸¸å¤„ç†çš„ä»£ç ï¼Œåªå‰©ä¸‹å•çº¯çš„æ•°æ®æ’å…¥ä»£ç ã€‚</p>
<p>ä¸èƒ½å› ä¸ºä½ çœ‹ä¸åˆ°è¿™äº›æ ·æ¿ä»£ç ï¼Œå°±æ„å‘³ç€å®ƒä»¬ä¸å­˜åœ¨ã€‚æ ·æ¿ä»£ç è¢«å·§å¦™åœ°éšè—åˆ° JDBC æ¨¡æ¿ç±»ä¸­äº†ã€‚å½“ update() æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ JdbcTemplate å°†ä¼šè·å–è¿æ¥ã€åˆ›å»ºè¯­å¥å¹¶æ‰§è¡Œæ’å…¥ SQLã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œä½ ä¹Ÿçœ‹ä¸åˆ°å¯¹ SQLException å¤„ç†çš„ä»£ç ã€‚åœ¨å†…éƒ¨ï¼ŒJdbcTemplate å°†ä¼šæ•è·æ‰€æœ‰å¯èƒ½æŠ›å‡ºçš„ SQLExceptionï¼Œå¹¶å°†é€šç”¨çš„ SQLException è½¬æ¢ä¸ºè¡¨ 10.1 æ‰€åˆ—çš„é‚£äº›æ›´æ˜ç¡®çš„æ•°æ®è®¿é—®å¼‚å¸¸ï¼Œç„¶åå°†å…¶é‡æ–°æŠ›å‡ºã€‚å› ä¸ºSpringçš„æ•°æ®è®¿é—®å¼‚å¸¸éƒ½æ˜¯è¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¿…åœ¨ addSpring() æ–¹æ³•ä¸­è¿›è¡Œæ•è·ã€‚</p>
<p>ä½¿ç”¨ JdbcTemplate æ¥è¯»å–æ•°æ®</p>
<p>JdbcTemplate ä¹Ÿç®€åŒ–äº†æ•°æ®çš„è¯»å–æ“ä½œã€‚ç¨‹åºæ¸…å• 10.8 å±•ç°äº†æ–°ç‰ˆæœ¬çš„ findOne() æ–¹æ³•ï¼Œå®ƒä½¿ç”¨äº† JdbcTemplate çš„å›è°ƒï¼Œå®ç°æ ¹æ® ID æŸ¥è¯¢ Spitterï¼Œå¹¶å°†ç»“æœé›†æ˜ å°„ä¸º Spitter å¯¹è±¡ã€‚</p>
<center>ç¨‹åºæ¸…å• 10.8ã€€ä½¿ç”¨ JdbcTemplate æŸ¥è¯¢ Spitter</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Spitter <span class="title">findOne</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;    <span class="keyword">return</span> jdbcTemplate.queryForObject(          SELECT_SPITTER_By_ID, <span class="keyword">new</span> SpitterRowMapper(), id); &#125;<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SpitterRowMapper</span> <span class="keyword">implements</span> <span class="title">RowMapper</span>&lt;<span class="title">Spitter</span>&gt; </span>&#123;    <span class="function"><span class="keyword">public</span> Spitter <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException </span>&#123;        <span class="keyword">long</span> id = rs.getLong(<span class="string">&quot;id&quot;</span>);        String username = rs.getString(<span class="string">&quot;username&quot;</span>);        String password = rs.getString(<span class="string">&quot;password&quot;</span>);        String fullName = rs.getString(<span class="string">&quot;fullname&quot;</span>);        String email = rs.getString(<span class="string">&quot;email&quot;</span>);        <span class="keyword">boolean</span> updateByEmail = rs.getBoolean(<span class="string">&quot;updateByEmail&quot;</span>);        <span class="keyword">return</span> <span class="keyword">new</span> Spitter(id, username, password, fullName, email, updateByEmail);    &#125;		&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ª findOne() æ–¹æ³•ä¸­ä½¿ç”¨äº† JdbcTemplate çš„ queryForObject() æ–¹æ³•æ¥ä»æ•°æ®åº“æŸ¥è¯¢ Spitterã€‚queryForObject() æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼š</p>
<ul>
<li><p>String å¯¹è±¡ï¼ŒåŒ…å«äº†è¦ä»æ•°æ®åº“ä¸­æŸ¥æ‰¾æ•°æ®çš„ SQLï¼›</p>
</li>
<li><p>RowMapper å¯¹è±¡ï¼Œç”¨æ¥ä» ResultSet ä¸­æå–æ•°æ®å¹¶æ„å»ºåŸŸå¯¹è±¡ï¼ˆæœ¬ä¾‹ä¸­ä¸º Spitterï¼‰ï¼›</p>
</li>
<li><p>å¯å˜å‚æ•°åˆ—è¡¨ï¼Œåˆ—å‡ºäº†è¦ç»‘å®šåˆ°æŸ¥è¯¢ä¸Šçš„ç´¢å¼•å‚æ•°å€¼ã€‚</p>
</li>
</ul>
<p>çœŸæ­£å¥‡å¦™çš„äº‹æƒ…å‘ç”Ÿåœ¨ SpitterRowMapper å¯¹è±¡ä¸­ï¼Œå®ƒå®ç°äº† RowMapper æ¥å£ã€‚å¯¹äºæŸ¥è¯¢è¿”å›çš„æ¯ä¸€è¡Œæ•°æ®ï¼ŒJdbcTemplate å°†ä¼šè°ƒç”¨ RowMapper çš„ mapRow() æ–¹æ³•ï¼Œå¹¶ä¼ å…¥ä¸€ä¸ª ResultSet å’ŒåŒ…å«è¡Œå·çš„æ•´æ•°ã€‚åœ¨ SpitterRowMapper çš„ mapRow() æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº† Spitter å¯¹è±¡å¹¶å°† ResultSet ä¸­çš„å€¼å¡«å……è¿›å»ã€‚</p>
<p>å°±åƒ addSpitter() é‚£æ ·ï¼ŒfindOne() æ–¹æ³•ä¹Ÿä¸ç”¨å†™ JDBC æ¨¡æ¿ä»£ç ã€‚ä¸åŒäºä¼ ç»Ÿçš„ JDBCï¼Œè¿™é‡Œæ²¡æœ‰èµ„æºç®¡ç†æˆ–è€…å¼‚å¸¸å¤„ç†ä»£ç ã€‚ä½¿ç”¨ JdbcTemplate çš„æ–¹æ³•åªéœ€å…³æ³¨äºå¦‚ä½•ä»æ•°æ®åº“ä¸­è·å– Spitter å¯¹è±¡å³å¯ã€‚</p>
<p>åœ¨ JdbcTemplate ä¸­ä½¿ç”¨ Java 8 çš„ Lambda è¡¨è¾¾å¼</p>
<p>å› ä¸º RowMapper æ¥å£åªå£°æ˜äº† addRow() è¿™ä¸€ä¸ªæ–¹æ³•ï¼Œå› æ­¤å®ƒå®Œå…¨ç¬¦åˆå‡½æ•°å¼æ¥å£ï¼ˆfunctional interfaceï¼‰çš„æ ‡å‡†ã€‚è¿™æ„å‘³ç€å¦‚æœä½¿ç”¨ Java 8 æ¥å¼€å‘åº”ç”¨çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Lambda æ¥è¡¨è¾¾ RowMapper çš„å®ç°ï¼Œè€Œä¸å¿…å†ä½¿ç”¨å…·ä½“çš„å®ç°ç±»äº†ã€‚</p>
<p>ä¾‹å¦‚ï¼Œç¨‹åºæ¸…å• 10.8 ä¸­çš„ findOne() æ–¹æ³•å¯ä»¥ä½¿ç”¨ Java 8 çš„ Lambda è¡¨è¾¾å¼æ”¹å†™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Spitter <span class="title">findOne</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;    <span class="keyword">return</span> jdbcOperations.queryForObject(    SELECT_SPITTER_BY_ID,    (rs, rowNum) -&gt;&#123;    	<span class="keyword">return</span> <span class="keyword">new</span> Spitter(    		rs.getLong(<span class="string">&quot;id&quot;</span>),    		rs.getString(<span class="string">&quot;username&quot;</span>),    		rs.getString(<span class="string">&quot;password&quot;</span>),    		rs.getString(<span class="string">&quot;fullname&quot;</span>),    		rs.getString(<span class="string">&quot;email&quot;</span>),    		rs.getBoolean(<span class="string">&quot;updateByEmail&quot;</span>));    	&#125;, id);&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒLambda è¡¨è¾¾å¼è¦æ¯”å®Œæ•´çš„ RowMapper å®ç°æ›´ä¸ºæ˜“è¯»ï¼Œä¸è¿‡å®ƒä»¬çš„åŠŸèƒ½æ˜¯ç›¸åŒçš„ã€‚Java ä¼šé™åˆ¶ RowMapper ä¸­çš„Lambdaè¡¨è¾¾å¼ï¼Œä½¿å…¶æ»¡è¶³æ‰€ä¼ å…¥çš„å‚æ•°ã€‚</p>
<p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ Java 8 çš„æ–¹æ³•å¼•ç”¨ï¼Œåœ¨å•ç‹¬çš„æ–¹æ³•ä¸­å®šä¹‰æ˜ å°„é€»è¾‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Spitter <span class="title">FindOne</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;    <span class="keyword">return</span> jdbcOperations.QueryForObject(SELECT_SPITTER_BY_ID, <span class="keyword">this</span>::mapSpitter, id);&#125;<span class="function"><span class="keyword">private</span> Spitter <span class="title">mapSpitter</span><span class="params">(ResultSet rs, <span class="keyword">int</span> row)</span> <span class="keyword">throws</span> SQLException </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> Spitter(    rs.getLong(<span class="string">&quot;id&quot;</span>),    rs.getString(<span class="string">&quot;username&quot;</span>),    rs.getString(<span class="string">&quot;password&quot;</span>),    rs.getString(<span class="string">&quot;fullName&quot;</span>),    rs.getString(<span class="string">&quot;email&quot;</span>),    rs.getBoolean(<span class="string">&quot;updateByEmail&quot;</span>));&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡é‡‡ç”¨å“ªç§æ–¹å¼ï¼Œæˆ‘ä»¬éƒ½ä¸å¿…æ˜¾å¼å®ç° RowMapper æ¥å£ï¼Œä½†æ˜¯ä¸å®ç° RowMapper ç±»ä¼¼ï¼Œæˆ‘ä»¬æ‰€æä¾›çš„ Lambda è¡¨è¾¾å¼å’Œæ–¹æ³•å¿…é¡»è¦æ¥å—ç›¸åŒçš„å‚æ•°ï¼Œå¹¶è¿”å›ç›¸åŒçš„ç±»å‹ã€‚</p>
<p>ä½¿ç”¨å‘½åå‚æ•°</p>
<p>åœ¨æ¸…å• 10.7 çš„ä»£ç ä¸­ï¼ŒaddSpitter() æ–¹æ³•ä½¿ç”¨äº†ç´¢å¼•å‚æ•°ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦ç•™æ„æŸ¥è¯¢ä¸­å‚æ•°çš„é¡ºåºï¼Œåœ¨å°†å€¼ä¼ é€’ç»™ update() æ–¹æ³•çš„æ—¶å€™è¦ä¿æŒæ­£ç¡®çš„é¡ºåºã€‚å¦‚æœåœ¨ä¿®æ”¹ SQL æ—¶æ›´æ”¹äº†å‚æ•°çš„é¡ºåºï¼Œé‚£æˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹å‚æ•°å€¼çš„é¡ºåºã€‚</p>
<p>é™¤äº†è¿™ç§æ–¹æ³•ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å‘½åå‚æ•°ã€‚å‘½åå‚æ•°å¯ä»¥èµ‹äºˆ SQL ä¸­çš„æ¯ä¸ªå‚æ•°ä¸€ä¸ªæ˜ç¡®çš„åå­—ï¼Œåœ¨ç»‘å®šå€¼åˆ°æŸ¥è¯¢è¯­å¥çš„æ—¶å€™å°±é€šè¿‡è¯¥åå­—æ¥å¼•ç”¨å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ SQL_INSERT_SPITTER æŸ¥è¯¢è¯­å¥æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SQL_INSERT_SPITTER =     <span class="string">&quot;insert into spitter (username, password, fullname)&quot;</span> + <span class="string">&quot;values (:username, :passowrd, :fullname)&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨å‘½åå‚æ•°æŸ¥è¯¢ï¼Œç»‘å®šå€¼çš„é¡ºåºå°±ä¸é‡è¦äº†ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§åå­—æ¥ç»‘å®šå€¼ã€‚å¦‚æœæŸ¥è¯¢è¯­å¥å‘ç”Ÿäº†å˜åŒ–å¯¼è‡´å‚æ•°çš„é¡ºåºä¸ä¹‹å‰ä¸ä¸€è‡´ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¿®æ”¹ç»‘å®šçš„ä»£ç ã€‚</p>
<p>NamedParameterJdbcTemplate æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ JDBC æ¨¡æ¿ç±»ï¼Œå®ƒæ”¯æŒä½¿ç”¨å‘½åå‚æ•°ã€‚åœ¨Springä¸­ï¼ŒNamedParameterJdbcTemplate çš„å£°æ˜æ–¹å¼ä¸å¸¸è§„çš„ JdbcTemplate å‡ ä¹å®Œå…¨ç›¸åŒï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">NamedParameterJdbcTemplate <span class="title">jdbcTemplate</span><span class="params">(DataSource dataSource)</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> NamedParameterJdbcTemplate(dataSource);&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°† NamedParameterJdbcOperationsï¼ˆNamedParameterJdbcTemplate æ‰€å®ç°çš„æ¥å£ï¼‰æ³¨å…¥åˆ° Repository ä¸­ï¼Œç”¨å®ƒæ¥æ›¿ä»£ JdbcOperationsã€‚ç°åœ¨çš„ addSpitter() æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<center>ç¨‹åºæ¸…å• 10.9ã€€ä½¿ç”¨ Spring JDBC æ¨¡æ¿çš„å‘½åå‚æ•°åŠŸèƒ½</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String INSERT_SPITTER =    <span class="string">&quot;insert into Spitter &quot;</span> + <span class="string">&quot;(username, password, fullname, email, updateByEmail)&quot;</span> +     <span class="string">&quot;values &quot;</span> + <span class="string">&quot; (:username, :password, :fullname, :email, :updateByEmail)&quot;</span>;<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;    Map&lt;String, Object&gt; paramMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();    paramMap.put(<span class="string">&quot;username&quot;</span>, spitter.getUsername());    paramMap.put(<span class="string">&quot;password&quot;</span>, spitter.getPassword());    paramMap.put(<span class="string">&quot;fullname&quot;</span>, spitter.getFullName());    paramMap.put(<span class="string">&quot;email&quot;</span>, spitter.getEmail());    paramMap.put(<span class="string">&quot;updateByEmail&quot;</span>, spitter.isUpdateByEmail());    jdbcOperations.update(INSERT_SPITTER, paramMap);&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç‰ˆæœ¬çš„ addSpitter() æ¯”å‰ä¸€ç‰ˆæœ¬çš„ä»£ç è¦é•¿ä¸€äº›ã€‚è¿™æ˜¯å› ä¸ºå‘½åå‚æ•°æ˜¯é€šè¿‡ java.util.Map æ¥è¿›è¡Œç»‘å®šçš„ã€‚ä¸è¿‡ï¼Œæ¯è¡Œä»£ç éƒ½å…³æ³¨äºå¾€æ•°æ®åº“ä¸­æ’å…¥ Spitter å¯¹è±¡ã€‚è¿™ä¸ªæ–¹æ³•çš„æ ¸å¿ƒåŠŸèƒ½å¹¶ä¸ä¼šè¢«èµ„æºç®¡ç†æˆ–å¼‚å¸¸å¤„ç†è¿™æ ·çš„ä»£ç æ‰€å……æ–¥ã€‚</p>
<h3 id="å°ç»“-9"><a href="#å°ç»“-9" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>æ•°æ®æ˜¯åº”ç”¨ç¨‹åºçš„è¡€æ¶²ã€‚æœ‰äº›æ•°æ®ä¸­å¿ƒè®ºè€…ç”šè‡³ä¸»å¼ æ•°æ®å³åº”ç”¨ã€‚é‰´äºæ•°æ®çš„é‡è¦åœ°ä½ï¼Œä»¥å¥å£®ã€ç®€å•å’Œæ¸…æ™°çš„æ–¹å¼å¼€å‘åº”ç”¨ç¨‹åºçš„æ•°æ®è®¿é—®éƒ¨åˆ†å°±æ˜¾å¾—ä¸¾è¶³è½»é‡äº†ã€‚</p>
<p>åœ¨ Java ä¸­ï¼ŒJDBC æ˜¯ä¸å…³ç³»å‹æ•°æ®åº“äº¤äº’çš„æœ€åŸºæœ¬æ–¹å¼ã€‚ä½†æ˜¯æŒ‰ç…§è§„èŒƒï¼ŒJDBC æœ‰äº›å¤ªç¬¨é‡äº†ã€‚Spring èƒ½å¤Ÿè§£é™¤æˆ‘ä»¬ä½¿ç”¨ JDBC ä¸­çš„å¤§å¤šæ•°ç—›è‹¦ï¼ŒåŒ…æ‹¬æ¶ˆé™¤æ ·æ¿å¼ä»£ç ã€ç®€åŒ– JDBC å¼‚å¸¸å¤„ç†ï¼Œä½ æ‰€éœ€è¦åšçš„ä»…ä»…æ˜¯å…³æ³¨è¦æ‰§è¡Œçš„ SQL è¯­å¥ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº† Spring å¯¹æ•°æ®æŒä¹…åŒ–çš„æ”¯æŒï¼Œä»¥åŠ Spring ä¸º JDBC æ‰€æä¾›çš„åŸºäºæ¨¡æ¿çš„æŠ½è±¡ï¼Œå®ƒèƒ½å¤Ÿæå¤§åœ°ç®€åŒ– JDBC çš„ä½¿ç”¨ã€‚</p>
<p>åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šç»§ç»­ Spring æ•°æ®æŒä¹…åŒ–è¿™ä¸€è¯é¢˜ï¼Œå°†ä¼šå­¦ä¹  Spring ä¸º Java æŒä¹…åŒ– API æ‰€æä¾›çš„åŠŸèƒ½ã€‚</p>
<h2 id="ä½¿ç”¨å¯¹è±¡-å…³ç³»æ˜ å°„æŒä¹…åŒ–æ•°æ®"><a href="#ä½¿ç”¨å¯¹è±¡-å…³ç³»æ˜ å°„æŒä¹…åŒ–æ•°æ®" class="headerlink" title="ä½¿ç”¨å¯¹è±¡-å…³ç³»æ˜ å°„æŒä¹…åŒ–æ•°æ®"></a>ä½¿ç”¨å¯¹è±¡-å…³ç³»æ˜ å°„æŒä¹…åŒ–æ•°æ®</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>ä½¿ç”¨ Spring å’Œ Hibernate</li>
<li>å€ŸåŠ©ä¸Šä¸‹æ–‡ Sessionï¼Œç¼–å†™ä¸ä¾èµ–äº Spring çš„ Repository</li>
<li>é€šè¿‡ Spring ä½¿ç”¨ JPA</li>
<li>å€ŸåŠ© Spring Data å®ç°è‡ªåŠ¨åŒ–çš„ JPA Repository</li>
</ul>
<p>å°æ—¶å€™ï¼Œéª‘è‡ªè¡Œè½¦æ˜¯ä¸€ä»¶å¾ˆæœ‰è¶£çš„äº‹æƒ…ï¼Œå¯¹å§ï¼Ÿåœ¨æ¸…æ™¨ï¼Œæˆ‘ä»¬éª‘è½¦ä¸Šå­¦ã€‚æ”¾å­¦åï¼Œæˆ‘ä»¬æ¸¸é€›åˆ°æœ‹å‹å®¶ã€‚å½“å¤©è‰²æ¸æ™šä¹‹æ—¶ï¼Œåœ¨çˆ¶æ¯çš„å‘¼å–Šå£°ä¸­ï¼Œæˆ‘ä»¬éª‘è½¦å›å®¶ã€‚é‚£äº›æ—¥å­çœŸçš„å¾ˆæœ‰æ„æ€ï¼</p>
<p>åæ¥ï¼Œéšç€æ…¢æ…¢é•¿å¤§ï¼Œç°åœ¨æˆ‘ä»¬æ‰€éœ€è¦çš„ä¸ä»…ä»…æ˜¯ä¸€è¾†è‡ªè¡Œè½¦äº†ã€‚æœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦èµ°å¾ˆè¿œçš„è·¯å»ä¸Šç­æˆ–éœ€è¦è£…è½½ä¸€äº›ç”Ÿæ´»ç”¨å“ï¼Œè¿˜æœ‰å¯èƒ½æ¥é€å­©å­å»ä¸Šè¶³çƒè¯¾ã€‚å¦‚æœç”Ÿæ´»åœ¨å¾—å…‹è¨æ–¯å·çš„è¯ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»éœ€è¦ä¸€å°ç©ºè°ƒã€‚æˆ‘ä»¬çš„éœ€æ±‚è¶…å‡ºäº†è‡ªè¡Œè½¦çš„åŠŸèƒ½èŒƒå›´ã€‚</p>
<p>åœ¨æ•°æ®æŒä¹…åŒ–çš„ä¸–ç•Œä¸­ï¼ŒJDBC å°±åƒè‡ªè¡Œè½¦ã€‚å¯¹äºä»½å†…çš„å·¥ä½œï¼Œå®ƒèƒ½å¾ˆå¥½åœ°å®Œæˆå¹¶ä¸”åœ¨ä¸€äº›ç‰¹å®šçš„åœºæ™¯ä¸‹è¡¨ç°å‡ºè‰²ã€‚ä½†éšç€åº”ç”¨ç¨‹åºå˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œå¯¹æŒä¹…åŒ–çš„éœ€æ±‚ä¹Ÿå˜å¾—æ›´å¤æ‚ã€‚æˆ‘ä»¬éœ€è¦å°†å¯¹è±¡çš„å±æ€§æ˜ å°„åˆ°æ•°æ®åº“çš„åˆ—ä¸Šï¼Œå¹¶ä¸”éœ€è¦è‡ªåŠ¨ç”Ÿæˆè¯­å¥å’ŒæŸ¥è¯¢ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½ä»æ— ä¼‘æ­¢çš„é—®å·å­—ç¬¦ä¸²ä¸­è§£è„±å‡ºæ¥ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›æ›´å¤æ‚çš„ç‰¹æ€§ï¼š</p>
<ul>
<li>å»¶è¿ŸåŠ è½½ï¼ˆLazy loadingï¼‰ï¼šéšç€æˆ‘ä»¬çš„å¯¹è±¡å…³ç³»å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¹¶ä¸å¸Œæœ›ç«‹å³è·å–å®Œæ•´çš„å¯¹è±¡é—´å…³ç³»ã€‚ä¸¾ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬åœ¨æŸ¥è¯¢ä¸€ç»„ PurchaseOrder å¯¹è±¡ï¼Œè€Œæ¯ä¸ªå¯¹è±¡ä¸­éƒ½åŒ…å«ä¸€ä¸ª LineItem å¯¹è±¡é›†åˆã€‚å¦‚æœæˆ‘ä»¬åªå…³å¿ƒ PurchaseOrder çš„å±æ€§ï¼Œé‚£æŸ¥è¯¢å‡ºLineItemçš„æ•°æ®å°±æ¯«æ— æ„ä¹‰ã€‚è€Œä¸”è¿™å¯èƒ½æ˜¯å¼€é”€å¾ˆå¤§çš„æ“ä½œã€‚å»¶è¿ŸåŠ è½½å…è®¸æˆ‘ä»¬åªåœ¨éœ€è¦çš„æ—¶å€™è·å–æ•°æ®ã€‚</li>
<li>é¢„å…ˆæŠ“å–ï¼ˆEager fetchingï¼‰ï¼šè¿™ä¸å»¶è¿ŸåŠ è½½æ˜¯ç›¸å¯¹çš„ã€‚å€ŸåŠ©äºé¢„å…ˆæŠ“å–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæŸ¥è¯¢è·å–å®Œæ•´çš„å…³è”å¯¹è±¡ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦PurchaseOrderåŠå…¶å…³è”çš„LineItemå¯¹è±¡ï¼Œé¢„å…ˆæŠ“å–çš„åŠŸèƒ½å¯ä»¥åœ¨ä¸€ä¸ªæ“ä½œä¸­å°†å®ƒä»¬å…¨éƒ¨ä»æ•°æ®åº“ä¸­å–å‡ºæ¥ï¼ŒèŠ‚çœäº†å¤šæ¬¡æŸ¥è¯¢çš„æˆæœ¬ã€‚</li>
<li>çº§è”ï¼ˆCascadingï¼‰ï¼šæœ‰æ—¶ï¼Œæ›´æ”¹æ•°æ®åº“ä¸­çš„è¡¨ä¼šåŒæ—¶ä¿®æ”¹å…¶ä»–è¡¨ã€‚å›åˆ°æˆ‘ä»¬è®¢è´­å•çš„ä¾‹å­ä¸­ï¼Œå½“åˆ é™¤Orderå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›åŒæ—¶åœ¨æ•°æ®åº“ä¸­åˆ é™¤å…³è”çš„LineItemã€‚</li>
</ul>
<p>ä¸€äº›å¯ç”¨çš„æ¡†æ¶æä¾›äº†è¿™æ ·çš„æœåŠ¡ï¼Œè¿™äº›æœåŠ¡çš„é€šç”¨åç§°æ˜¯å¯¹è±¡/å…³ç³»æ˜ å°„ï¼ˆobject-relational mappingï¼ŒORMï¼‰ã€‚åœ¨æŒä¹…å±‚ä½¿ç”¨ORMå·¥å…·ï¼Œå¯ä»¥èŠ‚çœæ•°åƒè¡Œçš„ä»£ç å’Œå¤§é‡çš„å¼€å‘æ—¶é—´ã€‚ORMå·¥å…·èƒ½å¤ŸæŠŠä½ çš„æ³¨æ„åŠ›ä»å®¹æ˜“å‡ºé”™çš„SQLä»£ç è½¬å‘å¦‚ä½•å®ç°åº”ç”¨ç¨‹åºçš„çœŸæ­£éœ€æ±‚ã€‚</p>
<p>Spring å¯¹å¤šä¸ªæŒä¹…åŒ–æ¡†æ¶éƒ½æä¾›äº†æ”¯æŒï¼ŒåŒ…æ‹¬ Hibernateã€iBATISã€Java æ•°æ®å¯¹è±¡ï¼ˆJava Data Objectsï¼ŒJDOï¼‰ä»¥åŠ Java æŒä¹…åŒ–APIï¼ˆJava Persistence APIï¼ŒJPAï¼‰ã€‚ä¸ Spring å¯¹ JDBC çš„æ”¯æŒé‚£æ ·ï¼ŒSpring å¯¹ ORM æ¡†æ¶çš„æ”¯æŒæä¾›äº†ä¸è¿™äº›æ¡†æ¶çš„é›†æˆç‚¹ä»¥åŠä¸€äº›é™„åŠ çš„æœåŠ¡ï¼š</p>
<ul>
<li>æ”¯æŒé›†æˆ Spring å£°æ˜å¼äº‹åŠ¡ï¼›</li>
<li>é€æ˜çš„å¼‚å¸¸å¤„ç†ï¼›</li>
<li>çº¿ç¨‹å®‰å…¨çš„ã€è½»é‡çº§çš„æ¨¡æ¿ç±»ï¼›</li>
<li>DAO æ”¯æŒç±»ï¼›</li>
<li>èµ„æºç®¡ç†ã€‚</li>
</ul>
<p>æœ¬ç« æ²¡æœ‰è¶³å¤Ÿçš„ç¯‡å¹…ä»‹ç» Spring æ”¯æŒçš„å…¨éƒ¨ ORM æ¡†æ¶ã€‚å…¶å®è¿™å¹¶ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸º Spring å¯¹ä¸åŒ ORM è§£å†³æ–¹æ¡ˆçš„æ”¯æŒæ˜¯å¾ˆç›¸ä¼¼çš„ã€‚ä¸€æ—¦æŒæ¡äº† Spring å¯¹æŸç§ ORM æ¡†æ¶çš„æ”¯æŒåï¼Œä½ å¯ä»¥è½»æ¾åœ°åˆ‡æ¢åˆ°å¦ä¸€ä¸ªæ¡†æ¶ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ° Spring å¦‚ä½•ä¸æœ€å¸¸ç”¨çš„ä¸¤ç§ ORM æ–¹æ¡ˆé›†æˆï¼š</p>
<p>Hibernate å’Œ JPAã€‚åŒæ—¶è¿˜ä¼šé€šè¿‡ Spring Data JPA äº†è§£ä¸€ä¸‹ Spring Data é¡¹ç›®ã€‚å€ŸåŠ©è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥å­¦ä¹ åˆ°å¦‚ä½•å€ŸåŠ© Spring Data JPA ç§»é™¤ JPA  Repository ä¸­çš„æ ·æ¿å¼ä»£ç ï¼Œè¿˜èƒ½ä¸ºä¸‹ä¸€ç« çš„å¦‚ä½•å°† Spring Data ç”¨äºæ— æ¨¡å¼çš„å­˜å‚¨æ‰“ä¸‹åŸºç¡€ã€‚</p>
<p>è®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ Spring æ˜¯å¦‚ä½•ä¸º Hibernate æä¾›æ”¯æŒçš„ã€‚</p>
<h3 id="åœ¨-Spring-ä¸­é›†æˆ-Hibernate"><a href="#åœ¨-Spring-ä¸­é›†æˆ-Hibernate" class="headerlink" title="åœ¨  Spring  ä¸­é›†æˆ  Hibernate"></a>åœ¨  Spring  ä¸­é›†æˆ  Hibernate</h3><p>Hibernate æ˜¯åœ¨å¼€å‘è€…ç¤¾åŒºå¾ˆæµè¡Œçš„å¼€æºæŒä¹…åŒ–æ¡†æ¶ã€‚å®ƒä¸ä»…æä¾›äº†åŸºæœ¬çš„å¯¹è±¡å…³ç³»æ˜ å°„ï¼Œè¿˜æä¾›äº† ORM å·¥å…·æ‰€åº”å…·æœ‰çš„æ‰€æœ‰å¤æ‚åŠŸèƒ½ï¼Œæ¯”å¦‚ç¼“å­˜ã€å»¶è¿ŸåŠ è½½ã€é¢„å…ˆæŠ“å–ä»¥åŠåˆ†å¸ƒå¼ç¼“å­˜ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šå…³æ³¨ Spring å¦‚ä½•ä¸ Hibernate é›†æˆï¼Œè€Œä¸ä¼šæ¶‰åŠå¤ªå¤š Hibernate ä½¿ç”¨æ—¶çš„å¤æ‚ç»†èŠ‚ã€‚å¦‚æœä½ éœ€è¦äº†è§£æ›´å¤šå…³äº Hibernate å¦‚ä½•ä½¿ç”¨çš„çŸ¥è¯†ï¼Œæˆ‘æ¨èä½ é˜…è¯» Christian Bauerã€Gavin King å’Œ Gary Gregory æ’°å†™çš„ã€ŠJava Persistence with Hibernateï¼ŒSecond Editionã€‹ï¼ˆManningï¼Œ2014ï¼Œ<a target="_blank" rel="noopener" href="http://www.manning.com/bauer3/%EF%BC%89%E6%88%96%E8%AE%BF%E9%97%AE">www.manning.com/bauer3/ï¼‰æˆ–è®¿é—®</a> Hibernate çš„ç½‘ç«™ <a target="_blank" rel="noopener" href="http://www.hibernate.org./">http://www.hibernate.orgã€‚</a></p>
<h4 id="å£°æ˜-Hibernate-çš„-Session-å·¥å‚"><a href="#å£°æ˜-Hibernate-çš„-Session-å·¥å‚" class="headerlink" title="å£°æ˜ Hibernate çš„ Session å·¥å‚"></a>å£°æ˜ Hibernate çš„ Session å·¥å‚</h4><p>ä½¿ç”¨ Hibernate æ‰€éœ€çš„ä¸»è¦æ¥å£æ˜¯ org.hibernate.Sessionã€‚Session æ¥å£æä¾›äº†åŸºæœ¬çš„æ•°æ®è®¿é—®åŠŸèƒ½ï¼Œå¦‚ä¿å­˜ã€æ›´æ–°ã€åˆ é™¤ä»¥åŠä»æ•°æ®åº“åŠ è½½å¯¹è±¡çš„åŠŸèƒ½ã€‚é€šè¿‡<br>Hibernate çš„ Sessionæ¥å£ï¼Œåº”ç”¨ç¨‹åºçš„ Repository èƒ½å¤Ÿæ»¡è¶³æ‰€æœ‰çš„æŒä¹…åŒ–éœ€æ±‚ã€‚</p>
<p>è·å– Hibernate Session å¯¹è±¡çš„æ ‡å‡†æ–¹å¼æ˜¯å€ŸåŠ©äº HibernateSessionFactory æ¥å£çš„å®ç°ç±»ã€‚é™¤äº†ä¸€äº›å…¶ä»–çš„ä»»åŠ¡ï¼ŒSessionFactory ä¸»è¦è´Ÿè´£ Hibernate Sessionçš„æ‰“å¼€ã€å…³é—­ä»¥åŠç®¡ç†ã€‚</p>
<p>åœ¨ Spring ä¸­ï¼Œæˆ‘ä»¬è¦é€šè¿‡ Spring çš„æŸä¸€ä¸ª Hibernate Session å·¥å‚ bean æ¥è·å– Hibernate SessionFactoryã€‚ä» 3.1 ç‰ˆæœ¬å¼€å§‹ï¼ŒSpring æä¾›äº†ä¸‰ä¸ª Session å·¥å‚bean ä¾›æˆ‘ä»¬é€‰æ‹©ï¼š</p>
<ul>
<li>org.springframework.orm.hibernate3.LocalSessionFactoryBean</li>
<li>org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean</li>
<li>org.springframework.orm.hibernate4.LocalSessionFactoryBean</li>
</ul>
<p>è¿™äº› Session å·¥å‚ bean éƒ½æ˜¯ Spring FactoryBean æ¥å£çš„å®ç°ï¼Œå®ƒä»¬ä¼šäº§ç”Ÿä¸€ä¸ª HibernateSessionFactoryï¼Œå®ƒèƒ½å¤Ÿè£…é…è¿›ä»»ä½• SessionFactory ç±»å‹çš„å±æ€§ä¸­ã€‚è¿™æ ·çš„è¯ï¼Œå°±èƒ½åœ¨åº”ç”¨çš„ Spring ä¸Šä¸‹æ–‡ä¸­ï¼Œä¸å…¶ä»–çš„ bean ä¸€èµ·é…ç½® Hibernate Session å·¥å‚ã€‚</p>
<p>è‡³äºé€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ª Session å·¥å‚ï¼Œè¿™å–å†³äºä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„ Hibernate ä»¥åŠä½ ä½¿ç”¨ XML è¿˜æ˜¯ä½¿ç”¨æ³¨è§£æ¥å®šä¹‰å¯¹è±¡-æ•°æ®åº“ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚å¦‚æœä½ ä½¿ç”¨Hibernate 3.2 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆç›´åˆ° Hibernate 4.0ï¼Œä½†ä¸åŒ…å«è¿™ä¸ªç‰ˆæœ¬ï¼‰å¹¶ä¸”ä½¿ç”¨ XML å®šä¹‰æ˜ å°„çš„è¯ï¼Œé‚£ä¹ˆä½ éœ€è¦å®šä¹‰ Spring çš„ org.springframework.orm.hibernate3 åŒ…ä¸­çš„ LocalSessionFactoryBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">LocalSessionFactoryBean <span class="title">sessionFactory</span><span class="params">(DataSource dataSource)</span> </span>&#123;    LocalSessionFactoryBean sfb = <span class="keyword">new</span> LocalSessionFactoryBean();    sfb.setDataSource(dataSource);    sfb.setMappingResource(<span class="keyword">new</span> String[] &#123; <span class="string">&quot;Spitter.hbm.xml&quot;</span> &#125;);    Properties props = <span class="keyword">new</span> Properties();    props.setProperty(<span class="string">&quot;dialect&quot;</span>, <span class="string">&quot;org.hibernate.dialect.H2Dialect&quot;</span>);    sfb.setHebernateProperties(props);    <span class="keyword">return</span> sfb;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨é…ç½® LocalSessionFactoryBean æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸‰ä¸ªå±æ€§ã€‚å±æ€§ dataSource è£…é…äº†ä¸€ä¸ª DataSource bean çš„å¼•ç”¨ã€‚å±æ€§ mappingResources åˆ—å‡ºäº†ä¸€ä¸ªæˆ–å¤šä¸ªçš„ Hibernate æ˜ å°„æ–‡ä»¶ï¼Œåœ¨è¿™äº›æ–‡ä»¶ä¸­å®šä¹‰äº†åº”ç”¨ç¨‹åºçš„æŒä¹…åŒ–ç­–ç•¥ã€‚æœ€åï¼ŒhibernateProperties å±æ€§é…ç½®äº† Hibernate å¦‚ä½•è¿›è¡Œæ“ä½œçš„ç»†èŠ‚ã€‚åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é…ç½® Hibernate ä½¿ç”¨ H2 æ•°æ®åº“å¹¶ä¸”è¦æŒ‰ç…§ H2Dialect æ¥æ„å»º SQLã€‚</p>
<p>å¦‚æœä½ æ›´å€¾å‘äºä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥å®šä¹‰æŒä¹…åŒ–ï¼Œå¹¶ä¸”ä½ è¿˜æ²¡æœ‰ä½¿ç”¨ Hibernate 4 çš„è¯ï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨ AnnotationSessionFactoryBean æ¥ä»£æ›¿ LocalSessionFactoryBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">AnnotationSessionFactoryBean <span class="title">sessionFactory</span><span class="params">(DataSource ds)</span> </span>&#123;    AnnotationSessionFactoryBean sfb = <span class="keyword">new</span> AnnotationSessionFactoryBean();    sfb.setDataSource(ds);    sfb.setMappingResource(<span class="keyword">new</span> String[] &#123; <span class="string">&quot;Spitter.hbm.xml&quot;</span> &#125;);    Properties props = <span class="keyword">new</span> Properties();    props.setProperty(<span class="string">&quot;dialect&quot;</span>, <span class="string">&quot;org.hibernate.dialect.H2Dialect&quot;</span>);    sfb.setHebernateProperties(props);    <span class="keyword">return</span> sfb;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ ä½¿ç”¨ Hibernate 4 çš„è¯ï¼Œé‚£ä¹ˆå°±åº”è¯¥ä½¿ç”¨ org.springframework.orm.hibernate4 ä¸­çš„ LocalSessionFactoryBeanã€‚å°½ç®¡å®ƒä¸ Hibernate 3 åŒ…ä¸­çš„ LocalSessionFactoryBean ä½¿ç”¨äº†ç›¸åŒçš„åç§°ï¼Œä½†æ˜¯ Spring 3.1 æ–°å¼•å…¥çš„è¿™ä¸ª Session å·¥å‚ç±»ä¼¼äº Hibernate 3 ä¸­ LocalSessionFactoryBean å’Œ AnnotationSessionFactoryBean çš„ç»“åˆä½“ã€‚å®ƒæœ‰å¾ˆå¤šç›¸åŒçš„å±æ€§ï¼Œèƒ½å¤Ÿæ”¯æŒåŸºäº XML çš„æ˜ å°„å’ŒåŸºäºæ³¨è§£çš„æ˜ å°„ã€‚å¦‚ä¸‹çš„ä»£ç å±•ç°äº†å¦‚ä½•å¯¹å®ƒè¿›è¡Œé…ç½®ï¼Œä½¿å…¶æ”¯æŒåŸºäºæ³¨è§£çš„æ˜ å°„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">LocalSessionFactoryBean <span class="title">sessionFactory</span><span class="params">(DataSource dataSource)</span> </span>&#123;    LocalSessionFactoryBean sfb = <span class="keyword">new</span> LocalSessionFactoryBean();    sfb.setDataSource(dataSource);    sfb.setPackagesToScan(<span class="keyword">new</span> String[] &#123; <span class="string">&quot;com.habuma.spittr.domain&quot;</span> &#125;);    Properties props = <span class="keyword">new</span> Properties();    props.setProperty(<span class="string">&quot;dialect&quot;</span>, <span class="string">&quot;org.hibernate.dialect.H2Dialect&quot;</span>);    sfb.setHebernateProperties(props);    <span class="keyword">return</span> sfb;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸¤ä¸ªé…ç½®ä¸­ï¼ŒdataSource å’Œ hibernateProperties å±æ€§éƒ½å£°æ˜äº†ä»å“ªé‡Œè·å–æ•°æ®åº“è¿æ¥ä»¥åŠè¦ä½¿ç”¨å“ªä¸€ç§æ•°æ®åº“ã€‚è¿™é‡Œä¸å†åˆ—å‡º Hibernate é…ç½®æ–‡ä»¶ï¼Œè€Œæ˜¯ä½¿ç”¨ packagesToScan å±æ€§å‘Šè¯‰ Spring æ‰«æä¸€ä¸ªæˆ–å¤šä¸ªåŒ…ä»¥æŸ¥æ‰¾åŸŸç±»ï¼Œè¿™äº›ç±»é€šè¿‡æ³¨è§£çš„æ–¹å¼è¡¨æ˜è¦ä½¿ç”¨ Hibernate è¿›è¡ŒæŒä¹…åŒ–ï¼Œè¿™äº›ç±»å¯ä»¥ä½¿ç”¨çš„æ³¨è§£åŒ…æ‹¬ JPA çš„ @Entity æˆ– @MappedSuperclass ä»¥åŠ Hibernate çš„ @Entityã€‚</p>
<p>å¦‚æœæ„¿æ„çš„è¯ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ annotatedClasses å±æ€§æ¥å°†åº”ç”¨ç¨‹åºä¸­æ‰€æœ‰çš„æŒä¹…åŒ–ç±»ä»¥å…¨é™å®šåçš„æ–¹å¼æ˜ç¡®åˆ—å‡ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sfb.setAnnotationClasses(    <span class="keyword">new</span> Class&lt;?&gt;[] &#123; Spitter.class, Spittle.class &#125;);</span><br></pre></td></tr></table></figure>

<p>annotatedClasses å±æ€§å¯¹äºå‡†ç¡®æŒ‡å®šå°‘é‡çš„åŸŸç±»æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚å¦‚æœä½ æœ‰å¾ˆå¤šçš„åŸŸç±»å¹¶ä¸”ä¸æƒ³å°†å…¶å…¨éƒ¨åˆ—å‡ºï¼Œåˆæˆ–è€…ä½ æƒ³è‡ªç”±åœ°æ·»åŠ æˆ–ç§»é™¤åŸŸç±»è€Œä¸æƒ³ä¿®æ”¹ Spring é…ç½®çš„è¯ï¼Œé‚£ä½¿ç”¨ packagesToScan å±æ€§æ˜¯æ›´åˆé€‚çš„ã€‚</p>
<p>åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­é…ç½®å®Œ Hibernate çš„ Session å·¥å‚ bean åï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºè‡ªå·±çš„ Repository ç±»äº†ã€‚</p>
<h4 id="æ„å»ºä¸ä¾èµ–äº-Spring-çš„-Hibernate-ä»£ç "><a href="#æ„å»ºä¸ä¾èµ–äº-Spring-çš„-Hibernate-ä»£ç " class="headerlink" title="æ„å»ºä¸ä¾èµ–äº Spring çš„ Hibernate ä»£ç "></a>æ„å»ºä¸ä¾èµ–äº Spring çš„ Hibernate ä»£ç </h4><p>åœ¨ Spring å’Œ Hibernate çš„æ—©æœŸå²æœˆä¸­ï¼Œç¼–å†™ Repository ç±»å°†ä¼šæ¶‰åŠåˆ°ä½¿ç”¨ Spring çš„ HibernateTemplateã€‚HibernateTemplate èƒ½å¤Ÿä¿è¯æ¯ä¸ªäº‹åŠ¡ä½¿ç”¨åŒä¸€ä¸ª Sessionã€‚ä½†æ˜¯è¿™ç§æ–¹å¼çš„å¼Šç«¯åœ¨äºæˆ‘ä»¬çš„ Repository å®ç°ä¼šç›´æ¥ä¸ Spring è€¦åˆã€‚</p>
<p>ç°åœ¨çš„æœ€ä½³å®è·µæ˜¯ä¸å†ä½¿ç”¨ HibernateTemplateï¼Œè€Œæ˜¯ä½¿ç”¨ä¸Šä¸‹æ–‡ Sessionï¼ˆContextual sessionï¼‰ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¼šç›´æ¥å°† Hibernate SessionFactory è£…é…åˆ° Repository ä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥è·å– Sessionï¼Œå¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºã€‚</p>
<center>ç¨‹åºæ¸…å• 11.1ã€€å€ŸåŠ© Hibernate Session å®ç°ä¸ä¾èµ–äº Spring çš„ Repository</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Injectpublic</span> HibernateSpitterRepository(SessionFactory sessionFactory) &#123;    <span class="keyword">this</span>.sessionFactory = sessionFactory;&#125;<span class="function"><span class="keyword">private</span> Session <span class="title">currentSession</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> sessionFactory.getCurrentSession();&#125;	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">count</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> findAll().size();&#125;<span class="function"><span class="keyword">public</span> Spitter <span class="title">save</span><span class="params">(Spitter spitter)</span> </span>&#123;    Serializable id = currentSession().save(spitter);    <span class="keyword">return</span> <span class="keyword">new</span> Spitter((Long) id,                        spitter.getUsername(),                        spitter.getPassword(),                        spitter.getFullName(),                       spitter.getEmail(),                        spitter.isUpdateByEmail());&#125;<span class="function"><span class="keyword">public</span> Spitter <span class="title">findOne</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;    <span class="keyword">return</span> (Spitter) currentSession().get(Spitter.class, id); &#125;<span class="function"><span class="keyword">public</span> Spitter <span class="title">findByUsername</span><span class="params">(String username)</span> </span>&#123;    <span class="keyword">return</span> (Spitter) currentSession()         .createCriteria(Spitter.class)         .add(Restrictions.eq(<span class="string">&quot;username&quot;</span>, username))        .list().get(<span class="number">0</span>);&#125;<span class="function"><span class="keyword">public</span> List&lt;Spitter&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> (List&lt;Spitter&gt;) currentSession()         .createCriteria(Spitter.class).list(); &#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¨‹åºæ¸…å• 11.1 ä¸­æœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡ @Inject æ³¨è§£è®© Spring è‡ªåŠ¨å°†ä¸€ä¸ª SessionFactory æ³¨å…¥åˆ° HibernateSpitterRepository çš„ sessionFactory å±æ€§ä¸­ã€‚æ¥ä¸‹æ¥ï¼Œåœ¨ currentSession() æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ª SessionFactory æ¥è·å–å½“å‰äº‹åŠ¡çš„ Sessionã€‚</p>
<p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨ç±»ä¸Šä½¿ç”¨äº† @Repository æ³¨è§£ï¼Œè¿™ä¼šä¸ºæˆ‘ä»¬åšä¸¤ä»¶äº‹æƒ…ã€‚é¦–å…ˆï¼Œ@Repository æ˜¯ Spring çš„å¦ä¸€ç§æ„é€ æ€§æ³¨è§£ï¼Œå®ƒèƒ½å¤Ÿåƒå…¶ä»–æ³¨è§£ä¸€æ ·è¢« Spring çš„ç»„ä»¶æ‰«ææ‰€æ‰«æåˆ°ã€‚è¿™æ ·å°±ä¸å¿…æ˜ç¡®å£°æ˜ HibernateSpitterRepository bean äº†ï¼Œåªè¦è¿™ä¸ª Repository ç±»åœ¨ç»„ä»¶æ‰«ææ‰€æ¶µç›–çš„åŒ…ä¸­å³å¯ã€‚</p>
<p>é™¤äº†å¸®åŠ©å‡å°‘æ˜¾å¼é…ç½®ä»¥å¤–ï¼Œ@Repository è¿˜æœ‰å¦å¤–ä¸€ä¸ªç”¨å¤„ã€‚è®©æˆ‘ä»¬å›æƒ³ä¸€ä¸‹æ¨¡æ¿ç±»ï¼Œå®ƒæœ‰ä¸€é¡¹ä»»åŠ¡å°±æ˜¯æ•è·å¹³å°ç›¸å…³çš„å¼‚å¸¸ï¼Œç„¶åä½¿ç”¨ Spring ç»Ÿä¸€éæ£€æŸ¥å‹å¼‚å¸¸çš„å½¢å¼é‡æ–°æŠ›å‡ºã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ Hibernate ä¸Šä¸‹æ–‡ Session è€Œä¸æ˜¯ Hibernate æ¨¡æ¿çš„è¯ï¼Œé‚£å¼‚å¸¸è½¬æ¢ä¼šæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p>
<p>ä¸ºäº†ç»™ä¸ä½¿ç”¨æ¨¡æ¿çš„ Hibernate Repository æ·»åŠ å¼‚å¸¸è½¬æ¢åŠŸèƒ½ï¼Œæˆ‘ä»¬åªéœ€åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ·»åŠ ä¸€ä¸ª PersistenceExceptionTranslationPostProcessor beanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">BeanPostProcessor <span class="title">persistenceTranslation</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> PersistenceExceptionTranslationPostProcessor();&#125;</span><br></pre></td></tr></table></figure>

<p>PersistenceExceptionTranslationPostProcessor æ˜¯ä¸€ä¸ª bean åç½®å¤„ç†å™¨ï¼ˆbean post-processorï¼‰ï¼Œå®ƒä¼šåœ¨æ‰€æœ‰æ‹¥æœ‰ @Repository æ³¨è§£çš„ç±»ä¸Šæ·»åŠ ä¸€ä¸ªé€šçŸ¥å™¨ï¼ˆadvisorï¼‰ï¼Œè¿™æ ·å°±ä¼šæ•è·ä»»ä½•å¹³å°ç›¸å…³çš„å¼‚å¸¸å¹¶ä»¥ Spring éæ£€æŸ¥å‹æ•°æ®è®¿é—®å¼‚å¸¸çš„å½¢å¼é‡æ–°æŠ›å‡ºã€‚</p>
<p>ç°åœ¨ï¼ŒHibernate ç‰ˆæœ¬çš„ Repository å·²ç»å®Œæˆäº†ã€‚æˆ‘ä»¬å¼€å‘æ—¶ï¼Œæ²¡æœ‰ä¾èµ– Spring çš„ç‰¹å®šç±»ï¼ˆé™¤äº† @Repository æ³¨è§£ä»¥å¤–ï¼‰ã€‚è¿™ç§ä¸ä½¿ç”¨æ¨¡æ¿çš„æ–¹å¼ä¹Ÿé€‚ç”¨äºå¼€å‘çº¯ç²¹çš„åŸºäº JPA çš„ Repositoryï¼Œè®©æˆ‘ä»¬å†å°è¯•å¼€å‘å¦ä¸€ä¸ª SpitterRepository å®ç°ç±»ï¼Œè¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ JPAã€‚</p>
<h3 id="Spring-ä¸-Java-æŒä¹…åŒ–-API"><a href="#Spring-ä¸-Java-æŒä¹…åŒ–-API" class="headerlink" title="Spring  ä¸  Java  æŒä¹…åŒ– API"></a>Spring  ä¸  Java  æŒä¹…åŒ– API</h3><p>Java æŒä¹…åŒ– APIï¼ˆJava Persistence APIï¼ŒJPAï¼‰è¯ç”Ÿåœ¨ EJB 2 å®ä½“ Bean çš„åºŸå¢Ÿä¹‹ä¸Šï¼Œå¹¶æˆä¸ºä¸‹ä¸€ä»£ Java æŒä¹…åŒ–æ ‡å‡†ã€‚JPA æ˜¯åŸºäº POJO çš„æŒä¹…åŒ–æœºåˆ¶ï¼Œå®ƒä» Hibernate å’Œ Java æ•°æ®å¯¹è±¡ï¼ˆJava Data Objectï¼ŒJDOï¼‰ä¸Šå€Ÿé‰´äº†å¾ˆå¤šç†å¿µå¹¶åŠ å…¥äº† Java 5 æ³¨è§£çš„ç‰¹æ€§ã€‚</p>
<p>åœ¨ Spring 2.0 ç‰ˆæœ¬ä¸­ï¼ŒSpring é¦–æ¬¡é›†æˆäº† JPA çš„åŠŸèƒ½ã€‚å…·æœ‰è®½åˆºæ„å‘³çš„æ˜¯ï¼Œå¾ˆå¤šäººæ‰¹è¯„ï¼ˆæˆ–èµèµï¼‰Spring é¢ è¦†äº† EJBã€‚ä½†æ˜¯ï¼Œå½“ Spring æ”¯æŒ JPA åï¼Œå¾ˆå¤šå¼€å‘äººå‘˜éƒ½æ¨èåœ¨åŸºäº Spring çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ JPA å®ç°æŒä¹…åŒ–ã€‚å®é™…ä¸Šï¼Œæœ‰äº›äººè¿˜å°† Spring-JPA çš„ç»„åˆç§°ä¸º POJO å¼€å‘çš„æ¢¦ä¹‹é˜Ÿã€‚</p>
<p>åœ¨ Spring ä¸­ä½¿ç”¨ JPA çš„ç¬¬ä¸€æ­¥æ˜¯è¦åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­å°†å®ä½“ç®¡ç†å™¨å·¥å‚ï¼ˆentity manager factoryï¼‰æŒ‰ç…§ bean çš„å½¢å¼æ¥è¿›è¡Œé…ç½®ã€‚</p>
<h4 id="é…ç½®å®ä½“ç®¡ç†å™¨å·¥å‚"><a href="#é…ç½®å®ä½“ç®¡ç†å™¨å·¥å‚" class="headerlink" title="é…ç½®å®ä½“ç®¡ç†å™¨å·¥å‚"></a>é…ç½®å®ä½“ç®¡ç†å™¨å·¥å‚</h4><p>ç®€å•æ¥è®²ï¼ŒåŸºäº JPA çš„åº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨ EntityManagerFactory çš„å®ç°ç±»æ¥è·å– EntityManager å®ä¾‹ã€‚JPA å®šä¹‰äº†ä¸¤ç§ç±»å‹çš„å®ä½“ç®¡ç†å™¨ï¼š</p>
<ul>
<li><p>åº”ç”¨ç¨‹åºç®¡ç†ç±»å‹ï¼ˆApplication-managedï¼‰ï¼šå½“åº”ç”¨ç¨‹åºå‘å®ä½“ç®¡ç†å™¨å·¥å‚ç›´æ¥è¯·æ±‚å®ä½“ç®¡ç†å™¨æ—¶ï¼Œå·¥å‚ä¼šåˆ›å»ºä¸€ä¸ªå®ä½“ç®¡ç†å™¨ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œç¨‹åºè¦è´Ÿè´£æ‰“å¼€æˆ–å…³é—­å®ä½“ç®¡ç†å™¨å¹¶åœ¨äº‹åŠ¡ä¸­å¯¹å…¶è¿›è¡Œæ§åˆ¶ã€‚è¿™ç§æ–¹å¼çš„å®ä½“ç®¡ç†å™¨é€‚åˆäºä¸è¿è¡Œåœ¨ Java EE å®¹å™¨ä¸­çš„ç‹¬ç«‹åº”ç”¨ç¨‹åºã€‚</p>
</li>
<li><p>å®¹å™¨ç®¡ç†ç±»å‹ï¼ˆContainer-managedï¼‰ï¼šå®ä½“ç®¡ç†å™¨ç”± Java EE åˆ›å»ºå’Œç®¡ç†ã€‚åº”ç”¨ç¨‹åºæ ¹æœ¬ä¸ä¸å®ä½“ç®¡ç†å™¨å·¥å‚æ‰“äº¤é“ã€‚ç›¸åï¼Œå®ä½“ç®¡ç†å™¨ç›´æ¥é€šè¿‡æ³¨å…¥æˆ–JNDI æ¥è·å–ã€‚å®¹å™¨è´Ÿè´£é…ç½®å®ä½“ç®¡ç†å™¨å·¥å‚ã€‚è¿™ç§ç±»å‹çš„å®ä½“ç®¡ç†å™¨æœ€é€‚ç”¨äº Java EE å®¹å™¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¼šå¸Œæœ›åœ¨ persistence.xml æŒ‡å®šçš„ JPA é…ç½®ä¹‹å¤–ä¿æŒä¸€äº›è‡ªå·±å¯¹JPAçš„æ§åˆ¶ã€‚</p>
</li>
</ul>
<p>ä»¥ä¸Šçš„ä¸¤ç§å®ä½“ç®¡ç†å™¨å®ç°äº†åŒä¸€ä¸ª EntityManager æ¥å£ã€‚å…³é”®çš„åŒºåˆ«ä¸åœ¨äº EntityManager æœ¬èº«ï¼Œè€Œæ˜¯åœ¨äº EntityManager çš„åˆ›å»ºå’Œç®¡ç†æ–¹å¼ã€‚åº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„ EntityManager æ˜¯ç”± EntityManagerFactory åˆ›å»ºçš„ï¼Œè€Œåè€…æ˜¯é€šè¿‡ PersistenceProvider çš„ createEntityManagerFactory() æ–¹æ³•å¾—åˆ°çš„ã€‚ä¸æ­¤ç›¸å¯¹ï¼Œå®¹å™¨ç®¡ç†ç±»å‹çš„ EntityManagerFactory æ˜¯é€šè¿‡ PersistenceProvider çš„ createContainerEntityManagerFactory() æ–¹æ³•è·å¾—çš„ã€‚</p>
<p>è¿™å¯¹æƒ³ä½¿ç”¨ JPA çš„ Springå¼€å‘è€…æ¥è¯´åˆæ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿå…¶å®è¿™å¹¶æ²¡å¤ªå¤§çš„å…³ç³»ã€‚ä¸ç®¡ä½ å¸Œæœ›ä½¿ç”¨å“ªç§ EntityManagerFactoryï¼ŒSpring éƒ½ä¼šè´Ÿè´£ç®¡ç† EntityManagerã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯åº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„å®ä½“ç®¡ç†å™¨ï¼ŒSpringæ‰¿æ‹…äº†åº”ç”¨ç¨‹åºçš„è§’è‰²å¹¶ä»¥é€æ˜çš„æ–¹å¼å¤„ç† EntityManagerã€‚åœ¨å®¹å™¨ç®¡ç†çš„åœºæ™¯ä¸‹ï¼ŒSpring ä¼šæ‹…å½“å®¹å™¨çš„è§’è‰²ã€‚</p>
<p>è¿™ä¸¤ç§å®ä½“ç®¡ç†å™¨å·¥å‚åˆ†åˆ«ç”±å¯¹åº”çš„ Spring å·¥å‚ Bean åˆ›å»ºï¼š</p>
<ul>
<li>LocalEntityManagerFactoryBean ç”Ÿæˆåº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„ EntityManagerFactoryï¼›</li>
<li>LocalContainerEntityManagerFactoryBean ç”Ÿæˆå®¹å™¨ç®¡ç†ç±»å‹çš„ EntityManagerFactoryã€‚</li>
</ul>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œé€‰æ‹©åº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„è¿˜æ˜¯å®¹å™¨ç®¡ç†ç±»å‹çš„ EntityManagerFactoryï¼Œå¯¹äºåŸºäº Springçš„åº”ç”¨ç¨‹åºæ¥è®²æ˜¯å®Œå…¨é€æ˜çš„ã€‚å½“ç»„åˆä½¿ç”¨ Spring å’Œ JPA æ—¶ï¼Œå¤„ç† EntityManagerFactory çš„å¤æ‚ç»†èŠ‚è¢«éšè—äº†èµ·æ¥ï¼Œæ•°æ®è®¿é—®ä»£ç åªéœ€å…³æ³¨å®ƒä»¬çš„çœŸæ­£ç›®æ ‡å³å¯ï¼Œä¹Ÿå°±æ˜¯æ•°æ®è®¿é—®ã€‚</p>
<p>åº”ç”¨ç¨‹åºç®¡ç†ç±»å‹å’Œå®¹å™¨ç®¡ç†ç±»å‹çš„å®ä½“ç®¡ç†å™¨å·¥å‚ä¹‹é—´å”¯ä¸€å€¼å¾—å…³æ³¨çš„åŒºåˆ«æ˜¯åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­å¦‚ä½•è¿›è¡Œé…ç½®ã€‚è®©æˆ‘ä»¬å…ˆçœ‹çœ‹å¦‚ä½•åœ¨ Spring ä¸­é…ç½®åº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„ LocalEntityManagerFactoryBeanï¼Œç„¶åå†çœ‹çœ‹å¦‚ä½•é…ç½®å®¹å™¨ç®¡ç†ç±»å‹çš„ LocalContainerEntityManagerFactoryBeanã€‚</p>
<p>é…ç½®åº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„ JPA</p>
<p>å¯¹äºåº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„å®ä½“ç®¡ç†å™¨å·¥å‚æ¥è¯´ï¼Œå®ƒç»å¤§éƒ¨åˆ†é…ç½®ä¿¡æ¯æ¥æºäºä¸€ä¸ªåä¸º persistence.xml çš„é…ç½®æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å¿…é¡»ä½äºç±»è·¯å¾„ä¸‹çš„ META-INF ç›®å½•ä¸‹ã€‚</p>
<p>persistence.xml çš„ä½œç”¨åœ¨äºå®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªæŒä¹…åŒ–å•å…ƒã€‚æŒä¹…åŒ–å•å…ƒæ˜¯åŒä¸€ä¸ªæ•°æ®æºä¸‹çš„ä¸€ä¸ªæˆ–å¤šä¸ªæŒä¹…åŒ–ç±»ã€‚ç®€å•æ¥è®²ï¼Œpersistence.xml åˆ—å‡ºäº†ä¸€ä¸ªæˆ–å¤šä¸ªçš„æŒä¹…åŒ–ç±»ä»¥åŠä¸€äº›å…¶ä»–çš„é…ç½®å¦‚æ•°æ®æºå’ŒåŸºäºXMLçš„é…ç½®æ–‡ä»¶ã€‚å¦‚ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„ persistence.xml æ–‡ä»¶ï¼Œå®ƒæ˜¯ç”¨äº Spittr åº”ç”¨ç¨‹åºçš„ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">persistence</span> <span class="attr">version</span>=<span class="string">&quot;2.1&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/persistence&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">persistence-unit</span> <span class="attr">name</span>=<span class="string">&quot;spitterPU&quot;</span>&gt;</span>      <span class="tag">&lt;<span class="name">class</span>&gt;</span>com.habuma.spittr.domain.Spitter<span class="tag">&lt;/<span class="name">class</span>&gt;</span>      <span class="tag">&lt;<span class="name">class</span>&gt;</span>com.habuma.spittr.domain.Spittle<span class="tag">&lt;/<span class="name">class</span>&gt;</span>      <span class="tag">&lt;<span class="name">properties</span>&gt;</span>          <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;toplink.jdbc.driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.hsqldb.jdbcDriver&quot;</span> /&gt;</span>          <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;toplink.jdbc.url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:hsqldb:hsql://localhost/spitter/spitter&quot;</span> /&gt;</span>          <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;toplink.jdbc.user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sa&quot;</span> /&gt;</span>          <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;toplink.jdbc.password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> /&gt;</span>      <span class="tag">&lt;/<span class="name">properties</span>&gt;</span>    <span class="tag">&lt;/<span class="name">persistence-unit</span>&gt;</span><span class="tag">&lt;/<span class="name">persistence</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºåœ¨ persistence.xml æ–‡ä»¶ä¸­åŒ…å«äº†å¤§é‡çš„é…ç½®ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨ Spring ä¸­éœ€è¦é…ç½®çš„å°±å¾ˆå°‘äº†ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹çš„ @Bean æ³¨è§£æ–¹æ³•åœ¨ Spring ä¸­å£°æ˜ LocalEntityManagerFactoryBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">LocalEntityManagerFactoryBean <span class="title">entityManagerFactoryBean</span><span class="params">()</span> </span>&#123;    LocalEntityManagerFactoryBean emfb = <span class="keyword">new</span> LocalEntityManagerFactoryBean();    emfb.setPersistenceUnitName(<span class="string">&quot;spitterPU&quot;</span>);    <span class="keyword">return</span> emfb;&#125;</span><br></pre></td></tr></table></figure>

<p>èµ‹ç»™ persistenceUnitName å±æ€§çš„å€¼å°±æ˜¯ persistence.xml ä¸­æŒä¹…åŒ–å•å…ƒçš„åç§°ã€‚</p>
<p>åˆ›å»ºåº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„ EntityManagerFactory éƒ½æ˜¯åœ¨ persistence.xml ä¸­è¿›è¡Œçš„ï¼Œè€Œè¿™æ­£æ˜¯åº”ç”¨ç¨‹åºç®¡ç†çš„æœ¬æ„ã€‚åœ¨åº”ç”¨ç¨‹åºç®¡ç†çš„åœºæ™¯ä¸‹ï¼ˆä¸è€ƒè™‘ Springæ—¶ï¼‰ï¼Œå®Œå…¨ç”±åº”ç”¨ç¨‹åºæœ¬èº«æ¥è´Ÿè´£è·å– EntityManagerFactoryï¼Œè¿™æ˜¯é€šè¿‡ JPA å®ç°çš„ PersistenceProvider åšåˆ°çš„ã€‚å¦‚æœæ¯æ¬¡è¯·æ±‚ EntityManagerFactory æ—¶éƒ½éœ€è¦å®šä¹‰æŒä¹…åŒ–å•å…ƒï¼Œé‚£ä»£ç å°†ä¼šè¿…é€Ÿè†¨èƒ€ã€‚é€šè¿‡å°†å…¶é…ç½®åœ¨ persistence.xml ä¸­ï¼ŒJPA å°±èƒ½å¤Ÿåœ¨è¿™ä¸ªç‰¹å®šçš„ä½ç½®æŸ¥æ‰¾æŒä¹…åŒ–å•å…ƒå®šä¹‰äº†ã€‚</p>
<p>ä½†å€ŸåŠ©äº Spring å¯¹ JPA çš„æ”¯æŒï¼Œæˆ‘ä»¬ä¸å†éœ€è¦ç›´æ¥å¤„ç† PersistenceProvider äº†ã€‚å› æ­¤ï¼Œå†å°†é…ç½®ä¿¡æ¯æ”¾åœ¨ persistence.xml ä¸­å°±æ˜¾å¾—ä¸é‚£ä¹ˆæ˜æ™ºäº†ã€‚å®é™…ä¸Šï¼Œè¿™æ ·åšå¦¨ç¢äº†æˆ‘ä»¬åœ¨ Spring ä¸­é…ç½® EntityManagerFactoryï¼ˆå¦‚æœä¸æ˜¯è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ª Spring é…ç½®çš„æ•°æ®æºï¼‰ã€‚</p>
<p>é‰´äºä»¥ä¸Šçš„åŸå› ï¼Œè®©æˆ‘ä»¬å…³æ³¨ä¸€ä¸‹å®¹å™¨ç®¡ç†çš„ JPAï¼š</p>
<p>ä½¿ç”¨å®¹å™¨ç®¡ç†ç±»å‹çš„ JPA</p>
<p>å®¹å™¨ç®¡ç†çš„ JPA é‡‡å–äº†ä¸€ä¸ªä¸åŒçš„æ–¹å¼ã€‚å½“è¿è¡Œåœ¨å®¹å™¨ä¸­æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®¹å™¨ï¼ˆåœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸‹æ˜¯ Springï¼‰æä¾›çš„ä¿¡æ¯æ¥ç”Ÿæˆ EntityManagerFactoryã€‚</p>
<p>ä½ å¯ä»¥å°†æ•°æ®æºä¿¡æ¯é…ç½®åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œè€Œä¸æ˜¯åœ¨ persistence.xmlä¸­äº†ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„ @Bean æ³¨è§£æ–¹æ³•å£°æ˜äº†åœ¨ Spring ä¸­å¦‚ä½•ä½¿ç”¨ LocalContainerEntityManagerFactoryBean æ¥é…ç½®å®¹å™¨ç®¡ç†ç±»å‹çš„ JPAï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">LocalContainerEntityManagerFactoryBean <span class="title">entityManagerFactory</span><span class="params">(DataSource dataSource,                                                                    JpaVendorAdapter jpaVendorAdapter)</span> </span>&#123;    LocalContainerEntityManagerFactoryBean emfb = <span class="keyword">new</span> LocalContainerEntityManagerFactoryBean();    emfb.setDataSource(dataSource);    emfb.setJpaVendorAdapter(jpaVendorAdapter);    <span class="keyword">return</span> emfb;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Spring é…ç½®çš„æ•°æ®æºæ¥è®¾ç½® dataSource å±æ€§ã€‚ä»»ä½• javax.sql.DataSource çš„å®ç°éƒ½æ˜¯å¯ä»¥çš„ã€‚å°½ç®¡æ•°æ®æºè¿˜å¯ä»¥åœ¨ persistence.xml ä¸­è¿›è¡Œé…ç½®ï¼Œä½†æ˜¯è¿™ä¸ªå±æ€§æŒ‡å®šçš„æ•°æ®æºå…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚</p>
<p>jpaVendorAdapter å±æ€§ç”¨äºæŒ‡æ˜æ‰€ä½¿ç”¨çš„æ˜¯å“ªä¸€ä¸ªå‚å•†çš„ JPA å®ç°ã€‚Spring æä¾›äº†å¤šä¸ª JPA å‚å•†é€‚é…å™¨ï¼š</p>
<ul>
<li>EclipseLinkJpaVendorAdapter</li>
<li>HibernateJpaVendorAdapter</li>
<li>OpenJpaVendorAdapter</li>
<li>TopLinkJpaVendorAdapterï¼ˆåœ¨ Spring 3.1 ç‰ˆæœ¬ä¸­ï¼Œå·²ç»å°†å…¶åºŸå¼ƒäº†ï¼‰</li>
</ul>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Hibernate ä½œä¸º JPA å®ç°ï¼Œæ‰€ä»¥å°†å…¶é…ç½® ä¸ºHibernateJpaVendorAdapterï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">JpaVendorAdapter <span class="title">jpaVendorAdapter</span><span class="params">()</span> </span>&#123;    HibernateJpaVendorAdapter adapter = <span class="keyword">new</span> HibernateJpaVendorAdapter();    adapter.setDatabase(<span class="string">&quot;HSQL&quot;</span>);    adapter.setShowSql(<span class="keyword">true</span>);    adapter.setGenerateDdl(<span class="keyword">false</span>);    adapter.setDatabasePlatform(<span class="string">&quot;org.hibernet.dialect.HSQLDialect&quot;</span>);    <span class="keyword">return</span> adapter;&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰å¤šä¸ªå±æ€§éœ€è¦è®¾ç½®åˆ°å‚å•†é€‚é…å™¨ä¸Šï¼Œä½†æ˜¯æœ€é‡è¦çš„æ˜¯ database å±æ€§ï¼Œåœ¨ä¸Šé¢æˆ‘ä»¬è®¾ç½®äº†è¦ä½¿ç”¨çš„æ•°æ®åº“æ˜¯ Hypersonicã€‚è¿™ä¸ªå±æ€§æ”¯æŒçš„å…¶ä»–å€¼å¦‚è¡¨ 11.1 æ‰€ç¤ºã€‚</p>
<center>è¡¨ 11.1ã€€Hibernate çš„ JPA é€‚é…å™¨æ”¯æŒå¤šç§æ•°æ®åº“ï¼Œå¯ä»¥é€šè¿‡å…¶ database å±æ€§é…ç½®ä½¿ç”¨å“ªä¸ªæ•°æ®åº“</center>

<table>
<thead>
<tr>
<th>æ•°æ®åº“å¹³å°</th>
<th>å±æ€§databaseçš„å€¼</th>
</tr>
</thead>
<tbody><tr>
<td>IBM DB2</td>
<td>DB2</td>
</tr>
<tr>
<td>Apache Derby</td>
<td>DERBY</td>
</tr>
<tr>
<td>H2</td>
<td>H2</td>
</tr>
<tr>
<td>Hypersonic</td>
<td>HSQL</td>
</tr>
<tr>
<td>Informix</td>
<td>INFORMIX</td>
</tr>
<tr>
<td>MySQL</td>
<td>MYSQL</td>
</tr>
<tr>
<td>Oracle</td>
<td>ORACLE</td>
</tr>
<tr>
<td>PostgresQL</td>
<td>POSTGRESQL</td>
</tr>
<tr>
<td>Microsoft SQL Server</td>
<td>SQLSERVER</td>
</tr>
<tr>
<td>Sybase</td>
<td>SYBASE</td>
</tr>
</tbody></table>
<p> ä¸€äº›ç‰¹å®šçš„åŠ¨æ€æŒä¹…åŒ–åŠŸèƒ½éœ€è¦å¯¹æŒä¹…åŒ–ç±»æŒ‰ç…§æŒ‡ä»¤ï¼ˆinstrumentationï¼‰è¿›è¡Œä¿®æ”¹æ‰èƒ½æ”¯æŒã€‚åœ¨å±æ€§å»¶è¿ŸåŠ è½½ï¼ˆåªåœ¨å®ƒä»¬è¢«å®é™…è®¿é—®æ—¶æ‰ä»æ•°æ®åº“ä¸­è·å–ï¼‰çš„å¯¹è±¡ä¸­ï¼Œå¿…é¡»è¦åŒ…å«çŸ¥é“å¦‚ä½•æŸ¥è¯¢æœªåŠ è½½æ•°æ®çš„ä»£ç ã€‚ä¸€äº›æ¡†æ¶ä½¿ç”¨åŠ¨æ€ä»£ç†å®ç°å»¶è¿ŸåŠ è½½ï¼Œè€Œæœ‰ä¸€äº›æ¡†æ¶åƒ JDOï¼Œåˆ™æ˜¯åœ¨ç¼–è¯‘æ—¶æ‰§è¡Œç±»æŒ‡ä»¤ã€‚</p>
<p>é€‰æ‹©å“ªä¸€ç§å®ä½“ç®¡ç†å™¨å·¥å‚ä¸»è¦å–å†³äºå¦‚ä½•ä½¿ç”¨å®ƒã€‚ä½†æ˜¯ï¼Œä¸‹é¢çš„å°æŠ€å·§å¯èƒ½ä¼šè®©ä½ æ›´åŠ å€¾å‘äºä½¿ç”¨ LocalContainerEntityManagerFactoryBeanã€‚</p>
<p>persistence.xml æ–‡ä»¶çš„ä¸»è¦ä½œç”¨å°±åœ¨äºè¯†åˆ«æŒä¹…åŒ–å•å…ƒä¸­çš„å®ä½“ç±»ã€‚ä½†æ˜¯ä» Spring 3.1 å¼€å§‹ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨ LocalContainerEntityManagerFactoryBean ä¸­ç›´æ¥è®¾<br>ç½® packagesToScan å±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">LocalContainerEntityManagerFactoryBean <span class="title">entityManagerFactory</span><span class="params">(DataSource dataSource,                                                                   JpaVendorAdapter jpaVendorAdapter)</span> </span>&#123;    LocalContainerEntityManagerFactoryBean emfb = <span class="keyword">new</span> LocalContainerEntityManagerFactoryBean();    emfb.setDataSource(dataSource);    emfb.setJpaVendorAdapter(jpaVendorAdapter);    emfb.setPackagesToScan(<span class="string">&quot;com.habuma.spittr.domain&quot;</span>);    <span class="keyword">return</span> emfb;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªé…ç½®ä¸­ï¼ŒLocalContainerEntityManagerFactoryBean ä¼šæ‰«æ com.habuma.spittr.domain åŒ…ï¼ŒæŸ¥æ‰¾å¸¦æœ‰ @Entity æ³¨è§£çš„ç±»ã€‚å› æ­¤ï¼Œæ²¡æœ‰å¿…è¦åœ¨ persistence.xml æ–‡ä»¶ä¸­è¿›è¡Œå£°æ˜äº†ã€‚åŒæ—¶ï¼Œå› ä¸º DataSource ä¹Ÿæ˜¯æ³¨å…¥åˆ° LocalContainerEntityManagerFactoryBean ä¸­çš„ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰å¿…è¦åœ¨ persistence.xml æ–‡ä»¶ä¸­é…ç½®æ•°æ®åº“ä¿¡æ¯äº†ã€‚é‚£ä¹ˆç»“è®ºå°±æ˜¯ï¼Œpersistence.xml æ–‡ä»¶å®Œå…¨æ²¡æœ‰å¿…è¦å­˜åœ¨äº†ï¼ä½ å°½å¯ä»¥å°†å…¶åˆ é™¤ï¼Œè®© LocalContainerEntityManagerFactoryBean æ¥å¤„ç†è¿™äº›äº‹æƒ…ã€‚</p>
<p>ä» JNDI è·å–å®ä½“ç®¡ç†å™¨å·¥å‚</p>
<p>è¿˜æœ‰ä¸€ä»¶éœ€è¦æ³¨æ„çš„äº‹é¡¹ï¼Œå¦‚æœå°† Spring åº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨åº”ç”¨æœåŠ¡å™¨ä¸­ï¼ŒEntityManagerFactory å¯èƒ½å·²ç»åˆ›å»ºå¥½äº†å¹¶ä¸”ä½äº JNDI ä¸­ç­‰å¾…æŸ¥è¯¢ä½¿ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ Spring jee å‘½åç©ºé—´ä¸‹çš„ <code>&lt;jee:jndi-lookup&gt;</code> å…ƒç´ æ¥è·å–å¯¹ EntityManagerFactory çš„å¼•ç”¨ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jee:jndi-lookup</span> <span class="attr">id</span>=<span class="string">&quot;emf&quot;</span> <span class="attr">jndi-name</span>=<span class="string">&quot;persistence/spitterPU&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„ Java é…ç½®æ¥è·å– EntityManagerFactoryï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">JndiObjectFactoryBean <span class="title">entityManagerFactory</span><span class="params">()</span> </span>&#123;    JndiObjectFactoryBean jndiObjectFB = <span class="keyword">new</span> JndiObjectFactoryBean();    jndiObjectFB.setJndiName(<span class="string">&quot;jdbc/SpittrDS&quot;</span>);    <span class="keyword">return</span> jndiObjectFB;&#125;</span><br></pre></td></tr></table></figure>

<p>å°½ç®¡è¿™ç§æ–¹æ³•æ²¡æœ‰è¿”å› EntityManagerFactoryï¼Œä½†æ˜¯å®ƒçš„ç»“æœå°±æ˜¯ä¸€ä¸ª EntityManagerFactory beanã€‚è¿™æ˜¯å› ä¸ºå®ƒæ‰€è¿”å›çš„ JndiObjectFactoryBean æ˜¯ FactoryBean æ¥å£çš„å®ç°ï¼Œå®ƒèƒ½å¤Ÿåˆ›å»º EntityManagerFactoryã€‚</p>
<p>ä¸ç®¡ä½ é‡‡ç”¨ä½•ç§æ–¹å¼å¾—åˆ° EntityManagerFactoryï¼Œä¸€æ—¦å¾—åˆ°è¿™æ ·çš„å¯¹è±¡ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ç¼–å†™ Repository äº†ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ã€‚</p>
<h4 id="ç¼–å†™åŸºäº-JPA-çš„-Repository"><a href="#ç¼–å†™åŸºäº-JPA-çš„-Repository" class="headerlink" title="ç¼–å†™åŸºäº JPA çš„ Repository"></a>ç¼–å†™åŸºäº JPA çš„ Repository</h4><p>æ­£å¦‚ Spring å¯¹å…¶ä»–æŒä¹…åŒ–æ–¹æ¡ˆçš„é›†æˆä¸€æ ·ï¼ŒSpring å¯¹ JPA é›†æˆä¹Ÿæä¾›äº† JpaTemplate æ¨¡æ¿ä»¥åŠå¯¹åº”çš„æ”¯æŒç±» JpaDaoSupportã€‚ä½†æ˜¯ï¼Œä¸ºäº†å®ç°æ›´çº¯ç²¹çš„ JPA æ–¹å¼ï¼ŒåŸºäºæ¨¡æ¿çš„ JPA å·²ç»è¢«å¼ƒç”¨äº†ã€‚è¿™ä¸æˆ‘ä»¬åœ¨ 11.1.2 å°èŠ‚ä½¿ç”¨çš„ Hibernate ä¸Šä¸‹æ–‡ Sessionæ˜¯å¾ˆç±»ä¼¼çš„ã€‚</p>
<p>é‰´äºçº¯ç²¹çš„ JPA æ–¹å¼è¿œèƒœäºåŸºäºæ¨¡æ¿çš„ JPAï¼Œæ‰€ä»¥åœ¨æœ¬èŠ‚ä¸­æˆ‘ä»¬å°†ä¼šé‡ç‚¹å…³æ³¨å¦‚ä½•æ„å»ºä¸ä¾èµ– Spring çš„ JPA Repositoryã€‚å¦‚ä¸‹ç¨‹åºæ¸…å•ä¸­çš„ JpaSpitterRepository å±•ç°äº†å¦‚ä½•å¼€å‘ä¸ä½¿ç”¨ Spring JpaTemplate çš„ JPA Repositoryã€‚</p>
<center>ç¨‹åºæ¸…å• 11.2ã€€ä¸ä½¿ç”¨ Spring æ¨¡æ¿çš„çº¯ JPA Repository</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.persistence;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> javax.persistence.EntityManagerFactory;<span class="keyword">import</span> javax.persistence.PersistenceUnit;<span class="keyword">import</span> org.springframework.dao.DataAccessException;<span class="keyword">import</span> org.springframework.stereotype.Repository;<span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;<span class="keyword">import</span> com.habuma.spittr.domain.Spitter;<span class="keyword">import</span> com.habuma.spittr.domain.Spittle;<span class="meta">@Repository</span><span class="meta">@Transactionalpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaSpitterRepository</span> <span class="keyword">implements</span> <span class="title">SpitterRepository</span> </span>&#123;    <span class="meta">@PersistenceUnit</span>    <span class="keyword">private</span> EntityManagerFactory emf;        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;        emf.createEntityManager().persist(spitter);    &#125;        <span class="function"><span class="keyword">public</span> Spitter <span class="title">getSpitterById</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;        <span class="keyword">return</span> emf.createEntityManager().find(Spitter.class, id);    &#125;      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;            emf.createEntityManager().merge(spitter);    &#125;    ...&#125;</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºæ¸…å• 11.2 ä¸­ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ EntityManagerFactory å±æ€§ï¼Œå®ƒä½¿ç”¨äº† @PersistenceUnit æ³¨è§£ï¼Œå› æ­¤ï¼ŒSpring ä¼šå°† EntityManagerFactory æ³¨å…¥åˆ° Repository ä¹‹ä¸­ã€‚æœ‰äº† EntityManagerFactory ä¹‹åï¼ŒJpaSpitterRepository çš„æ–¹æ³•å°±èƒ½ä½¿ç”¨å®ƒæ¥åˆ›å»º EntityManager äº†ï¼Œç„¶å EntityManager å¯ä»¥é’ˆå¯¹æ•°æ®åº“æ‰§è¡Œæ“ä½œã€‚</p>
<p>åœ¨ JpaSpitterRepository ä¸­ï¼Œå”¯ä¸€çš„é—®é¢˜åœ¨äºæ¯ä¸ªæ–¹æ³•éƒ½ä¼šè°ƒç”¨ createEntityManager()ã€‚é™¤äº†å¼•å…¥æ˜“å‡ºé”™çš„é‡å¤ä»£ç ä»¥å¤–ï¼Œè¿™è¿˜æ„å‘³ç€æ¯æ¬¡è°ƒç”¨ Repository çš„æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ EntityManagerã€‚è¿™ç§å¤æ‚æ€§æºäºäº‹åŠ¡ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿé¢„å…ˆå‡†å¤‡å¥½ EntityManagerï¼Œé‚£ä¼šä¸ä¼šæ›´åŠ æ–¹ä¾¿å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œçš„é—®é¢˜åœ¨äº EntityManager å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸€èˆ¬æ¥è®²å¹¶ä¸é€‚åˆæ³¨å…¥åˆ°åƒ Repository è¿™æ ·å…±äº«çš„å•ä¾‹beanä¸­ã€‚ä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬æ²¡æœ‰åŠæ³•è¦æ±‚æ³¨å…¥ EntityManagerã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¦‚ä½•å€ŸåŠ© @PersistentContext æ³¨è§£ä¸º JpaSpitterRepository è®¾ç½® EntityManagerã€‚</p>
<center>ç¨‹åºæ¸…å• 11.3ã€€å°† EntityManager çš„ä»£ç†æ³¨å…¥åˆ° Repository ä¹‹ä¸­</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.persistence;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> javax.persistence.EntityManager;<span class="keyword">import</span> javax.persistence.PersistenceContext;<span class="keyword">import</span> org.springframework.dao.DataAccessException;<span class="keyword">import</span> org.springframework.stereotype.Repository;<span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;<span class="keyword">import</span> com.habuma.spittr.domain.Spitter;<span class="keyword">import</span> com.habuma.spittr.domain.Spittle;<span class="meta">@Repository</span><span class="meta">@Transactionalpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaSpitterRepository</span> <span class="keyword">implements</span> <span class="title">SpitterRepository</span> </span>&#123;    <span class="meta">@PersistenceContext</span>    <span class="keyword">private</span> EntityManager em;        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;        em.persist(spitter);    &#125;        <span class="function"><span class="keyword">public</span> Spitter <span class="title">getSpitterById</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;        <span class="keyword">return</span> em.find(Spitter.class, id);    &#125;        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;        em.merge(spitter);      &#125;    ...&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªæ–°ç‰ˆæœ¬çš„ JpaSpitterRepository ä¸­ï¼Œç›´æ¥ä¸ºå…¶è®¾ç½®äº† EntityManagerï¼Œè¿™æ ·çš„è¯ï¼Œåœ¨æ¯ä¸ªæ–¹æ³•ä¸­å°±æ²¡æœ‰å¿…è¦å†é€šè¿‡ EntityManagerFactory åˆ›å»º EntityManager äº†ã€‚å°½ç®¡è¿™ç§æ–¹å¼éå¸¸ä¾¿åˆ©ï¼Œä½†æ˜¯ä½ å¯èƒ½ä¼šæ‹…å¿ƒæ³¨å…¥çš„ EntityManager ä¼šæœ‰çº¿ç¨‹å®‰å…¨æ€§çš„é—®é¢˜ã€‚</p>
<p>è¿™é‡Œçš„çœŸç›¸æ˜¯ @PersistenceContext å¹¶ä¸ä¼šçœŸæ­£æ³¨å…¥ EntityManagerâ€”â€”è‡³å°‘ï¼Œç²¾ç¡®æ¥è®²ä¸æ˜¯è¿™æ ·çš„ã€‚å®ƒæ²¡æœ‰å°†çœŸæ­£çš„ EntityManager è®¾ç½®ç»™ Repositoryï¼Œè€Œæ˜¯ç»™äº†å®ƒä¸€ä¸ª EntityManager çš„ä»£ç†ã€‚çœŸæ­£çš„ EntityManager æ˜¯ä¸å½“å‰äº‹åŠ¡ç›¸å…³è”çš„é‚£ä¸€ä¸ªï¼Œå¦‚æœä¸å­˜åœ¨è¿™æ ·çš„ EntityManager çš„è¯ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±èƒ½å§‹ç»ˆä»¥çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ä½¿ç”¨å®ä½“ç®¡ç†å™¨ã€‚</p>
<p>å¦å¤–ï¼Œè¿˜éœ€è¦äº†è§£ @PersistenceUnit å’Œ @PersistenceContext å¹¶ä¸æ˜¯ Spring çš„æ³¨è§£ï¼Œå®ƒä»¬æ˜¯ç”± JPA è§„èŒƒæä¾›çš„ã€‚ä¸ºäº†è®© Spring ç†è§£è¿™äº›æ³¨è§£ï¼Œå¹¶æ³¨å…¥ EntityManager Factory æˆ– EntityManagerï¼Œæˆ‘ä»¬å¿…é¡»è¦é…ç½® Spring çš„ PersistenceAnnotationBeanPostProcessorã€‚å¦‚æœä½ å·²ç»ä½¿ç”¨äº†<code>&lt;context:annotationconfig&gt;</code> æˆ– <code>&lt;context:componentscan&gt;</code>ï¼Œé‚£ä¹ˆä½ å°±ä¸å¿…å†æ‹…å¿ƒäº†ï¼Œå› ä¸ºè¿™äº›é…ç½®å…ƒç´ ä¼šè‡ªåŠ¨æ³¨å†Œ PersistenceAnnotationBeanPostProcessor beanã€‚å¦åˆ™çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦æ˜¾å¼åœ°æ³¨å†Œè¿™ä¸ª beanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">PersistenceAnnotationBeanPostProcessor <span class="title">paPostProcessor</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> PersistenceAnnotationBeanPostProcessor();&#125;</span><br></pre></td></tr></table></figure>

<p>ä½ å¯èƒ½ä¹Ÿæ³¨æ„åˆ°äº† JpaSpitterRepository ä½¿ç”¨äº† @Repository å’Œ @Transactional æ³¨è§£ã€‚@Transactional è¡¨æ˜è¿™ä¸ªRepositoryä¸­çš„æŒä¹…åŒ–æ–¹æ³•æ˜¯åœ¨äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œçš„ã€‚</p>
<p>å¯¹äº @Repository æ³¨è§£ï¼Œå®ƒçš„ä½œç”¨ä¸å¼€å‘ Hibernate ä¸Šä¸‹æ–‡ Session ç‰ˆæœ¬çš„ Repository æ—¶æ˜¯ä¸€è‡´çš„ã€‚ç”±äºæ²¡æœ‰ä½¿ç”¨æ¨¡æ¿ç±»æ¥å¤„ç†å¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸º Repository æ·»åŠ  @Repository æ³¨è§£ï¼Œè¿™æ · PersistenceExceptionTranslationPostProcessor å°±ä¼šçŸ¥é“è¦å°†è¿™ä¸ª bean äº§ç”Ÿçš„å¼‚å¸¸è½¬æ¢æˆ Spring çš„ç»Ÿä¸€æ•°æ®è®¿é—®å¼‚å¸¸ã€‚</p>
<p>æ—¢ç„¶æåˆ°äº† PersistenceExceptionTranslationPostProcessorï¼Œè¦è®°ä½çš„æ˜¯æˆ‘ä»¬éœ€è¦å°†å…¶ä½œä¸ºä¸€ä¸ª bean è£…é…åˆ° Spring ä¸­ï¼Œå°±åƒæˆ‘ä»¬åœ¨ Hibernate æ ·ä¾‹ä¸­æ‰€åšçš„é‚£æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">BeanPostProcessor <span class="title">persistenceTranslation</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> PersistenceExceptionTranslationPostProcessor();&#125;</span><br></pre></td></tr></table></figure>

<p>æé†’ä¸€ä¸‹ï¼Œä¸ç®¡å¯¹äº JPA è¿˜æ˜¯ Hibernateï¼Œå¼‚å¸¸è½¬æ¢éƒ½ä¸æ˜¯å¼ºåˆ¶è¦æ±‚çš„ã€‚å¦‚æœä½ å¸Œæœ›åœ¨ Repositoryä¸­æŠ›å‡ºç‰¹å®šçš„ JPA æˆ– Hibernate å¼‚å¸¸ï¼Œåªéœ€å°† PersistenceExceptionTranslationPostProcessor çœç•¥æ‰å³å¯ï¼Œè¿™æ ·åŸæ¥çš„å¼‚å¸¸å°±ä¼šæ­£å¸¸åœ°å¤„ç†ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨äº† Spring çš„å¼‚å¸¸è½¬æ¢ï¼Œä½ ä¼šå°†æ‰€æœ‰çš„æ•°æ®è®¿é—®å¼‚å¸¸ç½®äº Spring çš„ä½“ç³»ä¹‹ä¸‹ï¼Œè¿™æ ·ä»¥ååˆ‡æ¢æŒä¹…åŒ–æœºåˆ¶çš„è¯ä¼šæ›´å®¹æ˜“ã€‚</p>
<h3 id="å€ŸåŠ©-Spring-Data-å®ç°è‡ªåŠ¨åŒ–çš„-JPA-Repository"><a href="#å€ŸåŠ©-Spring-Data-å®ç°è‡ªåŠ¨åŒ–çš„-JPA-Repository" class="headerlink" title="å€ŸåŠ©  Spring Data  å®ç°è‡ªåŠ¨åŒ–çš„  JPA Repository"></a>å€ŸåŠ©  Spring Data  å®ç°è‡ªåŠ¨åŒ–çš„  JPA Repository</h3><p>å°½ç®¡ç¨‹åºæ¸…å• 11.2 å’Œ 11.3 ç¨‹åºæ¸…å•ä¸­çš„æ–¹æ³•éƒ½å¾ˆç®€å•ï¼Œä½†å®ƒä»¬ä¾ç„¶è¿˜ä¼šç›´æ¥ä¸ EntityManager äº¤äº’æ¥æŸ¥è¯¢æ•°æ®åº“ã€‚å¹¶ä¸”ï¼Œä»”ç»†çœ‹ä¸€ä¸‹çš„è¯ï¼Œè¿™äº›ä»£ç å¤šå°‘è¿˜æ˜¯æ ·æ¿å¼çš„ã€‚ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬é‡æ–°å®¡è§† addSpitter() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;    entityManger.persist(spitter);&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä»»ä½•å…·æœ‰ä¸€å®šè§„æ¨¡çš„åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¼šä»¥å‡ ä¹å®Œå…¨ç›¸åŒçš„æ–¹å¼å¤šæ¬¡ç¼–å†™è¿™ç§æ–¹æ³•ã€‚å®é™…ä¸Šï¼Œé™¤äº†æ‰€æŒä¹…åŒ–çš„ Spitter å¯¹è±¡ä¸åŒä»¥å¤–ï¼Œæˆ‘æ•¢æ‰“èµŒä½ ä»¥å‰è‚¯å®šå†™è¿‡ç±»ä¼¼çš„æ–¹æ³•ã€‚å…¶å®ï¼ŒJpaSpitterRepository ä¸­çš„å…¶ä»–æ–¹æ³•ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„åˆ›é€ æ€§ã€‚é¢†åŸŸå¯¹è±¡ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯æ‰€æœ‰ Repository ä¸­çš„æ–¹æ³•éƒ½æ˜¯å¾ˆé€šç”¨çš„ã€‚</p>
<p>ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¸€ééåœ°ç¼–å†™ç›¸åŒçš„æŒä¹…åŒ–æ–¹æ³•å‘¢ï¼Œéš¾é“ä»…ä»…æ˜¯å› ä¸ºè¦å¤„ç†çš„é¢†åŸŸç±»å‹ä¸åŒå—ï¼ŸSpring Data JPA èƒ½å¤Ÿç»ˆç»“è¿™ç§æ ·æ¿å¼çš„æ„šè ¢è¡Œä¸ºã€‚æˆ‘ä»¬ä¸å†éœ€è¦ä¸€ééåœ°ç¼–å†™ç›¸åŒçš„ Repository å®ç°ï¼ŒSpring Data èƒ½å¤Ÿè®©æˆ‘ä»¬åªç¼–å†™ Repository æ¥å£å°±å¯ä»¥äº†ã€‚æ ¹æœ¬å°±ä¸å†éœ€è¦å®ç°ç±»äº†ã€‚</p>
<p>ä¾‹å¦‚ï¼Œçœ‹ä¸€ä¸‹ SpitterRepository æ¥å£ã€‚</p>
<center>ç¨‹åºæ¸…å•11.4ã€€å€ŸåŠ© Spring Dataï¼Œä»¥æ¥å£å®šä¹‰çš„æ–¹å¼åˆ›å»º Repository</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpitterRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Spitter</span>, <span class="title">Long</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ï¼ŒSpitterRepository çœ‹ä¸Šå»å¹¶æ²¡æœ‰ä»€ä¹ˆä½œç”¨ã€‚ä½†æ˜¯ï¼Œå®ƒçš„åŠŸèƒ½è¿œè¶…å‡ºäº†è¡¨é¢ä¸Šæ‰€çœ‹åˆ°çš„é‚£æ ·ã€‚ç¼–å†™ Spring Data JPA Repository çš„å…³é”®åœ¨äºè¦ä»ä¸€ç»„æ¥å£ä¸­æŒ‘é€‰ä¸€ä¸ªè¿›è¡Œæ‰©å±•ã€‚è¿™é‡Œï¼ŒSpitterRepository æ‰©å±•äº† Spring Data JPA çš„ JpaRepositoryï¼ˆç¨åï¼Œæˆ‘ä¼šä»‹ç»å‡ ä¸ªå…¶ä»–çš„æ¥å£ï¼‰ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒJpaRepository è¿›è¡Œäº†å‚æ•°åŒ–ï¼Œæ‰€ä»¥å®ƒå°±èƒ½çŸ¥é“è¿™æ˜¯ä¸€ä¸ªç”¨æ¥æŒä¹…åŒ– Spitter å¯¹è±¡çš„ Repositoryï¼Œå¹¶ä¸” Spitter çš„ ID ç±»å‹ä¸º Longã€‚å¦å¤–ï¼Œå®ƒè¿˜ä¼šç»§æ‰¿ 18ä¸ª æ‰§è¡ŒæŒä¹…åŒ–æ“ä½œçš„é€šç”¨æ–¹æ³•ï¼Œå¦‚ä¿å­˜ Spitterã€åˆ é™¤ Spitter ä»¥åŠæ ¹æ® ID æŸ¥è¯¢ Spitterã€‚</p>
<p>æ­¤æ—¶ï¼Œä½ å¯èƒ½ä¼šæƒ³ä¸‹ä¸€æ­¥å°±è¯¥ç¼–å†™ä¸€ä¸ªç±»å®ç° SpitterRepository å’Œå®ƒçš„ 18 ä¸ªæ–¹æ³•äº†ã€‚å¦‚æœçœŸçš„æ˜¯è¿™æ ·çš„è¯ï¼Œé‚£æœ¬ç« å°±ä¼šå˜å¾—ä¹å‘³æ— èŠäº†ã€‚å…¶å®ï¼Œæˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦ç¼–å†™ SpitterRepository çš„ä»»ä½•å®ç°ç±»ï¼Œç›¸åï¼Œæˆ‘ä»¬è®© Spring Data æ¥ä¸ºæˆ‘ä»¬åšè¿™ä»¶äº‹è¯·ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯å¯¹å®ƒæå‡ºè¦æ±‚ã€‚</p>
<p>ä¸ºäº†è¦æ±‚ Spring Data åˆ›å»º SpitterRepository çš„å®ç°ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Spring é…ç½®ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†åœ¨ XML é…ç½®ä¸­å¯ç”¨ Spring Data JPA æ‰€éœ€è¦æ·»åŠ çš„å†…å®¹ï¼š</p>
<center>ç¨‹åºæ¸…å• 11.5ã€€é…ç½® Spring Data JPA</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>	xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>	xmlns:jpa=<span class="string">&quot;http://www.springframework.org/schema/jpa&quot;</span>	xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/data/jpa	      http://www.springframework.org/schema/data/jpa/spring-jpa-1.0.xsd&quot;</span>&gt;		&lt;jpa:repository base-<span class="keyword">package</span>=<span class="string">&quot;com.habuma.spittr.db&quot;</span> /&gt;		...	&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;jpa:repositories&gt;</code> å…ƒç´ æŒæ¡äº†Spring Data JPA çš„æ‰€æœ‰é­”åŠ›ã€‚å°±åƒ <code>&lt;context:component-scan&gt;</code> å…ƒç´ ä¸€æ ·ï¼Œ<code>&lt;jpa:repositories&gt; </code>å…ƒç´ ä¹Ÿéœ€è¦æŒ‡å®šä¸€ä¸ªè¦è¿›è¡Œæ‰«æçš„ base-packageã€‚ä¸è¿‡ï¼Œ<code>&lt;context:component-scan&gt;</code> ä¼šæ‰«æåŒ…ï¼ˆåŠå…¶å­åŒ…ï¼‰æ¥æŸ¥æ‰¾å¸¦æœ‰ @Component æ³¨è§£çš„ç±»ï¼Œè€Œ <code>&lt;jpa:repositories&gt;</code> ä¼šæ‰«æå®ƒçš„åŸºç¡€åŒ…æ¥æŸ¥æ‰¾æ‰©å±•è‡ª Spring Data JPA Repository æ¥å£çš„æ‰€æœ‰æ¥å£ã€‚å¦‚æœå‘ç°äº†æ‰©å±•è‡ª Repository çš„æ¥å£ï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆï¼ˆåœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™ï¼‰è¿™ä¸ªæ¥å£çš„å®ç°ã€‚</p>
<p>å¦‚æœè¦ä½¿ç”¨ Java é…ç½®çš„è¯ï¼Œé‚£å°±ä¸éœ€è¦ä½¿ç”¨ <code>&lt;jpa:repositories&gt;</code> å…ƒç´ äº†ï¼Œè€Œæ˜¯è¦åœ¨ Java é…ç½®ç±»ä¸Šæ·»åŠ  @EnableJpaRepositories æ³¨è§£ã€‚å¦‚ä¸‹å°±æ˜¯ä¸€ä¸ª Java é…ç½®ç±»ï¼Œå®ƒä½¿ç”¨äº† @EnableJpaRepositories æ³¨è§£ï¼Œå¹¶ä¸”ä¼šæ‰«æ com.habuma.spittr.db åŒ…ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span><span class="meta">@EnableJpaRepositories(basePackages=&quot;com.habuma.spittr.db&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaConfiguration</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>è®©æˆ‘ä»¬å›åˆ° SpitterRepository æ¥å£ï¼Œå®ƒæ‰©å±•è‡ª JpaRepositoryï¼Œè€Œ JpaRepository åˆæ‰©å±•è‡ª Repository æ ‡è®°æ¥å£ï¼ˆè™½ç„¶æ˜¯é—´æ¥çš„ï¼‰ã€‚å› æ­¤ï¼ŒSpitterRepository å°±ä¼ é€’æ€§åœ°æ‰©å±•äº† Repository æ¥å£ï¼Œä¹Ÿå°±æ˜¯ Repository æ‰«ææ—¶æ‰€è¦æŸ¥æ‰¾çš„æ¥å£ã€‚å½“ Spring Data æ‰¾åˆ°å®ƒåï¼Œå°±ä¼šåˆ›å»º SpitterRepository çš„å®ç°ç±»ï¼Œå…¶ä¸­åŒ…å«äº†ç»§æ‰¿è‡ª JpaRepositoryã€PagingAndSortingRepository å’Œ CrudRepository çš„18 ä¸ªæ–¹æ³•ã€‚</p>
<p>å¾ˆé‡è¦çš„ä¸€ç‚¹åœ¨äº Repository çš„å®ç°ç±»æ˜¯åœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™ç”Ÿæˆçš„ï¼Œä¹Ÿå°±æ˜¯ Spring çš„åº”ç”¨ä¸Šä¸‹æ–‡åˆ›å»ºçš„æ—¶å€™ã€‚å®ƒå¹¶ä¸æ˜¯åœ¨æ„å»ºæ—¶é€šè¿‡ä»£ç ç”ŸæˆæŠ€æœ¯äº§ç”Ÿçš„ï¼Œä¹Ÿä¸æ˜¯æ¥å£æ–¹æ³•è°ƒç”¨æ—¶æ‰åˆ›å»ºçš„ã€‚</p>
<p>å¾ˆæ¼‚äº®çš„æŠ€æœ¯ï¼Œå¯¹å§ï¼Ÿ</p>
<p>Spring Data JPA å¾ˆæ£’çš„ä¸€ç‚¹åœ¨äºå®ƒèƒ½ä¸º Spitter å¯¹è±¡æä¾› 18 ä¸ªä¾¿åˆ©çš„æ–¹æ³•æ¥è¿›è¡Œé€šç”¨çš„ JPA æ“ä½œï¼Œè€Œæ— éœ€ä½ ç¼–å†™ä»»ä½•æŒä¹…åŒ–ä»£ç ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ çš„éœ€æ±‚è¶…è¿‡äº†å®ƒæ‰€æä¾›çš„è¿™ 18 ä¸ªæ–¹æ³•çš„è¯ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå¹¸å¥½ï¼ŒSpring Data JPA æä¾›äº†å‡ ç§æ–¹å¼æ¥ä¸º Repository æ·»åŠ è‡ªå®šä¹‰çš„æ–¹æ³•ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ä¸º Spring Data JPA ç¼–å†™è‡ªå®šä¹‰çš„æŸ¥è¯¢æ–¹æ³•ã€‚</p>
<h4 id="å®šä¹‰æŸ¥è¯¢æ–¹æ³•"><a href="#å®šä¹‰æŸ¥è¯¢æ–¹æ³•" class="headerlink" title="å®šä¹‰æŸ¥è¯¢æ–¹æ³•"></a>å®šä¹‰æŸ¥è¯¢æ–¹æ³•</h4><p>ç°åœ¨ï¼ŒSpitterRepository éœ€è¦å®Œæˆçš„ä¸€é¡¹åŠŸèƒ½æ˜¯æ ¹æ®ç»™å®šçš„ username æŸ¥æ‰¾ Spitter å¯¹è±¡ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å°† SpitterRepository æ¥å£ä¿®æ”¹ä¸ºå¦‚ä¸‹æ‰€ç¤ºçš„æ ·å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpitterRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Spitter</span>, <span class="title">Long</span>&gt; </span>&#123;  <span class="function">Spitter <span class="title">findByUsername</span><span class="params">(String username)</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–°çš„ findByUserName() éå¸¸ç®€å•ï¼Œä½†æ˜¯è¶³ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ç°åœ¨ï¼Œè¯¥å¦‚ä½•è®© Spring Data JPA æä¾›è¿™ä¸ªæ–¹æ³•çš„å®ç°å‘¢ï¼Ÿ</p>
<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å®ç° findByUsername()ã€‚æ–¹æ³•ç­¾åå·²ç»å‘Šè¯‰ Spring Data JPA è¶³å¤Ÿçš„ä¿¡æ¯æ¥åˆ›å»ºè¿™ä¸ªæ–¹æ³•çš„å®ç°äº†ã€‚</p>
<p>å½“åˆ›å»º Repository å®ç°çš„æ—¶å€™ï¼ŒSpring Data ä¼šæ£€æŸ¥ Repository æ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œè§£ææ–¹æ³•çš„åç§°ï¼Œå¹¶åŸºäºè¢«æŒä¹…åŒ–çš„å¯¹è±¡æ¥è¯•å›¾æ¨æµ‹æ–¹æ³•çš„ç›®çš„ã€‚æœ¬è´¨ä¸Šï¼ŒSpring Data å®šä¹‰äº†ä¸€ç»„å°å‹çš„é¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆdomainspecific language ï¼ŒDSLï¼‰ï¼Œåœ¨è¿™é‡Œï¼ŒæŒä¹…åŒ–çš„ç»†èŠ‚éƒ½æ˜¯é€šè¿‡ Repository æ–¹æ³•çš„ç­¾åæ¥æè¿°çš„ã€‚</p>
<p>Spring Data èƒ½å¤ŸçŸ¥é“è¿™ä¸ªæ–¹æ³•æ˜¯è¦æŸ¥æ‰¾ Spitter çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨ Spitter å¯¹ JpaRepository è¿›è¡Œäº†å‚æ•°åŒ–ã€‚æ–¹æ³•å findByUsername ç¡®å®šè¯¥æ–¹æ³•éœ€è¦æ ¹æ® username å±æ€§ç›¸åŒ¹é…æ¥æŸ¥æ‰¾ Spitterï¼Œè€Œ username æ˜¯ä½œä¸ºå‚æ•°ä¼ é€’åˆ°æ–¹æ³•ä¸­æ¥çš„ã€‚å¦å¤–ï¼Œå› ä¸ºåœ¨æ–¹æ³•ç­¾åä¸­å®šä¹‰äº†è¯¥æ–¹æ³•è¦è¿”å›ä¸€ä¸ª Spitter å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªé›†åˆï¼Œå› æ­¤å®ƒåªä¼šæŸ¥æ‰¾ä¸€ä¸ª username å±æ€§åŒ¹é…çš„ Spitterã€‚</p>
<p>findByUsername() æ–¹æ³•éå¸¸ç®€å•ï¼Œä½†æ˜¯ Spring Data ä¹Ÿèƒ½å¤„ç†æ›´åŠ æœ‰æ„æ€çš„æ–¹æ³•åç§°ã€‚Repository æ–¹æ³•æ˜¯ç”±ä¸€ä¸ªåŠ¨è¯ã€ä¸€ä¸ªå¯é€‰çš„ä¸»é¢˜ï¼ˆSubjectï¼‰ã€å…³é”®è¯ Byä»¥åŠä¸€ä¸ªæ–­è¨€æ‰€ç»„æˆã€‚åœ¨ findByUsername() è¿™ä¸ªæ ·ä¾‹ä¸­ï¼ŒåŠ¨è¯æ˜¯ findï¼Œæ–­è¨€æ˜¯ Usernameï¼Œä¸»é¢˜å¹¶æ²¡æœ‰æŒ‡å®šï¼Œæš—å«çš„ä¸»é¢˜æ˜¯ Spitterã€‚</p>
<p>ä½œä¸ºç¼–å†™ Repository æ–¹æ³•åç§°çš„æ ·ä¾‹ï¼Œæˆ‘ä»¬å‚ç…§åä¸º readSpitterByFirstnameOrLastname() çš„æ–¹æ³•ï¼Œçœ‹ä¸€ä¸‹æ–¹æ³•ä¸­çš„å„ä¸ªéƒ¨åˆ†æ˜¯å¦‚ä½•æ˜ å°„çš„ã€‚å›¾ 11.1 å±•ç°äº†è¿™ä¸ªæ–¹æ³•æ˜¯å¦‚ä½•æ‹†åˆ†çš„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„åŠ¨è¯æ˜¯ readï¼Œä¸ä¹‹å‰æ ·ä¾‹ä¸­çš„ find æœ‰æ‰€å·®åˆ«ã€‚Spring Data å…è®¸åœ¨æ–¹æ³•åä¸­ä½¿ç”¨å››ç§åŠ¨è¯ï¼šgetã€readã€find å’Œ countã€‚å…¶ä¸­ï¼ŒåŠ¨è¯ getã€read å’Œ find æ˜¯åŒä¹‰çš„ï¼Œè¿™ä¸‰ä¸ªåŠ¨è¯å¯¹åº”çš„ Repository æ–¹æ³•éƒ½ä¼šæŸ¥è¯¢æ•°æ®å¹¶è¿”å›å¯¹è±¡ã€‚è€ŒåŠ¨è¯ count åˆ™ä¼šè¿”å›åŒ¹é…å¯¹è±¡çš„æ•°é‡ï¼Œè€Œä¸æ˜¯å¯¹è±¡æœ¬èº«ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211104225555510.png" alt="image-20211104225555510"></p>
<center>å›¾ 11.1ã€€Repository æ–¹æ³•çš„å‘½åéµå¾ªä¸€ç§æ¨¡å¼ï¼Œæœ‰åŠ©äº Spring Data ç”Ÿæˆé’ˆå¯¹æ•°æ®åº“çš„æŸ¥è¯¢</center>

<p>Repository æ–¹æ³•çš„ä¸»é¢˜æ˜¯å¯é€‰çš„ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯è®©ä½ åœ¨å‘½åæ–¹æ³•çš„æ—¶å€™ï¼Œæœ‰æ›´å¤šçš„çµæ´»æ€§ã€‚å¦‚æœä½ æ›´æ„¿æ„å°†æ–¹æ³•ç§°ä¸º readSpittersByFirstnameOrLastname() è€Œä¸æ˜¯ readByFirstnameOrLastname() çš„è¯ï¼Œé‚£ä¹ˆä½ å°½å¯ä»¥è¿™ä¹ˆåšã€‚</p>
<p>å¯¹äºå¤§éƒ¨åˆ†åœºæ™¯æ¥è¯´ï¼Œä¸»é¢˜ä¼šè¢«çœç•¥æ‰ã€‚readSpittersByFirstnameOrLastname() ä¸ readPuppiesByFirstnameOrLastname() å¹¶æ²¡æœ‰ä»€ä¹ˆå·®åˆ«ï¼Œå®ƒä»¬ä¸ readThoseThingsWeWantByFirstnameOrLastname() åŒæ ·æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚è¦æŸ¥è¯¢çš„å¯¹è±¡ç±»å‹æ˜¯é€šè¿‡å¦‚ä½•å‚æ•°åŒ– JpaRepository æ¥å£æ¥ç¡®å®šçš„ï¼Œè€Œä¸æ˜¯æ–¹æ³•åç§°ä¸­çš„ä¸»é¢˜ã€‚</p>
<p>åœ¨çœç•¥ä¸»é¢˜çš„æ—¶å€™ï¼Œæœ‰ä¸€ç§ä¾‹å¤–æƒ…å†µã€‚å¦‚æœä¸»é¢˜çš„åç§°ä»¥ Distinct å¼€å¤´çš„è¯ï¼Œé‚£ä¹ˆåœ¨ç”ŸæˆæŸ¥è¯¢çš„æ—¶å€™ä¼šç¡®ä¿æ‰€è¿”å›ç»“æœé›†ä¸­ä¸åŒ…å«é‡å¤è®°å½•ã€‚</p>
<p>æ–­è¨€æ˜¯æ–¹æ³•åç§°ä¸­æœ€ä¸ºæœ‰æ„æ€çš„éƒ¨åˆ†ï¼Œå®ƒæŒ‡å®šäº†é™åˆ¶ç»“æœé›†çš„å±æ€§ã€‚åœ¨ readByFirstnameOrLastname() è¿™ä¸ªæ ·ä¾‹ä¸­ï¼Œä¼šé€šè¿‡ firstname å±æ€§æˆ– lastname å±æ€§çš„å€¼æ¥é™åˆ¶ç»“æœã€‚</p>
<p>åœ¨æ–­è¨€ä¸­ï¼Œä¼šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªé™åˆ¶ç»“æœçš„æ¡ä»¶ã€‚æ¯ä¸ªæ¡ä»¶å¿…é¡»å¼•ç”¨ä¸€ä¸ªå±æ€§ï¼Œå¹¶ä¸”è¿˜å¯ä»¥æŒ‡å®šä¸€ç§æ¯”è¾ƒæ“ä½œã€‚å¦‚æœçœç•¥æ¯”è¾ƒæ“ä½œç¬¦çš„è¯ï¼Œé‚£ä¹ˆè¿™æš—æŒ‡æ˜¯ä¸€ç§ç›¸ç­‰æ¯”è¾ƒæ“ä½œã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–çš„æ¯”è¾ƒæ“ä½œï¼ŒåŒ…æ‹¬å¦‚ä¸‹çš„ç§ç±»ï¼š</p>
<ul>
<li>IsAfterã€Afterã€IsGreaterThanã€GreaterThan</li>
<li>IsGreaterThanEqualã€GreaterThanEqual</li>
<li>IsBeforeã€Beforeã€IsLessThanã€LessThan</li>
<li>IsLessThanEqualã€LessThanEqual</li>
<li>IsBetweenã€Between</li>
<li>IsNullã€Null</li>
<li>IsNotNullã€NotNull</li>
<li>IsInã€In</li>
<li>IsNotInã€NotIn</li>
<li>IsStartingWithã€StartingWithã€StartsWith</li>
<li>IsEndingWithã€EndingWithã€EndsWith</li>
<li>IsContainingã€Containingã€Contains</li>
<li>IsLikeã€Like</li>
<li>IsNotLikeã€NotLike</li>
<li>IsTrueã€True</li>
<li>IsFalseã€False</li>
<li>Isã€Equals</li>
<li>IsNotã€Not</li>
</ul>
<p>è¦å¯¹æ¯”çš„å±æ€§å€¼å°±æ˜¯æ–¹æ³•çš„å‚æ•°ã€‚å®Œæ•´çš„æ–¹æ³•ç­¾åå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Spitter&gt; <span class="title">readByFirstnameOrLastname</span><span class="params">(String first, String last)</span></span>;</span><br></pre></td></tr></table></figure>

<p>è¦å¤„ç† String ç±»å‹çš„å±æ€§æ—¶ï¼Œæ¡ä»¶ä¸­å¯èƒ½è¿˜ä¼šåŒ…å« IgnoringCase æˆ– IgnoresCaseï¼Œè¿™æ ·åœ¨æ‰§è¡Œå¯¹æ¯”çš„æ—¶å€™å°±ä¼šä¸å†è€ƒè™‘å­—ç¬¦æ˜¯å¤§å†™è¿˜æ˜¯å°å†™ã€‚ä¾‹å¦‚ï¼Œè¦åœ¨ firstname å’Œ lastname å±æ€§ä¸Šå¿½ç•¥å¤§å°å†™ï¼Œé‚£ä¹ˆå¯ä»¥å°†æ–¹æ³•ç­¾åæ”¹æˆå¦‚ä¸‹çš„å½¢å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Spitter&gt; <span class="title">readByFirstnameIgnoringCaseOrLastnameIgnoringCase</span><span class="params">(String first, String last)</span></span>;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„ï¼ŒIgnoringCase å’Œ IgnoresCaseæ˜¯åŒä¹‰çš„ï¼Œä½ å¯ä»¥éšæ„æŒ‘é€‰ä¸€ä¸ªæœ€åˆé€‚çš„ã€‚</p>
<p>ä½œä¸º IgnoringCase/IgnoresCase çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨æ‰€æœ‰æ¡ä»¶çš„åé¢æ·»åŠ  AllIgnoringCase æˆ– AllIgnoresCaseï¼Œè¿™æ ·å®ƒå°±ä¼šå¿½ç•¥æ‰€æœ‰æ¡ä»¶çš„å¤§å°å†™ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Spitter&gt; <span class="title">readByFirstnameOrLastnameAllIgnoresCase</span><span class="params">(String first, String last)</span></span>;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œå‚æ•°çš„åç§°æ˜¯æ— å…³ç´§è¦çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„é¡ºåºå¿…é¡»è¦ä¸æ–¹æ³•åç§°ä¸­çš„æ“ä½œç¬¦ç›¸åŒ¹é…ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨æ–¹æ³•åç§°çš„ç»“å°¾å¤„æ·»åŠ  OrderByï¼Œå®ç°ç»“æœé›†æ’åºã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ lastname å±æ€§å‡åºæ’åˆ—ç»“æœé›†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Spitter&gt; <span class="title">readByFirstnameOrLastnameOrderByLastnameAsc</span><span class="params">(String first, String last)</span></span>;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦æ ¹æ®å¤šä¸ªå±æ€§æ’åºçš„è¯ï¼Œåªéœ€å°†å…¶ä¾åºæ·»åŠ åˆ° OrderBy ä¸­å³å¯ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„æ ·ä¾‹ä¸­ï¼Œé¦–å…ˆä¼šæ ¹æ® lastname å‡åºæ’åˆ—ï¼Œç„¶åæ ¹æ® firstname å±æ€§é™åºæ’åˆ—ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Spitter&gt; <span class="title">readByFirstnameOrLastnameOrderByLastnameAscFirstnameDesc</span><span class="params">(String first, String last)</span></span>;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæ¡ä»¶éƒ¨åˆ†æ˜¯é€šè¿‡ And æˆ–è€… Or è¿›è¡Œåˆ†å‰²çš„ã€‚</p>
<p>æˆ‘ä»¬ä¸å¯èƒ½ï¼ˆè‡³å°‘å¾ˆéš¾ï¼‰æä¾›ä¸€ä¸ªæƒå¨çš„åˆ—è¡¨ï¼Œå°†ä½¿ç”¨ Spring Data æ–¹æ³•å‘½åçº¦å®šå¯ä»¥ç¼–å†™å‡ºæ¥çš„æ–¹æ³•ç§ç±»å…¨éƒ¨åˆ—å‡ºæ¥ã€‚ä½†æ˜¯ï¼Œå¦‚ä¸‹ç»™å‡ºäº†å‡ ä¸ªç¬¦åˆæ–¹æ³•å‘½åçº¦å®šçš„æ–¹æ³•ç­¾åï¼š</p>
<ul>
<li>List<Pet> findPetsByBreedIn(List<String> breed)</String></Pet></li>
<li>int countProductsByDiscontinuedTrue()</li>
<li>List<Order> findByShippingDateBetween(Date start, Date end)</Order></li>
</ul>
<p>æˆ‘ä»¬åªæ˜¯åˆæ­¥ä½“éªŒäº†æ‰€èƒ½å£°æ˜çš„æ–¹æ³•ç§ç±»ï¼ŒSpring Data JPA ä¼šä¸ºæˆ‘ä»¬å®ç°è¿™äº›æ–¹æ³•ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€çŸ¥é“é€šè¿‡ä½¿ç”¨å±æ€§åå’Œå…³é”®å­—æ„å»º Repository æ–¹æ³•ç­¾åï¼Œå°±èƒ½è®© Spring Data JPA ç”Ÿæˆæ–¹æ³•å®ç°ï¼Œå®Œæˆå‡ ä¹æ‰€æœ‰èƒ½å¤Ÿæƒ³è±¡åˆ°çš„æŸ¥è¯¢ã€‚</p>
<p>ä¸è¿‡ï¼ŒSpring Data è¿™ä¸ªå°å‹çš„ DSL ä¾æ—§æœ‰å…¶å±€é™æ€§ï¼Œæœ‰æ—¶å€™é€šè¿‡æ–¹æ³•åç§°è¡¨è¾¾é¢„æœŸçš„æŸ¥è¯¢å¾ˆçƒ¦çï¼Œç”šè‡³æ— æ³•å®ç°ã€‚å¦‚æœé‡åˆ°è¿™ç§æƒ…å½¢çš„è¯ï¼ŒSpring Data èƒ½å¤Ÿè®©æˆ‘ä»¬é€šè¿‡ @Query æ³¨è§£æ¥è§£å†³é—®é¢˜ã€‚</p>
<h4 id="å£°æ˜è‡ªå®šä¹‰æŸ¥è¯¢"><a href="#å£°æ˜è‡ªå®šä¹‰æŸ¥è¯¢" class="headerlink" title="å£°æ˜è‡ªå®šä¹‰æŸ¥è¯¢"></a>å£°æ˜è‡ªå®šä¹‰æŸ¥è¯¢</h4><p>å‡è®¾æˆ‘ä»¬æƒ³è¦åˆ›å»ºä¸€ä¸ª Repository æ–¹æ³•ï¼Œç”¨æ¥æŸ¥æ‰¾ E-mail åœ°å€æ˜¯ Gmail é‚®ç®±çš„ Spitterã€‚æœ‰ä¸€ç§æ–¹å¼å°±æ˜¯å®šä¹‰ä¸€ä¸ª findByEmailLike() æ–¹æ³•ï¼Œç„¶åæ¯æ¬¡æƒ³æŸ¥æ‰¾Gmail ç”¨æˆ·çš„æ—¶å€™å°±å°† â€œ%gmail.comâ€ ä¼ é€’è¿›æ¥ã€‚ä¸è¿‡ï¼Œæ›´å¥½çš„æ–¹æ¡ˆæ˜¯å®šä¹‰ä¸€ä¸ªæ›´åŠ ä¾¿åˆ©çš„ findAllGmailSpitters() æ–¹æ³•ï¼Œè¿™æ ·çš„è¯ï¼Œå°±ä¸ç”¨å°† Email åœ°å€çš„ä¸€éƒ¨åˆ†ä¼ é€’è¿›æ¥äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Spitter&gt; <span class="title">findAllGmailSpitters</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡ï¼Œè¿™ä¸ªæ–¹æ³•å¹¶ä¸ç¬¦åˆ Spring Data çš„æ–¹æ³•å‘½åçº¦å®šã€‚å½“ Spring Data è¯•å›¾ç”Ÿæˆè¿™ä¸ªæ–¹æ³•çš„å®ç°æ—¶ï¼Œæ— æ³•å°†æ–¹æ³•åçš„å†…å®¹ä¸ Spitter å…ƒæ¨¡å‹è¿›è¡ŒåŒ¹é…ï¼Œå› æ­¤ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>å¦‚æœæ‰€éœ€çš„æ•°æ®æ— æ³•é€šè¿‡æ–¹æ³•åç§°è¿›è¡Œæ°å½“åœ°æè¿°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ @Query æ³¨è§£ï¼Œä¸º Spring Data æä¾›è¦æ‰§è¡Œçš„æŸ¥è¯¢ã€‚å¯¹äº findAllGmailSpitters() æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼æ¥ä½¿ç”¨ @Query æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;select s from Spitter s where s.email like &#x27;%gmail.com&#x27;&quot;)</span><span class="function">List&lt;Spitter&gt; <span class="title">findAllGmailSpitters</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¾ç„¶ä¸éœ€è¦ç¼–å†™ findAllGmailSpitters() æ–¹æ³•çš„å®ç°ï¼Œåªéœ€æä¾›æŸ¥è¯¢å³å¯ï¼Œè®© Spring Data JPA çŸ¥é“å¦‚ä½•å®ç°è¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“ä½¿ç”¨æ–¹æ³•å‘½åçº¦å®šå¾ˆéš¾è¡¨è¾¾é¢„æœŸçš„æŸ¥è¯¢æ—¶ï¼Œ@Query æ³¨è§£èƒ½å¤Ÿå‘æŒ¥ä½œç”¨ã€‚å¦‚æœæŒ‰ç…§å‘½åçº¦å®šï¼Œæ–¹æ³•çš„åç§°ç‰¹åˆ«é•¿çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ³¨è§£ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘å¦‚ä¸‹çš„æŸ¥è¯¢æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Order&gt; <span class="title">findByCustomerAddressZipCodeOrCustomerNameAndCustomerAddressState</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>è¿™çœŸçš„æ˜¯ä¸€ä¸ªæ–¹æ³•çš„åç§°ï¼æˆ‘ä¸å¾—ä¸åœ¨è¿”å›ç±»å‹åå°†å…¶æ–­å¼€ï¼Œè¿™æ ·æ‰èƒ½é€‚åº”æœ¬ä¹¦é¡µé¢çš„å®½åº¦ã€‚</p>
<p>æˆ‘æ‰¿è®¤è¿™æ˜¯ä¸€ä¸ªæœ‰ç‚¹ç‰µå¼ºçš„ä¾‹å­ã€‚ä½†åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œç¡®å®å­˜åœ¨è¿™æ ·çš„éœ€æ±‚ï¼Œä½¿ç”¨ Repository æ–¹æ³•æ‰€æ‰§è¡Œçš„æŸ¥è¯¢ä¼šå¾—åˆ°ä¸€ä¸ªå¾ˆé•¿çš„æ–¹æ³•åã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ æœ€å¥½ä½¿ç”¨ä¸€ä¸ªè¾ƒçŸ­çš„æ–¹æ³•åï¼Œå¹¶ä½¿ç”¨ @Query æ¥æŒ‡å®šè¯¥æ–¹æ³•è¦å¦‚ä½•æŸ¥è¯¢æ•°æ®åº“ã€‚</p>
<p>å¯¹äº Spring Data JPA çš„æ¥å£æ¥è¯´ï¼Œ@Query æ˜¯ä¸€ç§æ·»åŠ è‡ªå®šä¹‰æŸ¥è¯¢çš„ä¾¿åˆ©æ–¹å¼ã€‚ä½†æ˜¯ï¼Œå®ƒä»…é™äºå•ä¸ª JPA æŸ¥è¯¢ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦æ›´ä¸ºå¤æ‚çš„åŠŸèƒ½ï¼Œæ— æ³•åœ¨ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢ä¸­å¤„ç†çš„è¯ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<h4 id="æ··åˆè‡ªå®šä¹‰çš„åŠŸèƒ½"><a href="#æ··åˆè‡ªå®šä¹‰çš„åŠŸèƒ½" class="headerlink" title="æ··åˆè‡ªå®šä¹‰çš„åŠŸèƒ½"></a>æ··åˆè‡ªå®šä¹‰çš„åŠŸèƒ½</h4><p>æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ Repository æ‰€æä¾›çš„åŠŸèƒ½æ˜¯æ— æ³•ç”¨ Spring Data çš„æ–¹æ³•å‘½åçº¦å®šæ¥æè¿°çš„ï¼Œç”šè‡³æ— æ³•ç”¨ @Query æ³¨è§£è®¾ç½®æŸ¥è¯¢æ¥å®ç°ã€‚å°½ç®¡ Spring Data JPA éå¸¸æ£’ï¼Œä½†æ˜¯å®ƒä¾ç„¶æœ‰å…¶å±€é™æ€§ï¼Œå¯èƒ½éœ€è¦æˆ‘ä»¬æŒ‰ç…§ä¼ ç»Ÿçš„æ–¹å¼æ¥ç¼–å†™ Repository æ–¹æ³•ï¼šä¹Ÿå°±æ˜¯ç›´æ¥ä½¿ç”¨ EntityManagerã€‚å½“é‡åˆ°è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯è¦æ”¾å¼ƒ Spring Data JPAï¼Œé‡æ–°æŒ‰ç…§ 11.2.2 å°èŠ‚ä¸­çš„æ–¹å¼æ¥ç¼–å†™ Repository å‘¢ï¼Ÿ</p>
<p>ç®€å•æ¥è¯´ï¼Œæ˜¯è¿™æ ·çš„ã€‚å¦‚æœä½ éœ€è¦åšçš„äº‹æƒ…æ— æ³•é€šè¿‡ Spring Data JPA æ¥å®ç°ï¼Œé‚£å°±å¿…é¡»è¦åœ¨ä¸€ä¸ªæ¯” Spring Data JPA æ›´ä½çš„å±‚çº§ä¸Šä½¿ç”¨ JPAã€‚</p>
<p>å¥½æ¶ˆæ¯æ˜¯æˆ‘ä»¬æ²¡æœ‰å¿…è¦å®Œå…¨æ”¾å¼ƒ Spring Data JPAã€‚æˆ‘ä»¬åªéœ€åœ¨å¿…é¡»ä½¿ç”¨è¾ƒä½å±‚çº§ JPA çš„æ–¹æ³•ä¸Šï¼Œæ‰ä½¿ç”¨è¿™ç§ä¼ ç»Ÿçš„æ–¹å¼å³å¯ï¼Œè€Œå¯¹äº Spring Data JP AçŸ¥é“è¯¥å¦‚ä½•å¤„ç†çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥é€šè¿‡å®ƒæ¥å®ç°ã€‚</p>
<p>å½“ Spring Data JPA ä¸º Repository æ¥å£ç”Ÿæˆå®ç°çš„æ—¶å€™ï¼Œå®ƒè¿˜ä¼šæŸ¥æ‰¾åå­—ä¸æ¥å£ç›¸åŒï¼Œå¹¶ä¸”æ·»åŠ äº† Impl åç¼€çš„ä¸€ä¸ªç±»ã€‚å¦‚æœè¿™ä¸ªç±»å­˜åœ¨çš„è¯ï¼ŒSpring Data JPA å°†ä¼šæŠŠå®ƒçš„æ–¹æ³•ä¸ Spring Data JPA æ‰€ç”Ÿæˆçš„æ–¹æ³•åˆå¹¶åœ¨ä¸€èµ·ã€‚å¯¹äº SpitterRepository æ¥å£è€Œè¨€ï¼Œè¦æŸ¥æ‰¾çš„ç±»åä¸º SpitterRepositoryImplã€‚</p>
<p>ä¸ºäº†é˜è¿°è¯¥åŠŸèƒ½ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦åœ¨ SpitterRepository ä¸­æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œå‘è¡¨ Spittle æ•°é‡åœ¨ 10,000 åŠä»¥ä¸Šçš„ Spitter å°†ä¼šæ›´æ–°ä¸º Elite çŠ¶æ€ã€‚ä½¿ç”¨ Spring Data JPA çš„æ–¹æ³•å‘½åçº¦å®šæˆ–ä½¿ç”¨ @Query å‡æ²¡æœ‰åŠæ³•å£°æ˜è¿™æ ·çš„æ–¹æ³•ã€‚æœ€ä¸ºå¯è¡Œçš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨å¦‚ä¸‹çš„ eliteSweep() æ–¹æ³•ã€‚</p>
<center>ç¨‹åºæ¸…å• 11.6ã€€å°†æ´»è·ƒçš„ Spitter ç”¨æˆ·å‡çº§ä¸º Elite çŠ¶æ€çš„Repositoryæ–¹æ³•</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpitterRepositoryImpl</span> <span class="keyword">implements</span> <span class="title">SpitterSweeper</span> </span>&#123;  <span class="meta">@PersistenceContext</span>  <span class="keyword">private</span> EntityManager em;    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">eliteSweep</span><span class="params">()</span> </span>&#123;    String update =       <span class="string">&quot;UPDATE Spitter spitter &quot;</span> +      <span class="string">&quot;SET spitter.status = &#x27;Elite&#x27; &quot;</span> +      <span class="string">&quot;WHERE spitter.status = &#x27;Newbie&#x27; &quot;</span> +      <span class="string">&quot;AND spitter.id IN (&quot;</span> +      <span class="string">&quot;SELECT s FROM Spitter s WHERE (&quot;</span> +      <span class="string">&quot;  SELECT COUNT(spittles) FROM s.spittles spittles) &gt; 10000&quot;</span> +      <span class="string">&quot;)&quot;</span>;    <span class="keyword">return</span> em.createQuery(update).executeUpdate();  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒeliteSweep() æ–¹æ³•ä¸ä¹‹å‰åœ¨ 11.2.2 å°èŠ‚ä¸­æ‰€åˆ›å»ºçš„ Repository æ–¹æ³•å¹¶æ²¡æœ‰å¤ªå¤§çš„å·®åˆ«ã€‚SpitterRepositoryImpl æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šä¹‹å¤„ï¼Œå®ƒä½¿ç”¨è¢«æ³¨å…¥çš„ EntityManager æ¥å®Œæˆé¢„æœŸçš„ä»»åŠ¡ã€‚</p>
<p>æ³¨æ„ï¼ŒSpitterRepositoryImpl å¹¶æ²¡æœ‰å®ç° SpitterRepository æ¥å£ã€‚Spring Data JPA è´Ÿè´£å®ç°è¿™ä¸ªæ¥å£ã€‚SpitterRepositoryImplï¼ˆå°†å®ƒä¸Spring Dataçš„ Repository å…³è”èµ·æ¥çš„æ˜¯å®ƒçš„åå­—ï¼‰å®ç°äº† SpitterSweeperæ¥å£ï¼Œå®ƒå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpitterSweeper</span> </span>&#123;  <span class="function"><span class="keyword">int</span> <span class="title">eliteSweep</span><span class="params">()</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜éœ€è¦ç¡®ä¿ eliteSweep() æ–¹æ³•ä¼šè¢«å£°æ˜åœ¨ SpitterRepository æ¥å£ä¸­ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œé¿å…ä»£ç é‡å¤çš„ç®€å•æ–¹å¼å°±æ˜¯ä¿®æ”¹ SpitterRepositoryï¼Œè®©å®ƒæ‰©å±• SpitterSweeperï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpitterRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Spitter</span>, <span class="title">Long</span>&gt;, <span class="title">SpitterSweeper</span> </span>&#123;  ...&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚å‰æ‰€è¿°ï¼ŒSpring Data JPA å°†å®ç°ç±»ä¸æ¥å£å…³è”èµ·æ¥æ˜¯åŸºäºæ¥å£çš„åç§°ã€‚ä½†æ˜¯ï¼ŒImpl åç¼€åªæ˜¯é»˜è®¤çš„åšæ³•ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨å…¶ä»–åç¼€çš„è¯ï¼Œåªéœ€åœ¨é…ç½® @EnableJpaRepositories çš„æ—¶å€™ï¼Œè®¾ç½® repositoryImplementationPostfix å±æ€§å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="meta">@EnableJpaRepositories(basePackage=&quot;com.habuma.spittr.db&quot;, repositoryImplementationPostfix=&quot;Helper&quot;)</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨ XML ä¸­ä½¿ç”¨ <code>&lt;jpa:repositories&gt;</code> å…ƒç´ æ¥é…ç½® Spring Data JPA çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© repository-impl-postfix å±æ€§æŒ‡å®šåç¼€ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jpa:repository</span> <span class="attr">base-package</span>=<span class="string">&quot;com.habuma.spittr.db&quot;</span> <span class="attr">repository-impl-postfix</span>=<span class="string">&quot;Helper&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å°†åç¼€è®¾ç½®æˆäº† Helperï¼ŒSpring Data JPA å°†ä¼šæŸ¥æ‰¾åä¸º SpitterRepositoryHelper çš„ç±»ï¼Œç”¨å®ƒæ¥åŒ¹é… SpitterRepository æ¥å£ã€‚</p>
<h3 id="å°ç»“-10"><a href="#å°ç»“-10" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å¯¹äºå¾ˆå¤šåº”ç”¨æ¥è®²ï¼Œå…³ç³»å‹æ•°æ®åº“æ˜¯ä¸»æµçš„æ•°æ®å­˜å‚¨å½¢å¼ï¼Œå¹¶ä¸”è¿™ç§æƒ…å†µå·²ç»æŒç»­äº†å¾ˆå¤šå¹´ã€‚ä½¿ç”¨ JDBC å¹¶ä¸”å°†å¯¹è±¡æ˜ å°„ä¸ºæ•°æ®åº“è¡¨æ˜¯å¾ˆçƒ¦çä¹å‘³çš„äº‹æƒ…ï¼Œåƒ Hibernate å’Œ JPA è¿™æ ·çš„ ORM æ–¹æ¡ˆèƒ½å¤Ÿè®©æˆ‘ä»¬ä»¥æ›´åŠ å£°æ˜å¼çš„æ¨¡å‹å®ç°æ•°æ®æŒä¹…åŒ–ã€‚å°½ç®¡ Spring æ²¡æœ‰ä¸º ORM æä¾›ç›´æ¥çš„æ”¯æŒï¼Œä½†æ˜¯å®ƒèƒ½å¤Ÿä¸å¤šç§æµè¡Œçš„ ORMæ–¹æ¡ˆé›†æˆï¼ŒåŒ…æ‹¬ Hibernate ä¸ Java æŒä¹…åŒ– APIã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•åœ¨ Spring åº”ç”¨ä¸­ä½¿ç”¨ Hibernate çš„ä¸Šä¸‹æ–‡ Sessionï¼Œè¿™æ ·æˆ‘ä»¬çš„ Repository å°±èƒ½åŒ…å«å¾ˆå°‘ç”šè‡³ä¸åŒ…å« Spring ç›¸å…³çš„ä»£ç ã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œæˆ‘ä»¬è¿˜çœ‹åˆ°äº†å¦‚ä½•å°† EntityManagerFactory æˆ– EntityManager æ³¨å…¥åˆ° Repository å®ç°ä¸­ï¼Œä»è€Œå®ç°ä¸ä¾èµ–äº Spring çš„ JPA Repositoryã€‚</p>
<p>æˆ‘ä»¬ç¨ååˆæ­¥äº†è§£äº† Spring Dataï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œåªéœ€å£°æ˜ JPARepository æ¥å£å³å¯ï¼Œè®© Spring Data JPA åœ¨è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆè¿™äº›æ¥å£çš„å®ç°ã€‚å½“æˆ‘ä»¬éœ€è¦çš„ Repository æ–¹æ³•è¶…å‡ºäº† Spring Data JPA æ‰€æä¾›çš„åŠŸèƒ½æ—¶ï¼Œå¯ä»¥å€ŸåŠ© @Query æ³¨è§£ä»¥åŠç¼–å†™è‡ªå®šä¹‰çš„ Repository æ–¹æ³•æ¥å®ç°ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¯¹äº Spring Data çš„æ•´ä½“åŠŸèƒ½æ¥è¯´ï¼Œæˆ‘ä»¬åªæ˜¯æ¥è§¦åˆ°äº†çš®æ¯›ã€‚åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šæ›´åŠ æ·±å…¥åœ°å­¦ä¹  Spring Data çš„æ–¹æ³•å‘½å DSLï¼Œä»¥åŠ Spring Data å¦‚ä½•ä¸ºå…³ç³»å‹æ•°æ®åº“ä»¥å¤–çš„é¢†åŸŸå¸¦æ¥å¸®åŠ©ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šæˆ‘ä»¬å°†ä¼šçœ‹åˆ° Spring Data å¦‚ä½•æ”¯æŒæ–°å…´çš„ NoSQL æ•°æ®åº“ï¼Œè¿™äº›æ•°æ®åº“åœ¨æœ€è¿‘å‡ å¹´å˜å¾—è¶Šæ¥è¶Šæµè¡Œã€‚</p>
<h2 id="ä½¿ç”¨-NoSQL-æ•°æ®åº“"><a href="#ä½¿ç”¨-NoSQL-æ•°æ®åº“" class="headerlink" title="ä½¿ç”¨ NoSQL æ•°æ®åº“"></a>ä½¿ç”¨ NoSQL æ•°æ®åº“</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>ä¸º MongoDB å’Œ Neo4j ç¼–å†™ Repository</li>
<li>ä¸ºå¤šç§æ•°æ®å­˜å‚¨å½¢å¼æŒä¹…åŒ–æ•°æ®</li>
<li>ç»„åˆä½¿ç”¨ Spring å’Œ Redis</li>
</ul>
<p>äº¨åˆ©Â·ç¦ç‰¹åœ¨ä»–çš„è‡ªä¼ ä¸­æ›¾ç»å†™è¿‡ä¸€å¥å¾ˆè‘—åçš„è¯ï¼šâ€œä»»ä½•é¡¾å®¢å¯ä»¥å°†è¿™è¾†è½¦æ¼†æˆä»»ä½•ä»–æ‰€æ„¿æ„çš„é¢œè‰²ï¼Œåªè¦ä¿æŒå®ƒçš„é»‘è‰²å°±å¯ä»¥â€ã€‚æœ‰äººè¯´è¿™å¥è¯æ˜¯å‚²æ…¢å’Œå›ºæ‰§çš„ï¼Œè€Œæœ‰äº›äººåˆ™è¯´è¿™å¥è¯åæ˜ å‡ºäº†ä»–çš„å¹½é»˜ã€‚äº‹å®ä¸Šï¼Œåœ¨è¿™æœ¬è‡ªä¼ å‡ºç‰ˆçš„æ—¶å€™ï¼Œä»–é€šè¿‡ä½¿ç”¨ä¸€ç§å¿«é€Ÿçƒ˜å¹²çš„æ²¹æ¼†é™ä½äº†æˆæœ¬ï¼Œè€Œå½“æ—¶è¿™ç§æ²¹æ¼†åªæœ‰é»‘è‰²çš„ã€‚</p>
<p>ç¦ç‰¹çš„è¿™å¥è‘—åçš„è¯ä¹Ÿå¯ä»¥ç”¨åœ¨æ•°æ®åº“é¢†åŸŸï¼Œå¤šå¹´æ¥ï¼Œæˆ‘ä»¬ä¸€ç›´è¢«å‘ŠçŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»æ„æƒ³è¦çš„æ•°æ®åº“ï¼Œåªè¦å®ƒæ˜¯å…³ç³»å‹æ•°æ®åº“å°±è¡Œã€‚å…³ç³»å‹æ•°æ®åº“å·²ç»å„æ–­åº”ç”¨å¼€å‘é¢†åŸŸå¥½å¤šå¹´äº†ã€‚</p>
<p>éšç€ä¸€äº›ç«äº‰è€…è¿›å…¥æ•°æ®åº“é¢†åŸŸï¼Œå…³ç³»å‹æ•°æ®åº“çš„å„æ–­åœ°ä½å¼€å§‹è¢«å¼±åŒ–ã€‚æ‰€è°“çš„ â€œNoSQLâ€ æ•°æ®åº“å¼€å§‹ä¾µå…¥ç”Ÿäº§å‹çš„åº”ç”¨ä¹‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿè®¤è¯†åˆ°å¹¶æ²¡æœ‰ä¸€ç§å…¨èƒ½å‹çš„æ•°æ®åº“ã€‚ç°åœ¨æœ‰äº†æ›´å¤šçš„å¯é€‰æ–¹æ¡ˆï¼Œæ‰€ä»¥èƒ½å¤Ÿä¸ºè¦è§£å†³çš„é—®é¢˜é€‰æ‹©æœ€ä½³çš„æ•°æ®åº“ã€‚</p>
<p>åœ¨å‰é¢çš„å‡ ç« ä¸­ï¼Œæˆ‘ä»¬å…³æ³¨äºå…³ç³»å‹æ•°æ®åº“ï¼Œé¦–å…ˆä½¿ç”¨ Spring å¯¹ JDBC æ”¯æŒï¼Œç„¶åä½¿ç”¨å¯¹è±¡-å…³ç³»æ˜ å°„ã€‚åœ¨ä¸Šä¸€ç« ï¼Œæˆ‘ä»¬çœ‹åˆ°äº† Spring Data JPAï¼Œå®ƒæ˜¯ Spring Data é¡¹ç›®ä¸‹çš„å¤šä¸ªå­é¡¹ç›®ä¹‹ä¸€ã€‚é€šè¿‡åœ¨è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆ Repository å®ç°ï¼ŒSpring Data JPA èƒ½å¤Ÿè®©ä½¿ç”¨ JPA çš„è¿‡ç¨‹æ›´åŠ ç®€å•å®¹æ˜“ã€‚</p>
<p>Spring Data è¿˜æä¾›äº†å¯¹å¤šç§ NoSQL æ•°æ®åº“çš„æ”¯æŒï¼ŒåŒ…æ‹¬ MongoDBã€Neo4j å’Œ Redisã€‚å®ƒä¸ä»…æ”¯æŒè‡ªåŠ¨åŒ–çš„ Repositoryï¼Œè¿˜æ”¯æŒåŸºäºæ¨¡æ¿çš„æ•°æ®è®¿é—®å’Œæ˜ å°„æ³¨è§£ã€‚åœ¨æœ¬ç« ä¸­ï¼Œå°†ä¼šçœ‹åˆ°å¦‚ä½•ä¸ºéå…³ç³»å‹çš„ NoSQL æ•°æ®åº“ç¼–å†™ Repositoryã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä» Spring Data MongoDB å¼€å§‹ï¼Œçœ‹ä¸€ä¸‹å¦‚ä½•ç¼–å†™ Repository æ¥å¤„ç†åŸºäºæ–‡æ¡£çš„æ•°æ®ã€‚</p>
<h3 id="ä½¿ç”¨-MongoDB-æŒä¹…åŒ–æ–‡æ¡£æ•°æ®"><a href="#ä½¿ç”¨-MongoDB-æŒä¹…åŒ–æ–‡æ¡£æ•°æ®" class="headerlink" title="ä½¿ç”¨ MongoDB æŒä¹…åŒ–æ–‡æ¡£æ•°æ®"></a>ä½¿ç”¨ MongoDB æŒä¹…åŒ–æ–‡æ¡£æ•°æ®</h3><p>æœ‰ä¸€äº›æ•°æ®çš„æœ€ä½³è¡¨ç°å½¢å¼æ˜¯æ–‡æ¡£ï¼ˆdocumentï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸è¦æŠŠè¿™äº›æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªè¡¨ã€èŠ‚ç‚¹æˆ–å®ä½“ä¸­ï¼Œå°†è¿™äº›ä¿¡æ¯æ”¶é›†åˆ°ä¸€ä¸ªéè§„èŒƒåŒ–ï¼ˆä¹Ÿå°±æ˜¯æ–‡æ¡£ï¼‰çš„ç»“æ„ä¸­ä¼šæ›´æœ‰æ„ä¹‰ã€‚å°½ç®¡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„æ–‡æ¡£æœ‰å¯èƒ½ä¼šå½¼æ­¤äº§ç”Ÿå…³è”ï¼Œä½†æ˜¯é€šå¸¸æ¥è®²ï¼Œæ–‡æ¡£æ˜¯ç‹¬ç«‹çš„å®ä½“ã€‚èƒ½å¤ŸæŒ‰ç…§è¿™ç§æ–¹å¼ä¼˜åŒ–å¹¶å¤„ç†æ–‡æ¡£çš„æ•°æ®åº“ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ–‡æ¡£æ•°æ®åº“ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªåº”ç”¨ç¨‹åºæ¥è·å–å¤§å­¦ç”Ÿçš„æˆç»©å•ï¼Œå¯èƒ½éœ€è¦æ ¹æ®å­¦ç”Ÿçš„åå­—æ¥æŸ¥è¯¢å…¶æˆç»©å•ï¼Œæˆ–è€…æ ¹æ®ä¸€äº›é€šç”¨çš„å±æ€§æ¥æŸ¥è¯¢æˆç»©å•ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªå­¦ç”Ÿæ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä»»æ„çš„ä¸¤ä¸ªæˆç»©å•ä¹‹é—´æ²¡æœ‰å¿…è¦ç›¸äº’å…³è”ã€‚å°½ç®¡æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨å…³ç³»å‹æ•°æ®åº“æ¨¡å¼æ¥è·å–æˆç»©å•æ•°æ®ï¼ˆä¹Ÿè®¸ä½ æ›¾ç»è¿™æ ·åšè¿‡ï¼‰ï¼Œä½†æ–‡æ¡£å‹æ•°æ®åº“å¯èƒ½æ‰æ˜¯æ›´å¥½çš„æ–¹æ¡ˆã€‚</p>
<p>æ–‡æ¡£æ•°æ®åº“ä¸é€‚ç”¨äºä»€ä¹ˆåœºæ™¯</p>
<p>äº†è§£æ–‡æ¡£å‹æ•°æ®åº“èƒ½å¤Ÿç”¨äºä»€ä¹ˆåœºæ™¯æ˜¯å¾ˆé‡è¦çš„ã€‚ä½†æ˜¯ï¼ŒçŸ¥é“æ–‡æ¡£å‹æ•°æ®åº“åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¸é€‚ç”¨åŒæ ·ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚æ–‡æ¡£æ•°æ®åº“ä¸æ˜¯é€šç”¨çš„æ•°æ®åº“ï¼Œå®ƒä»¬æ‰€æ“…é•¿è§£å†³çš„æ˜¯ä¸€ä¸ªå¾ˆå°çš„é—®é¢˜é›†ã€‚</p>
<p>æœ‰äº›æ•°æ®å…·æœ‰æ˜æ˜¾çš„å…³è”å…³ç³»ï¼Œæ–‡æ¡£å‹æ•°æ®åº“å¹¶æ²¡æœ‰é’ˆå¯¹å­˜å‚¨è¿™æ ·çš„æ•°æ®è¿›è¡Œä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œç¤¾äº¤ç½‘ç»œè¡¨ç°äº†åº”ç”¨ä¸­ä¸åŒçš„ç”¨æˆ·ä¹‹é—´æ˜¯å¦‚ä½•å»ºç«‹å…³è”çš„ï¼Œè¿™ç§æƒ…å†µå°±ä¸é€‚åˆæ”¾åˆ°æ–‡æ¡£å‹æ•°æ®åº“ä¸­ã€‚åœ¨æ–‡æ¡£æ•°æ®åº“ä¸­å­˜å‚¨å…·æœ‰ä¸°å¯Œå…³è”å…³ç³»çš„æ•°æ®ä¹Ÿå¹¶éå®Œå…¨ä¸å¯èƒ½ï¼Œä½†è¿™æ ·åšçš„è¯ï¼Œä½ é€šå¸¸ä¼šå‘ç°é‡åˆ°çš„æŒ‘æˆ˜è¦å¤šäºæ‰€å¸¦æ¥çš„æ”¶ç›Šã€‚</p>
<p>Spittr åº”ç”¨çš„åŸŸå¯¹è±¡å¹¶ä¸é€‚åˆæ–‡æ¡£æ•°æ®åº“ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨ä¸€ä¸ªè´­ç‰©è®¢å•ç³»ç»Ÿä¸­å­¦ä¹  MongoDBã€‚</p>
<p>MongoDB æ˜¯æœ€ä¸ºæµè¡Œçš„å¼€æºæ–‡æ¡£æ•°æ®åº“ä¹‹ä¸€ã€‚Spring Data MongoDB æä¾›äº†ä¸‰ç§æ–¹å¼åœ¨ Spring åº”ç”¨ä¸­ä½¿ç”¨ MongoDBï¼š</p>
<ul>
<li><p>é€šè¿‡æ³¨è§£å®ç°å¯¹è±¡-æ–‡æ¡£æ˜ å°„ï¼›</p>
</li>
<li><p>ä½¿ç”¨ MongoTemplate å®ç°åŸºäºæ¨¡æ¿çš„æ•°æ®åº“è®¿é—®ï¼›</p>
</li>
<li><p>è‡ªåŠ¨åŒ–çš„è¿è¡Œæ—¶ Repository ç”ŸæˆåŠŸèƒ½ã€‚</p>
</li>
</ul>
<p>æˆ‘ä»¬å·²ç»çœ‹åˆ° Spring Data JPA å¦‚ä½•ä¸ºåŸºäº JPA çš„æ•°æ®è®¿é—®å®ç°è‡ªåŠ¨åŒ– Repository ç”ŸæˆåŠŸèƒ½ã€‚Spring Data MongoDB ä¸ºåŸºäº MongoDB çš„æ•°æ®è®¿é—®æä¾›äº†ç›¸åŒçš„åŠŸèƒ½ã€‚</p>
<p>ä¸è¿‡ï¼Œä¸ Spring Data JPA ä¸åŒçš„æ˜¯ï¼ŒSpring Data MongoDB æä¾›äº†å°† Java å¯¹è±¡æ˜ å°„ä¸ºæ–‡æ¡£çš„åŠŸèƒ½ã€‚ï¼ˆSpring Data JPA æ²¡æœ‰å¿…è¦ä¸º JPA æä¾›è¿™æ ·çš„æ³¨è§£ï¼Œå› ä¸ºJPA è§„èŒƒæœ¬èº«å°±æä¾›äº†å¯¹è±¡-å…³ç³»æ˜ å°„æ³¨è§£ï¼‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒSpring Data MongoDB ä¸ºé€šç”¨çš„æ–‡æ¡£æ“ä½œä»»åŠ¡æä¾›äº†åŸºäºæ¨¡æ¿çš„æ•°æ®è®¿é—®æ–¹å¼ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨è¿™äº›ç‰¹æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦é…ç½® Spring Data MongoDBã€‚</p>
<h4 id="å¯ç”¨-MongoDB"><a href="#å¯ç”¨-MongoDB" class="headerlink" title="å¯ç”¨ MongoDB"></a>å¯ç”¨ MongoDB</h4><p>ä¸ºäº†æœ‰æ•ˆåœ°ä½¿ç”¨ Spring Data MongoDBï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Spring é…ç½®ä¸­æ·»åŠ å‡ ä¸ªå¿…è¦çš„ beanã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦é…ç½® MongoClientï¼Œä»¥ä¾¿äºè®¿é—® MongoDB æ•°æ®åº“ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æœ‰ä¸€ä¸ª MongoTemplate beanï¼Œå®ç°åŸºäºæ¨¡æ¿çš„æ•°æ®åº“è®¿é—®ã€‚æ­¤å¤–ï¼Œä¸æ˜¯å¿…é¡»ï¼Œä½†æ˜¯å¼ºçƒˆæ¨èå¯ç”¨ Spring Data MongoDB çš„è‡ªåŠ¨åŒ– Repository ç”ŸæˆåŠŸèƒ½ã€‚</p>
<p>å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¦‚ä½•ç¼–å†™ç®€å•çš„ Spring Data MongoDB é…ç½®ç±»ï¼Œå®ƒåŒ…å«äº†ä¸Šè¿°çš„å‡ ä¸ª beanï¼š</p>
<center>ç¨‹åºæ¸…å• 12.1ã€€Spring Data MongoDB çš„å¿…è¦é…ç½®</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> orders.config;<span class="keyword">import</span> org.springframework.context.annotation.Bean;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.data.mongodb.core.MongoFactoryBean;<span class="keyword">import</span> org.springframework.data.mongodb.core.MongoOperations;<span class="keyword">import</span> org.springframework.data.mongodb.core.MongoTemplate;<span class="keyword">import</span> org.springframework.data.mongodb.repository.config.EnableMongoRepositories;<span class="keyword">import</span> com.mongodb.Mongo;<span class="meta">@Configuration</span><span class="meta">@EnableMongoRepositories(basePackages = &quot;orders.db&quot;)</span> <span class="comment">// å¯ç”¨ MongoDB çš„ Repository åŠŸèƒ½public class MongoConfig &#123;    @Bean    public MongoFactoryBean mongo() &#123;        MongoFactoryBean mongo = new MongoFactoryBean(); // MongoDBClient bean        mongo.setHost(&quot;localhost&quot;);        return mongo;    &#125;      @Bean    public MongoOperations mongoTemplate(Mongo mongo) &#123; // MongoDBTemplate bean        return new MongoTemplate(mongo, &quot;OrderDB&quot;);    &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ @EnableJpaRepositories æ³¨è§£ï¼Œå¯ç”¨äº† Spring Data çš„è‡ªåŠ¨åŒ– JPA Repository ç”ŸæˆåŠŸèƒ½ã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œ@EnableMongoRepositories ä¸º MongoDB å®ç°äº†ç›¸åŒçš„åŠŸèƒ½ã€‚</p>
<p>é™¤äº† @EnableMongoRepositories ä¹‹å¤–ï¼Œç¨‹åºæ¸…å• 12.1 ä¸­è¿˜åŒ…å«äº†ä¸¤ä¸ªå¸¦æœ‰ @Bean æ³¨è§£çš„æ–¹æ³•ã€‚ç¬¬ä¸€ä¸ª @Bean æ–¹æ³•ä½¿ç”¨ MongoFactoryBean å£°æ˜äº†ä¸€ä¸ª Mongo å®ä¾‹ã€‚è¿™ä¸ª bean å°† Spring Data MongoDB ä¸æ•°æ®åº“æœ¬èº«è¿æ¥äº†èµ·æ¥ï¼ˆä¸ä½¿ç”¨å…³ç³»å‹æ•°æ®æ—¶ DataSource æ‰€åšçš„äº‹æƒ…å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼‰ã€‚å°½ç®¡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ MongoClient ç›´æ¥åˆ›å»º Mongo å®ä¾‹ï¼Œä½†å¦‚æœè¿™æ ·åšçš„è¯ï¼Œå°±å¿…é¡»è¦å¤„ç† MongoClient æ„é€ å™¨æ‰€æŠ›å‡ºçš„ UnknownHostException å¼‚å¸¸ã€‚åœ¨è¿™é‡Œï¼Œä½¿ç”¨ Spring Data MongoDB çš„ MongoFactoryBean æ›´åŠ ç®€å•ã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå·¥å‚ beanï¼Œå› æ­¤ MongoFactoryBean ä¼šè´Ÿè´£æ„å»º Mongo å®ä¾‹ï¼Œæˆ‘ä»¬ä¸å¿…å†æ‹…å¿ƒ UnknownHostException å¼‚å¸¸ã€‚</p>
<p>å¦å¤–ä¸€ä¸ª @Bean æ–¹æ³•å£°æ˜äº† MongoTemplate beanï¼Œåœ¨å®ƒæ„é€ æ—¶ï¼Œä½¿ç”¨äº†å…¶ä»– @Bean æ–¹æ³•æ‰€åˆ›å»ºçš„ Mongo å®ä¾‹çš„å¼•ç”¨ä»¥åŠæ•°æ®åº“çš„åç§°ã€‚ç¨åï¼Œä½ å°†ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨ MongoTemplate æ¥æŸ¥è¯¢æ•°æ®åº“ã€‚å³ä¾¿ä¸ç›´æ¥ä½¿ç”¨ MongoTemplateï¼Œæˆ‘ä»¬ä¹Ÿä¼šéœ€è¦è¿™ä¸ª beanï¼Œå› ä¸º Repository çš„è‡ªåŠ¨åŒ–ç”ŸæˆåŠŸèƒ½åœ¨åº•å±‚ä½¿ç”¨äº†å®ƒã€‚</p>
<p>é™¤äº†ç›´æ¥å£°æ˜è¿™äº› beanï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®©é…ç½®ç±»æ‰©å±• AbstractMongoConfiguration å¹¶é‡è½½ getDatabaseName() å’Œ mongo() æ–¹æ³•ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¦‚ä½•ä½¿ç”¨è¿™ç§é…ç½®æ–¹å¼ã€‚</p>
<center>ç¨‹åºæ¸…å• 12.2ã€€å€ŸåŠ© @EnableMongoRepositories å¯ç”¨ Spring Data MongoDB</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> orders.config;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.data.mongodb.config.AbstractMongoConfiguration;<span class="keyword">import</span> org.springframework.data.mongodb.repository.config.EnableMongoRepositories;<span class="keyword">import</span> com.mongodb.Mongo;<span class="keyword">import</span> com.mongodb.MongoClient;<span class="meta">@Configuration</span><span class="meta">@EnableMongoRepositories(basePackages = &quot;orders.db&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoConfig</span> <span class="keyword">extends</span> <span class="title">AbstractMongoConfiguration</span> </span>&#123;    <span class="meta">@Override</span>	<span class="function"><span class="keyword">protected</span> String <span class="title">getDatabaseName</span><span class="params">()</span> </span>&#123;        <span class="keyword">return</span> <span class="string">&quot;OrdersDB&quot;</span>; <span class="comment">// æŒ‡å®šæ•°æ®åº“åç§°	&#125;		@Override	public Mongo mongo() throws Exception &#123;		return new MongoClient(); // åˆ›å»º Mongo å®¢æˆ·ç«¯	&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–°çš„é…ç½®ç±»ä¸ç¨‹åºæ¸…å• 12.1 çš„åŠŸèƒ½æ˜¯ç›¸åŒçš„ï¼Œåªä¸è¿‡åœ¨ç¯‡å¹…ä¸Šæ›´åŠ ç®€æ´ã€‚æœ€ä¸ºæ˜¾è‘—çš„åŒºåˆ«åœ¨äºè¿™ä¸ªé…ç½®ä¸­æ²¡æœ‰ç›´æ¥å£°æ˜ MongoTemplate beanï¼Œå½“ç„¶å®ƒè¿˜æ˜¯ä¼šè¢«éšå¼åœ°åˆ›å»ºã€‚æˆ‘ä»¬åœ¨è¿™é‡Œé‡è½½äº† getDatabaseName() æ–¹æ³•æ¥æä¾›æ•°æ®åº“çš„åç§°ã€‚mongo() æ–¹æ³•ä¾ç„¶ä¼šåˆ›å»ºä¸€ä¸ª MongoClient çš„å®ä¾‹ï¼Œå› ä¸ºå®ƒä¼šæŠ›å‡º Exceptionï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ MongoClientï¼Œè€Œä¸å¿…å†ä½¿ç”¨ MongoFactoryBean äº†ã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸ç®¡æ˜¯ä½¿ç”¨ç¨‹åºæ¸…å• 12.1 è¿˜æ˜¯ 12.2ï¼Œéƒ½ä¸º Spring Data MongoDB æä¾›äº†ä¸€ä¸ªè¿è¡Œé…ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ MongoDB æœåŠ¡å™¨è¿è¡Œåœ¨æœ¬åœ°å³å¯ã€‚å¦‚æœMongoDB æœåŠ¡å™¨è¿è¡Œåœ¨å…¶ä»–çš„æœºå™¨ä¸Šï¼Œé‚£ä¹ˆå¯ä»¥åœ¨åˆ›å»º MongoClient çš„æ—¶å€™è¿›è¡ŒæŒ‡å®šï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Mongo <span class="title">mongo</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> MongoClient(<span class="string">&quot;mongodbserver&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>å¦å¤–ï¼ŒMongoDB æœåŠ¡å™¨æœ‰å¯èƒ½ç›‘å¬çš„ç«¯å£å¹¶ä¸æ˜¯é»˜è®¤çš„ 27017ã€‚å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œåœ¨åˆ›å»º MongoClient çš„æ—¶å€™ï¼Œè¿˜éœ€è¦æŒ‡å®šç«¯å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Mongo <span class="title">mongo</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> MongoClient(<span class="string">&quot;mongodbserver&quot;</span>, <span class="number">37017</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ MongoDB æœåŠ¡å™¨è¿è¡Œåœ¨ç”Ÿäº§é…ç½®ä¸Šï¼Œæˆ‘è®¤ä¸ºä½ å¯èƒ½è¿˜å¯ç”¨äº†è®¤è¯åŠŸèƒ½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†è®¿é—®æ•°æ®åº“ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æä¾›åº”ç”¨çš„å‡­è¯ã€‚è®¿é—®éœ€è¦è®¤è¯çš„ MongoDB æœåŠ¡å™¨ç¨å¾®æœ‰äº›å¤æ‚ï¼Œå¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºã€‚</p>
<center>ç¨‹åºæ¸…å• 12.3ã€€åˆ›å»º MongoClient æ¥è®¿é—®éœ€è¦è®¤è¯çš„ MongoDB æœåŠ¡å™¨</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowiredprivate</span> Environment env;<span class="meta">@Overridepublic</span> <span class="function">Mongo <span class="title">mongo</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;  MongoCredential credential =    MongoCredential.createMongoCRCredential( <span class="comment">// åˆ›å»º MongoDB å‡­è¯      env.getProperty(&quot;mongo.username&quot;),      &quot;OrderDB&quot;,      env.getProperty(&quot;mongo.password&quot;).toCharArray());    return new MongoClient(    nwe ServerAddress(&quot;localhost&quot;, 37017), //åˆ›å»º MongoClient    Arrays.asList(credential));&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†è®¿é—®éœ€è¦è®¤è¯çš„ MongoDB æœåŠ¡å™¨ï¼ŒMongoClient åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å¿…é¡»è¦æœ‰ä¸€ä¸ª MongoCredential çš„åˆ—è¡¨ã€‚åœ¨ç¨‹åºæ¸…å• 12.3 ä¸­ï¼Œæˆ‘ä»¬ä¸ºæ­¤åˆ›å»ºäº†ä¸€ä¸ª MongoCredentialã€‚ä¸ºäº†å°†å‡­è¯ä¿¡æ¯çš„ç»†èŠ‚æ”¾åœ¨é…ç½®ç±»å¤–è¾¹ï¼Œå®ƒä»¬æ˜¯é€šè¿‡æ³¨å…¥çš„ Environment å¯¹è±¡è§£æå¾—åˆ°çš„ã€‚</p>
<p>ä¸ºäº†ä½¿è¿™ä¸ªè®¨è®ºæ›´åŠ å®Œæ•´ï¼ŒSpring Data MongoDB è¿˜æ”¯æŒé€šè¿‡ XML æ¥è¿›è¡Œé…ç½®ã€‚ä½ å¯èƒ½ä¹ŸçŸ¥é“ï¼Œæˆ‘æ›´å–œæ¬¢ Java é…ç½®çš„æ–¹æ¡ˆã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å–œæ¬¢ XML é…ç½®çš„è¯ï¼Œå¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¦‚ä½•ä½¿ç”¨ mongo é…ç½®å‘½åç©ºé—´æ¥é…ç½® Spring Data MongoDBã€‚</p>
<center>ç¨‹åºæ¸…å• 12.4ã€€Spring Data MongoDB æä¾›äº† XML é…ç½®çš„æ–¹æ¡ˆ</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xmlns:mongo</span>=<span class="string">&quot;http://www.springframework.org/schema/data/mongo&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;    http://www.springframework.org/schema/data/mongo    http://www.springframework.org/schema/data/mongo/spring-mongo.xsd    http://www.springframework.org/schema/beans    http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span> &gt;</span>      <span class="tag">&lt;<span class="name">mongo:repositories</span> <span class="attr">base-package</span>=<span class="string">&quot;order.db&quot;</span> /&gt;</span>    <span class="tag">&lt;<span class="name">mongo:mongo</span> /&gt;</span>    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mongoTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.mongodb.core.MongoTemplate&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;mongo&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;OrderDB&quot;</span>&gt;</span>  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ Spring Data MongoDB å·²ç»é…ç½®å®Œæˆäº†ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±å¯ä»¥ä½¿ç”¨å®ƒæ¥ä¿å­˜å’ŒæŸ¥è¯¢æ–‡æ¡£äº†ã€‚ä½†é¦–å…ˆï¼Œéœ€è¦ä½¿ç”¨ Spring Data MongoDB çš„å¯¹è±¡-æ–‡æ¡£æ˜ å°„æ³¨è§£ä¸ºJava é¢†åŸŸå¯¹è±¡å»ºç«‹åˆ°æŒä¹…åŒ–æ–‡æ¡£çš„æ˜ å°„å…³ç³»ã€‚</p>
<h4 id="ä¸ºæ¨¡å‹æ·»åŠ æ³¨è§£ï¼Œå®ç°-MongoDB-æŒä¹…åŒ–"><a href="#ä¸ºæ¨¡å‹æ·»åŠ æ³¨è§£ï¼Œå®ç°-MongoDB-æŒä¹…åŒ–" class="headerlink" title="ä¸ºæ¨¡å‹æ·»åŠ æ³¨è§£ï¼Œå®ç° MongoDB æŒä¹…åŒ–"></a>ä¸ºæ¨¡å‹æ·»åŠ æ³¨è§£ï¼Œå®ç° MongoDB æŒä¹…åŒ–</h4><p>å½“ä½¿ç”¨ JPA çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°† Java å®ä½“ç±»æ˜ å°„åˆ°å…³ç³»å‹è¡¨å’Œåˆ—ä¸Šã€‚JPA è§„èŒƒæä¾›äº†ä¸€äº›æ”¯æŒå¯¹è±¡-å…³ç³»æ˜ å°„çš„æ³¨è§£ï¼Œè€Œæœ‰ä¸€äº› JPA å®ç°ï¼Œå¦‚ Hibernateï¼Œä¹Ÿæ·»åŠ äº†è‡ªå·±çš„æ˜ å°„æ³¨è§£ã€‚</p>
<p>ä½†æ˜¯ï¼ŒMongoDB å¹¶æ²¡æœ‰æä¾›å¯¹è±¡-æ–‡æ¡£æ˜ å°„çš„æ³¨è§£ã€‚Spring Data MongoDB å¡«è¡¥äº†è¿™ä¸€ç©ºç™½ï¼Œæä¾›äº†ä¸€äº›å°† Java ç±»å‹æ˜ å°„ä¸º MongoDB æ–‡æ¡£çš„æ³¨è§£ã€‚è¡¨ 12.1 æè¿°äº†è¿™äº›æ³¨è§£ã€‚</p>
<center>è¡¨ 12.1ã€€ç”¨äºå¯¹è±¡-æ–‡æ¡£æ˜ å°„çš„ Spring Data MongoDB æ³¨è§£</center>

<table>
<thead>
<tr>
<th>æ³¨ã€€ã€€è§£</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>@Document</td>
<td>æ ‡ç¤ºæ˜ å°„åˆ° MongoDB æ–‡æ¡£ä¸Šçš„é¢†åŸŸå¯¹è±¡</td>
</tr>
<tr>
<td>@Id</td>
<td>æ ‡ç¤ºæŸä¸ªåŸŸä¸º ID åŸŸ</td>
</tr>
<tr>
<td>@DbRef</td>
<td>æ ‡ç¤ºæŸä¸ªåŸŸè¦å¼•ç”¨å…¶ä»–çš„æ–‡æ¡£ï¼Œè¿™ä¸ªæ–‡æ¡£æœ‰å¯èƒ½ä½äºå¦å¤–ä¸€ä¸ªæ•°æ®åº“ä¸­</td>
</tr>
<tr>
<td>@Field</td>
<td>ä¸ºæ–‡æ¡£åŸŸæŒ‡å®šè‡ªå®šä¹‰çš„å…ƒæ•°æ®</td>
</tr>
<tr>
<td>@Version</td>
<td>æ ‡ç¤ºæŸä¸ªå±æ€§ç”¨ä½œç‰ˆæœ¬åŸŸ</td>
</tr>
</tbody></table>
<p>@Document å’Œ @Idæ³¨è§£ç±»ä¼¼äº JPA çš„ @Entity å’Œ @Id æ³¨è§£ã€‚æˆ‘ä»¬å°†ä¼šç»å¸¸ä½¿ç”¨è¿™ä¸¤ä¸ªæ³¨è§£ï¼Œå¯¹äºè¦ä»¥æ–‡æ¡£å½¢å¼ä¿å­˜åˆ° MongoDB æ•°æ®åº“çš„æ¯ä¸ª Java ç±»å‹éƒ½ä¼šä½¿ç”¨è¿™ä¸¤ä¸ªæ³¨è§£ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¦‚ä½•ä¸º Order ç±»æ·»åŠ æ³¨è§£ï¼Œå®ƒä¼šè¢«æŒä¹…åŒ–åˆ° MongoDB ä¸­ã€‚</p>
<center>ç¨‹åºæ¸…å• 12.5ã€€Spring Data MongoDB æ³¨è§£å°† Java ç±»å‹æ˜ å°„ä¸ºæ–‡æ¡£</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> orders;<span class="keyword">import</span> java.util.Collection;<span class="keyword">import</span> java.util.LinkedHashSet;<span class="keyword">import</span> org.springframework.data.annotation.Id;<span class="keyword">import</span> org.springframework.data.mongodb.core.mapping.Document;<span class="keyword">import</span> org.springframework.data.mongodb.core.mapping.Field;<span class="meta">@Document</span> <span class="comment">// è¿™æ˜¯ä¸€ä¸ªæ–‡æ¡£public class Order &#123;        @Id // æŒ‡å®š id    private String id;    @Field(&quot;customer&quot;) // è¦†ç›–é»˜è®¤çš„åŸŸå    private String customer;    private String type;    private Collection&lt;Item&gt; items = new LinkedHashSet&lt;Item&gt;();    public String getCustomer() &#123;        return customer;    &#125;    public void setCustomer(String customer) &#123;        this.customer = customer;    &#125;    public String getType() &#123;        return type;    &#125;    public void setType(String type) &#123;        this.type = type;    &#125;    public Collection&lt;Item&gt; getItems() &#123;        return items;    &#125;    public void setItems(Collection&lt;Item&gt; items) &#123;        this.items = items;    &#125;    public String getId() &#123;        return id;    &#125;	&#125;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒOrder ç±»æ·»åŠ äº† @Document æ³¨è§£ï¼Œè¿™æ ·å®ƒå°±èƒ½å¤Ÿå€ŸåŠ© MongoTemplate æˆ–è‡ªåŠ¨ç”Ÿæˆçš„ Repository è¿›è¡ŒæŒä¹…åŒ–ã€‚å…¶ id å±æ€§ä¸Šä½¿ç”¨äº† @Id æ³¨è§£ï¼Œç”¨æ¥æŒ‡å®šå®ƒä½œä¸ºæ–‡æ¡£çš„ IDã€‚é™¤æ­¤ä¹‹å¤–ï¼Œcustomer å±æ€§ä¸Šä½¿ç”¨äº† @Field æ³¨è§£ï¼Œè¿™æ ·çš„è¯ï¼Œå½“æ–‡æ¡£æŒä¹…åŒ–çš„æ—¶å€™ customer å±æ€§å°†ä¼šæ˜ å°„ä¸ºåä¸ºclientçš„åŸŸã€‚</p>
<p>æ³¨æ„ï¼Œå…¶ä»–çš„å±æ€§å¹¶æ²¡æœ‰æ·»åŠ æ³¨è§£ã€‚é™¤éå°†å±æ€§è®¾ç½®ä¸ºç¬æ—¶æ€ï¼ˆtransientï¼‰çš„ï¼Œå¦åˆ™ Java å¯¹è±¡ä¸­æ‰€æœ‰çš„åŸŸéƒ½ä¼šæŒä¹…åŒ–ä¸ºæ–‡æ¡£ä¸­çš„åŸŸã€‚å¹¶ä¸”å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨ @Field æ³¨è§£è¿›è¡Œè®¾ç½®çš„è¯ï¼Œé‚£ä¹ˆæ–‡æ¡£åŸŸä¸­çš„åå­—å°†ä¼šä¸å¯¹åº”çš„ Java å±æ€§ç›¸åŒã€‚</p>
<p>åŒæ—¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ items å±æ€§ï¼Œå®ƒæŒ‡çš„æ˜¯è®¢å•ä¸­å…·ä½“æ¡ç›®çš„é›†åˆã€‚åœ¨ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œè¿™äº›æ¡ç›®å°†ä¼šä¿å­˜åœ¨å¦å¤–çš„ä¸€ä¸ªæ•°æ®åº“è¡¨ä¸­ï¼Œé€šè¿‡å¤–é”®è¿›è¡Œåº”ç”¨ï¼Œ items åŸŸä¸Šå¾ˆå¯èƒ½è¿˜ä¼šä½¿ç”¨ JPA çš„ @OneToMany æ³¨è§£ã€‚ä½†åœ¨è¿™é‡Œï¼Œæƒ…å½¢å®Œå…¨ä¸åŒã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211108095702675.png" alt="image-20211108095702675"></p>
<center>å›¾ 12.1ã€€æ–‡æ¡£å±•ç°äº†å…³è”ä½†éè§„èŒƒåŒ–çš„æ•°æ®ã€‚ç›¸å…³çš„æ¦‚å¿µï¼ˆå¦‚è®¢å•ä¸­çš„æ¡ç›®ï¼‰è¢«åµŒå…¥åˆ°é¡¶å±‚çš„æ–‡æ¡£æ•°æ®ä¸­</center>

<p>å¦‚æˆ‘å‰é¢æ‰€è¿°ï¼Œæ–‡æ¡£å¯ä»¥ä¸å…¶ä»–çš„æ–‡æ¡£äº§ç”Ÿå…³è”ï¼Œä½†è¿™å¹¶ä¸æ˜¯æ–‡æ¡£æ•°æ®åº“æ‰€æ“…é•¿çš„åŠŸèƒ½ã€‚åœ¨æœ¬ä¾‹è´­ä¹°è®¢å•ä¸è¡Œæ¡ç›®ä¹‹é—´çš„å…³è”å…³ç³»ä¸­ï¼Œè¡Œæ¡ç›®åªæ˜¯åŒä¸€ä¸ªè®¢å•æ–‡æ¡£é‡Œé¢å†…åµŒçš„ä¸€éƒ¨åˆ†ï¼ˆå¦‚å›¾ 12.1 æ‰€ç¤ºï¼‰ã€‚å› æ­¤ï¼Œæ²¡æœ‰å¿…è¦ä¸ºè¿™ç§å…³è”å…³ç³»æ·»åŠ ä»»ä½•æ³¨è§£ã€‚å®é™…ä¸Šï¼ŒItem ç±»æœ¬èº«å¹¶æ²¡æœ‰ä»»ä½•æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> orders;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;		<span class="keyword">private</span> Long id;		<span class="keyword">private</span> Order order;	<span class="keyword">private</span> String product;		<span class="keyword">private</span> <span class="keyword">double</span> price;		<span class="keyword">private</span> <span class="keyword">int</span> quantity;		<span class="function"><span class="keyword">public</span> Order <span class="title">getOrder</span><span class="params">()</span> </span>&#123;		<span class="keyword">return</span> order;	&#125;	<span class="function"><span class="keyword">public</span> String <span class="title">getProduct</span><span class="params">()</span> </span>&#123;		<span class="keyword">return</span> product;	&#125;	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(String product)</span> </span>&#123;		<span class="keyword">this</span>.product = product;	&#125;	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;		<span class="keyword">return</span> price;	&#125;	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">double</span> price)</span> </span>&#123;		<span class="keyword">this</span>.price = price;	&#125;	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getQuantity</span><span class="params">()</span> </span>&#123;		<span class="keyword">return</span> quantity;	&#125;	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQuantity</span><span class="params">(<span class="keyword">int</span> quantity)</span> </span>&#123;		<span class="keyword">this</span>.quantity = quantity;	&#125;	<span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;		<span class="keyword">return</span> id;	&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ²¡æœ‰å¿…è¦ä¸º Item æ·»åŠ  @Document æ³¨è§£ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦ä¸ºå®ƒçš„åŸŸæŒ‡å®š @Idã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¸ä¼šå•ç‹¬å°† Item æŒä¹…åŒ–ä¸ºæ–‡æ¡£ã€‚å®ƒå§‹ç»ˆä¼šæ˜¯ Order æ–‡æ¡£ä¸­ Item åˆ—è¡¨çš„ä¸€ä¸ªæˆå‘˜ï¼Œå¹¶ä¸”ä¼šä½œä¸ºæ–‡æ¡£ä¸­çš„åµŒå…¥å…ƒç´ ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœä½ æƒ³æŒ‡å®š Item ä¸­çš„æŸä¸ªåŸŸå¦‚ä½•æŒä¹…åŒ–åˆ°æ–‡æ¡£ä¸­ï¼Œé‚£ä¹ˆå¯ä»¥ä¸ºå¯¹åº”çš„ Item å±æ€§æ·»åŠ  @Field æ³¨è§£ã€‚ä¸è¿‡åœ¨æœ¬ä¾‹ä¸­ï¼Œå¹¶æ²¡æœ‰å¿…è¦è¿™æ ·åšã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨å·²ç»ä¸º Java å¯¹è±¡æ·»åŠ äº† MongoDB æŒä¹…åŒ–çš„æ³¨è§£ã€‚æ¥ä¸‹æ¥ï¼Œçœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ MongoTemplate æ¥å­˜å‚¨å®ƒä»¬ã€‚</p>
<h4 id="ä½¿ç”¨-MongoTemplate-è®¿é—®-MongoDB"><a href="#ä½¿ç”¨-MongoTemplate-è®¿é—®-MongoDB" class="headerlink" title="ä½¿ç”¨ MongoTemplate è®¿é—® MongoDB"></a>ä½¿ç”¨ MongoTemplate è®¿é—® MongoDB</h4><p>æˆ‘ä»¬å·²ç»åœ¨é…ç½®ç±»ä¸­é…ç½®äº† MongoTemplate beanï¼Œä¸ç®¡æ˜¯æ˜¾å¼å£°æ˜è¿˜æ˜¯æ‰©å±• AbstractMongoConfiguration éƒ½èƒ½å®ç°ç›¸åŒçš„æ•ˆæœã€‚æ¥ä¸‹æ¥ï¼Œéœ€è¦åšçš„å°±æ˜¯å°†å…¶æ³¨å…¥åˆ°ä½¿ç”¨å®ƒçš„åœ°æ–¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutowiredMongoOperations</span> mongo;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°† MongoTemplate æ³¨å…¥åˆ°ä¸€ä¸ªç±»å‹ä¸º MongoOperations çš„å±æ€§ä¸­ã€‚MongoOperations æ˜¯ MongoTemplate æ‰€å®ç°çš„æ¥å£ï¼Œä¸ä½¿ç”¨å…·ä½“å®ç°æ˜¯ä¸€ä¸ªå¥½çš„åšæ³•ï¼Œå°¤å…¶æ˜¯åœ¨æ³¨å…¥çš„æ—¶å€™ã€‚</p>
<p>MongoOperations æš´éœ²äº†å¤šä¸ªä½¿ç”¨ MongoDB æ–‡æ¡£æ•°æ®åº“çš„æ–¹æ³•ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸å¯èƒ½è®¨è®ºæ‰€æœ‰çš„æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥çœ‹ä¸€ä¸‹æœ€ä¸ºå¸¸ç”¨çš„å‡ ä¸ªæ“ä½œï¼Œæ¯”å¦‚è®¡ç®—æ–‡æ¡£é›†åˆä¸­æœ‰å¤šå°‘æ¡æ–‡æ¡£ã€‚ä½¿ç”¨æ³¨å…¥çš„ MongoOperationsï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° Order é›†åˆå¹¶è°ƒç”¨ count() æ¥å¾—åˆ°æ•°é‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> orderCount = mongo.getCollection(<span class="string">&quot;order&quot;</span>).count();</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œå‡è®¾è¦ä¿å­˜ä¸€ä¸ªæ–°çš„ Orderã€‚ä¸ºäº†å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ save() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Order order = <span class="keyword">new</span> Order();... <span class="comment">// set properties and add line itemmongo.save(order, &quot;order&quot;);</span></span><br></pre></td></tr></table></figure>

<p>save() æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–°åˆ›å»ºçš„ Orderï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦ä¿å­˜çš„æ–‡æ¡£å­˜å‚¨çš„åç§°ã€‚</p>
<p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è°ƒç”¨ findById() æ–¹æ³•æ¥æ ¹æ® ID æŸ¥æ‰¾è®¢å•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String orderId = ...;Order order = mongo.findById(orderId, Order.class);</span><br></pre></td></tr></table></figure>

<p>å¯¹äºæ›´é«˜çº§çš„æŸ¥è¯¢ï¼Œæˆ‘ä»¬éœ€è¦æ„é€  Query å¯¹è±¡å¹¶å°†å…¶ä¼ é€’ç»™ find() æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œè¦æŸ¥æ‰¾æ‰€æœ‰ client åŸŸç­‰äº â€œChuck Wagonâ€ çš„è®¢å•ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Order&gt; chucksOrders = mongo.find(  Query.query(Criteria.where(<span class="string">&quot;client&quot;</span>).is(<span class="string">&quot;Chuck Wagon&quot;</span>)), Order.class);</span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œç”¨æ¥æ„é€  Query å¯¹è±¡çš„ Criteria åªæ£€æŸ¥äº†ä¸€ä¸ªåŸŸï¼Œä½†æ˜¯å®ƒä¹Ÿå¯ä»¥ç”¨æ¥æ„é€ æ›´åŠ æœ‰æ„æ€çš„æŸ¥è¯¢ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦æŸ¥è¯¢ Chuck æ‰€æœ‰é€šè¿‡ Web åˆ›å»ºçš„è®¢å•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Order&gt; chucksWebOrders = mongo.find(Query.query(  Criteria.where(<span class="string">&quot;customer&quot;</span>).is(<span class="string">&quot;Chuck Wagon&quot;</span>)    .and(<span class="string">&quot;type&quot;</span>).is(<span class="string">&quot;WEB&quot;</span>)), Order.class);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æƒ³ç§»é™¤æŸä¸€ä¸ªæ–‡æ¡£çš„è¯ï¼Œé‚£ä¹ˆå°±åº”è¯¥ä½¿ç”¨ remove() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo.remove(order);</span><br></pre></td></tr></table></figure>

<p>å¦‚æˆ‘å‰é¢æ‰€è¿°ï¼ŒMongoOperations æœ‰å¤šä¸ªæ“ä½œæ–‡æ¡£æ•°æ®çš„æ–¹æ³•ã€‚æˆ‘å»ºè®®ä½ æŸ¥çœ‹ä¸€ä¸‹å…¶ JavaDoc æ–‡æ¡£ï¼Œä»¥äº†è§£é€šè¿‡ MongoOperations éƒ½èƒ½å®Œæˆä»€ä¹ˆåŠŸèƒ½ã€‚</p>
<p>é€šå¸¸æ¥è®²ï¼Œæˆ‘ä»¬ä¼šå°† MongoOperations æ³¨å…¥åˆ°è‡ªå·±è®¾è®¡çš„ Repository ç±»ä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒçš„æ“ä½œæ¥å®ç° Repository æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä¸æ„¿æ„ç¼–å†™ Repository çš„è¯ï¼Œé‚£ä¹ˆ Spring Data MongoDB èƒ½å¤Ÿè‡ªåŠ¨åœ¨è¿è¡Œæ—¶ç”Ÿæˆ Repository å®ç°ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<h4 id="ç¼–å†™-MongoDB-Repository"><a href="#ç¼–å†™-MongoDB-Repository" class="headerlink" title="ç¼–å†™ MongoDB Repository"></a>ç¼–å†™ MongoDB Repository</h4><p>ä¸ºäº†ç†è§£å¦‚ä½•ä½¿ç”¨ Spring Data MongoDB æ¥åˆ›å»º Repositoryï¼Œè®©æˆ‘ä»¬å…ˆå›å¿†ä¸€ä¸‹åœ¨ç¬¬ 11 ç« ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨ Spring Data JPA çš„ã€‚åœ¨ç¨‹åºæ¸…å• 11.4 ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ‰©å±•è‡ª JpaRepository çš„ SpitterRepository æ¥å£ã€‚åœ¨é‚£ä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ç”¨äº† SpringData JPA Repository åŠŸèƒ½ã€‚è¿™æ ·çš„ç»“æœå°±æ˜¯ Spring Data JPA èƒ½å¤Ÿè‡ªåŠ¨åˆ›å»ºæ¥å£çš„å®ç°ï¼Œå…¶ä¸­åŒ…æ‹¬äº†å¤šä¸ªå†…ç½®çš„æ–¹æ³•ä»¥åŠæˆ‘ä»¬æ‰€æ·»åŠ çš„éµå¾ªå‘½åçº¦å®šçš„æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬å·²ç»é€šè¿‡ @EnableMongoRepositories æ³¨è§£å¯ç”¨äº† Spring Data MongoDB çš„ Repository åŠŸèƒ½ï¼Œæ¥ä¸‹æ¥éœ€è¦åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ¥å£ï¼ŒRepository å®ç°è¦åŸºäºè¿™ä¸ªæ¥å£æ¥ç”Ÿæˆã€‚ä¸è¿‡ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸å†æ‰©å±• JpaRepositoryï¼Œè€Œæ˜¯è¦æ‰©å±• MongoRepositoryã€‚å¦‚ä¸‹ç¨‹åºæ¸…å•ä¸­çš„ OrderRepository æ‰©å±•äº† MongoRepositoryï¼Œä¸º Order æ–‡æ¡£æä¾›äº†åŸºæœ¬çš„ CRUD æ“ä½œã€‚</p>
<center>ç¨‹åºæ¸…å• 12.6ã€€Spring Data MongoDB ä¼šè‡ªåŠ¨å®ç° Repository æ¥å£</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> orders.db;<span class="keyword">import</span> orders.Order;<span class="keyword">import</span> org.springframework.data.mongodb.repository.MongoRepository;<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderRepository</span> <span class="keyword">extends</span> <span class="title">MongoRepository</span>&lt;<span class="title">Order</span>, <span class="title">String</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸º OrderRepository æ‰©å±•äº†MongoRepositoryï¼Œå› æ­¤å®ƒå°±ä¼šä¼ é€’æ€§åœ°æ‰©å±• Repository æ ‡è®°æ¥å£ã€‚å›å¿†ä¸€ä¸‹æˆ‘ä»¬åœ¨å­¦ä¹  Spring Data JPA æ—¶æ‰€äº†è§£çš„çŸ¥è¯†ï¼Œä»»ä½•æ‰©å±• Repository çš„æ¥å£å°†ä¼šåœ¨è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆå®ç°ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå¹¶ä¸ä¼šå®ç°ä¸å…³ç³»å‹æ•°æ®åº“äº¤äº’çš„ JPA Repositoryï¼Œè€Œæ˜¯ä¼šä¸º OrderRepository ç”Ÿæˆè¯»å–å’Œå†™å…¥æ•°æ®åˆ° MongoDB æ–‡æ¡£æ•°æ®åº“çš„å®ç°ã€‚</p>
<p>MongoRepository æ¥å£æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¸¦æœ‰ @Document æ³¨è§£çš„å¯¹è±¡ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯¥ Repository è¦å¤„ç†çš„ç±»å‹ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¸¦æœ‰ @Id æ³¨è§£çš„å±æ€§ç±»å‹ã€‚</p>
<p>å°½ç®¡ OrderRepository æœ¬èº«å¹¶æ²¡æœ‰å®šä¹‰ä»»ä½•æ–¹æ³•ï¼Œä½†æ˜¯å®ƒä¼šç»§æ‰¿å¤šä¸ªæ–¹æ³•ï¼ŒåŒ…æ‹¬å¯¹ Order æ–‡æ¡£è¿›è¡Œ CRUD æ“ä½œçš„æ–¹æ³•ã€‚è¡¨ 12.2 æè¿°äº† OrderRepository ç»§æ‰¿çš„æ‰€æœ‰æ–¹æ³•ã€‚</p>
<center>è¡¨ 12.2ã€€é€šè¿‡æ‰©å±• MongoRepositoryï¼ŒRepository æ¥å£èƒ½å¤Ÿç»§æ‰¿å¤šä¸ª CRUD æ“ä½œï¼Œå®ƒä»¬ä¼šç”± Spring Data MongoDB è‡ªåŠ¨å®ç°</center>

<table>
<thead>
<tr>
<th>æ–¹ã€€ã€€æ³•</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td><code>long count();</code></td>
<td>è¿”å›æŒ‡å®š Repository ç±»å‹çš„æ–‡æ¡£æ•°é‡</td>
</tr>
<tr>
<td><code>void delete(Iterable&lt;? extends T);</code></td>
<td>åˆ é™¤ä¸æŒ‡å®šå¯¹è±¡å…³è”çš„æ‰€æœ‰æ–‡æ¡£</td>
</tr>
<tr>
<td><code>void delete(T);</code></td>
<td>åˆ é™¤ä¸æŒ‡å®šå¯¹è±¡å…³è”çš„æ–‡æ¡£</td>
</tr>
<tr>
<td><code>void delete(ID);</code></td>
<td>æ ¹æ® ID åˆ é™¤æŸä¸€ä¸ªæ–‡æ¡£</td>
</tr>
<tr>
<td><code>void deleteAll();</code></td>
<td>åˆ é™¤æŒ‡å®š Repository ç±»å‹çš„æ‰€æœ‰æ–‡æ¡£</td>
</tr>
<tr>
<td><code>boolean exists(Object);</code></td>
<td>å¦‚æœå­˜åœ¨ä¸æŒ‡å®šå¯¹è±¡ç›¸å…³è”çš„æ–‡æ¡£ï¼Œåˆ™è¿”å› true</td>
</tr>
<tr>
<td><code>boolean exists(ID);</code></td>
<td>å¦‚æœå­˜åœ¨æŒ‡å®š ID çš„æ–‡æ¡£ï¼Œåˆ™è¿”å› true</td>
</tr>
<tr>
<td><code>List&lt;T&gt; findAll();</code></td>
<td>è¿”å›æŒ‡å®š Repository ç±»å‹çš„æ‰€æœ‰æ–‡æ¡£</td>
</tr>
<tr>
<td><code>List&lt;T&gt; findAll(Iterable&lt;ID&gt;);</code></td>
<td>è¿”å›æŒ‡å®šæ–‡æ¡£ ID å¯¹åº”çš„æ‰€æœ‰æ–‡æ¡£</td>
</tr>
<tr>
<td></td>
<td>ä¸ºæŒ‡å®šçš„ Repository ç±»å‹ï¼Œè¿”å›åˆ†é¡µä¸”æ’åºçš„æ–‡æ¡£åˆ—è¡¨</td>
</tr>
<tr>
<td><code>List&lt;T&gt; findAll(Sort);</code></td>
<td>ä¸ºæŒ‡å®šçš„ Repository ç±»å‹ï¼Œè¿”å›æ’åºåçš„æ‰€æœ‰æ–‡æ¡£åˆ—è¡¨</td>
</tr>
<tr>
<td><code>T findOne(ID);</code></td>
<td>ä¸ºæŒ‡å®šçš„ ID è¿”å›å•ä¸ªæ–‡æ¡£</td>
</tr>
<tr>
<td><code>save( terable&lt;s&gt;) ;</code></td>
<td>ä¿å­˜æŒ‡å®š Iterable ä¸­çš„æ‰€æœ‰æ–‡æ¡£</td>
</tr>
<tr>
<td><code>save ( &lt; S &gt; );</code></td>
<td>ä¸ºç»™å®šçš„å¯¹è±¡ä¿å­˜ä¸€æ¡æ–‡æ¡£</td>
</tr>
</tbody></table>
<p>è¡¨ 12.2 ä¸­çš„æ–¹æ³•ä½¿ç”¨äº†ä¼ é€’è¿›æ¥å’Œæ–¹æ³•è¿”å›çš„æ³›å‹ã€‚OrderRepository æ‰©å±•äº† MongoRepository&lt;Order, String&gt;ï¼Œé‚£ä¹ˆ T å°±æ˜ å°„ä¸º Orderï¼ŒID æ˜ å°„ä¸º Stringï¼Œè€Œ S æ˜ å°„ä¸ºæ‰€æœ‰æ‰©å±• Order çš„ç±»å‹ã€‚</p>
<p>æ·»åŠ è‡ªå®šä¹‰çš„æŸ¥è¯¢æ–¹æ³•</p>
<p>é€šå¸¸æ¥è®²ï¼ŒCRUD æ“ä½œæ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œä½†æˆ‘ä»¬æœ‰æ—¶å€™å¯èƒ½å¸Œæœ› Repository æä¾›é™¤å†…ç½®æ–¹æ³•ä»¥å¤–çš„å…¶ä»–æ–¹æ³•ã€‚</p>
<p>åœ¨ 11.3.1 å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº† Spring Data JPA æ”¯æŒæ–¹æ³•å‘½åçº¦å®šï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ© Spring Data ä¸ºéµå¾ªçº¦å®šçš„æ–¹æ³•è‡ªåŠ¨ç”Ÿæˆå®ç°ã€‚å®é™…ä¸Šï¼Œç›¸åŒçš„çº¦å®šä¹Ÿé€‚ç”¨äº Spring Data MongoDBã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä¸º OrderRepository æ·»åŠ è‡ªå®šä¹‰çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderReporitory</span> <span class="keyword">extends</span> <span class="title">MongoRepository</span>&lt;<span class="title">Order</span>, <span class="title">String</span>&gt; </span>&#123;  <span class="function">List&lt;Order&gt; <span class="title">findByCustomer</span><span class="params">(String c)</span></span>;  <span class="function">List&lt;Order&gt; <span class="title">findByCustomerLike</span><span class="params">(String c)</span></span>;  <span class="function">List&lt;Order&gt; <span class="title">findByCustomerAndType</span><span class="params">(String c, String t)</span></span>;  <span class="function">List&lt;Order&gt; <span class="title">findByCustomerLikeAndType</span><span class="params">(String c, String t)</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬æœ‰å››ä¸ªæ–°çš„æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªéƒ½æ˜¯æŸ¥æ‰¾æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„ Order å¯¹è±¡ã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªç”¨æ¥è·å– customer å±æ€§ç­‰äºä¼ å…¥å€¼çš„ Order åˆ—è¡¨ï¼›ç¬¬äºŒä¸ªæ–¹æ³•è·å– customer å±æ€§ like ä¼ å…¥å€¼çš„ Order åˆ—è¡¨ï¼›æ¥ä¸‹æ¥æ–¹æ³•ä¼šè¿”å› customer å’Œ type å±æ€§ç­‰äºä¼ å…¥å€¼çš„ Order å¯¹è±¡ï¼›æœ€åä¸€ä¸ªæ–¹æ³•ä¸å‰ä¸€ä¸ªç±»ä¼¼ï¼Œåªä¸è¿‡ customer åœ¨å¯¹æ¯”çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯ like è€Œä¸æ˜¯ equalsã€‚</p>
<p>å…¶ä¸­ï¼Œfind è¿™ä¸ªæŸ¥è¯¢åŠ¨è¯å¹¶ä¸æ˜¯å›ºå®šçš„ã€‚å¦‚æœå–œæ¬¢çš„è¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ get ä½œä¸ºæŸ¥è¯¢åŠ¨è¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Order&gt; <span class="title">getByCustomer</span><span class="params">(String c)</span></span>;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ read æ›´é€‚åˆçš„è¯ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨è¿™ä¸ªåŠ¨è¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Order&gt; <span class="title">readByCustomer</span><span class="params">(String c)</span></span>;</span><br></pre></td></tr></table></figure>

<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åŠ¨è¯ç”¨æ¥ä¸ºåŒ¹é…çš„å¯¹è±¡è®¡æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">countByCustomer</span><span class="params">(String c)</span></span>;</span><br></pre></td></tr></table></figure>

<p>ä¸ Spring Data JPA ç±»ä¼¼ï¼Œåœ¨æŸ¥è¯¢åŠ¨è¯ä¸ By ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤§çš„çµæ´»æ€§ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ ‡ç¤ºè¦æŸ¥æ‰¾ä»€ä¹ˆå†…å®¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Order&gt; <span class="title">findOrdersByCustomer</span><span class="params">(String c)</span></span>;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼ŒOrders è¿™ä¸ªè¯æ²¡å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šä¹‹å¤„ï¼Œå®ƒä¸ä¼šå½±å“è¦è·å–çš„å†…å®¹ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æ–¹æ³•æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼å‘½åï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Order&gt; <span class="title">findSomeStuffWeNeedsByCustomer</span><span class="params">(String c)</span></span>;</span><br></pre></td></tr></table></figure>

<p>å…¶å®ï¼Œå¹¶ä¸æ˜¯å¿…é¡»è¦è¿”å› <code>List&lt;Order&gt;</code>ï¼Œå¦‚æœåªæƒ³è¦ä¸€ä¸ª Order å¯¹è±¡çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥åªéœ€ç®€å•åœ°è¿”å› Orderï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Order <span class="title">findASingleOrderByCustomer</span><span class="params">(String c)</span></span>;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œï¼Œæ‰€è¿”å›çš„å°±æ˜¯åŸæœ¬ List ä¸­çš„ç¬¬ä¸€ä¸ª Order å¯¹è±¡ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…å…ƒç´ çš„è¯ï¼Œæ–¹æ³•å°†ä¼šè¿”å› nullã€‚</p>
<p>æŒ‡å®šæŸ¥è¯¢</p>
<p>åœ¨ 11.3.2 å°èŠ‚ä¸­ï¼Œ@Query æ³¨è§£å¯ä»¥ä¸º Repository æ–¹æ³•æŒ‡å®šè‡ªå®šä¹‰çš„æŸ¥è¯¢ã€‚@Query èƒ½å¤Ÿåƒåœ¨ JPA ä¸­é‚£æ ·ç”¨åœ¨MongoDBä¸Šã€‚å”¯ä¸€çš„åŒºåˆ«åœ¨äºé’ˆå¯¹ MongoDB æ—¶ï¼Œ@Query ä¼šæ¥å—ä¸€ä¸ª JSON æŸ¥è¯¢ï¼Œè€Œä¸æ˜¯ JPA æŸ¥è¯¢ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢ç»™å®šç±»å‹çš„è®¢å•ï¼Œå¹¶ä¸”è¦æ±‚ customer çš„åç§°ä¸º â€œChuck Wagonâ€ã€‚OrderRepository ä¸­å¦‚ä¸‹çš„æ–¹æ³•å£°æ˜èƒ½å¤Ÿå®Œæˆæ‰€éœ€çš„ä»»åŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;&#123;&#x27;customer&#x27;: &#x27;Chuck Wagon&#x27;, &#x27;type&#x27;: ?0&#125;&quot;)</span><span class="function">List&lt;Order&gt; <span class="title">findChucksOrders</span><span class="params">(String t)</span></span>;</span><br></pre></td></tr></table></figure>

<p>@Query ä¸­ç»™å®šçš„ JSON å°†ä¼šä¸æ‰€æœ‰çš„ Order æ–‡æ¡£è¿›è¡ŒåŒ¹é…ï¼Œå¹¶è¿”å›åŒ¹é…çš„æ–‡æ¡£ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œtype å±æ€§æ˜ å°„æˆäº† â€œ?0â€ï¼Œè¿™è¡¨æ˜ type å±æ€§åº”è¯¥ä¸æŸ¥è¯¢æ–¹æ³•çš„ç¬¬é›¶ä¸ªå‚æ•°ç›¸ç­‰ã€‚å¦‚æœæœ‰å¤šä¸ªå‚æ•°çš„è¯ï¼Œå®ƒä»¬å¯ä»¥é€šè¿‡ â€œ?1â€ã€â€œ?2â€ ç­‰æ–¹å¼è¿›è¡Œå¼•ç”¨ã€‚</p>
<p>æ··åˆè‡ªå®šä¹‰çš„åŠŸèƒ½</p>
<p>åœ¨ 11.3.3 å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•å°†å®Œå…¨è‡ªå®šä¹‰çš„æ–¹æ³•æ··åˆåˆ°è‡ªåŠ¨ç”Ÿæˆçš„ Repositoryä¸­ã€‚å¯¹äº JPA æ¥è¯´ï¼Œè¿™è¿˜æ¶‰åŠåˆ°åˆ›å»ºä¸€ä¸ªä¸­é—´æ¥å£æ¥å£°æ˜è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œä¸ºè¿™äº›è‡ªå®šä¹‰æ–¹æ³•åˆ›å»ºå®ç°ç±»å¹¶ä¿®æ”¹è‡ªåŠ¨åŒ–çš„ Repository æ¥å£ï¼Œä½¿å…¶æ‰©å±•ä¸­é—´æ¥å£ã€‚å¯¹äº Spring Data MongoDB æ¥è¯´ï¼Œè¿™äº›æ­¥éª¤éƒ½æ˜¯ç›¸åŒçš„ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢æ–‡æ¡£ä¸­ type å±æ€§åŒ¹é…ç»™å®šå€¼çš„ Order å¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºç­¾åä¸º <code>List&lt;Order&gt; findByType(String t)</code> çš„æ–¹æ³•ï¼Œå¾ˆå®¹æ˜“å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œå¦‚æœç»™å®šçš„ç±»å‹æ˜¯ â€œNETâ€ï¼Œé‚£æˆ‘ä»¬å°±æŸ¥æ‰¾ type å€¼ä¸º â€œWEBâ€ çš„ Order å¯¹è±¡ã€‚è¦å®ç°è¿™ä¸ªåŠŸèƒ½çš„è¯ï¼Œè¿™å°±æœ‰äº›å›°éš¾äº†ï¼Œå³ä¾¿ä½¿ç”¨ @Query æ³¨è§£ä¹Ÿä¸å®¹æ˜“å®ç°ã€‚ä¸è¿‡ï¼Œæ··åˆå®ç°çš„åšæ³•èƒ½å¤Ÿå®Œæˆè¿™é¡¹ä»»åŠ¡ã€‚</p>
<p>é¦–å…ˆï¼Œå®šä¹‰ä¸­é—´æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> order.db;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> order.Order;<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderOperations</span> </span>&#123;  <span class="function">List&lt;Order&gt; <span class="title">findOrdersByType</span><span class="params">(String t)</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™éå¸¸ç®€å•ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦ç¼–å†™æ··åˆå®ç°ï¼Œå…·ä½“å®ç°å¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºã€‚</p>
<center>ç¨‹åºæ¸…å• 12.7ã€€å°†è‡ªå®šä¹‰çš„ Repository åŠŸèƒ½æ³¨å…¥åˆ°è‡ªåŠ¨ç”Ÿæˆçš„ Repository ä¸­</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> orders.db;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> orders.Order;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.data.mongodb.core.MongoOperations;<span class="keyword">import</span> org.springframework.data.mongodb.core.query.Criteria;<span class="keyword">import</span> org.springframework.data.mongodb.core.query.Query;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderRepositoryImpl</span> <span class="keyword">implements</span> <span class="title">OrderOperations</span> </span>&#123;  <span class="meta">@Autowired</span>  <span class="keyword">private</span> MongoOperations mongo;    <span class="function"><span class="keyword">public</span> List&lt;Order&gt; <span class="title">findOrderByType</span><span class="params">(String t)</span> </span>&#123;    String type = t.equals(<span class="string">&quot;NET&quot;</span>) ? <span class="string">&quot;WEB&quot;</span> : t;        Criteria where = Criteria.where(<span class="string">&quot;type&quot;</span>).is(t);    Query query = Query.query(where);        <span class="keyword">return</span> mongo.find(query, Order.class);  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæ··åˆå®ç°ä¸­æ³¨å…¥äº† MongoOperationsï¼ˆä¹Ÿå°±æ˜¯ MongoTemplate æ‰€å®ç°çš„æ¥å£ï¼‰ã€‚findOrdersByType() æ–¹æ³•ä½¿ç”¨ MongoOperations å¯¹æ•°æ®åº“è¿›è¡Œäº†æŸ¥è¯¢ï¼ŒæŸ¥æ‰¾åŒ¹é…æ¡ä»¶çš„æ–‡æ¡£ã€‚</p>
<p>å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯ä¿®æ”¹ OrderRepositoryï¼Œè®©å…¶æ‰©å±•ä¸­é—´æ¥å£ OrderOperationsï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderRepository</span> <span class="keyword">extends</span> <span class="title">MongoRepository</span>&lt;<span class="title">Order</span>, <span class="title">String</span>&gt;, <span class="title">OrderOperation</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>å°†è¿™äº›å…³è”èµ·æ¥çš„å…³é”®ç‚¹åœ¨äºå®ç°ç±»çš„åç§°ä¸º OrderRepositoryImplã€‚è¿™ä¸ªåå­—å‰åŠéƒ¨åˆ†ä¸ OrderRepository ç›¸åŒï¼Œåªæ˜¯æ·»åŠ äº† â€œImplâ€ åç¼€ã€‚å½“ Spring Data<br> MongoDB ç”Ÿæˆ Repository å®ç°æ—¶ï¼Œå®ƒä¼šæŸ¥æ‰¾è¿™ä¸ªç±»å¹¶å°†å…¶æ··åˆåˆ°è‡ªåŠ¨ç”Ÿæˆçš„å®ç°ä¸­ã€‚</p>
<p>å¦‚æœä½ ä¸å–œæ¬¢ â€œImplâ€ åç¼€çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥é…ç½® Spring Data MongoDBï¼Œè®©å…¶æŒ‰ç…§åå­—æŸ¥æ‰¾å…·å¤‡ä¸åŒåç¼€çš„ç±»ã€‚æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯è®¾ç½® @EnableMongoRepositories çš„å±æ€§ï¼ˆåœ¨ Spring é…ç½®ç±»ä¸­ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span><span class="meta">@EnableMongoRepositories(basePackages=&quot;order.db&quot;, repositoryImplementationPostfix=&quot;Stuff&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoConfig</span> <span class="keyword">extends</span> <span class="title">AbstractMongoConfiguration</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½¿ç”¨XMLé…ç½®çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½® <code>&lt;mongo:repositories&gt;</code> çš„ <code>repository-impl-postfix</code> å±æ€§ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mongo:repositories</span> <span class="attr">base-package</span>=<span class="string">&quot;orders.db&quot;</span> <span class="attr">repository-impl-postfix</span>=<span class="string">&quot;Stuff&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡é‡‡ç”¨å“ªç§æ–¹å¼ï¼Œæˆ‘ä»¬ç°åœ¨éƒ½è®© Spring Data MongoDB æŸ¥æ‰¾åä¸º OrderRepositoryStuff çš„ç±»ï¼Œè€Œä¸å†æŸ¥æ‰¾ OrderRepositoryImplã€‚</p>
<p>åƒ MongoDB è¿™æ ·çš„æ–‡æ¡£æ•°æ®åº“èƒ½å¤Ÿè§£å†³ç‰¹å®šç±»å‹çš„é—®é¢˜ï¼Œä½†æ˜¯å°±åƒå…³ç³»å‹æ•°æ®åº“ä¸æ˜¯å…¨èƒ½å‹æ•°æ®åº“é‚£æ ·ï¼ŒMongoDB åŒæ ·å¦‚æ­¤ã€‚æœ‰äº›é—®é¢˜å¹¶ä¸æ˜¯å…³ç³»å‹æ•°æ®åº“æˆ–æ–‡æ¡£å‹æ•°æ®åº“é€‚åˆè§£å†³çš„ï¼Œä¸è¿‡ï¼Œå¹¸å¥½æˆ‘ä»¬çš„é€‰æ‹©å¹¶ä¸ä»…é™äºè¿™ä¸¤ç§ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ Spring Dataå¦‚ä½•æ”¯æŒ Neo4jï¼Œè¿™æ˜¯ä¸€ç§å¾ˆæµè¡Œçš„å›¾æ•°æ®åº“ã€‚</p>
<h3 id="ä½¿ç”¨-Neo4j-æ“ä½œå›¾æ•°æ®"><a href="#ä½¿ç”¨-Neo4j-æ“ä½œå›¾æ•°æ®" class="headerlink" title="ä½¿ç”¨ Neo4j æ“ä½œå›¾æ•°æ®"></a>ä½¿ç”¨ Neo4j æ“ä½œå›¾æ•°æ®</h3><p>æ–‡æ¡£å‹æ•°æ®åº“ä¼šå°†æ•°æ®å­˜å‚¨åˆ°ç²—ç²’åº¦çš„æ–‡æ¡£ä¸­ï¼Œè€Œå›¾æ•°æ®åº“ä¼šå°†æ•°æ®å­˜å‚¨åˆ°å¤šä¸ªç»†ç²’åº¦çš„èŠ‚ç‚¹ä¸­ï¼Œè¿™äº›èŠ‚ç‚¹ä¹‹é—´é€šè¿‡å…³ç³»å»ºç«‹å…³è”ã€‚å›¾æ•°æ®åº“ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹é€šå¸¸ä¼šå¯¹åº”æ•°æ®åº“ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼ˆconceptï¼‰ï¼Œå®ƒä¼šå…·å¤‡æè¿°èŠ‚ç‚¹çŠ¶æ€çš„å±æ€§ã€‚è¿æ¥ä¸¤ä¸ªèŠ‚ç‚¹çš„å…³è”å…³ç³»å¯èƒ½ä¹Ÿä¼šå¸¦æœ‰å±æ€§ã€‚</p>
<p>æŒ‰ç…§å…¶æœ€ç®€å•çš„å½¢å¼ï¼Œå›¾æ•°æ®åº“æ¯”æ–‡æ¡£æ•°æ®åº“æ›´åŠ é€šç”¨ï¼Œæœ‰å¯èƒ½ä¼šæˆä¸ºå…³ç³»å‹æ•°æ®åº“çš„æ— æ¨¡å¼ï¼ˆschemalessï¼‰æ›¿ä»£æ–¹æ¡ˆã€‚å› ä¸ºæ•°æ®çš„ç»“æ„æ˜¯å›¾ï¼Œæ‰€ä»¥å¯ä»¥éå†å…³è”å…³ç³»ä»¥æŸ¥æ‰¾æ•°æ®ä¸­ä½ æ‰€å…³å¿ƒçš„å†…å®¹ï¼Œè¿™åœ¨å…¶ä»–æ•°æ®åº“ä¸­æ˜¯å¾ˆéš¾ç”šè‡³æ— æ³•å®ç°çš„ã€‚</p>
<p>Spring Data Neo4j æä¾›äº†å¾ˆå¤šä¸ Spring Data JPA å’Œ Spring Data MongoDB ç›¸åŒçš„åŠŸèƒ½ï¼Œå½“ç„¶æ‰€é’ˆå¯¹çš„æ˜¯ Neo4j å›¾æ•°æ®åº“ã€‚å®ƒæä¾›äº†å°† Java å¯¹è±¡æ˜ å°„åˆ°èŠ‚ç‚¹å’Œå…³è”å…³ç³»çš„æ³¨è§£ã€é¢å‘æ¨¡æ¿çš„ Neo4j è®¿é—®æ–¹å¼ä»¥åŠ Repository å®ç°çš„è‡ªåŠ¨åŒ–ç”ŸæˆåŠŸèƒ½ã€‚</p>
<p>æˆ‘ä»¬ç¨åä¼šçœ‹åˆ°å¦‚ä½•åœ¨ Neo4j ä¸­ä½¿ç”¨è¿™äº›ç‰¹æ€§ï¼Œä¸è¿‡é¦–å…ˆæˆ‘ä»¬éœ€è¦é…ç½® Spring Data Neo4jã€‚</p>
<h4 id="é…ç½®-Spring-Data-Neo4j"><a href="#é…ç½®-Spring-Data-Neo4j" class="headerlink" title="é…ç½® Spring Data Neo4j"></a>é…ç½® Spring Data Neo4j</h4><p>é…ç½® Spring Data Neo4j çš„å…³é”®åœ¨äºå£°æ˜ GraphDatabaseService bean å’Œå¯ç”¨ Neo4j Repository è‡ªåŠ¨ç”ŸæˆåŠŸèƒ½ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº† Spring Data Neo4j æ‰€éœ€çš„åŸºæœ¬é…ç½®ã€‚</p>
<center>ç¨‹åºæ¸…å• 12.8ã€€ä½¿ç”¨ @EnableNeo4jRepositories æ¥é…ç½® Spring Data Neo4j</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> orders.config;<span class="keyword">import</span> org.neo4j.graphdb.GraphDatabaseService;<span class="keyword">import</span> org.neo4j.graphdb.factory.GraphDatabaseFactory;<span class="keyword">import</span> org.springframework.context.annotation.Bean;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.data.neo4j.config.EnableNeo4jRepositories;<span class="keyword">import</span> org.springframework.data.neo4j.config.Neo4jConfiguration;<span class="meta">@Configuration</span><span class="meta">@EnableNeo4jRepositories(basePackages = &quot;orders.db&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Neo4jConfig</span> <span class="keyword">extends</span> <span class="title">Neo4jConfiguration</span> </span>&#123;	<span class="function"><span class="keyword">public</span> <span class="title">Neo4jConfig</span><span class="params">()</span> </span>&#123;		setBasePackage(<span class="string">&quot;orders&quot;</span>);	&#125;	<span class="meta">@Bean(destroyMethod=&quot;shutdown&quot;)</span>	<span class="function"><span class="keyword">public</span> GraphDatabaseService <span class="title">graphDatabaseService</span><span class="params">()</span> </span>&#123;			<span class="keyword">return</span> <span class="keyword">new</span> GraphDatabaseFactory()				.newEmbeddedDatabase(<span class="string">&quot;/tmp/graphdb&quot;</span>);	&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>@EnableNeo4jRepositories æ³¨è§£èƒ½å¤Ÿè®© Spring Data Neo4j è‡ªåŠ¨ç”Ÿæˆ Neo4j Repository å®ç°ã€‚å®ƒçš„ basePackages å±æ€§è®¾ç½®ä¸º orders.db åŒ…ï¼Œè¿™æ ·å®ƒå°±ä¼šæ‰«æè¿™ä¸ªåŒ…æ¥æŸ¥æ‰¾ï¼ˆç›´æ¥æˆ–é—´æ¥ï¼‰æ‰©å±• Repository æ ‡è®°æ¥å£çš„å…¶ä»–æ¥å£ã€‚</p>
<p>Neo4jConfig æ‰©å±•è‡ª Neo4jConfigurationï¼Œåè€…æä¾›äº†å¤šä¸ªä¾¿åˆ©çš„æ–¹æ³•æ¥é…ç½® Spring Data Neo4jã€‚åœ¨è¿™äº›æ–¹æ³•ä¸­ï¼Œå°±åŒ…æ‹¬ setBasePackage()ï¼Œå®ƒä¼šåœ¨Neo4jConfig çš„æ„é€ å™¨ä¸­è°ƒç”¨ï¼Œç”¨æ¥å‘Šè¯‰ Spring Data Neo4j è¦åœ¨ orders åŒ…ä¸­æŸ¥æ‰¾æ¨¡å‹ç±»ã€‚</p>
<p>è¿™ä¸ªæ‹¼å›¾çš„æœ€åä¸€éƒ¨åˆ†æ˜¯å®šä¹‰ GraphDatabaseServicebeanã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒgraphDatabaseService() æ–¹æ³•ä½¿ç”¨ GraphDatabaseFactory æ¥åˆ›å»ºåµŒå…¥å¼çš„ Neo4j æ•°æ®åº“ã€‚åœ¨ Neo4j ä¸­ï¼ŒåµŒå…¥å¼æ•°æ®åº“ä¸è¦ä¸å†…å­˜æ•°æ®åº“ç›¸æ··æ·†ã€‚åœ¨è¿™é‡Œï¼Œâ€œåµŒå…¥å¼â€æŒ‡çš„æ˜¯æ•°æ®åº“å¼•æ“ä¸åº”ç”¨è¿è¡Œåœ¨åŒä¸€ä¸ª JVM ä¸­ï¼Œä½œä¸ºåº”ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯ç‹¬ç«‹çš„æœåŠ¡å™¨ã€‚æ•°æ®ä¾ç„¶ä¼šæŒä¹…åŒ–åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼ˆåœ¨æœ¬ä¾‹ä¸­ï¼Œä¹Ÿå°±æ˜¯ â€œ/tmp/graphdbâ€ ä¸­ï¼‰ã€‚</p>
<p>ä½œä¸ºå¦å¤–çš„ä¸€ç§æ–¹å¼ï¼Œä½ å¯èƒ½ä¼šå¸Œæœ›é…ç½® GraphDatabaseService è¿æ¥è¿œç¨‹çš„ Neo4j æœåŠ¡å™¨ã€‚å¦‚æœ spring-data-neo4j-rest åº“åœ¨åº”ç”¨çš„ç±»è·¯å¾„ä¸‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é…ç½® SpringRestGraphDatabaseï¼Œå®ƒä¼šé€šè¿‡ RESTful API æ¥è®¿é—®è¿œç¨‹çš„ Neo4j æ•°æ®åº“ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(destroyMethod=&quot;shutdown&quot;)</span><span class="function"><span class="keyword">public</span> GraphDatabaseService <span class="title">grapthDatabaseService</span><span class="params">()</span> </span>&#123;  <span class="keyword">return</span> <span class="keyword">new</span> SpringRestGraphDatabser(    <span class="string">&quot;http://graphdbserver:7474/db/data/&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸Šæ‰€ç¤ºï¼ŒSpringRestGraphDatabase åœ¨é…ç½®æ—¶ï¼Œå‡è®¾è¿œç¨‹çš„æ•°æ®åº“å¹¶ä¸éœ€è¦è®¤è¯ã€‚ä½†æ˜¯ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒçš„é…ç½®ä¸­ï¼Œå½“åˆ›å»º SpringRestGraphDatabase çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›æä¾›åº”ç”¨çš„å‡­è¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(destroyMethod=&quot;shutdown&quot;)</span><span class="function"><span class="keyword">public</span> GraphDatabaseService <span class="title">grapthDatabaseService</span><span class="params">(Enviroment env)</span> </span>&#123;  <span class="keyword">return</span> <span class="keyword">new</span> SpringRestGraphDatabser(    <span class="string">&quot;http://graphdbserver:7474/db/data/&quot;</span>,    env.getProperty(<span class="string">&quot;db.username&quot;</span>), env.getProperty(<span class="string">&quot;db.password&quot;</span>));&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œå‡­è¯æ˜¯é€šè¿‡æ³¨å…¥çš„ Environment è·å–åˆ°çš„ï¼Œé¿å…äº†åœ¨é…ç½®ç±»ä¸­çš„ç¡¬ç¼–ç ã€‚</p>
<p>Spring Data Neo4j åŒæ—¶è¿˜æä¾›äº† XML å‘½åç©ºé—´ã€‚å¦‚æœä½ æ›´æ„¿æ„åœ¨ XML ä¸­é…ç½® Spring Data Neo4j çš„è¯ï¼Œé‚£å¯ä»¥ä½¿ç”¨è¯¥å‘½åç©ºé—´ä¸­çš„ <code>&lt;neo4j:config&gt;</code> å’Œ <code>&lt;neo4j:repositories&gt;</code> å…ƒç´ ã€‚åœ¨åŠŸèƒ½ä¸Šï¼Œç¨‹åºæ¸…å• 12.9 æ‰€å±•ç¤ºçš„é…ç½®ä¸ç¨‹åºæ¸…å• 12.8 ä¸­çš„ Java é…ç½®æ˜¯ç›¸åŒçš„ã€‚</p>
<center>ç¨‹åºæ¸…å• 12.9ã€€Spring Data Neo4j ä¹Ÿå¯ä»¥é€šè¿‡ XML æ¥é…ç½®</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xmlns:neo4j</span>=<span class="string">&quot;http://www.springframework.org/schema/data/neo4j&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;    http://www.springframework.org/schema/beans    http://www.springframework.org/schema/beans/spring-beans.xsd    http://www.springframework.org/schema/data/neo4j    http://www.springframework.org/schema/data/neo4j/spring-neo4j.xsd&quot;</span> &gt;</span>    <span class="tag">&lt;<span class="name">neo4j:config</span> <span class="attr">storeDirectory</span>=<span class="string">&quot;/tmp/graphdb&quot;</span> <span class="attr">base-package</span>=<span class="string">&quot;orders&quot;</span> /&gt;</span>  <span class="tag">&lt;<span class="name">neo4j:repositoried</span> <span class="attr">base-package</span>=<span class="string">&quot;orders.db&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;neo4j:config&gt;</code> å…ƒç´ é…ç½®äº†å¦‚ä½•è®¿é—®æ•°æ®åº“çš„ç»†èŠ‚ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒé…ç½® Spring Data Neo4j ä½¿ç”¨åµŒå…¥å¼çš„æ•°æ®åº“ã€‚å…·ä½“æ¥è®²ï¼ŒstoreDirectory å±æ€§æŒ‡å®šäº†æ•°æ®è¦æŒä¹…åŒ–åˆ°å“ªä¸ªæ–‡ä»¶ç³»ç»Ÿè·¯å¾„ä¸­ã€‚base-package å±æ€§è®¾ç½®äº†æ¨¡å‹ç±»å®šä¹‰åœ¨å“ªä¸ªåŒ…ä¸­ã€‚</p>
<p>è‡³äº<code> &lt;neo4j:repositories&gt;</code> å…ƒç´ ï¼Œå®ƒå¯ç”¨Spring Data Neo4j è‡ªåŠ¨ç”Ÿæˆ Repository å®ç°çš„åŠŸèƒ½ï¼Œå®ƒä¼šæ‰«æ orders.db åŒ…ï¼ŒæŸ¥æ‰¾æ‰€æœ‰æ‰©å±• Repository çš„æ¥å£ã€‚</p>
<p>å¦‚æœè¦é…ç½® Spring Data Neo4j è®¿é—®è¿œç¨‹çš„ Neo4j æœåŠ¡å™¨ï¼Œæˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯å£°æ˜ SpringRestGraphDatabasebeanï¼Œå¹¶è®¾ç½® <code>&lt;neo4j:config&gt;</code> çš„ graphDatabaseService å±æ€§ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">neo4j:config</span> <span class="attr">base-package</span>=<span class="string">&quot;orders&quot;</span> <span class="attr">graphDatabaseService</span>=<span class="string">&quot;graphDatabaseService&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;graphDatabaseService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.data.neo4j.rest.SpringRestGraphDatabase&quot;</span>&gt;</span>   <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;http://graphserver:7474/db/data/&quot;</span> /&gt;</span>   <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;db.username&quot;</span> /&gt;</span>   <span class="tag">&lt;<span class="name">constructoe-arg</span> <span class="attr">value</span>=<span class="string">&quot;db.password&quot;</span> /&gt;</span> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span> <span class="tag">&lt;<span class="name">neo4j:repositoried</span> <span class="attr">base-package</span>=<span class="string">&quot;orders.db&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡æ˜¯é€šè¿‡ Java è¿˜æ˜¯é€šè¿‡ XML æ¥é…ç½® Spring Data Neo4jï¼Œæˆ‘ä»¬éƒ½éœ€è¦ç¡®ä¿æ¨¡å‹ç±»ä½äºåŸºç¡€åŒ…æ‰€æŒ‡å®šçš„åŒ…ä¸­ï¼ˆé€šè¿‡ @EnableNeo4jRepositories çš„ basePackages å±æ€§æˆ– <code>&lt;neo4j:config&gt;</code> çš„ base-package å±æ€§æ¥è¿›è¡Œè®¾ç½®ï¼‰ã€‚å®ƒä»¬éƒ½éœ€è¦ä½¿ç”¨æ³¨è§£å°†å…¶æ ‡æ³¨ä¸ºèŠ‚ç‚¹å®ä½“æˆ–å…³è”å…³ç³»å®ä½“ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥çš„ä»»åŠ¡ã€‚</p>
<h4 id="ä½¿ç”¨æ³¨è§£æ ‡æ³¨å›¾å®ä½“"><a href="#ä½¿ç”¨æ³¨è§£æ ‡æ³¨å›¾å®ä½“" class="headerlink" title="ä½¿ç”¨æ³¨è§£æ ‡æ³¨å›¾å®ä½“"></a>ä½¿ç”¨æ³¨è§£æ ‡æ³¨å›¾å®ä½“</h4><p>Neo4j å®šä¹‰äº†ä¸¤ç§ç±»å‹çš„å®ä½“ï¼šèŠ‚ç‚¹ï¼ˆnodeï¼‰å’Œå…³è”å…³ç³»ï¼ˆrelationshipï¼‰ã€‚ä¸€èˆ¬æ¥è®²ï¼ŒèŠ‚ç‚¹åæ˜ äº†åº”ç”¨ä¸­çš„äº‹ç‰©ï¼Œè€Œå…³è”å…³ç³»å®šä¹‰äº†è¿™äº›äº‹ç‰©æ˜¯å¦‚ä½•è”ç³»åœ¨ä¸€èµ·çš„ã€‚</p>
<p>Spring Data Neo4j æä¾›äº†å¤šä¸ªæ³¨è§£ï¼Œå®ƒä»¬å¯ä»¥åº”ç”¨åœ¨æ¨¡å‹ç±»å‹åŠå…¶åŸŸä¸Šï¼Œå®ç° Neo4j ä¸­çš„æŒä¹…åŒ–ã€‚è¡¨ 12.3 æè¿°äº†è¿™äº›æ³¨è§£ã€‚</p>
<center>è¡¨ 12.3ã€€å€ŸåŠ© Spring Data Neo4j çš„æ³¨è§£ï¼Œèƒ½å¤Ÿå°†é¢†åŸŸç±»å‹æ˜ å°„ä¸ºå›¾ä¸­çš„èŠ‚ç‚¹å’Œå…³è”å…³ç³»</center>

<table>
<thead>
<tr>
<th>æ³¨ã€€ã€€è§£</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>@NodeEntity</td>
<td>å°† Java ç±»å‹å£°æ˜ä¸ºèŠ‚ç‚¹å®ä½“</td>
</tr>
<tr>
<td>@RelationshipEntity</td>
<td>å°† Java ç±»å‹å£°æ˜ä¸ºå…³è”å…³ç³»å®ä½“</td>
</tr>
<tr>
<td>@StartNode</td>
<td>å°†æŸä¸ªå±æ€§å£°æ˜ä¸ºå…³è”å…³ç³»å®ä½“çš„å¼€å§‹èŠ‚ç‚¹</td>
</tr>
<tr>
<td>@EndNode</td>
<td>å°†æŸä¸ªå±æ€§å£°æ˜ä¸ºå…³è”å…³ç³»å®ä½“çš„ç»“æŸèŠ‚ç‚¹</td>
</tr>
<tr>
<td>@Fetch</td>
<td>å°†å®ä½“çš„å±æ€§å£°æ˜ä¸ºç«‹å³åŠ è½½</td>
</tr>
<tr>
<td>@GraphId</td>
<td>å°†æŸä¸ªå±æ€§è®¾ç½®ä¸ºå®ä½“çš„ ID åŸŸï¼ˆè¿™ä¸ªåŸŸçš„ç±»å‹å¿…é¡»æ˜¯ Longï¼‰</td>
</tr>
<tr>
<td>@GraphProperty</td>
<td>æ˜ç¡®å£°æ˜æŸä¸ªå±æ€§</td>
</tr>
<tr>
<td>@GraphTraversal</td>
<td>å£°æ˜æŸä¸ªå±æ€§ä¼šè‡ªåŠ¨æä¾›ä¸€ä¸ª iterable å…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ æ˜¯å›¾éå†æ‰€æ„å»ºçš„</td>
</tr>
<tr>
<td>@Indexed</td>
<td>å£°æ˜æŸä¸ªå±æ€§åº”è¯¥è¢«ç´¢å¼•</td>
</tr>
<tr>
<td>@Labels</td>
<td>ä¸º @NodeEntity å£°æ˜æ ‡ç­¾</td>
</tr>
<tr>
<td>@Query</td>
<td>å£°æ˜æŸä¸ªå±æ€§ä¼šè‡ªåŠ¨æä¾›ä¸€ä¸ª iterable å…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ æ˜¯æ‰§è¡Œç»™å®šçš„ Cypher æŸ¥è¯¢æ‰€æ„å»ºçš„</td>
</tr>
<tr>
<td>@QueryResult</td>
<td>å£°æ˜æŸä¸ª Java æˆ–æ¥å£èƒ½å¤ŸæŒæœ‰æŸ¥è¯¢çš„ç»“æœ</td>
</tr>
<tr>
<td>@RelatedTo</td>
<td>é€šè¿‡æŸä¸ªå±æ€§ï¼Œå£°æ˜å½“å‰çš„ @NodeEntity ä¸å¦å¤–ä¸€ä¸ª @NodeEntity ä¹‹é—´çš„å…³è”å…³ç³»</td>
</tr>
<tr>
<td>@RelatedToVia</td>
<td>åœ¨ @NodeEntity ä¸Šå£°æ˜æŸä¸ªå±æ€§ï¼ŒæŒ‡å®šå…¶å¼•ç”¨è¯¥èŠ‚ç‚¹æ‰€å±çš„æŸä¸€ä¸ª @RelationshipEntity</td>
</tr>
<tr>
<td>@RelationshipType</td>
<td>å°†æŸä¸ªåŸŸå£°æ˜ä¸ºå…³è”å®ä½“ç±»å‹</td>
</tr>
<tr>
<td>@ResultColumn</td>
<td>åœ¨å¸¦æœ‰ @QueryResult æ³¨è§£çš„ç±»å‹ä¸Šï¼Œå°†æŸä¸ªå±æ€§å£°æ˜ä¸ºè·å–</td>
</tr>
</tbody></table>
<p> æŸ¥è¯¢ç»“æœé›†ä¸­çš„æŸä¸ªç‰¹å®šåˆ—</p>
<p>ä¸ºäº†äº†è§£å¦‚ä½•ä½¿ç”¨å…¶ä¸­çš„æŸäº›æ³¨è§£ï¼Œæˆ‘ä»¬ä¼šå°†å…¶åº”ç”¨åˆ°è®¢å•/æ¡ç›®æ ·ä¾‹ä¸­ã€‚</p>
<p>åœ¨è¯¥æ ·ä¾‹ä¸­ï¼Œæ•°æ®å»ºæ¨¡çš„ä¸€ç§æ–¹å¼å°±æ˜¯å°†è®¢å•è®¾å®šä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒä¼šä¸ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ç›®å…³è”ã€‚å›¾ 12.2 ä»¥å›¾çš„å½¢å¼æè¿°äº†è¿™ç§æ¨¡å‹ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211108104552145.png" alt="image-20211108104552145"></p>
<center>å›¾ 12.2ã€€è¿æ¥ä¸¤ä¸ªèŠ‚ç‚¹çš„ç®€å•å…³è”å…³ç³»ï¼Œå…³ç³»æœ¬èº«ä¸åŒ…å«ä»»ä½•å±æ€§</center>

<p>ä¸ºäº†å°†è®¢å•æŒ‡å®šä¸ºèŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸º Order ç±»æ·»åŠ  @NodeEntity æ³¨è§£ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¸¦æœ‰ @NodeEntity æ³¨è§£çš„ Order ç±»ï¼Œå®ƒè¿˜åŒ…å«äº†è¡¨ 12.3 ä¸­çš„å‡ ä¸ªå…¶ä»–æ³¨è§£ã€‚</p>
<center>ç¨‹åºæ¸…å• 12.10ã€€ä¸º Order æ·»åŠ æ³¨è§£ï¼Œä½¿å…¶æˆä¸ºå›¾æ•°æ®åº“ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> orders;<span class="keyword">import</span> java.util.LinkedHashSet;<span class="keyword">import</span> java.util.Set;<span class="keyword">import</span> org.springframework.data.neo4j.annotation.GraphId;<span class="keyword">import</span> org.springframework.data.neo4j.annotation.NodeEntity;<span class="keyword">import</span> org.springframework.data.neo4j.annotation.RelatedTo;<span class="meta">@NodeEntitypublic</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;		<span class="meta">@GraphId</span>	<span class="keyword">private</span> Long id;		<span class="keyword">private</span> String customer;		<span class="keyword">private</span> String type;		<span class="meta">@RelatedTo(type=&quot;HAS_ITEMS&quot;)</span>	<span class="keyword">private</span> Set&lt;Item&gt; items = <span class="keyword">new</span> LinkedHashSet&lt;Item&gt;();	...	&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†ç±»çº§åˆ«ä¸Šçš„@NodeEntityï¼Œè¿˜è¦æ³¨æ„idå±æ€§ä¸Šä½¿ç”¨äº† @GraphId æ³¨è§£ã€‚Neo4j ä¸Šçš„æ‰€æœ‰å®ä½“å¿…è¦è¦æœ‰ä¸€ä¸ªå›¾ IDã€‚è¿™å¤§è‡´ç±»ä¼¼äº JPA @Entity ä»¥åŠ MongoDB @Document ç±»ä¸­ä½¿ç”¨ @Id æ³¨è§£çš„å±æ€§ã€‚åœ¨è¿™é‡Œï¼Œ@GraphId æ³¨è§£æ ‡æ³¨çš„å±æ€§å¿…é¡»æ˜¯ Long ç±»å‹ã€‚</p>
<p>customer å’Œ type å±æ€§ä¸Šæ²¡æœ‰ä»»ä½•æ³¨è§£ã€‚åªè¦è¿™äº›å±æ€§ä¸æ˜¯ç¬æ€çš„ï¼Œå®ƒä»¬éƒ½ä¼šæˆä¸ºæ•°æ®åº“ä¸­èŠ‚ç‚¹çš„å±æ€§ã€‚items å±æ€§ä¸Šä½¿ç”¨äº† @RelatedTo æ³¨è§£ï¼Œè¿™è¡¨æ˜ Order ä¸ä¸€ä¸ª Item çš„ Set å­˜åœ¨å…³è”å…³ç³»ã€‚type å±æ€§å®é™…ä¸Šå°±æ˜¯ä¸ºå…³è”å…³ç³»å»ºç«‹äº†ä¸€ä¸ªæ–‡æœ¬æ ‡è®°ã€‚å®ƒå¯ä»¥è®¾ç½®æˆä»»æ„çš„å€¼ï¼Œä½†é€šå¸¸ä¼šç»™å®šä¸€ä¸ªæ˜“äºäººç±»é˜…è¯»çš„æ–‡æœ¬ï¼Œç”¨æ¥ç®€å•æè¿°è¿™ä¸ªå…³è”å…³ç³»çš„ç‰¹å¾ã€‚ç¨åï¼Œä½ å°†ä¼šçœ‹åˆ°å¦‚ä½•å°†è¿™ä¸ªæ ‡è®°ç”¨åœ¨æŸ¥è¯¢ä¸­ï¼Œå®ç°è·¨å…³è”å…³ç³»çš„æŸ¥è¯¢ã€‚</p>
<p>å°± Item æœ¬èº«æ¥è¯´ï¼Œä¸‹é¢å±•ç°äº†å¦‚ä½•ä¸ºå…¶æ·»åŠ æ³¨è§£å®ç°å›¾çš„æŒä¹…åŒ–ã€‚</p>
<center>ç¨‹åºæ¸…å• 12.11ã€€Item ä¹Ÿæ˜¯å›¾æ•°æ®åº“ä¸­çš„èŠ‚ç‚¹</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> orders;<span class="keyword">import</span> org.springframework.data.neo4j.annotation.GraphId;<span class="keyword">import</span> org.springframework.data.neo4j.annotation.NodeEntity;<span class="meta">@NodeEntitypublic</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;		<span class="meta">@GraphId</span>	<span class="keyword">private</span> Long id;		<span class="keyword">private</span> Order order;	<span class="keyword">private</span> String product;	<span class="keyword">private</span> <span class="keyword">double</span> price;	<span class="keyword">private</span> <span class="keyword">int</span> quantity;		...&#125;</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼äº Orderï¼ŒItem ä¹Ÿä½¿ç”¨äº† @NodeEntity æ³¨è§£ï¼Œå°†å…¶æ ‡è®°ä¸ºä¸€ä¸ªèŠ‚ç‚¹ã€‚å®ƒåŒæ—¶ä¹Ÿæœ‰ä¸€ä¸ª Long ç±»å‹çš„å±æ€§ï¼Œå€ŸåŠ© @GraphId æ³¨è§£å°†å…¶æ ‡æ³¨ä¸ºèŠ‚ç‚¹çš„å›¾ IDï¼Œè€Œproductã€price ä»¥åŠ quantity å±æ€§å‡ä¼šä½œä¸ºå›¾æ•°æ®åº“ä¸­èŠ‚ç‚¹çš„å±æ€§ã€‚</p>
<p>Order å’Œ Item ä¹‹é—´çš„å…³è”å…³ç³»å¾ˆç®€å•ï¼Œå…³ç³»æœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•çš„æ•°æ®ã€‚å› æ­¤ï¼Œ@RelatedToæ³¨è§£å°±è¶³ä»¥å®šä¹‰å…³è”å…³ç³»ã€‚ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å…³è”å…³ç³»éƒ½è¿™ä¹ˆç®€å•ã€‚</p>
<p>è®©æˆ‘ä»¬é‡æ–°è€ƒè™‘è¯¥å¦‚ä½•ä¸ºæ•°æ®å»ºæ¨¡ï¼Œä»è€Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨æ›´ä¸ºå¤æ‚çš„å…³è”å…³ç³»ã€‚åœ¨å½“å‰çš„æ•°æ®æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¡ç›®å’Œäº§å“çš„ä¿¡æ¯ç»„åˆåˆ°äº† Item ç±»ä¸­ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬é‡æ–°è€ƒè™‘çš„æ—¶å€™ï¼Œä¼šå‘ç°è®¢å•ä¼šä¸ä¸€ä¸ªæˆ–å¤šä¸ªäº§å“ç›¸å…³è”ã€‚è®¢å•ä¸äº§å“ä¹‹é—´çš„å…³ç³»æ„æˆäº†è®¢å•çš„ä¸€ä¸ªæ¡ç›®ã€‚å›¾ 12.3 æè¿°äº†å¦å¤–ä¸€ç§åœ¨å›¾ä¸­å»ºæ¨¡æ•°æ®çš„æ–¹å¼ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211108104745073.png" alt="image-20211108104745073"></p>
<center>å›¾ 12.3ã€€å…³è”å…³ç³»å®ä½“è‡ªèº«å…·æœ‰å±æ€§</center>

<p>åœ¨è¿™ä¸ªæ–°çš„æ¨¡å‹ä¸­ï¼Œè®¢å•ä¸­äº§å“çš„æ•°é‡æ˜¯æ¡ç›®ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œè€Œäº§å“æœ¬èº«æ˜¯å¦å¤–ä¸€ä¸ªæ¦‚å¿µã€‚ä¸å‰é¢ä¸€æ ·ï¼Œè®¢å•å’Œäº§å“éƒ½æ˜¯èŠ‚ç‚¹ï¼Œè€Œæ¡ç›®æ˜¯å…³è”å…³ç³»ã€‚å› ä¸ºç°åœ¨çš„æ¡ç›®å¿…é¡»è¦åŒ…å«ä¸€ä¸ªæ•°é‡å€¼ï¼Œå…³è”å…³ç³»ä¸åƒå‰é¢é‚£ä¹ˆç®€å•ã€‚æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªç±»æ¥ä»£è¡¨æ¡ç›®ï¼Œæ¯”å¦‚å¦‚ä¸‹ç¨‹åºæ¸…å•æ‰€ç¤ºçš„ LineItemã€‚</p>
<center>ç¨‹åºæ¸…å• 12.12ã€€LineItem ç±»è¿æ¥äº†ä¸€ä¸ª Order èŠ‚ç‚¹å’Œä¸€ä¸ª Product èŠ‚ç‚¹</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> orders;<span class="keyword">import</span> org.springframework.data.neo4j.annotation.EndNode;<span class="keyword">import</span> org.springframework.data.neo4j.annotation.GraphId;<span class="keyword">import</span> org.springframework.data.neo4j.annotation.RelationShipEntity;<span class="keyword">import</span> org.springframework.data.neo4j.annotation.StartNode;<span class="meta">@RelationShipEntity(type=&quot;HAS_LINE_ITEM_FOR&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LineItem</span> </span>&#123;		<span class="meta">@GraphId</span>	<span class="keyword">private</span> Long id;		<span class="meta">@StartNode</span>	<span class="keyword">private</span> Order order;		<span class="meta">@EndNode</span>	<span class="keyword">private</span> String product;		<span class="keyword">private</span> <span class="keyword">int</span> quantity;		...&#125;</span><br></pre></td></tr></table></figure>

<p>Order ç±»é€šè¿‡ @NodeEntity æ³¨è§£å°†å…¶æ ‡ç¤ºä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œ LineItem ç±»åˆ™ä½¿ç”¨äº† @RelationshipEntity æ³¨è§£ã€‚LineItem åŒæ ·ä¹Ÿæœ‰ä¸€ä¸ª id å±æ€§æ ‡æ³¨äº† @GraphId æ³¨è§£ï¼Œä¸ç®¡æ˜¯èŠ‚ç‚¹å®ä½“è¿˜æ˜¯å…³è”å…³ç³»å®ä½“ï¼Œéƒ½å¿…é¡»è¦æœ‰ä¸€ä¸ªå›¾ IDï¼Œè€Œä¸”å…¶ç±»å‹å¿…é¡»ä¸º Longã€‚</p>
<p>å…³è”å…³ç³»å®ä½“çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºå®ƒä»¬è¿æ¥äº†ä¸¤ä¸ªèŠ‚ç‚¹ã€‚@StartNode å’Œ@ EndNode æ³¨è§£ç”¨åœ¨å®šä¹‰å…³è”å…³ç³»ä¸¤ç«¯çš„å±æ€§ä¸Šã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒOrder æ˜¯å¼€å§‹èŠ‚ç‚¹ï¼ŒProduct æ˜¯ç»“æŸèŠ‚ç‚¹ã€‚</p>
<p>æœ€åï¼ŒLineItem ç±»æœ‰ä¸€ä¸ª quantity å±æ€§ï¼Œå½“å…³è”å…³ç³»åˆ›å»ºçš„æ—¶å€™ï¼Œå®ƒä¼šæŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ã€‚</p>
<p>é¢†åŸŸå¯¹è±¡å·²ç»æ·»åŠ äº†æ³¨è§£ï¼Œç°åœ¨å°±å¯ä»¥ä¿å­˜ä¸è¯»å–èŠ‚ç‚¹å’Œå…³è”å…³ç³»äº†ã€‚æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ Spring Data Neo4j ä¸­çš„ Neo4jTemplate å®ç°é¢å‘æ¨¡æ¿çš„æ•°æ®è®¿é—®ã€‚</p>
<h4 id="ä½¿ç”¨-Neo4jTemplate"><a href="#ä½¿ç”¨-Neo4jTemplate" class="headerlink" title="ä½¿ç”¨ Neo4jTemplate"></a>ä½¿ç”¨ Neo4jTemplate</h4><p>Spring Data MongoDB æä¾›äº† MongoTemplate å®ç°åŸºäºæ¨¡æ¿çš„ MongoDB æŒä¹…åŒ–ï¼Œä¸ä¹‹ç±»ä¼¼ï¼ŒSpring Data Neo4j æä¾›äº† Neo4jTemplate æ¥æ“ä½œ Neo4j å›¾æ•°æ®åº“ä¸­çš„èŠ‚ç‚¹å’Œå…³è”å…³ç³»ã€‚å¦‚æœä½ å·²ç»æŒ‰ç…§å‰é¢çš„æ–¹å¼é…ç½®äº† Spring Data Neo4jï¼Œåœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­å°±å·²ç»å…·å¤‡äº†ä¸€ä¸ª Neo4jTemplate beanã€‚æ¥ä¸‹æ¥éœ€è¦åšçš„å°±æ˜¯å°†å…¶æ³¨å…¥åˆ°ä»»æ„æƒ³ä½¿ç”¨å®ƒçš„åœ°æ–¹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†å…¶è‡ªåŠ¨è£…é…åˆ°æŸä¸ª bean çš„å±æ€§ä¸Šï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowiredprivate</span> Neo4jOperations neo4j;</span><br></pre></td></tr></table></figure>

<p>Neo4jTemplate å®šä¹‰äº†å¾ˆå¤šçš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ä¿å­˜èŠ‚ç‚¹ã€åˆ é™¤èŠ‚ç‚¹ä»¥åŠåˆ›å»ºèŠ‚ç‚¹é—´çš„å…³è”å…³ç³»ã€‚æˆ‘ä»¬æ²¡æœ‰è¶³å¤Ÿçš„ç¯‡å¹…ä»‹ç»æ‰€æœ‰çš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šçœ‹ä¸€ä¸‹ Neo4jTemplate æ‰€æä¾›çš„æœ€ä¸ºå¸¸ç”¨çš„æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬æƒ³å€ŸåŠ© Neo4jTemplate å®Œæˆçš„æœ€åŸºæœ¬çš„ä¸€ä»¶äº‹æƒ…å¯èƒ½å°±æ˜¯å°†æŸä¸ªå¯¹è±¡ä¿å­˜ä¸ºèŠ‚ç‚¹ã€‚å‡è®¾è¿™ä¸ªå¯¹è±¡å·²ç»ä½¿ç”¨äº† @NodeEntity æ³¨è§£ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼æ¥ä½¿ç”¨ save() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Order order = ...;Order saveOrder = neo4j.save(order);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ èƒ½çŸ¥é“å¯¹è±¡çš„å›¾ IDï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ findOne() æ–¹æ³•æ¥è·å–å®ƒï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Order order = neo4j.findOne(<span class="number">42</span>, Order.class);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæŒ‰ç…§ç»™å®šçš„ ID æ‰¾ä¸åˆ°èŠ‚ç‚¹çš„è¯ï¼Œé‚£ä¹ˆ findOne() æ–¹æ³•å°†ä¼šæŠ›å‡º NotFound(Exception)ã€‚</p>
<p>å¦‚æœä½ æƒ³è·å–ç»™å®šç±»å‹çš„æ‰€æœ‰å¯¹è±¡ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ findAll() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EndResult&lt;Order&gt; allOrders = neo4j.findAll(Order.class);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¿”å›çš„ EndResult æ˜¯ä¸€ä¸ª Iterableï¼Œå®ƒèƒ½å¤Ÿç”¨åœ¨ for-each å¾ªç¯ä»¥åŠä»»ä½•å¯ä»¥ä½¿ç”¨ Iterable çš„åœ°æ–¹ã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„èŠ‚ç‚¹çš„è¯ï¼ŒfindAll() æ–¹æ³•å°†ä¼šè¿”å›ç©ºçš„ Iterableã€‚</p>
<p>å¦‚æœä½ åªæ˜¯æƒ³çŸ¥é“ Neo4j æ•°æ®åº“ä¸­æŒ‡å®šç±»å‹çš„å¯¹è±¡æ•°é‡ï¼Œé‚£ä¹ˆå°±å¯ä»¥è°ƒç”¨ count() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> orderCount = count(Order.class);</span><br></pre></td></tr></table></figure>

<p>delete() æ–¹æ³•å¯ä»¥ç”¨æ¥åˆ é™¤å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">neo4j.delete(order);</span><br></pre></td></tr></table></figure>

<p>createRelationshipBetween() æ˜¯ Neo4jTemplate æ‰€æä¾›çš„æœ€æœ‰æ„æ€çš„æ–¹æ³•ä¹‹ä¸€ã€‚æˆ‘ä»¬å¯ä»¥çŒœåˆ°ï¼Œå®ƒä¼šä¸ºä¸¤ä¸ªèŠ‚ç‚¹åˆ›å»ºå…³è”å…³ç³»ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Order èŠ‚ç‚¹å’Œ Product èŠ‚ç‚¹ä¹‹é—´å»ºç«‹ LineItem å…³è”å…³ç³»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Order order = ...;Product prod = ...;LineItem lineItem = neo4j.createRelationShipBetween(  order, prod, LineItem.class, <span class="string">&quot;HAS_LINE_ITEM_FOR&quot;</span>, <span class="keyword">false</span>);lineItem.setQuantity(<span class="number">5</span>);neo4j.save(lineItem);</span><br></pre></td></tr></table></figure>

<p>createRelationshipBetween() æ–¹æ³•çš„å‰ä¸¤ä¸ªå‚æ•°æ˜¯å…³è”å…³ç³»ä¸¤ç«¯çš„èŠ‚ç‚¹å¯¹è±¡ã€‚æ¥ä¸‹æ¥çš„å‚æ•°æŒ‡å®šäº†ä½¿ç”¨ @RelationshipEntity æ³¨è§£çš„ç±»å‹ï¼Œå®ƒä¼šä»£è¡¨è¿™ç§å…³ç³»ã€‚æ¥ä¸‹æ¥çš„ String å€¼æè¿°äº†å…³è”å…³ç³»çš„ç‰¹å¾ã€‚æœ€åçš„å‚æ•°æ˜¯ä¸€ä¸ª boolean å€¼ï¼Œå®ƒè¡¨æ˜è¿™ä¸¤ä¸ªèŠ‚ç‚¹å®ä½“ä¹‹é—´æ˜¯å¦å…è®¸å­˜åœ¨é‡å¤çš„å…³è”å…³ç³»ã€‚</p>
<p>createRelationshipBetween() ä¼šè¿”å›å…³è”å…³ç³»ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä»»æ„çš„å±æ€§ã€‚ä¸Šé¢çš„ç¤ºä¾‹ä¸­è®¾ç½®äº† quantity å±æ€§ã€‚å½“è¿™ä¸€åˆ‡å®Œæˆåï¼Œæˆ‘ä»¬è°ƒç”¨ save() æ–¹æ³•å°†å…³è”å…³ç³»ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</p>
<p>Neo4jTemplate æä¾›äº†å¾ˆä¾¿åˆ©çš„æ–¹å¼æ¥ä½¿ç”¨ Neo4j å›¾æ•°æ®åº“ä¸­çš„èŠ‚ç‚¹å’Œå…³è”å…³ç³»ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼éœ€è¦å€ŸåŠ© Neo4jTemplate ç¼–å†™è‡ªå·±çš„ Repository å®ç°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ Spring Data Neo4j æ€æ ·ä¸ºæˆ‘ä»¬è‡ªåŠ¨åŒ–ç”Ÿæˆ Repository å®ç°ã€‚</p>
<h4 id="åˆ›å»ºè‡ªåŠ¨åŒ–çš„-Neo4j-Repository"><a href="#åˆ›å»ºè‡ªåŠ¨åŒ–çš„-Neo4j-Repository" class="headerlink" title="åˆ›å»ºè‡ªåŠ¨åŒ–çš„ Neo4j Repository"></a>åˆ›å»ºè‡ªåŠ¨åŒ–çš„ Neo4j Repository</h4><p>å¤§å¤šæ•° Spring Data é¡¹ç›®éƒ½å…·å¤‡çš„æœ€æ£’çš„ä¸€é¡¹åŠŸèƒ½å°±æ˜¯ä¸º Repository æ¥å£è‡ªåŠ¨ç”Ÿæˆå®ç°ã€‚æˆ‘ä»¬å·²ç»åœ¨ Spring Data JPA å’Œ Spring Data MongoDB ä¸­çœ‹åˆ°äº†è¿™é¡¹åŠŸèƒ½ã€‚Spring Data Neo4j ä¹Ÿä¸ä¾‹å¤–ï¼Œå®ƒåŒæ ·æ”¯æŒ Repository è‡ªåŠ¨åŒ–ç”ŸæˆåŠŸèƒ½ã€‚</p>
<p>æˆ‘ä»¬å·²ç»å°† @EnableNeo4jRepositories æ·»åŠ åˆ°äº†é…ç½®ä¸­ï¼Œæ‰€ä»¥ Spring Data Neo4j å·²ç»é…ç½®ä¸ºæ”¯æŒè‡ªåŠ¨åŒ–ç”Ÿæˆ Repository çš„åŠŸèƒ½ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯ç¼–å†™æ¥å£ï¼Œå¦‚ä¸‹çš„ OrderRepository å°±æ˜¯å¾ˆå¥½çš„èµ·ç‚¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> orders.db;<span class="keyword">import</span> orders.Order;<span class="keyword">import</span> org.springframework.data.neo4j.repository.GraphRepository;<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderRepository</span> <span class="keyword">extends</span> <span class="title">GraphRepository</span>&lt;<span class="title">Order</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸å…¶ä»–çš„ Spring Data é¡¹ç›®ä¸€æ ·ï¼ŒSpring Data Neo4j ä¼šä¸ºæ‰©å±• Repository æ¥å£çš„å…¶ä»–æ¥å£ç”Ÿæˆ Repository æ–¹æ³•å®ç°ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒOrderRepository æ‰©å±•äº† GraphRepositoryï¼Œè€Œåè€…åˆé—´æ¥æ‰©å±•äº† Repository æ¥å£ã€‚å› æ­¤ï¼ŒSpring Data Neo4j å°†ä¼šåœ¨è¿è¡Œæ—¶åˆ›å»º OrderRepository çš„å®ç°ã€‚</p>
<p>æ³¨æ„ï¼ŒGraphRepository ä½¿ç”¨ Order è¿›è¡Œäº†å‚æ•°åŒ–ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ª Repository æ‰€è¦ä½¿ç”¨çš„å®ä½“ç±»å‹ã€‚å› ä¸º Neo4j è¦æ±‚å›¾ ID çš„ç±»å‹ä¸º Longï¼Œå› æ­¤åœ¨æ‰©å±• GraphRepository çš„æ—¶å€™ï¼Œæ²¡æœ‰å¿…è¦å†å»æŒ‡å®š ID ç±»å‹ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿä½¿ç”¨å¾ˆå¤šé€šç”¨çš„ CRUD æ“ä½œï¼Œè¿™ä¸ JpaRepository å’Œ MongoRepository æ‰€æä¾›çš„åŠŸèƒ½ç±»ä¼¼ã€‚è¡¨ 12.4 æè¿°äº†æ‰©å±• GraphRepository æ‰€èƒ½å¤Ÿå¾—åˆ°çš„æ–¹æ³•ã€‚</p>
<center>è¡¨ 12.4ã€€é€šè¿‡æ‰©å±• GraphRepositoryï¼ŒRepository æ¥å£èƒ½å¤Ÿç»§æ‰¿å¤šä¸ª CRUD æ“ä½œï¼Œå®ƒä»¬ä¼šç”± Spring Data Neo4j è‡ªåŠ¨å®ç°</center>

<table>
<thead>
<tr>
<th>æ–¹ã€€ã€€æ³•</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>long count();</td>
<td>è¿”å›åœ¨æ•°æ®åº“ä¸­ï¼Œç›®æ ‡ç±»å‹æœ‰å¤šå°‘å®ä½“</td>
</tr>
<tr>
<td>void delete(Iterable&lt;?extendsT&gt;);</td>
<td>åˆ é™¤å¤šä¸ªå®ä½“</td>
</tr>
<tr>
<td>void delete(Long id);</td>
<td>æ ¹æ® IDï¼Œåˆ é™¤ä¸€ä¸ªå®ä½“</td>
</tr>
<tr>
<td>void delete(T);</td>
<td>åˆ é™¤ä¸€ä¸ªå®ä½“</td>
</tr>
<tr>
<td>void deleteAll();</td>
<td>åˆ é™¤ç›®æ ‡ç±»å‹çš„æ‰€æœ‰å®ä½“</td>
</tr>
<tr>
<td>boolean exists(Long id);</td>
<td>æ ¹æ®æŒ‡å®šçš„ IDï¼Œæ£€æŸ¥å®ä½“æ˜¯å¦å­˜åœ¨</td>
</tr>
<tr>
<td>EndResult<T> findAll();</T></td>
<td>è·å–ç›®æ ‡ç±»å‹çš„æ‰€æœ‰å®ä½“</td>
</tr>
<tr>
<td></td>
<td>æ ¹æ®ç»™å®šçš„ IDï¼Œè·å–ç›®æ ‡ç±»å‹çš„å®ä½“</td>
</tr>
<tr>
<td>Page<T> findAll(Pageable);</T></td>
<td>è¿”å›ç›®æ ‡ç±»å‹åˆ†é¡µå’Œæ’åºåçš„å®ä½“åˆ—è¡¨</td>
</tr>
<tr>
<td>EndResult<T> findAll(Sort);</T></td>
<td>è¿”å›ç›®æ ‡ç±»å‹æ’åºåçš„å®ä½“åˆ—è¡¨</td>
</tr>
<tr>
<td>EndResult<T> findAllBySchemaPropertyValue(String,Object);</T></td>
<td>è¿”å›æŒ‡å®šå±æ€§åŒ¹é…ç»™å®šå€¼çš„æ‰€æœ‰å®ä½“</td>
</tr>
<tr>
<td>Iterable<T> findAllByTraversal(N, TraversalDescription);</T></td>
<td>è¿”å›ä»æŸä¸ªèŠ‚ç‚¹å¼€å§‹ï¼Œå›¾éå†åˆ°è¾¾çš„èŠ‚ç‚¹</td>
</tr>
<tr>
<td>T findBySchemaPropertyValue (String,Object);</td>
<td>è¿”å›æŒ‡å®šå±æ€§åŒ¹é…ç»™å®šå€¼çš„ä¸€ä¸ªå®ä½“</td>
</tr>
<tr>
<td>T findOne(Long);</td>
<td>æ ¹æ® IDï¼Œè·å¾—æŸä¸€ä¸ªå®ä½“</td>
</tr>
<tr>
<td>EndResult<T> query(String, Map&lt;String,Object&gt;);</T></td>
<td>è¿”å›åŒ¹é…ç»™å®š Cypher æŸ¥è¯¢çš„æ‰€æœ‰å®ä½“</td>
</tr>
<tr>
<td>Iterable<T> save(Iterable<T>);</T></T></td>
<td>ä¿å­˜å¤šä¸ªå®ä½“</td>
</tr>
<tr>
<td>S save(S);</td>
<td>ä¿å­˜ä¸€ä¸ªå®ä½“</td>
</tr>
</tbody></table>
<p>æˆ‘ä»¬æ²¡æœ‰è¶³å¤Ÿçš„ç¯‡å¹…ä»‹ç»æ‰€æœ‰çš„æ–¹æ³•ï¼Œä½†æ˜¯æœ‰äº›æ–¹æ³•ä½ å¯èƒ½ä¼šç»å¸¸ç”¨åˆ°ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„ä»£ç èƒ½å¤Ÿä¿å­˜ä¸€ä¸ª Order å®ä½“ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Order saveOrder = orderRepository.save(order);</span><br></pre></td></tr></table></figure>

<p>å½“å®ä½“ä¿å­˜ä¹‹åï¼Œsave() æ–¹æ³•å°†ä¼šè¿”å›è¢«ä¿å­˜çš„å®ä½“ï¼Œå¦‚æœä¹‹å‰å®ƒä½¿ç”¨ @GraphId æ³¨è§£çš„å±æ€§å€¼ä¸º null çš„è¯ï¼Œæ­¤æ—¶è¿™ä¸ªå±æ€§å°†ä¼šå¡«å……ä¸Šå€¼ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ findOne() æ–¹æ³•æŸ¥è¯¢æŸä¸€ä¸ªå®ä½“ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„è¿™è¡Œä»£ç å°†ä¼šæŸ¥è¯¢å›¾ ID ä¸º 4 çš„ Orderï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Order order = orderRepository.findOne(<span class="number">4L</span>);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥æŸ¥è¯¢æ‰€æœ‰çš„ Orderï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EndResult&lt;Order&gt; allOrders = orderRepository.findAll();</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œä½ å¯èƒ½è¿˜å¸Œæœ›åˆ é™¤æŸä¸€ä¸ªå®ä½“ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ delete() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete(order);</span><br></pre></td></tr></table></figure>

<p>è¿™å°†ä¼šä»æ•°æ®åº“ä¸­åˆ é™¤ç»™å®šçš„ Order èŠ‚ç‚¹ã€‚å¦‚æœä½ åªæœ‰å›¾ ID çš„è¯ï¼Œé‚£å¯ä»¥å°†å…¶ä¼ é€’åˆ° delete() æ–¹æ³•ä¸­ï¼Œè€Œä¸æ˜¯å†ä½¿ç”¨èŠ‚ç‚¹ç±»å‹æœ¬èº«ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete(orderId);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ å¸Œæœ›è¿›è¡Œè‡ªå®šä¹‰çš„æŸ¥è¯¢ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ query() æ–¹æ³•å¯¹æ•°æ®åº“æ‰§è¡Œä»»æ„çš„ Cypher æŸ¥è¯¢ã€‚ä½†æ˜¯è¿™ä¸ä½¿ç”¨ Neo4jTemplate çš„ query() æ–¹æ³•å¹¶æ²¡æœ‰å¤ªå¤§çš„å·®åˆ«ã€‚å…¶å®ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸º OrderRepository æ·»åŠ è‡ªå®šä¹‰çš„æŸ¥è¯¢æ–¹æ³•ã€‚</p>
<p>æ·»åŠ æŸ¥è¯¢æ–¹æ³•</p>
<p>æˆ‘ä»¬å·²ç»çœ‹è¿‡å¦‚ä½•æŒ‰ç…§å‘½åçº¦å®šä½¿ç”¨ Spring Data JPA å’Œ Spring Data MongoDB æ¥æ·»åŠ è‡ªå®šä¹‰çš„æŸ¥è¯¢æ–¹æ³•ã€‚å¦‚æœ Spring Data Neo4j æ²¡æœ‰æä¾›ç›¸åŒåŠŸèƒ½çš„è¯ï¼Œé‚£æˆ‘ä»¬å°±è¯¥å¤±æœ›äº†ã€‚</p>
<p>å¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºï¼Œå…¶å®æˆ‘ä»¬å®Œå…¨æ²¡æœ‰å¿…è¦å¤±æœ›ï¼š</p>
<center>ç¨‹åºæ¸…å• 12.13ã€€é€šè¿‡éµå¾ªå‘½åçº¦å®šæ¥å®šä¹‰æŸ¥è¯¢æ–¹æ³•</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> orders.db;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> orders.Order;<span class="keyword">import</span> org.springframework.data.neo4j.repository.GraphRepository;<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderRepository</span> <span class="keyword">extends</span> <span class="title">GraphRepository</span>&lt;<span class="title">Order</span>&gt; </span>&#123;  <span class="function">List&lt;Order&gt; <span class="title">findByCustomer</span><span class="params">(String customer)</span></span>;  <span class="function">List&lt;Order&gt; <span class="title">findByCustomerAndType</span><span class="params">(String customer, String type)</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸¤ä¸ªæ–¹æ³•ã€‚å…¶ä¸­ä¸€ä¸ªä¼šæŸ¥è¯¢ customer å±æ€§ç­‰äºç»™å®š String å€¼çš„ Order èŠ‚ç‚¹ã€‚å¦å¤–ä¸€ä¸ªæ–¹æ³•ä¸ä¹‹ç±»ä¼¼ï¼Œä½†æ˜¯é™¤äº†åŒ¹é…æˆ‘ä»¬ä¹‹å‰å·²ç»è®¨è®ºè¿‡æŸ¥è¯¢æ–¹æ³•çš„å‘½åçº¦å®šï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰å¿…è¦å†è¿›è¡Œæ·±å…¥åœ°è®¨è®ºã€‚å¯ä»¥ç¿»çœ‹ä¹‹å‰å­¦ä¹  Spring Data JPA çš„ç« èŠ‚ï¼Œé‡æ–°æ¸©ä¹ å¦‚ä½•ç¼–å†™è¿™äº›æ–¹æ³•ã€‚</p>
<p>æŒ‡å®šè‡ªå®šä¹‰æŸ¥è¯¢</p>
<p>å½“å‘½åçº¦å®šæ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸ºæ–¹æ³•æ·»åŠ  @Query æ³¨è§£ï¼Œä¸ºå…¶æŒ‡å®šè‡ªå®šä¹‰çš„æŸ¥è¯¢ã€‚æˆ‘ä»¬ä¹‹å‰å·²ç»è§è¿‡ @Query æ³¨è§£ã€‚åœ¨ Spring Data JPA ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥ä¸º Repository æ–¹æ³•æŒ‡å®š JPA æŸ¥è¯¢ã€‚åœ¨ Spring Data MongoDB ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥æŒ‡å®šåŒ¹é… JSON çš„æŸ¥è¯¢ã€‚ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨ Spring Data Neo4j çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å®š Cypher æŸ¥è¯¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;match (o:Order)-[:HAS_ITEMS]-&gt;(i:Item) &quot; +       &quot;where i.product=&#x27;Spring in Action&#x27; return o&quot;)</span><span class="function">List&lt;Order&gt; <span class="title">findSiAOrders</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼ŒfindSiAOrders() æ–¹æ³•ä¸Šä½¿ç”¨äº† @Query æ³¨è§£ï¼Œå¹¶è®¾ç½®äº†ä¸€ä¸ª Cypher æŸ¥è¯¢ï¼Œå®ƒä¼šæŸ¥æ‰¾ä¸ Item å…³è”å¹¶ä¸” product å±æ€§ç­‰äº â€œSpring in Actionâ€ çš„æ‰€æœ‰ Order èŠ‚ç‚¹ã€‚</p>
<p>æ··åˆè‡ªå®šä¹‰çš„ Repository è¡Œä¸º</p>
<p>å½“å‘½åçº¦å®šå’Œ @Query æ³¨è§£å‡æ— æ³•æ»¡è¶³æ»¡è¶³éœ€æ±‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ··åˆè‡ªå®šä¹‰çš„ Repository é€»è¾‘ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è‡ªå·±ç¼–å†™ findSiAOrders() æ–¹æ³•çš„å®ç°ï¼Œè€Œä¸æ˜¯ä¾èµ–äº @Query æ³¨è§£ã€‚é‚£ä¹ˆå¯ä»¥é¦–å…ˆå®šä¹‰ä¸€ä¸ªä¸­é—´æ¥å£ï¼Œè¯¥æ¥å£åŒ…å« findSiAOrders() æ–¹æ³•çš„å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> orders.db;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> oders.Order;<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderOperations</span> </span>&#123;  <span class="function">List&lt;Order&gt; <span class="title">findSiAOrders</span><span class="params">()</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œæˆ‘ä»¬ä¿®æ”¹ OrderRepositoryï¼Œè®©å®ƒæ‰©å±• OrderOperations å’Œ GraphRepositoryï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderRepository</span> <span class="keyword">extends</span> <span class="title">GraphRepository</span>&lt;<span class="title">Order</span>&gt;, <span class="title">OrderOperations</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±ç¼–å†™å®ç°ã€‚ä¸ Spring Data JPA å’Œ Spring Data MongoDB ç±»ä¼¼ï¼ŒSpring Data Neo4j å°†ä¼šæŸ¥æ‰¾åå­—ä¸ Repository æ¥å£ç›¸åŒä¸”æ·»åŠ  â€œImplâ€ åç¼€çš„å®ç°ç±»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»º OrderRepositoryImpl ç±»ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç¤ºäº† OrderRepositoryImpl ç±»ï¼Œå®ƒå®ç°äº† findSiAOrders() æ–¹æ³•ã€‚</p>
<center>ç¨‹åºæ¸…å• 12.14ã€€å°†è‡ªå®šä¹‰åŠŸèƒ½æ··åˆåˆ° OrderRepositoryä¸­</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> orders.db;<span class="keyword">import</span> java.util.Collections;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> java.util.Map;<span class="keyword">import</span> orders.Order;<span class="keyword">import</span> org.neo4j.helpers.collection.IteratorUtil;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.data.neo4j.conversion.EndResult;<span class="keyword">import</span> org.springframework.data.neo4j.conversion.Result;<span class="keyword">import</span> org.springframework.data.neo4j.template.Neo4jOperations;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderRepositorylmpl</span> <span class="keyword">implements</span> <span class="title">OrderOperations</span> </span>&#123;  <span class="keyword">private</span> <span class="keyword">final</span> Neo4jOperations neo4j;    <span class="meta">@Autowired</span>  <span class="function"><span class="keyword">public</span> <span class="title">OrderRepositorylmpl</span><span class="params">(Neo4jOperations neo4j)</span> </span>&#123;    <span class="keyword">this</span>.neo4j = neo4j;  &#125;    <span class="function"><span class="keyword">public</span> List&lt;Order&gt; <span class="title">findSiAOrders</span><span class="params">()</span> </span>&#123;    Result&lt;Map&lt;String, Object&gt;&gt; result = neo4j.query(      <span class="string">&quot;match (o:Order)-[:HAS_ITEMS]-&gt;(i:Item) &quot;</span> +      <span class="string">&quot;where i.product=&#x27;Spring in Action&#x27; return o&quot;</span>,      EndResult&lt;Order&gt; endResult = result.to&#123;Order.class);    <span class="keyword">return</span> IteratorUtil.asList(endResult);  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>OrderRepositoryImpl ä¸­æ³¨å…¥äº†ä¸€ä¸ª Neo4jOperationsï¼ˆå…·ä½“æ¥è®²ï¼Œå°±æ˜¯ Neo4jTemplate çš„å®ä¾‹ï¼‰ï¼Œå®ƒä¼šç”¨æ¥æŸ¥è¯¢æ•°æ®åº“ã€‚å› ä¸º query() æ–¹æ³•è¿”å›çš„æ˜¯ Result&lt;Map&lt;String, Object&gt;&gt;ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶è½¬æ¢ä¸º List<Order>ã€‚ç¬¬ä¸€æ­¥æ˜¯è°ƒç”¨ Result çš„ to() æ–¹æ³•ï¼Œäº§ç”Ÿä¸€ä¸ª EndResult<Order>ã€‚ç„¶åï¼Œä½¿ç”¨ Neo4j çš„<br> IteratorUtil.asList() æ–¹æ³•å°† EndResult<Order> è½¬æ¢ä¸º List<Order>ï¼Œç„¶åå°†å…¶è¿”å›ã€‚</Order></Order></Order></Order></p>
<p>å¯¹äºèƒ½å¤Ÿè¡¨è¾¾ä¸ºèŠ‚ç‚¹å’Œå…³è”å…³ç³»çš„æ•°æ®ï¼Œåƒ Neo4j è¿™æ ·çš„å›¾æ•°æ®åº“æ˜¯éå¸¸åˆé€‚çš„ã€‚å¦‚æœå°†æˆ‘ä»¬ç”Ÿæ´»çš„ä¸–ç•Œç†è§£ä¸ºå„ç§äº’ç›¸å…³è”çš„äº‹ç‰©ï¼Œé‚£ä¹ˆå›¾æ•°æ®åº“èƒ½å¤Ÿé€‚ç”¨äºå¾ˆå¤§çš„èŒƒå›´ã€‚å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘éå¸¸å–œæ¬¢çš„æ•°æ®æŒä¹…åŒ–ã€‚</p>
<h3 id="ä½¿ç”¨-Redis-æ“ä½œ-key-value-æ•°æ®"><a href="#ä½¿ç”¨-Redis-æ“ä½œ-key-value-æ•°æ®" class="headerlink" title="ä½¿ç”¨ Redis æ“ä½œ key-value æ•°æ®"></a>ä½¿ç”¨ Redis æ“ä½œ key-value æ•°æ®</h3><p>Redis æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æ•°æ®åº“ï¼Œå®ƒè¢«ç§°ä¹‹ä¸º key-value å­˜å‚¨ã€‚é¡¾åæ€ä¹‰ï¼Œkey-value å­˜å‚¨ä¿å­˜çš„æ˜¯é”®å€¼å¯¹ã€‚å®é™…ä¸Šï¼Œkey-value å­˜å‚¨ä¸å“ˆå¸Œ Map æœ‰å¾ˆå¤§çš„ç›¸ä¼¼æ€§ã€‚å¯ä»¥ä¸å¤ªå¤¸å¼ åœ°è¯´ï¼Œå®ƒä»¬å°±æ˜¯æŒä¹…åŒ–çš„å“ˆå¸Œ Mapã€‚</p>
<p>å½“ä½ æ€è€ƒè¿™ä¸€ç‚¹çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šæ„è¯†åˆ°ï¼Œå¯¹äºå“ˆå¸Œ Map æˆ–è€… key-value å­˜å‚¨æ¥è¯´ï¼Œå…¶å®å¹¶æ²¡æœ‰å¤ªå¤šçš„æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥å°†æŸä¸ª value å­˜å‚¨åˆ°ç‰¹å®šçš„ key ä¸Šï¼Œå¹¶ä¸”èƒ½å¤Ÿæ ¹æ®ç‰¹å®š keyï¼Œè·å– valueã€‚å·®ä¸å¤šä¹Ÿå°±æ˜¯è¿™æ ·äº†ã€‚å› æ­¤ï¼ŒSpring Data çš„è‡ªåŠ¨ Repository ç”ŸæˆåŠŸèƒ½å¹¶æ²¡æœ‰åº”ç”¨åˆ° Redis ä¸Šã€‚ä¸è¿‡ï¼ŒSpring Data çš„å¦å¤–ä¸€ä¸ªå…³é”®ç‰¹æ€§ï¼Œä¹Ÿå°±æ˜¯é¢å‘æ¨¡æ¿çš„æ•°æ®è®¿é—®ï¼Œèƒ½å¤Ÿåœ¨ä½¿ç”¨ Redis çš„æ—¶å€™ï¼Œä¸ºæˆ‘ä»¬æä¾›å¸®åŠ©ã€‚</p>
<p>Spring Data Redis åŒ…å«äº†å¤šä¸ªæ¨¡æ¿å®ç°ï¼Œç”¨æ¥å®Œæˆ Redis æ•°æ®åº“çš„æ•°æ®å­˜å–åŠŸèƒ½ã€‚ç¨åï¼Œæˆ‘ä»¬å°±ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚ä½†æ˜¯ä¸ºäº†åˆ›å»º Spring Data Redis çš„æ¨¡æ¿ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æœ‰ä¸€ä¸ª Redis è¿æ¥å·¥å‚ã€‚å¹¸å¥½ï¼ŒSpring Data Redis æä¾›äº†å››ä¸ªè¿æ¥å·¥å‚ä¾›æˆ‘ä»¬é€‰æ‹©ã€‚</p>
<h4 id="è¿æ¥åˆ°Redis"><a href="#è¿æ¥åˆ°Redis" class="headerlink" title="è¿æ¥åˆ°Redis"></a>è¿æ¥åˆ°Redis</h4><p>Redis è¿æ¥å·¥å‚ä¼šç”Ÿæˆåˆ° Redis æ•°æ®åº“æœåŠ¡å™¨çš„è¿æ¥ã€‚Spring Data Redis ä¸ºå››ç§ Redis å®¢æˆ·ç«¯å®ç°æä¾›äº†è¿æ¥å·¥å‚ï¼š</p>
<ul>
<li>JedisConnectionFactory</li>
<li>JredisConnectionFactory</li>
<li>LettuceConnectionFactory</li>
<li>SrpConnectionFactory</li>
</ul>
<p>å…·ä½“é€‰æ‹©å“ªä¸€ä¸ªå–å†³äºä½ ã€‚æˆ‘å»ºè®®ä½ è‡ªè¡Œæµ‹è¯•å¹¶å»ºç«‹åŸºå‡†ï¼Œè¿›è€Œç¡®å®šå“ªä¸€ç§ Redis å®¢æˆ·ç«¯å’Œè¿æ¥å·¥å‚æœ€é€‚åˆä½ çš„éœ€æ±‚ã€‚ä» Spring Data Redis çš„è§’åº¦æ¥çœ‹ï¼Œè¿™äº›è¿æ¥å·¥å‚åœ¨é€‚ç”¨æ€§ä¸Šéƒ½æ˜¯ç›¸åŒçš„ã€‚</p>
<p>åœ¨åšå‡ºå†³ç­–ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†è¿æ¥å·¥å‚é…ç½®ä¸º Spring ä¸­çš„ beanã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹å±•ç¤ºäº†å¦‚ä½•é…ç½® JedisConnectionFactory beanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">RedisConnectionFactory <span class="title">redisCF</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> JedisConnectionFactory();&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡é»˜è®¤æ„é€ å™¨åˆ›å»ºçš„è¿æ¥å·¥å‚ä¼šå‘ localhost ä¸Šçš„ 6379 ç«¯å£åˆ›å»ºè¿æ¥ï¼Œå¹¶ä¸”æ²¡æœ‰å¯†ç ã€‚å¦‚æœä½ çš„ Redis æœåŠ¡å™¨è¿è¡Œåœ¨å…¶ä»–çš„ä¸»æœºæˆ–ç«¯å£ä¸Šï¼Œåœ¨åˆ›å»ºè¿æ¥å·¥å‚çš„æ—¶å€™ï¼Œå¯ä»¥è®¾ç½®è¿™äº›å±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">RedisConnectionFactory <span class="title">redisCF</span><span class="params">()</span> </span>&#123;  JedisConnectionFactory cf = <span class="keyword">new</span> JedisConnectionFactory();  cf.setHostName(<span class="string">&quot;redis-server&quot;</span>);  cf.setPort(<span class="number">7379</span>);  <span class="keyword">return</span> cf;&#125;</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼åœ°ï¼Œå¦‚æœä½ çš„ Redis æœåŠ¡å™¨é…ç½®ä¸ºéœ€è¦å®¢æˆ·ç«¯è®¤è¯çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è°ƒç”¨ setPassword() æ–¹æ³•æ¥è®¾ç½®å¯†ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">RedisConnectionFactory <span class="title">redisCF</span><span class="params">()</span> </span>&#123;  JedisConnectionFactory cf = <span class="keyword">new</span> JedisConnectionFactory();  cf.setHostName(<span class="string">&quot;redis-server&quot;</span>);  cf.setPort(<span class="number">7379</span>);  cf.setPassword(<span class="string">&quot;foobared&quot;</span>);  <span class="keyword">return</span> cf;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„è¿™äº›ä¾‹å­ä¸­ï¼Œæˆ‘éƒ½å‡è®¾ä½¿ç”¨çš„æ˜¯ JedisConnectionFactoryã€‚å¦‚æœä½ é€‰æ‹©ä½¿ç”¨å…¶ä»–è¿æ¥å·¥å‚çš„è¯ï¼Œåªéœ€è¿›è¡Œç®€å•åœ°æ›¿æ¢å°±å¯ä»¥äº†ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ è¦ä½¿<br>ç”¨ LettuceConnectionFactory çš„è¯ï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">RedisConnectionFactory <span class="title">redisCF</span><span class="params">()</span> </span>&#123;  JedisConnectionFactory cf = <span class="keyword">new</span> LettuceConnectionFactory();  cf.setHostName(<span class="string">&quot;redis-server&quot;</span>);  cf.setPort(<span class="number">7379</span>);  cf.setPassword(<span class="string">&quot;foobared&quot;</span>);  <span class="keyword">return</span> cf;&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€æœ‰çš„ Redis è¿æ¥å·¥å‚éƒ½å…·æœ‰ setHostName()ã€setPort() å’Œ setPassword() æ–¹æ³•ã€‚è¿™æ ·ï¼Œå®ƒä»¬åœ¨é…ç½®æ–¹é¢å®é™…ä¸Šæ˜¯ç›¸åŒçš„ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº† Redis è¿æ¥å·¥å‚ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨ Spring Data Redis æ¨¡æ¿äº†ã€‚</p>
<p>é¡¾åæ€ä¹‰ï¼ŒRedis è¿æ¥å·¥å‚ä¼šç”Ÿæˆåˆ° Redis key-value å­˜å‚¨çš„è¿æ¥ï¼ˆä»¥ RedisConnection çš„å½¢å¼ï¼‰ã€‚å€ŸåŠ© RedisConnectionï¼Œå¯ä»¥å­˜å‚¨å’Œè¯»å–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è·å–è¿æ¥å¹¶ä½¿ç”¨å®ƒæ¥ä¿å­˜ä¸€ä¸ªé—®å€™ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RedisConnectionFactory cf = ...;RedisConnection conn = cf.getConnection();conn.set(<span class="string">&quot;greeting&quot;</span>.getBytes(), <span class="string">&quot;Hello World&quot;</span>.getBytes());</span><br></pre></td></tr></table></figure>

<p>ä¸ä¹‹ç±»ä¼¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ RedisConnection æ¥è·å–ä¹‹å‰å­˜å‚¨çš„é—®å€™ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] greetingBytes = conn.get(<span class="string">&quot;greeting&quot;</span>.getBytes());String greeting = <span class="keyword">new</span> String(greetingBytes());</span><br></pre></td></tr></table></figure>

<p>æ¯«æ— ç–‘é—®ï¼Œè¿™å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ä½ éš¾é“çœŸçš„æ„¿æ„ä½¿ç”¨å­—èŠ‚æ•°ç»„å—ï¼Ÿ</p>
<h4 id="ä½¿ç”¨-Redis-Template"><a href="#ä½¿ç”¨-Redis-Template" class="headerlink" title="ä½¿ç”¨ Redis Template"></a>ä½¿ç”¨ Redis Template</h4><p>ä¸å…¶ä»–çš„ Spring Data é¡¹ç›®ç±»ä¼¼ï¼ŒSpring Data Redis ä»¥æ¨¡æ¿çš„å½¢å¼æä¾›äº†è¾ƒé«˜ç­‰çº§çš„æ•°æ®è®¿é—®æ–¹æ¡ˆã€‚å®é™…ä¸Šï¼ŒSpring Data Redis æä¾›äº†ä¸¤ä¸ªæ¨¡æ¿ï¼š</p>
<ul>
<li>RedisTemplate</li>
<li>StringRedisTemplate</li>
</ul>
<p>RedisTemplate å¯ä»¥æå¤§åœ°ç®€åŒ– Redis æ•°æ®è®¿é—®ï¼Œèƒ½å¤Ÿè®©æˆ‘ä»¬æŒä¹…åŒ–å„ç§ç±»å‹çš„ key å’Œ valueï¼Œå¹¶ä¸å±€é™äºå­—èŠ‚æ•°ç»„ã€‚åœ¨è®¤è¯†åˆ° key å’Œ value é€šå¸¸æ˜¯ String ç±»å‹ä¹‹åï¼ŒStringRedisTemplate æ‰©å±•äº† RedisTemplateï¼Œåªå…³æ³¨ String ç±»å‹ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬å·²ç»æœ‰äº† RedisConnectionFactoryï¼Œé‚£ä¹ˆå¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼æ„å»º RedisTemplateï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RedisConnectionFactory cf = ...;RedisTemplate&lt;String, Product&gt; redis = <span class="keyword">new</span> RedisTemplate&lt;String, Product&gt;();redis.setConnectionFactory(cf);</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼ŒRedisTemplate ä½¿ç”¨ä¸¤ä¸ªç±»å‹è¿›è¡Œäº†å‚æ•°åŒ–ã€‚ç¬¬ä¸€ä¸ªæ˜¯keyçš„ç±»å‹ï¼Œç¬¬äºŒä¸ªæ˜¯ value çš„ç±»å‹ã€‚åœ¨è¿™é‡Œæ‰€æ„å»ºçš„ RedisTemplate ä¸­ï¼Œå°†ä¼šä¿å­˜ Product å¯¹è±¡ä½œä¸º valueï¼Œå¹¶å°†å…¶èµ‹äºˆä¸€ä¸ª String ç±»å‹çš„ keyã€‚</p>
<p>å¦‚æœä½ æ‰€ä½¿ç”¨çš„ value å’Œ key éƒ½æ˜¯ String ç±»å‹ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨ StringRedisTemplate æ¥ä»£æ›¿ RedisTemplateï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RedisConnectionFactory cf = ...;RedisTemplate redis = <span class="keyword">new</span> StringRedisTemplate();</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œä¸ RedisTemplate ä¸åŒï¼ŒStringRedisTemplate æœ‰ä¸€ä¸ªæ¥å— RedisConnectionFactory çš„æ„é€ å™¨ï¼Œå› æ­¤æ²¡æœ‰å¿…è¦åœ¨æ„å»ºåå†è°ƒç”¨ setConnectionFactory()ã€‚</p>
<p>å°½ç®¡è¿™å¹¶éå¿…é¡»çš„ï¼Œä½†æ˜¯å¦‚æœä½ ç»å¸¸ä½¿ç”¨ RedisTemplate æˆ– StringRedisTemplate çš„è¯ï¼Œä½ å¯ä»¥è€ƒè™‘å°†å…¶é…ç½®ä¸º beanï¼Œç„¶åæ³¨å…¥åˆ°éœ€è¦çš„åœ°æ–¹ã€‚å¦‚ä¸‹å°±æ˜¯ä¸€ä¸ªå£°æ˜ RedisTemplate çš„ç®€å• @Bean æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">RedisTemplate&lt;String, Product&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory cf)</span> </span>&#123;  RedisTemplate&lt;String, Product&gt; redis = <span class="keyword">new</span> RedisTemplate&lt;String, Product&gt;();  redis.setConnectionFactory(cf);  <span class="keyword">return</span> redis;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸‹æ˜¯å£°æ˜ StringRedisTemplate bean çš„ @Bean æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">StringRedisTemplate <span class="title">stringRedisTemplate</span><span class="params">(RedisConnectionFactory cf)</span> </span>&#123;  <span class="keyword">return</span> <span class="keyword">new</span> StringRedisTemplate(cf);&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰äº† RedisTemplateï¼ˆæˆ– StringRedisTemplateï¼‰ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ä¿å­˜ã€è·å–ä»¥åŠåˆ é™¤ key-value æ¡ç›®äº†ã€‚RedisTemplate çš„å¤§å¤šæ•°æ“ä½œéƒ½æ˜¯è¡¨ 12.5 ä¸­çš„å­ API æä¾›çš„ã€‚</p>
<center>è¡¨ 12.5ã€€RedisTemplate çš„å¾ˆå¤šåŠŸèƒ½æ˜¯ä»¥å­ API çš„å½¢å¼æä¾›çš„ï¼Œå®ƒä»¬åŒºåˆ†äº†å•ä¸ªå€¼å’Œé›†åˆå€¼çš„åœºæ™¯</center>

<table>
<thead>
<tr>
<th>æ–¹ã€€ã€€æ³•</th>
<th>å­APIæ¥å£</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>opsForValue()</td>
<td>ValueOperations&lt;K, V&gt;</td>
<td>æ“ä½œå…·æœ‰ç®€å•å€¼çš„æ¡ç›®</td>
</tr>
<tr>
<td>opsForList()</td>
<td>ListOperations&lt;K, V&gt;</td>
<td>æ“ä½œå…·æœ‰ list å€¼çš„æ¡ç›®</td>
</tr>
<tr>
<td>opsForSet()</td>
<td>SetOperations&lt;K, V&gt;</td>
<td>æ“ä½œå…·æœ‰ set å€¼çš„æ¡ç›®</td>
</tr>
<tr>
<td>opsForZSet()</td>
<td>ZSetOperations&lt;K, V&gt;</td>
<td>æ“ä½œå…·æœ‰ ZSet å€¼ï¼ˆæ’åºçš„ setï¼‰çš„æ¡ç›®</td>
</tr>
<tr>
<td>opsForHash()</td>
<td>HashOperations&lt;K, HK, HV&gt;</td>
<td>æ“ä½œå…·æœ‰ hash å€¼çš„æ¡ç›®</td>
</tr>
<tr>
<td>boundValueOps(K)</td>
<td>BoundValueOperations&lt;K,V&gt;</td>
<td>ä»¥ç»‘å®šæŒ‡å®š key çš„æ–¹å¼ï¼Œæ“ä½œå…·æœ‰ç®€å•å€¼çš„æ¡ç›®</td>
</tr>
<tr>
<td>boundListOps(K)</td>
<td>BoundListOperations&lt;K,V&gt;</td>
<td>ä»¥ç»‘å®šæŒ‡å®š key çš„æ–¹å¼ï¼Œæ“ä½œå…·æœ‰ list å€¼çš„æ¡ç›®</td>
</tr>
<tr>
<td>boundSetOps(K)</td>
<td>BoundSetOperations&lt;K,V&gt;</td>
<td>ä»¥ç»‘å®šæŒ‡å®š key çš„æ–¹å¼ï¼Œæ“ä½œå…·æœ‰ set å€¼çš„æ¡ç›®</td>
</tr>
<tr>
<td>boundZSet(K)</td>
<td>BoundZSetOperations&lt;K,V&gt;</td>
<td>ä»¥ç»‘å®šæŒ‡å®š key çš„æ–¹å¼ï¼Œæ“ä½œå…·æœ‰ ZSet å€¼ï¼ˆæ’åºçš„ setï¼‰çš„æ¡ç›®</td>
</tr>
<tr>
<td>boundHashOps(K)</td>
<td>BoundHashOperations&lt;K,V&gt;</td>
<td>ä»¥ç»‘å®šæŒ‡å®š key çš„æ–¹å¼ï¼Œæ“ä½œå…·æœ‰ hash å€¼çš„æ¡ç›®</td>
</tr>
</tbody></table>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¡¨ 12.5 ä¸­çš„å­ API èƒ½å¤Ÿé€šè¿‡ RedisTemplateï¼ˆå’Œ StringRedis-Templateï¼‰è¿›è¡Œè°ƒç”¨ã€‚å…¶ä¸­æ¯ä¸ªå­ API éƒ½æä¾›äº†ä½¿ç”¨æ•°æ®æ¡ç›®çš„æ“ä½œï¼ŒåŸºäº value ä¸­æ‰€åŒ…å«çš„æ˜¯å•ä¸ªå€¼è¿˜æ˜¯ä¸€ä¸ªå€¼çš„é›†åˆå®ƒä»¬ä¼šæœ‰æ‰€å·®åˆ«ã€‚</p>
<p>è¿™äº›å­ API ä¸­ï¼ŒåŒ…å«äº†å¾ˆå¤šä» Redis ä¸­å­˜å–æ•°æ®çš„æ–¹æ³•ã€‚æˆ‘ä»¬æ²¡æœ‰è¶³å¤Ÿçš„ç¯‡å¹…ä»‹ç»æ‰€æœ‰çš„æ–¹æ³•ï¼Œä½†æ˜¯ä¼šä»‹ç»ä¸€äº›æœ€ä¸ºå¸¸ç”¨çš„æ“ä½œã€‚</p>
<p>ä½¿ç”¨ç®€å•çš„å€¼</p>
<p>å‡è®¾æˆ‘ä»¬æƒ³é€šè¿‡ RedisTemplate&lt;String, Product&gt; ä¿å­˜ Productï¼Œå…¶ä¸­ key æ˜¯ sku å±æ€§çš„å€¼ã€‚å¦‚ä¸‹çš„ä»£ç ç‰‡æ®µå±•ç¤ºäº†å¦‚ä½•å€ŸåŠ© opsForValue() æ–¹æ³•å®Œæˆè¯¥åŠŸèƒ½ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis.opsForValue().set(product.getSku(), product);</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼åœ°ï¼Œå¦‚æœä½ å¸Œæœ›è·å– sku å±æ€§ä¸º 123456 çš„äº§å“ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„ä»£ç ç‰‡æ®µï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Product product = redis.opsForValue().get(<span class="string">&quot;123456&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæŒ‰ç…§ç»™å®šçš„ keyï¼Œæ— æ³•è·å¾—æ¡ç›®çš„è¯ï¼Œå°†ä¼šè¿”å› nullã€‚</p>
<p>ä½¿ç”¨ List ç±»å‹çš„å€¼</p>
<p>ä½¿ç”¨ List ç±»å‹çš„ value ä¸ä¹‹ç±»ä¼¼ï¼Œåªéœ€ä½¿ç”¨ opsForList() æ–¹æ³•å³å¯ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ª List ç±»å‹çš„æ¡ç›®å°¾éƒ¨æ·»åŠ ä¸€ä¸ªå€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis.opsForList().rightPush(<span class="string">&quot;cart&quot;</span>, product);</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å‘åˆ—è¡¨çš„å°¾éƒ¨æ·»åŠ äº†ä¸€ä¸ª Productï¼Œæ‰€ä½¿ç”¨çš„è¿™ä¸ªåˆ—è¡¨åœ¨å­˜å‚¨æ—¶ key ä¸º cartã€‚å¦‚æœè¿™ä¸ª key å°šæœªå­˜åœ¨åˆ—è¡¨çš„è¯ï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ªã€‚</p>
<p>rightPush() ä¼šåœ¨åˆ—è¡¨çš„å°¾éƒ¨æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œè€Œ leftPush() åˆ™ä¼šåœ¨åˆ—è¡¨çš„å¤´éƒ¨æ·»åŠ ä¸€ä¸ªå€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis.opsForList().leftPush(<span class="string">&quot;cart&quot;</span>, product);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æœ‰å¾ˆå¤šæ–¹å¼ä»åˆ—è¡¨ä¸­è·å–å…ƒç´ ï¼Œå¯ä»¥é€šè¿‡ leftPop() æˆ– rightPop() æ–¹æ³•ä»åˆ—è¡¨ä¸­å¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Product first = redis.opsForList().leftPop(<span class="string">&quot;cart&quot;</span>);Product last = redis.opsForList().rightPop(<span class="string">&quot;cart&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>é™¤äº†ä»åˆ—è¡¨ä¸­è·å–å€¼ä»¥å¤–ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•è¿˜æœ‰ä¸€ä¸ªå‰¯ä½œç”¨å°±æ˜¯ä»åˆ—è¡¨ä¸­ç§»é™¤æ‰€å¼¹å‡ºçš„å…ƒç´ ã€‚å¦‚æœä½ åªæ˜¯æƒ³è·å–å€¼çš„è¯ï¼ˆç”šè‡³å¯èƒ½è¦åœ¨åˆ—è¡¨çš„ä¸­é—´è·å–ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ range() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Product&gt; products = redis.opsForList().range(<span class="string">&quot;cart&quot;</span>, <span class="number">2</span>, <span class="number">12</span>);</span><br></pre></td></tr></table></figure>

<p>range() æ–¹æ³•ä¸ä¼šä»åˆ—è¡¨ä¸­ç§»é™¤ä»»ä½•å…ƒç´ ï¼Œä½†æ˜¯å®ƒä¼šæ ¹æ®æŒ‡å®šçš„ key å’Œç´¢å¼•èŒƒå›´ï¼Œè·å–èŒƒå›´å†…çš„ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ã€‚å‰é¢çš„æ ·ä¾‹ä¸­ï¼Œä¼šè·å– 11 ä¸ªå…ƒç´ ï¼Œä»ç´¢å¼•ä¸º 2 çš„å…ƒç´ åˆ°ç´¢å¼•ä¸º 12 çš„å…ƒç´ ï¼ˆä¸åŒ…å«ï¼‰ã€‚å¦‚æœèŒƒå›´è¶…å‡ºäº†åˆ—è¡¨çš„è¾¹ç•Œï¼Œé‚£ä¹ˆåªä¼šè¿”å›ç´¢å¼•åœ¨èŒƒå›´å†…çš„å…ƒç´ ã€‚å¦‚æœè¯¥ç´¢å¼•èŒƒå›´å†…æ²¡æœ‰å…ƒç´ çš„è¯ï¼Œå°†ä¼šè¿”å›ä¸€ä¸ªç©ºçš„åˆ—è¡¨ã€‚</p>
<p>åœ¨ Set ä¸Šæ‰§è¡Œæ“ä½œ</p>
<p>é™¤äº†æ“ä½œåˆ—è¡¨ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ opsForSet() æ“ä½œ Setã€‚æœ€ä¸ºå¸¸ç”¨çš„å°±æ˜¯å‘å…¶ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis.opsForSet().add(<span class="string">&quot;cart&quot;</span>, product);</span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘ä»¬æœ‰å¤šä¸ª Set å¹¶å¡«å……å€¼ä¹‹åï¼Œå°±å¯ä»¥å¯¹è¿™äº› Set è¿›è¡Œä¸€äº›æœ‰æ„æ€çš„æ“ä½œï¼Œå¦‚è·å–å…¶å·®å¼‚ã€æ±‚äº¤é›†å’Œæ±‚å¹¶é›†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Product&gt; diff = redis.opsForSet().difference(<span class="string">&quot;cart1&quot;</span>, <span class="string">&quot;cart2&quot;</span>);List&lt;Product&gt; union = redis.opsForSet().union(<span class="string">&quot;cart1&quot;</span>, <span class="string">&quot;cart2&quot;</span>);List&lt;Product&gt; isect = redis.opsForSet().isect(<span class="string">&quot;cart1&quot;</span>, <span class="string">&quot;cart2&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç§»é™¤å®ƒçš„å…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis.opsForSet().remove(product);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ç”šè‡³è¿˜å¯ä»¥éšæœºè·å– Set ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Product random = redis.opsForSet().randomMember(<span class="string">&quot;cart&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>å› ä¸º Set æ²¡æœ‰ç´¢å¼•å’Œå†…éƒ¨çš„æ’åºï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•ç²¾å‡†å®šä½æŸä¸ªç‚¹ï¼Œç„¶åä» Set ä¸­è·å–å…ƒç´ ã€‚</p>
<p>ç»‘å®šåˆ°æŸä¸ª key ä¸Š</p>
<p>è¡¨ 12.5 åŒ…å«äº†äº”ä¸ªå­ APIï¼Œå®ƒä»¬èƒ½å¤Ÿä»¥ç»‘å®š key çš„æ–¹å¼æ‰§è¡Œæ“ä½œã€‚è¿™äº›å­ API ä¸å…¶ä»–çš„ API æ˜¯å¯¹åº”çš„ï¼Œä½†æ˜¯å…³æ³¨äºæŸä¸€ä¸ªç»™å®šçš„ keyã€‚</p>
<p>ä¸ºäº†ä¸¾ä¾‹é˜è¿°è¿™äº›å­ API çš„ç”¨æ³•ï¼Œæˆ‘ä»¬å‡è®¾å°† Product å¯¹è±¡ä¿å­˜åˆ°ä¸€ä¸ª list ä¸­ï¼Œå¹¶ä¸” key ä¸º cartã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå‡è®¾æˆ‘ä»¬æƒ³ä» list çš„å³ä¾§å¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç„¶ååœ¨ list çš„å°¾éƒ¨æ–°å¢ä¸‰ä¸ªå…ƒç´ ã€‚æˆ‘ä»¬æ­¤æ—¶å¯ä»¥ä½¿ç”¨ boundListOps() æ–¹æ³•æ‰€è¿”å›çš„ BoundListOperationsï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BoundListOperations&lt;String, Product&gt; cart = redis.boundListOps(<span class="string">&quot;cart&quot;</span>);Product popped = cart.rightPop();cart.rightPush(product1);cart.rightPush(product2);cart.rightPush(product3);</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œæˆ‘ä»¬åªåœ¨ä¸€ä¸ªåœ°æ–¹ä½¿ç”¨äº†æ¡ç›®çš„ keyï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ boundListOps() çš„æ—¶å€™ã€‚å¯¹è¿”å›çš„ BoundListOperations æ‰§è¡Œçš„æ‰€æœ‰æ“ä½œéƒ½ä¼šåº”ç”¨åˆ°è¿™ä¸ª key ä¸Šã€‚</p>
<h4 id="ä½¿ç”¨-key-å’Œ-value-çš„åºåˆ—åŒ–å™¨"><a href="#ä½¿ç”¨-key-å’Œ-value-çš„åºåˆ—åŒ–å™¨" class="headerlink" title="ä½¿ç”¨ key å’Œ value çš„åºåˆ—åŒ–å™¨"></a>ä½¿ç”¨ key å’Œ value çš„åºåˆ—åŒ–å™¨</h4><p>å½“æŸä¸ªæ¡ç›®ä¿å­˜åˆ° Redis key-value å­˜å‚¨çš„æ—¶å€™ï¼Œkey å’Œ value éƒ½ä¼šä½¿ç”¨ Redis çš„åºåˆ—åŒ–å™¨ï¼ˆserializerï¼‰è¿›è¡Œåºåˆ—åŒ–ã€‚Spring Data Redis æä¾›äº†å½“æŸä¸ªæ¡ç›®ä¿å­˜åˆ° Redis key-value å­˜å‚¨çš„æ—¶å€™ï¼Œkey å’Œ value éƒ½ä¼šä½¿ç”¨ Redis çš„åºåˆ—åŒ–å™¨ï¼ˆserializerï¼‰è¿›è¡Œåºåˆ—åŒ–ã€‚Spring Data Redis æä¾›äº†å¤šä¸ªè¿™æ ·çš„åºåˆ—åŒ–å™¨ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>GenericToStringSerializerï¼šä½¿ç”¨ Spring è½¬æ¢æœåŠ¡è¿›è¡Œåºåˆ—åŒ–ï¼›</li>
<li>JacksonJsonRedisSerializerï¼šä½¿ç”¨ Jackson 1ï¼Œå°†å¯¹è±¡åºåˆ—åŒ–ä¸º JSONï¼›</li>
<li>Jackson2JsonRedisSerializerï¼šä½¿ç”¨ Jackson 2ï¼Œå°†å¯¹è±¡åºåˆ—åŒ–ä¸º JSONï¼›</li>
<li>JdkSerializationRedisSerializerï¼šä½¿ç”¨ Java åºåˆ—åŒ–ï¼›</li>
<li>OxmSerializerï¼šä½¿ç”¨ Spring O/X æ˜ å°„çš„ç¼–æ’å™¨å’Œè§£æ’å™¨ï¼ˆmarshaler å’Œ unmarshalerï¼‰å®ç°åºåˆ—åŒ–ï¼Œç”¨äº XML åºåˆ—åŒ–ï¼›</li>
<li>StringRedisSerializerï¼šåºåˆ—åŒ– String ç±»å‹çš„ key å’Œ valueã€‚</li>
</ul>
<p>è¿™äº›åºåˆ—åŒ–å™¨éƒ½å®ç°äº† RedisSerializer æ¥å£ï¼Œå¦‚æœå…¶ä¸­æ²¡æœ‰ç¬¦åˆéœ€æ±‚çš„åºåˆ—åŒ–å™¨ï¼Œé‚£ä¹ˆä½ è¿˜å¯ä»¥è‡ªè¡Œåˆ›å»ºã€‚</p>
<p>RedisTemplate ä¼šä½¿ç”¨ JdkSerializationRedisSerializerï¼Œè¿™æ„å‘³ç€ key å’Œ value éƒ½ä¼šé€šè¿‡ Java è¿›è¡Œåºåˆ—åŒ–ã€‚StringRedisTemplate é»˜è®¤ä¼šä½¿ç”¨ StringRedisSerializerï¼Œè¿™åœ¨æˆ‘ä»¬çš„é¢„æ–™ä¹‹ä¸­ï¼Œå®ƒå®é™…ä¸Šå°±æ˜¯å®ç° String ä¸ byte æ•°ç»„ä¹‹é—´çš„ç›¸äº’è½¬æ¢ã€‚è¿™äº›é»˜è®¤çš„è®¾ç½®é€‚ç”¨äºå¾ˆå¤šçš„åœºæ™¯ï¼Œä½†æœ‰æ—¶å€™ä½ å¯èƒ½ä¼šå‘ç°ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„åºåˆ—åŒ–å™¨ä¹Ÿæ˜¯å¾ˆæœ‰ç”¨å¤„çš„ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾å½“ä½¿ç”¨ RedisTemplate çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å°† Product ç±»å‹çš„ value åºåˆ—åŒ–ä¸º JSONï¼Œè€Œ key æ˜¯ String ç±»å‹ã€‚RedisTemplate çš„ setKeySerializer() å’Œ setValueSerializer() æ–¹æ³•å°±éœ€è¦å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">RedisTemplate&lt;String, Product&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory cf)</span> </span>&#123;  RedisTemplate&lt;String, Product&gt; redis = <span class="keyword">new</span> RedisTemplate&lt;String, Product&gt;();  redis.setConnectionFactory(cf);  redis.setKeySerializer(<span class="keyword">new</span> StringRedisSerializer());  redis.setValueSerializer(<span class="keyword">new</span> Jackson2JsonRedisSerializer&lt;Product&gt;(Product.class));  <span class="keyword">return</span> redis;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è®¾ç½® RedisTemplate åœ¨åºåˆ—åŒ– key çš„æ—¶å€™ï¼Œä½¿ç”¨ StringRedisSerializerï¼Œå¹¶ä¸”ä¹Ÿè®¾ç½®äº†åœ¨åºåˆ—åŒ– Product çš„æ—¶å€™ï¼Œä½¿ç”¨äº† Jackson2JsonRedisSerializerã€‚</p>
<h3 id="å°ç»“-11"><a href="#å°ç»“-11" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å…³ç³»å‹æ•°æ®åº“ä½œä¸ºæ•°æ®æŒä¹…åŒ–é¢†åŸŸå”¯ä¸€å¯é€‰æ–¹æ¡ˆçš„æ—¶ä»£å·²ç»ä¸€å»ä¸è¿”äº†ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰å¤šç§ä¸åŒçš„æ•°æ®åº“ï¼Œæ¯ä¸€ç§éƒ½ä»£è¡¨äº†ä¸åŒå½¢å¼çš„æ•°æ®ï¼Œå¹¶æä¾›äº†é€‚åº”å¤šç§é¢†åŸŸæ¨¡å‹çš„åŠŸèƒ½ã€‚Spring Data èƒ½å¤Ÿè®©æˆ‘ä»¬åœ¨ Spring åº”ç”¨ä¸­ä½¿ç”¨è¿™äº›æ•°æ®åº“ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸€è‡´çš„æŠ½è±¡æ–¹å¼è®¿é—®å„ç§æ•°æ®åº“æ–¹æ¡ˆã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬åŸºäºå‰ä¸€ç« ä½¿ç”¨ JPA æ—¶æ‰€å­¦åˆ°çš„ Spring Data çŸ¥è¯†ï¼Œå°†å…¶åº”ç”¨åˆ°äº† MongoDB æ–‡æ¡£æ•°æ®åº“å’Œ Neo4j å›¾æ•°æ®åº“ä¸­ã€‚ä¸ JPA å¯¹åº”çš„åŠŸèƒ½ç±»ä¼¼ï¼ŒSpring  Data MongoDB å’Œ Spring Data Neo4j é¡¹ç›®éƒ½æä¾›äº†åŸºäºæ¥å£å®šä¹‰è‡ªåŠ¨ç”Ÿæˆ Repository çš„åŠŸèƒ½ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ Spring Data æ‰€æä¾›çš„æ³¨è§£å°†é¢†åŸŸæ¨¡å‹æ˜ å°„ä¸ºæ–‡æ¡£ã€èŠ‚ç‚¹å’Œå…³è”å…³ç³»ã€‚</p>
<p>Spring Data è¿˜æ”¯æŒå°†æ•°æ®æŒä¹…åŒ–åˆ° Redis key-value å­˜å‚¨ä¸­ã€‚Key-value å­˜å‚¨æ˜æ˜¾è¦ç®€å•ä¸€äº›ï¼Œå› æ­¤æ²¡æœ‰å¿…è¦æ”¯æŒè‡ªåŠ¨åŒ– Repository å’Œæ˜ å°„æ³¨è§£ã€‚ä¸è¿‡ï¼ŒSpring  Data Redis è¿˜æ˜¯æä¾›äº†ä¸¤ä¸ªä¸åŒçš„æ¨¡æ¿ç±»æ¥ä½¿ç”¨ Redis key-value å­˜å‚¨ã€‚</p>
<p>ä¸ç®¡ä½ é€‰æ‹©ä½¿ç”¨å“ªç§æ•°æ®åº“ï¼Œä»æ•°æ®åº“ä¸­è·å–æ•°æ®éƒ½æ˜¯æ¶ˆè€—æˆæœ¬çš„æ“ä½œã€‚å®é™…ä¸Šï¼Œæ•°æ®åº“æŸ¥è¯¢æ˜¯å¾ˆå¤šåº”ç”¨æœ€å¤§çš„æ€§èƒ½ç“¶é¢ˆã€‚æˆ‘ä»¬å·²ç»çœ‹è¿‡äº†å¦‚ä½•é€šè¿‡å„ç§æ•°æ®æºå­˜å‚¨å’Œè·å–æ•°æ®ï¼Œç°åœ¨çœ‹ä¸€ä¸‹å¦‚ä½•é¿å…å‡ºç°è¿™ç§ç“¶é¢ˆã€‚åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•å€ŸåŠ©å£°æ˜å¼ç¼“å­˜é¿å…ä¸å¿…è¦çš„æ•°æ®åº“æŸ¥è¯¢ã€‚</p>
<h2 id="ç¼“å­˜æ•°æ®"><a href="#ç¼“å­˜æ•°æ®" class="headerlink" title="ç¼“å­˜æ•°æ®"></a>ç¼“å­˜æ•°æ®</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>å¯ç”¨å£°æ˜å¼ç¼“å­˜</li>
<li>ä½¿ç”¨ Ehcacheã€Redis å’Œ GemFire å®ç°ç¼“å­˜åŠŸèƒ½</li>
<li>æ³¨è§£é©±åŠ¨çš„ç¼“å­˜</li>
</ul>
<p>ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡æœ‰äººåå¤é—®ä½ åŒä¸€ä¸ªé—®é¢˜çš„åœºæ™¯ï¼Œä½ åˆšåˆšç»™å‡ºå®Œè§£ç­”ï¼Œé©¬ä¸Šå°±ä¼šè¢«é—®ç›¸åŒçš„é—®é¢˜ï¼Ÿæˆ‘çš„å­©å­ç»å¸¸ä¼šé—®æˆ‘è¿™æ ·çš„é—®é¢˜ï¼š</p>
<p>â€œæˆ‘èƒ½åƒç‚¹ç³–å—ï¼Ÿâ€</p>
<p>â€œç°åœ¨å‡ ç‚¹äº†ï¼Ÿâ€</p>
<p>â€œæˆ‘ä»¬åˆ°äº†å—ï¼Ÿâ€</p>
<p>â€œæˆ‘èƒ½åƒç‚¹ç³–å—ï¼Ÿâ€</p>
<p>åœ¨å¾ˆå¤šæ–¹é¢çœ‹æ¥ï¼Œåœ¨æˆ‘ä»¬æ‰€ç¼–å†™çš„åº”ç”¨ä¸­ï¼Œæœ‰äº›çš„ç»„ä»¶ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚æ— çŠ¶æ€çš„ç»„ä»¶ä¸€èˆ¬æ¥è®²æ‰©å±•æ€§ä¼šæ›´å¥½ä¸€äº›ï¼Œä½†å®ƒä»¬ä¹Ÿä¼šæ›´åŠ å€¾å‘äºä¸€ééåœ°é—®ç›¸åŒçš„é—®é¢˜ã€‚å› ä¸ºå®ƒä»¬æ˜¯æ— çŠ¶æ€çš„ï¼Œæ‰€ä»¥ä¸€æ—¦å½“å‰çš„ä»»åŠ¡å®Œæˆï¼Œå°±ä¼šä¸¢å¼ƒæ‰å·²ç»è·å–åˆ°çš„æ‰€æœ‰è§£ç­”ï¼Œä¸‹ä¸€æ¬¡éœ€è¦ç›¸åŒçš„ç­”æ¡ˆæ—¶ï¼Œå®ƒä»¬å°±ä¸å¾—ä¸å†é—®ä¸€éè¿™ä¸ªé—®é¢˜ã€‚</p>
<p>å¯¹äºæ‰€æå‡ºçš„é—®é¢˜ï¼Œæœ‰æ—¶å€™éœ€è¦ä¸€ç‚¹æ—¶é—´è¿›è¡Œè·å–æˆ–è®¡ç®—æ‰èƒ½å¾—åˆ°ç­”æ¡ˆã€‚æˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨æ•°æ®åº“ä¸­è·å–æ•°æ®ï¼Œè°ƒç”¨è¿œç¨‹æœåŠ¡æˆ–è€…æ‰§è¡Œå¤æ‚çš„è®¡ç®—ã€‚ä¸ºäº†å¾—åˆ°ç­”æ¡ˆï¼Œè¿™å°±ä¼šèŠ±è´¹æ—¶é—´å’Œèµ„æºã€‚</p>
<p>å¦‚æœé—®é¢˜çš„ç­”æ¡ˆå˜æ›´ä¸é‚£ä¹ˆé¢‘ç¹ï¼ˆæˆ–è€…æ ¹æœ¬ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼‰ï¼Œé‚£ä¹ˆæŒ‰ç…§ç›¸åŒçš„æ–¹å¼å†å»è·å–ä¸€éå°±æ˜¯ä¸€ç§æµªè´¹äº†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿™æ ·åšè¿˜å¯èƒ½ä¼šå¯¹åº”ç”¨çš„æ€§èƒ½äº§ç”Ÿè´Ÿé¢çš„å½±å“ã€‚ä¸€éåˆä¸€éåœ°é—®ç›¸åŒçš„é—®é¢˜ï¼Œè€Œæ¯æ¬¡å¾—åˆ°çš„ç­”æ¡ˆéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸å…¶è¿™æ ·ï¼Œæˆ‘ä»¬è¿˜ä¸å¦‚åªé—®ä¸€éå¹¶å°†ç­”æ¡ˆè®°ä½ï¼Œä»¥ä¾¿ç¨åå†æ¬¡éœ€è¦æ—¶ä½¿ç”¨ã€‚</p>
<p>ç¼“å­˜ï¼ˆCachingï¼‰å¯ä»¥å­˜å‚¨ç»å¸¸ä¼šç”¨åˆ°çš„ä¿¡æ¯ï¼Œè¿™æ ·æ¯æ¬¡éœ€è¦çš„æ—¶å€™ï¼Œè¿™äº›ä¿¡æ¯éƒ½æ˜¯ç«‹å³å¯ç”¨çš„ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šäº†è§£åˆ°Springçš„ç¼“å­˜æŠ½è±¡ã€‚å°½ç®¡ Spring è‡ªèº«å¹¶æ²¡æœ‰å®ç°ç¼“å­˜è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å®ƒå¯¹ç¼“å­˜åŠŸèƒ½æä¾›äº†å£°æ˜å¼çš„æ”¯æŒï¼Œèƒ½å¤Ÿä¸å¤šç§æµè¡Œçš„ç¼“å­˜å®ç°è¿›è¡Œé›†æˆã€‚</p>
<h3 id="å¯ç”¨å¯¹ç¼“å­˜çš„æ”¯æŒ"><a href="#å¯ç”¨å¯¹ç¼“å­˜çš„æ”¯æŒ" class="headerlink" title="å¯ç”¨å¯¹ç¼“å­˜çš„æ”¯æŒ"></a>å¯ç”¨å¯¹ç¼“å­˜çš„æ”¯æŒ</h3><p>Spring å¯¹ç¼“å­˜çš„æ”¯æŒæœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>æ³¨è§£é©±åŠ¨çš„ç¼“å­˜</li>
<li>XML å£°æ˜çš„ç¼“å­˜</li>
</ul>
<p>ä½¿ç”¨ Spring çš„ç¼“å­˜æŠ½è±¡æ—¶ï¼Œæœ€ä¸ºé€šç”¨çš„æ–¹å¼å°±æ˜¯åœ¨æ–¹æ³•ä¸Šæ·»åŠ  @Cacheable å’Œ @CacheEvict æ³¨è§£ã€‚åœ¨æœ¬ç« ä¸­ï¼Œå¤§å¤šæ•°å†…å®¹éƒ½ä¼šä½¿ç”¨è¿™ç§ç±»å‹çš„å£°æ˜å¼æ³¨è§£ã€‚åœ¨ 13.3 å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨ XML æ¥å£°æ˜ç¼“å­˜è¾¹ç•Œã€‚</p>
<p>åœ¨å¾€ bean ä¸Šæ·»åŠ ç¼“å­˜æ³¨è§£ä¹‹å‰ï¼Œå¿…é¡»è¦å¯ç”¨ Spring å¯¹æ³¨è§£é©±åŠ¨ç¼“å­˜çš„æ”¯æŒã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ Java é…ç½®çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨å…¶ä¸­çš„ä¸€ä¸ªé…ç½®ç±»ä¸Šæ·»åŠ  @EnableCachingï¼Œè¿™æ ·çš„è¯å°±èƒ½å¯ç”¨æ³¨è§£é©±åŠ¨çš„ç¼“å­˜ã€‚ç¨‹åºæ¸…å• 13.1 å±•ç°äº†å¦‚ä½•å®é™…ä½¿ç”¨ @EnableCachingã€‚</p>
<center>ç¨‹åºæ¸…å• 13.1ã€€é€šè¿‡ä½¿ç”¨ @EnableCaching å¯ç”¨æ³¨è§£é©±åŠ¨çš„ç¼“å­˜</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.config;<span class="keyword">import</span> net.sf.ehcache.CacheManager;<span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;<span class="keyword">import</span> org.springframework.cache.ehcache.EhCacheCacheManager;<span class="keyword">import</span> org.springframework.cache.ehcache.EhCacheManagerFactoryBean;<span class="keyword">import</span> org.springframework.context.annotation.Bean;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.core.io.ClassPathResource;<span class="meta">@Configuration</span><span class="meta">@EnableCachingpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">CachingConfig</span> </span>&#123;  <span class="meta">@Bean</span>  <span class="function"><span class="keyword">public</span> EhCacheCacheManager <span class="title">cacheManager</span><span class="params">(CacheManager cm)</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> EhCacheCacheManager(cm);  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä»¥ XML çš„æ–¹å¼é…ç½®åº”ç”¨çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ Spring cache å‘½åç©ºé—´ä¸­çš„ <code>&lt;cache:annotation-driven&gt;</code> å…ƒç´ æ¥å¯ç”¨æ³¨è§£é©±åŠ¨çš„ç¼“å­˜ã€‚</p>
<center>ç¨‹åºæ¸…å• 13.2ã€€é€šè¿‡ä½¿ç”¨å¯ç”¨æ³¨è§£é©±åŠ¨çš„ç¼“å­˜</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>  xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  xmlns:cache=<span class="string">&quot;http://www.springframework.org/schema/cache&quot;</span>  xsi:schemaLocation=<span class="string">&quot;    http://www.springframework.org/schema/beans     http://www.springframework.org/schema/beans/spring-beans.xsd    http://www.springframework.org/schema/cache    http://www.springframework.org/schema/cache/spring-cache.xsd&quot;</span> &gt;    &lt;cache:annotation-driven /&gt;    &lt;bean id=<span class="string">&quot;cacheManager&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;org.springframework.cache.concurrent.ConcurrentMapCacheManager&quot;</span> /&gt;&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<p>å…¶å®åœ¨æœ¬è´¨ä¸Šï¼Œ@EnableCaching å’Œ <code>&lt;cache:annotationdriven&gt;</code> çš„å·¥ä½œæ–¹å¼æ˜¯ç›¸åŒçš„ã€‚å®ƒä»¬éƒ½ä¼šåˆ›å»ºä¸€ä¸ªåˆ‡é¢ï¼ˆaspectï¼‰å¹¶è§¦å‘ Spring ç¼“å­˜æ³¨è§£çš„åˆ‡ç‚¹ï¼ˆpointcutï¼‰ã€‚æ ¹æ®æ‰€ä½¿ç”¨çš„æ³¨è§£ä»¥åŠç¼“å­˜çš„çŠ¶æ€ï¼Œè¿™ä¸ªåˆ‡é¢ä¼šä»ç¼“å­˜ä¸­è·å–æ•°æ®ï¼Œå°†æ•°æ®æ·»åŠ åˆ°ç¼“å­˜ä¹‹ä¸­æˆ–è€…ä»ç¼“å­˜ä¸­ç§»é™¤æŸä¸ªå€¼ã€‚</p>
<p>åœ¨ç¨‹åºæ¸…å• 13.1å’Œç¨‹åºæ¸…å• 13.2 ä¸­ï¼Œä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œå®ƒä»¬ä¸ä»…ä»…å¯ç”¨äº†æ³¨è§£é©±åŠ¨çš„ç¼“å­˜ï¼Œè¿˜å£°æ˜äº†ä¸€ä¸ªç¼“å­˜ç®¡ç†å™¨ï¼ˆcacheManagerï¼‰çš„ beanã€‚ç¼“å­˜ç®¡ç†å™¨æ˜¯ Spring ç¼“å­˜æŠ½è±¡çš„æ ¸å¿ƒï¼Œå®ƒèƒ½å¤Ÿä¸å¤šä¸ªæµè¡Œçš„ç¼“å­˜å®ç°è¿›è¡Œé›†æˆã€‚</p>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œå£°æ˜äº† ConcurrentMapCacheManagerï¼Œè¿™ä¸ªç®€å•çš„ç¼“å­˜ç®¡ç†å™¨ä½¿ç”¨ java.util.concurrent.ConcurrentHashMap ä½œä¸ºå…¶ç¼“å­˜å­˜å‚¨ã€‚å®ƒéå¸¸ç®€å•ï¼Œå› æ­¤å¯¹äºå¼€å‘ã€æµ‹è¯•æˆ–åŸºç¡€çš„åº”ç”¨æ¥è®²ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„é€‰æ‹©ã€‚ä½†å®ƒçš„ç¼“å­˜å­˜å‚¨æ˜¯åŸºäºå†…å­˜çš„ï¼Œæ‰€ä»¥å®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸åº”ç”¨å…³è”çš„ï¼Œå¯¹äºç”Ÿäº§çº§åˆ«çš„å¤§å‹ä¼ä¸šçº§åº”ç”¨ç¨‹åºï¼Œè¿™å¯èƒ½å¹¶ä¸æ˜¯ç†æƒ³çš„é€‰æ‹©ã€‚</p>
<p>å¹¸å¥½ï¼Œæœ‰å¤šä¸ªå¾ˆæ£’çš„ç¼“å­˜ç®¡ç†å™¨æ–¹æ¡ˆå¯ä¾›ä½¿ç”¨ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å‡ ä¸ªæœ€ä¸ºå¸¸ç”¨çš„ç¼“å­˜ç®¡ç†å™¨ã€‚</p>
<h4 id="é…ç½®ç¼“å­˜ç®¡ç†å™¨"><a href="#é…ç½®ç¼“å­˜ç®¡ç†å™¨" class="headerlink" title="é…ç½®ç¼“å­˜ç®¡ç†å™¨"></a>é…ç½®ç¼“å­˜ç®¡ç†å™¨</h4><p>Spring 3.1 å†…ç½®äº†äº”ä¸ªç¼“å­˜ç®¡ç†å™¨å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>SimpleCacheManager</li>
<li>NoOpCacheManager</li>
<li>ConcurrentMapCacheManager</li>
<li>CompositeCacheManager</li>
<li>EhCacheCacheManager</li>
</ul>
<p>Spring 3.2 å¼•å…¥äº†å¦å¤–ä¸€ä¸ªç¼“å­˜ç®¡ç†å™¨ï¼Œè¿™ä¸ªç®¡ç†å™¨å¯ä»¥ç”¨åœ¨åŸºäº JCacheï¼ˆJSR-107ï¼‰çš„ç¼“å­˜æä¾›å•†ä¹‹ä¸­ã€‚é™¤äº†æ ¸å¿ƒçš„ Spring æ¡†æ¶ï¼ŒSpring Data åˆæä¾›äº†ä¸¤ä¸ªç¼“å­˜ç®¡ç†å™¨ï¼š</p>
<ul>
<li>RedisCacheManagerï¼ˆæ¥è‡ªäº Spring Data Redis é¡¹ç›®ï¼‰</li>
<li>GemfireCacheManagerï¼ˆæ¥è‡ªäº Spring Data GemFire é¡¹ç›®ï¼‰</li>
</ul>
<p>æ‰€ä»¥å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸º Spring çš„ç¼“å­˜æŠ½è±¡é€‰æ‹©ç¼“å­˜ç®¡ç†å™¨æ—¶ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šå¯é€‰æ–¹æ¡ˆã€‚å…·ä½“é€‰æ‹©å“ªä¸€ä¸ªè¦å–å†³äºæƒ³è¦ä½¿ç”¨çš„åº•å±‚ç¼“å­˜ä¾›åº”å•†ã€‚æ¯ä¸€ä¸ªæ–¹æ¡ˆéƒ½å¯ä»¥ä¸ºåº”ç”¨æä¾›ä¸åŒé£æ ¼çš„ç¼“å­˜ï¼Œå…¶ä¸­æœ‰ä¸€äº›ä¼šæ¯”å…¶ä»–çš„æ›´åŠ é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚å°½ç®¡æ‰€åšå‡ºçš„é€‰æ‹©ä¼šå½±å“åˆ°æ•°æ®å¦‚ä½•ç¼“å­˜ï¼Œä½†æ˜¯ Spring å£°æ˜ç¼“å­˜çš„æ–¹å¼ä¸Šå¹¶æ²¡æœ‰ä»€ä¹ˆå·®åˆ«ã€‚</p>
<p>æˆ‘ä»¬å¿…é¡»é€‰æ‹©ä¸€ä¸ªç¼“å­˜ç®¡ç†å™¨ï¼Œç„¶åè¦åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œä»¥ bean çš„å½¢å¼å¯¹å…¶è¿›è¡Œé…ç½®ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•é…ç½® ConcurrentMapCacheManagerï¼Œå¹¶ä¸”çŸ¥é“å®ƒå¯èƒ½å¹¶ä¸æ˜¯å®é™…åº”ç”¨çš„æœ€ä½³é€‰æ‹©ã€‚ç°åœ¨ï¼Œçœ‹ä¸€ä¸‹å¦‚ä½•é…ç½®Springå…¶ä»–çš„ç¼“å­˜ç®¡ç†å™¨ï¼Œä» EhCacheCacheManager å¼€å§‹å§ã€‚</p>
<p>ä½¿ç”¨ Ehcache ç¼“å­˜</p>
<p>Ehcache æ˜¯æœ€ä¸ºæµè¡Œçš„ç¼“å­˜ä¾›åº”å•†ä¹‹ä¸€ã€‚Ehcache ç½‘ç«™ä¸Šè¯´å®ƒæ˜¯ â€œJava é¢†åŸŸåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ç¼“å­˜â€ã€‚é‰´äºå®ƒçš„å¹¿æ³›é‡‡ç”¨ï¼ŒSpring æä¾›é›†æˆ Ehcache çš„ç¼“å­˜ç®¡ç†å™¨æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ã€‚è¿™ä¸ªç¼“å­˜ç®¡ç†å™¨ä¹Ÿå°±æ˜¯ EhCacheCacheManagerã€‚</p>
<p>å½“è¯»è¿™ä¸ªåå­—çš„æ—¶å€™ï¼Œåœ¨ cache è¿™ä¸ªè¯ä¸Šä¼¼ä¹æœ‰ç‚¹ç»“ç»“å·´å·´çš„æ„Ÿè§‰ã€‚åœ¨ Spring ä¸­é…ç½® EhCacheCacheManager æ˜¯å¾ˆå®¹æ˜“çš„ã€‚ç¨‹åºæ¸…å• 13.3 å±•ç°äº†å¦‚ä½•åœ¨ Java ä¸­å¯¹å…¶è¿›è¡Œé…ç½®ã€‚</p>
<center>ç¨‹åºæ¸…å• 13.3ã€€ä»¥ Java é…ç½®çš„æ–¹å¼è®¾ç½® EhCacheCacheManager</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.config;<span class="keyword">import</span> net.sf.ehcache.CacheManager;<span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;<span class="keyword">import</span> org.springframework.cache.ehcache.EhCacheCacheManager;<span class="keyword">import</span> org.springframework.cache.ehcache.EhCacheManagerFactoryBean;<span class="keyword">import</span> org.springframework.context.annotation.Bean;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.core.io.ClassPathResource;<span class="meta">@Configuration</span><span class="meta">@EnableCachingpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">CachingConfig</span> </span>&#123;  <span class="meta">@Bean</span>  <span class="function"><span class="keyword">public</span> EhCacheCacheManager <span class="title">cacheManager</span><span class="params">(CacheManager cm)</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> EhCacheCacheManager(cm);  &#125;  <span class="meta">@Bean</span>  <span class="function"><span class="keyword">public</span> EhCacheManagerFactoryBean <span class="title">ehcache</span><span class="params">()</span> </span>&#123;    EhCacheManagerFactoryBean ehCacheFactoryBean =         <span class="keyword">new</span> EhCacheManagerFactoryBean();    ehCacheFactoryBean.setConfigLocation(        <span class="keyword">new</span> ClassPathResource(<span class="string">&quot;spittr/cache/ehcache.xml&quot;</span>));    <span class="keyword">return</span> ehCacheFactoryBean;  &#125;  &#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¨‹åºæ¸…å• 13.3 ä¸­ï¼ŒcacheManager() æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª EhCacheCacheManager çš„å®ä¾‹ï¼Œè¿™æ˜¯é€šè¿‡ä¼ å…¥ EhcacheCacheManager å®ä¾‹å®ç°çš„ã€‚åœ¨è¿™é‡Œï¼Œç¨å¾®æœ‰ç‚¹è¯¡å¼‚çš„æ³¨å…¥å¯èƒ½ä¼šè®©äººæ„Ÿè§‰è¿·æƒ‘ï¼Œè¿™æ˜¯å› ä¸º Spring å’Œ EhCache éƒ½å®šä¹‰äº† CacheManager ç±»å‹ã€‚éœ€è¦æ˜ç¡®çš„æ˜¯ï¼ŒEhCache çš„ CacheManager è¦è¢«æ³¨å…¥åˆ° Springçš„ EhCacheCacheManagerï¼ˆSpring CacheManager çš„å®ç°ï¼‰ä¹‹ä¸­ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦ä½¿ç”¨ EhCache çš„ CacheManager æ¥è¿›è¡Œæ³¨å…¥ï¼Œæ‰€ä»¥å¿…é¡»ä¹Ÿè¦å£°æ˜ä¸€ä¸ª CacheManager beanã€‚ä¸ºäº†å¯¹å…¶è¿›è¡Œç®€åŒ–ï¼ŒSpring æä¾›äº† EhCacheManagerFactoryBean æ¥ç”Ÿæˆ EhCache çš„ CacheManagerã€‚æ–¹æ³• ehcache() ä¼šåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª EhCacheManagerFactoryBean å®ä¾‹ã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå·¥å‚ beanï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå®ç°äº† Spring çš„ FactoryBean æ¥å£ï¼‰ï¼Œæ‰€ä»¥æ³¨å†Œåœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„å¹¶ä¸æ˜¯ EhCacheManagerFactoryBean çš„å®ä¾‹ï¼Œè€Œæ˜¯ CacheManager çš„ä¸€ä¸ªå®ä¾‹ï¼Œå› æ­¤é€‚åˆæ³¨å…¥åˆ° EhCacheCacheManager ä¹‹ä¸­ã€‚</p>
<p>é™¤äº†åœ¨ Spring ä¸­é…ç½®çš„ beanï¼Œè¿˜éœ€è¦æœ‰é’ˆå¯¹ EhCache çš„é…ç½®ã€‚EhCache ä¸º XML å®šä¹‰äº†è‡ªå·±çš„é…ç½®æ¨¡å¼ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ª XML æ–‡ä»¶ä¸­é…ç½®ç¼“å­˜ï¼Œè¯¥æ–‡ä»¶éœ€è¦ç¬¦åˆ EhCache æ‰€å®šä¹‰çš„æ¨¡å¼ã€‚åœ¨åˆ›å»º EhCacheManagerFactoryBean çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å‘Šè¯‰å®ƒ EhCache é…ç½®æ–‡ä»¶åœ¨ä»€ä¹ˆåœ°æ–¹ã€‚åœ¨è¿™é‡Œé€šè¿‡è°ƒç”¨ setConfigLocation()æ–¹æ³•ï¼Œä¼ å…¥ ClassPathResourceï¼Œç”¨æ¥æŒ‡æ˜ EhCache XML é…ç½®æ–‡ä»¶ç›¸å¯¹äºæ ¹ç±»è·¯å¾„ï¼ˆclasspathï¼‰çš„ä½ç½®ã€‚</p>
<p>è‡³äº ehcache.xml æ–‡ä»¶çš„å†…å®¹ï¼Œä¸åŒçš„åº”ç”¨ä¹‹é—´ä¼šæœ‰æ‰€å·®åˆ«ï¼Œä½†æ˜¯è‡³å°‘éœ€è¦å£°æ˜ä¸€ä¸ªæœ€å°çš„ç¼“å­˜ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„ EhCache é…ç½®å£°æ˜ä¸€ä¸ªåä¸º spittleCache çš„ç¼“å­˜ï¼Œå®ƒæœ€å¤§çš„å †å­˜å‚¨ä¸º 50 MBï¼Œå­˜æ´»æ—¶é—´ä¸º 100 ç§’ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;ehcache&gt;  &lt;cache name=<span class="string">&quot;spittleCache&quot;</span> maxBytesLocalHeap=<span class="string">&quot;50m&quot;</span> timeToLiveSeconds=<span class="string">&quot;100&quot;</span>&gt;  &lt;/cache&gt;&lt;/ehcache&gt;</span><br></pre></td></tr></table></figure>

<p>æ˜¾ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºç¡€çš„ EhCache é…ç½®ã€‚åœ¨ä½ çš„åº”ç”¨ä¹‹ä¸­ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ EhCache æ‰€æä¾›çš„ä¸°å¯Œçš„é…ç½®é€‰é¡¹ã€‚å‚è€ƒ EhCache çš„æ–‡æ¡£ä»¥äº†è§£è°ƒä¼˜ EhCache é…ç½®çš„ç»†èŠ‚ï¼Œåœ°å€æ˜¯ <a target="_blank" rel="noopener" href="http://ehcache.org/documentation/configuration%E3%80%82">http://ehcache.org/documentation/configurationã€‚</a></p>
<p>ä½¿ç”¨ Redis ç¼“å­˜</p>
<p>å¦‚æœä½ ä»”ç»†æƒ³ä¸€ä¸‹çš„è¯ï¼Œç¼“å­˜çš„æ¡ç›®ä¸è¿‡æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆkey-valuepairï¼‰ï¼Œå…¶ä¸­ key æè¿°äº†äº§ç”Ÿ value çš„æ“ä½œå’Œå‚æ•°ã€‚å› æ­¤ï¼Œå¾ˆè‡ªç„¶åœ°å°±ä¼šæƒ³åˆ°ï¼ŒRedis ä½œä¸º key-value å­˜å‚¨ï¼Œéå¸¸é€‚åˆäºå­˜å‚¨ç¼“å­˜ã€‚</p>
<p>Redis å¯ä»¥ç”¨æ¥ä¸º Spring ç¼“å­˜æŠ½è±¡æœºåˆ¶å­˜å‚¨ç¼“å­˜æ¡ç›®ï¼ŒSpring Data Redis æä¾›äº† RedisCacheManagerï¼Œè¿™æ˜¯ CacheManager çš„ä¸€ä¸ªå®ç°ã€‚ RedisCacheManager ä¼šä¸ä¸€ä¸ª Redis æœåŠ¡å™¨åä½œï¼Œå¹¶é€šè¿‡ RedisTemplate å°†ç¼“å­˜æ¡ç›®å­˜å‚¨åˆ° Redis ä¸­ã€‚</p>
<p>ä¸ºäº†ä½¿ç”¨ RedisCacheManagerï¼Œæˆ‘ä»¬éœ€è¦ RedisTemplate bean ä»¥åŠ RedisConnectionFactory å®ç°ç±»ï¼ˆå¦‚ JedisConnectionFactoryï¼‰çš„ä¸€ä¸ª beanã€‚åœ¨ç¬¬ 12 ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†è¿™äº› bean è¯¥å¦‚ä½•é…ç½®ã€‚åœ¨ RedisTemplate å°±ç»ªä¹‹åï¼Œé…ç½® RedisCacheManager å°±æ˜¯éå¸¸ç®€å•çš„äº‹æƒ…äº†ï¼Œå¦‚ç¨‹åºæ¸…å• 13.4 æ‰€ç¤ºã€‚</p>
<center>ç¨‹åºæ¸…å• 13.4ã€€é…ç½®å°†ç¼“å­˜æ¡ç›®å­˜å‚¨åœ¨RedisæœåŠ¡å™¨çš„ç¼“å­˜ç®¡ç†å™¨</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.config;<span class="keyword">import</span> net.sf.ehcache.CacheManager;<span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;<span class="keyword">import</span> org.springframework.context.annotation.Bean;<span class="keyword">import</span> org.springframework.data.redis.cache.RedisCacheManager;<span class="keyword">import</span> org.springframework.data.redis.connection.jedis.JedisConnectionFactory;<span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="meta">@Configuration</span><span class="meta">@EnableCachingpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">CachingConfig</span> </span>&#123;    <span class="meta">@Bean</span>    <span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">(RedisTemplate redisTemplate)</span> </span>&#123;        <span class="keyword">return</span> <span class="keyword">new</span> RedisCacheManager(redisTemplate);    &#125;        <span class="meta">@Bean</span>    <span class="function"><span class="keyword">public</span> JedisConnectionFactory <span class="title">redisConnectionFactory</span><span class="params">()</span> </span>&#123;        JedisConnectionFactory jedisConnectionFactory =            <span class="keyword">new</span> JedisConnectionFactory();        jedisConnectionFactory.afterPropertiesSet();        <span class="keyword">return</span> jedisConnectionFactory;    &#125;      <span class="meta">@Bean</span>    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, String&gt; <span class="title">redisTemplate</span><span class="params">(        RedisConnectionFactory redisCF)</span> </span>&#123;        RedisTemplate&lt;String, String&gt; redisTemplate =            <span class="keyword">new</span> RedisTemplate&lt;String, String&gt;();        redisTemplate.setConnectionFactory(redisCf);        redisTemplate.afterPropertiesSet();        <span class="keyword">return</span> redisTemplate;    &#125;  &#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ª RedisCacheManagerï¼Œè¿™æ˜¯é€šè¿‡ä¼ é€’ä¸€ä¸ª RedisTemplate å®ä¾‹ä½œä¸ºå…¶æ„é€ å™¨çš„å‚æ•°å®ç°çš„ã€‚</p>
<p>ä½¿ç”¨å¤šä¸ªç¼“å­˜ç®¡ç†å™¨</p>
<p>æˆ‘ä»¬å¹¶ä¸æ˜¯åªèƒ½æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªç¼“å­˜ç®¡ç†å™¨ã€‚å¦‚æœä½ å¾ˆéš¾ç¡®å®šè¯¥ä½¿ç”¨å“ªä¸ªç¼“å­˜ç®¡ç†å™¨ï¼Œæˆ–è€…æœ‰åˆæ³•çš„æŠ€æœ¯ç†ç”±ä½¿ç”¨è¶…è¿‡ä¸€ä¸ªç¼“å­˜ç®¡ç†å™¨çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•ä½¿ç”¨ Spring çš„ CompositeCacheManagerã€‚</p>
<p>CompositeCacheManager è¦é€šè¿‡ä¸€ä¸ªæˆ–æ›´å¤šçš„ç¼“å­˜ç®¡ç†å™¨æ¥è¿›è¡Œé…ç½®ï¼Œå®ƒä¼šè¿­ä»£è¿™äº›ç¼“å­˜ç®¡ç†å™¨ï¼Œä»¥æŸ¥æ‰¾ä¹‹å‰æ‰€ç¼“å­˜çš„å€¼ã€‚ä»¥ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¦‚ä½•åˆ›å»º CompositeCacheManager beanï¼Œå®ƒä¼šè¿­ä»£ JCacheCacheManagerã€EhCacheCacheManager å’Œ RedisCacheManagerã€‚</p>
<center>ç¨‹åºæ¸…å• 13.5ã€€CompositeCacheManager ä¼šè¿­ä»£ä¸€ä¸ªç¼“å­˜ç®¡ç†å™¨çš„åˆ—è¡¨</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">CacheManager <span class="title">ehcacheManager</span><span class="params">(    net.sf.ehcache.CacheManager cm,    javax.cache.CacheManager jcm)</span> </span>&#123;  CompositeCacheManager cacheManager = <span class="keyword">new</span> CompositeCacheManager();  List&lt;CacheManager&gt; managers = <span class="keyword">new</span> ArrayList&lt;CacheManager&gt;();  managers.add(<span class="keyword">new</span> JCacheCacheManager(jcm));  managers.add(<span class="keyword">new</span> EhcacheCacheManager(cm));  managers.add(<span class="keyword">new</span> RedisCacheManager(redisTemplate()));  cacheManager,setCacheManagers(managers);  <span class="keyword">return</span> cacheManager;&#125;</span><br></pre></td></tr></table></figure>

<p>å½“æŸ¥æ‰¾ç¼“å­˜æ¡ç›®æ—¶ï¼ŒCompositeCacheManager é¦–å…ˆä¼šä» JCacheCacheManager å¼€å§‹æ£€æŸ¥ JCache å®ç°ï¼Œç„¶åé€šè¿‡ EhCacheCacheManager æ£€æŸ¥ Ehcacheï¼Œæœ€åä¼šä½¿ç”¨ RedisCacheManager æ¥æ£€æŸ¥ Redisï¼Œå®Œæˆç¼“å­˜æ¡ç›®çš„æŸ¥æ‰¾ã€‚</p>
<p>åœ¨é…ç½®å®Œç¼“å­˜ç®¡ç†å™¨å¹¶å¯ç”¨ç¼“å­˜åï¼Œå°±å¯ä»¥åœ¨ bean æ–¹æ³•ä¸Šåº”ç”¨ç¼“å­˜è§„åˆ™äº†ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ Spring çš„ç¼“å­˜æ³¨è§£æ¥å®šä¹‰ç¼“å­˜è¾¹ç•Œã€‚</p>
<h3 id="ä¸ºæ–¹æ³•æ·»åŠ æ³¨è§£ä»¥æ”¯æŒç¼“å­˜"><a href="#ä¸ºæ–¹æ³•æ·»åŠ æ³¨è§£ä»¥æ”¯æŒç¼“å­˜" class="headerlink" title="ä¸ºæ–¹æ³•æ·»åŠ æ³¨è§£ä»¥æ”¯æŒç¼“å­˜"></a>ä¸ºæ–¹æ³•æ·»åŠ æ³¨è§£ä»¥æ”¯æŒç¼“å­˜</h3><p>å¦‚å‰æ–‡æ‰€è¿°ï¼ŒSpring çš„ç¼“å­˜æŠ½è±¡åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å›´ç»•åˆ‡é¢æ„å»ºçš„ã€‚åœ¨ Spring ä¸­å¯ç”¨ç¼“å­˜æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªåˆ‡é¢ï¼Œå®ƒè§¦å‘ä¸€ä¸ªæˆ–æ›´å¤šçš„ Spring çš„ç¼“å­˜æ³¨è§£ã€‚è¡¨ 13.1 åˆ—å‡ºäº† Spring æ‰€æä¾›çš„ç¼“å­˜æ³¨è§£ã€‚</p>
<p>è¡¨ 13.1 ä¸­çš„æ‰€æœ‰æ³¨è§£éƒ½èƒ½è¿ç”¨åœ¨æ–¹æ³•æˆ–ç±»ä¸Šã€‚å½“å°†å…¶æ”¾åœ¨å•ä¸ªæ–¹æ³•ä¸Šæ—¶ï¼Œæ³¨è§£æ‰€æè¿°çš„ç¼“å­˜è¡Œä¸ºåªä¼šè¿ç”¨åˆ°è¿™ä¸ªæ–¹æ³•ä¸Šã€‚å¦‚æœæ³¨è§£æ”¾åœ¨ç±»çº§åˆ«çš„è¯ï¼Œé‚£ä¹ˆç¼“å­˜è¡Œä¸ºå°±ä¼šåº”ç”¨åˆ°è¿™ä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•ä¸Šã€‚</p>
<center>è¡¨ 13.1ã€€Spring æä¾›äº†å››ä¸ªæ³¨è§£æ¥å£°æ˜ç¼“å­˜è§„åˆ™</center>

<table>
<thead>
<tr>
<th>æ³¨ã€€ã€€è§£</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>@Cacheable</td>
<td>è¡¨æ˜ Spring åœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰ï¼Œé¦–å…ˆåº”è¯¥åœ¨ç¼“å­˜ä¸­æŸ¥æ‰¾æ–¹æ³•çš„è¿”å›å€¼ã€‚å¦‚æœè¿™ä¸ªå€¼èƒ½å¤Ÿæ‰¾åˆ°ï¼Œå°±ä¼šè¿”å›ç¼“å­˜çš„å€¼ã€‚å¦åˆ™çš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼Œè¿”å›å€¼ä¼šæ”¾åˆ°ç¼“å­˜ä¹‹ä¸­</td>
</tr>
<tr>
<td>@CachePut</td>
<td>è¡¨æ˜ Spring åº”è¯¥å°†æ–¹æ³•çš„è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­ã€‚åœ¨æ–¹æ³•çš„è°ƒç”¨å‰å¹¶ä¸ä¼šæ£€æŸ¥ç¼“å­˜ï¼Œæ–¹æ³•å§‹ç»ˆéƒ½ä¼šè¢«è°ƒç”¨</td>
</tr>
<tr>
<td>@CacheEvict</td>
<td>@CacheEvict è¡¨æ˜ Spring åº”è¯¥åœ¨ç¼“å­˜ä¸­æ¸…é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ç›®</td>
</tr>
<tr>
<td>@Caching</td>
<td>è¿™æ˜¯ä¸€ä¸ªåˆ†ç»„çš„æ³¨è§£ï¼Œèƒ½å¤ŸåŒæ—¶åº”ç”¨å¤šä¸ªå…¶ä»–çš„ç¼“å­˜æ³¨è§£</td>
</tr>
</tbody></table>
<h4 id="å¡«å……ç¼“å­˜"><a href="#å¡«å……ç¼“å­˜" class="headerlink" title="å¡«å……ç¼“å­˜"></a>å¡«å……ç¼“å­˜</h4><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ@Cacheable å’Œ @CachePut æ³¨è§£éƒ½å¯ä»¥å¡«å……ç¼“å­˜ï¼Œä½†æ˜¯å®ƒä»¬çš„å·¥ä½œæ–¹å¼ç•¥æœ‰å·®å¼‚ã€‚</p>
<p>@Cacheable é¦–å…ˆåœ¨ç¼“å­˜ä¸­æŸ¥æ‰¾æ¡ç›®ï¼Œå¦‚æœæ‰¾åˆ°äº†åŒ¹é…çš„æ¡ç›®ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå¯¹æ–¹æ³•è¿›è¡Œè°ƒç”¨äº†ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ¡ç›®ï¼Œæ–¹æ³•ä¼šè¢«è°ƒç”¨å¹¶ä¸”è¿”å›å€¼è¦æ”¾åˆ°ç¼“å­˜ä¹‹ä¸­ã€‚è€Œ @CachePut å¹¶ä¸ä¼šåœ¨ç¼“å­˜ä¸­æ£€æŸ¥åŒ¹é…çš„å€¼ï¼Œç›®æ ‡æ–¹æ³•æ€»æ˜¯ä¼šè¢«è°ƒç”¨ï¼Œå¹¶å°†è¿”å›å€¼æ·»åŠ åˆ°ç¼“å­˜ä¹‹ä¸­ã€‚</p>
<p>@Cacheable å’Œ @CachePut æœ‰ä¸€äº›å±æ€§æ˜¯å…±æœ‰çš„ï¼Œå‚è§è¡¨ 13.2ã€‚</p>
<center>è¡¨ 13.2ã€€@Cacheable å’Œ @CachePut æœ‰ä¸€äº›å…±æœ‰çš„å±æ€§</center>

<table>
<thead>
<tr>
<th>å±ã€€ã€€æ€§</th>
<th>ç±»ã€€ã€€å‹</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>value</td>
<td>String[]</td>
<td>è¦ä½¿ç”¨çš„ç¼“å­˜åç§°</td>
</tr>
<tr>
<td>condition</td>
<td>String</td>
<td>SpEL è¡¨è¾¾å¼ï¼Œå¦‚æœå¾—åˆ°çš„å€¼æ˜¯ false çš„è¯ï¼Œä¸ä¼šå°†ç¼“å­˜åº”ç”¨åˆ°æ–¹æ³•è°ƒç”¨ä¸Š</td>
</tr>
<tr>
<td>key</td>
<td>String</td>
<td>SpEL è¡¨è¾¾å¼ï¼Œç”¨æ¥è®¡ç®—è‡ªå®šä¹‰çš„ç¼“å­˜ key</td>
</tr>
<tr>
<td>unless</td>
<td>String</td>
<td>SpEL è¡¨è¾¾å¼ï¼Œå¦‚æœå¾—åˆ°çš„å€¼æ˜¯ true çš„è¯ï¼Œè¿”å›å€¼ä¸ä¼šæ”¾åˆ°ç¼“å­˜ä¹‹ä¸­</td>
</tr>
</tbody></table>
<p>åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œåœ¨ @Cacheable å’Œ @CachePut çš„è¿™äº›å±æ€§ä¸­ï¼Œåªéœ€ä½¿ç”¨ value å±æ€§æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªç¼“å­˜å³å¯ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ SpittleRepository çš„ findOne() æ–¹æ³•ã€‚åœ¨åˆå§‹ä¿å­˜ä¹‹åï¼ŒSpittle å°±ä¸ä¼šå†å‘ç”Ÿå˜åŒ–äº†ã€‚å¦‚æœæœ‰çš„ Spittle æ¯”è¾ƒçƒ­é—¨å¹¶ä¸”ä¼šè¢«é¢‘ç¹è¯·æ±‚ï¼Œåå¤åœ°åœ¨æ•°æ®åº“ä¸­è¿›è¡Œè·å–æ˜¯å¯¹æ—¶é—´å’Œèµ„æºçš„æµªè´¹ã€‚é€šè¿‡åœ¨ findOne() æ–¹æ³•ä¸Šæ·»åŠ  @Cacheable æ³¨è§£ï¼Œå¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºï¼Œèƒ½å¤Ÿç¡®ä¿å°† Spittle ä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œä»è€Œé¿å…å¯¹æ•°æ®åº“çš„ä¸å¿…è¦è®¿é—®ã€‚</p>
<center>ç¨‹åºæ¸…å• 13.6ã€€é€šè¿‡ä½¿ç”¨ @Cacheableï¼Œåœ¨ç¼“å­˜ä¸­å­˜å‚¨å’Œè·å–å€¼</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(&quot;spittleCache&quot;)</span><span class="function"><span class="keyword">public</span> Spittle <span class="title">findOne</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;  <span class="keyword">try</span> &#123;    <span class="keyword">return</span> jdbcTemplate.queryForObject(      SELECT_SPITTLE_BY_ID,      <span class="keyword">new</span> SpittleRowMapper(),      id);  &#125; <span class="keyword">catch</span> (EmptyResultDataAccessException e) &#123;    <span class="keyword">return</span> <span class="keyword">null</span>;  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ findOne() è¢«è°ƒç”¨æ—¶ï¼Œç¼“å­˜åˆ‡é¢ä¼šæ‹¦æˆªè°ƒç”¨å¹¶åœ¨ç¼“å­˜ä¸­æŸ¥æ‰¾ä¹‹å‰ä»¥å spittleCache å­˜å‚¨çš„è¿”å›å€¼ã€‚ç¼“å­˜çš„ key æ˜¯ä¼ é€’åˆ° findOne() æ–¹æ³•ä¸­çš„ id å‚æ•°ã€‚å¦‚æœæŒ‰ç…§è¿™ä¸ª key èƒ½å¤Ÿæ‰¾åˆ°å€¼çš„è¯ï¼Œå°±ä¼šè¿”å›æ‰¾åˆ°çš„å€¼ï¼Œæ–¹æ³•ä¸ä¼šå†è¢«è°ƒç”¨ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°å€¼çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶å°†è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¹‹ä¸­ï¼Œä¸ºä¸‹ä¸€æ¬¡è°ƒç”¨ findOne() æ–¹æ³•åšå¥½å‡†å¤‡ã€‚</p>
<p>åœ¨ç¨‹åºæ¸…å• 13.6 ä¸­ï¼Œ@Cacheable æ³¨è§£è¢«æ”¾åˆ°äº† JdbcSpittleRepository çš„ findOne() æ–¹æ³•å®ç°ä¸Šã€‚è¿™æ ·èƒ½å¤Ÿèµ·ä½œç”¨ï¼Œä½†æ˜¯ç¼“å­˜çš„ä½œç”¨åªé™äº JdbcSpittleRepository è¿™ä¸ªå®ç°ç±»ä¸­ï¼ŒSpittleRepository çš„å…¶ä»–å®ç°å¹¶æ²¡æœ‰ç¼“å­˜åŠŸèƒ½ï¼Œé™¤éä¹Ÿä¸ºå…¶æ·»åŠ ä¸Š @Cacheable æ³¨è§£ã€‚å› æ­¤ï¼Œå¯ä»¥è€ƒè™‘å°†æ³¨è§£æ·»åŠ åˆ° SpittleRepository çš„æ–¹æ³•å£°æ˜ä¸Šï¼Œè€Œä¸æ˜¯æ”¾åœ¨å®ç°ç±»ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(&quot;spittleCache&quot;)</span><span class="function">Spittle <span class="title">findOne</span><span class="params">(<span class="keyword">long</span> id)</span></span>;</span><br></pre></td></tr></table></figure>

<p>å½“ä¸ºæ¥å£æ–¹æ³•æ·»åŠ æ³¨è§£åï¼Œ@Cacheable æ³¨è§£ä¼šè¢« SpittleRepository çš„æ‰€æœ‰å®ç°ç»§æ‰¿ï¼Œè¿™äº›å®ç°ç±»éƒ½ä¼šåº”ç”¨ç›¸åŒçš„ç¼“å­˜è§„åˆ™ã€‚</p>
<p>å°†å€¼æ”¾åˆ°ç¼“å­˜ä¹‹ä¸­</p>
<p>@Cacheable ä¼šæ¡ä»¶æ€§åœ°è§¦å‘å¯¹æ–¹æ³•çš„è°ƒç”¨ï¼Œè¿™å–å†³äºç¼“å­˜ä¸­æ˜¯ä¸æ˜¯å·²ç»æœ‰äº†æ‰€éœ€è¦çš„å€¼ï¼Œå¯¹äºæ‰€æ³¨è§£çš„æ–¹æ³•ï¼Œ@CachePut é‡‡ç”¨äº†ä¸€ç§æ›´ä¸ºç›´æ¥çš„æµç¨‹ã€‚å¸¦æœ‰ @CachePut æ³¨è§£çš„æ–¹æ³•å§‹ç»ˆéƒ½ä¼šè¢«è°ƒç”¨ï¼Œè€Œä¸”å®ƒçš„è¿”å›å€¼ä¹Ÿä¼šæ”¾åˆ°ç¼“å­˜ä¸­ã€‚è¿™æä¾›ä¸€ç§å¾ˆä¾¿åˆ©çš„æœºåˆ¶ï¼Œèƒ½å¤Ÿè®©æˆ‘ä»¬åœ¨è¯·æ±‚ä¹‹å‰é¢„å…ˆåŠ è½½ç¼“å­˜ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªå…¨æ–°çš„ Spittle é€šè¿‡ SpittleRepository çš„ save() æ–¹æ³•ä¿å­˜ä¹‹åï¼Œå¾ˆå¯èƒ½é©¬ä¸Šå°±ä¼šè¯·æ±‚è¿™æ¡è®°å½•ã€‚æ‰€ä»¥ï¼Œå½“ save() æ–¹æ³•è°ƒç”¨åï¼Œç«‹å³å°† Spittle å¡åˆ°ç¼“å­˜ä¹‹ä¸­æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ï¼Œè¿™æ ·å½“å…¶ä»–äººé€šè¿‡ findOne() å¯¹å…¶è¿›è¡ŒæŸ¥æ‰¾æ—¶ï¼Œå®ƒå°±å·²ç»å‡†å¤‡å°±ç»ªäº†ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œå¯ä»¥åœ¨ save() æ–¹æ³•ä¸Šæ·»åŠ  @CachePut æ³¨è§£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CachePut(&quot;spittleCache&quot;)</span>;<span class="function">Spittle <span class="title">save</span><span class="params">(Spittle spittle)</span></span>;</span><br></pre></td></tr></table></figure>

<p>å½“ save() æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå®ƒé¦–å…ˆä¼šåšæ‰€æœ‰å¿…è¦çš„äº‹æƒ…æ¥ä¿å­˜ Spittleï¼Œç„¶åè¿”å›çš„ Spittle ä¼šè¢«æ”¾åˆ° spittleCache ç¼“å­˜ä¸­ã€‚</p>
<p>åœ¨è¿™é‡Œåªæœ‰ä¸€ä¸ªé—®é¢˜ï¼šç¼“å­˜çš„ keyã€‚å¦‚å‰æ–‡æ‰€è¿°ï¼Œé»˜è®¤çš„ç¼“å­˜ key è¦åŸºäºæ–¹æ³•çš„å‚æ•°æ¥ç¡®å®šã€‚å› ä¸º save() æ–¹æ³•çš„å”¯ä¸€å‚æ•°å°±æ˜¯ Spittleï¼Œæ‰€ä»¥å®ƒä¼šç”¨ä½œç¼“å­˜çš„ keyã€‚å°† Spittle æ”¾åœ¨ç¼“å­˜ä¸­ï¼Œè€Œå®ƒçš„ç¼“å­˜ key æ°å¥½æ˜¯åŒä¸€ä¸ª Spittleï¼Œè¿™æ˜¯ä¸æ˜¯æœ‰ä¸€ç‚¹è¯¡å¼‚å‘¢ï¼Ÿ</p>
<p>æ˜¾ç„¶ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œé»˜è®¤çš„ç¼“å­˜ key å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚æˆ‘ä»¬éœ€è¦çš„ç¼“å­˜ key æ˜¯æ–°ä¿å­˜ Spittle çš„ IDï¼Œè€Œä¸æ˜¯ Spittle æœ¬èº«ã€‚æ‰€ä»¥ï¼Œåœ¨è¿™é‡Œéœ€è¦æŒ‡å®šä¸€ä¸ª key è€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„ keyã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ€æ ·è‡ªå®šä¹‰ç¼“å­˜ keyã€‚</p>
<p>è‡ªå®šä¹‰ç¼“å­˜ key</p>
<p>@Cacheable å’Œ @CachePut éƒ½æœ‰ä¸€ä¸ªåä¸º key å±æ€§ï¼Œè¿™ä¸ªå±æ€§èƒ½å¤Ÿæ›¿æ¢é»˜è®¤çš„ keyï¼Œå®ƒæ˜¯é€šè¿‡ä¸€ä¸ª SpEL è¡¨è¾¾å¼è®¡ç®—å¾—åˆ°çš„ã€‚ä»»æ„çš„ SpEL è¡¨è¾¾å¼éƒ½æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯æ›´å¸¸è§çš„åœºæ™¯æ˜¯æ‰€å®šä¹‰çš„è¡¨è¾¾å¼ä¸å­˜å‚¨åœ¨ç¼“å­˜ä¸­çš„å€¼æœ‰å…³ï¼Œæ®æ­¤è®¡ç®—å¾—åˆ° keyã€‚</p>
<p>å…·ä½“åˆ°æˆ‘ä»¬è¿™ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦å°† key è®¾ç½®ä¸ºæ‰€ä¿å­˜ Spittle çš„ IDã€‚ä»¥å‚æ•°å½¢å¼ä¼ é€’ç»™ save() çš„ Spittle è¿˜æ²¡æœ‰ä¿å­˜ï¼Œå› æ­¤å¹¶æ²¡æœ‰ IDã€‚æˆ‘ä»¬åªèƒ½é€šè¿‡ save() è¿”å›çš„ Spittle å¾—åˆ° id å±æ€§ã€‚</p>
<p>å¹¸å¥½ï¼Œåœ¨ä¸ºç¼“å­˜ç¼–å†™ SpEL è¡¨è¾¾å¼çš„æ—¶å€™ï¼ŒSpring æš´éœ²äº†ä¸€äº›å¾ˆæœ‰ç”¨çš„å…ƒæ•°æ®ã€‚è¡¨ 13.3 åˆ—å‡ºäº† SpEL ä¸­å¯ç”¨çš„ç¼“å­˜å…ƒæ•°æ®ã€‚</p>
<center>è¡¨ 13.3ã€€Spring æä¾›äº†å¤šä¸ªç”¨æ¥å®šä¹‰ç¼“å­˜è§„åˆ™çš„ SpEL æ‰©å±•</center>

<table>
<thead>
<tr>
<th>è¡¨ã€€è¾¾ã€€å¼</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>#root.args</td>
<td>ä¼ é€’ç»™ç¼“å­˜æ–¹æ³•çš„å‚æ•°ï¼Œå½¢å¼ä¸ºæ•°ç»„</td>
</tr>
<tr>
<td>#root.caches</td>
<td>è¯¥æ–¹æ³•æ‰§è¡Œæ—¶æ‰€å¯¹åº”çš„ç¼“å­˜ï¼Œå½¢å¼ä¸ºæ•°ç»„</td>
</tr>
<tr>
<td>#root.target</td>
<td>ç›®æ ‡å¯¹è±¡</td>
</tr>
<tr>
<td>#root.targetClass</td>
<td>ç›®æ ‡å¯¹è±¡çš„ç±»ï¼Œæ˜¯ #root.target.class çš„ç®€å†™å½¢å¼</td>
</tr>
<tr>
<td>#root.method</td>
<td>ç¼“å­˜æ–¹æ³•</td>
</tr>
<tr>
<td>#root.methodName</td>
<td>ç¼“å­˜æ–¹æ³•çš„åå­—ï¼Œæ˜¯ #root.method.name çš„ç®€å†™å½¢å¼</td>
</tr>
<tr>
<td>#result</td>
<td>æ–¹æ³•è°ƒç”¨çš„è¿”å›å€¼ï¼ˆä¸èƒ½ç”¨åœ¨ @Cacheable æ³¨è§£ä¸Šï¼‰</td>
</tr>
<tr>
<td>#Argument</td>
<td>ä»»æ„çš„æ–¹æ³•å‚æ•°åï¼ˆå¦‚ #argNameï¼‰æˆ–å‚æ•°ç´¢å¼•ï¼ˆå¦‚ #a0 æˆ– #p0ï¼‰</td>
</tr>
</tbody></table>
<p> å¯¹äº save() æ–¹æ³•æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦çš„é”®æ˜¯æ‰€è¿”å› Spittle å¯¹è±¡çš„ id å±æ€§ã€‚è¡¨è¾¾å¼ #result èƒ½å¤Ÿå¾—åˆ°è¿”å›çš„ Spittleã€‚å€ŸåŠ©è¿™ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°† key å±æ€§è®¾ç½®ä¸º #result.id æ¥å¼•ç”¨ id å±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CachePut(value=&quot;spittleCache&quot;, key=&quot;#result.id&quot;)</span><span class="function">Spittle <span class="title">save</span><span class="params">(Spittle spittle)</span></span></span><br></pre></td></tr></table></figure>

<p>æŒ‰ç…§è¿™ç§æ–¹å¼é…ç½® @CachePutï¼Œç¼“å­˜ä¸ä¼šå»å¹²æ¶‰ save() æ–¹æ³•çš„æ‰§è¡Œï¼Œä½†æ˜¯è¿”å›çš„ Spittle å°†ä¼šä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œå¹¶ä¸”ç¼“å­˜çš„ key ä¸ Spittle çš„ id å±æ€§ç›¸åŒã€‚</p>
<p>æ¡ä»¶åŒ–ç¼“å­˜</p>
<p>é€šè¿‡ä¸ºæ–¹æ³•æ·»åŠ  Spring çš„ç¼“å­˜æ³¨è§£ï¼ŒSpring å°±ä¼šå›´ç»•ç€è¿™ä¸ªæ–¹æ³•åˆ›å»ºä¸€ä¸ªç¼“å­˜åˆ‡é¢ã€‚ä½†æ˜¯ï¼Œåœ¨æœ‰äº›åœºæ™¯ä¸‹æˆ‘ä»¬å¯èƒ½å¸Œæœ›å°†ç¼“å­˜åŠŸèƒ½å…³é—­ã€‚</p>
<p>@Cacheable å’Œ @CachePut æä¾›äº†ä¸¤ä¸ªå±æ€§ç”¨ä»¥å®ç°æ¡ä»¶åŒ–ç¼“å­˜ï¼šunless å’Œ conditionï¼Œè¿™ä¸¤ä¸ªå±æ€§éƒ½æ¥å—ä¸€ä¸ª SpEL è¡¨è¾¾å¼ã€‚å¦‚æœ unless å±æ€§çš„ SpEL è¡¨è¾¾å¼è®¡ç®—ç»“æœä¸º trueï¼Œé‚£ä¹ˆç¼“å­˜æ–¹æ³•è¿”å›çš„æ•°æ®å°±ä¸ä¼šæ”¾åˆ°ç¼“å­˜ä¸­ã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œå¦‚æœ condition å±æ€§çš„ SpEL è¡¨è¾¾å¼è®¡ç®—ç»“æœä¸º falseï¼Œé‚£ä¹ˆå¯¹äºè¿™ä¸ªæ–¹æ³•ç¼“å­˜å°±ä¼šè¢«ç¦ç”¨æ‰ã€‚</p>
<p>è¡¨é¢ä¸Šæ¥çœ‹ï¼Œunless å’Œ condition å±æ€§åšçš„æ˜¯ç›¸åŒçš„äº‹æƒ…ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œæœ‰ä¸€ç‚¹ç»†å¾®çš„å·®åˆ«ã€‚unless å±æ€§åªèƒ½é˜»æ­¢å°†å¯¹è±¡æ”¾è¿›ç¼“å­˜ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªæ–¹æ³•è°ƒç”¨çš„æ—¶å€™ï¼Œä¾ç„¶ä¼šå»ç¼“å­˜ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°äº†åŒ¹é…çš„å€¼ï¼Œå°±ä¼šè¿”å›æ‰¾åˆ°çš„å€¼ã€‚ä¸ä¹‹ä¸åŒï¼Œå¦‚æœ condition çš„è¡¨è¾¾å¼è®¡ç®—ç»“æœä¸º falseï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªæ–¹æ³•è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼Œç¼“å­˜æ˜¯è¢«ç¦ç”¨çš„ã€‚å°±æ˜¯è¯´ï¼Œä¸ä¼šå»ç¼“å­˜è¿›è¡ŒæŸ¥æ‰¾ï¼ŒåŒæ—¶è¿”å›å€¼ä¹Ÿä¸ä¼šæ”¾è¿›ç¼“å­˜ä¸­ã€‚</p>
<p>ä½œä¸ºæ ·ä¾‹ï¼ˆå°½ç®¡æœ‰äº›ç‰µå¼ºï¼‰ï¼Œå‡è®¾å¯¹äº message å±æ€§åŒ…å« â€œNoCacheâ€ çš„ Spittle å¯¹è±¡ï¼Œæˆ‘ä»¬ä¸æƒ³å¯¹å…¶è¿›è¡Œç¼“å­˜ã€‚ä¸ºäº†é˜»æ­¢è¿™æ ·çš„ Spittle å¯¹è±¡è¢«ç¼“å­˜èµ·æ¥ï¼Œå¯ä»¥è¿™æ ·è®¾ç½® unless å±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(value=&quot;spittleCache&quot;,  unless=&quot;#result.message.contain(&#x27;NoCache&#x27;)&quot;)</span><span class="function">Spittle <span class="title">findOne</span><span class="params">(<span class="keyword">long</span> id)</span></span>;</span><br></pre></td></tr></table></figure>

<p>ä¸º unless è®¾ç½®çš„ SpEL è¡¨è¾¾å¼ä¼šæ£€æŸ¥è¿”å›çš„ Spittle å¯¹è±¡ï¼ˆåœ¨è¡¨è¾¾å¼ä¸­é€šè¿‡ #result æ¥è¯†åˆ«ï¼‰çš„ message å±æ€§ã€‚å¦‚æœå®ƒåŒ…å« â€œNoCacheâ€ æ–‡æœ¬å†…å®¹ï¼Œé‚£ä¹ˆè¿™ä¸ªè¡¨è¾¾å¼çš„è®¡ç®—å€¼ä¸º trueï¼Œè¿™ä¸ª Spittle å¯¹è±¡ä¸ä¼šæ”¾è¿›ç¼“å­˜ä¸­ã€‚å¦åˆ™çš„è¯ï¼Œè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœä¸º falseï¼Œæ— æ³•æ»¡è¶³ unless çš„æ¡ä»¶ï¼Œè¿™ä¸ª Spittle å¯¹è±¡ä¼šè¢«ç¼“å­˜ã€‚</p>
<p>å±æ€§ unless èƒ½å¤Ÿé˜»æ­¢å°†å€¼å†™å…¥åˆ°ç¼“å­˜ä¸­ï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›å°†ç¼“å­˜å…¨éƒ¨ç¦ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€å®šçš„æ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬æ—¢ä¸å¸Œæœ›å°†å€¼æ·»åŠ åˆ°ç¼“å­˜ä¸­ï¼Œä¹Ÿä¸å¸Œæœ›ä»ç¼“å­˜ä¸­è·å–æ•°æ®ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯¹äº ID å€¼å°äº 10 çš„ Spittle å¯¹è±¡ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å¯¹å…¶ä½¿ç”¨ç¼“å­˜ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œè¿™äº› Spittle æ˜¯ç”¨æ¥è¿›è¡Œè°ƒè¯•çš„æµ‹è¯•æ¡ç›®ï¼Œå¯¹å…¶è¿›è¡Œç¼“å­˜å¹¶æ²¡æœ‰å®é™…çš„ä»·å€¼ã€‚ä¸ºäº†è¦å¯¹ ID å°äº 10 çš„ Spittle å…³é—­ç¼“å­˜ï¼Œå¯ä»¥åœ¨ @Cacheable ä¸Šä½¿ç”¨ condition å±æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(value=&quot;spittleCache&quot;,  unless=&quot;#result.message.contain(&#x27;NoCache&#x27;)&quot;,  condition=&quot;#id &gt;= 10&quot;)</span><span class="function">Spittle <span class="title">findOne</span><span class="params">(<span class="keyword">long</span> id)</span></span>;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ findOne() è°ƒç”¨æ—¶ï¼Œå‚æ•°å€¼å°äº 10ï¼Œé‚£ä¹ˆå°†ä¸ä¼šåœ¨ç¼“å­˜ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œè¿”å›çš„ Spittle ä¹Ÿä¸ä¼šæ”¾è¿›ç¼“å­˜ä¸­ï¼Œå°±åƒè¿™ä¸ªæ–¹æ³•æ²¡æœ‰æ·»åŠ  @Cacheable æ³¨è§£ä¸€æ ·ã€‚</p>
<p>å¦‚æ ·ä¾‹æ‰€ç¤ºï¼Œunless å±æ€§çš„è¡¨è¾¾å¼èƒ½å¤Ÿé€šè¿‡ #result å¼•ç”¨è¿”å›å€¼ã€‚è¿™æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œè¿™ä¹ˆåšä¹‹æ‰€ä»¥å¯è¡Œæ˜¯å› ä¸º unless å±æ€§åªæœ‰åœ¨ç¼“å­˜æ–¹æ³•æœ‰è¿”å›å€¼æ—¶æ‰å¼€å§‹å‘æŒ¥ä½œç”¨ã€‚è€Œ condition è‚©è´Ÿç€åœ¨æ–¹æ³•ä¸Šç¦ç”¨ç¼“å­˜çš„ä»»åŠ¡ï¼Œå› æ­¤å®ƒä¸èƒ½ç­‰åˆ°æ–¹æ³•è¿”å›æ—¶å†ç¡®å®šæ˜¯å¦è¯¥å…³é—­ç¼“å­˜ã€‚è¿™æ„å‘³ç€å®ƒçš„è¡¨è¾¾å¼å¿…é¡»è¦åœ¨è¿›å…¥æ–¹æ³•æ—¶è¿›è¡Œè®¡ç®—ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½é€šè¿‡ #result å¼•ç”¨è¿”å›å€¼ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨å·²ç»åœ¨ç¼“å­˜ä¸­æ·»åŠ äº†å†…å®¹ï¼Œä½†æ˜¯è¿™äº›å†…å®¹èƒ½è¢«ç§»é™¤æ‰å—ï¼Ÿæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å¦‚ä½•å€ŸåŠ© @CacheEvict å°†ç¼“å­˜æ•°æ®ç§»é™¤æ‰ã€‚</p>
<h4 id="ç§»é™¤ç¼“å­˜æ¡ç›®"><a href="#ç§»é™¤ç¼“å­˜æ¡ç›®" class="headerlink" title="ç§»é™¤ç¼“å­˜æ¡ç›®"></a>ç§»é™¤ç¼“å­˜æ¡ç›®</h4><p>@CacheEvict å¹¶ä¸ä¼šå¾€ç¼“å­˜ä¸­æ·»åŠ ä»»ä½•ä¸œè¥¿ã€‚ç›¸åï¼Œå¦‚æœå¸¦æœ‰ @CacheEvict æ³¨è§£çš„æ–¹æ³•è¢«è°ƒç”¨çš„è¯ï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªæˆ–æ›´å¤šçš„æ¡ç›®ä¼šåœ¨ç¼“å­˜ä¸­ç§»é™¤ã€‚</p>
<p>é‚£ä¹ˆåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦ä»ç¼“å­˜ä¸­ç§»é™¤å†…å®¹å‘¢ï¼Ÿå½“ç¼“å­˜å€¼ä¸å†åˆæ³•æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ç¡®ä¿å°†å…¶ä»ç¼“å­˜ä¸­ç§»é™¤ï¼Œè¿™æ ·çš„è¯ï¼Œåç»­çš„ç¼“å­˜å‘½ä¸­å°±ä¸ä¼šè¿”å›æ—§çš„æˆ–è€…å·²ç»ä¸å­˜åœ¨çš„å€¼ï¼Œå…¶ä¸­ä¸€ä¸ªè¿™æ ·çš„åœºæ™¯å°±æ˜¯æ•°æ®è¢«åˆ é™¤æ‰äº†ã€‚è¿™æ ·çš„è¯ï¼ŒSpittleRepository çš„ remove() æ–¹æ³•å°±æ˜¯ä½¿ç”¨ @CacheEvict çš„ç»ä½³é€‰æ‹©ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CacheEvict(&quot;spittleCache&quot;)</span><span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">long</span> spittlId)</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼šä¸ @Cacheable å’Œ @CachePut ä¸åŒï¼Œ@CacheEvict èƒ½å¤Ÿåº”ç”¨åœ¨è¿”å›å€¼ä¸º void çš„æ–¹æ³•ä¸Šï¼Œè€Œ @Cacheable å’Œ @CachePut éœ€è¦é void çš„è¿”å›å€¼ï¼Œå®ƒå°†ä¼šä½œä¸ºæ”¾åœ¨ç¼“å­˜ä¸­çš„æ¡ç›®ã€‚å› ä¸º @CacheEvict åªæ˜¯å°†æ¡ç›®ä»ç¼“å­˜ä¸­ç§»é™¤ï¼Œå› æ­¤å®ƒå¯ä»¥æ”¾åœ¨ä»»æ„çš„æ–¹æ³•ä¸Šï¼Œç”šè‡³ void æ–¹æ³•ã€‚</p>
</blockquote>
<p>ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå½“ remove() è°ƒç”¨æ—¶ï¼Œä¼šä»ç¼“å­˜ä¸­åˆ é™¤ä¸€ä¸ªæ¡ç›®ã€‚è¢«åˆ é™¤æ¡ç›®çš„ key ä¸ä¼ é€’è¿›æ¥çš„ spittleId å‚æ•°çš„å€¼ç›¸ç­‰ã€‚</p>
<p>@CacheEvict æœ‰å¤šä¸ªå±æ€§ï¼Œå¦‚è¡¨ 13.4 æ‰€ç¤ºï¼Œè¿™äº›å±æ€§ä¼šå½±å“åˆ°è¯¥æ³¨è§£çš„è¡Œä¸ºï¼Œä½¿å…¶ä¸åŒäºé»˜è®¤çš„åšæ³•ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ@CacheEvict çš„ä¸€äº›å±æ€§ä¸ @Cacheable å’Œ @CachePut æ˜¯ç›¸åŒçš„ï¼Œå¦å¤–è¿˜æœ‰å‡ ä¸ªæ–°çš„å±æ€§ã€‚ä¸ @Cacheable å’Œ @CachePut ä¸åŒï¼Œ@CacheEvict å¹¶æ²¡æœ‰æä¾› unless å±æ€§ã€‚</p>
<p>Spring çš„ç¼“å­˜æ³¨è§£æä¾›äº†ä¸€ç§ä¼˜é›…çš„æ–¹å¼åœ¨åº”ç”¨ç¨‹åºçš„ä»£ç ä¸­å£°æ˜ç¼“å­˜è§„åˆ™ã€‚ä½†æ˜¯ï¼ŒSpring è¿˜ä¸ºç¼“å­˜æä¾›äº† XML å‘½åç©ºé—´ã€‚åœ¨ç»“æŸå¯¹ç¼“å­˜çš„è®¨è®ºä¹‹å‰ï¼Œæˆ‘ä»¬å¿«é€Ÿåœ°çœ‹ä¸€ä¸‹å¦‚ä½•ä»¥ XML çš„å½¢å¼é…ç½®ç¼“å­˜è§„åˆ™ã€‚</p>
<center>è¡¨ 13.4ã€€@CacheEvict æ³¨è§£çš„å±æ€§ï¼ŒæŒ‡å®šäº†å“ªäº›ç¼“å­˜æ¡ç›®åº”è¯¥è¢«ç§»é™¤æ‰</center>

<table>
<thead>
<tr>
<th>å±ã€€ã€€æ€§</th>
<th>ç±»ã€€ã€€å‹</th>
<th>æ        è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>value</td>
<td>String[]</td>
<td>è¦ä½¿ç”¨çš„ç¼“å­˜åç§°</td>
</tr>
<tr>
<td>key</td>
<td>String</td>
<td>SpEL è¡¨è¾¾å¼ï¼Œç”¨æ¥è®¡ç®—è‡ªå®šä¹‰çš„ç¼“å­˜ key</td>
</tr>
<tr>
<td>condition</td>
<td>String</td>
<td>SpEL è¡¨è¾¾å¼ï¼Œå¦‚æœå¾—åˆ°çš„å€¼æ˜¯ false çš„è¯ï¼Œç¼“å­˜ä¸ä¼šåº”ç”¨åˆ°æ–¹æ³•è°ƒç”¨ä¸Š</td>
</tr>
<tr>
<td>allEntries</td>
<td>boolean</td>
<td>å¦‚æœä¸º true çš„è¯ï¼Œç‰¹å®šç¼“å­˜çš„æ‰€æœ‰æ¡ç›®éƒ½ä¼šè¢«ç§»é™¤æ‰</td>
</tr>
<tr>
<td>beforeInvocation</td>
<td>boolean</td>
<td>å¦‚æœä¸º true çš„è¯ï¼Œåœ¨æ–¹æ³•è°ƒç”¨ä¹‹å‰ç§»é™¤æ¡ç›®ã€‚å¦‚æœä¸º falseï¼ˆé»˜è®¤å€¼ï¼‰çš„è¯ï¼Œåœ¨æ–¹æ³•æˆåŠŸè°ƒç”¨ä¹‹åå†ç§»é™¤æ¡ç›®</td>
</tr>
</tbody></table>
<h3 id="ä½¿ç”¨-XML-å£°æ˜ç¼“å­˜"><a href="#ä½¿ç”¨-XML-å£°æ˜ç¼“å­˜" class="headerlink" title="ä½¿ç”¨ XML å£°æ˜ç¼“å­˜"></a>ä½¿ç”¨ XML å£°æ˜ç¼“å­˜</h3><p>ä½ å¯èƒ½æƒ³è¦çŸ¥é“ä¸ºä»€ä¹ˆæƒ³è¦ä»¥ XML çš„æ–¹å¼å£°æ˜ç¼“å­˜ã€‚æ¯•ç«Ÿï¼Œæœ¬ç« ä¸­æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ç¼“å­˜æ³¨è§£è¦ä¼˜é›…å¾—å¤šã€‚</p>
<p>æˆ‘è®¤ä¸ºæœ‰ä¸¤ä¸ªåŸå› ï¼š</p>
<ul>
<li>ä½ å¯èƒ½ä¼šè§‰å¾—åœ¨è‡ªå·±çš„æºç ä¸­æ·»åŠ  Spring çš„æ³¨è§£æœ‰ç‚¹ä¸å¤ªèˆ’æœï¼›</li>
<li>ä½ éœ€è¦åœ¨æ²¡æœ‰æºç çš„ bean ä¸Šåº”ç”¨ç¼“å­˜åŠŸèƒ½ã€‚</li>
</ul>
<p>åœ¨ä¸Šé¢çš„ä»»æ„ä¸€ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½ï¼ˆæˆ–è€…è¯´éœ€è¦ï¼‰å°†ç¼“å­˜é…ç½®ä¸ç¼“å­˜æ•°æ®çš„ä»£ç åˆ†éš”å¼€æ¥ã€‚Spring çš„ cache å‘½åç©ºé—´æä¾›äº†ä½¿ç”¨ XML å£°æ˜ç¼“å­˜è§„åˆ™çš„æ–¹æ³•ï¼Œå¯ä»¥ä½œä¸ºé¢å‘æ³¨è§£ç¼“å­˜çš„æ›¿ä»£æ–¹æ¡ˆã€‚å› ä¸ºç¼“å­˜æ˜¯ä¸€ç§é¢å‘åˆ‡é¢çš„è¡Œä¸ºï¼Œæ‰€ä»¥ cache å‘½åç©ºé—´ä¼šä¸ Spring çš„ aop å‘½åç©ºé—´ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œç”¨æ¥å£°æ˜ç¼“å­˜æ‰€åº”ç”¨çš„åˆ‡ç‚¹åœ¨å“ªé‡Œã€‚</p>
<p>è¦å¼€å§‹é…ç½® XML å£°æ˜çš„ç¼“å­˜ï¼Œé¦–å…ˆéœ€è¦åˆ›å»º Spring é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­è¦åŒ…å« cache å’Œ aop å‘½åç©ºé—´ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xmlns:cache</span>=<span class="string">&quot;http://www.springframework.org/schema/cache&quot;</span>  <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;    http://www.springframework.org/schema/aop    http://www.springframework.org/schema/aop/spring-aop.xsd    http://www.springframework.org/schema/beans    http://www.springframework.org/schema/beans/spring-beans.xsd    http://www.springframework.org/schema/cache    http://www.springframework.org/schema/cache/spring-cache.xsd&quot;</span> &gt;</span>    <span class="comment">&lt;!-- Caching configuration go here /&gt;&lt;/beans&gt;</span></span><br></pre></td></tr></table></figure>

<p>cache å‘½åç©ºé—´å®šä¹‰äº†åœ¨ Spring XML é…ç½®æ–‡ä»¶ä¸­å£°æ˜ç¼“å­˜çš„é…ç½®å…ƒç´ ã€‚è¡¨ 13.5 åˆ—å‡ºäº† cache å‘½åç©ºé—´æ‰€æä¾›çš„æ‰€æœ‰å…ƒç´ ã€‚</p>
<center>è¡¨ 13.5ã€€Spring çš„ cache å‘½åç©ºé—´æä¾›äº†ä»¥ XML æ–¹å¼é…ç½®ç¼“å­˜è§„åˆ™çš„å…ƒç´ </center>

<table>
<thead>
<tr>
<th>å…ƒç´ </th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;cache:annotationdriven&gt;</code></td>
<td>å¯ç”¨æ³¨è§£é©±åŠ¨çš„ç¼“å­˜ã€‚ç­‰åŒäº Java é…ç½®ä¸­çš„ @EnableCaching</td>
</tr>
<tr>
<td><code>&lt;cache:advice&gt;</code></td>
<td>å®šä¹‰ç¼“å­˜é€šçŸ¥ï¼ˆadviceï¼‰ã€‚ç»“åˆ <code>&lt;aop:advisor&gt;</code>ï¼Œå°†é€šçŸ¥åº”ç”¨åˆ°åˆ‡ç‚¹ä¸Š</td>
</tr>
<tr>
<td><code>&lt;cache:caching&gt; </code></td>
<td>åœ¨ç¼“å­˜é€šçŸ¥ä¸­ï¼Œå®šä¹‰ä¸€ç»„ç‰¹å®šçš„ç¼“å­˜è§„åˆ™</td>
</tr>
<tr>
<td><code>&lt;cache:cacheable&gt;</code></td>
<td>æŒ‡æ˜æŸä¸ªæ–¹æ³•è¦è¿›è¡Œç¼“å­˜ã€‚ç­‰åŒäº @Cacheable æ³¨è§£</td>
</tr>
<tr>
<td><code>&lt;cache:cache-put&gt;</code></td>
<td>æŒ‡æ˜æŸä¸ªæ–¹æ³•è¦å¡«å……ç¼“å­˜ï¼Œä½†ä¸ä¼šè€ƒè™‘ç¼“å­˜ä¸­æ˜¯å¦å·²æœ‰åŒ¹é…çš„å€¼ã€‚ç­‰åŒäº @CachePut æ³¨è§£</td>
</tr>
<tr>
<td><code>&lt;cache:cacheevict&gt;</code></td>
<td>æŒ‡æ˜æŸä¸ªæ–¹æ³•è¦ä»ç¼“å­˜ä¸­ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ç›®ï¼Œç­‰åŒäº @CacheEvict æ³¨è§£</td>
</tr>
</tbody></table>
<p><code>&lt;cache:annotation-driven&gt;</code> å…ƒç´ ä¸ Java é…ç½®ä¸­æ‰€å¯¹åº”çš„ @EnableCaching éå¸¸ç±»ä¼¼ï¼Œä¼šå¯ç”¨æ³¨è§£é©±åŠ¨çš„ç¼“å­˜ã€‚æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡è¿™ç§é£æ ¼çš„ç¼“å­˜ï¼Œå› æ­¤æ²¡æœ‰å¿…è¦å†å¯¹å…¶è¿›è¡Œä»‹ç»ã€‚</p>
<p>è¡¨ 13.5 ä¸­å…¶ä»–çš„å…ƒç´ éƒ½ç”¨äºåŸºäº XML çš„ç¼“å­˜é…ç½®ã€‚æ¥ä¸‹æ¥çš„ä»£ç æ¸…å•å±•ç°äº†å¦‚ä½•ä½¿ç”¨è¿™äº›å…ƒç´ ä¸º SpittleRepositorybean é…ç½®ç¼“å­˜ï¼Œå…¶ä½œç”¨ç­‰åŒäºæœ¬ç« å‰é¢ç« ä½¿ç”¨ç¼“å­˜æ³¨è§£çš„æ–¹å¼ã€‚</p>
<center>ç¨‹åºæ¸…å• 13.7ã€€ä½¿ç”¨ XML å…ƒç´ ä¸º SpittleRepository å£°æ˜ç¼“å­˜è§„åˆ™</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xmlns:cache</span>=<span class="string">&quot;http://www.springframework.org/schema/cache&quot;</span>  <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;    http://www.springframework.org/schema/aop    http://www.springframework.org/schema/aop/spring-aop.xsd    http://www.springframework.org/schema/beans    http://www.springframework.org/schema/beans/spring-beans.xsd    http://www.springframework.org/schema/cache    http://www.springframework.org/schema/cache/spring-cache.xsd&quot;</span> &gt;</span>    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span>    <span class="tag">&lt;<span class="name">aop:advice</span> <span class="attr">advice-ref</span>=<span class="string">&quot;cacheAdvice&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(* com.habuma.spittr.db.SpittleRepository.*(..))&quot;</span> /&gt;</span>  <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span>    <span class="tag">&lt;<span class="name">cache:advice</span> <span class="attr">id</span>=<span class="string">&quot;cacheAdvice&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">cache:caching</span>&gt;</span>      <span class="tag">&lt;<span class="name">cache:cacheable</span> <span class="attr">cache</span>=<span class="string">&quot;spittleCache&quot;</span> <span class="attr">method</span>=<span class="string">&quot;findRecent&quot;</span> /&gt;</span>            <span class="tag">&lt;<span class="name">cache:cacheable</span> <span class="attr">cache</span>=<span class="string">&quot;spittleCache&quot;</span> <span class="attr">method</span>=<span class="string">&quot;findBySpitterId&quot;</span> /&gt;</span>            <span class="tag">&lt;<span class="name">cache:cacheable</span> <span class="attr">cache</span>=<span class="string">&quot;spittleCache&quot;</span> <span class="attr">method</span>=<span class="string">&quot;findOne&quot;</span> /&gt;</span>            <span class="tag">&lt;<span class="name">cache:cache-put</span> <span class="attr">cache</span>=<span class="string">&quot;spittleCache&quot;</span> <span class="attr">method</span>=<span class="string">&quot;save&quot;</span> <span class="attr">key</span>=<span class="string">&quot;#result.id&quot;</span> /&gt;</span>            <span class="tag">&lt;<span class="name">cache:cache-evict</span> <span class="attr">cache</span>=<span class="string">&quot;spittleCache&quot;</span> <span class="attr">method</span>=<span class="string">&quot;remove&quot;</span> /&gt;</span>    <span class="tag">&lt;/<span class="name">cache:caching</span>&gt;</span>  <span class="tag">&lt;/<span class="name">cache:advice</span>&gt;</span>    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cacheManage&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.cache.concurrent.ConcurrentMapCacheManager&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ç¨‹åºæ¸…å• 13.7 ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆçœ‹åˆ°çš„æ˜¯ <code>&lt;aop:advisor&gt;</code>ï¼Œå®ƒå¼•ç”¨ ID ä¸º cacheAdvice çš„é€šçŸ¥ï¼Œè¯¥å…ƒç´ å°†è¿™ä¸ªé€šçŸ¥ä¸ä¸€ä¸ªåˆ‡ç‚¹è¿›è¡ŒåŒ¹é…ï¼Œå› æ­¤å»ºç«‹äº†ä¸€ä¸ªå®Œæ•´çš„åˆ‡é¢ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¿™ä¸ªåˆ‡é¢çš„åˆ‡ç‚¹ä¼šåœ¨æ‰§è¡Œ SpittleRepository çš„ä»»æ„æ–¹æ³•æ—¶è§¦å‘ã€‚å¦‚æœè¿™æ ·çš„æ–¹æ³•è¢« Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ä»»æ„æŸä¸ª bean æ‰€è°ƒç”¨ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨åˆ‡é¢çš„é€šçŸ¥ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œé€šçŸ¥åˆ©ç”¨ <code>&lt;cache:advice&gt;</code> å…ƒç´ è¿›è¡Œäº†å£°æ˜ã€‚åœ¨ <code>&lt;cache:advice&gt;</code> å…ƒç´ ä¸­ï¼Œå¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„ <code>&lt;cache:caching&gt;</code> å…ƒç´ ï¼Œè¿™äº›å…ƒç´ ç”¨æ¥å®Œæ•´åœ°å®šä¹‰åº”ç”¨çš„ç¼“å­˜è§„åˆ™ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒåªåŒ…å«äº†ä¸€ä¸ª <code>&lt;cache:caching&gt;</code> å…ƒç´ ã€‚è¿™ä¸ªå…ƒç´ åˆåŒ…å«äº†ä¸‰ä¸ª <code>&lt;cache:cacheable&gt;</code> å…ƒç´ å’Œä¸€ä¸ª <code>&lt;cache:cacheput&gt;</code> å…ƒç´ ã€‚</p>
<p>æ¯ä¸ª <code>&lt;cache:cacheable&gt;</code> å…ƒç´ éƒ½å£°æ˜äº†åˆ‡ç‚¹ä¸­çš„æŸä¸€ä¸ªæ–¹æ³•æ˜¯æ”¯æŒç¼“å­˜çš„ã€‚è¿™æ˜¯ä¸ @Cacheable æ³¨è§£åŒç­‰ä½œç”¨çš„ XML å…ƒç´ ã€‚å…·ä½“æ¥è®²ï¼ŒfindRecent()ã€findOne() å’Œ findBySpitterId() éƒ½å£°æ˜ä¸ºæ”¯æŒç¼“å­˜ï¼Œå®ƒä»¬çš„è¿”å›å€¼å°†ä¼šä¿å­˜åœ¨åä¸º spittleCache çš„ç¼“å­˜ä¹‹ä¸­ã€‚</p>
<p><code>&lt;cache:cache-put&gt;</code> æ˜¯ Spring XML ä¸­ä¸ @CachePut æ³¨è§£åŒç­‰ä½œç”¨çš„å…ƒç´ ã€‚å®ƒè¡¨æ˜ä¸€ä¸ªæ–¹æ³•çš„è¿”å›å€¼è¦å¡«å……åˆ°ç¼“å­˜ä¹‹ä¸­ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•æœ¬èº«å¹¶ä¸ä¼šä»ç¼“å­˜ä¸­è·å–è¿”å›å€¼ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œsave() æ–¹æ³•ç”¨æ¥å¡«å……ç¼“å­˜ã€‚åŒé¢å‘æ³¨è§£çš„ç¼“å­˜ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦å°†é»˜è®¤çš„ key æ”¹ä¸ºè¿”å› Spittle å¯¹è±¡çš„ id å±æ€§ã€‚</p>
<p>æœ€åï¼Œ<code>&lt;cache:cache-evict&gt;</code> å…ƒç´ æ˜¯ Spring XML ä¸­ç”¨æ¥æ›¿ä»£ @CacheEvict æ³¨è§£çš„ã€‚å®ƒä¼šä»ç¼“å­˜ä¸­ç§»é™¤å…ƒç´ ï¼Œè¿™æ ·çš„è¯ï¼Œä¸‹æ¬¡æœ‰äººè¿›è¡ŒæŸ¥æ‰¾çš„æ—¶å€™å°±æ‰¾ä¸åˆ°äº†ã€‚åœ¨è¿™é‡Œï¼Œè°ƒç”¨ remove() æ—¶ï¼Œä¼šå°†ç¼“å­˜ä¸­çš„ Spittle åˆ é™¤æ‰ï¼Œå…¶ä¸­ key ä¸ remove() æ–¹æ³•æ‰€ä¼ é€’è¿›æ¥çš„ ID å‚æ•°ç›¸ç­‰çš„æ¡ç›®ä¼šä»ç¼“å­˜ä¸­ç§»é™¤ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>&lt;cache:advice&gt;</code> å…ƒç´ æœ‰ä¸€ä¸ª cache-manager å…ƒç´ ï¼Œç”¨æ¥æŒ‡å®šä½œä¸ºç¼“å­˜ç®¡ç†å™¨çš„ beanã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯ cacheManagerï¼Œè¿™ä¸ç¨‹åºæ¸…å• 13.7 åº•éƒ¨çš„ <code>&lt;bean&gt;</code> å£°æ˜æ°å¥½æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦å†æ˜¾å¼åœ°è¿›è¡Œè®¾ç½®ã€‚ä½†æ˜¯ï¼Œå¦‚æœç¼“å­˜ç®¡ç†å™¨çš„ ID ä¸ä¹‹ä¸åŒçš„è¯ï¼ˆä½¿ç”¨å¤šä¸ªç¼“å­˜ç®¡ç†å™¨çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„åœº<br>æ™¯ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è®¾ç½® cache-manager å±æ€§æŒ‡å®šè¦ä½¿ç”¨å“ªä¸ªç¼“å­˜ç®¡ç†å™¨ã€‚</p>
<p>å¦å¤–ï¼Œè¿˜è¦ç•™æ„çš„æ˜¯ï¼Œ<code>&lt;cache:cacheable&gt;</code>ã€<code>&lt;cache:cacheput&gt;</code> å’Œ <code>&lt;cache:cache-evict&gt;</code> å…ƒç´ éƒ½å¼•ç”¨äº†åŒä¸€ä¸ªåä¸º spittleCache çš„ç¼“å­˜ã€‚ä¸ºäº†æ¶ˆé™¤è¿™ç§é‡å¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>&lt;cache:caching&gt;</code> å…ƒç´ ä¸ŠæŒ‡æ˜ç¼“å­˜çš„åå­—ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache:advice</span> <span class="attr">id</span>=<span class="string">&quot;cacheAdvice&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">cache:caching</span> <span class="attr">cache</span>=<span class="string">&quot;spittleCache&quot;</span>&gt;</span>      <span class="tag">&lt;<span class="name">cache:cacheable</span> <span class="attr">method</span>=<span class="string">&quot;findRecent&quot;</span> /&gt;</span>      <span class="tag">&lt;<span class="name">cache:cacheable</span> <span class="attr">method</span>=<span class="string">&quot;findBySpitterId&quot;</span> /&gt;</span>            <span class="tag">&lt;<span class="name">cache:cacheable</span> <span class="attr">method</span>=<span class="string">&quot;findOne&quot;</span> /&gt;</span>      <span class="tag">&lt;<span class="name">cache:cache-put</span> <span class="attr">method</span>=<span class="string">&quot;save&quot;</span> <span class="attr">key</span>=<span class="string">&quot;#result.id&quot;</span> /&gt;</span>      <span class="tag">&lt;<span class="name">cache:cache-evict</span> <span class="attr">method</span>=<span class="string">&quot;remove&quot;</span> /&gt;</span>  <span class="tag">&lt;/<span class="name">cache:caching</span>&gt;</span><span class="tag">&lt;/<span class="name">cache:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;cache:caching&gt;</code> æœ‰å‡ ä¸ªå¯ä»¥ä¾› <code>&lt;cache:cacheable&gt;</code>ã€<code>&lt;cache:cache-put&gt;</code> å’Œ <code>&lt;cache:cache-evict&gt;</code> å…±äº«çš„å±æ€§ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><p>cacheï¼šæŒ‡æ˜è¦å­˜å‚¨å’Œè·å–å€¼çš„ç¼“å­˜ï¼›</p>
</li>
<li><p>conditionï¼šSpELè¡¨è¾¾å¼ï¼Œå¦‚æœè®¡ç®—å¾—åˆ°çš„å€¼ä¸ºfalseï¼Œå°†ä¼šä¸ºè¿™ä¸ªæ–¹æ³•ç¦ç”¨ç¼“å­˜ï¼›</p>
</li>
<li><p>keyï¼šSpELè¡¨è¾¾å¼ï¼Œç”¨æ¥å¾—åˆ°ç¼“å­˜çš„keyï¼ˆé»˜è®¤ä¸ºæ–¹æ³•çš„å‚æ•°ï¼‰ï¼›</p>
</li>
<li><p>methodï¼šè¦ç¼“å­˜çš„æ–¹æ³•åã€‚</p>
</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œ<code>&lt;cache:cacheable&gt;</code> å’Œ <code>&lt;cache:cache-put&gt;</code> è¿˜æœ‰ä¸€ä¸ª unless å±æ€§ï¼Œå¯ä»¥ä¸ºè¿™ä¸ªå¯é€‰çš„å±æ€§æŒ‡å®šä¸€ä¸ª SpEL è¡¨è¾¾å¼ï¼Œå¦‚æœè¿™ä¸ªè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœä¸ºtrueï¼Œé‚£ä¹ˆå°†ä¼šé˜»æ­¢å°†è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¹‹ä¸­ã€‚</p>
<p><code>&lt;cache:cache-evict&gt;</code>å…ƒç´ è¿˜æœ‰å‡ ä¸ªç‰¹æœ‰çš„å±æ€§ï¼š</p>
<ul>
<li><p>all-entriesï¼šå¦‚æœæ˜¯ true çš„è¯ï¼Œç¼“å­˜ä¸­æ‰€æœ‰çš„æ¡ç›®éƒ½ä¼šè¢«ç§»é™¤æ‰ã€‚å¦‚æœæ˜¯ false çš„è¯ï¼Œåªæœ‰åŒ¹é… key çš„æ¡ç›®æ‰ä¼šè¢«ç§»é™¤æ‰ã€‚</p>
</li>
<li><p>before-invocationï¼šå¦‚æœæ˜¯ true çš„è¯ï¼Œç¼“å­˜æ¡ç›®å°†ä¼šåœ¨æ–¹æ³•è°ƒç”¨ä¹‹å‰è¢«ç§»é™¤æ‰ã€‚å¦‚æœæ˜¯ false çš„è¯ï¼Œæ–¹æ³•è°ƒç”¨ä¹‹åæ‰ä¼šç§»é™¤ç¼“å­˜ã€‚</p>
</li>
</ul>
<p>all-entries å’Œ before-invocation çš„é»˜è®¤å€¼éƒ½æ˜¯ falseã€‚è¿™æ„å‘³ç€åœ¨ä½¿ç”¨ <code>&lt;cache:cache-evict&gt;</code> å…ƒç´ ä¸”ä¸é…ç½®è¿™ä¸¤ä¸ªå±æ€§æ—¶ï¼Œä¼šåœ¨æ–¹æ³•è°ƒç”¨å®Œæˆååªåˆ é™¤ä¸€ä¸ªç¼“å­˜æ¡ç›®ã€‚è¦åˆ é™¤çš„æ¡ç›®ä¼šé€šè¿‡é»˜è®¤çš„ keyï¼ˆåŸºäºæ–¹æ³•çš„å‚æ•°ï¼‰è¿›è¡Œè¯†åˆ«ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ä¸ºåä¸º key çš„å±æ€§è®¾ç½®ä¸€ä¸ª SpEL è¡¨è¾¾å¼æŒ‡å®šè¦åˆ é™¤çš„ keyã€‚</p>
<h3 id="å°ç»“-12"><a href="#å°ç»“-12" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å¦‚æœæƒ³è®©åº”ç”¨ç¨‹åºé¿å…ä¸€ééåœ°ä¸ºåŒä¸€ä¸ªé—®é¢˜æ¨å¯¼ã€è®¡ç®—æˆ–æŸ¥è¯¢ç­”æ¡ˆçš„è¯ï¼Œç¼“å­˜æ˜¯ä¸€ç§å¾ˆæ£’çš„æ–¹å¼ã€‚å½“ä»¥ä¸€ç»„å‚æ•°ç¬¬ä¸€æ¬¡è°ƒç”¨æŸä¸ªæ–¹æ³•æ—¶ï¼Œè¿”å›å€¼ä¼šè¢«ä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•å†æ¬¡ä»¥ç›¸åŒçš„å‚æ•°è¿›è¡Œè°ƒç”¨æ—¶ï¼Œè¿™ä¸ªè¿”å›å€¼ä¼šä»ç¼“å­˜ä¸­æŸ¥è¯¢è·å–ã€‚åœ¨å¾ˆå¤šåœºæ™¯ä¸­ï¼Œä»ç¼“å­˜æŸ¥æ‰¾å€¼ä¼šæ¯”å…¶ä»–çš„æ–¹å¼ï¼ˆæ¯”å¦‚ï¼Œæ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼‰æˆæœ¬æ›´ä½ã€‚å› æ­¤ï¼Œç¼“å­˜ä¼šå¯¹åº”ç”¨ç¨‹åºçš„æ€§èƒ½å¸¦æ¥æ­£é¢çš„å½±å“ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•åœ¨Springåº”ç”¨ä¸­å£°æ˜ç¼“å­˜ã€‚é¦–å…ˆï¼Œçœ‹åˆ°çš„æ˜¯å¦‚ä½•å£°æ˜ä¸€ä¸ªæˆ–æ›´å¤šçš„ Spring ç¼“å­˜ç®¡ç†å™¨ã€‚ç„¶åï¼Œå°†ç¼“å­˜ç”¨åˆ°äº† Spittr åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™æ˜¯é€šè¿‡å°† @Cacheableã€@CachePut å’Œ @CacheEvic tæ·»åŠ åˆ° SpittleRepository ä¸Šå®ç°çš„ã€‚</p>
<p>æˆ‘ä»¬è¿˜çœ‹åˆ°äº†å¦‚ä½•å€ŸåŠ© XML å°†ç¼“å­˜è§„åˆ™çš„é…ç½®ä¸åº”ç”¨ç¨‹åºä»£ç åˆ†ç¦»å¼€æ¥ã€‚<code>&lt;cache:cacheable&gt;</code>ã€<code>&lt;cache:cache-put&gt;</code> å’Œ <code>&lt;cache:cache-evict&gt;</code> å…ƒç´ çš„ä½œç”¨ä¸æœ¬ç« å‰é¢æ‰€ä½¿ç”¨çš„æ³¨è§£æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ç¼“å­˜å®é™…ä¸Šæ˜¯ä¸€ç§é¢å‘åˆ‡é¢çš„è¡Œä¸ºã€‚Spring å°†ç¼“å­˜å®ç°ä¸ºä¸€ä¸ªåˆ‡é¢ã€‚åœ¨ä½¿ç”¨ XML å£°æ˜ç¼“å­˜è§„åˆ™æ—¶ï¼Œè¿™ä¸€ç‚¹éå¸¸æ˜æ˜¾ï¼šæˆ‘ä»¬å¿…é¡»è¦å°†ç¼“å­˜é€šçŸ¥ç»‘å®šåˆ°ä¸€ä¸ªåˆ‡ç‚¹ä¸Šã€‚</p>
<p>Spring åœ¨å°†å®‰å…¨åŠŸèƒ½åº”ç”¨åˆ°æ–¹æ³•ä¸Šæ—¶ï¼ŒåŒæ ·ä½¿ç”¨äº†åˆ‡é¢ã€‚åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•å€ŸåŠ© Spring Security ç¡®ä¿ bean æ–¹æ³•çš„å®‰å…¨æ€§ã€‚</p>
<h2 id="ä¿æŠ¤æ–¹æ³•åº”ç”¨"><a href="#ä¿æŠ¤æ–¹æ³•åº”ç”¨" class="headerlink" title="ä¿æŠ¤æ–¹æ³•åº”ç”¨"></a>ä¿æŠ¤æ–¹æ³•åº”ç”¨</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>ä¿æŠ¤æ–¹æ³•è°ƒç”¨</li>
<li>ä½¿ç”¨è¡¨è¾¾å¼å®šä¹‰å®‰å…¨è§„åˆ™</li>
<li>åˆ›å»ºå®‰å…¨è¡¨è¾¾å¼è®¡ç®—å™¨</li>
</ul>
<p>åœ¨ç¦»å®¶æˆ–ä¸ŠåºŠç¡è§‰ä¹‹å‰ï¼Œæˆ‘åšçš„æœ€åä¸€ä»¶äº‹å°±æ˜¯ç¡®ä¿æˆ¿é—´çš„é—¨å·²ç»å…³å¥½ã€‚ä½†æ˜¯åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä¼šè®¾ç½®å¥½è­¦æŠ¥ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºï¼Œå°½ç®¡é—¨é”æ˜¯ä¿è¯å®‰å…¨çš„ä¸€ä¸ªå¥½åŠæ³•ï¼Œä½†æ˜¯è­¦æŠ¥ç³»ç»Ÿæä¾›äº†ç¬¬äºŒå±‚é˜²æŠ¤ï¼Œçªƒè´¼æœ‰å¯èƒ½ä¼šè¶Šè¿‡é—¨é”çš„ä¿æŠ¤ã€‚</p>
<p>åœ¨ç¬¬ 9 ç« ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ Spring Security ä¿æŠ¤åº”ç”¨çš„ Web å±‚ã€‚Web å®‰å…¨æ˜¯éå¸¸é‡è¦çš„ï¼Œå®ƒèƒ½é˜»æ­¢ç”¨æˆ·è®¿é—®æ²¡æœ‰æƒé™çš„å†…å®¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœåº”ç”¨çš„ Web å±‚å‡ºç°å®‰å…¨æ¼æ´ä¼šæ€æ ·å‘¢ï¼Ÿå¦‚æœç”¨æˆ·èƒ½å¤Ÿè¯·æ±‚ä»–ä»¬ä¸å…è®¸è®¿é—®çš„å†…å®¹ä¼šæ€æ ·å‘¢ï¼Ÿ</p>
<p>å°½ç®¡æˆ‘ä»¬æ²¡æœ‰ç†ç”±è®¤ä¸ºç”¨æˆ·èƒ½å¤Ÿæ”»ç ´åº”ç”¨çš„å®‰å…¨å±‚ï¼Œä½†æ˜¯åœ¨ Web å±‚å‡ºç°å®‰å…¨æ¼æ´å®åœ¨æ˜¯å¤ªå®¹æ˜“äº†ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ç”¨æˆ·è¯·æ±‚äº†ä¸€ä¸ªå…è®¸è®¿é—®çš„é¡µé¢ï¼Œä½†æ˜¯ç”±äºå¼€å‘äººå‘˜ä¸è®¤çœŸï¼Œå¤„ç†è¿™ä¸ªè¯·æ±‚çš„æ§åˆ¶å™¨æ–¹æ³•è¿”å›äº†è¯¥ç”¨æˆ·ä¸å…è®¸çœ‹åˆ°çš„æ•°æ®ã€‚è¿™æ˜¯ä¸€ä¸ªæ— å¿ƒä¹‹å¤±ï¼Œä¸è¿‡ï¼Œå®‰å…¨é—®é¢˜å¾ˆå¯èƒ½å°±æ˜¯æ— å¿ƒä¹‹å¤±æ‰€é€ æˆçš„ï¼Œå› ä¸ºä»–ä»¬æ˜¯éå¸¸èªæ˜çš„æ”»å‡»è€…ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åŒæ—¶ä¿æŠ¤åº”ç”¨çš„ Web å±‚ä»¥åŠåœºæ™¯åé¢çš„æ–¹æ³•ï¼Œè¿™æ ·å°±èƒ½ä¿è¯å¦‚æœç”¨æˆ·ä¸å…·å¤‡æƒé™çš„è¯ï¼Œå°±æ— æ³•æ‰§è¡Œç›¸åº”çš„é€»è¾‘ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨ Spring Security ä¿æŠ¤ bean æ–¹æ³•ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå°±èƒ½å£°æ˜å®‰å…¨è§„åˆ™ï¼Œä¿è¯å¦‚æœç”¨æˆ·æ²¡æœ‰æ‰§è¡Œæ–¹æ³•çš„æƒé™ï¼Œå°±ä¸ä¼šæ‰§è¡Œç›¸åº”çš„æ–¹æ³•ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä¼šçœ‹ä¸€äº›å¯ä»¥æ”¾åœ¨æ–¹æ³•ä¸Šçš„ç®€å•æ³¨è§£ï¼Œå®ƒä»¬èƒ½å¤Ÿå°†æ–¹æ³•é”å®šï¼Œé˜»æ­¢æ— æƒé™ç”¨æˆ·çš„è®¿é—®ã€‚</p>
<h3 id="ä½¿ç”¨æ³¨è§£ä¿æŠ¤æ–¹æ³•"><a href="#ä½¿ç”¨æ³¨è§£ä¿æŠ¤æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ³¨è§£ä¿æŠ¤æ–¹æ³•"></a>ä½¿ç”¨æ³¨è§£ä¿æŠ¤æ–¹æ³•</h3><p>åœ¨ Spring Security ä¸­å®ç°æ–¹æ³•çº§å®‰å…¨æ€§çš„æœ€å¸¸è§åŠæ³•æ˜¯ä½¿ç”¨ç‰¹å®šçš„æ³¨è§£ï¼Œå°†è¿™äº›æ³¨è§£åº”ç”¨åˆ°éœ€è¦ä¿æŠ¤çš„æ–¹æ³•ä¸Šã€‚è¿™æ ·æœ‰å‡ ä¸ªå¥½å¤„ï¼Œæœ€é‡è¦çš„æ˜¯å½“æˆ‘ä»¬åœ¨ç¼–è¾‘å™¨ä¸­æŸ¥çœ‹ç»™å®šçš„æ–¹æ³•æ—¶ï¼Œèƒ½å¤Ÿå¾ˆæ¸…æ¥šåœ°çœ‹åˆ°å®ƒçš„å®‰å…¨è§„åˆ™ã€‚</p>
<p>Spring Security æä¾›äº†ä¸‰ç§ä¸åŒçš„å®‰å…¨æ³¨è§£ï¼š</p>
<ul>
<li>Spring Security è‡ªå¸¦çš„ @Secured æ³¨è§£ï¼›</li>
<li>JSR-250 çš„ @RolesAllowed æ³¨è§£ï¼›</li>
<li>è¡¨è¾¾å¼é©±åŠ¨çš„æ³¨è§£ï¼ŒåŒ…æ‹¬ @PreAuthorizeã€@PostAuthorizeã€@PreFilter å’Œ @PostFilterã€‚</li>
</ul>
<p>@Secured å’Œ @RolesAllowed æ–¹æ¡ˆéå¸¸ç±»ä¼¼ï¼Œèƒ½å¤ŸåŸºäºç”¨æˆ·æ‰€æˆäºˆçš„æƒé™é™åˆ¶å¯¹æ–¹æ³•çš„è®¿é—®ã€‚å½“æˆ‘ä»¬éœ€è¦åœ¨æ–¹æ³•ä¸Šå®šä¹‰æ›´çµæ´»çš„å®‰å…¨è§„åˆ™æ—¶ï¼ŒSpring Security æä¾›äº† @PreAuthorize å’Œ @PostAuthorizeï¼Œè€Œ @PreFilter/@PostFilter èƒ½å¤Ÿè¿‡æ»¤æ–¹æ³•è¿”å›çš„ä»¥åŠä¼ å…¥æ–¹æ³•çš„é›†åˆã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œä½ å°†ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨è¿™äº›æ³¨è§£ã€‚ä½œä¸ºå¼€å§‹ï¼Œæˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹ @Secured æ³¨è§£ï¼Œè¿™æ˜¯ Spring Security æ‰€æä¾›çš„æ–¹æ³•çº§å®‰å…¨æ³¨è§£é‡Œé¢æœ€ç®€å•çš„ä¸€ä¸ªã€‚</p>
<h4 id="ä½¿ç”¨-Secured-æ³¨è§£é™åˆ¶æ–¹æ³•è°ƒç”¨"><a href="#ä½¿ç”¨-Secured-æ³¨è§£é™åˆ¶æ–¹æ³•è°ƒç”¨" class="headerlink" title="ä½¿ç”¨ @Secured æ³¨è§£é™åˆ¶æ–¹æ³•è°ƒç”¨"></a>ä½¿ç”¨ @Secured æ³¨è§£é™åˆ¶æ–¹æ³•è°ƒç”¨</h4><p>åœ¨ Spring ä¸­ï¼Œå¦‚æœè¦å¯ç”¨åŸºäºæ³¨è§£çš„æ–¹æ³•å®‰å…¨æ€§ï¼Œå…³é”®ä¹‹å¤„åœ¨äºè¦åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨ @EnableGlobalMethodSecurityï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span><span class="meta">@EnableGlobalMethodSecurity(securedEnabled=true)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodSecurityConfig</span> <span class="keyword">extends</span> <span class="title">GlobalMethodSecurityConfiguration</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†ä½¿ç”¨ @EnableGlobalMethodSecurity æ³¨è§£ï¼Œæˆ‘ä»¬å¯èƒ½ä¹Ÿæ³¨æ„åˆ°é…ç½®ç±»æ‰©å±•äº† GlobalMethodSecurityConfigurationã€‚åœ¨ç¬¬ 9 ç« ä¸­ï¼ŒWeb å®‰å…¨çš„é…ç½®ç±»æ‰©å±•äº† WebSecurityConfigurerAdapterï¼Œä¸ä¹‹ç±»ä¼¼ï¼Œè¿™ä¸ªç±»èƒ½å¤Ÿä¸ºæ–¹æ³•çº§åˆ«çš„å®‰å…¨æ€§æä¾›æ›´ç²¾ç»†çš„é…ç½®ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ Web å±‚çš„å®‰å…¨é…ç½®ä¸­è®¾ç½®è®¤è¯ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡é‡è½½ GlobalMethodSecurityConfiguration çš„ configure() æ–¹æ³•å®ç°è¯¥åŠŸèƒ½ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;  auth.inMemoryAuthentication()      .withUser(<span class="string">&quot;user&quot;</span>).password(<span class="string">&quot;password&quot;</span>).role(<span class="string">&quot;USER&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ç« ç¨åçš„14.2.2å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•é‡è½½ GlobalMethodSecurityConfiguration çš„ createExpressionHandler() æ–¹æ³•ï¼Œæä¾›ä¸€äº›è‡ªå®šä¹‰çš„å®‰å…¨è¡¨è¾¾å¼å¤„ç†è¡Œä¸ºã€‚</p>
<p>è®©æˆ‘ä»¬å›åˆ° @EnableGlobalMethodSecurity æ³¨è§£ï¼Œæ³¨æ„å®ƒçš„ securedEnabled å±æ€§è®¾ç½®æˆäº† trueã€‚å¦‚æœ securedEnabled å±æ€§çš„å€¼ä¸º true çš„è¯ï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ªåˆ‡ç‚¹ï¼Œè¿™æ ·çš„è¯ Spring Security åˆ‡é¢å°±ä¼šåŒ…è£…å¸¦æœ‰ @Secured æ³¨è§£çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘å¦‚ä¸‹è¿™ä¸ªå¸¦æœ‰ @Secured æ³¨è§£çš„ addSpittle() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Secured(&quot;ROLE_SPITTER&quot;)</span><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpittle</span><span class="params">(Spittle spittle)</span> </span>&#123;  <span class="comment">// ...&#125;</span></span><br></pre></td></tr></table></figure>

<p>@Secured æ³¨è§£ä¼šä½¿ç”¨ä¸€ä¸ª String æ•°ç»„ä½œä¸ºå‚æ•°ã€‚æ¯ä¸ª String å€¼æ˜¯ä¸€ä¸ªæƒé™ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•è‡³å°‘éœ€è¦å…·å¤‡å…¶ä¸­çš„ä¸€ä¸ªæƒé™ã€‚é€šè¿‡ä¼ é€’è¿›æ¥ ROLE_SPITTERï¼Œæˆ‘ä»¬å‘Šè¯‰ Spring Security åªå…è®¸å…·æœ‰ ROLE_SPITTER æƒé™çš„è®¤è¯ç”¨æˆ·æ‰èƒ½è°ƒç”¨ addSpittle() æ–¹æ³•ã€‚</p>
<p>å¦‚æœä¼ é€’ç»™ @Secured å¤šä¸ªæƒé™å€¼ï¼Œè®¤è¯ç”¨æˆ·å¿…é¡»è‡³å°‘å…·å¤‡å…¶ä¸­çš„ä¸€ä¸ªæ‰èƒ½è¿›è¡Œæ–¹æ³•çš„è°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢ä½¿ç”¨ @Secured çš„æ–¹å¼è¡¨æ˜ç”¨æˆ·å¿…é¡»å…·å¤‡  ROLE_SPITTER æˆ– ROLE_ADMIN æƒé™æ‰èƒ½è§¦å‘è¿™ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Secured(&#123;&quot;ROLE_SPITTER&quot;, &quot;ROLE_ADMIN&quot;&#125;)</span><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpittle</span><span class="params">(Spittle spittle)</span> </span>&#123;  <span class="comment">// ...&#125;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ–¹æ³•è¢«æ²¡æœ‰è®¤è¯çš„ç”¨æˆ·æˆ–æ²¡æœ‰æ‰€éœ€æƒé™çš„ç”¨æˆ·è°ƒç”¨ï¼Œä¿æŠ¤è¿™ä¸ªæ–¹æ³•çš„åˆ‡é¢å°†æŠ›å‡ºä¸€ä¸ª Spring Security å¼‚å¸¸ï¼ˆå¯èƒ½æ˜¯ AuthenticationException æˆ– AccessDeniedException çš„å­ç±»ï¼‰ã€‚å®ƒä»¬æ˜¯éæ£€æŸ¥å‹å¼‚å¸¸ï¼Œä½†è¿™ä¸ªå¼‚å¸¸æœ€ç»ˆå¿…é¡»è¦è¢«æ•è·å’Œå¤„ç†ã€‚å¦‚æœè¢«ä¿æŠ¤çš„æ–¹æ³•æ˜¯åœ¨ Web è¯·æ±‚ä¸­è°ƒç”¨çš„ï¼Œè¿™ä¸ªå¼‚å¸¸ä¼šè¢«Spring Security çš„è¿‡æ»¤å™¨è‡ªåŠ¨å¤„ç†ã€‚å¦åˆ™çš„è¯ï¼Œä½ éœ€è¦ç¼–å†™ä»£ç æ¥å¤„ç†è¿™ä¸ªå¼‚å¸¸ã€‚</p>
<p>@Secured æ³¨è§£çš„ä¸è¶³ä¹‹å¤„åœ¨äºå®ƒæ˜¯ Spring ç‰¹å®šçš„æ³¨è§£ã€‚å¦‚æœæ›´å€¾å‘äºä½¿ç”¨ Java æ ‡å‡†å®šä¹‰çš„æ³¨è§£ï¼Œé‚£ä¹ˆä½ åº”è¯¥è€ƒè™‘ä½¿ç”¨ @RolesAllowed æ³¨è§£ã€‚</p>
<h4 id="åœ¨-Spring-Security-ä¸­ä½¿ç”¨-JSR-250-çš„-RolesAllowed-æ³¨è§£"><a href="#åœ¨-Spring-Security-ä¸­ä½¿ç”¨-JSR-250-çš„-RolesAllowed-æ³¨è§£" class="headerlink" title="åœ¨ Spring Security ä¸­ä½¿ç”¨ JSR-250 çš„ @RolesAllowed æ³¨è§£"></a>åœ¨ Spring Security ä¸­ä½¿ç”¨ JSR-250 çš„ @RolesAllowed æ³¨è§£</h4><p>@RolesAllowed æ³¨è§£å’Œ @Secured æ³¨è§£åœ¨å„ä¸ªæ–¹é¢åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸€è‡´çš„ã€‚å”¯ä¸€æ˜¾è‘—çš„åŒºåˆ«åœ¨äº @RolesAllowed æ˜¯ JSR-250 å®šä¹‰çš„ Java æ ‡å‡†æ³¨è§£ã€‚</p>
<p>å·®å¼‚æ›´å¤šåœ¨äºæ”¿æ²»è€ƒé‡è€ŒéæŠ€æœ¯å› ç´ ã€‚ä½†æ˜¯ï¼Œå½“ä½¿ç”¨å…¶ä»–æ¡†æ¶æˆ– API æ¥å¤„ç†æ³¨è§£çš„è¯ï¼Œä½¿ç”¨æ ‡å‡†çš„ @RolesAllowed æ³¨è§£ä¼šæ›´æœ‰æ„ä¹‰ã€‚</p>
<p>å¦‚æœé€‰æ‹©ä½¿ç”¨ @RolesAllowed çš„è¯ï¼Œéœ€è¦å°† @EnableGlobalMethodSecurity çš„ jsr250Enabled å±æ€§è®¾ç½®ä¸º trueï¼Œä»¥å¼€å¯æ­¤åŠŸèƒ½ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span><span class="meta">@EnableGlobalMethodSecurity(jsr250Enable=true)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodSecurityConfig</span> <span class="keyword">extends</span> <span class="title">GlobalMethodSecurityConfiguration</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>å°½ç®¡æˆ‘ä»¬è¿™é‡Œåªæ˜¯å¯ç”¨äº† jsr250Enabledï¼Œä½†éœ€è¦è¯´æ˜çš„ä¸€ç‚¹æ˜¯è¿™ä¸ securedEnabled å¹¶ä¸å†²çªã€‚è¿™ä¸¤ç§æ³¨è§£é£æ ¼å¯ä»¥åŒæ—¶å¯ç”¨ã€‚</p>
<p>åœ¨å°† jsr250Enabled è®¾ç½®ä¸º true ä¹‹åï¼Œå°†ä¼šå¯ç”¨ä¸€ä¸ªåˆ‡ç‚¹ï¼Œè¿™æ ·å¸¦æœ‰ @RolesAllowed æ³¨è§£çš„æ–¹æ³•éƒ½ä¼šè¢« Spring Security çš„åˆ‡é¢åŒ…è£…èµ·æ¥ã€‚å› æ­¤ï¼Œåœ¨æ–¹æ³•ä¸Šä½¿ç”¨ @RolesAllowed çš„æ–¹å¼ä¸ä½¿ç”¨ @Secured ç±»ä¼¼ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„ addSpittle() æ–¹æ³•ä½¿ç”¨äº† @RolesAllowed æ³¨è§£æ¥ä»£æ›¿ @Securedï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RolesAllowed(&quot;ROLE_SPITTER&quot;)</span><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpittle</span><span class="params">(Spittle spittle)</span> </span>&#123;  <span class="comment">// ...&#125;</span></span><br></pre></td></tr></table></figure>

<p>å°½ç®¡ @RolesAllowed æ¯” @Secured åœ¨æ”¿æ²»ä¸Šç¨å¾®æœ‰ç‚¹ä¼˜åŠ¿ï¼Œå®ƒæ˜¯å®ç°æ–¹æ³•å®‰å…¨çš„æ ‡å‡†æ³¨è§£ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæ³¨è§£æœ‰ä¸€ä¸ªå…±åŒçš„ä¸è¶³ã€‚å®ƒä»¬åªèƒ½æ ¹æ®ç”¨æˆ·æœ‰æ²¡æœ‰æˆäºˆç‰¹å®šçš„æƒé™æ¥é™åˆ¶æ–¹æ³•çš„è°ƒç”¨ã€‚åœ¨åˆ¤æ–­æ–¹å¼æ˜¯å¦æ‰§è¡Œæ–¹é¢ï¼Œæ— æ³•ä½¿ç”¨å…¶ä»–çš„å› ç´ ã€‚æˆ‘ä»¬åœ¨ç¬¬ 9 ç« æ›¾ç»çœ‹åˆ°è¿‡ï¼Œåœ¨ä¿æŠ¤ URL æ–¹é¢ï¼Œèƒ½å¤Ÿä½¿ç”¨ SpEL è¡¨è¾¾å¼å…‹æœè¿™ä¸€é™åˆ¶ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ç»„åˆä½¿ç”¨ SpEL ä¸ Spring Security æ‰€æä¾›çš„æ–¹æ³•è°ƒç”¨å‰åæ³¨è§£ï¼Œå®ç°åŸºäºè¡¨è¾¾å¼çš„æ–¹æ³•å®‰å…¨æ€§ã€‚</p>
<h3 id="ä½¿ç”¨è¡¨è¾¾å¼å®ç°æ–¹æ³•çº§åˆ«çš„å®‰å…¨æ€§"><a href="#ä½¿ç”¨è¡¨è¾¾å¼å®ç°æ–¹æ³•çº§åˆ«çš„å®‰å…¨æ€§" class="headerlink" title="ä½¿ç”¨è¡¨è¾¾å¼å®ç°æ–¹æ³•çº§åˆ«çš„å®‰å…¨æ€§"></a>ä½¿ç”¨è¡¨è¾¾å¼å®ç°æ–¹æ³•çº§åˆ«çš„å®‰å…¨æ€§</h3><p>å°½ç®¡ @Secured å’Œ @RolesAllowed æ³¨è§£åœ¨æ‹’ç»æœªè®¤è¯ç”¨æˆ·æ–¹é¢è¡¨ç°ä¸é”™ï¼Œä½†è¿™ä¹Ÿæ˜¯å®ƒä»¬æ‰€èƒ½åšåˆ°çš„æ‰€æœ‰äº‹æƒ…äº†ã€‚æœ‰æ—¶å€™ï¼Œå®‰å…¨æ€§çº¦æŸä¸ä»…ä»…æ¶‰åŠç”¨æˆ·æ˜¯å¦æœ‰æƒé™ã€‚</p>
<p>Spring Security 3.0 å¼•å…¥äº†å‡ ä¸ªæ–°æ³¨è§£ï¼Œå®ƒä»¬ä½¿ç”¨ SpEL èƒ½å¤Ÿåœ¨æ–¹æ³•è°ƒç”¨ä¸Šå®ç°æ›´æœ‰æ„æ€çš„å®‰å…¨æ€§çº¦æŸã€‚è¿™äº›æ–°çš„æ³¨è§£åœ¨è¡¨ 14.1 ä¸­è¿›è¡Œäº†æè¿°ã€‚</p>
<p>è¿™äº›æ³¨è§£çš„å€¼å‚æ•°ä¸­éƒ½å¯ä»¥æ¥å—ä¸€ä¸ª SpEL è¡¨è¾¾å¼ã€‚è¡¨è¾¾å¼å¯ä»¥æ˜¯ä»»æ„åˆæ³•çš„ SpEL è¡¨è¾¾å¼ï¼Œå¯èƒ½ä¼šåŒ…å«è¡¨ 9.5 æ‰€åˆ—çš„ Spring Security å¯¹ SpEL çš„æ‰©å±•ã€‚å¦‚æœè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœä¸º trueï¼Œé‚£ä¹ˆå®‰å…¨è§„åˆ™é€šè¿‡ï¼Œå¦åˆ™å°±ä¼šå¤±è´¥ã€‚å®‰å…¨è§„åˆ™é€šè¿‡æˆ–å¤±è´¥çš„ç»“æœä¼šå› ä¸ºæ‰€ä½¿ç”¨æ³¨è§£çš„å·®å¼‚è€Œæœ‰æ‰€ä¸åŒã€‚</p>
<center>è¡¨ 14.1ã€€Spring Security 3.0 æä¾›äº† 4 ä¸ªæ–°çš„æ³¨è§£ï¼Œå¯ä»¥ä½¿ç”¨ SpEL è¡¨è¾¾å¼æ¥ä¿æŠ¤æ–¹æ³•è°ƒç”¨</center>

<table>
<thead>
<tr>
<th>æ³¨ã€€ã€€è§£</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>@PreAuthorize</td>
<td>åœ¨æ–¹æ³•è°ƒç”¨ä¹‹å‰ï¼ŒåŸºäºè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœæ¥é™åˆ¶å¯¹æ–¹æ³•çš„è®¿é—®</td>
</tr>
<tr>
<td>@PostAuthorize</td>
<td>å…è®¸æ–¹æ³•è°ƒç”¨ï¼Œä½†æ˜¯å¦‚æœè¡¨è¾¾å¼è®¡ç®—ç»“æœä¸º falseï¼Œå°†æŠ›å‡ºä¸€ä¸ªå®‰å…¨æ€§å¼‚å¸¸</td>
</tr>
<tr>
<td>@PostFilter</td>
<td>å…è®¸æ–¹æ³•è°ƒç”¨ï¼Œä½†å¿…é¡»æŒ‰ç…§è¡¨è¾¾å¼æ¥è¿‡æ»¤æ–¹æ³•çš„ç»“æœ</td>
</tr>
<tr>
<td>@PreFilter</td>
<td>å…è®¸æ–¹æ³•è°ƒç”¨ï¼Œä½†å¿…é¡»åœ¨è¿›å…¥æ–¹æ³•ä¹‹å‰è¿‡æ»¤è¾“å…¥å€¼</td>
</tr>
</tbody></table>
<p>ç¨åï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°æ¯ä¸ªæ³¨è§£çš„ä¾‹å­ã€‚ä½†é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å°† @EnableGlobalMethodSecurity æ³¨è§£çš„ prePostEnabled å±æ€§è®¾ç½®ä¸º trueï¼Œä»è€Œå¯ç”¨å®ƒä»¬ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configurationpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodSecurityConfig</span> <span class="keyword">extends</span> <span class="title">GlobalMethodSecurityConfiguration</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæ–¹æ³•è°ƒç”¨å‰åçš„æ³¨è§£éƒ½å·²ç»å¯ç”¨äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä»¬äº†ã€‚æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ @PreAuthorize å’Œ @PostAuthorize æ³¨è§£é™åˆ¶å¯¹æ–¹æ³•çš„è°ƒç”¨ã€‚</p>
<h4 id="è¡¨è¿°æ–¹æ³•è®¿é—®è§„åˆ™"><a href="#è¡¨è¿°æ–¹æ³•è®¿é—®è§„åˆ™" class="headerlink" title="è¡¨è¿°æ–¹æ³•è®¿é—®è§„åˆ™"></a>è¡¨è¿°æ–¹æ³•è®¿é—®è§„åˆ™</h4><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ° @Secured å’Œ @RolesAllowed èƒ½å¤Ÿé™åˆ¶åªæœ‰ç”¨æˆ·å…·å¤‡æ‰€éœ€çš„æƒé™æ‰èƒ½è§¦å‘æ–¹æ³•çš„æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œè¿™ä¸¤ä¸ªæ³¨è§£çš„ä¸è¶³åœ¨äºå®ƒä»¬åªèƒ½åŸºäºç”¨æˆ·æˆäºˆçš„æƒé™æ¥åšå‡ºå†³ç­–ã€‚</p>
<p>Spring Security è¿˜æä¾›äº†ä¸¤ä¸ªæ³¨è§£ï¼Œ@PreAuthorize å’Œ @PostAuthorizeï¼Œå®ƒä»¬èƒ½å¤ŸåŸºäºè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœæ¥é™åˆ¶æ–¹æ³•çš„è®¿é—®ã€‚åœ¨å®šä¹‰å®‰å…¨é™åˆ¶æ–¹é¢ï¼Œè¡¨è¾¾å¼å¸¦äº†æå¤§çš„çµæ´»æ€§ã€‚é€šè¿‡ä½¿ç”¨è¡¨è¾¾å¼ï¼Œåªè¦æˆ‘ä»¬èƒ½å¤Ÿæƒ³è±¡å¾—åˆ°ï¼Œå°±å¯ä»¥å®šä¹‰ä»»æ„å…è®¸è®¿é—®æˆ–ä¸å…è®¸è®¿é—®æ–¹æ³•çš„æ¡ä»¶ã€‚</p>
<p>@PreAuthorize å’Œ @PostAuthorizeä¹‹é—´çš„å…³é”®åŒºåˆ«åœ¨äºè¡¨è¾¾å¼æ‰§è¡Œçš„æ—¶æœºã€‚@PreAuthorize çš„è¡¨è¾¾å¼ä¼šåœ¨æ–¹æ³•è°ƒç”¨ä¹‹å‰æ‰§è¡Œï¼Œå¦‚æœè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœä¸ä¸º true çš„è¯ï¼Œå°†ä¼šé˜»æ­¢æ–¹æ³•æ‰§è¡Œã€‚ä¸ä¹‹ç›¸åï¼Œ@PostAuthorize çš„è¡¨è¾¾å¼ç›´åˆ°æ–¹æ³•è¿”å›æ‰ä¼šæ‰§è¡Œï¼Œç„¶åå†³å®šæ˜¯å¦æŠ›å‡ºå®‰å…¨æ€§çš„å¼‚å¸¸ã€‚</p>
<p>åœ¨æ–¹æ³•è°ƒç”¨å‰éªŒè¯æƒé™</p>
<p>@PreAuthorize ä¹çœ‹èµ·æ¥å¯èƒ½åªæ˜¯æ·»åŠ äº† SpEL æ”¯æŒçš„ @Secured å’Œ @RolesAllowedã€‚å®é™…ä¸Šï¼Œä½ å¯ä»¥åŸºäºç”¨æˆ·æ‰€æˆäºˆçš„è§’è‰²ï¼Œä½¿ç”¨ @PreAuthorize æ¥é™åˆ¶è®¿é—®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize(&quot;hasRole(&#x27;ROLE_SPITTER&#x27;)&quot;)</span><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpittle</span><span class="params">(Spittle spittle)</span> </span>&#123;  <span class="comment">// ...&#125;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæŒ‰ç…§è¿™ç§æ–¹å¼çš„è¯ï¼Œ@PreAuthorize ç›¸å¯¹äº @Secured å’Œ @RolesAllowed å¹¶æ²¡æœ‰ä»€ä¹ˆä¼˜åŠ¿ã€‚å¦‚æœç”¨æˆ·å…·æœ‰ ROLE_SPITTER è§’è‰²çš„è¯ï¼Œå…è®¸æ–¹æ³•è°ƒç”¨ã€‚å¦åˆ™ï¼Œå°†ä¼šæŠ›å‡ºå®‰å…¨æ€§å¼‚å¸¸ï¼Œæ–¹æ³•ä¹Ÿä¸ä¼šæ‰§è¡Œã€‚</p>
<p>ä½†æ˜¯ï¼Œ@PreAuthorize çš„åŠŸèƒ½å¹¶ä¸é™äºè¿™ä¸ªç®€å•ä¾‹å­æ‰€å±•ç°çš„ã€‚@PreAuthorize çš„ Stringç±»å‹å‚æ•°æ˜¯ä¸€ä¸ª SpEL è¡¨è¾¾å¼ã€‚å€ŸåŠ©äº SpEL è¡¨è¾¾å¼æ¥å®ç°è®¿é—®å†³ç­–ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç¼–å†™å‡ºæ›´é«˜çº§çš„å®‰å…¨æ€§çº¦æŸã€‚ä¾‹å¦‚ï¼ŒSpittr åº”ç”¨ç¨‹åºçš„ä¸€èˆ¬ç”¨æˆ·åªèƒ½å†™ 140 ä¸ªå­—ä»¥å†…çš„Spittleï¼Œè€Œä»˜è´¹ç”¨æˆ·ä¸é™åˆ¶å­—æ•°ã€‚</p>
<p>è™½ç„¶ @Secured å’Œ @RolesAllowed åœ¨è¿™é‡Œæ— èƒ½ä¸ºåŠ›ï¼Œä½†æ˜¯ @PreAuthorize æ³¨è§£æ°å¥½èƒ½å¤Ÿé€‚ç”¨äºè¿™ç§åœºæ™¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize(&quot;hasRole(&#x27;ROLE_SPITTER&#x27;) and #spittle.text.length() &lt;= 140 or hasRole(&#x27;ROLE_PREMIUN&#x27;)&quot;)</span><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpittle</span><span class="params">(Spittle spittle)</span> </span>&#123;  <span class="comment">// ...&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¡¨è¾¾å¼ä¸­çš„ #spittle éƒ¨åˆ†ç›´æ¥å¼•ç”¨äº†æ–¹æ³•ä¸­çš„åŒåå‚æ•°ã€‚è¿™ä½¿å¾— Spring Security èƒ½å¤Ÿæ£€æŸ¥ä¼ å…¥æ–¹æ³•çš„å‚æ•°ï¼Œå¹¶å°†è¿™äº›å‚æ•°ç”¨äºè®¤è¯å†³ç­–çš„åˆ¶å®šã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ·±å…¥åˆ° Spitter çš„æ–‡æœ¬å†…å®¹ä¸­ï¼Œä¿è¯ä¸è¶…è¿‡ Spittr æ ‡å‡†ç”¨æˆ·çš„é•¿åº¦é™åˆ¶ã€‚å¦‚æœæ˜¯ä»˜è´¹ç”¨æˆ·ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰é•¿åº¦é™åˆ¶äº†ã€‚</p>
<p>åœ¨æ–¹æ³•è°ƒç”¨ä¹‹åéªŒè¯æƒé™</p>
<p>åœ¨æ–¹æ³•è°ƒç”¨ä¹‹åéªŒè¯æƒé™å¹¶ä¸æ˜¯æ¯”è¾ƒå¸¸è§çš„æ–¹å¼ã€‚äº‹åéªŒè¯ä¸€èˆ¬éœ€è¦åŸºäºå®‰å…¨ä¿æŠ¤æ–¹æ³•çš„è¿”å›å€¼æ¥è¿›è¡Œå®‰å…¨æ€§å†³ç­–ã€‚è¿™ç§æƒ…å†µæ„å‘³ç€æ–¹æ³•å¿…é¡»è¢«è°ƒç”¨æ‰§è¡Œå¹¶ä¸”å¾—åˆ°äº†è¿”å›å€¼ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³å¯¹ getSpittleById() æ–¹æ³•è¿›è¡Œä¿æŠ¤ï¼Œç¡®ä¿è¿”å›çš„ Spittle å¯¹è±¡å±äºå½“å‰çš„è®¤è¯ç”¨æˆ·ã€‚æˆ‘ä»¬åªæœ‰å¾—åˆ° Spittle å¯¹è±¡ä¹‹åï¼Œæ‰èƒ½åˆ¤æ–­å®ƒæ˜¯å¦å±äºå½“å‰ç”¨æˆ·ã€‚å› æ­¤ï¼ŒgetSpittleById() æ–¹æ³•å¿…é¡»è¦å…ˆæ‰§è¡Œã€‚åœ¨å¾—åˆ° Spittle ä¹‹åï¼Œå¦‚æœå®ƒä¸å±äºå½“å‰ç”¨æˆ·çš„è¯ï¼Œå°†ä¼šæŠ›å‡ºå®‰å…¨æ€§å¼‚å¸¸ã€‚</p>
<p>é™¤äº†éªŒè¯çš„æ—¶æœºä¹‹å¤–ï¼Œ@PostAuthorize ä¸ @PreAuthorize çš„å·¥ä½œæ–¹å¼å·®ä¸å¤šï¼Œåªä¸è¿‡å®ƒä¼šåœ¨æ–¹æ³•æ‰§è¡Œä¹‹åï¼Œæ‰ä¼šåº”ç”¨å®‰å…¨è§„åˆ™ã€‚æ­¤æ—¶ï¼Œå®ƒæ‰æœ‰æœºä¼šåœ¨åšå‡ºå®‰å…¨å†³ç­–æ—¶ï¼Œè€ƒè™‘åˆ°è¿”å›å€¼çš„å› ç´ ã€‚ä¾‹å¦‚ï¼Œè¦ä¿æŠ¤ä¸Šé¢æè¿°çš„ getSpittleById() æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼ä½¿ç”¨ @PostAuthorize æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostAuthorize(&quot;returnObject.spitter.username == principal.username&quot;)</span><span class="function"><span class="keyword">public</span> Spittle <span class="title">getSpittleById</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;  <span class="comment">// ...&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†ä¾¿åˆ©åœ°è®¿é—®å—ä¿æŠ¤æ–¹æ³•çš„è¿”å›å¯¹è±¡ï¼ŒSpring Security åœ¨ SpEL ä¸­æä¾›äº†åä¸º returnObject çš„å˜é‡ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çŸ¥é“è¿”å›å¯¹è±¡æ˜¯ä¸€ä¸ª Spittle å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªè¡¨è¾¾å¼å¯ä»¥ç›´æ¥è®¿é—®å…¶ spittle å±æ€§ä¸­çš„ username å±æ€§ã€‚</p>
<p>åœ¨å¯¹æ¯”è¡¨è¾¾å¼åŒç­‰å·çš„å¦ä¸€ä¾§ï¼Œè¡¨è¾¾å¼åˆ°å†…ç½®çš„ principal å¯¹è±¡ä¸­å–å‡ºå…¶ username å±æ€§ã€‚principal æ˜¯å¦ä¸€ä¸ª Spring Security å†…ç½®çš„ç‰¹æ®Šåç§°ï¼Œå®ƒä»£è¡¨äº†å½“å‰è®¤è¯ç”¨æˆ·çš„ä¸»è¦ä¿¡æ¯ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·åï¼‰ã€‚</p>
<p>åœ¨ Spittle å¯¹è±¡æ‰€åŒ…å« Spitter ä¸­ï¼Œå¦‚æœ username å±æ€§ä¸ principal çš„ username å±æ€§ç›¸åŒï¼Œè¿™ä¸ª Spittle å°†è¿”å›ç»™è°ƒç”¨è€…ã€‚å¦åˆ™ï¼Œä¼šæŠ›å‡ºä¸€ä¸ª AccessDeniedException å¼‚å¸¸ï¼Œè€Œè°ƒç”¨è€…ä¹Ÿä¸ä¼šå¾—åˆ° Spittle å¯¹è±¡ã€‚</p>
<p>æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œä¸åƒ @PreAuthorize æ³¨è§£æ‰€æ ‡æ³¨çš„æ–¹æ³•é‚£æ ·ï¼Œ@PostAuthorize æ³¨è§£çš„æ–¹æ³•ä¼šé¦–å…ˆæ‰§è¡Œç„¶åè¢«æ‹¦æˆªã€‚è¿™æ„å‘³ç€ï¼Œä½ éœ€è¦å°å¿ƒä»¥ä¿è¯å¦‚æœéªŒè¯å¤±è´¥çš„è¯ä¸ä¼šæœ‰ä¸€äº›è´Ÿé¢çš„ç»“æœã€‚</p>
<h4 id="è¿‡æ»¤æ–¹æ³•çš„è¾“å…¥å’Œè¾“å‡º"><a href="#è¿‡æ»¤æ–¹æ³•çš„è¾“å…¥å’Œè¾“å‡º" class="headerlink" title="è¿‡æ»¤æ–¹æ³•çš„è¾“å…¥å’Œè¾“å‡º"></a>è¿‡æ»¤æ–¹æ³•çš„è¾“å…¥å’Œè¾“å‡º</h4><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨è¡¨è¾¾å¼æ¥ä¿æŠ¤æ–¹æ³•çš„è¯ï¼Œé‚£ä½¿ç”¨ @PreAuthorize å’Œ @PostAuthorize æ˜¯éå¸¸å¥½çš„æ–¹æ¡ˆã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶å€™é™åˆ¶æ–¹æ³•è°ƒç”¨å¤ªä¸¥æ ¼äº†ã€‚æœ‰æ—¶ï¼Œéœ€è¦ä¿æŠ¤çš„å¹¶ä¸æ˜¯å¯¹æ–¹æ³•çš„è°ƒç”¨ï¼Œéœ€è¦ä¿æŠ¤çš„æ˜¯ä¼ å…¥æ–¹æ³•çš„æ•°æ®å’Œæ–¹æ³•è¿”å›çš„æ•°æ®ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º getOffensiveSpittles() çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¿”å›æ ‡è®°ä¸ºå…·æœ‰æ”»å‡»æ€§çš„ Spittle åˆ—è¡¨ã€‚è¿™ä¸ªæ–¹æ³•ä¸»è¦ä¼šç»™ç®¡ç†å‘˜ä½¿ç”¨ï¼Œä»¥ä¿è¯ Spittr åº”ç”¨ä¸­å†…å®¹çš„å’Œè°ã€‚ä½†æ˜¯ï¼Œæ™®é€šç”¨æˆ·ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œç”¨æ¥æŸ¥çœ‹ä»–ä»¬æ‰€å‘å¸ƒçš„ Spittle æœ‰æ²¡æœ‰è¢«æ ‡è®°ä¸ºå…·æœ‰æ”»å‡»æ€§ã€‚è¿™ä¸ªæ–¹æ³•çš„ç­¾åå¤§è‡´å¦‚ä¸‹æ‰€ç¤ºï¼›</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Spittle&gt; <span class="title">getOffensiveSpittles</span><span class="params">()</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p>æŒ‰ç…§è¿™ç§æ–¹æ³•çš„å®šä¹‰ï¼ŒgetOffensiveSpittles() æ–¹æ³•ä¸å…·ä½“çš„ç”¨æˆ·å¹¶æ²¡æœ‰å…³è”ã€‚å®ƒåªä¼šè¿”å›æ”»å‡»æ€§ Spittle çš„ä¸€ä¸ªåˆ—è¡¨ï¼Œå¹¶ä¸å…³å¿ƒå®ƒä»¬å±äºå“ªä¸ªç”¨æˆ·ã€‚å¯¹äºç®¡ç†å‘˜ä½¿ç”¨æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•ï¼Œä½†æ˜¯å®ƒæ— æ³•é™åˆ¶åˆ—è¡¨ä¸­çš„ Spittle éƒ½å±äºå½“å‰ç”¨æˆ·ã€‚</p>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é‡è½½ getOffensiveSpittles()ï¼Œå®ç°å¦ä¸€ä¸ªç‰ˆæœ¬ï¼Œè®©å®ƒæ¥å—ä¸€ä¸ªç”¨æˆ· ID ä½œä¸ºå‚æ•°ï¼ŒæŸ¥è¯¢ç»™å®šç”¨æˆ·çš„ Spittleã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘åœ¨æœ¬ç« å¼€å¤´æ‰€è®²çš„é‚£æ ·ï¼Œå§‹ç»ˆä¼šæœ‰è¿™æ ·çš„å¯èƒ½æ€§ï¼Œé‚£å°±æ˜¯å°†è¾ƒä¸ºå®½æ¾é™åˆ¶çš„ç‰ˆæœ¬ç”¨åœ¨å…·æœ‰ä¸€å®šå®‰å…¨é™åˆ¶çš„åœºæ™¯ä¸­ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦æœ‰ä¸€ç§æ–¹å¼è¿‡æ»¤ getOffensiveSpittles() æ–¹æ³•è¿”å›çš„Spittleé›†åˆï¼Œå°†ç»“æœé™åˆ¶ä¸ºå…è®¸å½“å‰ç”¨æˆ·çœ‹åˆ°çš„å†…å®¹ï¼Œè€Œè¿™å°±æ˜¯ Spring Security çš„ @PostFilter æ‰€èƒ½åšçš„äº‹æƒ…ã€‚æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹ã€‚</p>
<p>äº‹åå¯¹æ–¹æ³•çš„è¿”å›å€¼è¿›è¡Œè¿‡æ»¤</p>
<p>ä¸ @PreAuthorize å’Œ @PostAuthorize ç±»ä¼¼ï¼Œ@PostFilter ä¹Ÿä½¿ç”¨ä¸€ä¸ª SpEL ä½œä¸ºå€¼å‚æ•°ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªè¡¨è¾¾å¼ä¸æ˜¯ç”¨æ¥é™åˆ¶æ–¹æ³•è®¿é—®çš„ï¼Œ@PostFilter ä¼šä½¿ç”¨è¿™ä¸ªè¡¨è¾¾å¼è®¡ç®—è¯¥æ–¹æ³•æ‰€è¿”å›é›†åˆçš„æ¯ä¸ªæˆå‘˜ï¼Œå°†è®¡ç®—ç»“æœä¸º false çš„æˆå‘˜ç§»é™¤æ‰ã€‚</p>
<p>ä¸ºäº†é˜è¿°è¯¥åŠŸèƒ½ï¼Œæˆ‘ä»¬å°† @PostFilter åº”ç”¨åœ¨ getOffensiveSpittles() æ–¹æ³•ä¸Šï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize(&quot;hasRole(&#123;&#x27;ROLE_SPITTER&#x27;, &#x27;ROLE_ADMIN&#x27;&#125;)&quot;)</span><span class="meta">@PostFilter(&quot;hasRole(&#x27;ROLE_ADMIN&#x27;) || filterObject.spitter.username == principal.username&quot;)</span><span class="function"><span class="keyword">public</span> List&lt;Spittle&gt; <span class="title">getOffensiveSpittles</span><span class="params">()</span> </span>&#123;  ...&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œ@PreAuthorize é™åˆ¶åªæœ‰å…·å¤‡ ROLE_SPITTER æˆ– ROLE_ADMIN æƒé™çš„ç”¨æˆ·æ‰èƒ½è®¿é—®è¯¥æ–¹æ³•ã€‚å¦‚æœç”¨æˆ·èƒ½å¤Ÿé€šè¿‡è¿™ä¸ªæ£€æŸ¥ç‚¹ï¼Œé‚£ä¹ˆæ–¹æ³•å°†ä¼šæ‰§è¡Œï¼Œå¹¶ä¸”ä¼šè¿”å› Spittle æ‰€ç»„æˆçš„ä¸€ä¸ª Listã€‚ä½†æ˜¯ï¼Œ@PostFilter æ³¨è§£å°†ä¼šè¿‡æ»¤è¿™ä¸ªåˆ—è¡¨ï¼Œç¡®ä¿ç”¨æˆ·åªèƒ½çœ‹åˆ°å…è®¸çš„ Spittleã€‚å…·ä½“æ¥è®²ï¼Œç®¡ç†å‘˜èƒ½å¤Ÿçœ‹åˆ°æ‰€æœ‰æ”»å‡»æ€§çš„ Spittleï¼Œéç®¡ç†å‘˜åªèƒ½çœ‹åˆ°å±äºè‡ªå·±çš„ Spittleã€‚</p>
<p>è¡¨è¾¾å¼ä¸­çš„ filterObject å¯¹è±¡å¼•ç”¨çš„æ˜¯è¿™ä¸ªæ–¹æ³•æ‰€è¿”å›Listä¸­çš„æŸä¸€ä¸ªå…ƒç´ ï¼ˆæˆ‘ä»¬çŸ¥é“å®ƒæ˜¯ä¸€ä¸ª Spittleï¼‰ã€‚åœ¨è¿™ä¸ª Spittle å¯¹è±¡ä¸­ï¼Œå¦‚æœ Spitter çš„ç”¨æˆ·åä¸è®¤è¯ç”¨æˆ·ï¼ˆè¡¨è¾¾å¼ä¸­çš„ principal.nameï¼‰ç›¸åŒæˆ–è€…ç”¨æˆ·å…·æœ‰ ROLE_ADMIN è§’è‰²ï¼Œé‚£è¿™ä¸ªå…ƒç´ å°†ä¼šæœ€ç»ˆåŒ…å«åœ¨è¿‡æ»¤åçš„åˆ—è¡¨ä¸­ã€‚å¦åˆ™ï¼Œå®ƒå°†è¢«è¿‡æ»¤æ‰ã€‚</p>
<p>äº‹å…ˆå¯¹æ–¹æ³•çš„å‚æ•°è¿›è¡Œè¿‡æ»¤</p>
<p>é™¤äº†äº‹åè¿‡æ»¤æ–¹æ³•çš„è¿”å›å€¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é¢„å…ˆè¿‡æ»¤ä¼ å…¥åˆ°æ–¹æ³•ä¸­çš„å€¼ã€‚è¿™é¡¹æŠ€æœ¯ä¸å¤ªå¸¸ç”¨ï¼Œä½†æ˜¯åœ¨æœ‰äº›åœºæ™¯ä¸‹å¯èƒ½ä¼šå¾ˆä¾¿åˆ©ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬å¸Œæœ›ä»¥æ‰¹å¤„ç†çš„æ–¹å¼åˆ é™¤Spittleç»„æˆçš„åˆ—è¡¨ã€‚ä¸ºäº†å®Œæˆè¯¥åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå…¶ç­¾åå¤§è‡´å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteSpittles</span><span class="params">(List&lt;Spittle&gt; spittles)</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œå¯¹å§ï¼Ÿä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨å®ƒä¸Šé¢åº”ç”¨ä¸€äº›å®‰å…¨è§„åˆ™çš„è¯ï¼Œæ¯”å¦‚ Spittle åªèƒ½ç”±å…¶æ‰€æœ‰è€…æˆ–ç®¡ç†å‘˜åˆ é™¤ï¼Œé‚£è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†é€»è¾‘æ”¾åœ¨ deleteSpittles() æ–¹æ³•ä¸­ï¼Œåœ¨è¿™é‡Œå¾ªç¯åˆ—è¡¨ä¸­çš„ Spittleï¼Œåªåˆ é™¤å±äºå½“å‰ç”¨æˆ·çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡ï¼ˆå¦‚æœå½“å‰ç”¨æˆ·æ˜¯ç®¡ç†å‘˜çš„è¯ï¼Œåˆ™ä¼šå…¨éƒ¨åˆ é™¤ï¼‰ã€‚</p>
<p>è¿™èƒ½å¤Ÿè¿è¡Œæ­£å¸¸ï¼Œä½†æ˜¯è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦å°†å®‰å…¨é€»è¾‘ç›´æ¥åµŒå…¥åˆ°æ–¹æ³•ä¹‹ä¸­ã€‚ç›¸å¯¹äºåˆ é™¤ Spittle æ¥è®²ï¼Œå®‰å…¨é€»è¾‘æ˜¯ç‹¬ç«‹çš„å…³æ³¨ç‚¹ï¼ˆå½“ç„¶ï¼Œå®ƒä»¬ä¹Ÿæœ‰æ‰€å…³è”ï¼‰ã€‚å¦‚æœåˆ—è¡¨ä¸­èƒ½å¤ŸåªåŒ…å«å®é™…è¦åˆ é™¤çš„ Spittleï¼Œè¿™æ ·ä¼šæ›´å¥½ä¸€äº›ï¼Œå› ä¸ºè¿™èƒ½å¸®åŠ© deleteSpittles() æ–¹æ³•ä¸­çš„é€»è¾‘æ›´åŠ ç®€å•ï¼Œåªå…³æ³¨äºåˆ é™¤ Spittle çš„ä»»åŠ¡ã€‚</p>
<p>Spring Security çš„ @PreFilter æ³¨è§£èƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä¸ @PostFilter éå¸¸ç±»ä¼¼ï¼Œ@PreFilter ä¹Ÿä½¿ç”¨ SpEL æ¥è¿‡æ»¤é›†åˆï¼Œåªæœ‰æ»¡è¶³ SpEL è¡¨è¾¾å¼çš„å…ƒç´ æ‰ä¼šç•™åœ¨é›†åˆä¸­ã€‚ä½†æ˜¯å®ƒæ‰€è¿‡æ»¤çš„ä¸æ˜¯æ–¹æ³•çš„è¿”å›å€¼ï¼Œ@PreFilter è¿‡æ»¤çš„æ˜¯è¦è¿›å…¥æ–¹æ³•ä¸­çš„é›†åˆæˆå‘˜ã€‚</p>
<p>@PreFilter çš„ä½¿ç”¨éå¸¸ç®€å•ã€‚å¦‚ä¸‹çš„ deleteSpittles() æ–¹æ³•ä½¿ç”¨äº† @PreFilter æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize(&quot;hasRole(&#123;&#x27;ROLE_SPITTER&#x27;, &#x27;ROLE_ADMIN&#x27;&#125;)&quot;)</span><span class="meta">@PostFilter(&quot;hasRole(&#x27;ROLE_ADMIN&#x27;) || filterObject.spitter.username == principal.username&quot;)</span><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteSpittles</span><span class="params">(List&lt;Spittle&gt; spittles)</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸å‰é¢ä¸€æ ·ï¼Œå¯¹äºæ²¡æœ‰ ROLE_SPITTER æˆ– ROLE_ADMIN æƒé™çš„ç”¨æˆ·ï¼Œ@PreAuthorize æ³¨è§£ä¼šé˜»æ­¢å¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ã€‚ä½†åŒæ—¶ï¼Œ@PreFilter æ³¨è§£èƒ½å¤Ÿä¿è¯ä¼ é€’ç»™ deleteSpittles() æ–¹æ³•çš„åˆ—è¡¨ä¸­ï¼ŒåªåŒ…å«å½“å‰ç”¨æˆ·æœ‰æƒé™åˆ é™¤çš„ Spittleã€‚è¿™ä¸ªè¡¨è¾¾å¼ä¼šé’ˆå¯¹é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œè®¡ç®—ï¼Œåªæœ‰è¡¨è¾¾å¼è®¡ç®—ç»“æœä¸º true çš„å…ƒç´ æ‰ä¼šä¿ç•™åœ¨åˆ—è¡¨ä¸­ã€‚targetObject æ˜¯ Spring Security æä¾›çš„å¦å¤–ä¸€ä¸ªå€¼ï¼Œå®ƒä»£è¡¨äº†è¦è¿›è¡Œè®¡ç®—çš„å½“å‰åˆ—è¡¨å…ƒç´ ã€‚</p>
<p>Spring Security æä¾›äº†æ³¨è§£é©±åŠ¨çš„åŠŸèƒ½ï¼Œè¿™æ˜¯é€šè¿‡ä¸€ç³»åˆ—æ³¨è§£æ¥å®ç°çš„ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å¯¹è¿™äº›æ³¨è§£è¿›è¡Œäº†ä»‹ç»ã€‚ç›¸å¯¹äºåˆ¤æ–­ç”¨æˆ·æ‰€æˆäºˆçš„æƒé™ï¼Œä½¿ç”¨è¡¨è¾¾å¼æ¥å®šä¹‰å®‰å…¨é™åˆ¶æ˜¯ä¸€ç§æ›´ä¸ºå¼ºå¤§çš„æ–¹å¼ã€‚</p>
<p>å³ä¾¿å¦‚æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿä¸åº”è¯¥è®©è¡¨è¾¾å¼è¿‡äºèªæ˜æ™ºèƒ½ã€‚æˆ‘ä»¬åº”è¯¥é¿å…ç¼–å†™éå¸¸å¤æ‚çš„å®‰å…¨è¡¨è¾¾å¼ï¼Œæˆ–è€…åœ¨è¡¨è¾¾å¼ä¸­åµŒå…¥å¤ªå¤šä¸å®‰å…¨æ— å…³çš„ä¸šåŠ¡é€»è¾‘ã€‚è€Œä¸”ï¼Œè¡¨è¾¾å¼æœ€ç»ˆåªæ˜¯ä¸€ä¸ªè®¾ç½®ç»™æ³¨è§£çš„ String å€¼ï¼Œå› æ­¤å®ƒå¾ˆéš¾æµ‹è¯•å’Œè°ƒè¯•ã€‚</p>
<p>å¦‚æœä½ è§‰å¾—è‡ªå·±çš„å®‰å…¨è¡¨è¾¾å¼éš¾ä»¥æ§åˆ¶äº†ï¼Œé‚£ä¹ˆå°±åº”è¯¥çœ‹ä¸€ä¸‹å¦‚ä½•ç¼–å†™è‡ªå®šä¹‰çš„è®¸å¯è®¡ç®—å™¨ï¼ˆpermission evaluatorï¼‰ï¼Œä»¥ç®€åŒ–ä½ çš„ SpEL è¡¨è¾¾å¼ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ç¼–å†™è‡ªå®šä¹‰çš„è®¸å¯è®¡ç®—å™¨ï¼Œç”¨å®ƒæ¥ç®€åŒ–ä¹‹å‰ç”¨äºè¿‡æ»¤çš„è¡¨è¾¾å¼ã€‚</p>
<p>å®šä¹‰è®¸å¯è®¡ç®—å™¨</p>
<p>æˆ‘ä»¬åœ¨ @PreFilter å’Œ @PostFilter ä¸­æ‰€ä½¿ç”¨çš„è¡¨è¾¾å¼è¿˜ç®—ä¸ä¸Šå¤ªå¤æ‚ã€‚ä½†æ˜¯ï¼Œå®ƒä¹Ÿå¹¶ä¸ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æƒ³è±¡å¦‚æœè¿˜è¦å®ç°å…¶ä»–çš„å®‰å…¨è§„åˆ™ï¼Œè¿™ä¸ªè¡¨è¾¾å¼ä¼šä¸æ–­è†¨èƒ€ã€‚åœ¨å˜å¾—å¾ˆé•¿ä¹‹å‰ï¼Œè¡¨è¾¾å¼å°±ä¼šç¬¨é‡ã€å¤æ‚ä¸”éš¾ä»¥æµ‹è¯•ã€‚</p>
<p>å…¶å®æˆ‘ä»¬èƒ½å¤Ÿå°†æ•´ä¸ªè¡¨è¾¾å¼æ›¿æ¢ä¸ºæ›´åŠ ç®€å•çš„ç‰ˆæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize(&quot;hasRole(&#123;&#x27;ROLE_SPITTER&#x27;, &#x27;ROLE_ADMIN&#x27;&#125;)&quot;)</span><span class="meta">@PreFilter(&quot;hasPermission(targetObject, &#x27;delete&#x27;)&quot;)</span><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteSpittles</span><span class="params">(List&lt;Spittle&gt; spittles)</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œè®¾ç½®ç»™ @PreFilter çš„è¡¨è¾¾å¼æ›´åŠ ç´§å‡‘ã€‚å®ƒå®é™…ä¸Šåªæ˜¯åœ¨é—®ä¸€ä¸ªé—®é¢˜â€œç”¨æˆ·æœ‰æƒé™åˆ é™¤ç›®æ ‡å¯¹è±¡å—ï¼Ÿâ€ã€‚å¦‚æœæœ‰çš„è¯ï¼Œè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœä¸º trueï¼ŒSpittle ä¼šä¿å­˜åœ¨åˆ—è¡¨ä¸­ï¼Œå¹¶ä¼ é€’ç»™ deleteSpittles() æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰æƒé™çš„è¯ï¼Œå®ƒå°†ä¼šè¢«ç§»é™¤æ‰ã€‚</p>
<p>ä½†æ˜¯ï¼ŒhasPermission() æ˜¯å“ªæ¥çš„å‘¢ï¼Ÿå®ƒçš„æ„æ€æ˜¯ä»€ä¹ˆï¼Ÿæ›´ä¸ºé‡è¦çš„æ˜¯ï¼Œå®ƒå¦‚ä½•çŸ¥é“ç”¨æˆ·æœ‰æ²¡æœ‰æƒé™åˆ é™¤ targetObject æ‰€å¯¹åº”çš„ Spittle å‘¢ï¼Ÿ</p>
<p>hasPermission() å‡½æ•°æ˜¯ Spring Security ä¸º SpEL æä¾›çš„æ‰©å±•ï¼Œå®ƒä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªæ—¶æœºï¼Œèƒ½å¤Ÿåœ¨æ‰§è¡Œè®¡ç®—çš„æ—¶å€™æ’å…¥ä»»æ„çš„é€»è¾‘ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯ç¼–å†™å¹¶æ³¨å†Œä¸€ä¸ªè‡ªå®šä¹‰çš„è®¸å¯è®¡ç®—å™¨ã€‚ç¨‹åºæ¸…å• 14.1 å±•ç°äº† SpittlePermissionEvaluator ç±»ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„è®¸å¯è®¡ç®—å™¨ï¼ŒåŒ…å«äº†è¡¨è¾¾å¼é€»è¾‘ã€‚</p>
<center>ç¨‹åºæ¸…å• 14.1ã€€è®¸å¯è®¡ç®—å™¨ä¸º hasPermission() æä¾›å®ç°é€»è¾‘</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.security;<span class="keyword">import</span> java.io.Serializable;<span class="keyword">import</span> org.springframework.security.access.PermissionEvaluator;<span class="keyword">import</span> org.springframework.security.core.Authentication;<span class="keyword">import</span> spittr.Spittle;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpittlePermissionEvaluator</span> <span class="keyword">implements</span> <span class="title">PermissionEvaluator</span> </span>&#123;    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> GrantedAuthority ADMIN_AUTHORITY =        <span class="keyword">new</span> GrantedAuthoritylmpl(<span class="string">&quot;ROLE_ADMIN&quot;</span>);    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasPermission</span><span class="params">(Authentication authentication, Object target, Object permission)</span> </span>&#123;                <span class="keyword">if</span> (target <span class="keyword">instanceof</span> Spittle) &#123;            Spittle spittle = (Spittle) target;            String username = spittle.getSpitter().getUsername();            <span class="keyword">if</span> (<span class="string">&quot;delete&quot;</span>.equals(permission)) &#123;                <span class="keyword">return</span> isAdmin(authentication) || username.equals(authentication.getName());            &#125;        &#125;        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(            <span class="string">&quot;hasPermission not supported for object &lt;&quot;</span> + target            + <span class="string">&quot;&gt; and permission &lt;&quot;</span> + permission + <span class="string">&quot;&gt;&quot;</span>);    &#125;      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasPermission</span><span class="params">(Authentication authentication, Serializable targetId,                                 String targetType, Object permission)</span> </span>&#123;                <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();    &#125;      <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isAdmin</span><span class="params">(Authentication authentication)</span> </span>&#123;        <span class="keyword">return</span> authentication.getAuthorities().contains(ADMIN_AUTHORITY);    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>SpittlePermissionEvaluator å®ç°äº† Spring Security çš„ PermissionEvaluator æ¥å£ï¼Œå®ƒéœ€è¦å®ç°ä¸¤ä¸ªä¸åŒçš„ hasPermission() æ–¹æ³•ã€‚å…¶ä¸­çš„ä¸€ä¸ª hasPermission() æ–¹æ³•æŠŠè¦è¯„ä¼°çš„å¯¹è±¡ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚ç¬¬äºŒä¸ª hasPermission() æ–¹æ³•åœ¨åªæœ‰ç›®æ ‡å¯¹è±¡çš„ ID å¯ä»¥å¾—åˆ°çš„æ—¶å€™æ‰æœ‰ç”¨ï¼Œå¹¶å°† IDä½œ ä¸º Serializable ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<p>ä¸ºäº†æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å‡è®¾ä½¿ç”¨ Spittle å¯¹è±¡æ¥è¯„ä¼°æƒé™ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªæ–¹æ³•åªæ˜¯ç®€å•åœ°æŠ›å‡º UnsupportedOperationExceptionã€‚</p>
<p>å¯¹äºç¬¬ä¸€ä¸ª hasPermission() æ–¹æ³•ï¼Œè¦æ£€æŸ¥æ‰€è¯„ä¼°çš„å¯¹è±¡æ˜¯å¦ä¸ºä¸€ä¸ª Spittleï¼Œå¹¶åˆ¤æ–­æ‰€æ£€æŸ¥çš„æ˜¯å¦ä¸ºåˆ é™¤æƒé™ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œå®ƒå°†å¯¹æ¯” Spitter çš„ç”¨æˆ·åæ˜¯å¦ä¸è®¤è¯ç”¨æˆ·çš„åç§°ç›¸ç­‰ï¼Œæˆ–è€…å½“å‰ç”¨æˆ·æ˜¯å¦å…·æœ‰ ROLE_ADMIN æƒé™ã€‚</p>
<p>è®¸å¯è®¡ç®—å™¨å·²ç»å‡†å¤‡å°±ç»ªï¼Œæ¥ä¸‹æ¥éœ€è¦å°†å…¶æ³¨å†Œåˆ° Spring Security ä¸­ï¼Œä»¥ä¾¿åœ¨ä½¿ç”¨ @PreFilter è¡¨è¾¾å¼çš„æ—¶å€™æ”¯æŒ hasPermission() æ“ä½œã€‚ä¸ºäº†å®ç°è¯¥åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦æ›¿æ¢åŸæœ‰çš„è¡¨è¾¾å¼å¤„ç†å™¨ï¼Œæ¢æˆä½¿ç”¨è‡ªå®šä¹‰è®¸å¯è®¡ç®—å™¨çš„å¤„ç†å™¨ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Security ä¼šé…ç½®ä¸ºä½¿ç”¨ DefaultMethodSecurityExpressionHandlerï¼Œå®ƒä¼šä½¿ç”¨ä¸€ä¸ª DenyAllPermissionEvaluator å®ä¾‹ã€‚é¡¾åæ€ä¹‰ï¼Œ DenyAllPermissionEvaluator å°†ä¼šåœ¨ hasPermission() æ–¹æ³•ä¸­å§‹ç»ˆè¿”å› falseï¼Œæ‹’ç»æ‰€æœ‰çš„æ–¹æ³•è®¿é—®ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º Spring Security æä¾›å¦å¤–ä¸€ä¸ª DefaultMethodSecurityExpressionHandlerï¼Œè®©å®ƒä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„ SpittlePermissionEvaluatorï¼Œè¿™éœ€è¦é‡è½½ GlobalMethodSecurityConfiguration çš„ createExpressionHandler æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function">MethodSecurityExpressionHandler <span class="title">createExpressionHandler</span><span class="params">()</span> </span>&#123;  DefaultMethodSecurityExpressionHandler expressionHandler =    <span class="keyword">new</span> DefaultMethodSecurityExpressionHandler();  expressionHandler.setPermissionEvaluator(<span class="keyword">new</span> SpittlePermissionEvaluator());  <span class="keyword">return</span> expressionHandler;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¸ç®¡åœ¨ä»»ä½•åœ°æ–¹çš„è¡¨è¾¾å¼ä¸­ä½¿ç”¨ hasPermission() æ¥ä¿æŠ¤æ–¹æ³•ï¼Œéƒ½ä¼šè°ƒç”¨ SpittlePermissionEvaluator æ¥å†³å®šç”¨æˆ·æ˜¯å¦æœ‰æƒé™è°ƒç”¨æ–¹æ³•ã€‚</p>
<h3 id="å°ç»“-13"><a href="#å°ç»“-13" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>æ–¹æ³•çº§åˆ«çš„å®‰å…¨æ€§æ˜¯ Spring Security Web çº§åˆ«å®‰å…¨æ€§çš„ä¸€ä¸ªé‡è¦è¡¥å……ï¼Œæˆ‘ä»¬æ›¾åœ¨ç¬¬ 9 ç« è®¨è®ºè¿‡ Web å®‰å…¨æ€§ã€‚å¯¹äºé Web åº”ç”¨æ¥è¯´ï¼Œæ–¹æ³•çº§åˆ«çš„å®‰å…¨æ€§åˆ™æ˜¯æœ€å‰æ²¿çš„é˜²æŠ¤ã€‚å¯¹äº Web åº”ç”¨æ¥è®²ï¼ŒåŸºäºå®‰å…¨è§„åˆ™æ‰€å£°æ˜çš„æ–¹æ³•çº§åˆ«å®‰å…¨æ€§èƒ½å¤Ÿä¿æŠ¤ Web è¯·æ±‚ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å…­ä¸ªå¯ä»¥åœ¨æ–¹æ³•ä¸Šå£°æ˜å®‰å…¨æ€§é™åˆ¶çš„æ³¨è§£ã€‚å¯¹äºç®€å•åœºæ™¯æ¥è¯´ï¼Œé¢å‘æƒé™çš„æ³¨è§£ï¼ŒåŒ…æ‹¬ Spring Security çš„ @Secured ä»¥åŠåŸºäºæ ‡å‡†çš„ @RolesAllowed éƒ½å¾ˆä¾¿åˆ©ã€‚å½“å®‰å…¨è§„åˆ™æ›´ä¸ºå¤æ‚çš„æ—¶å€™ï¼Œç»„åˆä½¿ç”¨ @PreAuthorizeã€@PostAuthorize ä»¥åŠ SpEL èƒ½å¤Ÿå‘æŒ¥æ›´å¼ºå¤§çš„å¨åŠ›ã€‚æˆ‘ä»¬è¿˜çœ‹åˆ°é€šè¿‡ä¸º @PreFilter å’Œ @PostFilter æä¾› SpEL è¡¨è¾¾å¼ï¼Œè¿‡æ»¤æ–¹æ³•çš„è¾“å…¥å’Œè¾“å‡ºã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬è¿˜çœ‹åˆ°äº†è®©å®‰å…¨è§„åˆ™æ›´åŠ æ˜“äºç»´æŠ¤ã€æµ‹è¯•å’Œè°ƒè¯•çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯è‡ªå®šä¹‰è¡¨è¾¾å¼è®¡ç®—å™¨ï¼Œå®ƒèƒ½å¤Ÿç”¨åœ¨ SpEL è¡¨è¾¾å¼çš„ hasPermission() å‡½æ•°ä¸­ã€‚</p>
<p>ä»ä¸‹ä¸€ç« å¼€å§‹ï¼Œæˆ‘ä»¬å°†ä¼šè½¬ç§»æ–¹å‘ï¼Œä»ä½¿ç”¨ Spring å¼€å‘åç«¯åº”ç”¨ç¨‹åºè½¬å‘ä¸å…¶ä»–åº”ç”¨é›†æˆã€‚åœ¨æ¥ä¸‹æ¥çš„å‡ ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å„ç§é›†æˆæŠ€æœ¯ï¼ŒåŒ…æ‹¬è¿œç¨‹æœåŠ¡ã€å¼‚æ­¥æ¶ˆæ¯ã€REST ç”šè‡³è¿˜æœ‰å‘é€ E-mailã€‚åœ¨ä¸‹ä¸€ç« æˆ‘ä»¬å°†ä¼šæ¢è®¨ç¬¬ä¸€é¡¹é›†æˆæŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ Spring è¿œç¨‹æœåŠ¡ã€‚</p>
<h1 id="Spring-é›†æˆ"><a href="#Spring-é›†æˆ" class="headerlink" title="Spring é›†æˆ"></a>Spring é›†æˆ</h1><p>åº”ç”¨ç¨‹åºéƒ½ä¸æ˜¯å­¤å²›ã€‚å¦‚ä»Šï¼Œä¼ä¸šçº§åº”ç”¨ç¨‹åºå¿…é¡»è¦ä¸å…¶ä»–çš„ç³»ç»Ÿåä½œæ‰èƒ½å®Œæˆå…¶ç›®æ ‡ã€‚åœ¨ç¬¬ 4 éƒ¨åˆ†ï¼Œä½ å°†ä¼šå­¦åˆ°å¦‚ä½•è·¨è¶Šåº”ç”¨ç¨‹åºæœ¬èº«çš„è¾¹ç•Œï¼Œä¸å…¶ä»–çš„åº”ç”¨ç¨‹åºå’Œä¼ä¸šçº§æœåŠ¡å®ç°é›†æˆã€‚</p>
<p>åœ¨ç¬¬ 15 ç« â€œä½¿ç”¨è¿œç¨‹æœåŠ¡â€ä¸­ï¼Œä½ ä¼šå­¦åˆ°å¦‚ä½•å°†åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡å¯¼å‡ºä¸ºè¿œç¨‹æœåŠ¡ï¼Œè¿˜ä¼šå­¦ä¹ å¦‚ä½•é€æ˜åœ°è®¿é—®è¿œç¨‹æœåŠ¡ï¼Œè¿™äº›æœåŠ¡å°±åƒæ˜¯åº”ç”¨ç¨‹åºä¸­çš„å…¶ä»–å¯¹è±¡ä¸€æ ·ã€‚æˆ‘ä»¬å°†ä¼šä»‹ç»å„ç§è¿œç¨‹æŠ€æœ¯ï¼ŒåŒ…æ‹¬ RMIã€Hessian/Burlap ä»¥åŠä½¿ç”¨ JAX-WS çš„ SOAP Web æœåŠ¡ã€‚</p>
<p>ä¸ç¬¬ 15 ç« æ‰€ä»‹ç»çš„ RPC é£æ ¼çš„è¿œç¨‹æœåŠ¡ä¸åŒï¼Œç¬¬ 16 ç«  â€œä½¿ç”¨ Spring MVC åˆ›å»º REST APIâ€ å°†ä¼šæ¢è®¨å¦‚ä½•ä½¿ç”¨ Spring MVC æ„å»º RESTful æœåŠ¡ï¼Œå®ƒå…³æ³¨äºåº”ç”¨ç¨‹åºä¸­çš„èµ„æºã€‚</p>
<p>ç¬¬ 17 ç«  â€œSpring æ¶ˆæ¯â€ å°†ä¼šæ¢ç´¢ä¸€ç§ä¸åŒçš„åº”ç”¨é›†æˆæ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ Spring å¦‚ä½•ç”¨äº Java æ¶ˆæ¯æœåŠ¡ï¼ˆJava Message Serviceï¼ŒJMSï¼‰å’Œé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼ˆAdvanced Message Queuing Protocolï¼ŒAMQPï¼‰ï¼Œä»è€Œå®ç°åº”ç”¨ç¨‹åºä¹‹é—´çš„å¼‚æ­¥é€šä¿¡ã€‚</p>
<p>Web åº”ç”¨éœ€è¦è¶Šæ¥è¶Šå¤šçš„äº¤äº’æ€§ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒèƒ½å±•ç°å®æ—¶çš„æ•°æ®ã€‚ç¬¬ 18 ç«  â€œä½¿ç”¨ WebSocket å’Œ STOMP å®ç°æ¶ˆæ¯åŠŸèƒ½â€å°†ä¼šå±•ç° Spring çš„ä¸€é¡¹æ–°åŠŸèƒ½ï¼Œå®ƒæ”¯æŒåœ¨æœåŠ¡å™¨å’Œ Web å®¢æˆ·ç«¯ä¹‹é—´å®ç°å¼‚æ­¥é€šä¿¡ã€‚</p>
<p>å¦å¤–ä¸€ç§å½¢å¼çš„å¼‚æ­¥é€šä¿¡ä¸ä¸€å®šå‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºä¹‹é—´ã€‚åœ¨ç¬¬ 19 ç« â€œä½¿ç”¨ Spring å‘é€ Emailâ€ ä¸­ï¼Œå°†ä¼šå±•ç°å¦‚ä½•å€ŸåŠ© Spring ä»¥ Email çš„å½¢å¼å‘é€å¼‚æ­¥æ¶ˆæ¯ç»™ç›®æ ‡äººç¾¤ã€‚</p>
<p>ç®¡ç†å’Œç›‘æ§ Spring bean æ˜¯ç¬¬ 20 ç«  â€œä½¿ç”¨ JMX ç®¡ç† Spring Beanâ€ çš„ä¸»é¢˜ã€‚åœ¨è¯¥ç« ä¸­ï¼Œä½ ä¼šå­¦åˆ°å¦‚ä½•æŠŠé…ç½®åœ¨ Spring ä¸­ bean è‡ªåŠ¨å¯¼å‡ºä¸º JMXMBeanã€‚</p>
<p>æœ¬ä¹¦çš„ç»“å°¾æ˜¯å¾ˆæ–°ä½†æ˜¯å¾ˆå¿…è¦çš„å†…å®¹ã€‚ç¬¬ 21 ç«  â€œå€ŸåŠ© Spring Boot ç®€åŒ– Spring å¼€å‘â€ ä»‹ç»äº†åœ¨ Spring å¼€å‘ä¸­ä¸€ä¸ªä»¤äººå…´å¥‹ä¸”èƒ½å¤Ÿæ”¹å˜æ¸¸æˆè§„åˆ™çš„é¡¹ç›®ã€‚åœ¨å…¸å‹çš„ Spring åº”ç”¨ä¸­ï¼Œä¼šæœ‰å¾ˆå¤šç¹æ‚çš„æ ·æ¿å¼é…ç½®ï¼Œåœ¨è¿™ä¸€ç« å°†ä¼šçœ‹åˆ° Spring Boot å¦‚ä½•ç§»é™¤è¿™äº›é…ç½®ï¼Œèƒ½å¤Ÿè®©æˆ‘ä»¬å…³æ³¨äºä¸šåŠ¡åŠŸèƒ½çš„å®ç°ã€‚</p>
<h2 id="ä½¿ç”¨è¿œç¨‹æœåŠ¡"><a href="#ä½¿ç”¨è¿œç¨‹æœåŠ¡" class="headerlink" title="ä½¿ç”¨è¿œç¨‹æœåŠ¡"></a>ä½¿ç”¨è¿œç¨‹æœåŠ¡</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>è®¿é—®å’Œå‘å¸ƒ RMI æœåŠ¡</li>
<li>ä½¿ç”¨ Hessian å’Œ Burlap æœåŠ¡</li>
<li>ä½¿ç”¨ Spring çš„ HTTP invoker</li>
<li>ä½¿ç”¨ Spring å¼€å‘WebæœåŠ¡</li>
</ul>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬è¢«å›°åœ¨ä¸€ä¸ªè’å‡‰çš„å°å²›ä¸Šï¼Œè¿™å¬ä¸Šå»å°±åƒæ˜¯ä¸€åœºæ¢¦å¢ƒå˜æˆäº†ç°å®ã€‚æ¯•ç«Ÿï¼Œè°ä¸æƒ³åœ¨æµ·æ»©ä¸Šé™é™åœ°ç‹¬å¤„ï¼Œå¯ä»¥å¹¸ç¦åœ°ä¸é¡¾å¤–é¢ä¸–ç•Œçš„çº·çº·æ‰°æ‰°å‘¢ï¼Ÿ</p>
<p>ä½†æ˜¯åœ¨ä¸€ä¸ªè’å²›ä¸Šï¼Œæˆ‘ä»¬ä¸å¯èƒ½æ€»æ˜¯äº«å—å†°é•‡æœæ±æœ—å§†é…’å’Œæ—¥å…‰æµ´ï¼Œå°±ç®—æˆ‘ä»¬èƒ½äº«å—è¿™æ ·å®é™çš„éšå±…ç”Ÿæ´»ï¼Œä½†æ˜¯è¿‡ä¸äº†å¤šä¹…æˆ‘ä»¬å°±ä¼šæ„Ÿåˆ°é¥¥é¥¿ã€åŒçƒ¦å’Œå­¤ç‹¬ã€‚åœ¨è¿™æ ·çš„æ—¶å…‰é‡Œï¼Œæˆ‘ä»¬åªèƒ½ä»¥æ¤°å­å’Œç”¨å‰å­æ‰€æ•çš„é±¼ä¸ºç”Ÿã€‚æˆ‘ä»¬ç»ˆç©¶è¿˜æ˜¯éœ€è¦é£Ÿç‰©ã€æ–°çš„è¡£æœä»¥åŠå…¶ä»–ä¾›ç»™ã€‚è€Œä¸”å¦‚æœä¸èƒ½å’Œå…¶ä»–äººå–å¾—è”ç³»ï¼Œä¸ä¹…æˆ‘ä»¬å°±åªèƒ½å’Œæ’çƒè¯´è¯äº†ï¼</p>
<p>æˆ‘ä»¬å¼€å‘çš„å¾ˆå¤šåº”ç”¨å°±åƒè¢«é—å¼ƒçš„è’å²›ã€‚è¡¨é¢ä¸Šçœ‹ï¼Œå®ƒä»¬å¥½åƒèƒ½è‡ªç»™è‡ªè¶³ï¼Œä½†å®é™…ä¸Šï¼Œå®ƒä»¬å¯èƒ½è¿˜éœ€è¦å’Œå…¶ä»–ç³»ç»Ÿç›¸äº’åˆä½œï¼Œè¿™äº›ç³»ç»Ÿæ—¢åŒ…æ‹¬ç»„ç»‡å†…éƒ¨çš„ä¹ŸåŒ…æ‹¬ç»„ç»‡å¤–éƒ¨çš„ã€‚</p>
<p>ä¾‹å¦‚ï¼Œé‡‡è´­ç³»ç»Ÿéœ€è¦ä¸å‚å•†çš„ä¾›åº”é“¾ç³»ç»Ÿé€šä¿¡ï¼›å…¬å¸çš„äººåŠ›èµ„æºç³»ç»Ÿå¯èƒ½éœ€è¦é›†æˆè–ªé‡‘ç³»ç»Ÿï¼›æˆ–è€…ï¼Œè–ªé‡‘ç³»ç»Ÿéœ€è¦å’Œæ‰“å°ã€é‚®å¯„å·¥èµ„ç­‰å¤–éƒ¨ç³»ç»Ÿè¿›è¡Œé€šä¿¡ã€‚æ— è®ºå“ªç§æƒ…å†µï¼Œæˆ‘ä»¬çš„åº”ç”¨éƒ½éœ€è¦å’Œå…¶ä»–ç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œè¿œç¨‹è®¿é—®å®ƒä»¬çš„æœåŠ¡ã€‚</p>
<p>ä½œä¸ºä¸€ä¸ª Java å¼€å‘è€…ï¼Œæˆ‘ä»¬æœ‰å¤šç§å¯ä»¥ä½¿ç”¨çš„è¿œç¨‹è°ƒç”¨æŠ€æœ¯ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆRemote Method Invocationï¼ŒRMIï¼‰ï¼›</li>
<li>Caucho çš„ Hessian å’Œ Burlapï¼›</li>
<li>Spring åŸºäºHTTPçš„è¿œç¨‹æœåŠ¡ï¼›</li>
<li>ä½¿ç”¨ JAX-RPC å’Œ JAX-WS çš„ Web Serviceã€‚</li>
</ul>
<p>ä¸ç®¡æˆ‘ä»¬é€‰æ‹©å“ªç§è¿œç¨‹è°ƒç”¨æŠ€æœ¯ï¼ŒSpring ä¸ºä½¿ç”¨è¿™å‡ ç§ä¸åŒçš„æŠ€æœ¯è®¿é—®å’Œåˆ›å»ºè¿œç¨‹æœåŠ¡éƒ½æä¾›äº†å¹¿æ³›çš„æ”¯æŒã€‚åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬å°†å­¦ä¹  Spring å¦‚ä½•ç®€åŒ–å’Œå®Œå–„è¿™äº›è¿œç¨‹è°ƒç”¨æœåŠ¡ã€‚ä½†æ˜¯é¦–å…ˆï¼Œè®©æˆ‘ä»¬å…ˆç®€è¦äº†è§£ä¸€ä¸‹è¿œç¨‹è°ƒç”¨æ˜¯å¦‚ä½•åœ¨ Spring ä¸­å·¥ä½œçš„ã€‚</p>
<h3 id="Spring-è¿œç¨‹è°ƒç”¨æ¦‚è§ˆ"><a href="#Spring-è¿œç¨‹è°ƒç”¨æ¦‚è§ˆ" class="headerlink" title="Spring è¿œç¨‹è°ƒç”¨æ¦‚è§ˆ"></a>Spring è¿œç¨‹è°ƒç”¨æ¦‚è§ˆ</h3><p>è¿œç¨‹è°ƒç”¨æ˜¯å®¢æˆ·ç«¯åº”ç”¨å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„ä¼šè¯ã€‚åœ¨å®¢æˆ·ç«¯ï¼Œå®ƒæ‰€éœ€è¦çš„ä¸€äº›åŠŸèƒ½å¹¶ä¸åœ¨è¯¥åº”ç”¨çš„å®ç°èŒƒå›´ä¹‹å†…ï¼Œæ‰€ä»¥åº”ç”¨è¦å‘èƒ½æä¾›è¿™äº›åŠŸèƒ½çš„å…¶ä»–ç³»ç»Ÿå¯»æ±‚å¸®åŠ©ã€‚è€Œè¿œç¨‹åº”ç”¨é€šè¿‡è¿œç¨‹æœåŠ¡æš´éœ²è¿™äº›åŠŸèƒ½ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æƒ³æŠŠSpittråº”ç”¨ä¸­çš„æŸäº›åŠŸèƒ½å‘å¸ƒä¸ºè¿œç¨‹æœåŠ¡å¹¶æä¾›ç»™å…¶ä»–åº”ç”¨æ¥ä½¿ç”¨ã€‚æˆ–è®¸é™¤äº†ç°æœ‰çš„åŸºäºæµè§ˆå™¨çš„ç”¨æˆ·ç•Œé¢ï¼Œæˆ‘ä»¬è¿˜æƒ³ä¸ºSpittråº”ç”¨æä¾›æ¡Œé¢åº”ç”¨æˆ–ç§»åŠ¨ç«¯åº”ç”¨ï¼Œå¦‚å›¾15.1æ‰€ç¤ºã€‚ä¸ºäº†å®ç°æ­¤æƒ³æ³•ï¼Œæˆ‘ä»¬éœ€è¦æŠŠSpitterServiceæ¥å£çš„åŸºæœ¬åŠŸèƒ½å‘å¸ƒä¸ºè¿œç¨‹æœåŠ¡ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211110224117848.png" alt="image-20211110224117848"></p>
<p>å›¾15.1ã€€ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯èƒ½å¤Ÿè¿œç¨‹è°ƒç”¨Spittrçš„æœåŠ¡ï¼Œä»è€Œå®ç°ä¸Spittråº”ç”¨äº¤äº’</p>
<p>å…¶ä»–åº”ç”¨ä¸Spitträ¹‹é—´çš„ä¼šè¯å¼€å§‹äºå®¢æˆ·ç«¯åº”ç”¨çš„ä¸€ä¸ªè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆremote procedure callï¼ŒRPCï¼‰ã€‚ä»è¡¨é¢ä¸Šçœ‹ï¼ŒRPCç±»ä¼¼äºè°ƒç”¨ä¸€ä¸ªæœ¬åœ°å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ã€‚è¿™ä¸¤è€…éƒ½æ˜¯åŒæ­¥æ“ä½œï¼Œä¼šé˜»å¡è°ƒç”¨ä»£ç çš„æ‰§è¡Œï¼Œç›´åˆ°è¢«è°ƒç”¨çš„è¿‡ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚</p>
<p>å®ƒä»¬çš„å·®åˆ«ä»…ä»…æ˜¯è·ç¦»çš„é—®é¢˜ï¼Œç±»ä¼¼äºäººä¸äººä¹‹é—´çš„äº¤æµã€‚å¦‚æœæˆ‘ä»¬åœ¨å…¬å…±åœºæ‰€çš„é¥®æ°´æœºæ—è®¨è®ºå‘¨æœ«è¶³çƒæ¯”èµ›çš„ç»“æœï¼Œé‚£æˆ‘ä»¬å°±æ˜¯åœ¨è¿›è¡Œä¸€ä¸ªæœ¬åœ°ä¼šè¯â€”â€”ä¸¤äººä¹‹é—´çš„ä¼šè¯å‘ç”Ÿåœ¨åŒä¸€æˆ¿é—´å†…ã€‚åŒæ ·ï¼Œæœ¬åœ°æ–¹æ³•è°ƒç”¨æ˜¯æŒ‡åŒä¸€ä¸ªåº”ç”¨ä¸­çš„ä¸¤ä¸ªä»£ç å—ä¹‹é—´çš„æ‰§è¡Œæµäº¤æ¢ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæˆ‘ä»¬æ‹¿èµ·ç”µè¯æ‰“ç»™å¦ä¸€ä¸ªåŸå¸‚çš„å®¢æˆ·ç«¯ï¼Œé‚£æˆ‘ä»¬ä¹‹é—´çš„ä¼šè¯å°±æ˜¯é€šè¿‡ç”µè¯ç½‘ç»œè¿œç¨‹è¿›è¡Œçš„ã€‚ç±»ä¼¼åœ°ï¼ŒRPCè°ƒç”¨å°±æ˜¯æ‰§è¡Œæµä»ä¸€ä¸ªåº”ç”¨ä¼ é€’ç»™å¦ä¸€ä¸ªåº”ç”¨ï¼Œç†è®ºä¸Šå¦ä¸€ä¸ªåº”ç”¨éƒ¨ç½²åœ¨è·¨ç½‘ç»œçš„ä¸€å°è¿œç¨‹æœºå™¨ä¸Šã€‚</p>
<p>æ­£å¦‚æˆ‘ä¹‹å‰æ‰€è¿°ï¼ŒSpringæ”¯æŒå¤šç§ä¸åŒçš„RPCæ¨¡å‹ï¼ŒåŒ…æ‹¬RMIã€Cauchoçš„Hessianå’ŒBurlapä»¥åŠSpringè‡ªå¸¦çš„HTTP invokerã€‚è¡¨15.1æ¦‚è¿°äº†æ¯ä¸€ä¸ªRPCæ¨¡å‹ï¼Œå¹¶ç®€è¦è®¨è®ºäº†å®ƒä»¬æ‰€é€‚ç”¨çš„ä¸åŒåœºæ™¯ã€‚</p>
<p>è¡¨15.1ã€€Springé€šè¿‡å¤šç§è¿œç¨‹è°ƒç”¨æŠ€æœ¯æ”¯æŒRPC</p>
<table>
<thead>
<tr>
<th>RPCæ¨¡å‹</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td>è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆRMIï¼‰</td>
<td>ä¸è€ƒè™‘ç½‘ç»œé™åˆ¶æ—¶ï¼ˆä¾‹å¦‚é˜²ç«å¢™ï¼‰ï¼Œè®¿é—®/å‘å¸ƒåŸºäºJavaçš„æœåŠ¡</td>
</tr>
<tr>
<td>Hessian æˆ– Burlap</td>
<td>è€ƒè™‘ç½‘ç»œé™åˆ¶æ—¶ï¼Œé€šè¿‡HTTPè®¿é—®/å‘å¸ƒåŸºäºJavaçš„æœåŠ¡ã€‚Hessianæ˜¯äºŒè¿›åˆ¶åè®®ï¼Œè€ŒBurlapæ˜¯åŸºäºXMLçš„</td>
</tr>
<tr>
<td>HTTP invoker</td>
<td>è€ƒè™‘ç½‘ç»œé™åˆ¶ï¼Œå¹¶å¸Œæœ›ä½¿ç”¨åŸºäºXMLæˆ–ä¸“æœ‰çš„åºåˆ—åŒ–æœºåˆ¶å®ç°Javaåºåˆ—åŒ–æ—¶ï¼Œè®¿é—®/å‘å¸ƒåŸºäºSpringçš„æœåŠ¡</td>
</tr>
<tr>
<td>JAX-RPCå’ŒJAX-WS</td>
<td>è®¿é—®/å‘å¸ƒå¹³å°ç‹¬ç«‹çš„ã€åŸºäºSOAPçš„WebæœåŠ¡</td>
</tr>
</tbody></table>
<p>ä¸ç®¡ä½ é€‰æ‹©å“ªç§è¿œç¨‹è°ƒç”¨æ¨¡å‹ï¼Œæˆ‘ä»¬ä¼šå‘ç°Springéƒ½æä¾›äº†é£æ ¼ä¸€è‡´çš„æ”¯æŒã€‚è¿™æ„å‘³ç€ä¸€æ—¦ç†è§£äº†å¦‚ä½•é…ç½®Springæ¥ä½¿ç”¨å…¶ä¸­çš„ä¸€ç§æ¨¡å‹ï¼Œå¦‚æœæˆ‘ä»¬å†³å®šä½¿ç”¨å¦å¤–ä¸€ç§æ¨¡å‹çš„è¯ï¼Œå°†æ‹¥æœ‰éå¸¸ä½çš„å­¦ä¹ æ›²çº¿ã€‚</p>
<p>åœ¨æ‰€æœ‰çš„æ¨¡å‹ä¸­ï¼ŒæœåŠ¡éƒ½ä½œä¸ºSpringæ‰€ç®¡ç†çš„beané…ç½®åˆ°æˆ‘ä»¬çš„åº”ç”¨ä¸­ã€‚è¿™æ˜¯é€šè¿‡ä¸€ä¸ªä»£ç†å·¥å‚beanå®ç°çš„ï¼Œè¿™ä¸ªbeanèƒ½å¤ŸæŠŠè¿œç¨‹æœåŠ¡åƒæœ¬åœ°å¯¹è±¡ä¸€æ ·è£…é…åˆ°å…¶ä»–beançš„å±æ€§ä¸­å»ã€‚å›¾15.2å±•ç¤ºäº†å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211110224522258.png" alt="image-20211110224522258"></p>
<p>å›¾15.2ã€€åœ¨Springä¸­ï¼Œè¿œç¨‹æœåŠ¡è¢«ä»£ç†ï¼Œæ‰€ä»¥å®ƒä»¬èƒ½å¤Ÿåƒå…¶ä»–Spring beanä¸€æ ·è¢«è£…é…åˆ°å®¢æˆ·ç«¯ä»£ç ä¸­</p>
<p>å®¢æˆ·ç«¯å‘ä»£ç†å‘èµ·è°ƒç”¨ï¼Œå°±åƒä»£ç†æä¾›äº†è¿™äº›æœåŠ¡ä¸€æ ·ã€‚ä»£ç†ä»£è¡¨å®¢æˆ·ç«¯ä¸è¿œç¨‹æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œç”±å®ƒè´Ÿè´£å¤„ç†è¿æ¥çš„ç»†èŠ‚å¹¶å‘è¿œç¨‹æœåŠ¡å‘èµ·è°ƒç”¨ã€‚</p>
<p>æ›´é‡è¦çš„æ˜¯ï¼Œå¦‚æœè°ƒç”¨è¿œç¨‹æœåŠ¡æ—¶å‘ç”Ÿjava.rmi.RemoteExceptionå¼‚å¸¸ï¼Œä»£ç†ä¼šå¤„ç†æ­¤å¼‚å¸¸å¹¶é‡æ–°æŠ›å‡ºéæ£€æŸ¥å‹å¼‚å¸¸RemoteAccessExceptionã€‚è¿œç¨‹å¼‚å¸¸é€šå¸¸é¢„ç¤ºç€ç³»ç»Ÿå‘ç”Ÿäº†æ— æ³•ä¼˜é›…æ¢å¤çš„é—®é¢˜ï¼Œå¦‚ç½‘ç»œæˆ–é…ç½®é—®é¢˜ã€‚æ—¢ç„¶å®¢æˆ·ç«¯é€šå¸¸æ— æ³•ä»è¿œç¨‹å¼‚å¸¸ä¸­æ¢å¤ï¼Œé‚£ä¹ˆé‡æ–°æŠ›å‡ºRemoteAccessExceptionå¼‚å¸¸å°±èƒ½è®©å®¢æˆ·ç«¯æ¥å†³å®šæ˜¯å¦å¤„ç†æ­¤å¼‚å¸¸ã€‚</p>
<p>åœ¨æœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¡¨15.1æ‰€åˆ—å‡ºçš„ä»»æ„ä¸€ç§æ¨¡å‹å°†Springç®¡ç†çš„beanå‘å¸ƒä¸ºè¿œç¨‹æœåŠ¡ã€‚å›¾15.3å±•ç¤ºäº†è¿œç¨‹å¯¼å‡ºå™¨ï¼ˆremote exporterï¼‰å¦‚ä½•å°†beanæ–¹æ³•å‘å¸ƒä¸ºè¿œç¨‹æœåŠ¡ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211110224646129.png" alt="image-20211110224646129"></p>
<p>å›¾15.3ã€€ä½¿ç”¨è¿œç¨‹å¯¼å‡ºå™¨å°†Springç®¡ç†çš„beanå‘å¸ƒä¸ºè¿œç¨‹æœåŠ¡</p>
<p>æ— è®ºæˆ‘ä»¬å¼€å‘çš„æ˜¯ä½¿ç”¨è¿œç¨‹æœåŠ¡çš„ä»£ç ï¼Œè¿˜æ˜¯å®ç°è¿™äº›æœåŠ¡çš„ä»£ç ï¼Œæˆ–è€…ä¸¤è€…å…¼è€Œæœ‰ä¹‹ï¼Œåœ¨Springä¸­ï¼Œä½¿ç”¨è¿œç¨‹æœåŠ¡çº¯ç²¹æ˜¯ä¸€ä¸ªé…ç½®é—®é¢˜ã€‚æˆ‘ä»¬ä¸éœ€è¦ç¼–å†™ä»»ä½•Javaä»£ç å°±å¯ä»¥æ”¯æŒè¿œç¨‹è°ƒç”¨ã€‚æˆ‘ä»¬çš„æœåŠ¡beanä¹Ÿä¸éœ€è¦å…³å¿ƒå®ƒä»¬æ˜¯å¦å‚ä¸äº†ä¸€ä¸ªRPCï¼ˆå½“ç„¶ï¼Œä»»ä½•ä¼ é€’ç»™è¿œç¨‹è°ƒç”¨çš„beanæˆ–ä»è¿œç¨‹è°ƒç”¨è¿”å›çš„beanå¯èƒ½éœ€è¦å®ç°java.io.Serializableæ¥å£ï¼‰ã€‚</p>
<p>è®©æˆ‘ä»¬é€šè¿‡RMIâ€”â€”Javaæœ€åˆçš„è¿œç¨‹è°ƒç”¨æŠ€æœ¯â€”â€”æ¥å¼€å§‹æ¢ç´¢Springå¯¹è¿œç¨‹è°ƒç”¨çš„æ”¯æŒå§ã€‚</p>
<h3 id="ä½¿ç”¨RMI"><a href="#ä½¿ç”¨RMI" class="headerlink" title="ä½¿ç”¨RMI"></a>ä½¿ç”¨RMI</h3><p>å¦‚æœä½ å·²ç»ä½¿ç”¨Javaç¼–ç¨‹æœ‰äº›å¹´å¤´çš„è¯ï¼Œä½ è‚¯å®šä¼šå¬è¯´è¿‡ï¼ˆä¹Ÿå¯èƒ½ä½¿ç”¨è¿‡ï¼‰RMIã€‚RMIæœ€åˆåœ¨JDK 1.1è¢«å¼•å…¥åˆ°Javaå¹³å°ä¸­ï¼Œå®ƒä¸ºJavaå¼€å‘è€…æä¾›äº†ä¸€ç§å¼ºå¤§çš„æ–¹æ³•æ¥å®ç°Javaç¨‹åºé—´çš„äº¤äº’ã€‚åœ¨RMIä¹‹å‰ï¼Œå¯¹äºJavaå¼€å‘è€…æ¥è¯´ï¼Œè¿œç¨‹è°ƒç”¨çš„å”¯ä¸€é€‰æ‹©å°±æ˜¯CORBAï¼ˆåœ¨å½“æ—¶ï¼Œéœ€è¦è´­ä¹°ä¸€ç§ç¬¬ä¸‰æ–¹äº§å“ï¼Œå«ä½œObject Request Broker[ORB]ï¼‰ï¼Œæˆ–è€…æ‰‹å·¥ç¼–å†™Socketç¨‹åºã€‚</p>
<p>ä½†æ˜¯å¼€å‘å’Œè®¿é—®RMIæœåŠ¡æ˜¯éå¸¸ä¹å‘³æ— èŠçš„ï¼Œå®ƒæ¶‰åŠåˆ°å¥½å‡ ä¸ªæ­¥éª¤ï¼ŒåŒ…æ‹¬ç¨‹åºçš„å’Œæ‰‹å·¥çš„ã€‚Springç®€åŒ–äº†RMIæ¨¡å‹ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªä»£ç†å·¥å‚beanï¼Œèƒ½è®©æˆ‘ä»¬æŠŠRMIæœåŠ¡åƒæœ¬åœ°JavaBeané‚£æ ·è£…é…åˆ°æˆ‘ä»¬çš„Springåº”ç”¨ä¸­ã€‚Springè¿˜æä¾›äº†ä¸€ä¸ªè¿œç¨‹å¯¼å‡ºå™¨ï¼Œç”¨æ¥ç®€åŒ–æŠŠSpringç®¡ç†çš„beanè½¬æ¢ä¸ºRMIæœåŠ¡çš„å·¥ä½œã€‚</p>
<p>å¯¹äºSpittråº”ç”¨ï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•æŠŠä¸€ä¸ªRMIæœåŠ¡è£…é…è¿›å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­ã€‚ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨RMIå¯¼å‡ºå™¨æŠŠSpitterServiceçš„å®ç°å‘å¸ƒä¸ºRMIæœåŠ¡ã€‚</p>
<h4 id="å¯¼å‡ºRMIæœåŠ¡"><a href="#å¯¼å‡ºRMIæœåŠ¡" class="headerlink" title="å¯¼å‡ºRMIæœåŠ¡"></a>å¯¼å‡ºRMIæœåŠ¡</h4><p>å¦‚æœä½ æ›¾ç»åˆ›å»ºè¿‡RMIæœåŠ¡ï¼Œåº”è¯¥ä¼šçŸ¥é“è¿™ä¼šæ¶‰åŠå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>ç¼–å†™ä¸€ä¸ªæœåŠ¡å®ç°ç±»ï¼Œç±»ä¸­çš„æ–¹æ³•å¿…é¡»æŠ›å‡ºjava.rmi.RemoteExceptionå¼‚å¸¸ï¼›</li>
<li>åˆ›å»ºä¸€ä¸ªç»§æ‰¿äºjava.rmi.Remoteçš„æœåŠ¡æ¥å£ï¼›</li>
<li>è¿è¡ŒRMIç¼–è¯‘å™¨ï¼ˆrmicï¼‰ï¼Œåˆ›å»ºå®¢æˆ·ç«¯stubç±»å’ŒæœåŠ¡ç«¯skeletonç±»ï¼›</li>
<li>å¯åŠ¨ä¸€ä¸ªRMIæ³¨å†Œè¡¨ï¼Œä»¥ä¾¿æŒæœ‰è¿™äº›æœåŠ¡ï¼›</li>
<li>åœ¨RMIæ³¨å†Œè¡¨ä¸­æ³¨å†ŒæœåŠ¡ã€‚</li>
</ol>
<p>å“‡ï¼å‘å¸ƒä¸€ä¸ªç®€å•çš„RMIæœåŠ¡éœ€è¦åšè¿™ä¹ˆå¤šçš„å·¥ä½œã€‚é™¤äº†è¿™äº›å¿…éœ€çš„æ­¥éª¤å¤–ï¼Œä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œä¼šæŠ›å‡ºç›¸å½“å¤šçš„RemoteExceptionå’Œ MalformedURLExceptionå¼‚å¸¸ã€‚è™½ç„¶è¿™äº›å¼‚å¸¸é€šå¸¸æ„å‘³ç€ä¸€ä¸ªæ— æ³•ä»catchä»£ç å—ä¸­æ¢å¤çš„è‡´å‘½é”™è¯¯ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶éœ€è¦ç¼–å†™æ ·æ¿å¼çš„ä»£ç æ¥æ•è·å¹¶å¤„ç†è¿™äº›å¼‚å¸¸â€”â€”å³ä½¿æˆ‘ä»¬ä¸èƒ½ä¿®å¤å®ƒä»¬ã€‚</p>
<p>å¾ˆæ˜æ˜¾ï¼Œå‘å¸ƒä¸€ä¸ªRMIæœåŠ¡æ¶‰åŠåˆ°å¤§é‡çš„ä»£ç å’Œæ‰‹å·¥ä½œä¸šã€‚Springæ˜¯å¦èƒ½å¤Ÿåšä¸€äº›å·¥ä½œæ¥è®©è¿™äº›äº‹æƒ…å˜å¾—ä¸å†é‚£ä¹ˆæ£˜æ‰‹å‘¢ï¼Ÿ</p>
<p>åœ¨Springä¸­é…ç½®RMIæœåŠ¡</p>
<p>å¹¸è¿çš„æ˜¯ï¼ŒSpringæä¾›äº†æ›´ç®€å•çš„æ–¹å¼æ¥å‘å¸ƒRMIæœåŠ¡ï¼Œä¸ç”¨å†ç¼–å†™é‚£äº›éœ€è¦æŠ›å‡ºRemoteExceptionå¼‚å¸¸çš„ç‰¹å®šRMIç±»ï¼Œåªéœ€ç®€å•åœ°ç¼–å†™å®ç°æœåŠ¡åŠŸèƒ½çš„POJOå°±å¯ä»¥äº†ï¼ŒSpringä¼šå¤„ç†å‰©ä½™çš„å…¶ä»–äº‹é¡¹ã€‚</p>
<p>æˆ‘ä»¬å°†è¦åˆ›å»ºçš„RMIæœåŠ¡éœ€è¦å‘å¸ƒSpitterServiceæ¥å£ä¸­çš„æ–¹æ³•ï¼Œå¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†è¯¥æ¥å£å®šä¹‰ã€‚</p>
<p>ç¨‹åºæ¸…å•15.1ã€€SpitterServiceå®šä¹‰äº†Spittråº”ç”¨çš„æœåŠ¡å±‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.service;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> com.habuma.spittr.domain.Spitter;<span class="keyword">import</span> com.habuma.spittr.domain.Spittle;<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpitterService</span> </span>&#123;  <span class="function">List&lt;Spittle&gt; <span class="title">getRecentSpittles</span><span class="params">(<span class="keyword">int</span> count)</span></span>;  <span class="keyword">void</span> saveSpittle&#123;Spittle spittle);  <span class="keyword">void</span> saveSpitter&#123;Spitter spitter);  <span class="function">Spitter <span class="title">getSpitter</span><span class="params">(<span class="keyword">long</span> id)</span></span>;  <span class="function"><span class="keyword">void</span> <span class="title">startFollowing</span><span class="params">(Spitter follower, Spitter followee)</span></span>;  <span class="function">List&lt;Spittle&gt; <span class="title">getSpittlesForSpitter</span><span class="params">(Spitter spitter)</span></span>;  <span class="function">List&lt;Spittle&gt; <span class="title">getSpittlesForSpitter</span><span class="params">(String username)</span></span>;  <span class="function">Spitter <span class="title">getSpitter</span><span class="params">(String username)</span></span>;  <span class="function">Spittle <span class="title">getSpittleById</span><span class="params">(<span class="keyword">long</span> id)</span></span>;  <span class="function"><span class="keyword">void</span> <span class="title">deleteSpittle</span><span class="params">(<span class="keyword">long</span> id)</span></span>;  <span class="function">List&lt;Spitter&gt; <span class="title">getAllSpitters</span><span class="params">()</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¼ ç»Ÿçš„RMIæ¥å‘å¸ƒæ­¤æœåŠ¡ï¼ŒSpitterServiceå’ŒSpitterServiceImplä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½éœ€è¦æŠ›å‡ºjava.rmi.RemoteExceptionã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä½¿ç”¨Springçš„<br>RmiServiceExporteræŠŠè¯¥ç±»è½¬å˜ä¸ºRMIæœåŠ¡ï¼Œé‚£ç°æœ‰çš„å®ç°ä¸éœ€è¦åšä»»ä½•æ”¹å˜ã€‚</p>
<p>RmiServiceExporterå¯ä»¥æŠŠä»»æ„Springç®¡ç†çš„beanå‘å¸ƒä¸ºRMIæœåŠ¡ã€‚å¦‚å›¾15.4æ‰€ç¤ºï¼ŒRmiServiceExporteræŠŠbeanåŒ…è£…åœ¨ä¸€ä¸ªé€‚é…å™¨ç±»ä¸­ï¼Œç„¶åé€‚é…å™¨ç±»è¢«ç»‘å®šåˆ°RMIæ³¨å†Œè¡¨ä¸­ï¼Œå¹¶ä¸”ä»£ç†åˆ°æœåŠ¡ç±»çš„è¯·æ±‚â€”â€”åœ¨æœ¬ä¾‹ä¸­æœåŠ¡ç±»ä¹Ÿå°±æ˜¯SpitterServiceImplã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211111083338803.png" alt="image-20211111083338803"><br>å›¾15.4ã€€RmiServiceExporteræŠŠPOJOåŒ…è£…åˆ°æœåŠ¡é€‚é…å™¨ä¸­ï¼Œå¹¶å°†æœåŠ¡é€‚é…å™¨ç»‘å®šåˆ°RMIæ³¨å†Œè¡¨ä¸­ï¼Œä»è€Œå°†POJOè½¬æ¢ä¸ºRMIæœåŠ¡</p>
<p>ä½¿ç”¨RmiServiceExporterå°†SpitterServiceImplå‘å¸ƒä¸ºRMIæœåŠ¡çš„æœ€ç®€å•æ–¹å¼æ˜¯åœ¨Springä¸­ä½¿ç”¨å¦‚ä¸‹çš„@Beanæ–¹æ³•è¿›è¡Œé…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">RmiServiceExporter <span class="title">rmiExporter</span><span class="params">(SpitterService spitterService)</span> </span>&#123;  RmiServiceExporter rmiExporter = <span class="keyword">new</span> RmiServiceExporter();  rmiExporter.setService(spitterService);  rmiExporter.setServiceName(<span class="string">&quot;SpitterService&quot;</span>);  rmiExporter.setServiceInterface(SpitterService.class);  <span class="keyword">return</span> rmiExporter;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¼šæŠŠspitterServicebeanè®¾ç½®åˆ°serviceå±æ€§ä¸­ï¼Œè¡¨æ˜RmiServiceExporterè¦æŠŠè¯¥beanå‘å¸ƒä¸ºä¸€ä¸ªRMIæœåŠ¡ã€‚serviceNameå±æ€§å‘½åäº†RMIæœåŠ¡ï¼ŒserviceInterfaceå±æ€§æŒ‡å®šäº†æ­¤æœåŠ¡æ‰€å®ç°çš„æ¥å£ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRmiServiceExporterä¼šå°è¯•ç»‘å®šåˆ°æœ¬åœ°æœºå™¨1099ç«¯å£ä¸Šçš„RMIæ³¨å†Œè¡¨ã€‚å¦‚æœåœ¨è¿™ä¸ªç«¯å£æ²¡æœ‰å‘ç°RMIæ³¨å†Œè¡¨ï¼ŒRmiServiceExporterå°†ä¼šå¯åŠ¨ä¸€ä¸ªæ³¨å†Œè¡¨ã€‚å¦‚æœå¸Œæœ›ç»‘å®šåˆ°ä¸åŒç«¯å£æˆ–ä¸»æœºä¸Šçš„RMIæ³¨å†Œè¡¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡registryPortå’ŒregistryHostå±æ€§æ¥æŒ‡å®šã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„RmiServiceExporterä¼šå°è¯•ç»‘å®šrmi.spitter.comä¸»æœº1199ç«¯å£ä¸Šçš„RMIæ³¨å†Œè¡¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">RmiServiceExporter <span class="title">rmiExporter</span><span class="params">(SpitterService spitterService)</span> </span>&#123;  RmiServiceExporter rmiExporter = <span class="keyword">new</span> RmiServiceExporter();  rmiExporter.setService(spitterService);  rmiExporter.setServiceName(<span class="string">&quot;SpitterService&quot;</span>);  rmiExporter.setServiceInterface(SpitterService.class);  rmiExporter.setRegistryHost(<span class="string">&quot;rmi.spitter.com&quot;</span>);  rmiExporter.setRegistryPort(<span class="number">1199</span>);  <span class="keyword">return</span> rmiExporter;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨SpringæŠŠæŸä¸ªbeanè½¬å˜ä¸ºRMIæœåŠ¡æ‰€éœ€è¦åšçš„å…¨éƒ¨å·¥ä½œã€‚ç°åœ¨SpitteræœåŠ¡å·²ç»å¯¼å‡ºä¸ºRMIæœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºSpittråº”ç”¨åˆ›å»ºå…¶ä»–çš„ç”¨æˆ·ç•Œé¢æˆ–é‚€è¯·ç¬¬ä¸‰æ–¹ä½¿ç”¨æ­¤RMIæœåŠ¡åˆ›å»ºæ–°çš„å®¢æˆ·ç«¯ã€‚å¦‚æœä½¿ç”¨Springï¼Œå®¢æˆ·ç«¯å¼€å‘è€…è®¿é—®Spitterçš„RMIæœåŠ¡ä¼šéå¸¸å®¹æ˜“ã€‚</p>
<p>è®©æˆ‘ä»¬è½¬æ¢ä¸€ä¸‹è§†è§’æ¥çœ‹çœ‹å¦‚ä½•ç¼–å†™Spitter RMIæœåŠ¡çš„å®¢æˆ·ç«¯ã€‚</p>
<h4 id="è£…é…RMIæœåŠ¡"><a href="#è£…é…RMIæœåŠ¡" class="headerlink" title="è£…é…RMIæœåŠ¡"></a>è£…é…RMIæœåŠ¡</h4><p>ä¼ ç»Ÿä¸Šï¼ŒRMIå®¢æˆ·ç«¯å¿…é¡»ä½¿ç”¨RMI APIçš„Namingç±»ä»RMIæ³¨å†Œè¡¨ä¸­æŸ¥æ‰¾æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ç‰‡æ®µæ¼”ç¤ºäº†å¦‚ä½•è·å–Spitterçš„RMIæœåŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;  String serviceUrl = <span class="string">&quot;rmi:/spitter/SpitterService&quot;</span>;  SpitterService spitterService = (SpitterService) Naming.lookup(serviceId)  ...&#125; <span class="keyword">catch</span> (RemoteException e) &#123;  ...&#125; <span class="keyword">catch</span> (NotBoundException e) &#123;  ...&#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;  ...&#125;</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶è¿™æ®µä»£ç å¯ä»¥è·å–Spitterçš„RMIæœåŠ¡çš„å¼•ç”¨ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>ä¼ ç»Ÿçš„RMIæŸ¥æ‰¾å¯èƒ½ä¼šå¯¼è‡´3ç§æ£€æŸ¥å‹å¼‚å¸¸çš„ä»»æ„ä¸€ç§ï¼ˆRemoteExceptionã€NotBoundExceptionå’ŒMalformedURLExceptionï¼‰ï¼Œè¿™äº›å¼‚å¸¸å¿…é¡»è¢«æ•è·æˆ–é‡æ–°æŠ›å‡ºï¼›</li>
<li>éœ€è¦SpitteræœåŠ¡çš„ä»»ä½•ä»£ç éƒ½å¿…é¡»è‡ªå·±è´Ÿè´£è·å–è¯¥æœåŠ¡ã€‚è¿™å±äºæ ·æ¿ä»£ç ï¼Œä¸å®¢æˆ·ç«¯çš„åŠŸèƒ½å¹¶æ²¡æœ‰ç›´æ¥å…³ç³»ã€‚</li>
</ul>
<p>RMIæŸ¥æ‰¾è¿‡ç¨‹ä¸­æ‰€æŠ›å‡ºçš„å¼‚å¸¸é€šå¸¸æ„å‘³ç€åº”ç”¨å‘ç”Ÿäº†è‡´å‘½çš„ä¸å¯æ¢å¤çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼ŒMalformedURLExceptionå¼‚å¸¸æ„å‘³ç€è¿™ä¸ªæœåŠ¡çš„åœ°å€æ˜¯æ— æ•ˆçš„ã€‚ä¸ºäº†ä»è¿™ä¸ªå¼‚å¸¸ä¸­æ¢å¤ï¼Œåº”ç”¨è‡³å°‘è¦é‡æ–°é…ç½®ï¼Œä¹Ÿå¯èƒ½éœ€è¦é‡æ–°ç¼–è¯‘ã€‚try/catchä»£ç å—å¹¶ä¸èƒ½åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ä¼˜é›…åœ°æ¢å¤ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å¼ºåˆ¶æˆ‘ä»¬çš„ä»£ç æ•è·å¹¶å¤„ç†è¿™ä¸ªå¼‚å¸¸å‘¢ï¼Ÿ</p>
<p>ä½†æ˜¯ï¼Œæ›´ç³Ÿç³•çš„äº‹æƒ…æ˜¯è¿™æ®µä»£ç ç›´æ¥è¿åäº†ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰åŸåˆ™ã€‚å› ä¸ºå®¢æˆ·ç«¯ä»£ç éœ€è¦è´Ÿè´£æŸ¥æ‰¾SpitteræœåŠ¡ï¼Œå¹¶ä¸”è¿™ä¸ªæœåŠ¡æ˜¯RMIæœåŠ¡ï¼Œæˆ‘ä»¬ç”šè‡³æ²¡æœ‰ä»»ä½•æœºä¼šå»æä¾›SpitterServiceå¯¹è±¡çš„ä¸åŒå®ç°ã€‚</p>
<p>ç†æƒ³æƒ…å†µä¸‹ï¼Œåº”è¯¥å¯ä»¥ä¸ºä»»æ„ä¸€ä¸ªbeanæ³¨å…¥SpitterServiceå¯¹è±¡ï¼Œè€Œä¸æ˜¯è®©beanè‡ªå·±å»æŸ¥æ‰¾æœåŠ¡ã€‚åˆ©ç”¨DIï¼ŒSpitterServiceçš„ä»»ä½•å®¢æˆ·ç«¯éƒ½ä¸éœ€è¦å…³å¿ƒæ­¤æœåŠ¡æ¥æºäºä½•å¤„ã€‚</p>
<p>Springçš„RmiProxyFactoryBeanæ˜¯ä¸€ä¸ªå·¥å‚beanï¼Œè¯¥beanå¯ä»¥ä¸ºRMIæœåŠ¡åˆ›å»ºä»£ç†ã€‚ä½¿ç”¨RmiProxyFactoryBeanå¼•ç”¨SpitterServiceçš„RMIæœåŠ¡æ˜¯éå¸¸ç®€å•çš„ï¼Œåªéœ€è¦åœ¨å®¢æˆ·ç«¯çš„Springé…ç½®ä¸­å¢åŠ å¦‚ä¸‹çš„@Beanæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">RmiProxyFactoryBean <span class="title">spitterService</span><span class="params">()</span> </span>&#123;  RmiProxyFactoryBean rmiProxy = <span class="keyword">new</span> RmiProxyFactoryBean();  rmiProxy.setServiceUrl(<span class="string">&quot;rmi://localhost/SpitterService&quot;</span>);  rmiProxy.setServiceInterface(SpitterService.class);  <span class="keyword">return</span> rmiProxy;&#125;</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡çš„URLæ˜¯é€šè¿‡RmiProxyFactoryBeançš„serviceUrlå±æ€§æ¥è®¾ç½®çš„ï¼Œåœ¨è¿™é‡Œï¼ŒæœåŠ¡åè¢«è®¾ç½®ä¸ºSpitterServiceï¼Œå¹¶ä¸”å£°æ˜æœåŠ¡æ˜¯åœ¨æœ¬åœ°æœºå™¨ä¸Šçš„ï¼›åŒæ—¶ï¼ŒæœåŠ¡æä¾›çš„æ¥å£ç”±serviceInterfaceå±æ€§æ¥æŒ‡å®šã€‚å›¾15.5å±•ç¤ºäº†å®¢æˆ·ç«¯å’ŒRMIä»£ç†çš„äº¤äº’ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211111084204602.png" alt="image-20211111084204602"></p>
<p>å›¾15.5ã€€RmiProxyFactoryBeanç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä»£è¡¨å®¢æˆ·ç«¯æ¥è´Ÿè´£ä¸è¿œç¨‹çš„RMIæœåŠ¡è¿›è¡Œé€šä¿¡ã€‚å®¢æˆ·ç«¯é€šè¿‡æœåŠ¡çš„æ¥å£ä¸ä»£ç†è¿›è¡Œäº¤äº’ï¼Œå°±å¦‚åŒè¿œç¨‹æœ<br>åŠ¡å°±æ˜¯ä¸€ä¸ªæœ¬åœ°çš„POJO</p>
<p>ç°åœ¨å·²ç»æŠŠRMIæœåŠ¡å£°æ˜ä¸ºSpringç®¡ç†çš„beanï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå®ƒä½œä¸ºä¾èµ–è£…é…è¿›å¦ä¸€ä¸ªbeanä¸­ï¼Œå°±åƒä»»æ„éè¿œç¨‹çš„beané‚£æ ·ã€‚ä¾‹å¦‚ï¼Œå‡è®¾å®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨SpitteræœåŠ¡ä¸ºæŒ‡å®šçš„ç”¨æˆ·è·å–Spittleåˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Autowiredæ³¨è§£æŠŠæœåŠ¡ä»£ç†è£…é…è¿›å®¢æˆ·ç«¯ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutowiredSpitterService</span> spitterService;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥åƒæœ¬åœ°beanä¸€æ ·è°ƒç”¨å®ƒçš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Spittle&gt; <span class="title">getSpittles</span><span class="params">(String userName)</span> </span>&#123;  Spitter spitter = spitterService.getSpitter(userName);  <span class="keyword">return</span> spitterService.getSpittersForSpitter(spitter);&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥è¿™ç§æ–¹å¼è®¿é—®RMIæœåŠ¡ç®€ç›´å¤ªæ£’äº†ï¼å®¢æˆ·ç«¯ä»£ç ç”šè‡³ä¸éœ€è¦çŸ¥é“æ‰€å¤„ç†çš„æ˜¯ä¸€ä¸ªRMIæœåŠ¡ã€‚å®ƒåªæ˜¯é€šè¿‡æ³¨å…¥æœºåˆ¶æ¥å—äº†ä¸€ä¸ªSpitterServiceå¯¹è±¡ï¼Œæ ¹æœ¬ä¸å¿…å…³å¿ƒå®ƒæ¥è‡ªä½•å¤„ã€‚å®é™…ä¸Šï¼Œè°çŸ¥é“å®¢æˆ·ç«¯å¾—åˆ°çš„å°±æ˜¯ä¸€ä¸ªåŸºäºRMIçš„å®ç°å‘¢ï¼Ÿ</p>
<p>æ­¤å¤–ï¼Œä»£ç†æ•è·äº†è¿™ä¸ªæœåŠ¡æ‰€æœ‰å¯èƒ½æŠ›å‡ºçš„RemoteExceptionå¼‚å¸¸ï¼Œå¹¶æŠŠå®ƒåŒ…è£…ä¸ºè¿è¡ŒæœŸå¼‚å¸¸é‡æ–°æŠ›å‡ºï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ”¾å¿ƒåœ°å¿½ç•¥è¿™äº›å¼‚å¸¸ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥éå¸¸å®¹æ˜“åœ°æŠŠè¿œç¨‹æœåŠ¡beanæ›¿æ¢ä¸ºè¯¥æœåŠ¡çš„å…¶ä»–å®ç°â€”â€”æˆ–è®¸æ˜¯ä¸åŒçš„è¿œç¨‹æœåŠ¡ï¼Œæˆ–è€…å¯èƒ½æ˜¯å®¢æˆ·ç«¯ä»£ç å•å…ƒæµ‹è¯•æ—¶çš„ä¸€ä¸ªmockå®ç°ã€‚</p>
<p>è™½ç„¶å®¢æˆ·ç«¯ä»£ç æ ¹æœ¬ä¸éœ€è¦å…³å¿ƒæ‰€èµ‹äºˆçš„SpitterServiceæ˜¯ä¸€ä¸ªè¿œç¨‹æœåŠ¡ï¼Œä½†æˆ‘ä»¬éœ€è¦éå¸¸è°¨æ…åœ°è®¾è®¡è¿œç¨‹æœåŠ¡çš„æ¥å£ã€‚æé†’ä¸€ä¸‹ï¼Œå®¢æˆ·ç«¯ä¸å¾—ä¸è°ƒç”¨ä¸¤æ¬¡æœåŠ¡ï¼šä¸€æ¬¡æ˜¯æ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾Spitterï¼Œå¦ä¸€æ¬¡æ˜¯è·å–Spittleå¯¹è±¡çš„åˆ—è¡¨ã€‚è¿™ä¸¤æ¬¡è¿œç¨‹è°ƒç”¨éƒ½ä¼šå—ç½‘ç»œå»¶è¿Ÿçš„å½±å“ï¼Œè¿›è€Œå¯èƒ½ä¼šå½±å“åˆ°å®¢æˆ·ç«¯çš„æ€§èƒ½ã€‚æ¸…æ¥šäº†å®¢æˆ·ç«¯æ˜¯å¦‚ä½•ä½¿ç”¨æœåŠ¡çš„ï¼Œæˆ‘ä»¬æˆ–è®¸ä¼šé‡å†™æ¥å£ï¼ŒæŠŠè¿™ä¸¤ä¸ªè°ƒç”¨æ”¾è¿›ä¸€ä¸ªæ–¹æ³•ä¸­ã€‚ä½†æ˜¯ç°åœ¨æˆ‘ä»¬è¦æ¥å—è¿™æ ·çš„æœåŠ¡æ¥å£ã€‚</p>
<p>RMIæ˜¯ä¸€ç§å®ç°è¿œç¨‹æœåŠ¡äº¤äº’çš„å¥½åŠæ³•ï¼Œä½†æ˜¯å®ƒå­˜åœ¨æŸäº›é™åˆ¶ã€‚é¦–å…ˆï¼ŒRMIå¾ˆéš¾ç©¿è¶Šé˜²ç«å¢™ï¼Œè¿™æ˜¯å› ä¸ºRMIä½¿ç”¨ä»»æ„ç«¯å£æ¥äº¤äº’â€”â€”è¿™æ˜¯é˜²ç«å¢™é€šå¸¸æ‰€ä¸å…è®¸çš„ã€‚åœ¨ä¼ä¸šå†…éƒ¨ç½‘ç»œç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¸éœ€è¦æ‹…å¿ƒè¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯å¦‚æœåœ¨äº’è”ç½‘ä¸Šè¿è¡Œï¼Œæˆ‘ä»¬ç”¨RMIå¯èƒ½ä¼šé‡åˆ°éº»çƒ¦ã€‚å³ä½¿RMIæä¾›äº†å¯¹HTTPçš„é€šé“çš„æ”¯æŒï¼ˆé€šå¸¸é˜²ç«å¢™éƒ½å…è®¸ï¼‰ï¼Œä½†æ˜¯å»ºç«‹è¿™ä¸ªé€šé“ä¹Ÿä¸æ˜¯ä»¶å®¹æ˜“çš„äº‹ã€‚</p>
<p>å¦å¤–ä¸€ä»¶éœ€è¦è€ƒè™‘çš„äº‹æƒ…æ˜¯RMIæ˜¯åŸºäºJavaçš„ã€‚è¿™æ„å‘³ç€å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¿…é¡»éƒ½æ˜¯ç”¨Javaå¼€å‘çš„ã€‚å› ä¸ºRMIä½¿ç”¨äº†Javaçš„åºåˆ—åŒ–æœºåˆ¶ï¼Œæ‰€ä»¥é€šè¿‡ç½‘ç»œä¼ è¾“çš„å¯¹è±¡ç±»å‹å¿…é¡»è¦ä¿è¯åœ¨è°ƒç”¨ä¸¤ç«¯çš„Javaè¿è¡Œæ—¶ä¸­æ˜¯å®Œå…¨ç›¸åŒçš„ç‰ˆæœ¬ã€‚å¯¹æˆ‘ä»¬çš„åº”ç”¨è€Œè¨€ï¼Œè¿™å¯èƒ½æ˜¯ä¸ªé—®é¢˜ï¼Œä¹Ÿå¯èƒ½ä¸æ˜¯é—®é¢˜ã€‚ä½†æ˜¯é€‰æ‹©RMIåšè¿œç¨‹æœåŠ¡æ—¶ï¼Œå¿…é¡»è¦ç‰¢è®°è¿™ä¸€ç‚¹ã€‚</p>
<p>Caucho Technologyï¼ˆResinåº”ç”¨æœåŠ¡å™¨èƒŒåçš„å…¬å¸ï¼‰å¼€å‘äº†ä¸€å¥—åº”å¯¹RMIé™åˆ¶çš„è¿œç¨‹è°ƒç”¨è§£å†³æ–¹æ¡ˆã€‚å®é™…ä¸Šï¼ŒCauchoæä¾›äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šHessianå’ŒBurlapã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨Springä¸­ä½¿ç”¨Hessianå’ŒBurlapå¤„ç†è¿œç¨‹æœåŠ¡ã€‚</p>
<h3 id="ä½¿ç”¨Hessianå’ŒBurlapå‘å¸ƒè¿œç¨‹æœåŠ¡"><a href="#ä½¿ç”¨Hessianå’ŒBurlapå‘å¸ƒè¿œç¨‹æœåŠ¡" class="headerlink" title="ä½¿ç”¨Hessianå’ŒBurlapå‘å¸ƒè¿œç¨‹æœåŠ¡"></a>ä½¿ç”¨Hessianå’ŒBurlapå‘å¸ƒè¿œç¨‹æœåŠ¡</h3><p>Hessianå’ŒBurlapæ˜¯Caucho Technologyæä¾›çš„ä¸¤ç§åŸºäºHTTPçš„è½»é‡çº§è¿œç¨‹æœåŠ¡è§£å†³æ–¹æ¡ˆã€‚å€ŸåŠ©äºå°½å¯èƒ½ç®€å•çš„APIå’Œé€šä¿¡åè®®ï¼Œå®ƒä»¬éƒ½è‡´åŠ›äºç®€åŒ–WebæœåŠ¡ã€‚</p>
<p>ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆCauchoå¯¹åŒä¸€ä¸ªé—®é¢˜ä¼šæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆã€‚Hessianå’ŒBurlapå°±å¦‚åŒä¸€ä¸ªäº‹ç‰©çš„ä¸¤é¢ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªè§£å†³æ–¹æ¡ˆéƒ½æœåŠ¡äºç•¥å¾®ä¸åŒçš„ç›®çš„ã€‚</p>
<p>Hessianï¼ŒåƒRMIä¸€æ ·ï¼Œä½¿ç”¨äºŒè¿›åˆ¶æ¶ˆæ¯è¿›è¡Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„äº¤äº’ã€‚ä½†ä¸å…¶ä»–äºŒè¿›åˆ¶è¿œç¨‹è°ƒç”¨æŠ€æœ¯ï¼ˆä¾‹å¦‚RMIï¼‰ä¸åŒçš„æ˜¯ï¼Œå®ƒçš„äºŒè¿›åˆ¶æ¶ˆæ¯å¯ä»¥ç§»æ¤åˆ°å…¶ä»–éJavaçš„è¯­è¨€ä¸­ï¼ŒåŒ…æ‹¬PHPã€Pythonã€C++å’ŒC#ã€‚</p>
<p>Burlapæ˜¯ä¸€ç§åŸºäºXMLçš„è¿œç¨‹è°ƒç”¨æŠ€æœ¯ï¼Œè¿™ä½¿å¾—å®ƒå¯ä»¥è‡ªç„¶è€Œç„¶åœ°ç§»æ¤åˆ°ä»»ä½•èƒ½å¤Ÿè§£æXMLçš„è¯­è¨€ä¸Šã€‚æ­£å› ä¸ºå®ƒåŸºäºXMLï¼Œæ‰€ä»¥ç›¸æ¯”èµ·Hessiançš„äºŒè¿›åˆ¶æ ¼å¼è€Œè¨€ï¼ŒBurlapå¯è¯»æ€§æ›´å¼ºã€‚ä½†æ˜¯å’Œå…¶ä»–åŸºäºXMLçš„è¿œç¨‹æŠ€æœ¯ï¼ˆä¾‹å¦‚SOAPæˆ–XML-RPCï¼‰ä¸åŒï¼ŒBurlapçš„æ¶ˆæ¯ç»“æ„å°½å¯èƒ½çš„ç®€å•ï¼Œä¸éœ€è¦é¢å¤–çš„å¤–éƒ¨å®šä¹‰è¯­è¨€ï¼ˆä¾‹å¦‚WSDLæˆ–IDLï¼‰ã€‚</p>
<p>ä½ å¯èƒ½æƒ³çŸ¥é“å¦‚ä½•åœ¨Hessianå’ŒBurlapä¹‹é—´åšå‡ºé€‰æ‹©ã€‚å¾ˆå¤§ç¨‹åº¦ä¸Šï¼Œå®ƒä»¬æ˜¯ä¸€æ ·çš„ã€‚å”¯ä¸€çš„åŒºåˆ«åœ¨äºHessiançš„æ¶ˆæ¯æ˜¯äºŒè¿›åˆ¶çš„ï¼Œè€ŒBurlapçš„æ¶ˆæ¯æ˜¯XMLã€‚ç”±äºHessiançš„æ¶ˆæ¯æ˜¯äºŒè¿›åˆ¶çš„ï¼Œæ‰€ä»¥å®ƒåœ¨å¸¦å®½ä¸Šæ›´å…·ä¼˜åŠ¿ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ›´æ³¨é‡å¯è¯»æ€§ï¼ˆå¦‚å‡ºäºè°ƒè¯•çš„ç›®çš„ï¼‰æˆ–è€…æˆ‘ä»¬çš„åº”ç”¨éœ€è¦ä¸æ²¡æœ‰Hessianå®ç°çš„è¯­è¨€äº¤äº’ï¼Œé‚£ä¹ˆBurlapçš„XMLæ¶ˆæ¯ä¼šæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>
<p>ä¸ºäº†åœ¨Springä¸­æ¼”ç¤ºHessianå’ŒBurlapæœåŠ¡ï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹åœ¨å‰ä¸€èŠ‚ä¸­ä½¿ç”¨RMIè§£å†³SpitteræœåŠ¡çš„ç¤ºä¾‹ã€‚ä½†æ˜¯è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹å¦‚ä½•ä½¿ç”¨Hessianå’ŒBurlapä½œä¸ºè¿œç¨‹è°ƒç”¨æ¨¡å‹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<h4 id="ä½¿ç”¨Hessianå’ŒBurlapå¯¼å‡ºbeançš„åŠŸèƒ½"><a href="#ä½¿ç”¨Hessianå’ŒBurlapå¯¼å‡ºbeançš„åŠŸèƒ½" class="headerlink" title="ä½¿ç”¨Hessianå’ŒBurlapå¯¼å‡ºbeançš„åŠŸèƒ½"></a>ä½¿ç”¨Hessianå’ŒBurlapå¯¼å‡ºbeançš„åŠŸèƒ½</h4><p>åƒä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬å¸Œæœ›æŠŠSpitterServiceImplç±»çš„åŠŸèƒ½å‘å¸ƒä¸ºè¿œç¨‹æœåŠ¡â€”â€”è¿™æ¬¡æ˜¯ä¸€ä¸ªHessianæœåŠ¡ã€‚å³ä½¿æ²¡æœ‰Springï¼Œç¼–å†™ä¸€ä¸ªHessianæœåŠ¡ä¹Ÿæ˜¯ç›¸å½“å®¹æ˜“çš„ã€‚æˆ‘ä»¬åªéœ€è¦ç¼–å†™ä¸€ä¸ªç»§æ‰¿com.caucho.hessian.server.HessianServletçš„ç±»ï¼Œå¹¶ç¡®ä¿æ‰€æœ‰çš„æœåŠ¡æ–¹æ³•æ˜¯publicçš„ï¼ˆåœ¨Hessiané‡Œï¼Œæ‰€æœ‰publicæ–¹æ³•è¢«è§†ä¸ºæœåŠ¡æ–¹æ³•ï¼‰ã€‚</p>
<p>å› ä¸ºHessianæœåŠ¡å¾ˆå®¹æ˜“å®ç°ï¼ŒSpringå¹¶æ²¡æœ‰åšæ›´å¤šç®€åŒ–Hessianæ¨¡å‹çš„å·¥ä½œã€‚ä½†æ˜¯å’ŒSpringä¸€èµ·ä½¿ç”¨æ—¶ï¼ŒHessianæœåŠ¡å¯ä»¥åœ¨å„æ–¹é¢åˆ©ç”¨Springæ¡†æ¶çš„ä¼˜åŠ¿ï¼Œè¿™æ˜¯çº¯HessianæœåŠ¡æ‰€ä¸å…·å¤‡çš„ã€‚åŒ…æ‹¬åˆ©ç”¨Springçš„AOPæ¥ä¸ºHessianæœåŠ¡æä¾›ç³»ç»Ÿçº§æœåŠ¡ï¼Œä¾‹å¦‚å£°æ˜å¼äº‹åŠ¡ã€‚</p>
<p>å¯¼å‡ºHessianæœåŠ¡</p>
<p>åœ¨Springä¸­å¯¼å‡ºä¸€ä¸ªHessianæœåŠ¡å’Œåœ¨Springä¸­å®ç°ä¸€ä¸ªRMIæœåŠ¡æƒŠäººçš„ç›¸ä¼¼ã€‚ä¸ºäº†æŠŠSpitteræœåŠ¡beanå‘å¸ƒä¸ºRMIæœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨Springé…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸€ä¸ªRmiServiceExporterbeanã€‚åŒæ ·çš„æ–¹å¼ï¼Œä¸ºäº†æŠŠSpitteræœåŠ¡å‘å¸ƒä¸ºHessianæœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®å¦ä¸€ä¸ªå¯¼å‡ºbeanï¼Œåªä¸è¿‡è¿™æ¬¡æ˜¯HessianServiceExporterã€‚</p>
<p>HessianServiceExporterå¯¹HessianæœåŠ¡æ‰€æ‰§è¡Œçš„åŠŸèƒ½</p>
<p>ä¸RmiServiceExporterå¯¹RMIæœåŠ¡æ‰€æ‰§è¡Œçš„åŠŸèƒ½æ˜¯ç›¸åŒçš„ï¼šå®ƒæŠŠPOJOçš„publicæ–¹æ³•å‘å¸ƒæˆHessianæœåŠ¡çš„æ–¹æ³•ã€‚ä¸è¿‡ï¼Œæ­£å¦‚å›¾15.6æ‰€ç¤ºï¼Œå…¶å®ç°è¿‡ç¨‹ä¸ RmiServiceExporterå°†POJOå‘å¸ƒä¸ºRMIæœåŠ¡æ˜¯ä¸åŒçš„ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211111085152544.png" alt="image-20211111085152544"></p>
<p>å›¾15.6ã€€HessianServiceExporteræ˜¯ä¸€ä¸ªSpring MVCæ§åˆ¶å™¨ï¼Œå®ƒå¯ä»¥æ¥æ”¶Hessianè¯·æ±‚ï¼Œå¹¶æŠŠè¿™äº›è¯·æ±‚è½¬æ¢æˆå¯¹POJOçš„è°ƒç”¨ä»è€Œå°†POJOå¯¼å‡ºä¸ºä¸€ä¸ªHessianæœåŠ¡</p>
<p>HessianServiceExporterï¼ˆç¨åä¼šæœ‰æ›´è¯¦ç»†çš„ä»‹ç»ï¼‰æ˜¯ä¸€ä¸ªSpring MVCæ§åˆ¶å™¨ï¼Œå®ƒæ¥æ”¶Hessianè¯·æ±‚ï¼Œå¹¶å°†è¿™äº›è¯·æ±‚è½¬æ¢æˆå¯¹è¢«å¯¼å‡ºPOJOçš„æ–¹æ³•è°ƒç”¨ã€‚åœ¨å¦‚ä¸‹Springçš„å£°æ˜ä¸­ï¼ŒHessianServiceExporterä¼šæŠŠspitterService beanå¯¼å‡ºä¸ºHessianæœåŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">HessianServiceExporter <span class="title">hessianExportedSpitterService</span><span class="params">(SpitterService service)</span> </span>&#123;  HessianServiceExporter exporter = <span class="keyword">new</span> HessianServiceExporter();  exporter.setService(service);  exporter.setServiceInterface(SpitterService.class);  <span class="keyword">return</span> exporter;&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚RmiServiceExporterä¸€æ ·ï¼Œserviceå±æ€§çš„å€¼è¢«è®¾ç½®ä¸ºå®ç°äº†è¿™ä¸ªæœåŠ¡çš„beanå¼•ç”¨ã€‚åœ¨è¿™é‡Œï¼Œå®ƒå¼•ç”¨çš„æ˜¯spitterServicebeanã€‚serviceInterfaceå±æ€§ç”¨æ¥æ ‡è¯†è¿™ä¸ªæœåŠ¡å®ç°äº†SpitterServiceæ¥å£ã€‚</p>
<p>ä¸RmiServiceExporterä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦è®¾ç½®serviceNameå±æ€§ã€‚åœ¨RMIä¸­ï¼ŒserviceNameå±æ€§ç”¨æ¥åœ¨RMIæ³¨å†Œè¡¨ä¸­æ³¨å†Œä¸€ä¸ªæœåŠ¡ã€‚è€ŒHessianæ²¡æœ‰æ³¨å†Œè¡¨ï¼Œå› æ­¤ä¹Ÿå°±æ²¡å¿…è¦ä¸ºHessianæœåŠ¡è¿›è¡Œå‘½åã€‚</p>
<p>é…ç½®Hessianæ§åˆ¶å™¨</p>
<p>RmiServiceExporterå’ŒHessianServiceExporterå¦å¤–ä¸€ä¸ªä¸»è¦åŒºåˆ«å°±æ˜¯ï¼Œç”±äºHessianæ˜¯åŸºäºHTTPçš„ï¼Œæ‰€ä»¥HessianSeriviceExporterå®ç°ä¸ºä¸€ä¸ªSpring MVCæ§åˆ¶å™¨ã€‚è¿™æ„å‘³ç€ä¸ºäº†ä½¿ç”¨å¯¼å‡ºçš„HessianæœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸¤ä¸ªé¢å¤–çš„é…ç½®æ­¥éª¤ï¼š</p>
<p>åœ¨web.xmlä¸­é…ç½®Springçš„DispatcherServletï¼Œå¹¶æŠŠæˆ‘ä»¬çš„åº”ç”¨éƒ¨ç½²ä¸ºã€€Webåº”ç”¨ï¼›</p>
<p>åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸€ä¸ªURLå¤„ç†å™¨ï¼ŒæŠŠHessianæœåŠ¡çš„URLåˆ†å‘ç»™å¯¹åº”çš„HessianæœåŠ¡beanã€‚</p>
<p>æˆ‘ä»¬åœ¨ç¬¬5ç« å­¦ä¹ äº†å¦‚ä½•é…ç½®Springçš„DispatcherServletå’ŒURLå¤„ç†å™¨ï¼Œæ‰€ä»¥è¿™äº›æ­¥éª¤çœ‹èµ·æ¥æœ‰äº›ç†Ÿæ‚‰ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªDispatcherServletã€‚è¿˜å¥½ï¼Œè¿™ä¸ªæˆ‘ä»¬å·²ç»åœ¨Spittråº”ç”¨çš„web.xmlæ–‡ä»¶ä¸­é…ç½®äº†ã€‚ä½†æ˜¯ä¸ºäº†å¤„ç†HessianæœåŠ¡ï¼ŒDispatcherServletè¿˜éœ€è¦é…ç½®ä¸€ä¸ªServletæ˜ å°„æ¥æ‹¦æˆªåç¼€ä¸º <code>*.service</code> çš„URLï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span>  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spitter<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.service<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ åœ¨Javaä¸­é€šè¿‡å®ç°WebApplicationInitializeræ¥é…ç½®DispatcherServletçš„è¯ï¼Œé‚£ä¹ˆéœ€è¦å°†URLæ¨¡å¼ä½œä¸ºæ˜ å°„æ·»åŠ åˆ°ServletRegistration.Dynamicä¸­ï¼Œåœ¨<br>å°†DispatcherServletæ·»åŠ åˆ°å®¹å™¨ä¸­çš„æ—¶å€™ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¾—åˆ°ServletRegistration.Dynamicå¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServletRegistration.Dynamic dispatcher = container.addServlet(  <span class="string">&quot;appServlet&quot;</span>, <span class="keyword">new</span> DispatcherServlet(dispatcherServletContext));dispatcher.setLoadOnStartup();dispatcher.addMapping(<span class="string">&quot;/&quot;</span>);dispatcher.addMapping(<span class="string">&quot;*.service&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼Œå¦‚æœä½ é€šè¿‡æ‰©å±•AbstractDispatcherServletInitializeræˆ–AbstractAnnotationConfigDispatcherServletInitializerçš„æ–¹å¼æ¥é…ç½®DispatcherServletï¼Œé‚£ä¹ˆåœ¨é‡<br>è½½getServletMappings()çš„æ—¶å€™ï¼Œéœ€è¦åŒ…å«è¯¥æ˜ å°„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> String[] getServletMapping() &#123;  <span class="keyword">return</span> <span class="keyword">new</span> String[] &#123; <span class="string">&quot;/&quot;</span>, <span class="string">&quot;*.service&quot;</span>&#125;;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·é…ç½®åï¼Œä»»ä½•ä»¥â€œ.serviceâ€ç»“æŸçš„URLè¯·æ±‚éƒ½å°†ç”±DispatcherServletå¤„ç†ï¼Œå®ƒä¼šæŠŠè¯·æ±‚ä¼ é€’ç»™åŒ¹é…è¿™ä¸ªURLçš„æ§åˆ¶å™¨ã€‚å› æ­¤â€œ/spitter.serviceâ€çš„è¯·æ±‚æœ€ç»ˆå°†è¢«<br>hessianSpitterServicebeanæ‰€å¤„ç†ï¼ˆå®ƒå®é™…ä¸Šä»…ä»…æ˜¯ä¸€ä¸ªSpitterServiceImplçš„ä»£ç†ï¼‰ã€‚</p>
<p>é‚£æˆ‘ä»¬æ˜¯å¦‚ä½•çŸ¥é“è¿™ä¸ªè¯·æ±‚ä¼šè½¬ç»™hessianSpitterSeviceå¤„ç†å‘¢ï¼Ÿæˆ‘ä»¬è¿˜éœ€è¦é…ç½®ä¸€ä¸ªURLæ˜ å°„æ¥ç¡®ä¿DispatcherServletæŠŠè¯·æ±‚è½¬ç»™hessianSpitterServiceã€‚å¦‚ä¸‹çš„SimpleUrlHandlerMappingbeanå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">HandlerMapping <span class="title">hessianMapping</span><span class="params">()</span> </span>&#123;  SimpleUrlHandlerMapping mapping = <span class="keyword">new</span> SimpleUrlHandlerMapping();  Properties mappings = <span class="keyword">new</span> Properties();  mappings.setProperty(<span class="string">&quot;/spitter.service&quot;</span>, <span class="string">&quot;hessianExportedSpitterService&quot;</span>);  mapping.setMappings(mappings);  <span class="keyword">return</span> mapping;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸å–œæ¬¢Hessiançš„äºŒè¿›åˆ¶åè®®ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€‰æ‹©ä½¿ç”¨BurlapåŸºäºXMLçš„åè®®ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æŠŠä¸€ä¸ªæœåŠ¡å¯¼å‡ºä¸ºBurlapæœåŠ¡ã€‚</p>
<p>å¯¼å‡ºBurlapæœåŠ¡</p>
<p>ä»ä»»ä½•æ–¹é¢ä¸Šçœ‹ï¼ŒBurlapServiceExporterä¸HessianServiceExporterå®é™…ä¸Šéƒ½æ˜¯ç›¸åŒçš„ï¼Œåªä¸è¿‡å®ƒä½¿ç”¨åŸºäºXMLçš„åè®®è€Œä¸æ˜¯äºŒè¿›åˆ¶åè®®ã€‚ä¸‹é¢çš„beanå®šä¹‰å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨BurlapServiceExporteræŠŠSpitteræœåŠ¡å¯¼å‡ºä¸ºä¸€ä¸ªBurlapæœåŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">BurlapServiceExporter <span class="title">burlapExportedSpitterService</span><span class="params">(SpitterService service)</span> </span>&#123;  BurlapServiceExporter exporter = <span class="keyword">new</span> BurlapServiceExporter();  exporter.setService(service);  exporter.setServiceInterface(SpitterService.class);  <span class="keyword">return</span> exporter;&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œè¿™ä¸ªbeanä¸ä½¿ç”¨Hessianæ‰€å¯¹åº”beançš„å”¯ä¸€åŒºåˆ«åœ¨äºbeançš„æ–¹æ³•å’Œå¯¼å‡ºç±»ã€‚é…ç½®BurlapæœåŠ¡å’Œé…ç½®HessianæœåŠ¡æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œè¿™åŒ…æ‹¬éœ€è¦å‡†å¤‡ä¸€ä¸ªURLå¤„ç†å™¨å’Œä¸€ä¸ªDispatcherServletã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ä¼šè¯çš„å¦ä¸€ç«¯ï¼Œå¦‚ä½•è®¿é—®æˆ‘ä»¬ä½¿ç”¨Hessianï¼ˆæˆ–Burlap)æ‰€å‘å¸ƒçš„æœåŠ¡ã€‚</p>
<h4 id="è®¿é—®Hessian-BurlapæœåŠ¡"><a href="#è®¿é—®Hessian-BurlapæœåŠ¡" class="headerlink" title="è®¿é—®Hessian/BurlapæœåŠ¡"></a>è®¿é—®Hessian/BurlapæœåŠ¡</h4><p>å›é¡¾ä¸€ä¸‹åœ¨15.2.2å°èŠ‚ä¸­ï¼Œåœ¨ä½¿ç”¨RmiProxyFactoryBeanè®¿é—®SpitteræœåŠ¡çš„å®¢æˆ·ç«¯ä»£ç ä¸­ï¼Œå®Œå…¨ä¸çŸ¥é“è¿™ä¸ªæœåŠ¡æ˜¯ä¸€ä¸ªRMIæœåŠ¡ã€‚äº‹å®ä¸Šï¼Œä¹Ÿæ ¹æœ¬æ²¡æœ‰ä»»ä½•è¿¹è±¡è¡¨æ˜è¿™ä¸ªæœåŠ¡æ˜¯ä¸€ä¸ªè¿œç¨‹æœåŠ¡ã€‚å®ƒåªæ˜¯ä¸SpitterServiceæ¥å£æ‰“äº¤é“â€”â€”RMIçš„æ‰€æœ‰ç»†èŠ‚å®Œå…¨åŒ…å«åœ¨Springé…ç½®ä¸­è¿™ä¸ªbeançš„é…ç½®ä¸­ã€‚å¥½å¤„æ˜¯å®¢æˆ·ç«¯ä¸éœ€è¦äº†è§£æœåŠ¡çš„å®ç°ï¼Œå› æ­¤ä»RMIå®¢æˆ·ç«¯è½¬åˆ°Hessianå®¢æˆ·ç«¯ä¼šå˜å¾—æå…¶ç®€å•ï¼Œä¸éœ€è¦æ”¹å˜ä»»ä½•å®¢æˆ·ç«¯çš„Javaä»£ç ã€‚</p>
<p>åå¤„æ˜¯ï¼Œå¦‚æœä½ çœŸçš„å–œæ¬¢ç¼–å†™Javaä»£ç çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸€èŠ‚æˆ–è®¸è®©ä½ å¤§å¤±æ‰€æœ›ã€‚è¿™æ˜¯å› ä¸ºåœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ï¼ŒåŸºäºRMIçš„æœåŠ¡ä¸åŸºäºHessiançš„æœåŠ¡ä¹‹é—´å”¯ä¸€çš„å·®åˆ«åœ¨äºè¦ä½¿ç”¨Springçš„HessianProxyFactoryBeanæ¥ä»£æ›¿RmiProxyFactoryBeanã€‚å®¢æˆ·ç«¯è°ƒç”¨åŸºäºHessiançš„SpitteræœåŠ¡å¯ä»¥ç”¨å¦‚ä¸‹çš„é…ç½®å£°æ˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">HessianProxyFactoryBean <span class="title">spitterService</span><span class="params">()</span> </span>&#123;  HessianProxyFactoryBean proxy = <span class="keyword">new</span> HessianProxyFactoryBean();  proxy.setServiceUrl(<span class="string">&quot;http://localhost:8080/Spitter/spitter.service&quot;</span>);  proxy.setServiceInterface(SpitterService.class);  <span class="keyword">return</span> proxy;&#125;</span><br></pre></td></tr></table></figure>

<p>å°±åƒåŸºäºRMIæœåŠ¡é‚£æ ·ï¼ŒserviceInterfaceå±æ€§æŒ‡å®šäº†è¿™ä¸ªæœåŠ¡å®ç°çš„æ¥å£ã€‚å¹¶ä¸”ï¼ŒåƒRmiProxyFactoryBeanä¸€æ ·ï¼ŒserviceUrlæ ‡è¯†äº†è¿™ä¸ªæœåŠ¡çš„URLã€‚æ—¢ç„¶Hessianæ˜¯åŸºäºHTTPçš„ï¼Œå½“ç„¶æˆ‘ä»¬åœ¨è¿™é‡Œè¦è®¾ç½®ä¸€ä¸ªHTTP URLï¼ˆURLæ˜¯ç”±æˆ‘ä»¬å…ˆå‰å®šä¹‰çš„URLæ˜ å°„æ‰€å†³å®šçš„ï¼‰ã€‚å›¾15.7å±•ç¤ºäº†å®¢æˆ·ç«¯ä»¥åŠç”±HessianProxyFactoryBeanæ‰€ç”Ÿæˆçš„ä»£ç†ä¹‹é—´æ˜¯å¦‚ä½•äº¤äº’çš„ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211111090129546.png" alt="image-20211111090129546"></p>
<p>å›¾15.7ã€€HessianProxyFactoryBeanå’ŒBurlapProxyFactoryBeanç”Ÿæˆçš„ä»£ç†å¯¹è±¡è´Ÿè´£</p>
<p>é€šè¿‡HTTPï¼ˆHessianä¸ºäºŒè¿›åˆ¶ã€Burlapä¸ºXMLï¼‰ä¸è¿œç¨‹å¯¹è±¡é€šä¿¡äº‹å®è¯æ˜ï¼ŒæŠŠBurlapæœåŠ¡è£…é…è¿›å®¢æˆ·ç«¯åŒæ ·ä¹Ÿæ²¡æœ‰å¤ªå¤šæ–°æ„ã€‚äºŒè€…å”¯ä¸€çš„åŒºåˆ«åœ¨äºï¼Œæˆ‘ä»¬è¦ä½¿ç”¨BurlapProxyFactoryBeanæ¥ä»£æ›¿HessianProxyFactoryBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">BurlapProxyFactoryBean <span class="title">spitterService</span><span class="params">()</span> </span>&#123;  BurlapProxyFactoryBean proxy = <span class="keyword">new</span> BurlapProxyFactoryBean();  proxy.setServiceUrl(<span class="string">&quot;http://localhost:8080/Spitter/spitter.service&quot;</span>);  proxy.setServiceInterface(SpitterService.class);  <span class="keyword">return</span> proxy;&#125;</span><br></pre></td></tr></table></figure>

<p>å°½ç®¡æˆ‘ä»¬è§‰å¾—åœ¨RMIã€Hessianå’ŒBurlapæœåŠ¡ä¹‹é—´ç¨å¾®ä¸åŒçš„é…ç½®æ˜¯å¾ˆæ— è¶£çš„ï¼Œä½†æ˜¯è¿™æ ·çš„å•è°ƒæ°æ°æ˜¯æœ‰å¥½å¤„çš„ã€‚å®ƒæ„å‘³ç€æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ¨å„ç§Springæ‰€æ”¯æŒçš„è¿œç¨‹è°ƒç”¨æŠ€æœ¯ä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œè€Œä¸éœ€è¦é‡æ–°å­¦ä¹ ä¸€ä¸ªå…¨æ–°çš„æ¨¡å‹ã€‚ä¸€æ—¦æˆ‘ä»¬é…ç½®äº†å¯¹RMIæœåŠ¡çš„å¼•ç”¨ï¼ŒæŠŠå®ƒé‡æ–°é…ç½®ä¸ºHessianæˆ–BurlapæœåŠ¡ä¹Ÿæ˜¯å¾ˆè½»æ¾çš„å·¥ä½œã€‚</p>
<p>å› ä¸ºHessianå’ŒBurlapéƒ½æ˜¯åŸºäºHTTPçš„ï¼Œå®ƒä»¬éƒ½è§£å†³äº†RMIæ‰€å¤´ç–¼çš„é˜²ç«å¢™æ¸—é€é—®é¢˜ã€‚ä½†æ˜¯å½“ä¼ é€’è¿‡æ¥çš„RPCæ¶ˆæ¯ä¸­åŒ…å«åºåˆ—åŒ–å¯¹è±¡æ—¶ï¼ŒRMIå°±å®ŒèƒœHessianå’ŒBurlapäº†ã€‚å› ä¸ºHessianå’ŒBurlapéƒ½é‡‡ç”¨äº†ç§æœ‰çš„åºåˆ—åŒ–æœºåˆ¶ï¼Œè€ŒRMIä½¿ç”¨çš„æ˜¯Javaæœ¬èº«çš„åºåˆ—åŒ–æœºåˆ¶ã€‚å¦‚æœæˆ‘ä»¬çš„æ•°æ®æ¨¡å‹éå¸¸å¤æ‚ï¼ŒHessian/Burlapçš„åºåˆ—åŒ–æ¨¡å‹å°±å¯èƒ½æ— æ³•èƒœä»»äº†ã€‚</p>
<p>æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªä¸¤å…¨å…¶ç¾çš„è§£å†³æ–¹æ¡ˆã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹Springçš„HTTP invokerï¼Œå®ƒåŸºäºHTTPæä¾›äº†RPCï¼ˆåƒHessian/Burlapä¸€æ ·ï¼‰ï¼ŒåŒæ—¶åˆä½¿ç”¨äº†Javaçš„å¯¹è±¡åºåˆ—åŒ–æœºåˆ¶ï¼ˆåƒRMIä¸€æ ·ï¼‰ã€‚</p>
<h3 id="ä½¿ç”¨Springçš„HttpInvoker"><a href="#ä½¿ç”¨Springçš„HttpInvoker" class="headerlink" title="ä½¿ç”¨Springçš„HttpInvoker"></a>ä½¿ç”¨Springçš„HttpInvoker</h3><p>Springå¼€å‘å›¢é˜Ÿæ„è¯†åˆ°RMIæœåŠ¡å’ŒåŸºäºHTTPçš„æœåŠ¡ï¼ˆä¾‹å¦‚Hessianå’ŒBurlapï¼‰ä¹‹é—´çš„ç©ºç™½ã€‚ä¸€æ–¹é¢ï¼ŒRMIä½¿ç”¨Javaæ ‡å‡†çš„å¯¹è±¡åºåˆ—åŒ–æœºåˆ¶ï¼Œä½†æ˜¯å¾ˆéš¾ç©¿é€é˜²ç«å¢™ã€‚å¦ä¸€æ–¹é¢ï¼ŒHessianå’ŒBurlapèƒ½å¾ˆå¥½åœ°ç©¿é€é˜²ç«å¢™ï¼Œä½†æ˜¯ä½¿ç”¨ç§æœ‰çš„å¯¹è±¡åºåˆ—åŒ–æœºåˆ¶ã€‚</p>
<p>å°±è¿™æ ·ï¼ŒSpringçš„HTTP invokeråº”è¿è€Œç”Ÿäº†ã€‚HTTP invokeræ˜¯ä¸€ä¸ªæ–°çš„è¿œç¨‹è°ƒç”¨æ¨¡å‹ï¼Œä½œä¸ºSpringæ¡†æ¶çš„ä¸€éƒ¨åˆ†ï¼Œèƒ½å¤Ÿæ‰§è¡ŒåŸºäºHTTPçš„è¿œç¨‹è°ƒç”¨ï¼ˆè®©é˜²ç«å¢™ä¸ä¸ºéš¾ï¼‰ï¼Œå¹¶ä½¿ç”¨Javaçš„åºåˆ—åŒ–æœºåˆ¶ï¼ˆè®©å¼€å‘è€…ä¹Ÿä¹è§‚å…¶å˜ï¼‰ã€‚ä½¿ç”¨åŸºäºHTTP invokerçš„æœåŠ¡å’Œä½¿ç”¨åŸºäºHessian/Burlapçš„æœåŠ¡éå¸¸ç›¸ä¼¼ã€‚</p>
<p>ä¸ºäº†å¼€å§‹å­¦ä¹ HTTP invokerï¼Œè®©æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹SpitteræœåŠ¡â€”â€”è¿™ä¸€æ¬¡æˆ‘ä»¬å°†ä½œä¸ºHTTP invokeræœåŠ¡æ¥å®ç°ã€‚</p>
<h4 id="å°†beanå¯¼å‡ºä¸ºHTTPæœåŠ¡"><a href="#å°†beanå¯¼å‡ºä¸ºHTTPæœåŠ¡" class="headerlink" title="å°†beanå¯¼å‡ºä¸ºHTTPæœåŠ¡"></a>å°†beanå¯¼å‡ºä¸ºHTTPæœåŠ¡</h4><p>è¦å°†beanå¯¼å‡ºä¸ºRMIæœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨RmiServiceExporterï¼›è¦å°†beanå¯¼å‡ºä¸ºHessianæœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨HessianServiceExporterï¼›è¦å°†beanå¯¼å‡ºä¸ºBurlapæœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨BurlapServiceExporterã€‚æŠŠè¿™ç§åƒç¯‡ä¸€å¾‹çš„ç”¨æ³•å¸¦åˆ°HTTP invokerä¸Šï¼Œåº”è¯¥ä¹Ÿä¸ä¼šæœ‰ä»»ä½•æ„å¤–çš„äº‹æƒ…å‘ç”Ÿï¼Œé‚£å°±æ˜¯å¯¼å‡ºHTTP invokeræœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨HttpInvokerServiceExporterã€‚</p>
<p>ä¸ºäº†æŠŠSpitteræœåŠ¡å¯¼å‡ºä¸ºä¸€ä¸ªåŸºäºHTTP invokerçš„æœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦åƒä¸‹é¢çš„é…ç½®ä¸€æ ·å£°æ˜ä¸€ä¸ªHttpInvokerServiceExporterbeanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">HttpInvokerServiceExporter <span class="title">httpExportedSpitterService</span><span class="params">(SpitterService service)</span> </span>&#123;  HttpInvokerServiceExporter exporter = <span class="keyword">new</span> HttpInvokerServiceExporter();  exporter.setService(service);  exporter.setServiceInterface(SpitterService.class);  <span class="keyword">return</span> exporter;&#125;</span><br></pre></td></tr></table></figure>

<p>æ˜¯å¦æœ‰ç‚¹ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰ï¼Ÿæˆ‘ä»¬å¾ˆéš¾æ‰¾å‡ºè¿™ä¸ªbeançš„å®šä¹‰å’Œé‚£äº›åœ¨15.3.2å°èŠ‚ä¸­æ‰€å£°æ˜çš„beanæœ‰ä»€ä¹ˆä¸åŒã€‚å”¯ä¸€çš„åŒºåˆ«åœ¨äºç±»åï¼šHttpInvokerServiceExporterã€‚å¦åˆ™çš„è¯ï¼Œè¿™ä¸ªå¯¼å‡ºå™¨å’Œå…¶ä»–çš„è¿œç¨‹æœåŠ¡çš„å¯¼å‡ºå™¨å°±æ²¡æœ‰ä»»ä½•åŒºåˆ«äº†ã€‚</p>
<p>å¦‚å›¾15.8æ‰€ç¤ºï¼ŒHttpInvokerServiceExporterçš„å·¥ä½œæ–¹å¼ä¸HessianService-Exporterå’ŒBurlapServiceExporterå¾ˆç›¸ä¼¼ã€‚HttpInvokerServiceExporterä¹Ÿæ˜¯ä¸€ä¸ªSpringçš„MVCæ§åˆ¶å™¨ï¼Œå®ƒé€šè¿‡DispatcherServletæ¥æ”¶æ¥è‡ªäºå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶å°†è¿™äº›è¯·æ±‚è½¬æ¢æˆå¯¹å®ç°æœåŠ¡çš„POJOçš„æ–¹æ³•è°ƒç”¨ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211111090603017.png" alt="image-20211111090603017"></p>
<p>å›¾15.8ã€€HttpInvokerServiceExporterå·¥ä½œæ–¹å¼ä¸Hessianå’ŒBurlapå¾ˆç›¸ä¼¼ï¼Œé€šè¿‡Spring MVCçš„DispatcherServletæ¥æ”¶è¯·æ±‚ï¼Œå¹¶å°†è¿™äº›è¯·æ±‚è½¬æ¢æˆå¯¹Spring bean<br>çš„æ–¹æ³•è°ƒç”¨</p>
<p>å› ä¸ºHttpInvokerServiceExporteræ˜¯ä¸€ä¸ªSpring MVCæ§åˆ¶å™¨ï¼Œæˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ªURLå¤„ç†å™¨ï¼Œæ˜ å°„HTTP URLåˆ°å¯¹åº”çš„æœåŠ¡ä¸Šï¼Œå°±åƒHessianå’ŒBurlapå¯¼å‡ºå™¨æ‰€åšçš„ä¸€æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">HandlerMapping <span class="title">hessianMapping</span><span class="params">()</span> </span>&#123;  SimpleUrlHandlerMapping mapping = <span class="keyword">new</span> SimpleUrlHandlerMapping();  Properties mappings = <span class="keyword">new</span> Properties();  mappings.setProperty(<span class="string">&quot;/spitter.service&quot;</span>, <span class="string">&quot;httpExportedSpitterService&quot;</span>);  mapping.setMappings(mappings);  <span class="keyword">return</span> mapping;&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·ï¼Œåƒä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿åŒ¹é…äº†DispatcherServletï¼Œè¿™æ ·æ‰èƒ½å¤„ç†å¯¹â€œ*.serviceâ€æ‰©å±•çš„è¯·æ±‚ã€‚å‚è€ƒ15.3.1å°èŠ‚äº†è§£å¦‚ä½•è®¾ç½®æ˜ å°„ã€‚</p>
<p>æˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•è®¿é—®ç”±RMIã€Hessianæˆ–Burlapæ‰€åˆ›å»ºçš„è¿œç¨‹æœåŠ¡ï¼Œç°åœ¨æˆ‘ä»¬å†æ¬¡è®©Spitterå®¢æˆ·ç«¯ä½¿ç”¨åˆšæ‰æ‰€å¯¼å‡ºçš„åŸºäºHTTP invokerçš„æœåŠ¡ã€‚</p>
<h4 id="é€šè¿‡HTTPè®¿é—®æœåŠ¡"><a href="#é€šè¿‡HTTPè®¿é—®æœåŠ¡" class="headerlink" title="é€šè¿‡HTTPè®¿é—®æœåŠ¡"></a>é€šè¿‡HTTPè®¿é—®æœåŠ¡</h4><p>è¿™å¬èµ·æ¥åƒæ‰“ç ´è®°å½•ï¼Œä½†æ˜¯æˆ‘è¿˜å¾—å‘Šè¯‰ä½ ï¼Œè®¿é—®åŸºäºHTTP invokerçš„æœåŠ¡å¾ˆç±»ä¼¼äºæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„å…¶ä»–è¿œç¨‹æœåŠ¡ä»£ç†ã€‚å®é™…ä¸Šå°±æ˜¯ä¸€æ ·çš„ã€‚å¦‚å›¾15.9æ‰€ç¤ºï¼ŒHttpInvokerProxyFactoryBeanå¡«å……äº†ç›¸åŒçš„ä½ç½®ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨æœ¬ç« æ‰€çœ‹åˆ°çš„å…¶ä»–è¿œç¨‹æœåŠ¡ä»£ç†å·¥å‚beanä¸€æ ·ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211111090737616.png" alt="image-20211111090737616"></p>
<p>å›¾15.9ã€€HttpInvokerProxyFactoryBeanæ˜¯ä¸€ä¸ªä»£ç†å·¥å‚beanï¼Œç”¨äºç”Ÿæˆä¸€ä¸ªä»£ç†ï¼Œè¯¥ä»£ç†ä½¿ç”¨Springç‰¹æœ‰çš„åŸºäºHTTPåè®®è¿›è¡Œè¿œç¨‹é€šä¿¡</p>
<p>ä¸ºäº†æŠŠåŸºäºHTTP invokerçš„è¿œç¨‹æœåŠ¡è£…é…è¿›æˆ‘ä»¬çš„å®¢æˆ·ç«¯Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»å°† HttpInvokerProxyFactoryBean é…ç½®ä¸ºä¸€ä¸ªbeanæ¥ä»£ç†å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">HttpInvokerProxyFactoryBean <span class="title">spitterService</span><span class="params">()</span> </span>&#123;  HttpInvokerProxyFactoryBean proxy = <span class="keyword">new</span> HttpInvokerProxyFactoryBean();  proxy.setServiceUrl(<span class="string">&quot;http://localhost:8080/Spitter/spitter.service&quot;</span>);  proxy.setServiceInterface(SpitterService.class);  <span class="keyword">return</span> proxy;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸15.2.2å°èŠ‚å’Œ15.3.2å°èŠ‚çš„beanå®šä¹‰ç›¸å¯¹æ¯”ï¼Œæˆ‘ä»¬ä¼šå‘ç°å‡ ä¹æ²¡ä»€ä¹ˆå˜åŒ–ã€‚serviceInterfaceå±æ€§ä»ç„¶ç”¨æ¥æ ‡è¯†SpitteræœåŠ¡æ‰€å®ç°çš„æ¥å£ï¼Œè€ŒserviceUrlå±æ€§ä»ç„¶ç”¨æ¥æ ‡è¯†è¿œç¨‹æœåŠ¡çš„ä½ç½®ã€‚å› ä¸ºHTTP invokeræ˜¯åŸºäºHTTPçš„ï¼Œå¦‚åŒHessianå’ŒBurlapä¸€æ ·ï¼ŒserviceUrlå¯ä»¥åŒ…å«ä¸Hessianå’ŒBurlapç‰ˆæœ¬ä¸­çš„beanä¸€æ ·çš„URLã€‚</p>
<p>éš¾é“ä½ ä¸å–œæ¬¢å¯¹ç§°ç¾å—ï¼Ÿ</p>
<p>Springçš„HTTP invokeræ˜¯ä½œä¸ºä¸¤å…¨å…¶ç¾çš„è¿œç¨‹è°ƒç”¨è§£å†³æ–¹æ¡ˆè€Œå‡ºç°çš„ï¼ŒæŠŠHTTPçš„ç®€å•æ€§å’ŒJavaå†…ç½®çš„å¯¹è±¡åºåˆ—åŒ–æœºåˆ¶èåˆåœ¨ä¸€èµ·ã€‚è¿™ä½¿å¾—HTTP invokeræœåŠ¡æˆä¸ºä¸€ä¸ªå¼•äººæ³¨ç›®çš„æ›¿ä»£RMIæˆ–Hessian/Burlapçš„å¯é€‰æ–¹æ¡ˆã€‚</p>
<p>è¦è®°ä½HTTP invokeræœ‰ä¸€ä¸ªé‡å¤§çš„é™åˆ¶ï¼šå®ƒåªæ˜¯ä¸€ä¸ªSpringæ¡†æ¶æ‰€æä¾›çš„è¿œç¨‹è°ƒç”¨è§£å†³æ–¹æ¡ˆã€‚è¿™æ„å‘³ç€å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¿…é¡»éƒ½æ˜¯Springåº”ç”¨ã€‚å¹¶ä¸”ï¼Œè‡³å°‘ç›®å‰è€Œè¨€ï¼Œä¹Ÿéšå«è¡¨æ˜å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¿…é¡»æ˜¯åŸºäºJavaçš„ã€‚å¦å¤–ï¼Œå› ä¸ºä½¿ç”¨äº†Javaçš„åºåˆ—åŒ–æœºåˆ¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¿…é¡»ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„ç±»ï¼ˆä¸RMIç±»ä¼¼ï¼‰ã€‚</p>
<p>RMIã€Hessianã€Burlapå’ŒHTTP invokeréƒ½æ˜¯è¿œç¨‹è°ƒç”¨çš„å¯é€‰è§£å†³æ–¹æ¡ˆã€‚ä½†æ˜¯å½“é¢ä¸´æ— æ‰€ä¸åœ¨çš„è¿œç¨‹è°ƒç”¨æ—¶ï¼ŒWebæœåŠ¡æ˜¯åŠ¿ä¸å¯æŒ¡çš„ã€‚ä¸‹ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†äº†è§£Springå¦‚ä½•å¯¹åŸºäºSOAPçš„WebæœåŠ¡è¿œç¨‹è°ƒç”¨æä¾›æ”¯æŒã€‚</p>
<h3 id="å‘å¸ƒå’Œä½¿ç”¨WebæœåŠ¡"><a href="#å‘å¸ƒå’Œä½¿ç”¨WebæœåŠ¡" class="headerlink" title="å‘å¸ƒå’Œä½¿ç”¨WebæœåŠ¡"></a>å‘å¸ƒå’Œä½¿ç”¨WebæœåŠ¡</h3><p>è¿‘å‡ å¹´ï¼Œæœ€æµè¡Œçš„ä¸€ä¸ªTLAï¼ˆä¸‰ä¸ªå­—æ¯ç¼©å†™ï¼‰å°±æ˜¯SOAï¼ˆé¢å‘æœåŠ¡çš„æ¶æ„ï¼‰ã€‚SOAå¯¹ä¸åŒçš„äººæ„å‘³ç€ä¸åŒçš„æ„ä¹‰ã€‚ä½†æ˜¯ï¼ŒSOAçš„æ ¸å¿ƒç†å¿µæ˜¯ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å¹¶ä¸”åº”è¯¥è¢«è®¾è®¡æˆä¾èµ–äºä¸€ç»„å…¬å…±çš„æ ¸å¿ƒæœåŠ¡ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªåº”ç”¨éƒ½é‡æ–°å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸€ä¸ªé‡‘èæœºæ„å¯èƒ½æœ‰è‹¥å¹²ä¸ªåº”ç”¨ï¼Œå…¶ä¸­å¾ˆå¤šéƒ½éœ€è¦è®¿é—®å€Ÿæ¬¾è€…çš„è´¦æˆ·ä¿¡æ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”ç”¨åº”è¯¥éƒ½ä¾èµ–äºä¸€ä¸ªå…¬å…±çš„è·å–è´¦æˆ·ä¿¡æ¯çš„æœåŠ¡ï¼Œè€Œä¸åº”è¯¥åœ¨æ¯ä¸€ä¸ªåº”ç”¨ä¸­éƒ½å»ºç«‹è´¦æˆ·è®¿é—®é€»è¾‘ï¼ˆå…¶ä¸­å¤§éƒ¨åˆ†é€»è¾‘éƒ½æ˜¯é‡å¤çš„ï¼‰ã€‚</p>
<p>Javaä¸WebæœåŠ¡çš„ç»“åˆå·²ç»æœ‰å¾ˆé•¿çš„å†å²äº†ï¼Œè€Œä¸”åœ¨Javaä¸­ä½¿ç”¨WebæœåŠ¡æœ‰å¤šç§é€‰æ‹©ã€‚å…¶ä¸­çš„å¤§å¤šæ•°å¯é€‰æ–¹æ¡ˆå·²ç»ä»¥æŸç§æ–¹å¼ä¸Springè¿›è¡Œäº†æ•´åˆã€‚è™½ç„¶Springä¸ºä½¿ç”¨Java API for XML Web Serviceï¼ˆJAX-WSï¼‰æ¥å‘å¸ƒå’Œä½¿ç”¨SOAP WebæœåŠ¡æä¾›äº†å¤§åŠ›æ”¯æŒï¼Œä½†æ˜¯åœ¨æœ¬ä¹¦æˆ‘ä¸å¯èƒ½æ¶µç›–æ¯ä¸€ä¸ªSpringæ‰€æ”¯æŒçš„WebæœåŠ¡æ¡†æ¶å’Œå·¥å…·ç®±ã€‚</p>
<p>åœ¨æœ¬èŠ‚ï¼Œæˆ‘ä»¬é‡æ–°å›é¡¾ä¸‹SpitteræœåŠ¡ç¤ºä¾‹ï¼Œä¸è¿‡è¿™æ¬¡æˆ‘ä»¬å°†ä½¿ç”¨Springå¯¹JAX-WSçš„æ”¯æŒæ¥æŠŠSpitteræœåŠ¡å‘å¸ƒä¸ºWebæœåŠ¡å¹¶ä½¿ç”¨æ­¤WebæœåŠ¡ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨Springä¸­åˆ›å»ºJAX-WS WebæœåŠ¡ã€‚</p>
<h4 id="åˆ›å»ºåŸºäºSpringçš„JAX-WSç«¯ç‚¹"><a href="#åˆ›å»ºåŸºäºSpringçš„JAX-WSç«¯ç‚¹" class="headerlink" title="åˆ›å»ºåŸºäºSpringçš„JAX-WSç«¯ç‚¹"></a>åˆ›å»ºåŸºäºSpringçš„JAX-WSç«¯ç‚¹</h4><p>åœ¨æœ¬ç« å‰é¢çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Springçš„æœåŠ¡å¯¼å‡ºå™¨åˆ›å»ºäº†è¿œç¨‹æœåŠ¡ã€‚è¿™äº›æœåŠ¡å¯¼å‡ºå™¨å¾ˆç¥å¥‡åœ°å°†Springé…ç½®çš„POJOè½¬æ¢æˆäº†è¿œç¨‹æœåŠ¡ã€‚æˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨RmiServiceExporteråˆ›å»ºRMIæœåŠ¡ï¼Œå¦‚ä½•ä½¿ç”¨HessianServiceExporteråˆ›å»ºHessianæœåŠ¡ï¼Œå¦‚ä½•ä½¿ç”¨BurlapServiceExporteråˆ›å»ºBurlapæœåŠ¡ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨HttpInvokerServiceExporteråˆ›å»ºHTTP invokeræœåŠ¡ã€‚ç°åœ¨ä½ æˆ–è®¸æœŸæœ›æˆ‘åœ¨æœ¬èŠ‚å±•ç¤ºå¦‚ä½•ä½¿ç”¨ä¸€ä¸ªJAX-WSæœåŠ¡å¯¼å‡ºå™¨åˆ›å»ºWebæœåŠ¡ã€‚</p>
<p>Springçš„ç¡®æä¾›äº†ä¸€ä¸ªJAX-WSæœåŠ¡å¯¼å‡ºå™¨ï¼ŒSimpleJaxWsServiceExporterï¼Œæˆ‘ä»¬å¾ˆå¿«å°±å¯ä»¥çœ‹åˆ°ã€‚ä½†åœ¨è¿™ä¹‹å‰ï¼Œä½ å¿…é¡»çŸ¥é“å®ƒå¹¶ä¸ä¸€å®šæ˜¯æ‰€æœ‰åœºæ™¯ä¸‹çš„æœ€å¥½é€‰æ‹©ã€‚ä½ æ˜¯çŸ¥é“çš„ï¼ŒSimpleJaxWsServiceExporterè¦æ±‚JAX-WSè¿è¡Œæ—¶æ”¯æŒå°†ç«¯ç‚¹å‘å¸ƒåˆ°æŒ‡å®šåœ°å€ä¸Šã€‚Sun JDK 1.6è‡ªå¸¦çš„JAX-WSå¯ä»¥ç¬¦åˆè¦æ±‚ï¼Œä½†æ˜¯å…¶ä»–çš„JAX-WSå®ç°ï¼ŒåŒ…æ‹¬JAX-WSçš„å‚è€ƒå®ç°ï¼Œå¯èƒ½å¹¶ä¸èƒ½æ»¡è¶³æ­¤éœ€æ±‚ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å°†è¦éƒ¨ç½²çš„JAX-WSè¿è¡Œæ—¶ä¸æ”¯æŒå°†å…¶å‘å¸ƒåˆ°æŒ‡å®šåœ°å€ä¸Šï¼Œé‚£æˆ‘ä»¬å°±è¦ä»¥æ›´ä¸ºä¼ ç»Ÿçš„æ–¹å¼æ¥ç¼–å†™JAX-WSç«¯ç‚¹ã€‚è¿™æ„å‘³ç€ç«¯ç‚¹çš„ç”Ÿå‘½å‘¨æœŸç”±JAX-WSè¿è¡Œæ—¶æ¥è¿›è¡Œç®¡ç†ï¼Œè€Œä¸æ˜¯Springã€‚ä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€å®ƒä»¬ä¸èƒ½è£…é…Springä¸Šä¸‹æ–‡ä¸­çš„beanã€‚</p>
<p>åœ¨Springä¸­è‡ªåŠ¨è£…é…JAX-WSç«¯ç‚¹</p>
<p>JAX-WSç¼–ç¨‹æ¨¡å‹ä½¿ç”¨æ³¨è§£å°†ç±»å’Œç±»çš„æ–¹æ³•å£°æ˜ä¸ºWebæœåŠ¡çš„æ“ä½œã€‚ä½¿ç”¨@WebServiceæ³¨è§£æ‰€æ ‡æ³¨çš„ç±»è¢«è®¤ä¸ºWebæœåŠ¡çš„ç«¯ç‚¹ï¼Œè€Œä½¿ç”¨@WebMethodæ³¨è§£æ‰€æ ‡æ³¨çš„æ–¹æ³•è¢«è®¤ä¸ºæ˜¯æ“ä½œã€‚</p>
<p>å°±åƒå¤§è§„æ¨¡åº”ç”¨ä¸­çš„å…¶ä»–å¯¹è±¡ä¸€æ ·ï¼ŒJAX-WSç«¯ç‚¹å¾ˆå¯èƒ½éœ€è¦ä¸å…¶ä»–å¯¹è±¡äº¤äº’æ¥å®Œæˆå·¥ä½œã€‚è¿™æ„å‘³ç€JAX-WSç«¯ç‚¹å¯ä»¥å—ç›Šäºä¾èµ–æ³¨å…¥ã€‚ä½†æ˜¯å¦‚æœç«¯ç‚¹çš„ç”Ÿå‘½å‘¨æœŸç”±JAX-WSè¿è¡Œæ—¶æ¥ç®¡ç†ï¼Œè€Œä¸æ˜¯ç”±Springæ¥ç®¡ç†çš„è¯ï¼Œè¿™ä¼¼ä¹ä¸å¯èƒ½æŠŠSpringç®¡ç†çš„beanè£…é…è¿›JAX-WSç®¡ç†çš„ç«¯ç‚¹å®ä¾‹ä¸­ã€‚</p>
<p>è£…é…JAX-WSç«¯ç‚¹çš„ç§˜å¯†åœ¨äºç»§æ‰¿SpringBeanAutowiringSupportã€‚é€šè¿‡ç»§æ‰¿SpringBeanAutowiringSupportï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Autowiredæ³¨è§£æ ‡æ³¨ç«¯ç‚¹çš„å±æ€§ï¼Œä¾èµ–å°±ä¼šè‡ªåŠ¨æ³¨å…¥äº†ã€‚SpitterServiceEndpointå±•ç¤ºäº†å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<p>ç¨‹åºæ¸…å•15.2ã€€JAX-WSç«¯ç‚¹ä¸­çš„SpitterBeanAutowiringSupport</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.remoting.jaxws;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> javax.jws.WebMethod;<span class="keyword">import</span> javax.jws.WebService;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.web.context.support.SpringBeanAutowiringSupport;<span class="keyword">import</span> com.habuma.spittr.domain.Spitter;<span class="keyword">import</span> com.habuma.spittr.domain.Spittle;<span class="keyword">import</span> com.habuma.spittr.service.SpitterService<span class="meta">@WebService(serviceName=&quot;SpitterService&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpitterServiceEndpoint</span> <span class="keyword">extends</span> <span class="title">SpringBeanAutowiringSupport</span> </span>&#123;  <span class="meta">@Autowired</span>  SpitterService spitterService;    <span class="meta">@WebMethod</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpittle</span><span class="params">(Spittle spittle)</span> </span>&#123;    spitterService.saveSpittle(spittle);  &#125;    <span class="meta">@WebMethod</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteSpittle</span><span class="params">(<span class="keyword">long</span> spittleld)</span> </span>&#123;    spitterService.deleteSpittle(spittleld);  &#125;    <span class="meta">@WebMethod</span>  <span class="function"><span class="keyword">public</span> List&lt;Spittle&gt; <span class="title">getRecentSpittles</span><span class="params">(<span class="keyword">int</span> spittleCount)</span> </span>&#123;    <span class="keyword">return</span> SpitterService.getRecentSpittles(spittleCount);  &#125;    <span class="meta">@WebMethod</span>  <span class="function"><span class="keyword">public</span> List&lt;Spittle&gt; <span class="title">getSpittlesForSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;    <span class="keyword">return</span> spitterService.getSpittlesForSpitter(spitter);  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åœ¨SpitterServiceå±æ€§ä¸Šä½¿ç”¨@Autowiredæ³¨è§£æ¥è¡¨æ˜å®ƒåº”è¯¥è‡ªåŠ¨æ³¨å…¥ä¸€ä¸ªä»Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰€è·å–çš„beanã€‚åœ¨è¿™é‡Œï¼Œç«¯ç‚¹å§”æ‰˜æ³¨å…¥çš„SpitterServiceæ¥å®Œæˆå®é™…çš„å·¥ä½œã€‚</p>
<p>å¯¼å‡ºç‹¬ç«‹çš„JAX-WSç«¯ç‚¹</p>
<p>æ­£å¦‚æˆ‘æ‰€è¯´çš„ï¼Œå½“å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸æ˜¯ç”±Springç®¡ç†çš„ï¼Œè€Œå¯¹è±¡çš„å±æ€§åˆéœ€è¦æ³¨å…¥Springæ‰€ç®¡ç†çš„beanæ—¶ï¼ŒSpringBeanAutowiringSupportå¾ˆæœ‰ç”¨ã€‚åœ¨åˆé€‚åœºæ™¯ä¸‹ï¼Œè¿˜æ˜¯å¯ä»¥æŠŠSpringç®¡ç†çš„beanå¯¼å‡ºä¸ºJAX-WSç«¯ç‚¹çš„ã€‚</p>
<p>SpringSimpleJaxWsServiceExporterçš„å·¥ä½œæ–¹å¼å¾ˆç±»ä¼¼äºæœ¬ç« å‰è¾¹æ‰€ä»‹ç»çš„å…¶ä»–æœåŠ¡å¯¼å‡ºå™¨ã€‚å®ƒæŠŠSpringç®¡ç†çš„beanå‘å¸ƒä¸ºJAXWSè¿è¡Œæ—¶ä¸­çš„æœåŠ¡ç«¯ç‚¹ã€‚ä¸å…¶ä»–æœåŠ¡å¯¼å‡ºå™¨ä¸åŒï¼ŒSimpleJaxWsServiceExporterä¸éœ€è¦ä¸ºå®ƒæŒ‡å®šä¸€ä¸ªè¢«å¯¼å‡ºbeançš„å¼•ç”¨ï¼Œå®ƒä¼šå°†ä½¿ç”¨JAX-WSæ³¨è§£æ‰€æ ‡æ³¨çš„æ‰€æœ‰beanå‘å¸ƒä¸ºJAXWSæœåŠ¡ã€‚</p>
<p>SimpleJaxWsServiceExporterå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„@Beanæ–¹æ³•æ¥é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">SimpleJaxWsServiceExporter <span class="title">jaxWsExporter</span><span class="params">()</span> </span>&#123;  <span class="keyword">return</span> <span class="keyword">new</span> SimpleJaxWsServiceExporter();&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼ŒSimpleJaxWsServiceExporterä¸éœ€è¦å†åšå…¶ä»–çš„äº‹æƒ…å°±å¯ä»¥å®Œæˆæ‰€æœ‰çš„å·¥ä½œã€‚å½“å¯åŠ¨çš„æ—¶å€™ï¼Œå®ƒä¼šæœç´¢Springåº”ç”¨ä¸Šä¸‹æ–‡æ¥æŸ¥æ‰¾æ‰€æœ‰ä½¿ç”¨@WebServiceæ³¨è§£çš„beanã€‚å½“æ‰¾åˆ°ç¬¦åˆçš„beanæ—¶ï¼ŒSimpleJaxWsServiceExporterä½¿ç”¨<a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080/</a> åœ°å€å°†beanå‘å¸ƒä¸ºJAX-WSç«¯ç‚¹ã€‚SpitterServiceEndpointå°±æ˜¯å…¶ä¸­ä¸€ä¸ªè¢«æŸ¥æ‰¾åˆ°çš„beanã€‚</p>
<p>ç¨‹åºæ¸…å•15.3ã€€SimpleJaxWsServiceExporterå°†beanè½¬å˜ä¸ºJAX-WSç«¯ç‚¹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.remoting.jaxws;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> javax.jws.WebMethod;<span class="keyword">import</span> javax.jws.WebService;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.stereotype.Component;<span class="keyword">import</span> com.habuma.spittr.domain.Spitter;<span class="keyword">import</span> com.habuma.spittr.domain.Spittle;<span class="keyword">import</span> com.habuma.spittr.service.SpitterService;<span class="meta">@Component</span><span class="meta">@WebService(serviceName=&quot;SpitterService&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpitterServiceEndpoint</span> </span>&#123;  <span class="meta">@Autowired</span>  SpitterService SpitterService;    <span class="meta">@WebMethod</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpittle</span><span class="params">(Spittle spittle)</span> </span>&#123;    SpitterService.saveSpittle(spittle);  &#125;    <span class="meta">@WebMethod</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteSpittle</span><span class="params">(<span class="keyword">long</span> spittleld)</span> </span>&#123;    spitterService.deleteSpittle(spittleld);  )    <span class="meta">@WebMethod</span>  <span class="function"><span class="keyword">public</span> List&lt;Spittle&gt; <span class="title">getRecentSpittles</span><span class="params">(<span class="keyword">int</span> spittleCount)</span> </span>&#123;    <span class="keyword">return</span> SpitterService.getRecentSpittles(spittleCount);  &#125;    <span class="meta">@WebMethod</span>  <span class="function"><span class="keyword">public</span> List&lt;Spittle&gt; <span class="title">getSpittlesForSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;    <span class="keyword">return</span> SpitterService.getSpittlesForSpitter(spitter);  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ³¨æ„åˆ°SpitterServiceEndpointçš„æ–°å®ç°ä¸å†ç»§æ‰¿SpringBeanAutowiringSupportäº†ã€‚å®ƒå®Œå…¨å°±æ˜¯ä¸€ä¸ªSpringbeanï¼Œå› æ­¤SpitterServiceEndpointä¸éœ€è¦ç»§æ‰¿ä»»ä½•ç‰¹æ®Šçš„æ”¯æŒç±»å°±å¯ä»¥å®ç°è‡ªåŠ¨è£…é…ã€‚</p>
<p>å› ä¸ºSimpleJaxWsServiceEndpointçš„é»˜è®¤åŸºæœ¬åœ°å€ä¸º<a target="_blank" rel="noopener" href="http://localhost:8080/%EF%BC%8C%E8%80%8CSpitterServiceEndpoint%E4%BD%BF%E7%94%A8%E4%BA%86@Webservice(servicename=&quot;SpitterService&quot;)%E6%B3%A8%E8%A7%A3%EF%BC%8C%E6%89%80%E4%BB%A5%E8%BF%99%E4%B8%A4%E4%B8%AAbean%E6%89%80%E5%BD%A2%E6%88%90%E7%9A%84Web%E6%9C%8D%E5%8A%A1%E5%9C%B0%E5%9D%80%E5%9D%87%E4%B8%BAhttp://localhost:8080/SpitterService%E3%80%82%E4%BD%86%E6%98%AF%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%AE%8C%E5%85%A8%E6%8E%A7%E5%88%B6%E6%9C%8D%E5%8A%A1URL%EF%BC%8C%E5%A6%82%E6%9E%9C%E5%B8%8C%E6%9C%9B%E8%B0%83%E6%95%B4%E6%9C%8D%E5%8A%A1URL%E7%9A%84%E8%AF%9D%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E8%B0%83%E6%95%B4%E5%9F%BA%E6%9C%AC%E5%9C%B0%E5%9D%80%E3%80%82%E4%BE%8B%E5%A6%82%EF%BC%8C%E5%A6%82%E4%B8%8BSimpleJaxWsServiceEndpoint%E7%9A%84%E9%85%8D%E7%BD%AE%E6%8A%8A%E7%9B%B8%E5%90%8C%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%82%B9%E5%8F%91%E5%B8%83%E5%88%B0http://localhost:8888">http://localhost:8080/ï¼Œè€ŒSpitterServiceEndpointä½¿ç”¨äº†@Webservice(servicename=&quot;SpitterService&quot;)æ³¨è§£ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªbeanæ‰€å½¢æˆçš„WebæœåŠ¡åœ°å€å‡ä¸ºhttp://localhost:8080/SpitterServiceã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å®Œå…¨æ§åˆ¶æœåŠ¡URLï¼Œå¦‚æœå¸Œæœ›è°ƒæ•´æœåŠ¡URLçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒæ•´åŸºæœ¬åœ°å€ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹SimpleJaxWsServiceEndpointçš„é…ç½®æŠŠç›¸åŒçš„æœåŠ¡ç«¯ç‚¹å‘å¸ƒåˆ°http://localhost:8888</a> /srvices/SpitterServiceã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">SimpleJaxWsServiceExporter <span class="title">jaxWsExporter</span><span class="params">()</span> </span>&#123;  SimpleJaxWsServiceExporter exporter = <span class="keyword">new</span> SimpleJaxWsServiceExporter();  exporter.setBaseAddress(<span class="string">&quot;http://localhost:8888/services/&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>SimpleJaxWsServiceEndpointå°±åƒçœ‹èµ·æ¥é‚£ä¹ˆç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬åº”è¯¥æ³¨æ„å®ƒåªèƒ½ç”¨åœ¨æ”¯æŒå°†ç«¯ç‚¹å‘å¸ƒåˆ°æŒ‡å®šåœ°å€çš„JAX-WSè¿è¡Œæ—¶ä¸­ã€‚è¿™åŒ…å«äº†Sun 1.6 JDKè‡ªå¸¦çš„JAX-WSè¿è¡Œæ—¶ã€‚å…¶ä»–çš„JAX-WSè¿è¡Œæ—¶ï¼Œä¾‹å¦‚JAX-WS 2.1çš„å‚è€ƒå®ç°ï¼Œä¸æ”¯æŒè¿™ç§ç±»å‹çš„ç«¯ç‚¹å‘å¸ƒï¼Œå› æ­¤ä¹Ÿå°±ä¸èƒ½ä½¿ç”¨SimpleJaxWsServiceEndpointã€‚</p>
<h4 id="åœ¨å®¢æˆ·ç«¯ä»£ç†JAX-WSæœåŠ¡"><a href="#åœ¨å®¢æˆ·ç«¯ä»£ç†JAX-WSæœåŠ¡" class="headerlink" title="åœ¨å®¢æˆ·ç«¯ä»£ç†JAX-WSæœåŠ¡"></a>åœ¨å®¢æˆ·ç«¯ä»£ç†JAX-WSæœåŠ¡</h4><p>ä½¿ç”¨Springå‘å¸ƒWebæœåŠ¡ä¸æˆ‘ä»¬ä½¿ç”¨RMIã€Hessianã€Burlapå’ŒHTTP invokerå‘å¸ƒæœåŠ¡æ˜¯æœ‰æ‰€ä¸åŒçš„ã€‚ä½†æ˜¯æˆ‘ä»¬å¾ˆå¿«å°±ä¼šå‘ç°ï¼Œå€ŸåŠ©Springä½¿ç”¨WebæœåŠ¡æ‰€æ¶‰åŠçš„å®¢æˆ·ç«¯ä»£ç†çš„å·¥ä½œæ–¹å¼ä¸åŸºäºSpringçš„å®¢æˆ·ç«¯ä½¿ç”¨å…¶ä»–è¿œç¨‹è°ƒç”¨æŠ€æœ¯æ˜¯ç›¸åŒçš„ã€‚</p>
<p>ä½¿ç”¨JaxWsProxyFactoryBeanï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Springä¸­è£…é…Spitter WebæœåŠ¡ï¼Œä¸ä»»æ„ä¸€ä¸ªå…¶ä»–çš„beanä¸€æ ·ã€‚JaxWsProxyFactoryBeanæ˜¯Springå·¥å‚beanï¼Œå®ƒèƒ½ç”Ÿæˆä¸€ä¸ªçŸ¥é“å¦‚ä½•ä¸SOAP WebæœåŠ¡äº¤äº’çš„ä»£ç†ã€‚æ‰€åˆ›å»ºçš„ä»£ç†å®ç°äº†æœåŠ¡æ¥å£ï¼ˆå¦‚å›¾15.10æ‰€ç¤ºï¼‰ã€‚å› æ­¤ï¼ŒJaxWsProxyFactoryBeanè®©è£…é…å’Œä½¿ç”¨ä¸€ä¸ªè¿œç¨‹WebæœåŠ¡å˜æˆäº†å¯èƒ½ï¼Œå°±åƒè¿™ä¸ªè¿œç¨‹WebæœåŠ¡æ˜¯æœ¬åœ°POJOä¸€æ ·ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211111092403336.png" alt="image-20211111092403336"><br>å›¾15.10ã€€JaxWsPortProxyFactoryBeanç”Ÿæˆå¯ä»¥ä¸è¿œç¨‹WebæœåŠ¡äº¤äº’çš„ä»£ç†ã€‚è¿™äº›ä»£ç†å¯ä»¥è¢«è£…é…åˆ°å…¶ä»–beanä¸­ï¼Œå°±åƒå®ƒä»¬æ˜¯æœ¬åœ°POJOä¸€æ ·æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·é…ç½®JaxWsPortProxyFactoryBeanæ¥å¼•ç”¨SpitteræœåŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">JaxWsProxyFactoryBean <span class="title">spitterService</span><span class="params">()</span> </span>&#123;  JaxWsProxyFactoryBean proxy = <span class="keyword">new</span> JaxWsProxyFactoryBean();  proxy.setWsdlDocument(<span class="string">&quot;http://localhost:8080/services/SpitterService?wsdl&quot;</span>);  proxy.setServiceName(<span class="string">&quot;spitterService&quot;</span>);  proxy.setPortName(<span class="string">&quot;spitterServiceHttpPort&quot;</span>);  proxy.setServiceInterface(SpitterService.class);  proxy.setNamespaceUrl(<span class="string">&quot;http://spitter.com&quot;</span>);  <span class="keyword">return</span> proxy;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸ºJaxWsPortProxyFactoryBeanè®¾ç½®å‡ ä¸ªå±æ€§å°±å¯ä»¥å·¥ä½œäº†ã€‚wsdlDocumentUrlå±æ€§æ ‡è¯†äº†è¿œç¨‹WebæœåŠ¡å®šä¹‰æ–‡ä»¶çš„ä½ç½®ã€‚ JaxWsPortProxyFactory beanå°†ä½¿ç”¨è¿™ä¸ªä½ç½®ä¸Šå¯ç”¨çš„WSDLæ¥ä¸ºæœåŠ¡åˆ›å»ºä»£ç†ã€‚ç”±JaxWsPortProxyFactoryBeanæ‰€ç”Ÿæˆçš„ä»£ç†å®ç°äº†serviceInterfaceå±æ€§æ‰€æŒ‡å®šçš„SpitterServiceæ¥å£ã€‚</p>
<p>å‰©ä¸‹çš„ä¸‰ä¸ªå±æ€§çš„å€¼é€šå¸¸å¯ä»¥é€šè¿‡æŸ¥çœ‹æœåŠ¡çš„WSDLæ¥ç¡®å®šã€‚ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬å‡è®¾ä¸ºSpitteræœåŠ¡çš„WSDLå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">wsdl:definitions</span> <span class="attr">targetNamespace</span>=<span class="string">&quot;http://spitter.com&quot;</span>&gt;</span>...  <span class="tag">&lt;<span class="name">wsdl:service</span> <span class="attr">name</span>=<span class="string">&quot;spitterService&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">wsdl:port</span> <span class="attr">name</span>=<span class="string">&quot;spitterServiceHttpPort&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;tns:spitterServiceHttpBinding&quot;</span>&gt;</span>...    <span class="tag">&lt;/<span class="name">wsdl:port</span>&gt;</span>  <span class="tag">&lt;/<span class="name">wsdl:service</span>&gt;</span><span class="tag">&lt;/<span class="name">wsdl:definitions</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è™½ç„¶ä¸å¤ªå¯èƒ½è¿™ä¹ˆåšï¼Œä½†æ˜¯åœ¨æœåŠ¡çš„WSDLä¸­å®šä¹‰å¤šä¸ªæœåŠ¡å’Œç«¯å£æ˜¯å…è®¸çš„ã€‚é‰´äºæ­¤ï¼ŒJaxWsPortProxyFactoryBeanéœ€è¦æˆ‘ä»¬ä½¿ç”¨portNameå’ŒserviceNameå±æ€§æŒ‡å®šç«¯å£å’ŒæœåŠ¡åç§°ã€‚WSDLä¸­<code>&lt;wsdl:port&gt;</code>å’Œ<code>&lt;wsdl:service&gt;</code>å…ƒç´ çš„nameå±æ€§å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¯†åˆ«å‡ºè¿™äº›å±æ€§è¯¥è®¾ç½®æˆä»€ä¹ˆã€‚</p>
<p>æœ€åï¼ŒnamespaceUriå±æ€§æŒ‡å®šäº†æœåŠ¡çš„å‘½åç©ºé—´ã€‚å‘½åç©ºé—´å°†æœ‰åŠ©äºJaxWsPortProxyFactoryBeanå»å®šä½WSDLä¸­çš„æœåŠ¡å®šä¹‰ã€‚æ­£å¦‚ç«¯å£å’ŒæœåŠ¡åä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨WSDLä¸­æ‰¾åˆ°è¯¥å±æ€§çš„æ­£ç¡®å€¼ã€‚å®ƒé€šå¸¸ä¼šåœ¨<a href="wsdl:definitions">wsdl:definitions</a>çš„targetNamespaceå±æ€§ä¸­ã€‚</p>
<h3 id="å°ç»“-14"><a href="#å°ç»“-14" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>ä½¿ç”¨è¿œç¨‹æœåŠ¡é€šå¸¸æ˜¯ä¸€ä¸ªä¹å‘³çš„è‹¦å·®äº‹ï¼Œä½†æ˜¯Springæä¾›äº†å¯¹è¿œç¨‹æœåŠ¡çš„æ”¯æŒï¼Œè®©ä½¿ç”¨è¿œç¨‹æœåŠ¡ä¸ä½¿ç”¨æ™®é€šçš„JavaBeanä¸€æ ·ç®€å•ã€‚</p>
<p>åœ¨å®¢æˆ·ç«¯ï¼ŒSpringæä¾›äº†ä»£ç†å·¥å‚beanï¼Œèƒ½è®©æˆ‘ä»¬åœ¨Springåº”ç”¨ä¸­é…ç½®è¿œç¨‹æœåŠ¡ã€‚ä¸ç®¡æ˜¯ä½¿ç”¨RMIã€Hessianã€Burlapã€Springçš„HTTP invokerï¼Œè¿˜æ˜¯WebæœåŠ¡ï¼Œéƒ½å¯ä»¥æŠŠè¿œç¨‹æœåŠ¡è£…é…è¿›æˆ‘ä»¬çš„åº”ç”¨ä¸­ï¼Œå¥½åƒå®ƒä»¬å°±æ˜¯POJOä¸€æ ·ã€‚Springç”šè‡³æ•è·äº†æ‰€æœ‰çš„RemoteExecptionå¼‚å¸¸ï¼Œå¹¶åœ¨å‘ç”Ÿå¼‚å¸¸çš„åœ°æ–¹é‡æ–°æŠ›å‡ºè¿è¡ŒæœŸå¼‚å¸¸RemoteAccessExceptionï¼Œè®©æˆ‘ä»¬çš„ä»£ç å¯ä»¥ä»å¤„ç†ä¸å¯æ¢å¤çš„å¼‚å¸¸ä¸­è§£æ”¾å‡ºæ¥ã€‚</p>
<p>å³ä¾¿Springéšè—äº†è¿œç¨‹æœåŠ¡çš„å¾ˆå¤šç»†èŠ‚ï¼Œè®©å®ƒä»¬è¡¨ç°å¾—å¥½åƒæ˜¯æœ¬åœ°JavaBeanä¸€æ ·ï¼Œä½†æ˜¯æˆ‘ä»¬åº”è¯¥æ—¶åˆ»è°¨è®°å®ƒä»¬æ˜¯è¿œç¨‹æœåŠ¡çš„äº‹å®ã€‚è¿œç¨‹æœåŠ¡ï¼Œæœ¬è´¨ä¸Šæ¥è®²ï¼Œé€šå¸¸æ¯”æœ¬åœ°æœåŠ¡æ›´ä½æ•ˆã€‚å½“ç¼–å†™è®¿é—®è¿œç¨‹æœåŠ¡çš„ä»£ç æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œé™åˆ¶è¿œç¨‹è°ƒç”¨ï¼Œä»¥è§„é¿æ€§èƒ½ç“¶é¢ˆã€‚</p>
<p>åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†Springæ˜¯å¦‚ä½•ä½¿ç”¨å‡ ç§åŸºæœ¬çš„è¿œç¨‹è°ƒç”¨æŠ€æœ¯æ¥å‘å¸ƒå’Œä½¿ç”¨æœåŠ¡çš„ã€‚å°½ç®¡è¿™äº›è¿œç¨‹è°ƒç”¨æ–¹æ¡ˆåœ¨åˆ†å¸ƒå¼åº”ç”¨ä¸­å¾ˆæœ‰ä»·å€¼ï¼Œä½†è¿™åªæ˜¯æ¶‰åŠé¢å‘æœåŠ¡æ¶æ„ï¼ˆSOA)çš„ä¸€é³åŠçˆªã€‚</p>
<p>æˆ‘ä»¬è¿˜äº†è§£äº†å¦‚ä½•å°†beanå¯¼å‡ºä¸ºåŸºäºSOAPçš„WebæœåŠ¡ã€‚å°½ç®¡è¿™æ˜¯å¼€å‘WebæœåŠ¡çš„ä¸€ç§ç®€å•æ–¹å¼ï¼Œä½†ä»æ¶æ„è§’åº¦æ¥çœ‹ï¼Œå®ƒå¯èƒ½ä¸æ˜¯æœ€ä½³çš„é€‰æ‹©ã€‚åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†å­¦ä¹ æ„å»ºåˆ†å¸ƒå¼åº”ç”¨çš„å¦ä¸€ç§é€‰æ‹©ï¼ŒæŠŠåº”ç”¨æš´éœ²ä¸ºRESTfulèµ„æºã€‚</p>
<h2 id="ä½¿ç”¨-Spring-MVC-åˆ›å»º-REST-API"><a href="#ä½¿ç”¨-Spring-MVC-åˆ›å»º-REST-API" class="headerlink" title="ä½¿ç”¨ Spring MVC åˆ›å»º REST API"></a>ä½¿ç”¨ Spring MVC åˆ›å»º REST API</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>ç¼–å†™å¤„ç†RESTèµ„æºçš„æ§åˆ¶å™¨</li>
<li>ä»¥XMLã€JSONåŠå…¶ä»–æ ¼å¼æ¥è¡¨è¿°èµ„æº</li>
<li>ä½¿ç”¨RESTèµ„æº</li>
</ul>
<p>æ•°æ®ä¸ºç‹ã€‚</p>
<p>ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬ç»å¸¸å…³æ³¨äºæ„å»ºä¼Ÿå¤§çš„è½¯ä»¶æ¥è§£å†³ä¸šåŠ¡é—®é¢˜ã€‚æ•°æ®åªæ˜¯è½¯ä»¶å®Œæˆå·¥ä½œæ—¶è¦å¤„ç†çš„åŸææ–™ã€‚ä½†æ˜¯å¦‚æœä½ é—®ä¸€ä¸‹ä¸šåŠ¡äººå‘˜ï¼Œæ•°æ®å’Œè½¯ä»¶è°æ›´é‡è¦çš„è¯ï¼Œä»–ä»¬å¾ˆå¯èƒ½ä¼šé€‰æ‹©æ•°æ®ã€‚æ•°æ®æ˜¯è®¸å¤šä¸šåŠ¡çš„ç”Ÿå‘½ä¹‹è¡€ã€‚è½¯ä»¶é€šå¸¸æ˜¯å¯ä»¥æ›¿æ¢çš„ï¼Œä½†æ˜¯å¤šå¹´ç§¯ç´¯çš„æ•°æ®æ˜¯æ°¸è¿œä¸èƒ½æ›¿æ¢çš„ã€‚</p>
<p>ä½ æ˜¯ä¸æ˜¯è§‰å¾—æœ‰äº›å¥‡æ€ªï¼Œæ—¢ç„¶æ•°æ®å¦‚æ­¤é‡è¦ï¼Œä¸ºä½•åœ¨å¼€å‘è½¯ä»¶çš„æ—¶å€™å´ç»å¸¸å°†å…¶è§†ä¸ºäº‹åæ‰è€ƒè™‘çš„äº‹æƒ…ï¼Ÿä»¥æˆ‘ä»¬å‰é¢ä¸Šä¸€ç« æ‰€ä»‹ç»çš„è¿œç¨‹æœåŠ¡ä¸ºä¾‹ï¼Œè¿™äº›æœåŠ¡æ˜¯ä»¥æ“ä½œå’Œå¤„ç†ä¸ºä¸­å¿ƒçš„ï¼Œè€Œä¸æ˜¯ä¿¡æ¯å’Œèµ„æºã€‚</p>
<p>è¿‘å‡ å¹´æ¥ï¼Œä»¥ä¿¡æ¯ä¸ºä¸­å¿ƒçš„è¡¨è¿°æ€§çŠ¶æ€è½¬ç§»ï¼ˆRepresentational State Transferï¼ŒRESTï¼‰å·²æˆä¸ºæ›¿æ¢ä¼ ç»ŸSOAP WebæœåŠ¡çš„æµè¡Œæ–¹æ¡ˆã€‚SOAPä¸€èˆ¬ä¼šå…³æ³¨è¡Œä¸ºå’Œå¤„ç†ï¼Œè€ŒRESTå…³æ³¨çš„æ˜¯è¦å¤„ç†çš„æ•°æ®ã€‚</p>
<p>ä»Spring 3.0ç‰ˆæœ¬å¼€å§‹ï¼ŒSpringä¸ºåˆ›å»ºREST APIæä¾›äº†è‰¯å¥½çš„æ”¯æŒã€‚Springçš„RESTå®ç°åœ¨Spring 3.1ã€3.2å’Œå¦‚ä»Šçš„4.0ç‰ˆæœ¬ä¸­ä¸æ–­å¾—åˆ°å‘å±•ã€‚</p>
<p>å¥½æ¶ˆæ¯æ˜¯Springå¯¹RESTçš„æ”¯æŒæ˜¯æ„å»ºåœ¨Spring MVCä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å·²ç»äº†è§£äº†è®¸å¤šåœ¨Springä¸­ä½¿ç”¨RESTæ‰€éœ€çš„çŸ¥è¯†ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†åŸºäºå·²äº†è§£çš„Spring MVCçŸ¥è¯†æ¥å¼€å‘å¤„ç†RESTfulèµ„æºçš„æ§åˆ¶å™¨ã€‚ä½†åœ¨æ·±å…¥äº†è§£ç»†èŠ‚ä¹‹å‰ï¼Œå…ˆè®©æˆ‘ä»¬çœ‹çœ‹ä½¿ç”¨RESTåˆ°åº•æ˜¯ä»€ä¹ˆã€‚</p>
<h3 id="äº†è§£REST"><a href="#äº†è§£REST" class="headerlink" title="äº†è§£REST"></a>äº†è§£REST</h3><p>æˆ‘æ•¢æ‰“èµŒè¿™å¹¶ä¸æ˜¯ä½ ç¬¬ä¸€æ¬¡å¬åˆ°æˆ–è¯»åˆ°RESTè¿™ä¸ªè¯ã€‚è¿‘äº›å¹´æ¥ï¼Œå…³äºRESTå·²ç»æœ‰äº†è®¸å¤šè®¨è®ºï¼Œåœ¨è½¯ä»¶å¼€å‘ä¸­ä½ å¯èƒ½ä¼šå‘ç°æœ‰ä¸€ç§å¾ˆæµè¡Œçš„åšæ³•ï¼Œé‚£å°±æ˜¯åœ¨æ¨åŠ¨RESTæ›¿æ¢SOAP WebæœåŠ¡çš„æ—¶å€™ï¼Œä¼šè°ˆè®ºåˆ°SOAPçš„ä¸è¶³ã€‚</p>
<p>è¯šç„¶ï¼Œå¯¹äºè®¸å¤šåº”ç”¨ç¨‹åºè€Œè¨€ï¼Œä½¿ç”¨SOAPå¯èƒ½ä¼šæœ‰äº›å¤§æå°ç”¨äº†ï¼Œè€ŒRESTæä¾›äº†ä¸€ä¸ªæ›´ç®€å•çš„å¯é€‰æ–¹æ¡ˆã€‚å¦å¤–ï¼Œå¾ˆå¤šçš„ç°ä»£åŒ–åº”ç”¨éƒ½ä¼šæœ‰ç§»åŠ¨æˆ–å¯ŒJavaScriptå®¢æˆ·ç«¯ï¼Œå®ƒä»¬éƒ½ä¼šä½¿ç”¨è¿è¡Œåœ¨æœåŠ¡å™¨ä¸ŠREST APIã€‚</p>
<p>é—®é¢˜åœ¨äºå¹¶ä¸æ˜¯æ¯ä¸ªäººéƒ½æ¸…æ¥šRESTåˆ°åº•æ˜¯ä»€ä¹ˆã€‚ç»“æœå°±å‡ºç°äº†è®¸å¤šè¯¯è§£ã€‚æœ‰å¾ˆå¤šæ‰“ç€RESTå¹Œå­çš„äº‹æƒ…å…¶å®å¹¶ä¸ç¬¦åˆRESTçœŸæ­£çš„æœ¬æ„ã€‚åœ¨è°ˆè®ºSpringå¦‚ä½•æ”¯æŒRESTä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹RESTæ˜¯ä»€ä¹ˆè¾¾æˆå…±è¯†ã€‚</p>
<h4 id="RESTçš„åŸºç¡€çŸ¥è¯†"><a href="#RESTçš„åŸºç¡€çŸ¥è¯†" class="headerlink" title="RESTçš„åŸºç¡€çŸ¥è¯†"></a>RESTçš„åŸºç¡€çŸ¥è¯†</h4><p>å½“è°ˆè®ºRESTæ—¶ï¼Œæœ‰ä¸€ç§å¸¸è§çš„é”™è¯¯å°±æ˜¯å°†å…¶è§†ä¸ºâ€œåŸºäºURLçš„WebæœåŠ¡â€â€”â€”å°†RESTä½œä¸ºå¦ä¸€ç§ç±»å‹çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆremote procedure callï¼ŒRPCï¼‰æœºåˆ¶ï¼Œå°±åƒSOAPä¸€æ ·ï¼Œåªä¸è¿‡æ˜¯é€šè¿‡ç®€å•çš„HTTP URLæ¥è§¦å‘ï¼Œè€Œä¸æ˜¯ä½¿ç”¨SOAPå¤§é‡çš„XMLå‘½åç©ºé—´ã€‚</p>
<p>æ°å¥½ç›¸åï¼ŒRESTä¸RPCå‡ ä¹æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚RPCæ˜¯é¢å‘æœåŠ¡çš„ï¼Œå¹¶å…³æ³¨äºè¡Œä¸ºå’ŒåŠ¨ä½œï¼›è€ŒRESTæ˜¯é¢å‘èµ„æºçš„ï¼Œå¼ºè°ƒæè¿°åº”ç”¨ç¨‹åºçš„äº‹ç‰©å’Œåè¯ã€‚</p>
<p>ä¸ºäº†ç†è§£RESTæ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å°†å®ƒçš„é¦–å­—æ¯ç¼©å†™æ‹†åˆ†ä¸ºä¸åŒçš„æ„æˆéƒ¨åˆ†ï¼š</p>
<ul>
<li>è¡¨è¿°æ€§ï¼ˆRepresentationalï¼‰ï¼šRESTèµ„æºå®é™…ä¸Šå¯ä»¥ç”¨å„ç§å½¢å¼æ¥è¿›è¡Œè¡¨è¿°ï¼ŒåŒ…æ‹¬XMLã€JSONï¼ˆJavaScript Object Notationï¼‰ç”šè‡³HTMLâ€”â€”æœ€é€‚åˆèµ„æºä½¿ç”¨è€…çš„ä»»æ„å½¢å¼ï¼›</li>
<li>çŠ¶æ€ï¼ˆStateï¼‰ï¼šå½“ä½¿ç”¨RESTçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ›´å…³æ³¨èµ„æºçš„çŠ¶æ€è€Œä¸æ˜¯å¯¹èµ„æºé‡‡å–çš„è¡Œä¸ºï¼›</li>
<li>è½¬ç§»ï¼ˆTransferï¼‰ï¼šRESTæ¶‰åŠåˆ°è½¬ç§»èµ„æºæ•°æ®ï¼Œå®ƒä»¥æŸç§è¡¨è¿°æ€§å½¢å¼ä»ä¸€ä¸ªåº”ç”¨è½¬ç§»åˆ°å¦ä¸€ä¸ªåº”ç”¨ã€‚</li>
</ul>
<p>æ›´ç®€æ´åœ°è®²ï¼ŒRESTå°±æ˜¯å°†èµ„æºçš„çŠ¶æ€ä»¥æœ€é€‚åˆå®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯çš„å½¢å¼ä»æœåŠ¡å™¨ç«¯è½¬ç§»åˆ°å®¢æˆ·ç«¯ï¼ˆæˆ–è€…åè¿‡æ¥ï¼‰ã€‚åœ¨RESTä¸­ï¼Œèµ„æºé€šè¿‡URLè¿›è¡Œè¯†åˆ«å’Œå®šä½ã€‚è‡³äºRESTful URLçš„ç»“æ„å¹¶æ²¡æœ‰ä¸¥æ ¼çš„è§„åˆ™ï¼Œä½†æ˜¯URLåº”è¯¥èƒ½å¤Ÿè¯†åˆ«èµ„æºï¼Œè€Œä¸æ˜¯ç®€å•çš„å‘ä¸€æ¡å‘½ä»¤åˆ°æœåŠ¡å™¨ä¸Šã€‚å†æ¬¡å¼ºè°ƒï¼Œå…³æ³¨çš„æ ¸å¿ƒæ˜¯äº‹ç‰©ï¼Œè€Œä¸æ˜¯è¡Œä¸ºã€‚</p>
<p>RESTä¸­ä¼šæœ‰è¡Œä¸ºï¼Œå®ƒä»¬æ˜¯é€šè¿‡HTTPæ–¹æ³•æ¥å®šä¹‰çš„ã€‚å…·ä½“æ¥è®²ï¼Œä¹Ÿå°±æ˜¯GETã€POSTã€PUTã€DELETEã€PATCHä»¥åŠå…¶ä»–çš„HTTPæ–¹æ³•æ„æˆäº†RESTä¸­çš„åŠ¨ä½œã€‚è¿™äº›HTTPæ–¹æ³•é€šå¸¸ä¼šåŒ¹é…ä¸ºå¦‚ä¸‹çš„CRUDåŠ¨ä½œï¼š</p>
<ul>
<li>Createï¼šPOST</li>
<li>Readï¼šGET</li>
<li>Updateï¼šPUTæˆ–PATCH</li>
<li>Deleteï¼šDELETE</li>
</ul>
<p>å°½ç®¡é€šå¸¸æ¥è®²ï¼ŒHTTPæ–¹æ³•ä¼šæ˜ å°„ä¸ºCRUDåŠ¨ä½œï¼Œä½†è¿™å¹¶ä¸æ˜¯ä¸¥æ ¼çš„é™åˆ¶ã€‚æœ‰æ—¶å€™ï¼ŒPUTå¯ä»¥ç”¨æ¥åˆ›å»ºæ–°èµ„æºï¼ŒPOSTå¯ä»¥ç”¨æ¥æ›´æ–°èµ„æºã€‚å®é™…ä¸Šï¼ŒPOSTè¯·æ±‚éå¹‚ç­‰æ€§ï¼ˆnon-idempotentï¼‰çš„ç‰¹ç‚¹ä½¿å…¶æˆä¸ºä¸€ä¸ªéå¸¸çµæ´»çš„æ–¹æ³•ï¼Œå¯¹äºæ— æ³•é€‚åº”å…¶ä»–HTTPæ–¹æ³•è¯­ä¹‰çš„æ“ä½œï¼Œå®ƒéƒ½èƒ½å¤Ÿèƒœä»»ã€‚</p>
<p>åŸºäºå¯¹RESTçš„è¿™ç§è§‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘å°½é‡é¿å…ä½¿ç”¨è¯¸å¦‚RESTæœåŠ¡ã€REST WebæœåŠ¡æˆ–ç±»ä¼¼çš„æœ¯è¯­ï¼Œè¿™äº›æœ¯è¯­ä¼šä¸æ°å½“åœ°å¼ºè°ƒè¡Œä¸ºã€‚ç›¸åï¼Œæˆ‘æ›´æ„¿æ„å¼ºè°ƒRESTé¢å‘èµ„æºçš„æœ¬è´¨ï¼Œå¹¶è®¨è®ºRESTfulèµ„æºã€‚</p>
<h4 id="Springæ˜¯å¦‚ä½•æ”¯æŒRESTçš„"><a href="#Springæ˜¯å¦‚ä½•æ”¯æŒRESTçš„" class="headerlink" title="Springæ˜¯å¦‚ä½•æ”¯æŒRESTçš„"></a>Springæ˜¯å¦‚ä½•æ”¯æŒRESTçš„</h4><p>Springå¾ˆæ—©å°±æœ‰å¯¼å‡ºRESTèµ„æºçš„éœ€æ±‚ã€‚ä»3.0ç‰ˆæœ¬å¼€å§‹ï¼ŒSpringé’ˆå¯¹Spring MVCçš„ä¸€äº›å¢å¼ºåŠŸèƒ½å¯¹RESTæä¾›äº†è‰¯å¥½çš„æ”¯æŒã€‚å½“å‰çš„4.0ç‰ˆæœ¬ä¸­ï¼ŒSpringæ”¯æŒä»¥ä¸‹æ–¹å¼æ¥åˆ›å»ºRESTèµ„æºï¼š</p>
<ul>
<li>æ§åˆ¶å™¨å¯ä»¥å¤„ç†æ‰€æœ‰çš„HTTPæ–¹æ³•ï¼ŒåŒ…å«å››ä¸ªä¸»è¦çš„RESTæ–¹æ³•ï¼šGETã€PUTã€DELETEä»¥åŠPOSTã€‚Spring 3.2åŠä»¥ä¸Šç‰ˆæœ¬è¿˜æ”¯æŒPATCHæ–¹æ³•ï¼›</li>
<li>å€ŸåŠ©@PathVariableæ³¨è§£ï¼Œæ§åˆ¶å™¨èƒ½å¤Ÿå¤„ç†å‚æ•°åŒ–çš„URLï¼ˆå°†å˜é‡è¾“å…¥ä½œä¸ºURLçš„ä¸€éƒ¨åˆ†ï¼‰ï¼›</li>
<li>å€ŸåŠ©Springçš„è§†å›¾å’Œè§†å›¾è§£æå™¨ï¼Œèµ„æºèƒ½å¤Ÿä»¥å¤šç§æ–¹å¼è¿›è¡Œè¡¨è¿°ï¼ŒåŒ…æ‹¬å°†æ¨¡å‹æ•°æ®æ¸²æŸ“ä¸ºXMLã€JSONã€Atomä»¥åŠRSSçš„Viewå®ç°ï¼›</li>
<li>å¯ä»¥ä½¿ç”¨ContentNegotiatingViewResolveræ¥é€‰æ‹©æœ€é€‚åˆå®¢æˆ·ç«¯çš„è¡¨è¿°ï¼›</li>
<li>å€ŸåŠ©@ResponseBodyæ³¨è§£å’Œå„ç§HttpMethodConverterå®ç°ï¼Œèƒ½å¤Ÿæ›¿æ¢åŸºäºè§†å›¾çš„æ¸²æŸ“æ–¹å¼ï¼›</li>
<li>ç±»ä¼¼åœ°ï¼Œ@RequestBodyæ³¨è§£ä»¥åŠHttpMethodConverterå®ç°å¯ä»¥å°†ä¼ å…¥çš„HTTPæ•°æ®è½¬åŒ–ä¸ºä¼ å…¥æ§åˆ¶å™¨å¤„ç†æ–¹æ³•çš„Javaå¯¹è±¡ï¼›</li>
<li>å€ŸåŠ©RestTemplateï¼ŒSpringåº”ç”¨èƒ½å¤Ÿæ–¹ä¾¿åœ°ä½¿ç”¨RESTèµ„æºã€‚</li>
</ul>
<p>æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šä»‹ç»Spring RESTfulçš„æ‰€æœ‰ç‰¹æ€§ï¼Œé¦–å…ˆä»‹ç»å¦‚ä½•å€ŸåŠ©Spring MVCç”Ÿæˆèµ„æºã€‚ç„¶ååœ¨16.4å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šè½¬å‘RESTçš„å®¢æˆ·ç«¯ï¼Œçœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨è¿™äº›èµ„æºã€‚é‚£ä¹ˆï¼Œå°±ä»äº†è§£RESTful Spring MVCæ§åˆ¶å™¨æ˜¯ä»€ä¹ˆæ ·å­å¼€å§‹å§ã€‚</p>
<h3 id="åˆ›å»ºç¬¬ä¸€ä¸ªRESTç«¯ç‚¹"><a href="#åˆ›å»ºç¬¬ä¸€ä¸ªRESTç«¯ç‚¹" class="headerlink" title="åˆ›å»ºç¬¬ä¸€ä¸ªRESTç«¯ç‚¹"></a>åˆ›å»ºç¬¬ä¸€ä¸ªRESTç«¯ç‚¹</h3><p>å€ŸåŠ©Springçš„æ”¯æŒæ¥å®ç°RESTåŠŸèƒ½æœ‰ä¸€ä¸ªå¾ˆæœ‰åˆ©çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬å·²ç»æŒæ¡äº†å¾ˆå¤šåˆ›å»ºRESTfulæ§åˆ¶å™¨çš„çŸ¥è¯†ã€‚ä»ç¬¬5ç« åˆ°ç¬¬7ç« ä¸­ï¼Œæˆ‘å­¦åˆ°äº†åˆ›å»ºWebåº”ç”¨çš„çŸ¥è¯†ï¼Œå®ƒä»¬å¯ä»¥ç”¨åœ¨é€šè¿‡REST APIæš´éœ²èµ„æºä¸Šã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä¼šåœ¨åä¸ºSpittleApiControllerçš„æ–°æ§åˆ¶å™¨ä¸­åˆ›å»ºç¬¬ä¸€ä¸ªRESTç«¯ç‚¹ã€‚</p>
<p>å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†è¿™ä¸ªæ–°RESTæ§åˆ¶å™¨èµ·å§‹çš„æ ·å­ï¼Œå®ƒä¼šæä¾›Spittleèµ„æºã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„å¼€å§‹ï¼Œä½†æ˜¯åœ¨æœ¬ç« ä¸­ï¼Œéšç€ä¸æ–­å­¦ä¹ Spring RESTç¼–ç¨‹æ¨¡å‹çš„ç»†èŠ‚ï¼Œæˆ‘ä»¬å°†ä¼šä¸æ–­æ„å»ºè¿™ä¸ªæ§åˆ¶å™¨ã€‚</p>
<p>ç¨‹åºæ¸…å•16.1ã€€å®ç°RESTfulåŠŸèƒ½çš„Spring MVCæ§åˆ¶å™¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.api;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.stereotype.Controller;<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;<span class="keyword">import</span> spittr.Spittle;<span class="keyword">import</span> spittr.data.SpittleRepository;<span class="meta">@Controller</span><span class="meta">@RequestMapping(&quot;/spittles&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpittleController</span> </span>&#123;  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String MAX_LONG_AS_STRING = <span class="string">&quot;9223372036854775807&quot;</span>;  <span class="keyword">private</span> SpittleRepository spittleRepository;  <span class="meta">@Autowired</span>  <span class="function"><span class="keyword">public</span> <span class="title">SpittleController</span><span class="params">(SpittleRepository spittleRepository)</span> </span>&#123;    <span class="keyword">this</span>.spittleRepository = spittleRepository;  &#125;  <span class="meta">@RequestMapping(method=RequestMethod.GET)</span>  <span class="function"><span class="keyword">public</span> List&lt;Spittle&gt; <span class="title">spittles</span><span class="params">(      <span class="meta">@RequestParam(value=&quot;max&quot;, defaultValue=MAX_LONG_AS_STRING)</span> <span class="keyword">long</span> max,      <span class="meta">@RequestParam(value=&quot;count&quot;, defaultValue=&quot;20&quot;)</span> <span class="keyword">int</span> count)</span> </span>&#123;    <span class="keyword">return</span> spittleRepository.findSpittles(max, count);  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>è®©æˆ‘ä»¬ä»”ç»†çœ‹ä¸€ä¸‹ç¨‹åºæ¸…å•16.1ã€‚ä½ èƒ½å¤Ÿçœ‹å‡ºæ¥å®ƒæœåŠ¡äºä¸€ä¸ªRESTèµ„æºè€Œä¸æ˜¯Webé¡µé¢å—ï¼Ÿ</p>
<p>å¯èƒ½çœ‹ä¸å‡ºæ¥ï¼æŒ‰ç…§è¿™ä¸ªæ§åˆ¶å™¨çš„å†™æ³•ï¼Œå¹¶æ²¡æœ‰åœ°æ–¹è¡¨æ˜å®ƒæ˜¯RESTfulã€æœåŠ¡äºèµ„æºçš„æ§åˆ¶å™¨ã€‚å®é™…ä¸Šï¼Œä½ ä¹Ÿè®¸èƒ½å¤Ÿè®¤å‡ºè¿™ä¸ªspittles()æ–¹æ³•ï¼Œæˆ‘ä»¬æ›¾ç»åœ¨ç¬¬5ç« ï¼ˆ5.3.1å°èŠ‚ï¼‰è§è¿‡å®ƒã€‚</p>
<p>æˆ‘ä»¬å›å¿†ä¸€ä¸‹ï¼Œå½“å‘èµ·å¯¹â€œ/spittlesâ€çš„GETè¯·æ±‚æ—¶ï¼Œå°†ä¼šè°ƒç”¨spittles()æ–¹æ³•ã€‚å®ƒä¼šæŸ¥æ‰¾å¹¶è¿”å›Spittleåˆ—è¡¨ï¼Œè€Œè¿™ä¸ªåˆ—è¡¨ä¼šé€šè¿‡æ³¨å…¥çš„SpittleRepositoryè·å–åˆ°ã€‚åˆ—è¡¨ä¼šæ”¾åˆ°æ¨¡å‹ä¸­ï¼Œç”¨äºè§†å›¾çš„æ¸²æŸ“ã€‚å¯¹äºåŸºäºæµè§ˆå™¨çš„Webåº”ç”¨ï¼Œè¿™å¯èƒ½æ„å‘³ç€æ¨¡å‹æ•°æ®ä¼šæ¸²æŸ“åˆ°HTMLé¡µé¢ä¸­ã€‚</p>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨è®¨è®ºçš„æ˜¯åˆ›å»ºREST APIã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒHTMLå¹¶ä¸æ˜¯åˆé€‚çš„æ•°æ®è¡¨è¿°å½¢å¼ã€‚</p>
<p>è¡¨è¿°æ˜¯RESTä¸­å¾ˆé‡è¦çš„ä¸€ä¸ªæ–¹é¢ã€‚å®ƒæ˜¯å…³äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯é’ˆå¯¹æŸä¸€èµ„æºæ˜¯å¦‚ä½•é€šä¿¡çš„ã€‚ä»»ä½•ç»™å®šçš„èµ„æºéƒ½å‡ ä¹å¯ä»¥ç”¨ä»»æ„çš„å½¢å¼æ¥è¿›è¡Œè¡¨è¿°ã€‚å¦‚æœèµ„æºçš„ä½¿ç”¨è€…æ„¿æ„ä½¿ç”¨JSONï¼Œé‚£ä¹ˆèµ„æºå°±å¯ä»¥ç”¨JSONæ ¼å¼æ¥è¡¨è¿°ã€‚å¦‚æœä½¿ç”¨è€…å–œæ¬¢å°–æ‹¬å·ï¼Œé‚£ç›¸åŒçš„èµ„æºå¯ä»¥ç”¨XMLæ¥è¿›è¡Œè¡¨è¿°ã€‚åŒæ—¶ï¼Œå¦‚æœç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹èµ„æºçš„è¯ï¼Œå¯èƒ½æ›´æ„¿æ„ä»¥HTMLçš„æ–¹å¼æ¥å±•ç°ï¼ˆæˆ–è€…PDFã€ExcelåŠå…¶ä»–ä¾¿äºäººç±»é˜…è¯»çš„æ ¼å¼ï¼‰ã€‚èµ„æºæ²¡æœ‰å˜åŒ–â€”â€”åªæ˜¯å®ƒçš„è¡¨è¿°æ–¹å¼å˜åŒ–äº†ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå°½ç®¡Springæ”¯æŒå¤šç§èµ„æºè¡¨è¿°å½¢å¼ï¼Œä½†æ˜¯åœ¨å®šä¹‰REST APIçš„æ—¶å€™ï¼Œä¸ä¸€å®šè¦å…¨éƒ¨ä½¿ç”¨å®ƒä»¬ã€‚å¯¹äºå¤§å¤šæ•°å®¢æˆ·ç«¯æ¥è¯´ï¼Œç”¨JSONå’ŒXMLæ¥è¿›è¡Œè¡¨è¿°å°±è¶³å¤Ÿäº†ã€‚</p>
</blockquote>
<p>å½“ç„¶ï¼Œå¦‚æœå†…å®¹è¦ç”±äººç±»ç”¨æˆ·æ¥ä½¿ç”¨çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½éœ€è¦æ”¯æŒHTMLæ ¼å¼çš„èµ„æºã€‚æ ¹æ®èµ„æºçš„ç‰¹ç‚¹å’Œåº”ç”¨çš„éœ€æ±‚ï¼Œæˆ‘ä»¬è¿˜å¯èƒ½é€‰æ‹©ä½¿ç”¨PDFæ–‡æ¡£æˆ–Excelè¡¨æ ¼æ¥å±•ç°èµ„æºã€‚</p>
<p>å¯¹äºéäººç±»ç”¨æˆ·çš„ä½¿ç”¨è€…ï¼Œæ¯”å¦‚å…¶ä»–çš„åº”ç”¨æˆ–è°ƒç”¨RESTç«¯ç‚¹çš„ä»£ç ï¼Œèµ„æºè¡¨è¿°çš„é¦–é€‰åº”è¯¥æ˜¯XMLå’ŒJSONã€‚å€ŸåŠ©SpringåŒæ—¶æ”¯æŒè¿™ä¸¤ç§æ–¹æ¡ˆéå¸¸ç®€å•ï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦åšä¸€ä¸ªéæ­¤å³å½¼çš„é€‰æ‹©ã€‚</p>
<p>æŒ‰ç…§æˆ‘çš„æ„è§ï¼Œæˆ‘æ¨èè‡³å°‘è¦æ”¯æŒJSONã€‚JSONä½¿ç”¨èµ·æ¥è‡³å°‘ä¼šåƒXMLä¸€æ ·ç®€å•ï¼ˆå¾ˆå¤šäººä¼šè¯´JSONä¼šæ›´åŠ ç®€å•ï¼‰ï¼Œå¹¶ä¸”å¦‚æœå®¢æˆ·ç«¯æ˜¯JavaScriptï¼ˆæœ€è¿‘ä¸€æ®µæ—¶é—´ä»¥æ¥ï¼Œè¿™ç§åšæ³•è¶Šæ¥è¶Šå¸¸è§ï¼‰çš„è¯ï¼ŒJSONæ›´æ˜¯ä¼šæˆä¸ºä¼˜èƒœè€…ï¼Œå› ä¸ºåœ¨JavaScriptä¸­ä½¿ç”¨JSONæ•°æ®æ ¹æœ¬å°±ä¸éœ€è¦ç¼–æ’å’Œè§£æ’ï¼ˆmarshaling/demarshalingï¼‰ã€‚</p>
<p>éœ€è¦äº†è§£çš„æ˜¯æ§åˆ¶å™¨æœ¬èº«é€šå¸¸å¹¶ä¸å…³å¿ƒèµ„æºå¦‚ä½•è¡¨è¿°ã€‚æ§åˆ¶å™¨ä»¥Javaå¯¹è±¡çš„æ–¹å¼æ¥å¤„ç†èµ„æºã€‚æ§åˆ¶å™¨å®Œæˆäº†å®ƒçš„å·¥ä½œä¹‹åï¼Œèµ„æºæ‰ä¼šè¢«è½¬åŒ–æˆæœ€é€‚åˆå®¢æˆ·ç«¯çš„å½¢å¼ã€‚Springæä¾›äº†ä¸¤ç§æ–¹æ³•å°†èµ„æºçš„Javaè¡¨è¿°å½¢å¼è½¬æ¢ä¸ºå‘é€ç»™å®¢æˆ·ç«¯çš„è¡¨è¿°å½¢å¼ï¼š</p>
<ul>
<li>å†…å®¹åå•†ï¼ˆContent negotiationï¼‰ï¼šé€‰æ‹©ä¸€ä¸ªè§†å›¾ï¼Œå®ƒèƒ½å¤Ÿå°†æ¨¡å‹æ¸²æŸ“ä¸ºå‘ˆç°ç»™å®¢æˆ·ç«¯çš„è¡¨è¿°å½¢å¼ï¼›</li>
<li>æ¶ˆæ¯è½¬æ¢å™¨ï¼ˆMessage conversionï¼‰ï¼šé€šè¿‡ä¸€ä¸ªæ¶ˆæ¯è½¬æ¢å™¨å°†æ§åˆ¶å™¨æ‰€è¿”å›çš„å¯¹è±¡è½¬æ¢ä¸ºå‘ˆç°ç»™å®¢æˆ·ç«¯çš„è¡¨è¿°å½¢å¼ã€‚</li>
</ul>
<p>é‰´äºæˆ‘ä»¬åœ¨ç¬¬5ç« å’Œç¬¬6ç« ä¸­å·²ç»è®¨è®ºè¿‡è§†å›¾è§£æå™¨ï¼Œå¹¶ä¸”å·²ç»ç†Ÿæ‚‰äº†åŸºäºè§†å›¾çš„æ¸²æŸ“ï¼ˆåœ¨ç¬¬6ç« ä¸­ï¼‰ï¼Œæ‰€ä»¥é¦–å…ˆçœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨å†…å®¹åå•†æ¥é€‰æ‹©è§†å›¾æˆ–è§†å›¾è§£æå™¨ï¼Œå®ƒä»¬å°†èµ„æºæ¸²æŸ“ä¸ºå®¢æˆ·ç«¯èƒ½å¤Ÿæ¥å—çš„å½¢å¼ã€‚</p>
<h4 id="åå•†èµ„æºè¡¨è¿°"><a href="#åå•†èµ„æºè¡¨è¿°" class="headerlink" title="åå•†èµ„æºè¡¨è¿°"></a>åå•†èµ„æºè¡¨è¿°</h4><p>ä½ å¯ä»¥å›å¿†ä¸€ä¸‹åœ¨ç¬¬5ç« ä¸­ï¼ˆä»¥åŠå›¾5.1æ‰€ç¤ºï¼‰ï¼Œå½“æ§åˆ¶å™¨çš„å¤„ç†æ–¹æ³•å®Œæˆæ—¶ï¼Œé€šå¸¸ä¼šè¿”å›ä¸€ä¸ªé€»è¾‘è§†å›¾åã€‚å¦‚æœæ–¹æ³•ä¸ç›´æ¥è¿”å›é€»è¾‘è§†å›¾åï¼ˆä¾‹å¦‚æ–¹æ³•è¿”å›voidï¼‰ï¼Œé‚£ä¹ˆé€»è¾‘è§†å›¾åä¼šæ ¹æ®è¯·æ±‚çš„URLåˆ¤æ–­å¾—å‡ºã€‚DispatcherServletæ¥ä¸‹æ¥ä¼šå°†è§†å›¾çš„åå­—ä¼ é€’ç»™ä¸€ä¸ªè§†å›¾è§£æå™¨ï¼Œè¦æ±‚å®ƒæ¥å¸®åŠ©ç¡®å®šåº”è¯¥ç”¨å“ªä¸ªè§†å›¾æ¥æ¸²æŸ“è¯·æ±‚ç»“æœã€‚</p>
<p>åœ¨é¢å‘äººç±»è®¿é—®çš„Webåº”ç”¨ç¨‹åºä¸­ï¼Œé€‰æ‹©çš„è§†å›¾é€šå¸¸æ¥è®²éƒ½ä¼šæ¸²æŸ“ä¸ºHTMLã€‚è§†å›¾è§£ææ–¹æ¡ˆæ˜¯ä¸ªç®€å•çš„ä¸€ç»´æ´»åŠ¨ã€‚å¦‚æœæ ¹æ®è§†å›¾ååŒ¹é…ä¸Šäº†è§†å›¾ï¼Œé‚£è¿™å°±æ˜¯æˆ‘ä»¬è¦ç”¨çš„è§†å›¾äº†ã€‚</p>
<p>å½“è¦å°†è§†å›¾åè§£æä¸ºèƒ½å¤Ÿäº§ç”Ÿèµ„æºè¡¨è¿°çš„è§†å›¾æ—¶ï¼Œæˆ‘ä»¬å°±æœ‰å¦å¤–ä¸€ä¸ªç»´åº¦éœ€è¦è€ƒè™‘äº†ã€‚è§†å›¾ä¸ä»…è¦åŒ¹é…è§†å›¾åï¼Œè€Œä¸”æ‰€é€‰æ‹©çš„è§†å›¾è¦é€‚åˆå®¢æˆ·ç«¯ã€‚å¦‚æœå®¢æˆ·ç«¯æƒ³è¦JSONï¼Œé‚£ä¹ˆæ¸²æŸ“HTMLçš„è§†å›¾å°±ä¸è¡Œäº†â€”â€”å°½ç®¡è§†å›¾åå¯èƒ½åŒ¹é…ã€‚</p>
<p>Springçš„ContentNegotiatingViewResolveræ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è§†å›¾è§£æå™¨ï¼Œå®ƒè€ƒè™‘åˆ°äº†å®¢æˆ·ç«¯æ‰€éœ€è¦çš„å†…å®¹ç±»å‹ã€‚æŒ‰ç…§å…¶æœ€ç®€å•çš„å½¢å¼ï¼ŒContentNegotiatingViewResolverå¯ä»¥æŒ‰ç…§ä¸‹è¿°å½¢å¼è¿›è¡Œé…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">ViewResolver <span class="title">cnViewResilver</span><span class="params">()</span> </span>&#123;  <span class="keyword">return</span> <span class="keyword">new</span> ContentNegotiatingViewResolver();&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªç®€å•çš„beanå£°æ˜èƒŒåä¼šæ¶‰åŠåˆ°å¾ˆå¤šäº‹æƒ…ã€‚è¦ç†è§£ContentNegotiating-ViewResolveræ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¿™æ¶‰åŠå†…å®¹åå•†çš„ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>ç¡®å®šè¯·æ±‚çš„åª’ä½“ç±»å‹ï¼›</li>
<li>æ‰¾åˆ°é€‚åˆè¯·æ±‚åª’ä½“ç±»å‹çš„æœ€ä½³è§†å›¾ã€‚</li>
</ol>
<p>è®©æˆ‘ä»¬æ·±å…¥äº†è§£æ¯ä¸ªæ­¥éª¤æ¥äº†è§£ContentNegotiatingViewResolveræ˜¯å¦‚ä½•å®Œæˆå…¶ä»»åŠ¡çš„ï¼Œé¦–å…ˆä»å¼„æ˜ç™½å®¢æˆ·ç«¯éœ€è¦ä»€ä¹ˆç±»å‹çš„å†…å®¹å¼€å§‹ã€‚</p>
<p>ç¡®å®šè¯·æ±‚çš„åª’ä½“ç±»å‹</p>
<p>åœ¨å†…å®¹åå•†ä¸¤æ­¥éª¤ä¸­ï¼Œç¬¬ä¸€æ­¥æ˜¯ç¡®å®šå®¢æˆ·ç«¯æƒ³è¦ä»€ä¹ˆç±»å‹çš„å†…å®¹è¡¨è¿°ã€‚è¡¨é¢ä¸Šçœ‹ï¼Œè¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„äº‹æƒ…ã€‚éš¾é“è¯·æ±‚çš„Acceptå¤´éƒ¨ä¿¡æ¯ä¸æ˜¯å·²ç»å¾ˆæ¸…æ¥šåœ°è¡¨æ˜è¦å‘é€ä»€ä¹ˆæ ·çš„è¡¨è¿°ç»™å®¢æˆ·ç«¯å—ï¼Ÿ</p>
<p>é—æ†¾çš„æ˜¯ï¼ŒAcceptå¤´éƒ¨ä¿¡æ¯å¹¶ä¸æ€»æ˜¯å¯é çš„ã€‚å¦‚æœå®¢æˆ·ç«¯æ˜¯Webæµè§ˆå™¨ï¼Œé‚£å¹¶ä¸èƒ½ä¿è¯å®¢æˆ·ç«¯éœ€è¦çš„ç±»å‹å°±æ˜¯æµè§ˆå™¨åœ¨Acceptå¤´éƒ¨æ‰€å‘é€çš„å€¼ã€‚Webæµè§ˆå™¨ä¸€èˆ¬åªæ¥å—å¯¹äººç±»ç”¨æˆ·å‹å¥½çš„å†…å®¹ç±»å‹ï¼ˆå¦‚text/htmlï¼‰ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•ï¼ˆé™¤äº†é¢å‘å¼€å‘äººå‘˜çš„æµè§ˆå™¨æ’ä»¶ï¼‰æŒ‡å®šä¸åŒçš„å†…å®¹ç±»å‹ã€‚</p>
<p>ContentNegotiatingViewResolverå°†ä¼šè€ƒè™‘åˆ°Acceptå¤´éƒ¨ä¿¡æ¯å¹¶ä½¿ç”¨å®ƒæ‰€è¯·æ±‚çš„åª’ä½“ç±»å‹ï¼Œä½†æ˜¯å®ƒä¼šé¦–å…ˆæŸ¥çœ‹URLçš„æ–‡ä»¶æ‰©å±•åã€‚å¦‚æœURLåœ¨ç»“å°¾å¤„æœ‰æ–‡ä»¶æ‰©å±•åçš„è¯ï¼ŒContentNegotiatingViewResolverå°†ä¼šåŸºäºè¯¥æ‰©å±•åç¡®å®šæ‰€éœ€çš„ç±»å‹ã€‚å¦‚æœæ‰©å±•åæ˜¯â€œ.jsonâ€çš„è¯ï¼Œé‚£ä¹ˆæ‰€éœ€çš„å†…å®¹ç±»å‹å¿…é¡»æ˜¯â€œapplication/jsonâ€ã€‚å¦‚æœæ‰©å±•åæ˜¯â€œ.xmlâ€ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯è¯·æ±‚çš„å°±æ˜¯â€œapplication/xmlâ€ã€‚å½“ç„¶ï¼Œâ€œ.htmlâ€æ‰©å±•åè¡¨æ˜å®¢æˆ·ç«¯æ‰€éœ€çš„èµ„æºè¡¨è¿°ä¸ºHTMLï¼ˆtext/htmlï¼‰ã€‚</p>
<p>å¦‚æœæ ¹æ®æ–‡ä»¶æ‰©å±•åä¸èƒ½å¾—åˆ°ä»»ä½•åª’ä½“ç±»å‹çš„è¯ï¼Œé‚£å°±ä¼šè€ƒè™‘è¯·æ±‚ä¸­çš„Acceptå¤´éƒ¨ä¿¡æ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒAcceptå¤´éƒ¨ä¿¡æ¯ä¸­çš„å€¼å°±è¡¨æ˜äº†å®¢æˆ·ç«¯æƒ³è¦çš„MIMEç±»å‹ï¼Œæ²¡æœ‰å¿…è¦å†å»æŸ¥æ‰¾äº†ã€‚</p>
<p>æœ€åï¼Œå¦‚æœæ²¡æœ‰Acceptå¤´éƒ¨ä¿¡æ¯ï¼Œå¹¶ä¸”æ‰©å±•åä¹Ÿæ— æ³•æä¾›å¸®åŠ©çš„è¯ï¼ŒContentNegotiatingViewResolverå°†ä¼šä½¿ç”¨â€œ/â€ä½œä¸ºé»˜è®¤çš„å†…å®¹ç±»å‹ï¼Œè¿™å°±æ„å‘³ç€å®¢æˆ·ç«¯å¿…é¡»è¦æ¥æ”¶æœåŠ¡å™¨å‘é€çš„ä»»ä½•å½¢å¼çš„è¡¨è¿°ã€‚</p>
<p>ä¸€æ—¦å†…å®¹ç±»å‹ç¡®å®šä¹‹åï¼ŒContentNegotiatingViewResolverå°±è¯¥å°†é€»è¾‘è§†å›¾åè§£æä¸ºæ¸²æŸ“æ¨¡å‹çš„Viewã€‚ä¸Springçš„å…¶ä»–è§†å›¾è§£æå™¨ä¸åŒï¼ŒContentNegotiatingViewResolveræœ¬èº«ä¸ä¼šè§£æè§†å›¾ã€‚è€Œæ˜¯å§”æ‰˜ç»™å…¶ä»–çš„è§†å›¾è§£æå™¨ï¼Œè®©å®ƒä»¬æ¥è§£æè§†å›¾ã€‚</p>
<p>ContentNegotiatingViewResolverè¦æ±‚å…¶ä»–çš„è§†å›¾è§£æå™¨å°†é€»è¾‘è§†å›¾åè§£æä¸ºè§†å›¾ã€‚è§£æå¾—åˆ°çš„æ¯ä¸ªè§†å›¾éƒ½ä¼šæ”¾åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚è¿™ä¸ªåˆ—è¡¨è£…é…å®Œæˆåï¼ŒContentNegotiatingViewResolverä¼šå¾ªç¯å®¢æˆ·ç«¯è¯·æ±‚çš„æ‰€æœ‰åª’ä½“ç±»å‹ï¼Œåœ¨å€™é€‰çš„è§†å›¾ä¸­æŸ¥æ‰¾èƒ½å¤Ÿäº§ç”Ÿå¯¹åº”å†…å®¹ç±»å‹çš„è§†å›¾ã€‚ç¬¬ä¸€ä¸ªåŒ¹é…çš„è§†å›¾ä¼šç”¨æ¥æ¸²æŸ“æ¨¡å‹ã€‚</p>
<p>å½±å“åª’ä½“ç±»å‹çš„é€‰æ‹©</p>
<p>åœ¨ä¸Šè¿°çš„é€‰æ‹©è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é˜è¿°äº†ç¡®å®šæ‰€è¯·æ±‚åª’ä½“ç±»å‹çš„é»˜è®¤ç­–ç•¥ã€‚ä½†æ˜¯é€šè¿‡ä¸ºå…¶è®¾ç½®ä¸€ä¸ªContentNegotiationManagerï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ”¹å˜å®ƒçš„è¡Œä¸ºã€‚å€ŸåŠ©ContentNegotiationManageræˆ‘ä»¬æ‰€èƒ½åšåˆ°çš„äº‹æƒ…å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>æŒ‡å®šé»˜è®¤çš„å†…å®¹ç±»å‹ï¼Œå¦‚æœæ ¹æ®è¯·æ±‚æ— æ³•å¾—åˆ°å†…å®¹ç±»å‹çš„è¯ï¼Œå°†ä¼šä½¿ç”¨é»˜è®¤å€¼ï¼›</p>
<ul>
<li>é€šè¿‡è¯·æ±‚å‚æ•°æŒ‡å®šå†…å®¹ç±»å‹ï¼›</li>
<li>å¿½è§†è¯·æ±‚çš„Acceptå¤´éƒ¨ä¿¡æ¯ï¼›</li>
<li>å°†è¯·æ±‚çš„æ‰©å±•åæ˜ å°„ä¸ºç‰¹å®šçš„åª’ä½“ç±»å‹ï¼›</li>
<li>å°†JAFï¼ˆJava Activation Frameworkï¼‰ä½œä¸ºæ ¹æ®æ‰©å±•åæŸ¥æ‰¾åª’ä½“ç±»å‹çš„å¤‡ç”¨æ–¹æ¡ˆã€‚</li>
</ul>
<p>æœ‰ä¸‰ç§é…ç½®ContentNegotiationManagerçš„æ–¹æ³•ï¼š</p>
<ul>
<li>ç›´æ¥å£°æ˜ä¸€ä¸ªContentNegotiationManagerç±»å‹çš„beanï¼›</li>
<li>é€šè¿‡ContentNegotiationManagerFactoryBeané—´æ¥åˆ›å»ºbeanï¼›</li>
<li>é‡è½½WebMvcConfigurerAdapterçš„configureContentNegotiation()æ–¹æ³•ã€‚</li>
</ul>
<p>ç›´æ¥åˆ›å»ºContentNegotiationManageræœ‰ä¸€äº›å¤æ‚ï¼Œé™¤éæœ‰å……åˆ†çš„åŸå› ï¼Œå¦åˆ™æˆ‘ä»¬ä¸ä¼šæ„¿æ„è¿™æ ·åšã€‚åä¸¤ç§æ–¹æ¡ˆèƒ½å¤Ÿè®©åˆ›å»ºContentNegotiationManageræ›´åŠ ç®€å•ã€‚</p>
<blockquote>
<p>ContentNegotiationManageræ˜¯åœ¨Spring 3.2ä¸­åŠ å…¥çš„</p>
<p>ContentNegotiationManageræ˜¯Springä¸­ç›¸å¯¹æ¯”è¾ƒæ–°çš„åŠŸèƒ½ï¼Œæ˜¯åœ¨Spring 3.2ä¸­å¼•å…¥çš„ã€‚åœ¨Spring 3.2ä¹‹å‰ï¼ŒContentNegotiatingViewResolverçš„å¾ˆå¤šè¡Œä¸ºéƒ½æ˜¯é€šè¿‡ç›´æ¥è®¾ç½®ContentNegotiatingViewResolverçš„å±æ€§è¿›è¡Œé…ç½®çš„ã€‚ä»Spring 3.2å¼€å§‹ï¼ŒContentNegotiatingViewResolverçš„å¤§å¤šæ•°Setteræ–¹æ³•éƒ½åºŸå¼ƒäº†ï¼Œé¼“åŠ±é€šè¿‡ContentNegotiationManageræ¥è¿›è¡Œé…ç½®ã€‚</p>
<p>å°½ç®¡æˆ‘ä¸ä¼šåœ¨æœ¬ç« ä¸­ä»‹ç»é…ç½®ContentNegotiatingViewResolverçš„æ—§æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨åˆ›å»ºContentNegotiationManageræ‰€è®¾ç½®çš„å¾ˆå¤šå±æ€§ï¼Œåœ¨ContentNegotiatingViewResolverä¸­éƒ½æœ‰å¯¹åº”çš„å±æ€§ã€‚å¦‚æœä½ ä½¿ç”¨è¾ƒæ—©ç‰ˆæœ¬çš„Springçš„è¯ï¼Œåº”è¯¥èƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°å°†æ–°çš„é…ç½®æ–¹å¼å¯¹åº”åˆ°æ—§é…ç½®æ–¹å¼ä¸­ã€‚</p>
</blockquote>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨XMLé…ç½®ContentNegotiationManagerçš„è¯ï¼Œé‚£æœ€æœ‰ç”¨çš„å°†ä¼šæ˜¯ContentNegotiationManagerFactoryBeanã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›åœ¨XMLä¸­é…ç½®ContentNegotiationManagerä½¿ç”¨â€œapplication/jsonâ€ä½œä¸ºé»˜è®¤çš„å†…å®¹ç±»å‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;contentNegotiotionManager&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.ContentNegotiationManagerFactoryBean&quot;</span>      <span class="attr">p:defaultContentType</span>=<span class="string">&quot;application/json&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºContentNegotiationManagerFactoryBeanæ˜¯FactoryBeançš„å®ç°ï¼Œæ‰€ä»¥å®ƒä¼šåˆ›å»ºä¸€ä¸ªContentNegotiationManager beanã€‚è¿™ä¸ªContentNegotiationManagerèƒ½å¤Ÿæ³¨å…¥åˆ°ContentNegotiatingViewResolverçš„contentNegotiationManagerå±æ€§ä¸­ã€‚</p>
<p>å¦‚æœä½¿ç”¨Javaé…ç½®çš„è¯ï¼Œè·å¾—ContentNegotiationManagerçš„æœ€ç®€ä¾¿æ–¹æ³•å°±æ˜¯æ‰©å±•WebMvcConfigurerAdapterå¹¶é‡è½½configureContentNegotiation()æ–¹æ³•ã€‚åœ¨åˆ›å»ºSpring MVCåº”ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½å·²ç»æ‰©å±•äº†WebMvcConfigurerAdapterã€‚ä¾‹å¦‚ï¼Œåœ¨Spittråº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†WebMvcConfigurerAdapterçš„æ‰©å±•ç±»ï¼Œåä¸ºWebConfigï¼Œæ‰€ä»¥éœ€è¦åšçš„å°±æ˜¯é‡è½½configureContentNegotiation()æ–¹æ³•ã€‚å¦‚ä¸‹å°±æ˜¯configureContentNegotiation()çš„ä¸€ä¸ªå®ç°ï¼Œå®ƒè®¾ç½®äº†é»˜è®¤çš„å†…å®¹ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overridepublic</span> <span class="function"><span class="keyword">void</span> <span class="title">configureContentNegotiation</span><span class="params">(ContentNegotiationConfigurer configurer)</span> </span>&#123;  configurer.defualtContentType(MediaType.APPLICATION_JSON);&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒconfigureContentNegotiation()æ–¹æ³•ç»™å®šäº†ä¸€ä¸ªContentNegotiationConfigurerå¯¹è±¡ã€‚ContentNegotiationConfigurerä¸­çš„ä¸€äº›æ–¹æ³•å¯¹åº”äº<br>ContentNegotiationManagerçš„Setteræ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½åœ¨ContentNegotiation-Manageråˆ›å»ºæ—¶ï¼Œè®¾ç½®ä»»æ„å†…å®¹åå•†ç›¸å…³çš„å±æ€§ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨defaultContentType()æ–¹æ³•å°†é»˜è®¤çš„å†…å®¹ç±»å‹è®¾ç½®ä¸ºâ€œapplication/jsonâ€ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ContentNegotiationManager beanï¼Œæ¥ä¸‹æ¥å°±éœ€è¦å°†å®ƒæ³¨å…¥åˆ°ContentNegotiatingViewResolverçš„contentNegotiationManagerå±æ€§ä¸­ã€‚è¿™éœ€è¦æˆ‘ä»¬ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ä¹‹å‰å£°æ˜ContentNegotiatingViewResolverçš„@Beanæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">ViewResolver <span class="title">cnViewResilver</span><span class="params">(ContentNegotiatingManager cnm)</span> </span>&#123;  ContentNegotiatingViewResolver cnvr = <span class="keyword">new</span> ContentNegotiatingViewResolver();  cnvr.setContentNegotiation(cnm);  <span class="keyword">return</span> cnvr;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª@Beanæ–¹æ³•æ³¨å…¥äº†ContentNegotiationManagerï¼Œå¹¶ä½¿ç”¨å®ƒè°ƒç”¨äº†setContentNegotiationManager()ã€‚è¿™æ ·çš„ç»“æœå°±æ˜¯ContentNegotiatingViewã€Resolverå°†ä¼šä½¿ç”¨ContentNegotiationManageræ‰€å®šä¹‰çš„è¡Œä¸ºã€‚</p>
<p>é…ç½®ContentNegotiationManageræœ‰å¾ˆå¤šçš„ç»†èŠ‚ï¼Œåœ¨è¿™é‡Œæ— æ³•å¯¹å®ƒä»¬è¿›è¡Œä¸€ä¸€ä»‹ç»ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„é…ç½®æ ·ä¾‹ï¼Œå½“æˆ‘ä½¿ç”¨ContentNegotiatingViewResolverçš„æ—¶å€™ï¼Œé€šå¸¸ä¼šé‡‡ç”¨è¿™ç§ç”¨æ³•ï¼šå®ƒé»˜è®¤ä¼šä½¿ç”¨HTMLè§†å›¾ï¼Œä½†æ˜¯å¯¹ç‰¹å®šçš„è§†å›¾åç§°å°†ä¼šæ¸²æŸ“ä¸ºJSONè¾“å‡ºã€‚</p>
<p>ç¨‹åºæ¸…å•16.2ã€€é…ç½®ContentNegotiationManager</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">ViewResolver <span class="title">cnViewResolver</span><span class="params">(ContentNegotiationManager cnm)</span> </span>&#123;  ContentNegotiatingViewResolver cnvr = <span class="keyword">new</span> ContentNegotiatingViewResolver();  cnvr.setContentNegotiationManager(cnm);  <span class="keyword">return</span> cnvr;&#125;<span class="meta">@Overridepublic</span> <span class="function"><span class="keyword">void</span> <span class="title">configureContentNegotiation</span><span class="params">(ContentNegotiationConfigurer configurer)</span> </span>&#123;  configurer.defaultContentType(MediaType.TEXT_HTML);&#125;    <span class="meta">@Beanpublic</span> <span class="function">ViewResolver <span class="title">beanNameViewResolver</span><span class="params">()</span> </span>&#123;  <span class="keyword">return</span> <span class="keyword">new</span> BeanNameViewResolver();&#125;    <span class="meta">@Beanpublic</span> <span class="function">View <span class="title">spittles</span><span class="params">()</span> </span>&#123;  <span class="keyword">return</span> <span class="keyword">new</span> MappingJackson2JsonView();&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†ç¨‹åºæ¸…å•16.2ä¸­çš„å†…å®¹ä»¥å¤–ï¼Œè¿˜åº”è¯¥æœ‰ä¸€ä¸ªèƒ½å¤Ÿå¤„ç†HTMLçš„è§†å›¾è§£æå™¨ï¼ˆå¦‚InternalResourceViewResolveræˆ–TilesViewResolverï¼‰ã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼ŒContentNegotiatingViewResolverä¼šå‡è®¾å®¢æˆ·ç«¯éœ€è¦HTMLï¼Œå¦‚ContentNegotiationManageré…ç½®æ‰€ç¤ºã€‚ä½†æ˜¯ï¼Œå¦‚æœå®¢æˆ·ç«¯æŒ‡å®šäº†å®ƒæƒ³è¦JSONï¼ˆé€šè¿‡åœ¨è¯·æ±‚è·¯å¾„ä¸Šä½¿ç”¨â€œ.jsonâ€æ‰©å±•åæˆ–Acceptå¤´éƒ¨ä¿¡æ¯ï¼‰çš„è¯ï¼Œé‚£ä¹ˆContentNegotiatingViewResolverå°†ä¼šæŸ¥æ‰¾èƒ½å¤Ÿå¤„ç†JSONè§†å›¾çš„è§†å›¾è§£æå™¨ã€‚</p>
<p>å¦‚æœé€»è¾‘è§†å›¾çš„åç§°ä¸ºâ€œspittlesâ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰€é…ç½®çš„BeanNameViewResolverå°†ä¼šè§£æspittles()æ–¹æ³•ä¸­æ‰€å£°æ˜çš„Viewã€‚è¿™æ˜¯å› ä¸ºbeanåç§°åŒ¹é…é€»è¾‘è§†å›¾çš„åç§°ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…çš„Viewçš„è¯ï¼ŒContentNegotiatingViewResolverå°†ä¼šé‡‡ç”¨é»˜è®¤çš„è¡Œä¸ºï¼Œå°†å…¶è¾“å‡ºä¸ºHTMLã€‚</p>
<p>ContentNegotiatingViewResolverä¸€æ—¦èƒ½å¤Ÿç¡®å®šå®¢æˆ·ç«¯æƒ³è¦ä»€ä¹ˆæ ·çš„åª’ä½“ç±»å‹ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æŸ¥æ‰¾æ¸²æŸ“è¿™ç§å†…å®¹çš„è§†å›¾ã€‚</p>
<p>ContentNegotiatingViewResolverçš„ä¼˜åŠ¿ä¸é™åˆ¶</p>
<p>ContentNegotiatingViewResolveræœ€å¤§çš„ä¼˜åŠ¿åœ¨äºï¼Œå®ƒåœ¨Spring MVCä¹‹ä¸Šæ„å»ºäº†RESTèµ„æºè¡¨è¿°å±‚ï¼Œæ§åˆ¶å™¨ä»£ç æ— éœ€ä¿®æ”¹ã€‚ç›¸åŒçš„ä¸€å¥—æ§åˆ¶å™¨æ–¹æ³•èƒ½å¤Ÿä¸ºé¢å‘äººç±»çš„ç”¨æˆ·äº§ç”ŸHTMLå†…å®¹ï¼Œä¹Ÿèƒ½é’ˆå¯¹ä¸æ˜¯äººç±»çš„å®¢æˆ·ç«¯äº§ç”ŸJSONæˆ–XMLã€‚</p>
<p>å¦‚æœé¢å‘äººç±»ç”¨æˆ·çš„æ¥å£ä¸é¢å‘éäººç±»å®¢æˆ·ç«¯çš„æ¥å£ä¹‹é—´æœ‰å¾ˆå¤šé‡å çš„è¯ï¼Œé‚£ä¹ˆå†…å®¹åå•†æ˜¯ä¸€ç§å¾ˆä¾¿åˆ©çš„æ–¹æ¡ˆã€‚åœ¨å®è·µä¸­ï¼Œé¢å‘äººç±»ç”¨æˆ·çš„è§†å›¾ä¸REST APIåœ¨ç»†èŠ‚ä¸Šå¾ˆå°‘èƒ½å¤Ÿå¤„äºç›¸åŒçš„çº§åˆ«ã€‚å¦‚æœé¢å‘äººç±»ç”¨æˆ·çš„æ¥å£ä¸é¢å‘éäººç±»å®¢æˆ·ç«¯çš„æ¥å£ä¹‹é—´æ²¡æœ‰å¤ªå¤šé‡å çš„è¯ï¼Œé‚£ä¹ˆContentNegotiatingViewResolverçš„ä¼˜åŠ¿å°±ä½“ç°ä¸å‡ºæ¥äº†ã€‚</p>
<p>ContentNegotiatingViewResolverè¿˜æœ‰ä¸€ä¸ªä¸¥é‡çš„é™åˆ¶ã€‚ä½œä¸ºViewResolverçš„å®ç°ï¼Œå®ƒåªèƒ½å†³å®šèµ„æºè¯¥å¦‚ä½•æ¸²æŸ“åˆ°å®¢æˆ·ç«¯ï¼Œå¹¶æ²¡æœ‰æ¶‰åŠåˆ°å®¢æˆ·ç«¯è¦å‘é€ä»€ä¹ˆæ ·çš„è¡¨è¿°ç»™æ§åˆ¶å™¨ä½¿ç”¨ã€‚å¦‚æœå®¢æˆ·ç«¯å‘é€JSONæˆ–XMLçš„è¯ï¼Œé‚£ä¹ˆContentNegotiatingViewResolverå°±æ— æ³•æä¾›å¸®åŠ©äº†ã€‚</p>
<p>ContentNegotiatingViewResolverè¿˜æœ‰ä¸€ä¸ªç›¸å…³çš„å°é—®é¢˜ï¼Œæ‰€é€‰ä¸­çš„Viewä¼šæ¸²æŸ“æ¨¡å‹ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸æ˜¯èµ„æºã€‚è¿™é‡Œæœ‰ä¸ªç»†å¾®ä½†å¾ˆé‡è¦çš„åŒºåˆ«ã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚JSONæ ¼å¼çš„Spittleå¯¹è±¡åˆ—è¡¨æ—¶ï¼Œå®¢æˆ·ç«¯å¸Œæœ›å¾—åˆ°çš„å“åº”å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ &#123;   <span class="attr">&quot;id&quot;</span>: <span class="number">42</span>,   <span class="attr">&quot;latitude&quot;</span>: <span class="number">28.419489</span>,   <span class="attr">&quot;longitude&quot;</span>: <span class="number">-81.581184</span>,   <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>,   <span class="attr">&quot;time&quot;</span>: <span class="number">140038920000</span>  &#125;, &#123;   <span class="attr">&quot;id&quot;</span>: <span class="number">43</span>,   <span class="attr">&quot;latitude&quot;</span>: <span class="number">28.419136</span>,   <span class="attr">&quot;longitude&quot;</span>: <span class="number">-81.577225</span>,   <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Blast off!&quot;</span>,   <span class="attr">&quot;time&quot;</span>: <span class="number">140047560000</span> &#125;]</span><br></pre></td></tr></table></figure>

<p>è€Œæ¨¡å‹æ˜¯key-valueç»„æˆçš„Mapï¼Œé‚£ä¹ˆå“åº”å¯èƒ½ä¼šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;  <span class="attr">&quot;spittleList&quot;</span>: [    &#123;      <span class="attr">&quot;id&quot;</span>: <span class="number">42</span>,      <span class="attr">&quot;latitude&quot;</span>: <span class="number">28.419489</span>,      <span class="attr">&quot;longitude&quot;</span>: <span class="number">-81.581184</span>,      <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>,      <span class="attr">&quot;time&quot;</span>: <span class="number">140038920000</span>    &#125;,    &#123;      <span class="attr">&quot;id&quot;</span>: <span class="number">43</span>,      <span class="attr">&quot;latitude&quot;</span>: <span class="number">28.419136</span>,      <span class="attr">&quot;longitude&quot;</span>: <span class="number">-81.577225</span>,      <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Blast off!&quot;</span>,      <span class="attr">&quot;time&quot;</span>: <span class="number">140047560000</span>    &#125;  ]&#125;</span><br></pre></td></tr></table></figure>

<p>å°½ç®¡è¿™ä¸æ˜¯å¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œä½†ç¡®å®å¯èƒ½ä¸æ˜¯å®¢æˆ·ç«¯æ‰€é¢„æœŸçš„ç»“æœã€‚å› ä¸ºæœ‰è¿™äº›é™åˆ¶ï¼Œæˆ‘é€šå¸¸å»ºè®®ä¸è¦ä½¿ç”¨ContentNegotiatingViewResolverã€‚æˆ‘æ›´åŠ å€¾å‘äºä½¿ç”¨<br>Springçš„æ¶ˆæ¯è½¬æ¢åŠŸèƒ½æ¥ç”Ÿæˆèµ„æºè¡¨è¿°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨æ§åˆ¶å™¨ä»£ç ä¸­ä½¿ç”¨Springçš„æ¶ˆæ¯è½¬æ¢å™¨ã€‚</p>
<h4 id="ä½¿ç”¨HTTPä¿¡æ¯è½¬æ¢å™¨"><a href="#ä½¿ç”¨HTTPä¿¡æ¯è½¬æ¢å™¨" class="headerlink" title="ä½¿ç”¨HTTPä¿¡æ¯è½¬æ¢å™¨"></a>ä½¿ç”¨HTTPä¿¡æ¯è½¬æ¢å™¨</h4><p>æ¶ˆæ¯è½¬æ¢ï¼ˆmessage conversionï¼‰æä¾›äº†ä¸€ç§æ›´ä¸ºç›´æ¥çš„æ–¹å¼ï¼Œå®ƒèƒ½å¤Ÿå°†æ§åˆ¶å™¨äº§ç”Ÿçš„æ•°æ®è½¬æ¢ä¸ºæœåŠ¡äºå®¢æˆ·ç«¯çš„è¡¨è¿°å½¢å¼ã€‚å½“ä½¿ç”¨æ¶ˆæ¯è½¬æ¢åŠŸèƒ½æ—¶ï¼ŒDispatcherServletä¸å†éœ€è¦é‚£ä¹ˆéº»çƒ¦åœ°å°†æ¨¡å‹æ•°æ®ä¼ é€åˆ°è§†å›¾ä¸­ã€‚å®é™…ä¸Šï¼Œè¿™é‡Œæ ¹æœ¬å°±æ²¡æœ‰æ¨¡å‹ï¼Œä¹Ÿæ²¡æœ‰è§†å›¾ï¼Œåªæœ‰æ§åˆ¶å™¨äº§ç”Ÿçš„æ•°æ®ï¼Œä»¥åŠæ¶ˆæ¯è½¬æ¢å™¨ï¼ˆmessage converterï¼‰è½¬æ¢æ•°æ®ä¹‹åæ‰€äº§ç”Ÿçš„èµ„æºè¡¨è¿°ã€‚</p>
<p>Springè‡ªå¸¦äº†å„ç§å„æ ·çš„è½¬æ¢å™¨ï¼Œå¦‚è¡¨16.1æ‰€ç¤ºï¼Œè¿™äº›è½¬æ¢å™¨æ»¡è¶³äº†æœ€å¸¸è§çš„å°†å¯¹è±¡è½¬æ¢ä¸ºè¡¨è¿°çš„éœ€è¦ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾å®¢æˆ·ç«¯é€šè¿‡è¯·æ±‚çš„Acceptå¤´ä¿¡æ¯è¡¨æ˜å®ƒèƒ½æ¥å—â€œapplication/jsonâ€ï¼Œå¹¶ä¸”Jackson JSONåœ¨ç±»è·¯å¾„ä¸‹ï¼Œé‚£ä¹ˆå¤„ç†æ–¹æ³•è¿”å›çš„å¯¹è±¡å°†äº¤ç»™MappingJacksonHttpMessageConverterï¼Œå¹¶ç”±å®ƒè½¬æ¢ä¸ºè¿”å›å®¢æˆ·ç«¯çš„JSONè¡¨è¿°å½¢å¼ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœè¯·æ±‚çš„å¤´ä¿¡æ¯è¡¨æ˜å®¢æˆ·ç«¯æƒ³è¦â€œtext/xmlâ€æ ¼å¼ï¼Œé‚£ä¹ˆJaxb2RootElementHttpMessageConverterå°†ä¼šä¸ºå®¢æˆ·ç«¯äº§ç”ŸXMLå“åº”ã€‚</p>
<p>æ³¨æ„ï¼Œè¡¨16.2ä¸­çš„HTTPä¿¡æ¯è½¬æ¢å™¨é™¤äº†å…¶ä¸­çš„äº”ä¸ªä»¥å¤–éƒ½æ˜¯è‡ªåŠ¨æ³¨å†Œçš„ï¼Œæ‰€ä»¥è¦ä½¿ç”¨å®ƒä»¬çš„è¯ï¼Œä¸éœ€è¦Springé…ç½®ã€‚ä½†æ˜¯ä¸ºäº†æ”¯æŒå®ƒä»¬ï¼Œä½ éœ€è¦æ·»åŠ ä¸€äº›åº“åˆ°åº”ç”¨ç¨‹åºçš„ç±»è·¯å¾„ä¸‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨MappingJacksonHttpMessageConverteræ¥å®ç°JSONæ¶ˆæ¯å’ŒJavaå¯¹è±¡çš„äº’ç›¸è½¬æ¢ï¼Œé‚£ä¹ˆéœ€è¦å°†Jackson JSON Processoråº“æ·»åŠ åˆ°ç±»è·¯å¾„ä¸­ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨Jaxb2RootElementHttpMessageConverteræ¥å®ç°XMLæ¶ˆæ¯å’ŒJavaå¯¹è±¡çš„äº’ç›¸è½¬æ¢ï¼Œé‚£ä¹ˆéœ€è¦JAXBåº“ã€‚å¦‚æœä¿¡æ¯æ˜¯Atomæˆ–RSSæ ¼å¼çš„è¯ï¼Œé‚£ä¹ˆAtom-FeedHttpMessageConverterå’ŒRssChannelHttpMessageConverterä¼šéœ€è¦Romeåº“ã€‚</p>
<p>è¡¨16.1ã€€Springæä¾›äº†å¤šä¸ªHTTPä¿¡æ¯è½¬æ¢å™¨ï¼Œç”¨äºå®ç°èµ„æºè¡¨è¿°ä¸å„ç§Javaç±»å‹ä¹‹é—´çš„äº’ç›¸è½¬æ¢</p>
<table>
<thead>
<tr>
<th>ä¿¡æ¯è½¬æ¢å™¨</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>AtomFeedHttpMessageConverter</td>
<td>Rome Feedå¯¹è±¡å’ŒAtom feedï¼ˆåª’ä½“ç±»å‹application/atom+xmlï¼‰ä¹‹é—´çš„äº’ç›¸è½¬æ¢ã€‚å¦‚æœ Rome åŒ…åœ¨ç±»è·¯å¾„ä¸‹å°†ä¼šè¿›è¡Œæ³¨å†Œ</td>
</tr>
<tr>
<td>BufferedImageHttpMessageConverter</td>
<td>BufferedImagesä¸å›¾ç‰‡äºŒè¿›åˆ¶æ•°æ®ä¹‹é—´äº’ç›¸è½¬æ¢</td>
</tr>
<tr>
<td>ByteArrayHttpMessageConverter</td>
<td>è¯»å–/å†™å…¥å­—èŠ‚æ•°ç»„ã€‚ä»æ‰€æœ‰åª’ä½“ç±»å‹ï¼ˆ*/*ï¼‰ä¸­è¯»å–ï¼Œå¹¶ä»¥application/octetstreamæ ¼å¼å†™å…¥</td>
</tr>
<tr>
<td>FormHttpMessageConverter</td>
<td>å°†application/x-www-form-urlencodedå†…å®¹è¯»å…¥åˆ°MultiValueMap&lt;String,String&gt;ä¸­ï¼Œä¹Ÿä¼šå°†MultiValueMap&lt;String,String&gt;å†™å…¥åˆ°application/x-www-form-urlencodedä¸­æˆ–å°†MultiValueMap&lt;String, Object&gt;å†™å…¥åˆ°multipart/form-dataä¸­</td>
</tr>
<tr>
<td>Jaxb2RootElementHttpMessageConverter</td>
<td>åœ¨XMLï¼ˆtext/xmlæˆ–application/xmlï¼‰å’Œä½¿ç”¨JAXB2æ³¨è§£çš„å¯¹è±¡é—´äº’ç›¸è¯»å–å’Œå†™å…¥ã€‚å¦‚æœ JAXB v2 åº“åœ¨ç±»è·¯å¾„ä¸‹ï¼Œå°†è¿›è¡Œæ³¨å†Œ</td>
</tr>
<tr>
<td>MappingJacksonHttpMessageConverter</td>
<td>åœ¨JSONå’Œç±»å‹åŒ–çš„å¯¹è±¡æˆ–éç±»å‹åŒ–çš„HashMapé—´äº’ç›¸è¯»å–å’Œå†™å…¥ã€‚å¦‚æœ Jackson JSON åº“åœ¨ç±»è·¯å¾„ä¸‹ï¼Œå°†è¿›è¡Œæ³¨å†Œ</td>
</tr>
<tr>
<td>MappingJackson2HttpMessageConverter</td>
<td>åœ¨JSONå’Œç±»å‹åŒ–çš„å¯¹è±¡æˆ–éç±»å‹åŒ–çš„HashMapé—´äº’ç›¸è¯»å–å’Œå†™å…¥ã€‚å¦‚æœ Jackson 2 JSON åº“åœ¨ç±»è·¯å¾„ä¸‹ï¼Œå°†è¿›è¡Œæ³¨å†Œ</td>
</tr>
<tr>
<td>MarshallingHttpMessageConverter</td>
<td>ä½¿ç”¨æ³¨å…¥çš„ç¼–æ’å™¨å’Œè§£æ’å™¨ï¼ˆmarshallerå’Œunmarshallerï¼‰æ¥è¯»å…¥å’Œå†™å…¥XMLã€‚æ”¯æŒçš„ç¼–æ’å™¨å’Œè§£æ’å™¨åŒ…æ‹¬Castorã€JAXB2ã€JIBXã€XMLBeansä»¥åŠXstream<br>ResourceHttpMessageConverter è¯»å–æˆ–å†™å…¥Resource</td>
</tr>
<tr>
<td>RssChannelHttpMessageConverter</td>
<td>åœ¨RSS feedå’ŒRome Channelå¯¹è±¡é—´äº’ç›¸è¯»å–æˆ–å†™å…¥ã€‚å¦‚æœ Rome åº“åœ¨ç±»è·¯å¾„ä¸‹ï¼Œå°†è¿›è¡Œæ³¨å†Œ</td>
</tr>
<tr>
<td>SourceHttpMessageConverter</td>
<td>åœ¨XMLå’Œjavax.xml.transform.Sourceå¯¹è±¡é—´äº’ç›¸è¯»å–å’Œå†™å…¥ã€‚é»˜è®¤æ³¨å†Œ</td>
</tr>
<tr>
<td>StringHttpMessageConverter</td>
<td>å°†æ‰€æœ‰åª’ä½“ç±»å‹ï¼ˆ*/*ï¼‰è¯»å–ä¸ºStringã€‚å°†Stringå†™å…¥ä¸ºtext/plain</td>
</tr>
<tr>
<td>XmlAwareFormHttpMessageConverter</td>
<td>FormHttpMessageConverterçš„æ‰©å±•ï¼Œä½¿ç”¨SourceHttp MessageConverteræ¥æ”¯æŒåŸºäºXMLçš„éƒ¨åˆ†</td>
</tr>
</tbody></table>
<p>ä½ å¯èƒ½å·²ç»çŒœåˆ°äº†ï¼Œä¸ºäº†æ”¯æŒæ¶ˆæ¯è½¬æ¢ï¼Œæˆ‘ä»¬éœ€è¦å¯¹Spring MVCçš„ç¼–ç¨‹æ¨¡å‹è¿›è¡Œä¸€äº›å°è°ƒæ•´ã€‚</p>
<p>åœ¨å“åº”ä½“ä¸­è¿”å›èµ„æºçŠ¶æ€</p>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“å¤„ç†æ–¹æ³•è¿”å›Javaå¯¹è±¡ï¼ˆé™¤Stringå¤–æˆ–Viewçš„å®ç°ä»¥å¤–ï¼‰æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šæ”¾åœ¨æ¨¡å‹ä¸­å¹¶åœ¨è§†å›¾ä¸­æ¸²æŸ“ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨äº†æ¶ˆæ¯è½¬æ¢åŠŸèƒ½çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰Springè·³è¿‡æ­£å¸¸çš„æ¨¡å‹/è§†å›¾æµç¨‹ï¼Œå¹¶ä½¿ç”¨æ¶ˆæ¯è½¬æ¢å™¨ã€‚æœ‰ä¸å°‘æ–¹å¼éƒ½èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä¸ºæ§åˆ¶å™¨æ–¹æ³•æ·»åŠ @ResponseBodyæ³¨è§£ã€‚</p>
<p>é‡æ–°çœ‹ä¸€ä¸‹ç¨‹åºæ¸…å•16.1ä¸­çš„spittles()æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå…¶æ·»åŠ @ResponseBodyæ³¨è§£ï¼Œè¿™æ ·å°±èƒ½è®©Springå°†æ–¹æ³•è¿”å›çš„List<Spittle>è½¬æ¢ä¸ºå“åº”ä½“ï¼š</Spittle></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(method=RequestMethod.GET, produces=&quot;application/json&quot;)</span><span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">List&lt;Spittle&gt; <span class="title">spittles</span><span class="params">(    <span class="meta">@RequestParam(value=&quot;max&quot;, defaultValue=MAX_LONG_AS_STRING)</span> <span class="keyword">long</span> max,    <span class="meta">@RequestParam(value=&quot;count&quot;, defaultValue=&quot;20&quot;)</span> <span class="keyword">int</span> count)</span> </span>&#123;  <span class="keyword">return</span> spittleRepository.findSpittles(max, count);&#125;</span><br></pre></td></tr></table></figure>

<p>@ResponseBodyæ³¨è§£ä¼šå‘ŠçŸ¥Springï¼Œæˆ‘ä»¬è¦å°†è¿”å›çš„å¯¹è±¡ä½œä¸ºèµ„æºå‘é€ç»™å®¢æˆ·ç«¯ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå®¢æˆ·ç«¯å¯æ¥å—çš„è¡¨è¿°å½¢å¼ã€‚æ›´å…·ä½“åœ°è®²ï¼ŒDispatcherServletå°†ä¼šè€ƒè™‘åˆ°è¯·æ±‚ä¸­Acceptå¤´éƒ¨ä¿¡æ¯ï¼Œå¹¶æŸ¥æ‰¾èƒ½å¤Ÿä¸ºå®¢æˆ·ç«¯æä¾›æ‰€éœ€è¡¨è¿°å½¢å¼çš„æ¶ˆæ¯è½¬æ¢å™¨ã€‚</p>
<p>ä¸¾ä¾‹æ¥è®²ï¼Œå‡è®¾å®¢æˆ·ç«¯çš„Acceptå¤´éƒ¨ä¿¡æ¯è¡¨æ˜å®ƒæ¥å—â€œapplication/jsonâ€ï¼Œå¹¶ä¸”Jackson JSONåº“ä½äºåº”ç”¨çš„ç±»è·¯å¾„ä¸‹ï¼Œé‚£ä¹ˆå°†ä¼šé€‰æ‹©appingJacksonHttpMessageConverteræˆ–MappingJackson2HttpMessageConverterï¼ˆè¿™å–å†³äºç±»è·¯å¾„ä¸‹æ˜¯å“ªä¸ªç‰ˆæœ¬çš„Jacksonï¼‰ã€‚æ¶ˆæ¯è½¬æ¢å™¨ä¼šå°†æ§åˆ¶å™¨è¿”å›çš„Spittleåˆ—è¡¨è½¬æ¢ä¸ºJSONæ–‡æ¡£ï¼Œå¹¶å°†å…¶å†™å…¥åˆ°å“åº”ä½“ä¸­ã€‚å“åº”å¤§è‡´ä¼šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ &#123;   <span class="attr">&quot;id&quot;</span>: <span class="number">42</span>,   <span class="attr">&quot;latitude&quot;</span>: <span class="number">28.419489</span>,   <span class="attr">&quot;longitude&quot;</span>: <span class="number">-81.581184</span>,   <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>,   <span class="attr">&quot;time&quot;</span>: <span class="number">140038920000</span>  &#125;, &#123;   <span class="attr">&quot;id&quot;</span>: <span class="number">43</span>,   <span class="attr">&quot;latitude&quot;</span>: <span class="number">28.419136</span>,   <span class="attr">&quot;longitude&quot;</span>: <span class="number">-81.577225</span>,   <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Blast off!&quot;</span>,   <span class="attr">&quot;time&quot;</span>: <span class="number">140047560000</span> &#125;]</span><br></pre></td></tr></table></figure>

<p>Jacksoné»˜è®¤ä¼šä½¿ç”¨åå°„</p>
<p>æ³¨æ„åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒJackson JSONåº“åœ¨å°†è¿”å›çš„å¯¹è±¡è½¬æ¢ä¸ºJSONèµ„æºè¡¨è¿°æ—¶ï¼Œä¼šä½¿ç”¨åå°„ã€‚å¯¹äºç®€å•çš„è¡¨è¿°å†…å®¹æ¥è®²ï¼Œè¿™æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ä½†æ˜¯å¦‚æœä½ é‡æ„äº†Javaç±»å‹ï¼Œæ¯”å¦‚æ·»åŠ ã€ç§»é™¤æˆ–é‡å‘½åå±æ€§ï¼Œé‚£ä¹ˆæ‰€äº§ç”Ÿçš„JSONä¹Ÿå°†ä¼šå‘ç”Ÿå˜åŒ–ï¼ˆå¦‚æœå®¢æˆ·ç«¯ä¾èµ–è¿™äº›å±æ€§çš„è¯ï¼Œé‚£å®¢æˆ·ç«¯æœ‰å¯èƒ½ä¼šå‡ºé”™ï¼‰ã€‚</p>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Javaç±»å‹ä¸Šä½¿ç”¨Jacksonçš„æ˜ å°„æ³¨è§£ï¼Œä»è€Œæ”¹å˜äº§ç”ŸJSONçš„è¡Œä¸ºã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½æ›´å¤šåœ°æ§åˆ¶æ‰€äº§ç”Ÿçš„JSONï¼Œä»è€Œé˜²æ­¢å®ƒå½±å“åˆ°APIæˆ–å®¢æˆ·ç«¯ã€‚</p>
<p>Jacksonæ˜ å°„æ³¨è§£çš„å†…å®¹è¶…å‡ºäº†æœ¬ä¹¦çš„è®¨è®ºèŒƒå›´ï¼Œä¸è¿‡å…³äºè¿™ä¸ªä¸»é¢˜ï¼Œåœ¨<a target="_blank" rel="noopener" href="http://wiki.fasterxml.com/Jackson-Annotations%E4%B8%8A%E6%9C%89%E4%B8%80%E4%BA%9B%E6%9C%89%E7%94%A8%E7%9A%84%E6%96%87%E6%A1%A3%E3%80%82">http://wiki.fasterxml.com/Jackson-Annotationsä¸Šæœ‰ä¸€äº›æœ‰ç”¨çš„æ–‡æ¡£ã€‚</a></p>
<p>è°ˆåŠAcceptå¤´éƒ¨ä¿¡æ¯ï¼Œè¯·æ³¨æ„getSpitter()çš„@RequestMappingæ³¨è§£ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä½¿ç”¨äº†produceså±æ€§è¡¨æ˜è¿™ä¸ªæ–¹æ³•åªå¤„ç†é¢„æœŸè¾“å‡ºä¸ºJSONçš„è¯·æ±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•åªä¼šå¤„ç†Acceptå¤´éƒ¨ä¿¡æ¯åŒ…å«â€œapplication/jsonâ€çš„è¯·æ±‚ã€‚å…¶ä»–ä»»ä½•ç±»å‹çš„è¯·æ±‚ï¼Œå³ä½¿å®ƒçš„URLåŒ¹é…æŒ‡å®šçš„è·¯å¾„å¹¶ä¸”æ˜¯GETè¯·æ±‚ä¹Ÿä¸ä¼šè¢«è¿™ä¸ªæ–¹æ³•å¤„ç†ã€‚è¿™æ ·çš„è¯·æ±‚ä¼šè¢«å…¶ä»–çš„æ–¹æ³•æ¥è¿›è¡Œå¤„ç†ï¼ˆå¦‚æœå­˜åœ¨é€‚å½“æ–¹æ³•çš„è¯ï¼‰ï¼Œæˆ–è€…è¿”å›å®¢æˆ·ç«¯HTTP 406ï¼ˆNot Acceptableï¼‰å“åº”ã€‚</p>
<p>åœ¨è¯·æ±‚ä½“ä¸­æ¥æ”¶èµ„æºçŠ¶æ€</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªå…³æ³¨äº†RESTç«¯ç‚¹å¦‚ä½•ä¸ºå®¢æˆ·ç«¯æä¾›èµ„æºã€‚ä½†æ˜¯RESTå¹¶ä¸æ˜¯åªè¯»çš„ï¼ŒREST APIä¹Ÿå¯ä»¥æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„èµ„æºè¡¨è¿°ã€‚</p>
<p>å¦‚æœè¦è®©æ§åˆ¶å™¨å°†å®¢æˆ·ç«¯å‘é€çš„JSONå’ŒXMLè½¬æ¢ä¸ºå®ƒæ‰€ä½¿ç”¨çš„Javaå¯¹è±¡ï¼Œé‚£æ˜¯éå¸¸ä¸æ–¹ä¾¿çš„ã€‚åœ¨å¤„ç†é€»è¾‘ç¦»å¼€æ§åˆ¶å™¨çš„æ—¶å€™ï¼ŒSpringçš„æ¶ˆæ¯è½¬æ¢å™¨èƒ½å¤Ÿå°†å¯¹è±¡è½¬æ¢ä¸ºè¡¨è¿°â€”â€”å®ƒä»¬èƒ½ä¸èƒ½åœ¨è¡¨è¿°ä¼ å…¥çš„æ—¶å€™å®Œæˆç›¸åŒçš„ä»»åŠ¡å‘¢ï¼Ÿ</p>
<p>@ResponseBodyèƒ½å¤Ÿå‘Šè¯‰Springåœ¨æŠŠæ•°æ®å‘é€ç»™å®¢æˆ·ç«¯çš„æ—¶å€™ï¼Œè¦ä½¿ç”¨æŸä¸€ä¸ªæ¶ˆæ¯å™¨ï¼Œä¸ä¹‹ç±»ä¼¼ï¼Œ@RequestBodyä¹Ÿèƒ½å‘Šè¯‰SpringæŸ¥æ‰¾ä¸€ä¸ªæ¶ˆæ¯è½¬æ¢å™¨ï¼Œå°†æ¥è‡ªå®¢æˆ·ç«¯çš„èµ„æºè¡¨è¿°è½¬æ¢ä¸ºå¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼å°†å®¢æˆ·ç«¯æäº¤çš„æ–°Spittleä¿å­˜èµ·æ¥ã€‚æˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼ç¼–å†™æ§åˆ¶å™¨æ–¹æ³•æ¥å¤„ç†è¿™ç§è¯·æ±‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(method=RequestMethod.POST, consumes=&quot;application/json&quot;)</span><span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">Spittle <span class="title">saveSpittle</span><span class="params">(<span class="meta">@RequestBody</span> Spittle spittle)</span> </span>&#123;  <span class="keyword">return</span> spittleRepository.save(spittle);&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå¿½ç•¥æ‰æ³¨è§£çš„è¯ï¼Œé‚£saveSpittle()æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ–¹æ³•ã€‚å®ƒæ¥å—ä¸€ä¸ªSpittleå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶ä½¿ç”¨SpittleRepositoryè¿›è¡Œä¿å­˜ï¼Œæœ€ç»ˆè¿”å›spittleRepository.save()æ–¹æ³•æ‰€å¾—åˆ°çš„Spittleå¯¹è±¡ã€‚</p>
<p>ä½†æ˜¯ï¼Œé€šè¿‡ä½¿ç”¨æ³¨è§£ï¼Œå®ƒä¼šå˜å¾—æ›´åŠ æœ‰æ„æ€ä¹Ÿæ›´åŠ å¼ºå¤§ã€‚@RequestMappingè¡¨æ˜å®ƒåªèƒ½å¤„ç†â€œ/spittlesâ€ï¼ˆåœ¨ç±»çº§åˆ«çš„@RequestMappingä¸­è¿›è¡Œäº†å£°æ˜ï¼‰çš„POSTè¯·æ±‚ã€‚POSTè¯·æ±‚ä½“ä¸­é¢„æœŸè¦åŒ…å«ä¸€ä¸ªSpittleçš„èµ„æºè¡¨è¿°ã€‚å› ä¸ºSpittleå‚æ•°ä¸Šä½¿ç”¨äº†@RequestBodyï¼Œæ‰€ä»¥Springå°†ä¼šæŸ¥çœ‹è¯·æ±‚ä¸­çš„Content-Typeå¤´éƒ¨ä¿¡æ¯ï¼Œå¹¶æŸ¥æ‰¾èƒ½å¤Ÿå°†è¯·æ±‚ä½“è½¬æ¢ä¸ºSpittleçš„æ¶ˆæ¯è½¬æ¢å™¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯å‘é€çš„Spittleæ•°æ®æ˜¯JSONè¡¨è¿°å½¢å¼ï¼Œé‚£ä¹ˆContent-Typeå¤´éƒ¨ä¿¡æ¯å¯èƒ½å°±ä¼šæ˜¯â€œapplication/jsonâ€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒDispatcherServletä¼šæŸ¥æ‰¾èƒ½å¤Ÿå°†JSONè½¬æ¢ä¸ºJavaå¯¹è±¡çš„æ¶ˆæ¯è½¬æ¢å™¨ã€‚å¦‚æœJackson 2åº“åœ¨ç±»è·¯å¾„ä¸­ï¼Œé‚£ä¹ˆMappingJackson2HttpMessageConverterå°†ä¼šæ‹…æ­¤é‡ä»»ï¼Œå°†JSONè¡¨è¿°è½¬æ¢ä¸ºSpittleï¼Œç„¶åä¼ é€’åˆ°saveSpittle()æ–¹æ³•ä¸­ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•è¿˜ä½¿ç”¨äº†@ResponseBodyæ³¨è§£ï¼Œå› æ­¤æ–¹æ³•è¿”å›çš„Spittleå¯¹è±¡å°†ä¼šè½¬æ¢ä¸ºæŸç§èµ„æºè¡¨è¿°ï¼Œå‘é€ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>æ³¨æ„ï¼Œ@RequestMappingæœ‰ä¸€ä¸ªconsumeså±æ€§ï¼Œæˆ‘ä»¬å°†å…¶è®¾ç½®ä¸ºâ€œapplication/ jsonâ€ã€‚consumeså±æ€§çš„å·¥ä½œæ–¹å¼ç±»ä¼¼äºproducesï¼Œä¸è¿‡å®ƒä¼šå…³æ³¨è¯·æ±‚çš„Content-Typeå¤´éƒ¨ä¿¡æ¯ã€‚å®ƒä¼šå‘Šè¯‰Springè¿™ä¸ªæ–¹æ³•åªä¼šå¤„ç†å¯¹â€œ/spittlesâ€çš„POSTè¯·æ±‚ï¼Œå¹¶ä¸”è¦æ±‚è¯·æ±‚çš„Content-Typeå¤´éƒ¨ä¿¡æ¯ä¸ºâ€œapplication/jsonâ€ã€‚å¦‚æœæ— <br>æ³•æ»¡è¶³è¿™äº›æ¡ä»¶çš„è¯ï¼Œä¼šç”±å…¶ä»–æ–¹æ³•ï¼ˆå¦‚æœå­˜åœ¨åˆé€‚çš„æ–¹æ³•çš„è¯ï¼‰æ¥å¤„ç†è¯·æ±‚ã€‚</p>
<p>ä¸ºæ§åˆ¶å™¨é»˜è®¤è®¾ç½®æ¶ˆæ¯è½¬æ¢</p>
<p>å½“å¤„ç†è¯·æ±‚æ—¶ï¼Œ@ResponseBodyå’Œ@RequestBodyæ˜¯å¯ç”¨æ¶ˆæ¯è½¬æ¢çš„ä¸€ç§ç®€æ´å’Œå¼ºå¤§æ–¹å¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æ‰€ç¼–å†™çš„æ§åˆ¶å™¨æœ‰å¤šä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”æ¯ä¸ªæ–¹æ³•éƒ½éœ€è¦ä¿¡æ¯è½¬æ¢åŠŸèƒ½çš„è¯ï¼Œé‚£ä¹ˆè¿™äº›æ³¨è§£å°±ä¼šå¸¦æ¥ä¸€å®šç¨‹åº¦çš„é‡å¤æ€§ã€‚</p>
<p>Spring 4.0å¼•å…¥äº†@RestControlleræ³¨è§£ï¼Œèƒ½å¤Ÿåœ¨è¿™ä¸ªæ–¹é¢ç»™æˆ‘ä»¬æä¾›å¸®åŠ©ã€‚å¦‚æœåœ¨æ§åˆ¶å™¨ç±»ä¸Šä½¿ç”¨@RestControlleræ¥ä»£æ›¿@Controllerçš„è¯ï¼ŒSpringå°†ä¼šä¸ºè¯¥æ§åˆ¶å™¨çš„æ‰€æœ‰å¤„ç†æ–¹æ³•åº”ç”¨æ¶ˆæ¯è½¬æ¢åŠŸèƒ½ã€‚æˆ‘ä»¬ä¸å¿…ä¸ºæ¯ä¸ªæ–¹æ³•éƒ½æ·»åŠ @ResponseBodyäº†ã€‚æˆ‘ä»¬æ‰€å®šä¹‰çš„SpittleControllerå¯èƒ½å°±ä¼šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>ç¨‹åºæ¸…å•16.3ã€€ä½¿ç”¨@RestControlleræ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.api;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.stereotype.Controller;<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;<span class="keyword">import</span> spittr.Spittle;<span class="keyword">import</span> spittr.data.SpittleRepository;<span class="meta">@RestController</span><span class="meta">@RequestMapping(&quot;/spittles&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpittleApiController</span> </span>&#123;  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String MAX_LONG_AS_STRING = <span class="string">&quot;9223372036854775807&quot;</span>;  <span class="keyword">private</span> SpittleRepository spittleRepository;  <span class="meta">@Autowired</span>  <span class="function"><span class="keyword">public</span> <span class="title">SpittleApiController</span><span class="params">(SpittleRepository spittleRepository)</span> </span>&#123;    <span class="keyword">this</span>.spittleRepository = spittleRepository;  &#125;  <span class="meta">@RequestMapping(method = RequestMethod.GET)</span>  <span class="function"><span class="keyword">public</span> List&lt;Spittle&gt; <span class="title">spittles</span><span class="params">(      <span class="meta">@RequestParam(value = &quot;max&quot;, defaultValue = MAX_LONG_AS_STRING)</span> <span class="keyword">long</span> max,      <span class="meta">@RequestParam(value = &quot;count&quot;, defaultValue = &quot;20&quot;)</span> <span class="keyword">int</span> count)</span> </span>&#123;    <span class="keyword">return</span> spittleRepository.findSpittles(max, count);  &#125;    <span class="meta">@RequestMapping(method = RequestMethod.POST, consumes = &quot;application/json&quot;)</span>  <span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">Spittle <span class="title">saveSpittle</span><span class="params">(<span class="meta">@RequestBody</span> Spittle spittle)</span> </span>&#123;    <span class="keyword">return</span> spittleRepository.save(spittle);  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºæ¸…å•16.3çš„å…³é”®ç‚¹åœ¨äºä»£ç ä¸­æ­¤æ—¶ä¸åŒ…å«ä»€ä¹ˆã€‚è¿™ä¸¤ä¸ªå¤„ç†å™¨æ–¹æ³•éƒ½æ²¡æœ‰ä½¿ç”¨@ResponseBodyæ³¨è§£ï¼Œå› ä¸ºæ§åˆ¶å™¨ä½¿ç”¨äº†@RestControllerï¼Œæ‰€ä»¥å®ƒçš„æ–¹æ³•æ‰€è¿”å›çš„å¯¹è±¡å°†ä¼šé€šè¿‡æ¶ˆæ¯è½¬æ¢æœºåˆ¶ï¼Œäº§ç”Ÿå®¢æˆ·ç«¯æ‰€éœ€çš„èµ„æºè¡¨è¿°ã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨Spring MVCç¼–ç¨‹æ¨¡å‹å°†RESTfulèµ„æºå‘å¸ƒåˆ°å“åº”ä½“ä¹‹ä¸­ã€‚ä½†æ˜¯å“åº”é™¤äº†è´Ÿè½½ä»¥å¤–è¿˜ä¼šæœ‰å…¶ä»–çš„å†…å®¹ã€‚å¤´éƒ¨ä¿¡æ¯å’ŒçŠ¶æ€ç ä¹Ÿèƒ½å¤Ÿä¸ºå®¢æˆ·ç«¯æä¾›å“åº”çš„æœ‰ç”¨ä¿¡æ¯ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹åœ¨æä¾›èµ„æºçš„æ—¶å€™ï¼Œå¦‚ä½•å¡«å……å¤´éƒ¨ä¿¡æ¯å’Œè®¾ç½®çŠ¶æ€ç ã€‚</p>
<h3 id="æä¾›èµ„æºä¹‹å¤–çš„å…¶ä»–å†…å®¹"><a href="#æä¾›èµ„æºä¹‹å¤–çš„å…¶ä»–å†…å®¹" class="headerlink" title="æä¾›èµ„æºä¹‹å¤–çš„å…¶ä»–å†…å®¹"></a>æä¾›èµ„æºä¹‹å¤–çš„å…¶ä»–å†…å®¹</h3><p>@ResponseBodyæä¾›äº†ä¸€ç§å¾ˆæœ‰ç”¨çš„æ–¹å¼ï¼Œèƒ½å¤Ÿå°†æ§åˆ¶å™¨è¿”å›çš„Javaå¯¹è±¡è½¬æ¢ä¸ºå‘é€åˆ°å®¢æˆ·ç«¯çš„èµ„æºè¡¨è¿°ã€‚å®é™…ä¸Šï¼Œå°†èµ„æºè¡¨è¿°å‘é€ç»™å®¢æˆ·ç«¯åªæ˜¯æ•´ä¸ªè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚ä¸€ä¸ªå¥½çš„REST APIä¸ä»…èƒ½å¤Ÿåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’èµ„æºï¼Œå®ƒè¿˜èƒ½å¤Ÿç»™å®¢æˆ·ç«¯æä¾›é¢å¤–çš„å…ƒæ•°æ®ï¼Œå¸®åŠ©å®¢æˆ·ç«¯ç†è§£èµ„æºæˆ–è€…åœ¨è¯·æ±‚ä¸­å‡ºç°äº†ä»€ä¹ˆæƒ…å†µã€‚</p>
<h4 id="å‘é€é”™è¯¯ä¿¡æ¯åˆ°å®¢æˆ·ç«¯"><a href="#å‘é€é”™è¯¯ä¿¡æ¯åˆ°å®¢æˆ·ç«¯" class="headerlink" title="å‘é€é”™è¯¯ä¿¡æ¯åˆ°å®¢æˆ·ç«¯"></a>å‘é€é”™è¯¯ä¿¡æ¯åˆ°å®¢æˆ·ç«¯</h4><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¸ºSpittleControlleræ·»åŠ ä¸€ä¸ªæ–°çš„å¤„ç†å™¨æ–¹æ³•ï¼Œå®ƒä¼šæä¾›å•ä¸ªSpittleå¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/&#123;id&#125;&quot;, method=RequestMethod.GET)</span><span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">Spittle <span class="title">spittleById</span><span class="params">(<span class="meta">@PathVariable</span> <span class="keyword">long</span> id)</span> </span>&#123;  <span class="keyword">return</span> spittleRepository.findOne(id);&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œé€šè¿‡idå‚æ•°ä¼ å…¥äº†ä¸€ä¸ªIDï¼Œç„¶åæ ¹æ®å®ƒè°ƒç”¨Repositoryçš„findOne()æ–¹æ³•ï¼ŒæŸ¥æ‰¾Spittleå¯¹è±¡ã€‚å¤„ç†å™¨æ–¹æ³•ä¼šè¿”å›findOne()æ–¹æ³•å¾—åˆ°çš„Spittleå¯¹è±¡ï¼Œæ¶ˆæ¯è½¬æ¢å™¨ä¼šè´Ÿè´£äº§ç”Ÿå®¢æˆ·ç«¯æ‰€éœ€çš„èµ„æºè¡¨è¿°ã€‚</p>
<p>éå¸¸ç®€å•ï¼Œå¯¹å§ï¼Ÿæˆ‘ä»¬æ²¡åŠæ³•è®©å®ƒæ›´æ£’äº†ã€‚å®ƒè¿˜èƒ½æ›´å¥½å—ï¼Ÿ</p>
<p>å¦‚æœæ ¹æ®ç»™å®šçš„IDï¼Œæ— æ³•æ‰¾åˆ°æŸä¸ªSpittleå¯¹è±¡çš„IDå±æ€§èƒ½å¤Ÿä¸ä¹‹åŒ¹é…ï¼ŒfindOne()æ–¹æ³•è¿”å›nullçš„æ—¶å€™ï¼Œä½ è§‰å¾—ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>ç»“æœå°±æ˜¯spittleById()æ–¹æ³•ä¼šè¿”å›nullï¼Œå“åº”ä½“ä¸ºç©ºï¼Œä¸ä¼šè¿”å›ä»»ä½•æœ‰ç”¨çš„æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚åŒæ—¶ï¼Œå“åº”ä¸­é»˜è®¤çš„HTTPçŠ¶æ€ç æ˜¯200ï¼ˆOKï¼‰ï¼Œè¡¨ç¤ºæ‰€æœ‰çš„äº‹æƒ…è¿è¡Œæ­£å¸¸ã€‚</p>
<p>ä½†æ˜¯ï¼Œæ‰€æœ‰çš„äº‹æƒ…éƒ½æ˜¯ä¸å¯¹çš„ã€‚å®¢æˆ·ç«¯è¦æ±‚Spittleå¯¹è±¡ï¼Œä½†æ˜¯å®ƒä»€ä¹ˆéƒ½æ²¡æœ‰å¾—åˆ°ã€‚å®ƒæ—¢æ²¡æœ‰æ”¶åˆ°Spittleå¯¹è±¡ä¹Ÿæ²¡æœ‰æ”¶åˆ°ä»»ä½•æ¶ˆæ¯è¡¨æ˜å‡ºç°äº†é”™è¯¯ã€‚æœåŠ¡å™¨å®é™…ä¸Šæ˜¯åœ¨è¯´ï¼šâ€œè¿™æ˜¯ä¸€ä¸ªæ²¡ç”¨çš„å“åº”ï¼Œä½†æ˜¯èƒ½å¤Ÿå‘Šè¯‰ä½ ä¸€åˆ‡éƒ½æ­£å¸¸ï¼â€</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹åœ¨è¿™ç§åœºæ™¯ä¸‹åº”è¯¥å‘ç”Ÿä»€ä¹ˆã€‚è‡³å°‘ï¼ŒçŠ¶æ€ç ä¸åº”è¯¥æ˜¯200ï¼Œè€Œåº”è¯¥æ˜¯404ï¼ˆNot Foundï¼‰ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯å®ƒä»¬æ‰€è¦æ±‚çš„å†…å®¹æ²¡æœ‰æ‰¾åˆ°ã€‚å¦‚æœå“åº”ä½“ä¸­èƒ½å¤ŸåŒ…å«é”™è¯¯ä¿¡æ¯è€Œä¸æ˜¯ç©ºçš„è¯å°±æ›´å¥½äº†ã€‚</p>
<p>Springæä¾›äº†å¤šç§æ–¹å¼æ¥å¤„ç†è¿™æ ·çš„åœºæ™¯ï¼š</p>
<ul>
<li>ä½¿ç”¨@ResponseStatusæ³¨è§£å¯ä»¥æŒ‡å®šçŠ¶æ€ç ï¼›</li>
<li>æ§åˆ¶å™¨æ–¹æ³•å¯ä»¥è¿”å›ResponseEntityå¯¹è±¡ï¼Œè¯¥å¯¹è±¡èƒ½å¤ŸåŒ…å«æ›´å¤šå“åº”ç›¸å…³çš„å…ƒæ•°æ®ï¼›</li>
<li>å¼‚å¸¸å¤„ç†å™¨èƒ½å¤Ÿåº”å¯¹é”™è¯¯åœºæ™¯ï¼Œè¿™æ ·å¤„ç†å™¨æ–¹æ³•å°±èƒ½å…³æ³¨äºæ­£å¸¸çš„çŠ¶å†µã€‚</li>
</ul>
<p>åœ¨è¿™ä¸ªæ–¹é¢ï¼ŒSpringæä¾›äº†å¾ˆå¤šçš„çµæ´»æ€§ï¼Œå…¶å®ä¹Ÿä¸å­˜åœ¨å”¯ä¸€æ­£ç¡®çš„æ–¹å¼ã€‚æˆ‘ä¸ä¼šç”¨æŸä¸€ç§å›ºå®šçš„ç­–ç•¥æ¥å¤„ç†æ‰€æœ‰çš„é”™è¯¯æˆ–æ¶µç›–æ‰€æœ‰çš„åœºæ™¯ï¼Œè€Œæ˜¯ä¼šå‘è¯»è€…å±•ç°å¤šç§ä¿®æ”¹spittleById()çš„æ–¹æ³•ï¼Œä»¥åº”å¯¹Spittleæ— æ³•æ‰¾åˆ°çš„åœºæ™¯ã€‚</p>
<p>ä½¿ç”¨ResponseEntity</p>
<p>ä½œä¸º@ResponseBodyçš„æ›¿ä»£æ–¹æ¡ˆï¼Œæ§åˆ¶å™¨æ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªResponseEntityå¯¹è±¡ã€‚ResponseEntityä¸­å¯ä»¥åŒ…å«å“åº”ç›¸å…³çš„å…ƒæ•°æ®ï¼ˆå¦‚å¤´éƒ¨ä¿¡æ¯å’ŒçŠ¶æ€ç ï¼‰ä»¥åŠè¦è½¬æ¢æˆèµ„æºè¡¨è¿°çš„å¯¹è±¡ã€‚</p>
<p>å› ä¸ºResponseEntityå…è®¸æˆ‘ä»¬æŒ‡å®šå“åº”çš„çŠ¶æ€ç ï¼Œæ‰€ä»¥å½“æ— æ³•æ‰¾åˆ°Spittleçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›HTTP 404é”™è¯¯ã€‚å¦‚ä¸‹æ˜¯æ–°ç‰ˆæœ¬çš„spittleById()ï¼Œå®ƒä¼šè¿”å›ResponseEntityï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/&#123;id&#125;&quot;, method=RequestMethod.GET)</span><span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">Spittle <span class="title">spittleById</span><span class="params">(<span class="meta">@PathVariable</span> <span class="keyword">long</span> id)</span> </span>&#123;  Spittle spittle = spittleRepository.findOne(id);  HttpStatus status = spittle != <span class="keyword">null</span> ? HttpStatus.OK : HttpStatus.NOT_FOUND;  <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;Spittle&gt;(spittle, status);&#125;</span><br></pre></td></tr></table></figure>

<p>åƒå‰é¢ä¸€æ ·ï¼Œè·¯å¾„ä¸­å¾—åˆ°çš„IDç”¨æ¥ä»Repositoryä¸­æ£€ç´¢Spittleã€‚å¦‚æœæ‰¾åˆ°çš„è¯ï¼ŒçŠ¶æ€ç è®¾ç½®ä¸ºHttpStatus.OKï¼ˆè¿™æ˜¯ä¹‹å‰çš„é»˜è®¤å€¼ï¼‰ï¼Œä½†æ˜¯å¦‚æœRepositoryè¿”å›nullçš„è¯ï¼ŒçŠ¶æ€ç è®¾ç½®ä¸ºHttpStatus.NOT_FOUNDï¼Œè¿™ä¼šè½¬æ¢ä¸ºHTTP 404ã€‚æœ€åï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ResponseEntityï¼Œå®ƒä¼šæŠŠSpittleå’ŒçŠ¶æ€ç ä¼ é€ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>æ³¨æ„è¿™ä¸ªspittleById()æ–¹æ³•æ²¡æœ‰ä½¿ç”¨@ResponseBodyæ³¨è§£ã€‚é™¤äº†åŒ…å«å“åº”å¤´ä¿¡æ¯ã€çŠ¶æ€ç ä»¥åŠè´Ÿè½½ä»¥å¤–ï¼ŒResponseEntityè¿˜åŒ…å«äº†@ResponseBodyçš„è¯­ä¹‰ï¼Œå› æ­¤è´Ÿè½½éƒ¨åˆ†å°†ä¼šæ¸²æŸ“åˆ°å“åº”ä½“ä¸­ï¼Œå°±åƒä¹‹å‰åœ¨æ–¹æ³•ä¸Šä½¿ç”¨@ResponseBodyæ³¨è§£ä¸€æ ·ã€‚å¦‚æœè¿”å›ResponseEntityçš„è¯ï¼Œé‚£å°±æ²¡æœ‰å¿…è¦åœ¨æ–¹æ³•ä¸Šä½¿ç”¨@ResponseBodyæ³¨è§£äº†ã€‚</p>
<p>æˆ‘ä»¬åœ¨æ­£ç¡®çš„æ–¹å‘ä¸Šèµ°å‡ºäº†ç¬¬ä¸€æ­¥ï¼Œå¦‚æœæ‰€è¦æ±‚çš„Spittleæ— æ³•æ‰¾åˆ°çš„è¯ï¼Œå®¢æˆ·ç«¯èƒ½å¤Ÿå¾—åˆ°ä¸€ä¸ªåˆé€‚çš„çŠ¶æ€ç ã€‚ä½†æ˜¯åœ¨æœ¬ä¾‹ä¸­ï¼Œå“åº”ä½“ä¾ç„¶ä¸ºç©ºã€‚æˆ‘ä»¬å¯èƒ½ä¼šå¸Œæœ›åœ¨å“åº”ä½“ä¸­åŒ…å«ä¸€äº›é”™è¯¯ä¿¡æ¯ã€‚æˆ‘ä»¬é‡è¯•ä¸€æ¬¡ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªåŒ…å«é”™è¯¯ä¿¡æ¯çš„Errorå¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Error &#123;  <span class="keyword">private</span> <span class="keyword">int</span> code;  <span class="keyword">private</span> String message;    <span class="function"><span class="keyword">public</span> <span class="title">Error</span><span class="params">(<span class="keyword">int</span> code, String message)</span> </span>&#123;    <span class="keyword">this</span>.code = code;    <span class="keyword">this</span>.message = message;  &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> code;  &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMessage</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> message;  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹spittleById()ï¼Œè®©å®ƒè¿”å›Errorï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/&#123;id&#125;&quot;, method=RequestMethod.GET)</span><span class="keyword">public</span> ResponseEntity&lt;?&gt; spittleById(<span class="meta">@PathVariable</span> <span class="keyword">long</span> id) &#123;  Spittle spittle = spittleRepository.findOne(id);  <span class="keyword">if</span> (spittle == <span class="keyword">null</span>) &#123;    Error error = <span class="keyword">new</span> Error(<span class="number">4</span>, <span class="string">&quot;Spittle [&quot;</span> + id + <span class="string">&quot;] not found&quot;</span>);    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;Error&gt;(error, HttpStatus.NOT_FOUND);  &#125;  <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;Spittle&gt;(spittle, HttpStatus.OK);&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¡Œä¸ºå·²ç»ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸäº†ã€‚å¦‚æœæ‰¾åˆ°Spittleçš„è¯ï¼Œå°±ä¼šæŠŠè¿”å›çš„å¯¹è±¡ä»¥åŠ200ï¼ˆOKï¼‰çš„çŠ¶æ€ç å°è£…åˆ°ResponseEntityä¸­ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœfindOne()è¿”å›nullçš„è¯ï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ªErrorå¯¹è±¡ï¼Œå¹¶å°†å…¶ä¸404ï¼ˆNot Foundï¼‰çŠ¶æ€ç ä¸€èµ·å°è£…åˆ°ResponseEntityä¸­ï¼Œç„¶åè¿”å›ã€‚</p>
<p>ä½ ä¹Ÿè®¸è§‰å¾—æˆ‘ä»¬å¯ä»¥åˆ°æ­¤ç»“æŸè¿™ä¸ªè¯é¢˜äº†ã€‚æ¯•ç«Ÿï¼Œæ–¹æ³•æŒ‰ç…§æˆ‘ä»¬æœŸæœ›çš„æ–¹å¼åœ¨è¿è¡Œã€‚ä½†æ˜¯ï¼Œè¿˜æœ‰ä¸€ç‚¹äº‹æƒ…è®©æˆ‘ä¸å¤ªèˆ’æœã€‚</p>
<p>é¦–å…ˆï¼Œè¿™æ¯”æˆ‘ä»¬å¼€å§‹çš„æ—¶å€™æ›´ä¸ºå¤æ‚ã€‚æ¶‰åŠåˆ°äº†æ›´å¤šçš„é€»è¾‘ï¼ŒåŒ…æ‹¬æ¡ä»¶è¯­å¥ã€‚å¦å¤–ï¼Œæ–¹æ³•è¿”å›ResponseEntity&lt;?&gt;æ„Ÿè§‰æœ‰äº›é—®é¢˜ã€‚ResponseEntityæ‰€ä½¿ç”¨çš„æ³›å‹ä¸ºå®ƒçš„è§£ææˆ–å‡ºç°é”™è¯¯ç•™ä¸‹äº†å¤ªå¤šçš„ç©ºé—´ã€‚</p>
<p>ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©é”™è¯¯å¤„ç†å™¨æ¥ä¿®æ­£è¿™äº›é—®é¢˜ã€‚</p>
<p>å¤„ç†é”™è¯¯</p>
<p>spittleById()æ–¹æ³•ä¸­çš„ifä»£ç å—æ˜¯å¤„ç†é”™è¯¯çš„ï¼Œä½†è¿™æ˜¯æ§åˆ¶å™¨ä¸­é”™è¯¯å¤„ç†å™¨ï¼ˆerror handlerï¼‰æ‰€æ“…é•¿çš„é¢†åŸŸã€‚é”™è¯¯å¤„ç†å™¨èƒ½å¤Ÿå¤„ç†å¯¼è‡´é—®é¢˜çš„åœºæ™¯ï¼Œè¿™æ ·å¸¸è§„çš„å¤„ç†å™¨æ–¹æ³•å°±èƒ½åªå…³å¿ƒæ­£å¸¸çš„é€»è¾‘å¤„ç†è·¯å¾„äº†ã€‚</p>
<p>æˆ‘ä»¬é‡æ„ä¸€ä¸‹ä»£ç æ¥ä½¿ç”¨é”™è¯¯å¤„ç†å™¨ã€‚é¦–å…ˆï¼Œå®šä¹‰èƒ½å¤Ÿå¯¹åº”SpittleNotFoundExceptionçš„é”™è¯¯å¤„ç†å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(SpittleNotFoundException.class)</span><span class="meta">@ResponseStatus(HttpStatus.NOT_FOUND)</span><span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">Error <span class="title">spittleNotFound</span><span class="params">(SpittleNotFoundException e)</span> </span>&#123;  <span class="keyword">long</span> spittleId = e.getSpittleId();  <span class="keyword">return</span> <span class="keyword">new</span> Error(<span class="number">4</span>, <span class="string">&quot;Spittle [&quot;</span> + spittleId + <span class="string">&quot;] not found&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>@ExceptionHandleræ³¨è§£èƒ½å¤Ÿç”¨åˆ°æ§åˆ¶å™¨æ–¹æ³•ä¸­ï¼Œç”¨æ¥å¤„ç†ç‰¹å®šçš„å¼‚å¸¸ã€‚è¿™é‡Œï¼Œå®ƒè¡¨æ˜å¦‚æœåœ¨æ§åˆ¶å™¨çš„ä»»æ„å¤„ç†æ–¹æ³•ä¸­æŠ›å‡ºSpittleNotFoundExceptionå¼‚å¸¸ï¼Œå°±ä¼šè°ƒç”¨spittleNotFound()æ–¹æ³•æ¥å¤„ç†å¼‚å¸¸ã€‚</p>
<p>è‡³äºSpittleNotFoundExceptionï¼Œå®ƒæ˜¯ä¸€ä¸ªå¾ˆç®€å•å¼‚å¸¸ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.data;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpittleNotFoundException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;    <span class="keyword">private</span> <span class="keyword">long</span> spittleId;  <span class="function"><span class="keyword">public</span> <span class="title">SpittleNotFoundException</span><span class="params">(<span class="keyword">long</span> spittleId)</span> </span>&#123;    <span class="keyword">this</span>.spittleId = spittleId;  &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getSpittleId</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> spittleId;  &#125;  &#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç§»é™¤æ‰spittleById()æ–¹æ³•ä¸­å¤§å¤šæ•°çš„é”™è¯¯å¤„ç†ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/&#123;id&#125;&quot;, method=RequestMethod.GET)</span><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Spittle&gt; <span class="title">spittleById</span><span class="params">(<span class="meta">@PathVariable</span> <span class="keyword">long</span> id)</span> </span>&#123;  Spittle spittle = spittleRepository.findOne(id);  <span class="keyword">if</span> (spittle == <span class="keyword">null</span>) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> SpittleNotFoundException(id); &#125;  <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;Spittle&gt;(spittle, HttpStatus.OK);&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç‰ˆæœ¬çš„spittleById()æ–¹æ³•ç¡®å®å¹²å‡€äº†å¾ˆå¤šã€‚é™¤äº†å¯¹è¿”å›å€¼è¿›è¡Œnullæ£€æŸ¥ï¼Œå®ƒå®Œå…¨å…³æ³¨äºæˆåŠŸçš„åœºæ™¯ï¼Œä¹Ÿå°±æ˜¯èƒ½å¤Ÿæ‰¾åˆ°è¯·æ±‚çš„Spittleã€‚åŒæ—¶ï¼Œåœ¨è¿”å›ç±»å‹ä¸­ï¼Œæˆ‘ä»¬èƒ½ç§»é™¤æ‰å¥‡æ€ªçš„æ³›å‹äº†ã€‚</p>
<p>ä¸è¿‡ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè®©ä»£ç æ›´åŠ å¹²å‡€ä¸€äº›ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“spittleById()å°†ä¼šè¿”å›Spittleå¹¶ä¸”HTTPçŠ¶æ€ç å§‹ç»ˆä¼šæ˜¯200ï¼ˆOKï¼‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä¸å†ä½¿ç”¨ResponseEntityï¼Œè€Œæ˜¯å°†å…¶æ›¿æ¢ä¸º@ResponseBodyï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/&#123;id&#125;&quot;, method=RequestMethod.GET)</span><span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">Spittle <span class="title">spittleById</span><span class="params">(<span class="meta">@PathVariable</span> <span class="keyword">long</span> id)</span> </span>&#123;  Spittle spittle = spittleRepository.findOne(id);  <span class="keyword">if</span> (spittle == <span class="keyword">null</span>) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> SpittleNotFoundException(id); &#125;  <span class="keyword">return</span> spittle;&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œå¦‚æœæ§åˆ¶å™¨ç±»ä¸Šä½¿ç”¨äº†@RestControllerï¼Œæˆ‘ä»¬ç”šè‡³ä¸å†éœ€è¦@ResponseBodyï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/&#123;id&#125;&quot;, method=RequestMethod.GET)</span><span class="function"><span class="keyword">public</span> Spittle <span class="title">spittleById</span><span class="params">(<span class="meta">@PathVariable</span> <span class="keyword">long</span> id)</span> </span>&#123;  Spittle spittle = spittleRepository.findOne(id);  <span class="keyword">if</span> (spittle == <span class="keyword">null</span>) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> SpittleNotFoundException(id); &#125;  <span class="keyword">return</span> spittle;&#125;</span><br></pre></td></tr></table></figure>

<p>é‰´äºé”™è¯¯å¤„ç†å™¨çš„æ–¹æ³•ä¼šå§‹ç»ˆè¿”å›Errorï¼Œå¹¶ä¸”HTTPçŠ¶æ€ç ä¸º404ï¼ˆNot Foundï¼‰ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬å¯ä»¥å¯¹spittleNotFound()æ–¹æ³•è¿›è¡Œç±»ä¼¼çš„æ¸…ç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(SpittleNotFoundException.class)</span><span class="meta">@ResponseStatus(HttpStatus.NOT_FOUND)</span><span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">Error <span class="title">spittleNotFound</span><span class="params">(SpittleNotFoundException e)</span> </span>&#123;  <span class="keyword">long</span> spittleId = e.getSpittleId();  <span class="keyword">return</span> <span class="keyword">new</span> Error(<span class="number">4</span>, <span class="string">&quot;Spittle [&quot;</span> + spittleId + <span class="string">&quot;] not found&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºspittleNotFound()æ–¹æ³•å§‹ç»ˆä¼šè¿”å›Errorï¼Œæ‰€ä»¥ä½¿ç”¨ResponseEntityçš„å”¯ä¸€åŸå› å°±æ˜¯èƒ½å¤Ÿè®¾ç½®çŠ¶æ€ç ã€‚ä½†æ˜¯é€šè¿‡ä¸ºspittleNotFound()æ–¹æ³•æ·»åŠ @ResponseStatus(HttpStatus.NOT_FOUND)æ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœï¼Œè€Œä¸”å¯ä»¥ä¸å†ä½¿ç”¨ResponseEntityäº†ã€‚</p>
<p>åŒæ ·ï¼Œå¦‚æœæ§åˆ¶å™¨ç±»ä¸Šä½¿ç”¨äº†@RestControllerï¼Œé‚£ä¹ˆå°±å¯ä»¥ç§»é™¤æ‰@ResponseBodyï¼Œè®©ä»£ç æ›´åŠ å¹²å‡€ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(SpittleNotFoundException.class)</span><span class="meta">@ResponseStatus(HttpStatus.NOT_FOUND)</span><span class="function"><span class="keyword">public</span> Error <span class="title">spittleNotFound</span><span class="params">(SpittleNotFoundException e)</span> </span>&#123;  <span class="keyword">long</span> spittleId = e.getSpittleId();  <span class="keyword">return</span> <span class="keyword">new</span> Error(<span class="number">4</span>, <span class="string">&quot;Spittle [&quot;</span> + spittleId + <span class="string">&quot;] not found&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼Œæˆ‘ä»¬å·²ç»åœ†æ»¡è¾¾åˆ°äº†æƒ³è¦çš„æ•ˆæœã€‚ä¸ºäº†è®¾ç½®å“åº”çŠ¶æ€ç ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨ResponseEntityï¼Œä½†æ˜¯ç¨åæˆ‘ä»¬å€ŸåŠ©å¼‚å¸¸å¤„ç†å™¨ä»¥åŠ@ResponseStatusï¼Œé¿å…ä½¿ç”¨ResponseEntityï¼Œä»è€Œè®©ä»£ç æ›´åŠ æ•´æ´ã€‚</p>
<p>ä¼¼ä¹ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦ä½¿ç”¨ResponseEntityäº†ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€ç§åœºæ™¯ResponseEntityèƒ½å¤Ÿå¾ˆå¥½åœ°å®Œæˆï¼Œä½†æ˜¯å…¶ä»–çš„æ³¨è§£æˆ–å¼‚å¸¸å¤„ç†å™¨å´åšä¸åˆ°ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨å“åº”ä¸­è®¾ç½®å¤´éƒ¨ä¿¡æ¯ã€‚</p>
<h4 id="åœ¨å“åº”ä¸­è®¾ç½®å¤´éƒ¨ä¿¡æ¯"><a href="#åœ¨å“åº”ä¸­è®¾ç½®å¤´éƒ¨ä¿¡æ¯" class="headerlink" title="åœ¨å“åº”ä¸­è®¾ç½®å¤´éƒ¨ä¿¡æ¯"></a>åœ¨å“åº”ä¸­è®¾ç½®å¤´éƒ¨ä¿¡æ¯</h4><p>åœ¨saveSpittle()æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åœ¨å¤„ç†POSTè¯·æ±‚çš„è¿‡ç¨‹ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Spittleèµ„æºã€‚ä½†æ˜¯ï¼ŒæŒ‰ç…§ç›®å‰çš„å†™æ³•ï¼ˆå‚è€ƒç¨‹åºæ¸…å•16.3ï¼‰ï¼Œæˆ‘ä»¬æ— æ³•å‡†ç¡®åœ°ä¸å®¢æˆ·ç«¯äº¤æµã€‚</p>
<p>åœ¨saveSpittle()å¤„ç†å®Œè¯·æ±‚ä¹‹åï¼ŒæœåŠ¡å™¨åœ¨å“åº”ä½“ä¸­åŒ…å«äº†Spittleçš„è¡¨è¿°ä»¥åŠHTTPçŠ¶æ€ç 200ï¼ˆOKï¼‰ï¼Œå°†å…¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†æ˜¯è¿˜ä¸æ˜¯å®Œå…¨å‡†ç¡®ã€‚</p>
<p>å½“ç„¶ï¼Œå‡è®¾å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­æˆåŠŸåˆ›å»ºäº†èµ„æºï¼ŒçŠ¶æ€å¯ä»¥è§†ä¸ºOKã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸ä»…ä»…éœ€è¦è¯´â€œOKâ€ã€‚æˆ‘ä»¬åˆ›å»ºäº†æ–°çš„å†…å®¹ï¼ŒHTTPçŠ¶æ€ç ä¹Ÿå°†è¿™ç§æƒ…å†µå‘Šè¯‰ç»™äº†å®¢æˆ·ç«¯ã€‚ä¸è¿‡ï¼ŒHTTP 201ä¸ä»…èƒ½å¤Ÿè¡¨æ˜è¯·æ±‚æˆåŠŸå®Œæˆï¼Œè€Œä¸”è¿˜èƒ½æè¿°åˆ›å»ºäº†æ–°èµ„æºã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›å®Œæ•´å‡†ç¡®åœ°ä¸å®¢æˆ·ç«¯äº¤æµï¼Œé‚£ä¹ˆå“åº”æ˜¯ä¸æ˜¯åº”è¯¥ä¸º201ï¼ˆCreatedï¼‰ï¼Œè€Œä¸ä»…ä»…æ˜¯200ï¼ˆOKï¼‰å‘¢ï¼Ÿ</p>
<p>æ ¹æ®æˆ‘ä»¬ç›®å‰æ‰€å­¦åˆ°çš„çŸ¥è¯†ï¼Œè¿™ä¸ªé—®é¢˜è§£å†³èµ·æ¥å¾ˆå®¹æ˜“ã€‚æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ä¸ºsaveSpittle()æ–¹æ³•æ·»åŠ @ResponseStatusæ³¨è§£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(method=RequestMethod.POST, consumes=&quot;application/json&quot;)</span><span class="meta">@ResponseStatus(HttpStatus.CREATED)</span><span class="function"><span class="keyword">public</span> Spittle <span class="title">saveSpittle</span><span class="params">(<span class="meta">@RequestBody</span> Spittle spittle)</span> </span>&#123;  <span class="keyword">return</span> spittleRepository.save(spittle);&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™åº”è¯¥èƒ½å¤Ÿå®Œæˆæˆ‘ä»¬çš„ä»»åŠ¡ï¼Œç°åœ¨çŠ¶æ€ç èƒ½å¤Ÿç²¾ç¡®ååº”å‘ç”Ÿäº†ä»€ä¹ˆæƒ…å†µã€‚å®ƒå‘Šè¯‰å®¢æˆ·ç«¯æˆ‘ä»¬æ–°åˆ›å»ºäº†èµ„æºã€‚é—®é¢˜å·²ç»å¾—ä»¥è§£å†³ï¼</p>
<p>ä½†è¿™åªæ˜¯é—®é¢˜çš„ä¸€éƒ¨åˆ†ã€‚å®¢æˆ·ç«¯çŸ¥é“æ–°åˆ›å»ºäº†èµ„æºï¼Œä½ è§‰å¾—å®¢æˆ·ç«¯ä¼šä¸ä¼šæ„Ÿå…´è¶£æ–°åˆ›å»ºçš„èµ„æºåœ¨å“ªé‡Œå‘¢ï¼Ÿæ¯•ç«Ÿï¼Œè¿™æ˜¯ä¸€ä¸ªæ–°åˆ›å»ºçš„èµ„æºï¼Œä¼šæœ‰ä¸€ä¸ªæ–°çš„URLä¸ä¹‹å…³è”ã€‚éš¾é“å®¢æˆ·ç«¯åªèƒ½çŒœæµ‹æ–°åˆ›å»ºèµ„æºçš„URLæ˜¯ä»€ä¹ˆå—ï¼Ÿæˆ‘ä»¬èƒ½ä¸èƒ½ä»¥æŸç§æ–¹å¼å°†å…¶å‘Šè¯‰å®¢æˆ·ç«¯ï¼Ÿ</p>
<p>å½“åˆ›å»ºæ–°èµ„æºçš„æ—¶å€™ï¼Œå°†èµ„æºçš„URLæ”¾åœ¨å“åº”çš„Locationå¤´éƒ¨ä¿¡æ¯ä¸­ï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯æ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹å¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ç§æ–¹å¼æ¥å¡«å……å“åº”å¤´éƒ¨ä¿¡æ¯ï¼Œæ­¤æ—¶æˆ‘ä»¬çš„è€æœ‹å‹ResponseEntityå°±èƒ½æä¾›å¸®åŠ©äº†ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†ä¸€ä¸ªæ–°ç‰ˆæœ¬çš„saveSpittle()ï¼Œå®ƒä¼šè¿”å›ResponseEntityç”¨æ¥å‘Šè¯‰å®¢æˆ·ç«¯æ–°åˆ›å»ºçš„èµ„æºã€‚</p>
<p>ç¨‹åºæ¸…å•16.4ã€€å½“è¿”å›ResponseEntityæ—¶ï¼Œåœ¨å“åº”ä¸­è®¾ç½®å¤´éƒ¨ä¿¡æ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(method=RequestMethod.POST, consumes=&quot;application/json&quot;)</span><span class="meta">@ResponseStatus(HttpStatus.CREATED)</span><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Spittle&gt; <span class="title">saveSpittle</span><span class="params">(<span class="meta">@RequestBody</span> Spittle spittle)</span> </span>&#123;    Spittle spittle = spittleRepository.save(spittle);        HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();    URI locationUri = URI.create(<span class="string">&quot;http://localhost:8080/spittr/spittles&quot;</span> + spittle.getId());    headers.setLocation(locationUri);        ResponseEntity&lt;Spittle&gt; responseEntity = <span class="keyword">new</span> ResponseEntity&lt;Spittle&gt;(spittle, headers, HttpStatus.CREATED);    <span class="keyword">return</span> responseEntity;  &#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªæ–°çš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªHttpHeaderså®ä¾‹ï¼Œç”¨æ¥å­˜æ”¾å¸Œæœ›åœ¨å“åº”ä¸­åŒ…å«çš„å¤´éƒ¨ä¿¡æ¯å€¼ã€‚HttpHeadersæ˜¯MultiValueMap&lt;String, String&gt;çš„ç‰¹æ®Šå®ç°ï¼Œå®ƒæœ‰ä¸€äº›ä¾¿åˆ©çš„Setteræ–¹æ³•ï¼ˆå¦‚setLocation()ï¼‰ï¼Œç”¨æ¥è®¾ç½®å¸¸è§çš„HTTPå¤´éƒ¨ä¿¡æ¯ã€‚åœ¨å¾—åˆ°æ–°åˆ›å»ºSpittleèµ„æºçš„URLä¹‹åï¼Œæ¥ä¸‹æ¥ä½¿ç”¨è¿™ä¸ªå¤´éƒ¨ä¿¡æ¯æ¥åˆ›å»ºResponseEntityã€‚</p>
<p>å“‡ï¼åŸæœ¬ç®€å•çš„saveSpittle()æ–¹æ³•ç¬é—´å˜å¾—è‡ƒè‚¿äº†ã€‚ä½†æ˜¯ï¼Œæ›´å€¼å¾—å…³æ³¨çš„æ˜¯ï¼Œå®ƒä½¿ç”¨ç¡¬ç¼–ç å€¼çš„æ–¹å¼æ¥æ„å»ºLocationå¤´éƒ¨ä¿¡æ¯ã€‚URLä¸­â€œlocalhostâ€ä»¥åŠâ€œ8080â€è¿™ä¸¤ä¸ªéƒ¨åˆ†å°¤å…¶éœ€è¦æ³¨æ„ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬å°†åº”ç”¨éƒ¨ç½²åˆ°å…¶ä»–åœ°æ–¹ï¼Œè€Œä¸æ˜¯åœ¨æœ¬åœ°è¿è¡Œçš„è¯ï¼Œå®ƒä»¬å°±ä¸é€‚ç”¨äº†ã€‚</p>
<p>æˆ‘ä»¬å…¶å®æ²¡æœ‰å¿…è¦æ‰‹åŠ¨æ„å»ºURLï¼ŒSpringæä¾›äº†UriComponentsBuilderï¼Œå¯ä»¥ç»™æˆ‘ä»¬ä¸€äº›å¸®åŠ©ã€‚å®ƒæ˜¯ä¸€ä¸ªæ„å»ºç±»ï¼Œé€šè¿‡é€æ­¥æŒ‡å®šURLä¸­çš„å„ç§ç»„æˆéƒ¨åˆ†ï¼ˆå¦‚hostã€ç«¯å£ã€è·¯å¾„ä»¥åŠæŸ¥è¯¢ï¼‰ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨å®ƒæ¥æ„å»ºUriComponentså®ä¾‹ã€‚å€ŸåŠ©UriComponentsBuilderæ‰€æ„å»ºçš„UriComponentså¯¹è±¡ï¼Œæˆ‘ä»¬å°±èƒ½è·å¾—é€‚åˆè®¾ç½®ç»™Locationå¤´éƒ¨ä¿¡æ¯çš„URIã€‚</p>
<p>ä¸ºäº†ä½¿ç”¨UriComponentsBuilderï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯åœ¨å¤„ç†å™¨æ–¹æ³•ä¸­å°†å…¶ä½œä¸ºä¸€ä¸ªå‚æ•°ï¼Œå¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºã€‚</p>
<p>ç¨‹åºæ¸…å•16.5ã€€ä½¿ç”¨UriComponentsBuilderæ¥æ„å»ºLocation URI</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(method=RequestMethod.POST, consumes=&quot;application/json&quot;)</span><span class="meta">@ResponseStatus(HttpStatus.CREATED)</span><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Spittle&gt; <span class="title">saveSpittle</span><span class="params">(<span class="meta">@RequestBody</span> Spittle spittle, UriComponentsBuilder ucb)</span> </span>&#123;  Spittle saved = spittleRepository.save(spittle);      HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();  URI locationUri = ucb.path(<span class="string">&quot;/spittles/&quot;</span>)      .path(String.valueOf(saved.getId()))      .build()      .toUri();  headers.setLocation(locationUri);      ResponseEntity&lt;Spittle&gt; responseEntity = <span class="keyword">new</span> ResponseEntity&lt;Spittle&gt;(saved, headers, HttpStatus.CREATED);  <span class="keyword">return</span> responseEntity;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨å¤„ç†å™¨æ–¹æ³•æ‰€å¾—åˆ°çš„UriComponentsBuilderä¸­ï¼Œä¼šé¢„å…ˆé…ç½®å·²çŸ¥çš„ä¿¡æ¯å¦‚hostã€ç«¯å£ä»¥åŠServletå†…å®¹ã€‚å®ƒä¼šä»å¤„ç†å™¨æ–¹æ³•æ‰€å¯¹åº”çš„è¯·æ±‚ä¸­è·å–è¿™äº›åŸºç¡€ä¿¡æ¯ã€‚åŸºäºè¿™äº›ä¿¡æ¯ï¼Œä»£ç ä¼šé€šè¿‡è®¾ç½®è·¯å¾„çš„æ–¹å¼æ„å»ºUriComponentså…¶ä½™çš„éƒ¨åˆ†ã€‚</p>
<p>æ³¨æ„ï¼Œè·¯å¾„çš„æ„å»ºåˆ†ä¸ºä¸¤æ­¥ã€‚ç¬¬ä¸€æ­¥è°ƒç”¨path()æ–¹æ³•ï¼Œå°†å…¶è®¾ç½®ä¸ºâ€œ/ spittles/â€ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæ§åˆ¶å™¨æ‰€èƒ½å¤„ç†çš„åŸºç¡€è·¯å¾„ã€‚ç„¶åï¼Œåœ¨ç¬¬äºŒæ¬¡è°ƒç”¨path()çš„æ—¶å€™ï¼Œä½¿ç”¨äº†å·²ä¿å­˜Spittleçš„IDã€‚æˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºæ¥ï¼Œæ¯æ¬¡è°ƒç”¨path()éƒ½ä¼šåŸºäºä¸Šæ¬¡è°ƒç”¨çš„ç»“æœã€‚åœ¨è·¯å¾„è®¾ç½®å®Œæˆä¹‹åï¼Œè°ƒç”¨build()æ–¹æ³•æ¥æ„å»ºUriComponentså¯¹è±¡ï¼Œæ ¹æ®è¿™ä¸ªå¯¹è±¡è°ƒç”¨toUri()å°±èƒ½å¾—åˆ°æ–°åˆ›å»ºSpittleçš„URIã€‚</p>
<p>åœ¨REST APIä¸­æš´éœ²èµ„æºåªä»£è¡¨äº†ä¼šè¯çš„ä¸€ç«¯ã€‚å¦‚æœå‘å¸ƒçš„APIæ²¡æœ‰äººå…³å¿ƒå’Œä½¿ç”¨çš„è¯ï¼Œé‚£ä¹Ÿæ²¡æœ‰ä»€ä¹ˆä»·å€¼ã€‚é€šå¸¸æ¥è®²ï¼Œç§»åŠ¨æˆ–JavaScriptåº”ç”¨ä¼šæ˜¯REST APIçš„å®¢æˆ·ç«¯ï¼Œä½†æ˜¯Springåº”ç”¨ä¹Ÿå®Œå…¨å¯ä»¥ä½¿ç”¨è¿™äº›èµ„æºã€‚æˆ‘ä»¬æ¢ä¸ªæ–¹å‘ï¼Œçœ‹ä¸€ä¸‹å¦‚ä½•ç¼–å†™Springä»£ç å®ç°RESTfuläº¤äº’çš„å®¢æˆ·ç«¯ã€‚</p>
<h3 id="ç¼–å†™RESTå®¢æˆ·ç«¯"><a href="#ç¼–å†™RESTå®¢æˆ·ç«¯" class="headerlink" title="ç¼–å†™RESTå®¢æˆ·ç«¯"></a>ç¼–å†™RESTå®¢æˆ·ç«¯</h3><p>ä½œä¸ºå®¢æˆ·ç«¯ï¼Œç¼–å†™ä¸RESTèµ„æºäº¤äº’çš„ä»£ç å¯èƒ½ä¼šæ¯”è¾ƒä¹å‘³ï¼Œå¹¶ä¸”æ‰€ç¼–å†™çš„ä»£ç éƒ½æ˜¯æ ·æ¿å¼çš„ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦å€ŸåŠ©Facebookçš„Graph APIï¼Œç¼–å†™æ–¹æ³•æ¥è·å–æŸäººçš„FacebookåŸºæœ¬ä¿¡æ¯ã€‚ä¸è¿‡ï¼Œè·å–åŸºæœ¬ä¿¡æ¯çš„ä»£ç ä¼šæœ‰ç‚¹å¤æ‚ï¼Œå¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºã€‚</p>
<p>ç¨‹åºæ¸…å•16.6ã€€ä½¿ç”¨Apache HTTP Clientè·å–Facebookä¸­çš„ä¸ªäººåŸºæœ¬ä¿¡æ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Profile <span class="title">fetchFacebookProfile</span><span class="params">(String id)</span> </span>&#123;  <span class="keyword">try</span> &#123;    HttpClient client = HttpClients.createDefault();    HttpGet request = <span class="keyword">new</span> HttpGet(<span class="string">&quot;http://graph.facebook.com/&quot;</span> + id);    request.setHeader(<span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;application/json&quot;</span>);        HttpResponse response = client.execute(request);    HttpEntity entity = response.getEntity();    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();        <span class="keyword">return</span> mapper.readValue(entity.getContent(), Profile.class);  &#125; <span class="keyword">catch</span> (IOException e) &#123;    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä½¿ç”¨RESTèµ„æºçš„æ—¶å€™æ¶‰åŠå¾ˆå¤šä»£ç ã€‚è¿™é‡Œæˆ‘ç”šè‡³è¿˜å·æ‡’ä½¿ç”¨äº†Jakarta Commons HTTP Clientå‘èµ·è¯·æ±‚å¹¶ä½¿ç”¨Jackson JSON processorè§£æå“åº”ã€‚<br>ä»”ç»†çœ‹ä¸€ä¸‹fetchFacebookProfile()æ–¹æ³•ï¼Œä½ å¯èƒ½ä¼šå‘ç°æ–¹æ³•ä¸­åªæœ‰å°‘é‡ä»£ç ä¸è·å–Facebookä¸ªäººä¿¡æ¯ç›´æ¥ç›¸å…³ã€‚å¦‚æœä½ è¦ç¼–å†™å¦ä¸€ä¸ªæ–¹æ³•æ¥ä½¿ç”¨å…¶ä»–çš„RESTèµ„æºï¼Œå¾ˆå¯èƒ½ä¼šæœ‰å¾ˆå¤šä»£ç æ˜¯ä¸fetchFacebookProfile()ç›¸åŒçš„ã€‚</p>
<p>å¦å¤–ï¼Œè¿˜æœ‰ä¸€äº›åœ°æ–¹å¯èƒ½ä¼šæŠ›å‡ºçš„IOExceptionå¼‚å¸¸ã€‚å› ä¸ºIOExceptionæ˜¯æ£€æŸ¥å‹å¼‚å¸¸ï¼Œæ‰€ä»¥è¦ä¹ˆæ•è·å®ƒï¼Œè¦ä¹ˆæŠ›å‡ºå®ƒã€‚åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘é€‰æ‹©æ•è·å®ƒå¹¶åœ¨å®ƒçš„ä½ç½®é‡æ–°æŠ›å‡ºä¸€ä¸ªéæ£€æŸ¥å‹å¼‚å¸¸RuntimeExceptionã€‚</p>
<p>é‰´äºåœ¨èµ„æºä½¿ç”¨ä¸Šæœ‰å¦‚æ­¤ä¹‹å¤šçš„æ ·æ¿ä»£ç ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—æœ€å¥½çš„æ–¹å¼æ˜¯å°è£…é€šç”¨ä»£ç å¹¶å‚æ•°åŒ–å¯å˜çš„éƒ¨åˆ†ã€‚è¿™æ­£æ˜¯Springçš„RestTemplateæ‰€åšçš„äº‹æƒ…ã€‚å°±åƒ JdbcTemplateå¤„ç†äº†JDBCæ•°æ®è®¿é—®æ—¶çš„ä¸‘é™‹éƒ¨åˆ†ï¼ŒRestTemplateè®©æˆ‘ä»¬åœ¨ä½¿ç”¨RESTfulèµ„æºæ—¶å…äºç¼–å†™é‚£äº›ä¹å‘³çš„ä»£ç ã€‚</p>
<p>ç¨åï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•å€ŸåŠ©RestTemplateé‡å†™fetchFacebookProfile()æ–¹æ³•ï¼Œè¿™ä¼šæˆå‰§æ€§çš„ç®€åŒ–è¯¥æ–¹æ³•å¹¶æ¶ˆé™¤æ‰æ ·æ¿å¼ä»£ç ã€‚ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ•´ä½“äº†è§£ä¸€ä¸‹RestTemplateæä¾›çš„æ‰€æœ‰RESTæ“ä½œã€‚</p>
<h4 id="äº†è§£RestTemplateçš„æ“ä½œ"><a href="#äº†è§£RestTemplateçš„æ“ä½œ" class="headerlink" title="äº†è§£RestTemplateçš„æ“ä½œ"></a>äº†è§£RestTemplateçš„æ“ä½œ</h4><p>RestTemplateå®šä¹‰äº†36ä¸ªä¸RESTèµ„æºäº¤äº’çš„æ–¹æ³•ï¼Œå…¶ä¸­çš„å¤§å¤šæ•°éƒ½å¯¹åº”äºHTTPçš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œåœ¨æœ¬ç« ä¸­æˆ‘æ²¡æœ‰è¶³å¤Ÿçš„ç¯‡å¹…æ¶µç›–æ‰€æœ‰çš„36ä¸ªæ–¹æ³•ã€‚å…¶å®ï¼Œè¿™é‡Œé¢åªæœ‰11ä¸ªç‹¬ç«‹çš„æ–¹æ³•ï¼Œå…¶ä¸­æœ‰åä¸ªæœ‰ä¸‰ç§é‡è½½å½¢å¼ï¼Œè€Œç¬¬åä¸€ä¸ªåˆ™é‡è½½äº†å…­æ¬¡ï¼Œè¿™æ ·ä¸€å…±å½¢æˆäº†36ä¸ªæ–¹æ³•ã€‚è¡¨16.2æè¿°äº†RestTemplateæ‰€æä¾›çš„11ä¸ªç‹¬ç«‹æ–¹æ³•ã€‚é™¤äº†TRACEä»¥å¤–ï¼ŒRestTemplateæ¶µç›–äº†æ‰€æœ‰çš„HTTPåŠ¨ä½œã€‚é™¤æ­¤ä¹‹å¤–ï¼Œexecute()å’Œexchange()æä¾›äº†è¾ƒä½å±‚æ¬¡çš„é€šç”¨æ–¹æ³•æ¥ä½¿ç”¨ä»»æ„çš„HTTPæ–¹æ³•ã€‚</p>
<p>è¡¨16.2ä¸­çš„å¤§å¤šæ•°æ“ä½œéƒ½ä»¥ä¸‰ç§æ–¹æ³•çš„å½¢å¼è¿›è¡Œäº†é‡è½½ï¼š</p>
<ul>
<li>ä¸€ä¸ªä½¿ç”¨java.net.URIä½œä¸ºURLæ ¼å¼ï¼Œä¸æ”¯æŒå‚æ•°åŒ–URLï¼›</li>
<li>ä¸€ä¸ªä½¿ç”¨Stringä½œä¸ºURLæ ¼å¼ï¼Œå¹¶ä½¿ç”¨MapæŒ‡æ˜URLå‚æ•°ï¼›</li>
<li>ä¸€ä¸ªä½¿ç”¨Stringä½œä¸ºURLæ ¼å¼ï¼Œå¹¶ä½¿ç”¨å¯å˜å‚æ•°åˆ—è¡¨æŒ‡æ˜URLå‚æ•°ã€‚</li>
</ul>
<p>æ˜ç¡®äº†RestTemplateæ‰€æä¾›çš„11ä¸ªæ“ä½œä»¥åŠå„ä¸ªå˜ç§å¦‚ä½•å·¥ä½œä¹‹åï¼Œä½ å°±èƒ½ä»¥è‡ªå·±çš„æ–¹å¼ç¼–å†™ä½¿ç”¨RESTèµ„æºçš„å®¢æˆ·ç«¯äº†ã€‚æˆ‘ä»¬é€šè¿‡å¯¹å››ä¸ªä¸»è¦HTTPæ–¹æ³•çš„æ”¯æŒï¼ˆä¹Ÿå°±æ˜¯GETã€PUTã€DELETEå’ŒPOSTï¼‰æ¥ç ”ç©¶RestTemplateçš„æ“ä½œã€‚æˆ‘ä»¬ä»GETæ–¹æ³•çš„getForObject()å’ŒgetForEntity()å¼€å§‹ã€‚</p>
<p>è¡¨16.2ã€€RestTemplateå®šä¹‰äº†11ä¸ªç‹¬ç«‹çš„æ“ä½œï¼Œè€Œæ¯ä¸€ä¸ªéƒ½æœ‰é‡è½½ï¼Œè¿™æ ·ä¸€å…±æ˜¯36ä¸ªæ–¹æ³•</p>
<table>
<thead>
<tr>
<th>æ–¹ã€€ã€€æ³•</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>delete()</td>
<td>åœ¨ç‰¹å®šçš„URLä¸Šå¯¹èµ„æºæ‰§è¡ŒHTTP DELETEæ“ä½œ</td>
</tr>
<tr>
<td>exchange()</td>
<td>åœ¨URLä¸Šæ‰§è¡Œç‰¹å®šçš„HTTPæ–¹æ³•ï¼Œè¿”å›åŒ…å«å¯¹è±¡çš„ResponseEntityï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä»å“åº”ä½“ä¸­æ˜ å°„å¾—åˆ°çš„</td>
</tr>
<tr>
<td>execute()</td>
<td>åœ¨URLä¸Šæ‰§è¡Œç‰¹å®šçš„HTTPæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªä»å“åº”ä½“æ˜ å°„å¾—åˆ°çš„å¯¹è±¡</td>
</tr>
<tr>
<td>getForEntity()</td>
<td>å‘é€ä¸€ä¸ªHTTP GETè¯·æ±‚ï¼Œè¿”å›çš„ResponseEntityåŒ…å«äº†å“åº”ä½“æ‰€æ˜ å°„æˆçš„å¯¹è±¡</td>
</tr>
<tr>
<td>getForObject()</td>
<td>å‘é€ä¸€ä¸ªHTTP GETè¯·æ±‚ï¼Œè¿”å›çš„è¯·æ±‚ä½“å°†æ˜ å°„ä¸ºä¸€ä¸ªå¯¹è±¡</td>
</tr>
<tr>
<td>headForHeaders()</td>
<td>å‘é€HTTP HEADè¯·æ±‚ï¼Œè¿”å›åŒ…å«ç‰¹å®šèµ„æºURLçš„HTTPå¤´</td>
</tr>
<tr>
<td>optionsForAllow()</td>
<td>å‘é€HTTP OPTIONSè¯·æ±‚ï¼Œè¿”å›å¯¹ç‰¹å®šURLçš„Allowå¤´ä¿¡æ¯</td>
</tr>
<tr>
<td>postForEntity()</td>
<td>POSTæ•°æ®åˆ°ä¸€ä¸ªURLï¼Œè¿”å›åŒ…å«ä¸€ä¸ªå¯¹è±¡çš„ResponseEntityï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä»å“åº”ä½“ä¸­æ˜ å°„å¾—åˆ°çš„</td>
</tr>
<tr>
<td>postForLocation()</td>
<td>POSTæ•°æ®åˆ°ä¸€ä¸ªURLï¼Œè¿”å›æ–°åˆ›å»ºèµ„æºçš„URL</td>
</tr>
<tr>
<td>postForObject()</td>
<td>POSTæ•°æ®åˆ°ä¸€ä¸ªURLï¼Œè¿”å›æ ¹æ®å“åº”ä½“åŒ¹é…å½¢æˆçš„å¯¹è±¡</td>
</tr>
<tr>
<td>put()</td>
<td>PUTèµ„æºåˆ°ç‰¹å®šçš„URL</td>
</tr>
</tbody></table>
<h4 id="GETèµ„æº"><a href="#GETèµ„æº" class="headerlink" title="GETèµ„æº"></a>GETèµ„æº</h4><p>ä½ å¯èƒ½æ„è¯†åˆ°åœ¨è¡¨16.2ä¸­åˆ—å‡ºäº†ä¸¤ç§æ‰§è¡ŒGETè¯·æ±‚çš„æ–¹æ³•ï¼šgetForObject()å’ŒgetForEntity()ã€‚æ­£å¦‚ä¹‹å‰æ‰€æè¿°çš„ï¼Œæ¯ä¸ªæ–¹æ³•åˆæœ‰ä¸‰ç§å½¢å¼çš„é‡è½½ã€‚ä¸‰ä¸ªgetForObject()æ–¹æ³•çš„ç­¾åå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; <span class="function">T <span class="title">getForObject</span><span class="params">(URI url, Class&lt;T&gt; responseType)</span> <span class="keyword">throws</span> RestClientException</span>;&lt;T&gt; <span class="function">T <span class="title">getForObject</span><span class="params">(String url, Class&lt;T&gt; responseType, Object... uriVariables)</span> <span class="keyword">throws</span> RestClientException</span>;&lt;T&gt; <span class="function">T <span class="title">getForObject</span><span class="params">(String url, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables)</span> <span class="keyword">throws</span> RestClientException</span>;</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼åœ°ï¼ŒgetForEntity()æ–¹æ³•çš„ç­¾åå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">getForEntity</span><span class="params">(URI url, Class&lt;T&gt; responseType)</span> <span class="keyword">throws</span> RestClientException</span>;&lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">getForEntity</span><span class="params">(String url, Class&lt;T&gt; responseType, Object... uriVariables)</span> <span class="keyword">throws</span> RestClientException</span>;&lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">getForEntity</span><span class="params">(String url, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables)</span> <span class="keyword">throws</span> RestClientException</span>;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†è¿”å›ç±»å‹ï¼ŒgetForEntity()æ–¹æ³•å°±æ˜¯getForObject()æ–¹æ³•çš„é•œåƒã€‚å®é™…ä¸Šï¼Œå®ƒä»¬çš„å·¥ä½œæ–¹å¼å¤§åŒå°å¼‚ã€‚å®ƒä»¬éƒ½æ‰§è¡Œæ ¹æ®URLæ£€ç´¢èµ„æºçš„GETè¯·æ±‚ã€‚å®ƒä»¬éƒ½å°†èµ„æºæ ¹æ®responseTypeå‚æ•°åŒ¹é…ä¸ºä¸€å®šçš„ç±»å‹ã€‚å”¯ä¸€çš„åŒºåˆ«åœ¨äºgetForObject()åªè¿”å›æ‰€è¯·æ±‚ç±»å‹çš„å¯¹è±¡ï¼Œè€ŒgetForEntity()æ–¹æ³•ä¼šè¿”å›è¯·æ±‚çš„å¯¹è±¡ä»¥åŠå“åº”ç›¸å…³çš„é¢å¤–ä¿¡æ¯ã€‚</p>
<p>è®©æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹ç¨å¾®ç®€å•çš„getForObject()æ–¹æ³•ã€‚ç„¶åå†çœ‹çœ‹å¦‚ä½•ä½¿ç”¨getForEntity()æ–¹æ³•æ¥ä»GETå“åº”ä¸­è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚</p>
<h4 id="æ£€ç´¢èµ„æº"><a href="#æ£€ç´¢èµ„æº" class="headerlink" title="æ£€ç´¢èµ„æº"></a>æ£€ç´¢èµ„æº</h4><p>getForObject()æ–¹æ³•æ˜¯æ£€ç´¢èµ„æºçš„åˆé€‚é€‰æ‹©ã€‚æˆ‘ä»¬è¯·æ±‚ä¸€ä¸ªèµ„æºå¹¶æŒ‰ç…§æ‰€é€‰æ‹©çš„Javaç±»å‹æ¥æ”¶è¯¥èµ„æºã€‚ä½œä¸ºgetForObject()èƒ½å¤Ÿåšä»€ä¹ˆçš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€<br>ä¸‹fetchFacebookProfile()çš„å¦ä¸€ä¸ªå®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Profile <span class="title">fetchFacebookProfile</span><span class="params">(String id)</span> </span>&#123;  RestTemplate rest = <span class="keyword">new</span> RestTemplate();  <span class="keyword">return</span> rest.getForObject(<span class="string">&quot;http://graph.facebook.com/&#123;spitter&#125;&quot;</span>,    Profile.class, id);&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¨‹åºæ¸…å•11.5ä¸­ï¼ŒfetchFacebookProfile()æ¶‰åŠåå¤šè¡Œä»£ç ã€‚é€šè¿‡ä½¿ç”¨RestTemplateï¼Œç°åœ¨å‡å°‘åˆ°äº†å‡ è¡Œï¼ˆå¦‚æœæˆ‘ä¸æ˜¯ä¸ºäº†é€‚åº”æœ¬ä¹¦é¡µé¢çš„è¾¹ç•Œï¼Œå¯èƒ½ä¼šæ›´å°‘ï¼‰ã€‚</p>
<p>fetchFacebookProfile()é¦–å…ˆæ„å»ºäº†ä¸€ä¸ªRestTemplateçš„å®ä¾‹ï¼ˆå¦ä¸€ç§å¯è¡Œçš„æ–¹å¼æ˜¯æ³¨å…¥å®ä¾‹ï¼‰ã€‚æ¥ä¸‹æ¥ï¼Œå®ƒè°ƒç”¨äº†getForObject()æ¥å¾—åˆ°Facebookä¸ªäººä¿¡æ¯ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œå®ƒè¦æ±‚ç»“æœæ˜¯Profileå¯¹è±¡ã€‚åœ¨æ¥æ”¶åˆ°Profileå¯¹è±¡åï¼Œè¯¥æ–¹æ³•å°†å…¶è¿”å›ç»™è°ƒç”¨è€…ã€‚</p>
<p>æ³¨æ„ï¼Œåœ¨è¿™ä¸ªæ–°ç‰ˆæœ¬çš„fetchFacebookProfile ()ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨å­—ç¬¦ä¸²è¿æ¥æ¥æ„å»ºURLï¼Œè€Œæ˜¯åˆ©ç”¨äº†RestTemplateå¯ä»¥æ¥å—å‚æ•°åŒ–URLè¿™ä¸€åŠŸèƒ½ã€‚URLä¸­çš„{id}å ä½ç¬¦æœ€ç»ˆå°†ä¼šç”¨æ–¹æ³•çš„idå‚æ•°æ¥å¡«å……ã€‚getForObject()æ–¹æ³•çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯å¤§å°å¯å˜çš„å‚æ•°åˆ—è¡¨ï¼Œæ¯ä¸ªå‚æ•°éƒ½ä¼šæŒ‰å‡ºç°é¡ºåºæ’å…¥åˆ°æŒ‡å®šURLçš„å ä½ç¬¦ä¸­ã€‚</p>
<p>å¦å¤–ä¸€ç§æ›¿ä»£æ–¹æ¡ˆæ˜¯å°†idå‚æ•°æ”¾åˆ°Mapä¸­ï¼Œå¹¶ä»¥idä½œä¸ºkeyï¼Œç„¶åå°†è¿™ä¸ªMapä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ä¼ é€’ç»™getForObject()ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Profile <span class="title">fetchFacebookProfile</span><span class="params">(String id)</span> </span>&#123;  Map&lt;String, String&gt; urlVariable = <span class="keyword">new</span> HashMap&lt;String, String&gt;();  urlVariable.put(<span class="string">&quot;id&quot;</span>, id);  RestTemplate rest = <span class="keyword">new</span> RestTemplate();  <span class="keyword">return</span> rest.getForObject(<span class="string">&quot;http://graph.facebook.com/&#123;spitter&#125;&quot;</span>,    Profile.class, urlVariable);&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ²¡æœ‰ä»»ä½•å½¢å¼çš„JSONè§£æå’Œå¯¹è±¡æ˜ å°„ã€‚åœ¨è¡¨é¢ä¹‹ä¸‹ï¼ŒgetForObject()ä¸ºæˆ‘ä»¬å°†å“åº”ä½“è½¬æ¢ä¸ºå¯¹è±¡ã€‚å®ƒå®ç°è¿™äº›éœ€è¦ä¾èµ–è¡¨16.1ä¸­æ‰€åˆ—çš„HTTPæ¶ˆæ¯è½¬æ¢å™¨ï¼Œä¸å¸¦æœ‰@ResponseBodyæ³¨è§£çš„Spring MVCå¤„ç†æ–¹æ³•æ‰€ä½¿ç”¨çš„ä¸€æ ·ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•ä¹Ÿæ²¡æœ‰ä»»ä½•å¼‚å¸¸å¤„ç†ã€‚è¿™ä¸æ˜¯å› ä¸ºgetForObject()ä¸èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯å› ä¸ºå®ƒæŠ›å‡ºçš„å¼‚å¸¸éƒ½æ˜¯éæ£€æŸ¥å‹çš„ã€‚å¦‚æœåœ¨getForObject()ä¸­æœ‰é”™è¯¯ï¼Œå°†æŠ›å‡ºéæ£€æŸ¥å‹RestClientExceptionå¼‚å¸¸ï¼ˆæˆ–è€…å®ƒçš„ä¸€äº›å­ç±»ï¼‰ã€‚å¦‚æœæ„¿æ„çš„è¯ï¼Œä½ å¯ä»¥æ•è·å®ƒâ€”â€”ä½†ç¼–è¯‘å™¨ä¸ä¼šå¼ºåˆ¶ä½ æ•è·å®ƒã€‚</p>
<h4 id="æŠ½å–å“åº”çš„å…ƒæ•°æ®"><a href="#æŠ½å–å“åº”çš„å…ƒæ•°æ®" class="headerlink" title="æŠ½å–å“åº”çš„å…ƒæ•°æ®"></a>æŠ½å–å“åº”çš„å…ƒæ•°æ®</h4><p>ä½œä¸ºgetForObject()çš„ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆï¼ŒRestTemplateè¿˜æä¾›äº†getForEntity()ã€‚getForEntity()æ–¹æ³•ä¸getForObject()æ–¹æ³•çš„å·¥ä½œå¾ˆç›¸ä¼¼ã€‚getForObject()åªè¿”å›èµ„æºï¼ˆé€šè¿‡HTTPä¿¡æ¯è½¬æ¢å™¨å°†å…¶è½¬æ¢ä¸ºJavaå¯¹è±¡ï¼‰ï¼ŒgetForEntity()ä¼šåœ¨ResponseEntityä¸­è¿”å›ç›¸åŒçš„å¯¹è±¡ï¼Œè€Œä¸”ResponseEntityè¿˜å¸¦æœ‰å…³äºå“åº”çš„é¢å¤–ä¿¡æ¯ï¼Œå¦‚HTTPçŠ¶æ€ç å’Œå“åº”å¤´ã€‚</p>
<p>æˆ‘ä»¬å¯èƒ½æƒ³ä½¿ç”¨ResponseEntityæ‰€åšçš„äº‹å°±æ˜¯è·å–å“åº”å¤´çš„ä¸€ä¸ªå€¼ã€‚ä¾‹å¦‚ï¼Œå‡è®¾é™¤äº†è·å–èµ„æºï¼Œè¿˜æƒ³è¦çŸ¥é“èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´ã€‚å‡è®¾æœåŠ¡ç«¯åœ¨LastModifiedå¤´éƒ¨ä¿¡æ¯ä¸­æä¾›äº†è¿™ä¸ªä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åƒè¿™æ ·ä½¿ç”¨getHeaders()æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Date lastModified = <span class="keyword">new</span> Date(response.getHeaders().getLastModified());</span><br></pre></td></tr></table></figure>

<p>getHeaders()æ–¹æ³•è¿”å›ä¸€ä¸ªHttpHeaderså¯¹è±¡ï¼Œè¯¥å¯¹è±¡æä¾›äº†å¤šä¸ªä¾¿åˆ©çš„æ–¹æ³•æ¥æŸ¥è¯¢å“åº”å¤´ï¼ŒåŒ…æ‹¬getLastModified()ï¼Œå®ƒå°†è¿”å›ä»1970å¹´1æœˆ1æ—¥å¼€å§‹çš„æ¯«ç§’æ•°ã€‚</p>
<p>é™¤äº†getLastModified()ï¼ŒHttpHeadersè¿˜åŒ…å«å¦‚ä¸‹çš„æ–¹æ³•æ¥è·å–å¤´ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;MediaType&gt; getAccept&#123;) &#123; ...&#125;<span class="function"><span class="keyword">public</span> List&lt;Charset&gt; <span class="title">getAcceptCharset</span><span class="params">()</span> </span>&#123; ...&#125;<span class="function"><span class="keyword">public</span> Set&lt;HttpMethod&gt; <span class="title">getAllow</span><span class="params">()</span> </span>&#123; ...&#125; <span class="keyword">public</span> String getCacheControl&#123;) &#123; ...&#125;<span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getConnection</span><span class="params">()</span> </span>&#123; ...&#125;<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getContentLength</span><span class="params">()</span> </span>&#123; ...&#125;<span class="function"><span class="keyword">public</span> MediaType <span class="title">getContentType</span><span class="params">()</span> </span>&#123; ...&#125; <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDate</span><span class="params">()</span> <span class="params">( ...)</span>  <span class="keyword">public</span> String getETagO </span>&#123; ...&#125; <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getExpires</span><span class="params">()</span> </span>&#123; ...&#125;<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getlfNotModifiedSince</span><span class="params">()</span> </span>&#123; ...&#125;<span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getlfNoneMatch</span><span class="params">()</span> </span>&#123; ...&#125; <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getLastModified</span><span class="params">()</span> </span>&#123; ...&#125;<span class="function"><span class="keyword">public</span> URI <span class="title">getLocation</span><span class="params">()</span> </span>&#123; ...&#125;<span class="keyword">public</span> String getOrigin&#123;) &#123; ...&#125; <span class="keyword">public</span> String getPragma&#123;) &#123; ...&#125; <span class="function"><span class="keyword">public</span> String <span class="title">getUpgrade</span><span class="params">()</span> </span>&#123; ...&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†å®ç°æ›´é€šç”¨çš„HTTPå¤´ä¿¡æ¯è®¿é—®ï¼ŒHttpHeadersæä¾›äº†get()æ–¹æ³•å’ŒgetFirst()æ–¹æ³•ã€‚ä¸¤ä¸ªæ–¹æ³•éƒ½æ¥å—Stringå‚æ•°æ¥æ ‡è¯†æ‰€éœ€è¦çš„å¤´ä¿¡æ¯ã€‚get()å°†ä¼šè¿”å›ä¸€ä¸ªStringå€¼çš„åˆ—è¡¨ï¼Œå…¶ä¸­çš„æ¯ä¸ªå€¼éƒ½æ˜¯èµ‹ç»™è¯¥å¤´éƒ¨ä¿¡æ¯çš„ï¼Œè€ŒgetFirst()æ–¹æ³•åªä¼šè¿”å›ç¬¬ä¸€ä¸ªå¤´ä¿¡æ¯çš„å€¼ã€‚</p>
<p>å¦‚æœä½ å¯¹å“åº”çš„HTTPçŠ¶æ€ç æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆä½ å¯ä»¥è°ƒç”¨getStatusCode()æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸‹é¢è¿™ä¸ªè·å–Spittleå¯¹è±¡çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Spittle <span class="title">fetchSpittle</span><span class="params">(String id)</span> </span>&#123;  RestTemplate rest = <span class="keyword">new</span> RestTemplate();  ResponseEntity&lt;Spittle&gt; response = rest.getForEntity(    <span class="string">&quot;http://localhost:8080/spittr-api/spittles/&#123;id&#125;&quot;</span>,    Spittle.class, id);  <span class="keyword">if</span> (response.getStatusCode() == HttpStatus.NOT_MODIFIED) &#123;    <span class="keyword">throw</span> <span class="keyword">new</span> NotModifiedException();  &#125;  <span class="keyword">return</span> response.getBody();&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œå¦‚æœæœåŠ¡å™¨å“åº”304çŠ¶æ€ï¼Œè¿™æ„å‘³ç€æœåŠ¡å™¨ç«¯çš„å†…å®¹è‡ªä»ä¸Šä¸€æ¬¡è¯·æ±‚ä¹‹åå†ä¹Ÿæ²¡æœ‰ä¿®æ”¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†ä¼šæŠ›å‡ºè‡ªå®šä¹‰çš„NotModifiedExceptionå¼‚å¸¸æ¥è¡¨æ˜å®¢æˆ·ç«¯åº”è¯¥æ£€æŸ¥å®ƒçš„ç¼“å­˜æ¥è·å–Spittleã€‚</p>
<h4 id="PUTèµ„æº"><a href="#PUTèµ„æº" class="headerlink" title="PUTèµ„æº"></a>PUTèµ„æº</h4><p>ä¸ºäº†å¯¹æ•°æ®è¿›è¡ŒPUTæ“ä½œï¼ŒRestTemplateæä¾›äº†ä¸‰ä¸ªç®€å•çš„put()æ–¹æ³•ã€‚å°±åƒå…¶ä»–çš„RestTemplateæ–¹æ³•ä¸€æ ·ï¼Œput()æ–¹æ³•æœ‰ä¸‰ç§å½¢å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">put</span><span class="params">(String url, Object request, Object... uriVariables)</span> <span class="keyword">throws</span> RestClientException</span>;<span class="function"><span class="keyword">void</span> <span class="title">put</span><span class="params">(String url, Object request, Map&lt;String, ?&gt; uriVariables)</span> <span class="keyword">throws</span> RestClientException</span>;<span class="function"><span class="keyword">void</span> <span class="title">put</span><span class="params">(URI url, Object request)</span> <span class="keyword">throws</span> RestClientException</span>;</span><br></pre></td></tr></table></figure>

<p>æŒ‰ç…§å®ƒæœ€ç®€å•çš„å½¢å¼ï¼Œput()æ¥å—ä¸€ä¸ªjava.net.URIï¼Œç”¨æ¥æ ‡è¯†ï¼ˆåŠå®šä½ï¼‰è¦å°†èµ„æºå‘é€åˆ°æœåŠ¡å™¨ä¸Šï¼Œå¦å¤–è¿˜æ¥å—ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä»£è¡¨äº†èµ„æºçš„Javaè¡¨è¿°ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹å±•ç°äº†å¦‚ä½•ä½¿ç”¨åŸºäºURIç‰ˆæœ¬çš„put()æ–¹æ³•æ¥æ›´æ–°æœåŠ¡å™¨ä¸Šçš„Spittleèµ„æºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateSpittle</span><span class="params">(Spittle spittle)</span> <span class="keyword">throws</span> SpitterException </span>&#123;  RestTemplate rest = <span class="keyword">new</span> RestTemplate();  String url = <span class="string">&quot;http://localhost:8080/spittr-api/spittles/&quot;</span> + spittle.getId();  rest.put(URI.create(url), spittle);&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œå°½ç®¡æ–¹æ³•ç­¾åå¾ˆç®€å•ï¼Œä½†æ˜¯ä½¿ç”¨java.net.URIä½œä¸ºå‚æ•°çš„å½±å“å¾ˆæ˜æ˜¾ã€‚ä¸ºäº†åˆ›å»ºæ‰€æ›´æ–°Spittleå¯¹è±¡çš„URLï¼Œæˆ‘ä»¬è¦è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ã€‚</p>
<p>ä»getForObject()å’ŒgetForEntity()æ–¹æ³•ä¸­æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†ï¼Œä½¿ç”¨åŸºäºStringçš„å…¶ä»–put()æ–¹æ³•èƒ½å¤Ÿä¸ºæˆ‘ä»¬å‡å°‘åˆ›å»ºURIçš„ä¸ä¾¿ã€‚è¿™äº›æ–¹æ³•å¯ä»¥å°†URIæŒ‡å®šä¸ºæ¨¡æ¿å¹¶å¯¹å¯å˜éƒ¨åˆ†æ’å…¥å€¼ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨åŸºäºStringçš„put()æ–¹æ³•é‡å†™çš„updateSpittle()ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateSpittle</span><span class="params">(Spittle spittle)</span> <span class="keyword">throws</span> SpitterException </span>&#123;  RestTemplate rest = <span class="keyword">new</span> RestTemplate();  rest.put(<span class="string">&quot;http://localhost:8080/spittr-api/spittles/&#123;id&#125;&quot;</span>,    spittle, spittle.getId());&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨çš„URIä½¿ç”¨ç®€å•çš„Stringæ¨¡æ¿æ¥è¿›è¡Œè¡¨ç¤ºã€‚å½“RestTemplateå‘é€PUTè¯·æ±‚æ—¶ï¼ŒURIæ¨¡æ¿å°†{id}éƒ¨åˆ†ç”¨spittle.getId()æ–¹æ³•çš„è¿”å›å€¼æ¥è¿›è¡Œæ›¿æ¢ã€‚å°±åƒgetForObject()å’ŒgetForEntity()ä¸€æ ·ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„put()æ–¹æ³•æœ€åä¸€ä¸ªå‚æ•°æ˜¯å¤§å°å¯å˜çš„å‚æ•°åˆ—è¡¨ï¼Œæ¯ä¸€ä¸ªå€¼ä¼šå‡ºç°æŒ‰ç…§é¡ºåºèµ‹å€¼ç»™å ä½ç¬¦å˜é‡ã€‚</p>
<p>ä½ è¿˜å¯ä»¥å°†æ¨¡æ¿å‚æ•°ä½œä¸ºMapä¼ é€’è¿›æ¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateSpittle</span><span class="params">(Spittle spittle)</span> <span class="keyword">throws</span> SpitterException </span>&#123;  RestTemplate rest = <span class="keyword">new</span> RestTemplate();  Map&lt;String, String&gt; params = <span class="keyword">new</span> HashMap&lt;String, String&gt;();  params.put(<span class="string">&quot;id&quot;</span>, spittle.getId());  rest.put(<span class="string">&quot;http://localhost:8080/spittr-api/spittles/&#123;id&#125;&quot;</span>,    spittle, params);&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ä½¿ç”¨Mapæ¥ä¼ é€’æ¨¡æ¿å‚æ•°æ—¶ï¼ŒMapæ¡ç›®çš„æ¯ä¸ªkeyå€¼ä¸URIæ¨¡æ¿ä¸­å ä½ç¬¦å˜é‡çš„åå­—ç›¸åŒã€‚</p>
<p>åœ¨æ‰€æœ‰ç‰ˆæœ¬çš„put()ä¸­ï¼Œç¬¬äºŒä¸ªå‚æ•°éƒ½æ˜¯è¡¨ç¤ºèµ„æºçš„Javaå¯¹è±¡ï¼Œå®ƒå°†æŒ‰ç…§æŒ‡å®šçš„URIå‘é€åˆ°æœåŠ¡å™¨ç«¯ã€‚åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªSpittleå¯¹è±¡ã€‚RestTemplateå°†ä½¿ç”¨è¡¨16.1ä¸­çš„æŸä¸ªHTTPæ¶ˆæ¯è½¬æ¢å™¨å°†Spittleå¯¹è±¡è½¬æ¢ä¸ºä¸€ç§è¡¨è¿°å½¢å¼ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­å°†å…¶å‘é€åˆ°æœåŠ¡å™¨ç«¯ã€‚</p>
<p>å¯¹è±¡å°†è¢«è½¬æ¢æˆä»€ä¹ˆæ ·çš„å†…å®¹ç±»å‹å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºä¼ é€’ç»™put()æ–¹æ³•çš„ç±»å‹ã€‚å¦‚æœç»™å®šä¸€ä¸ªStringå€¼ï¼Œé‚£ä¹ˆå°†ä¼šä½¿ç”¨StringHttpMessageConverterï¼šè¿™ä¸ªå€¼ç›´æ¥è¢«å†™åˆ°è¯·æ±‚ä½“ä¸­ï¼Œå†…å®¹ç±»å‹è®¾ç½®ä¸ºâ€œtext/plainâ€ã€‚å¦‚æœç»™å®šä¸€ä¸ªMultiValueMap&lt;String,String&gt;ï¼Œé‚£ä¹ˆè¿™ä¸ªMapä¸­çš„å€¼å°†ä¼šè¢«FormHttpMessageConverterä»¥â€œapplication/x-wwwform-urlencodedâ€çš„æ ¼å¼å†™åˆ°è¯·æ±‚ä½“ä¸­ã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬ä¼ é€’è¿›æ¥çš„æ˜¯Spittleå¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿå¤„ç†ä»»æ„å¯¹è±¡çš„ä¿¡æ¯è½¬æ¢å™¨ã€‚å¦‚æœåœ¨ç±»è·¯å¾„ä¸‹åŒ…å«Jackson 2åº“ï¼Œé‚£ä¹ˆMappingJacksonHttpMessageConverterå°†ä»¥application/jsonæ ¼å¼å°†Spittleå†™åˆ°è¯·æ±‚ä¸­ã€‚</p>
<h4 id="DELETEèµ„æº"><a href="#DELETEèµ„æº" class="headerlink" title="DELETEèµ„æº"></a>DELETEèµ„æº</h4><p>å½“ä½ ä¸éœ€è¦åœ¨æœåŠ¡ç«¯ä¿ç•™æŸä¸ªèµ„æºæ—¶ï¼Œé‚£ä¹ˆå¯èƒ½éœ€è¦è°ƒç”¨RestTemplateçš„delete()æ–¹æ³•ã€‚å°±åƒPUTæ–¹æ³•é‚£æ ·ï¼Œdelete()æ–¹æ³•æœ‰ä¸‰ä¸ªç‰ˆæœ¬ï¼Œå®ƒä»¬çš„ç­¾åå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(String url, Object... uriVariables)</span> <span class="keyword">throws</span> RestClientException</span>;<span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(String url, Map&lt;String, ?&gt; uriVariables)</span> <span class="keyword">throws</span> RestClientException</span>;<span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(URI url)</span> <span class="keyword">throws</span> RestClientException</span>;</span><br></pre></td></tr></table></figure>

<p>å¾ˆå®¹æ˜“å§ï¼Œdelete()æ–¹æ³•æ˜¯æ‰€æœ‰RestTemplateæ–¹æ³•ä¸­æœ€ç®€å•çš„ã€‚ä½ å”¯ä¸€è¦æä¾›çš„å°±æ˜¯è¦åˆ é™¤èµ„æºçš„URIã€‚ä¾‹å¦‚ï¼Œä¸ºäº†åˆ é™¤æŒ‡å®šIDçš„Spittleï¼Œä½ å¯ä»¥è¿™æ ·è°ƒ delete()ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteSpittle</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;  RestTemplate rest = <span class="keyword">new</span> RestTemplate();  rest.delete(URI.create(<span class="string">&quot;http://localhost:8080/spittr-api/spittles/&quot;</span> + id));&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™å¾ˆç®€å•ï¼Œä½†åœ¨è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ä¾èµ–å­—ç¬¦ä¸²è¿æ¥æ¥åˆ›å»ºURIå¯¹è±¡ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸ªæ›´ç®€å•çš„delete()æ–¹æ³•ï¼Œå®ƒèƒ½å¤Ÿä½¿å¾—æˆ‘ä»¬å…äºè¿™äº›éº»çƒ¦ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteSpittle</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;  RestTemplate rest = <span class="keyword">new</span> RestTemplate();  rest.delete(<span class="string">&quot;http://localhost:8080/spittr-api/spittles/&#123;id&#125;&quot;</span>, id);&#125;</span><br></pre></td></tr></table></figure>

<p>ä½ çœ‹ï¼Œæˆ‘æ„Ÿè§‰å¥½å¤šäº†ã€‚ä½ å‘¢ï¼Ÿ</p>
<p>ç°åœ¨æˆ‘å·²ç»ä¸ºä½ å±•ç°äº†æœ€ç®€å•çš„RestTemplateæ–¹æ³•ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹RestTemplateæœ€å¤šæ ·åŒ–çš„ä¸€ç»„æ–¹æ³•â€”â€”å®ƒä»¬èƒ½å¤Ÿæ”¯æŒHTTPPOSTè¯·æ±‚ã€‚</p>
<h4 id="POSTèµ„æºæ•°æ®"><a href="#POSTèµ„æºæ•°æ®" class="headerlink" title="POSTèµ„æºæ•°æ®"></a>POSTèµ„æºæ•°æ®</h4><p>åœ¨16.2èŠ‚çš„è¡¨ä¸­ï¼Œä½ ä¼šçœ‹åˆ°RestTemplateæœ‰ä¸‰ä¸ªä¸åŒç±»å‹çš„æ–¹æ³•æ¥å‘é€POSTè¯·æ±‚ã€‚å½“ä½ å†ä¹˜ä¸Šæ¯ä¸ªæ–¹æ³•çš„ä¸‰ä¸ªä¸åŒå˜ç§ï¼Œé‚£å°±æ˜¯æœ‰ä¹ä¸ªæ–¹æ³•æ¥POSTæ•°æ®åˆ°æœåŠ¡å™¨ç«¯ã€‚</p>
<p>è¿™äº›æ–¹æ³•ä¸­æœ‰ä¸¤ä¸ªçš„åå­—çœ‹èµ·æ¥æ¯”è¾ƒç±»ä¼¼ã€‚postForObject()å’ŒpostForEntity()å¯¹POSTè¯·æ±‚çš„å¤„ç†æ–¹å¼ä¸å‘é€GETè¯·æ±‚çš„getForObject()å’ŒgetForEntity()æ–¹æ³•æ˜¯ç±»ä¼¼çš„ã€‚å¦ä¸€ä¸ªæ–¹æ³•æ˜¯getForLocation()ï¼Œå®ƒæ˜¯POSTè¯·æ±‚æ‰€ç‰¹æœ‰çš„ã€‚</p>
<h4 id="åœ¨POSTè¯·æ±‚ä¸­è·å–å“åº”å¯¹è±¡"><a href="#åœ¨POSTè¯·æ±‚ä¸­è·å–å“åº”å¯¹è±¡" class="headerlink" title="åœ¨POSTè¯·æ±‚ä¸­è·å–å“åº”å¯¹è±¡"></a>åœ¨POSTè¯·æ±‚ä¸­è·å–å“åº”å¯¹è±¡</h4><p>å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨RestTemplateæ¥POSTä¸€ä¸ªæ–°çš„Spitterå¯¹è±¡åˆ°Spittråº”ç”¨ç¨‹åºçš„REST APIã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„Spitterï¼ŒæœåŠ¡ç«¯å¹¶ï¼ˆè¿˜ï¼‰ä¸çŸ¥é“å®ƒã€‚å› æ­¤ï¼Œå®ƒè¿˜ä¸æ˜¯çœŸæ­£çš„RESTèµ„æºï¼Œä¹Ÿæ²¡æœ‰URLã€‚å¦å¤–ï¼Œåœ¨æœåŠ¡ç«¯åˆ›å»ºä¹‹å‰ï¼Œå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“Spitterçš„IDã€‚</p>
<p>POSTèµ„æºåˆ°æœåŠ¡ç«¯çš„ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨RestTemplateçš„postForObject()æ–¹æ³•ã€‚postForObject()æ–¹æ³•çš„ä¸‰ä¸ªå˜ç§ç­¾åå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; <span class="function">T <span class="title">postForObject</span><span class="params">(String url, Object request, Class&lt;T&gt; responseType, Object... uriVariables)</span>			<span class="keyword">throws</span> RestClientException</span>;&lt;T&gt; <span class="function">T <span class="title">postForObject</span><span class="params">(String url, Object request, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables)</span>			<span class="keyword">throws</span> RestClientException</span>;&lt;T&gt; <span class="function">T <span class="title">postForObject</span><span class="params">(URI url, Object request, Class&lt;T&gt; responseType)</span> <span class="keyword">throws</span> RestClientException</span>;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯èµ„æºè¦POSTåˆ°çš„URLï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦å‘é€çš„å¯¹è±¡ï¼Œè€Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯é¢„æœŸè¿”å›çš„Javaç±»å‹ã€‚åœ¨å°†URLä½œä¸ºStringç±»å‹çš„ä¸¤ä¸ªç‰ˆæœ¬ä¸­ï¼Œç¬¬å››ä¸ªå‚æ•°æŒ‡å®šäº†URLå˜é‡ï¼ˆè¦ä¹ˆæ˜¯å¯å˜å‚æ•°åˆ—è¡¨ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ªMapï¼‰ã€‚</p>
<p>å½“POSTæ–°çš„Spitterèµ„æºåˆ°Spitter REST APIæ—¶ï¼Œå®ƒä»¬åº”è¯¥å‘é€åˆ°<a target="_blank" rel="noopener" href="http://localhost:8080/spittr-api/spitters%EF%BC%8C%E8%BF%99%E9%87%8C%E4%BC%9A%E6%9C%89%E4%B8%80%E4%B8%AA%E5%BA%94%E5%AF%B9POST%E8%AF%B7%E6%B1%82%E7%9A%84%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95%E6%9D%A5%E4%BF%9D%E5%AD%98%E5%AF%B9%E8%B1%A1%E3%80%82%E5%9B%A0%E4%B8%BA%E8%BF%99%E4%B8%AAURL%E4%B8%8D%E9%9C%80%E8%A6%81URL%E5%8F%82%E6%95%B0%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E4%BB%BB%E4%BD%95%E7%89%88%E6%9C%AC%E7%9A%84postForObject()%E3%80%82%E4%BD%86%E4%B8%BA%E4%BA%86%E4%BF%9D%E6%8C%81%E5%B0%BD%E5%8F%AF%E8%83%BD%E7%AE%80%E5%8D%95%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E8%BF%99%E6%A0%B7%E8%B0%83%E7%94%A8%EF%BC%9A">http://localhost:8080/spittr-api/spittersï¼Œè¿™é‡Œä¼šæœ‰ä¸€ä¸ªåº”å¯¹POSTè¯·æ±‚çš„å¤„ç†æ–¹æ³•æ¥ä¿å­˜å¯¹è±¡ã€‚å› ä¸ºè¿™ä¸ªURLä¸éœ€è¦URLå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½•ç‰ˆæœ¬çš„postForObject()ã€‚ä½†ä¸ºäº†ä¿æŒå°½å¯èƒ½ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è°ƒç”¨ï¼š</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Spitter <span class="title">postSpitterForObject</span><span class="params">(Spitter spitter)</span> </span>&#123;  RestTemplate rest = <span class="keyword">new</span> RestTemplate();  <span class="keyword">return</span> rest.postForObject(<span class="string">&quot;http://localhost:8080/spittr-api/spitters&quot;</span>,    spitter, Spitter.class);&#125;</span><br></pre></td></tr></table></figure>

<p>postSpitterForObject()æ–¹æ³•ç»™å®šäº†ä¸€ä¸ªæ–°åˆ›å»ºçš„Spitterå¯¹è±¡ï¼Œå¹¶ä½¿ç”¨postForObject()å°†å…¶å‘é€åˆ°æœåŠ¡å™¨ç«¯ã€‚åœ¨å“åº”ä¸­ï¼Œå®ƒæ¥æ”¶åˆ°ä¸€ä¸ªSpitterå¯¹è±¡å¹¶å°†å…¶è¿”å›ç»™è°ƒç”¨è€…ã€‚</p>
<p>å°±åƒgetForEntity()æ–¹æ³•ä¸€æ ·ï¼Œä½ å¯èƒ½æƒ³å¾—åˆ°è¯·æ±‚å¸¦å›æ¥çš„ä¸€äº›å…ƒæ•°æ®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒpostForEntity()æ˜¯æ›´åˆé€‚çš„æ–¹æ³•ã€‚postForEntity()æ–¹æ³•æœ‰ç€ä¸postForObject()å‡ ä¹ç›¸åŒçš„ä¸€ç»„ç­¾åï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">postForEntity</span><span class="params">(String url, Object request, Class&lt;T&gt; responseType, Object... uriVariables)</span>			<span class="keyword">throws</span> RestClientException</span>;&lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">postForEntity</span><span class="params">(String url, Object request, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables)</span>			<span class="keyword">throws</span> RestClientException</span>;&lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">postForEntity</span><span class="params">(URI url, Object request, Class&lt;T&gt; responseType)</span> <span class="keyword">throws</span> RestClientException</span>;</span><br></pre></td></tr></table></figure>

<p>å‡è®¾é™¤äº†è¦è·å–è¿”å›çš„Spitterèµ„æºï¼Œè¿˜è¦æŸ¥çœ‹å“åº”ä¸­Locationå¤´ä¿¡æ¯çš„å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥è¿™æ ·è°ƒç”¨postForEntity()ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RestTemplate rest = <span class="keyword">new</span> RestTemplate();ResponseEntity&lt;Spitter&gt; response = rest.postForEntity(  <span class="string">&quot;http://localhost:8080/spittr-api/spitters&quot;</span>,  spitter, Spitter.class);Spitter spitter = response.getBody();URI url = response.getHeaders().getLocation();</span><br></pre></td></tr></table></figure>

<p>ä¸getForEntity()æ–¹æ³•ä¸€æ ·ï¼ŒpostForEntity()è¿”å›ä¸€ä¸ªResponseEntity<T>å¯¹è±¡ã€‚ä½ å¯ä»¥è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„getBody()æ–¹æ³•ä»¥è·å–èµ„æºå¯¹è±¡ï¼ˆåœ¨æœ¬ç¤ºä¾‹ä¸­æ˜¯Spitterï¼‰ã€‚getHeaders()ä¼šç»™ä½ ä¸€ä¸ªHttpHeadersï¼Œé€šè¿‡å®ƒå¯ä»¥è®¿é—®å“åº”ä¸­è¿”å›çš„å„ç§HTTPå¤´ä¿¡æ¯ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬è°ƒç”¨getLocation()æ¥å¾—åˆ°java.net.URIå½¢å¼çš„Locationå¤´ä¿¡æ¯ã€‚</T></p>
<h4 id="åœ¨POSTè¯·æ±‚åè·å–èµ„æºä½ç½®"><a href="#åœ¨POSTè¯·æ±‚åè·å–èµ„æºä½ç½®" class="headerlink" title="åœ¨POSTè¯·æ±‚åè·å–èµ„æºä½ç½®"></a>åœ¨POSTè¯·æ±‚åè·å–èµ„æºä½ç½®</h4><p>å¦‚æœè¦åŒæ—¶æ¥æ”¶æ‰€å‘é€çš„èµ„æºå’Œå“åº”å¤´ï¼ŒpostForEntity()æ–¹æ³•æ˜¯å¾ˆä¾¿åˆ©çš„ã€‚ä½†é€šå¸¸ä½ å¹¶ä¸éœ€è¦å°†èµ„æºå‘é€å›æ¥ï¼ˆæ¯•ç«Ÿï¼Œå°†å…¶å‘é€åˆ°æœåŠ¡å™¨ç«¯æ˜¯ç¬¬ä¸€ä½çš„ï¼‰ã€‚å¦‚æœä½ çœŸæ­£éœ€è¦çš„æ˜¯Locationå¤´ä¿¡æ¯çš„å€¼ï¼Œé‚£ä¹ˆä½¿ç”¨RestTemplateçš„postForLocation()æ–¹æ³•ä¼šæ›´ç®€å•ã€‚</p>
<p>ç±»ä¼¼äºå…¶ä»–çš„POSTæ–¹æ³•ï¼ŒpostForLocation()ä¼šåœ¨POSTè¯·æ±‚çš„è¯·æ±‚ä½“ä¸­å‘é€ä¸€ä¸ªèµ„æºåˆ°æœåŠ¡å™¨ç«¯ã€‚ä½†æ˜¯ï¼Œå“åº”ä¸å†æ˜¯ç›¸åŒçš„èµ„æºå¯¹è±¡ï¼ŒpostForLocation()çš„å“åº”æ˜¯æ–°åˆ›å»ºèµ„æºçš„ä½ç½®ã€‚å®ƒæœ‰å¦‚ä¸‹ä¸‰ä¸ªæ–¹æ³•ç­¾åï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">URI <span class="title">postForLocation</span><span class="params">(String url, Object request, Object... uriVariables)</span> <span class="keyword">throws</span> RestClientException</span>;<span class="function">URI <span class="title">postForLocation</span><span class="params">(String url, Object request, Map&lt;String, ?&gt; uriVariables)</span> <span class="keyword">throws</span> RestClientException</span>;<span class="function">URI <span class="title">postForLocation</span><span class="params">(URI url, Object request)</span> <span class="keyword">throws</span> RestClientException</span>;</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†å±•ç¤ºpostForLocation()ï¼Œè®©æˆ‘ä»¬å†æ¬¡POSTä¸€ä¸ªSpitterã€‚è¿™æ¬¡ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨è¿”å›ä¸­åŒ…å«èµ„æºçš„URLï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">postSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;  RestTemplate rest = <span class="keyword">new</span> RestTemplate();  <span class="keyword">return</span> rest.postForLocation(<span class="string">&quot;http://localhost:8080/spittr-api/spitters&quot;</span>,    spitter).toString();&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä»¥Stringçš„å½¢å¼å°†ç›®æ ‡URLä¼ é€’è¿›æ¥ï¼Œè¿˜æœ‰è¦POSTçš„Spitterå¯¹è±¡ï¼ˆåœ¨æœ¬ç¤ºä¾‹ä¸­æ²¡æœ‰URLå‚æ•°ï¼‰ã€‚åœ¨åˆ›å»ºèµ„æºåï¼Œå¦‚æœæœåŠ¡ç«¯åœ¨å“åº”çš„Locationå¤´ä¿¡æ¯ä¸­è¿”å›æ–°èµ„æºçš„URLï¼Œæ¥ä¸‹æ¥postForLocation()ä¼šä»¥Stringçš„æ ¼å¼è¿”å›è¯¥URLã€‚</p>
<h4 id="äº¤æ¢èµ„æº"><a href="#äº¤æ¢èµ„æº" class="headerlink" title="äº¤æ¢èµ„æº"></a>äº¤æ¢èµ„æº</h4><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°RestTemplateçš„å„ç§æ–¹æ³•æ¥GRTã€PUTã€DELETEä»¥åŠPOSTèµ„æºã€‚åœ¨å®ƒä»¬ä¹‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸¤ä¸ªç‰¹æ®Šçš„æ–¹æ³•ï¼šgetForEntity()å’ŒpostForEntity()ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•å°†ç»“æœèµ„æºåŒ…å«åœ¨ä¸€ä¸ªResponseEntityå¯¹è±¡ä¸­ï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡æˆ‘ä»¬å¯ä»¥å¾—åˆ°å“åº”å¤´å’ŒçŠ¶æ€ç ã€‚</p>
<p>èƒ½å¤Ÿä»å“åº”ä¸­è¯»å–å¤´ä¿¡æ¯æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ä½†æ˜¯å¦‚æœä½ æƒ³åœ¨å‘é€ç»™æœåŠ¡ç«¯çš„è¯·æ±‚ä¸­è®¾ç½®å¤´ä¿¡æ¯çš„è¯ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿè¿™å°±æ˜¯RestTemplateçš„exchange()çš„ç”¨æ­¦ä¹‹åœ°ã€‚<br>åƒRestTemplateçš„å…¶ä»–æ–¹æ³•ä¸€æ ·ï¼Œexchange()ä¹Ÿé‡è½½ä¸ºä¸‰ä¸ªç­¾åæ ¼å¼ã€‚ä¸€ä¸ªä½¿ç”¨java.net.URIæ¥æ ‡è¯†ç›®æ ‡URLï¼Œè€Œå…¶ä»–ä¸¤ä¸ªä»¥Stringçš„å½¢å¼ä¼ å…¥URLå¹¶å¸¦æœ‰URLå˜é‡ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">exchange</span><span class="params">(URI url, HttpMethod method, HttpEntity&lt;?&gt; requestEntity,			Class&lt;T&gt; responseType)</span> <span class="keyword">throws</span> RestClientException</span>;&lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">exchange</span><span class="params">(String url, HttpMethod method, HttpEntity&lt;?&gt; requestEntity,			Class&lt;T&gt; responseType, Object... uriVariables)</span> <span class="keyword">throws</span> RestClientException</span>;&lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">exchange</span><span class="params">(String url, HttpMethod method, HttpEntity&lt;?&gt; requestEntity,			Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables)</span> <span class="keyword">throws</span> RestClientException</span>;</span><br></pre></td></tr></table></figure>

<p>exchange()æ–¹æ³•ä½¿ç”¨HttpMethodå‚æ•°æ¥è¡¨æ˜è¦ä½¿ç”¨çš„HTTPåŠ¨ä½œã€‚æ ¹æ®è¿™ä¸ªå‚æ•°çš„å€¼ï¼Œexchange()èƒ½å¤Ÿæ‰§è¡Œä¸å…¶ä»–RestTemplateæ–¹æ³•ä¸€æ ·çš„å·¥ä½œã€‚</p>
<p>ä¾‹å¦‚ï¼Œä»æœåŠ¡å™¨ç«¯è·å–Spitterèµ„æºçš„ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨RestTemplateçš„getForEntity()æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ResponseEntity&lt;Spitter&gt; response = rest.getForEntity(  <span class="string">&quot;http://localhost:8080/spittr-api/spitters/&#123;spitter&#125;&quot;</span>,  Spitter.class, spitterId);Spitter spitter = response.getBody();</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œå¯ä»¥çœ‹åˆ°exchange()ä¹Ÿå¯ä»¥å®Œæˆè¿™é¡¹ä»»åŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ResponseEntity&lt;Spitter&gt; response = rest.exchange(  <span class="string">&quot;http://localhost:8080/spittr-api/spitters/&#123;spitter&#125;&quot;</span>,  HttpMethod.GET, <span class="keyword">null</span>, Spitter.class, spitterId);Spitter spitter = response.getBody();</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¼ å…¥HttpMethod.GETä½œä¸ºHTTPåŠ¨ä½œï¼Œæˆ‘ä»¬ä¼šè¦æ±‚exchange()å‘é€ä¸€ä¸ªGETè¯·æ±‚ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ç”¨äºåœ¨è¯·æ±‚ä¸­å‘é€èµ„æºçš„ï¼Œä½†å› ä¸ºè¿™æ˜¯ä¸€ä¸ªGETè¯·æ±‚ï¼Œå®ƒå¯ä»¥æ˜¯nullã€‚ä¸‹ä¸€ä¸ªå‚æ•°è¡¨æ˜æˆ‘ä»¬å¸Œæœ›å°†å“åº”è½¬æ¢ä¸ºSpitterå¯¹è±¡ã€‚æœ€åä¸€ä¸ªå‚æ•°ç”¨äºæ›¿æ¢URLæ¨¡æ¿ä¸­{spitter}å ä½ç¬¦çš„å€¼ã€‚</p>
<p>æŒ‰ç…§è¿™ç§æ–¹å¼ï¼Œexchange()ä¸ä¹‹å‰ä½¿ç”¨çš„getForEntity()æ˜¯å‡ ä¹ç›¸åŒçš„ï¼Œä½†æ˜¯ï¼Œä¸åŒäºgetForEntity()â€”â€”æˆ–getForObject()â€”â€”exchange()æ–¹æ³•å…è®¸åœ¨è¯·æ±‚ä¸­è®¾ç½®å¤´ä¿¡æ¯ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸å†ç»™exchange()ä¼ é€’nullï¼Œè€Œæ˜¯ä¼ å…¥å¸¦æœ‰è¯·æ±‚å¤´ä¿¡æ¯çš„HttpEntityã€‚</p>
<p>å¦‚æœä¸æŒ‡æ˜å¤´ä¿¡æ¯ï¼Œexchange()å¯¹Spitterçš„GETè¯·æ±‚ä¼šå¸¦æœ‰å¦‚ä¸‹çš„å¤´ä¿¡æ¯ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /Spitter/spitters/habuma HTTP/1.1Accept: application/xml, text/xml, application/*+xml, application/jsonContent-Length: 0User-Agent: Java/1.6.0_20Host: localhost:8080Connection: keep-alive</span><br></pre></td></tr></table></figure>

<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹Acceptå¤´ä¿¡æ¯ã€‚Acceptå¤´ä¿¡æ¯è¡¨æ˜å®ƒèƒ½å¤Ÿæ¥å—å¤šç§ä¸åŒçš„XMLå†…å®¹ç±»å‹ä»¥åŠapplication/jsonã€‚è¿™æ ·æœåŠ¡å™¨ç«¯åœ¨å†³å®šé‡‡ç”¨å“ªç§æ ¼å¼è¿”å›èµ„æºæ—¶ï¼Œå°±æœ‰å¾ˆå¤§çš„å¯é€‰ç©ºé—´ã€‚å‡è®¾æˆ‘ä»¬å¸Œæœ›æœåŠ¡ç«¯ä»¥JSONæ ¼å¼å‘é€èµ„æºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å°†â€œapplication/jsonâ€è®¾ç½®ä¸ºAcceptå¤´ä¿¡æ¯çš„å”¯ä¸€å€¼ã€‚</p>
<p>è®¾ç½®è¯·æ±‚å¤´ä¿¡æ¯æ˜¯å¾ˆç®€å•çš„ï¼Œåªéœ€æ„é€ å‘é€ç»™exchange()æ–¹æ³•çš„HttpEntityå¯¹è±¡å³å¯ï¼ŒHttpEntityä¸­åŒ…å«æ‰¿è½½å¤´ä¿¡æ¯çš„MultiValueMapï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MultiValue&lt;String, String&gt; headers = <span class="keyword">new</span> LinkedMultiValue&lt;String, String&gt;();headers.add(<span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;application/json&quot;</span>);HttpEntity&lt;Object&gt; requestEntity = <span class="keyword">new</span> HttpEntity&lt;Object&gt;(headers);</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªLinkedMultiValueMapå¹¶æ·»åŠ å€¼ä¸ºâ€œapplication/jsonâ€çš„Acceptå¤´ä¿¡æ¯ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªHttpEntityï¼ˆä½¿ç”¨Objectæ³›å‹ç±»å‹ï¼‰ï¼Œå°†MultiValueMapä½œä¸ºæ„é€ å‚æ•°ä¼ å…¥ã€‚å¦‚æœè¿™æ˜¯ä¸€ä¸ªPUTæˆ–POSTè¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºHttpEntityè®¾ç½®åœ¨è¯·æ±‚ä½“ä¸­å‘é€çš„å¯¹è±¡â€”â€”å¯¹äºGETè¯·æ±‚æ¥è¯´ï¼Œè¿™æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥HttpEntityæ¥è°ƒç”¨exchange()ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ResponseEntity&lt;Spitter&gt; response = rest.exchange(  <span class="string">&quot;http://localhost:8080/spittr-api/spitters/&#123;spitter&#125;&quot;</span>,  HttpMethod.GET, requestEntity, Spitter.class, spitterId);Spitter spitter = response.getBody();</span><br></pre></td></tr></table></figure>

<p>è¡¨é¢ä¸Šçœ‹ï¼Œç»“æœæ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬å¾—åˆ°äº†è¯·æ±‚çš„Spitterå¯¹è±¡ã€‚ä½†åœ¨è¡¨é¢ä¹‹ä¸‹ï¼Œè¯·æ±‚å°†ä¼šå¸¦æœ‰å¦‚ä¸‹çš„å¤´ä¿¡æ¯å‘é€ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /Spitter/spitters/habuma HTTP/1.1Accept: application/jsonContent-Length: 0User-Agent: Java/1.6.0_20Host: localhost:8080Connection: keep-alive</span><br></pre></td></tr></table></figure>

<p>å‡è®¾æœåŠ¡å™¨ç«¯èƒ½å¤Ÿå°†Spitteråºåˆ—åŒ–ä¸ºJSONï¼Œå“åº”ä½“å°†ä¼šä»¥JSONæ ¼å¼æ¥è¿›è¡Œè¡¨è¿°ã€‚</p>
<h3 id="å°ç»“-15"><a href="#å°ç»“-15" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>RESTfulæ¶æ„ä½¿ç”¨Webæ ‡å‡†æ¥é›†æˆåº”ç”¨ç¨‹åºï¼Œä½¿å¾—äº¤äº’å˜å¾—ç®€å•è‡ªç„¶ã€‚ç³»ç»Ÿä¸­çš„èµ„æºé‡‡ç”¨URLè¿›è¡Œæ ‡è¯†ï¼Œä½¿ç”¨HTTPæ–¹æ³•è¿›è¡Œç®¡ç†å¹¶ä¸”ä¼šä»¥ä¸€ç§æˆ–å¤šç§é€‚åˆå®¢æˆ·ç«¯çš„æ–¹å¼æ¥è¿›è¡Œè¡¨è¿°ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•ç¼–å†™å“åº”RESTfulèµ„æºç®¡ç†è¯·æ±‚çš„SpringMVCæ§åˆ¶å™¨ã€‚å€ŸåŠ©å‚æ•°åŒ–çš„URLæ¨¡å¼å¹¶å°†æ§åˆ¶å™¨å¤„ç†æ–¹æ³•ä¸ç‰¹å®šçš„HTTPæ–¹æ³•å…³è”ï¼Œæ§åˆ¶å™¨èƒ½å¤Ÿå“åº”å¯¹èµ„æºçš„GETã€POSTã€PUTä»¥åŠDELETEè¯·æ±‚ã€‚</p>
<p>ä¸ºäº†å“åº”è¿™äº›è¯·æ±‚ï¼ŒSpringèƒ½å¤Ÿå°†èµ„æºèƒŒåçš„æ•°æ®ä»¥æœ€é€‚åˆå®¢æˆ·ç«¯çš„å½¢å¼å±•ç°ã€‚å¯¹äºåŸºäºè§†å›¾çš„å“åº”ï¼ŒContentNegotiatingViewResolverèƒ½å¤Ÿåœ¨å¤šä¸ªè§†å›¾è§£æå™¨<br>äº§ç”Ÿçš„è§†å›¾ä¸­é€‰æ‹©å‡ºæœ€é€‚åˆå®¢æˆ·ç«¯æœŸæœ›å†…å®¹ç±»å‹çš„é‚£ä¸€ä¸ªã€‚æˆ–è€…ï¼Œæ§åˆ¶å™¨çš„å¤„ç†æ–¹æ³•å¯ä»¥å€ŸåŠ©@ResponseBodyæ³¨è§£å®Œå…¨ç»•è¿‡è§†å›¾è§£æï¼Œå¹¶ä½¿ç”¨ä¿¡æ¯è½¬æ¢å™¨å°†è¿”å›å€¼è½¬æ¢ä¸ºå®¢æˆ·ç«¯çš„å“åº”ã€‚</p>
<p>REST APIä¸ºå®¢æˆ·ç«¯æš´éœ²äº†åº”ç”¨çš„åŠŸèƒ½ï¼Œå®ƒä»¬æš´éœ²åŠŸèƒ½çš„æ–¹å¼ææ€•æœ€åŸå§‹çš„APIè®¾è®¡è€…åšæ¢¦éƒ½æƒ³ä¸åˆ°ã€‚REST APIçš„å®¢æˆ·ç«¯é€šå¸¸æ˜¯ç§»åŠ¨åº”ç”¨æˆ–è¿è¡Œåœ¨Webæµè§ˆå™¨ä¸­çš„JavaScriptã€‚ä½†æ˜¯ï¼ŒSpringåº”ç”¨ä¹Ÿå¯ä»¥å€ŸåŠ©RestTemplateæ¥ä½¿ç”¨è¿™äº›APIã€‚</p>
<p>RESTåªæ˜¯åº”ç”¨é—´é€šä¿¡çš„æ–¹æ³•ä¹‹ä¸€ï¼Œåœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå­¦ä¹ å¦‚ä½•åœ¨Springåº”ç”¨ä¸­å€ŸåŠ©æ¶ˆæ¯å®ç°å¼‚æ­¥é€šä¿¡ã€‚</p>
<h2 id="Spring-æ¶ˆæ¯"><a href="#Spring-æ¶ˆæ¯" class="headerlink" title="Spring æ¶ˆæ¯"></a>Spring æ¶ˆæ¯</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>å¼‚æ­¥æ¶ˆæ¯ç®€ä»‹</li>
<li>åŸºäºJMSçš„æ¶ˆæ¯åŠŸèƒ½</li>
<li>ä½¿ç”¨Springå’ŒAMQPå‘é€æ¶ˆæ¯</li>
<li>æ¶ˆæ¯é©±åŠ¨çš„POJO</li>
</ul>
<p>åœ¨æ˜ŸæœŸäº”ä¸‹åˆ4ç‚¹55åˆ†ï¼Œå†æœ‰å‡ åˆ†é’Ÿä½ å°±å¯ä»¥å¼€å§‹ä¼‘å‡äº†ã€‚ç°åœ¨ï¼Œä½ çš„æ—¶é—´åªå¤Ÿå¼€è½¦åˆ°æœºåœºèµ¶ä¸Šèˆªç­äº†ã€‚ä½†æ˜¯åœ¨ä½ æ‰“åŒ…ç¦»å¼€ä¹‹å‰ï¼Œä½ éœ€è¦ç¡®å®šè€æ¿å’ŒåŒäº‹äº†è§£ä½ ç›®å‰çš„å·¥ä½œè¿›å±•ï¼Œè¿™æ ·ä»–ä»¬å°±å¯ä»¥åœ¨æ˜ŸæœŸä¸€ç»§ç»­å®Œæˆä½ ç•™ä¸‹çš„å·¥ä½œã€‚ä¸è¿‡ï¼Œä½ çš„ä¸€äº›åŒäº‹å·²ç»æå‰ç¦»å¼€è¿‡å‘¨æœ«å»äº†ï¼Œè€Œä½ çš„è€æ¿æ­£åœ¨å¿™äºå¼€ä¼šã€‚ä½ è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>ä½ å¯ä»¥ç»™è€æ¿æ‰“ç”µè¯ï¼Œä½†æ˜¯è¿™æ ·åšå°±ä¼šå› ä¸ºä¸€ä¸ªä¸é‡è¦çš„çŠ¶æ€æŠ¥å‘Šè€Œé€ æˆä¸å¿…è¦çš„ä¼šè®®ä¸­æ–­ã€‚æˆ–è®¸ä½ å¯ä»¥å†åšæŒä¸€ä¼šï¼Œç­‰åˆ°ä¼šè®®ç»“æŸã€‚ä½†æ˜¯ä»¤äººéƒé—·çš„æ˜¯ï¼Œä½ æ ¹æœ¬ä¸çŸ¥é“ä¼šè®®è¿˜è¦æŒç»­å¤šé•¿æ—¶é—´ï¼Œè€Œä½ åˆè¦èµ¶é£æœºã€‚æˆ–è€…ï¼Œä½ å¯ä»¥åœ¨ä»–çš„æ˜¾ç¤ºå™¨ä¸Šç•™ä¸€ä¸ªä¾¿æ¡ï¼Œä¸è¿‡è¦å’Œå…¶ä»–çš„100ä¸ªä¾¿æ¡è´´åœ¨ä¸€èµ·ã€‚è¦æƒ³æ—¢ä¼ è¾¾åˆ°ä½ çš„å·¥ä½œçŠ¶æ€åˆèƒ½èµ¶ä¸Šé£æœºï¼Œæœ€æœ‰æ•ˆçš„æ–¹å¼å°±æ˜¯å‘é€ä¸€å°ç”µå­é‚®ä»¶ç»™ä½ çš„è€æ¿å’ŒåŒäº‹ï¼Œè¯¦è¿°å·¥ä½œè¿›å±•å¹¶ä¸”æ‰¿è¯ºç»™ä»–ä»¬å¯„å¼ æ˜ä¿¡ç‰‡ã€‚ä½ ä¸çŸ¥é“ä»–ä»¬åœ¨å“ªé‡Œï¼Œä¹Ÿä¸çŸ¥é“ä»–ä»¬ä»€ä¹ˆæ—¶å€™æ‰èƒ½çœŸæ­£è¯»åˆ°ä½ çš„é‚®ä»¶ã€‚ä½†æ˜¯ä½ çŸ¥é“ï¼Œä»–ä»¬ç»ˆç©¶ä¼šå›åˆ°ä»–ä»¬çš„åŠå…¬æ¡Œæ—ï¼Œé˜…è¯»ä½ çš„é‚®ä»¶ã€‚è€Œæ­¤æ—¶ï¼Œä½ æ­£åœ¨èµ¶å¾€æœºåœºçš„è·¯ä¸Šã€‚</p>
<p>æœ‰äº›æ—¶å€™ï¼Œéœ€è¦ç›´æ¥å’ŒæŸäº›äººäº¤è°ˆã€‚å¦‚æœä½ å—ä¼¤äº†ï¼Œéœ€è¦æ•‘æŠ¤è½¦ï¼Œä½ å¯èƒ½ä¼šæ‹¿èµ·ç”µè¯â€”â€”è€Œä¸ä¼šç»™åŒ»é™¢å‘ç”µå­é‚®ä»¶ã€‚ä¸è¿‡ï¼Œåœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œå‘é€æ¶ˆæ¯å°±å¯ä»¥æ»¡è¶³è¦æ±‚ï¼Œå¹¶ä¸”è·Ÿç›´æ¥é€šä¿¡ç›¸æ¯”æ›´å…·æœ‰ä¸€äº›ä¼˜åŠ¿ï¼Œä¾‹å¦‚å¯ä»¥è®©ä½ ç»§ç»­ä½ çš„å‡æœŸã€‚</p>
<p>åœ¨å‰é¢çš„ä¸€äº›ç« ä¸­ï¼Œä½ çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨RMIã€Hessianã€Burlapã€HTTPinvokerå’ŒWebæœåŠ¡åœ¨åº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚æ‰€æœ‰è¿™äº›é€šä¿¡æœºåˆ¶éƒ½æ˜¯åŒæ­¥çš„ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºç›´æ¥ä¸è¿œç¨‹æœåŠ¡ç›¸äº¤äº’ï¼Œå¹¶ä¸”ä¸€ç›´ç­‰åˆ°è¿œç¨‹è¿‡ç¨‹å®Œæˆåæ‰ç»§ç»­æ‰§è¡Œã€‚</p>
<p>åŒæ­¥é€šä¿¡æœ‰å®ƒè‡ªå·±çš„é€‚ç”¨åœºæ™¯ã€‚ä¸è¿‡ï¼Œå¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œè¿™ç§é€šä¿¡æ–¹å¼å¹¶ä¸æ˜¯åº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œäº¤äº’çš„å”¯ä¸€æ–¹å¼ã€‚å¼‚æ­¥æ¶ˆæ¯æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºå‘å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºé—´æ¥å‘é€æ¶ˆæ¯çš„ä¸€ç§æ–¹å¼ï¼Œè¿™ç§æ–¹å¼æ— éœ€ç­‰å¾…å¯¹æ–¹çš„å“åº”ã€‚ç›¸å¯¹äºåŒæ­¥æ¶ˆæ¯ï¼Œå¼‚æ­¥æ¶ˆæ¯å…·æœ‰å¤šä¸ªä¼˜åŠ¿ï¼Œå…³äºè¿™ä¸€ç‚¹ä½ å¾ˆå¿«å°±ä¼šçœ‹åˆ°ã€‚</p>
<p>å€ŸåŠ©Springï¼Œæˆ‘ä»¬æœ‰å¤šä¸ªå®ç°å¼‚æ­¥æ¶ˆæ¯çš„å¯é€‰æ–¹æ¡ˆã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•åœ¨Springä¸­ä½¿ç”¨Javaæ¶ˆæ¯æœåŠ¡ï¼ˆJava Message Serviceï¼ŒJMSï¼‰å’Œé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼ˆAdvanced Message Queuing Protocolï¼ŒAMQPï¼‰å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚é™¤äº†åŸºæœ¬çš„æ¶ˆæ¯å‘é€å’Œæ¥æ”¶ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜ä¼šçœ‹åˆ°Springå¯¹æ¶ˆæ¯é©±åŠ¨POJOçš„æ”¯æŒï¼Œå®ƒæ˜¯ä¸€ç§ä¸EJBçš„æ¶ˆæ¯é©±åŠ¨Beanï¼ˆmessage-driven beanï¼ŒMDBï¼‰ç±»ä¼¼çš„æ¶ˆæ¯æ¥æ”¶æ–¹å¼ã€‚</p>
<h3 id="å¼‚æ­¥æ¶ˆæ¯ç®€ä»‹"><a href="#å¼‚æ­¥æ¶ˆæ¯ç®€ä»‹" class="headerlink" title="å¼‚æ­¥æ¶ˆæ¯ç®€ä»‹"></a>å¼‚æ­¥æ¶ˆæ¯ç®€ä»‹</h3><p>ä¸å‰é¢å‡ ç« ä¸­ä»‹ç»çš„è¿œç¨‹è°ƒç”¨æœºåˆ¶ä»¥åŠRESTæ¥å£ç±»ä¼¼ï¼Œå¼‚æ­¥æ¶ˆæ¯ä¹Ÿæ˜¯ç”¨äºåº”ç”¨ç¨‹åºä¹‹é—´é€šä¿¡çš„ã€‚ä½†æ˜¯ï¼Œåœ¨ç³»ç»Ÿä¹‹é—´ä¼ é€’ä¿¡æ¯çš„æ–¹å¼ä¸Šï¼Œå®ƒä¸å…¶ä»–æœºåˆ¶æœ‰æ‰€ä¸åŒã€‚</p>
<p>åƒRMIå’ŒHessian/Burlapè¿™æ ·çš„è¿œç¨‹è°ƒç”¨æœºåˆ¶æ˜¯åŒæ­¥çš„ã€‚å¦‚å›¾17.1æ‰€ç¤ºï¼Œå½“å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹æ–¹æ³•æ—¶ï¼Œå®¢æˆ·ç«¯å¿…é¡»ç­‰åˆ°è¿œç¨‹æ–¹æ³•å®Œæˆåï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚å³ä½¿è¿œç¨‹æ–¹æ³•ä¸å‘å®¢æˆ·ç«¯è¿”å›ä»»ä½•ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯ä¹Ÿè¦è¢«é˜»å¡ç›´åˆ°æœåŠ¡å®Œæˆã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211112102523995.png" alt="image-20211112102523995"></p>
<p>å›¾17.1ã€€å¦‚æœé€šä¿¡æ˜¯åŒæ­¥çš„ï¼Œå®¢æˆ·ç«¯å¿…é¡»ç­‰å¾…æœåŠ¡å®Œæˆ</p>
<p>æ¶ˆæ¯åˆ™æ˜¯å¼‚æ­¥å‘é€çš„ï¼Œå¦‚å›¾17.2æ‰€ç¤ºï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦ç­‰å¾…æœåŠ¡å¤„ç†æ¶ˆæ¯ï¼Œç”šè‡³ä¸éœ€è¦ç­‰å¾…æ¶ˆæ¯æŠ•é€’å®Œæˆã€‚å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œç„¶åç»§ç»­æ‰§è¡Œï¼Œè¿™æ˜¯å› ä¸ºå®¢æˆ·ç«¯å‡å®šæœåŠ¡æœ€ç»ˆå¯ä»¥æ”¶åˆ°å¹¶å¤„ç†è¿™æ¡æ¶ˆæ¯ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211112102531982.png" alt="image-20211112102531982"></p>
<p>å›¾17.2ã€€å¼‚æ­¥é€šä¿¡æ˜¯ä¸€ç§ä¸éœ€è¦ç­‰å¾…çš„é€šä¿¡å½¢å¼</p>
<p>ç›¸å¯¹äºåŒæ­¥é€šä¿¡ï¼Œå¼‚æ­¥é€šä¿¡å…·æœ‰å¤šé¡¹ä¼˜åŠ¿ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±ä¼šçœ‹åˆ°è¿™äº›ä¼˜ç‚¹ã€‚ä½†æ˜¯é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å¼‚æ­¥å‘é€æ¶ˆæ¯ã€‚</p>
<h4 id="å‘é€æ¶ˆæ¯"><a href="#å‘é€æ¶ˆæ¯" class="headerlink" title="å‘é€æ¶ˆæ¯"></a>å‘é€æ¶ˆæ¯</h4><p>å¤§å¤šæ•°äººéƒ½ä½¿ç”¨è¿‡é‚®æ”¿æœåŠ¡ã€‚æ¯å¤©ä¼šæœ‰æ•°ç™¾ä¸‡ä¿¡ä»¶ã€æ˜ä¿¡ç‰‡å’ŒåŒ…è£¹äº¤åˆ°é‚®é€’å‘˜æ‰‹ä¸Šï¼Œæˆ‘ä»¬ç›¸ä¿¡è‡ªå·±é‚®å¯„çš„ä¸œè¥¿ä¼šè¢«é€åˆ°ç›®çš„åœ°ã€‚ä¸–ç•Œå®åœ¨æ˜¯å¤ªå¤§äº†ï¼Œæˆ‘ä»¬æ— æ³•è‡ªå·±å»è¿é€è¿™äº›ä¸œè¥¿ï¼Œå› æ­¤æˆ‘ä»¬ä¾èµ–é‚®æ”¿ç³»ç»Ÿä¸ºæˆ‘ä»¬è¿é€ã€‚æˆ‘ä»¬åœ¨ä¿¡å°ä¸Šå†™æ˜åœ°å€ï¼Œè´´å¼ é‚®ç¥¨ï¼Œæ¥ç€æŠŠå®ƒä»¬æŠ•åˆ°ä¿¡ç®±é‡Œï¼Œè€Œä¸éœ€è¦è€ƒè™‘ä¿¡ä»¶å¦‚ä½•åˆ°è¾¾ç›®çš„åœ°ã€‚</p>
<p>é‚®æ”¿æœåŠ¡çš„å…³é”®åœ¨äºé—´æ¥æ€§ã€‚å½“å¥¶å¥¶çš„ç”Ÿæ—¥åˆ°æ¥æ—¶ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥é€ç»™å¥¹ä¸€å¼ è´ºå¡ï¼Œè¿™éå¸¸ä¸æ–¹ä¾¿ã€‚æˆ‘ä»¬å¿…é¡»ç•™å‡ºå‡ å°æ—¶ç”šè‡³æ˜¯å‡ å¤©çš„æ—¶é—´å»ä¸ºå¥¹é€ç”Ÿæ—¥è´ºå¡ï¼Œè¿™å–å†³äºå¥¹ä½å“ªé‡Œã€‚å¹¸è¿çš„æ˜¯ï¼Œé‚®å±€å¯ä»¥å°†è´ºå¡é€åˆ°å¥¶å¥¶é‚£é‡Œï¼Œè€Œæˆ‘ä»¬å¯ä»¥ç»§ç»­è‡ªå·±çš„ç”Ÿæ´»ã€‚</p>
<p>ä¸æ­¤ç±»ä¼¼ï¼Œé—´æ¥æ€§ä¹Ÿæ˜¯å¼‚æ­¥æ¶ˆæ¯çš„å…³é”®æ‰€åœ¨ã€‚å½“ä¸€ä¸ªåº”ç”¨å‘å¦ä¸€ä¸ªåº”ç”¨å‘é€æ¶ˆæ¯æ—¶ï¼Œä¸¤ä¸ªåº”ç”¨ä¹‹é—´æ²¡æœ‰ç›´æ¥çš„è”ç³»ã€‚ç›¸åçš„æ˜¯ï¼Œå‘é€æ–¹çš„åº”ç”¨ç¨‹åºä¼šå°†æ¶ˆæ¯äº¤ç»™ä¸€ä¸ªæœåŠ¡ï¼Œç”±æœåŠ¡ç¡®ä¿å°†æ¶ˆæ¯æŠ•é€’ç»™æ¥æ”¶æ–¹åº”ç”¨ç¨‹åºã€‚</p>
<p>åœ¨å¼‚æ­¥æ¶ˆæ¯ä¸­æœ‰ä¸¤ä¸ªä¸»è¦çš„æ¦‚å¿µï¼šæ¶ˆæ¯ä»£ç†ï¼ˆmessage brokerï¼‰å’Œç›®çš„åœ°ï¼ˆdestinationï¼‰ã€‚å½“ä¸€ä¸ªåº”ç”¨å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šå°†æ¶ˆæ¯äº¤ç»™ä¸€ä¸ªæ¶ˆæ¯ä»£ç†ã€‚æ¶ˆæ¯ä»£ç†å®é™…ä¸Šç±»ä¼¼äºé‚®å±€ã€‚æ¶ˆæ¯ä»£ç†å¯ä»¥ç¡®ä¿æ¶ˆæ¯è¢«æŠ•é€’åˆ°æŒ‡å®šçš„ç›®çš„åœ°ï¼ŒåŒæ—¶è§£æ”¾å‘é€è€…ï¼Œä½¿å…¶èƒ½å¤Ÿç»§ç»­è¿›è¡Œå…¶ä»–çš„ä¸šåŠ¡ã€‚</p>
<p>å½“æˆ‘ä»¬é€šè¿‡é‚®å±€é‚®é€’ä¿¡ä»¶æ—¶ï¼Œæœ€é‡è¦çš„æ˜¯è¦å†™ä¸Šåœ°å€ï¼Œè¿™æ ·é‚®å±€å°±å¯ä»¥çŸ¥é“è¿™å°ä¿¡åº”è¯¥è¢«æŠ•é€’åˆ°å“ªé‡Œã€‚ä¸æ­¤ç±»ä¼¼ï¼Œæ¯æ¡å¼‚æ­¥æ¶ˆæ¯éƒ½å¸¦æœ‰ä¸€ä¸ªç›®çš„åœ°ï¼Œç›®çš„åœ°å°±å¥½åƒä¸€ä¸ªé‚®ç®±ï¼Œå¯ä»¥å°†æ¶ˆæ¯æ”¾å…¥è¿™ä¸ªé‚®ç®±ï¼Œç›´åˆ°æœ‰äººå°†å®ƒä»¬å–èµ°ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¹¶ä¸åƒä¿¡ä»¶åœ°å€é‚£æ ·å¿…é¡»æ ‡è¯†ç‰¹å®šçš„æ”¶ä»¶äººæˆ–è¡—é“åœ°å€ï¼Œæ¶ˆæ¯ä¸­çš„ç›®çš„åœ°ç›¸å¯¹æ¥è¯´å¹¶ä¸é‚£ä¹ˆå…·ä½“ã€‚ç›®çš„åœ°åªå…³æ³¨æ¶ˆæ¯åº”è¯¥ä»å“ªé‡Œè·å¾—â€”â€”è€Œä¸å…³å¿ƒæ˜¯ç”±è°å–èµ°æ¶ˆæ¯çš„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œç›®çš„åœ°å°±å¦‚åŒä¿¡ä»¶çš„åœ°å€ä¸ºâ€œæœ¬åœ°å±…æ°‘â€ã€‚</p>
<p>å°½ç®¡ä¸åŒçš„æ¶ˆæ¯ç³»ç»Ÿä¼šæä¾›ä¸åŒçš„æ¶ˆæ¯è·¯ç”±æ¨¡å¼ï¼Œä½†æ˜¯æœ‰ä¸¤ç§é€šç”¨çš„ç›®çš„åœ°ï¼šé˜Ÿåˆ—ï¼ˆqueueï¼‰å’Œä¸»é¢˜ï¼ˆtopicï¼‰ã€‚æ¯ç§ç±»å‹éƒ½ä¸ç‰¹å®šçš„æ¶ˆæ¯æ¨¡å‹ç›¸å…³è”ï¼Œåˆ†åˆ«æ˜¯ç‚¹å¯¹ç‚¹æ¨¡å‹ï¼ˆé˜Ÿåˆ—ï¼‰å’Œå‘å¸ƒ/è®¢é˜…æ¨¡å‹ï¼ˆä¸»é¢˜ï¼‰ã€‚</p>
<p>ç‚¹å¯¹ç‚¹æ¶ˆæ¯æ¨¡å‹</p>
<p>åœ¨ç‚¹å¯¹ç‚¹æ¨¡å‹ä¸­ï¼Œæ¯ä¸€æ¡æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå‘é€è€…å’Œä¸€ä¸ªæ¥æ”¶è€…ï¼Œå¦‚å›¾17.3æ‰€ç¤ºã€‚å½“æ¶ˆæ¯ä»£ç†å¾—åˆ°æ¶ˆæ¯æ—¶ï¼Œå®ƒå°†æ¶ˆæ¯æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚å½“æ¥æ”¶è€…è¯·æ±‚é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œæ¶ˆæ¯ä¼šä»é˜Ÿåˆ—ä¸­å–å‡ºï¼Œå¹¶æŠ•é€’ç»™æ¥æ”¶è€…ã€‚å› ä¸ºæ¶ˆæ¯æŠ•é€’åä¼šä»é˜Ÿåˆ—ä¸­åˆ é™¤ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯æ¶ˆæ¯åªèƒ½æŠ•é€’ç»™ä¸€ä¸ªæ¥æ”¶è€…ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211112102601892.png" alt="image-20211112102601892"></p>
<p>å›¾17.3ã€€æ¶ˆæ¯é˜Ÿåˆ—å¯¹æ¶ˆæ¯å‘é€è€…å’Œæ¶ˆæ¯æ¥æ”¶è€…è¿›è¡Œäº†è§£è€¦ã€‚</p>
<p>è™½ç„¶é˜Ÿåˆ—å¯ä»¥æœ‰å¤šä¸ªæ¥æ”¶è€…ï¼Œä½†æ˜¯æ¯ä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¥æ”¶è€…å–èµ°å°½ç®¡æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¯ä¸€æ¡æ¶ˆæ¯åªè¢«æŠ•é€’ç»™ä¸€ä¸ªæ¥æ”¶è€…ï¼Œä½†æ˜¯å¹¶ä¸æ„å‘³ç€åªèƒ½ä½¿ç”¨ä¸€ä¸ªæ¥æ”¶è€…ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ã€‚äº‹å®ä¸Šï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨å‡ ä¸ªæ¥æ”¶è€…æ¥å¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚ä¸è¿‡ï¼Œæ¯ä¸ªæ¥æ”¶è€…éƒ½ä¼šå¤„ç†è‡ªå·±æ‰€æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚</p>
<p>è¿™ä¸åœ¨é“¶è¡Œæ’é˜Ÿç­‰å€™ç±»ä¼¼ã€‚åœ¨ç­‰å¾…æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½æ³¨æ„åˆ°å¾ˆå¤šé“¶è¡ŒæŸœå‘˜éƒ½å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¤„ç†é‡‘èä¸šåŠ¡ã€‚åœ¨æŸœå‘˜å¸®åŠ©å®¢æˆ·å®Œæˆä¸šåŠ¡åï¼Œå¥¹å°±ç©ºé—²äº†ï¼Œæ­¤æ—¶ï¼Œå¥¹ä¼šè¦æ±‚æ’é˜Ÿç­‰å€™çš„ä¸‹ä¸€ä¸ªäººå‰æ¥åŠç†ä¸šåŠ¡ã€‚å¦‚æœæˆ‘ä»¬æ’åœ¨é˜Ÿä¼çš„æœ€å‰è¾¹æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šè¢«å«åˆ°ï¼Œç„¶åç”±å…¶ä¸­çš„ä¸€ä¸ªç©ºé—²æŸœå‘˜æ¥å¸®åŠ©æˆ‘ä»¬å¤„ç†ä¸šåŠ¡ï¼Œè€Œå…¶ä»–çš„æŸœå‘˜åˆ™ä¼šå¸®åŠ©å…¶ä»–çš„é“¶è¡Œå®¢æˆ·ã€‚</p>
<p>ä»å¦ä¸€ä¸ªè§’åº¦çœ‹ï¼Œæˆ‘ä»¬åœ¨é“¶è¡Œæ’é˜Ÿæ—¶ï¼Œå¹¶ä¸çŸ¥é“å“ªä¸€ä¸ªæŸœå‘˜ä¼šå¸®åŠ©æˆ‘ä»¬åŠç†ä¸šåŠ¡ã€‚æˆ‘ä»¬å¯ä»¥è®¡ç®—é˜Ÿä¼ä¸­æœ‰å¤šå°‘äººï¼Œä¸æŸœå‘˜çš„æ•°ç›®è¿›è¡Œæ¯”è¾ƒï¼Œæ³¨æ„å“ªä¸€ä¸ªæŸœå‘˜ä¸šåŠ¡åŠç†é€Ÿåº¦æœ€å¿«ï¼Œç„¶åçŒœæµ‹ä¼šç”±å“ªä¸€ä¸ªæŸœå‘˜åŠç†æˆ‘ä»¬çš„ä¸šåŠ¡ã€‚ä½†æ˜¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¼šçŒœé”™ï¼Œæœ€ç»ˆä¼šç”±å¦ä¸€ä¸ªæŸœå‘˜æ¥åŠç†ã€‚</p>
<p>åŒæ ·ï¼Œåœ¨ç‚¹å¯¹ç‚¹çš„æ¶ˆæ¯ä¸­ï¼Œå¦‚æœæœ‰å¤šä¸ªæ¥æ”¶è€…ç›‘å¬é˜Ÿåˆ—ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•çŸ¥é“æŸæ¡ç‰¹å®šçš„æ¶ˆæ¯ä¼šç”±å“ªä¸€ä¸ªæ¥æ”¶è€…å¤„ç†ã€‚è¿™ç§ä¸ç¡®å®šæ€§å®é™…ä¸Šæœ‰å¾ˆå¤šå¥½å¤„ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦ç®€å•åœ°ä¸ºé˜Ÿåˆ—æ·»åŠ æ–°çš„ç›‘å¬å™¨å°±èƒ½æé«˜åº”ç”¨çš„æ¶ˆæ¯å¤„ç†èƒ½åŠ›ã€‚</p>
<p>å‘å¸ƒâ€”è®¢é˜…æ¶ˆæ¯æ¨¡å‹</p>
<p>åœ¨å‘å¸ƒâ€”è®¢é˜…æ¶ˆæ¯æ¨¡å‹ä¸­ï¼Œæ¶ˆæ¯ä¼šå‘é€ç»™ä¸€ä¸ªä¸»é¢˜ã€‚ä¸é˜Ÿåˆ—ç±»ä¼¼ï¼Œå¤šä¸ªæ¥æ”¶è€…éƒ½å¯ä»¥ç›‘å¬ä¸€ä¸ªä¸»é¢˜ã€‚ä½†æ˜¯ï¼Œä¸é˜Ÿåˆ—ä¸åŒçš„æ˜¯ï¼Œæ¶ˆæ¯ä¸å†æ˜¯åªæŠ•é€’ç»™ä¸€ä¸ªæ¥æ”¶è€…ï¼Œè€Œæ˜¯ä¸»é¢˜çš„æ‰€æœ‰è®¢é˜…è€…éƒ½ä¼šæ¥æ”¶åˆ°æ­¤æ¶ˆæ¯çš„å‰¯æœ¬ï¼Œå¦‚å›¾17.4æ‰€ç¤ºã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211112102611775.png" alt="image-20211112102611775"></p>
<p>å›¾17.4ã€€ä¸é˜Ÿåˆ—ç±»ä¼¼ï¼Œä¸»é¢˜å¯ä»¥å°†æ¶ˆæ¯å‘é€è€…ä¸æ¶ˆæ¯æ¥æ”¶è€…è¿›è¡Œè§£è€¦ã€‚ä¸é˜Ÿåˆ—ä¸åŒçš„æ˜¯ï¼Œä¸»é¢˜æ¶ˆæ¯å¯ä»¥å‘é€ç»™å¤šä¸ªä¸»é¢˜è®¢é˜…è€…</p>
<p>æ­£å¦‚å®ƒçš„åå­—æ‰€æš—ç¤ºçš„ï¼Œå‘å¸ƒâ€”è®¢é˜…æ¶ˆæ¯æ¨¡å‹ä¸æ‚å¿—å‘è¡Œå•†å’Œæ‚å¿—è®¢é˜…è€…å¾ˆç›¸ä¼¼ã€‚æ‚å¿—ï¼ˆæ¶ˆæ¯ï¼‰å‡ºç‰ˆåï¼Œå‘é€ç»™é‚®å±€ï¼Œç„¶åæ‰€æœ‰çš„è®¢é˜…è€…éƒ½ä¼šæ”¶åˆ°æ‚å¿—çš„å‰¯æœ¬ã€‚</p>
<p>æ‚å¿—çš„ç±»æ¯”å°±åˆ°æ­¤ä¸ºè‡³ï¼Œå› ä¸ºå¯¹äºå¼‚æ­¥æ¶ˆæ¯æ¥è®²ï¼Œå‘å¸ƒè€…å¹¶ä¸çŸ¥é“è°è®¢é˜…äº†å®ƒçš„æ¶ˆæ¯ã€‚å‘å¸ƒè€…åªçŸ¥é“å®ƒçš„æ¶ˆæ¯è¦å‘é€åˆ°ä¸€ä¸ªç‰¹å®šçš„ä¸»é¢˜â€”â€”è€Œä¸çŸ¥é“æœ‰è°åœ¨ç›‘å¬è¿™ä¸ªä¸»é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‘å¸ƒè€…å¹¶ä¸çŸ¥é“æ¶ˆæ¯æ˜¯å¦‚ä½•è¢«å¤„ç†çš„ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»äº†å¼‚æ­¥æ¶ˆæ¯çš„åŸºæœ¬æ¦‚å¿µï¼Œä¸‹é¢è®©æˆ‘ä»¬çœ‹çœ‹å®ƒä¸åŒæ­¥RPCçš„å¯¹æ¯”ã€‚</p>
<h4 id="è¯„ä¼°å¼‚æ­¥æ¶ˆæ¯çš„ä¼˜ç‚¹"><a href="#è¯„ä¼°å¼‚æ­¥æ¶ˆæ¯çš„ä¼˜ç‚¹" class="headerlink" title="è¯„ä¼°å¼‚æ­¥æ¶ˆæ¯çš„ä¼˜ç‚¹"></a>è¯„ä¼°å¼‚æ­¥æ¶ˆæ¯çš„ä¼˜ç‚¹</h4><p>è™½ç„¶åŒæ­¥é€šä¿¡æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå»ºç«‹èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œä½†æ˜¯é‡‡ç”¨åŒæ­¥é€šä¿¡æœºåˆ¶è®¿é—®è¿œç¨‹æœåŠ¡çš„å®¢æˆ·ç«¯å­˜åœ¨å‡ ä¸ªé™åˆ¶ï¼Œæœ€ä¸»è¦çš„æ˜¯ï¼š</p>
<ul>
<li>åŒæ­¥é€šä¿¡æ„å‘³ç€ç­‰å¾…ã€‚å½“å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æ–¹æ³•æ—¶ï¼Œå®ƒå¿…é¡»ç­‰å¾…è¿œç¨‹æ–¹æ³•ç»“æŸåæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚å¦‚æœå®¢æˆ·ç«¯ä¸è¿œç¨‹æœåŠ¡é¢‘ç¹é€šä¿¡ï¼Œæˆ–è€…è¿œç¨‹æœåŠ¡å“åº”å¾ˆæ…¢ï¼Œå°±ä¼šå¯¹å®¢æˆ·ç«¯åº”ç”¨çš„æ€§èƒ½å¸¦æ¥è´Ÿé¢å½±å“ã€‚</li>
<li>å®¢æˆ·ç«¯é€šè¿‡æœåŠ¡æ¥å£ä¸è¿œç¨‹æœåŠ¡ç›¸è€¦åˆã€‚å¦‚æœæœåŠ¡çš„æ¥å£å‘ç”Ÿå˜åŒ–ï¼Œæ­¤æœåŠ¡çš„æ‰€æœ‰å®¢æˆ·ç«¯éƒ½éœ€è¦åšç›¸åº”çš„æ”¹å˜ã€‚</li>
<li>å®¢æˆ·ç«¯ä¸è¿œç¨‹æœåŠ¡çš„ä½ç½®è€¦åˆã€‚å®¢æˆ·ç«¯å¿…é¡»é…ç½®æœåŠ¡çš„ç½‘ç»œä½ç½®ï¼Œè¿™æ ·å®ƒæ‰çŸ¥é“å¦‚ä½•ä¸è¿œç¨‹æœåŠ¡è¿›è¡Œäº¤äº’ã€‚å¦‚æœç½‘ç»œæ‹“æ‰‘è¿›è¡Œè°ƒæ•´ï¼Œå®¢æˆ·ç«¯ä¹Ÿéœ€è¦é‡æ–°é…ç½®æ–°çš„ç½‘ç»œä½ç½®ã€‚</li>
<li>å®¢æˆ·ç«¯ä¸æœåŠ¡çš„å¯ç”¨æ€§ç›¸è€¦åˆã€‚å¦‚æœè¿œç¨‹æœåŠ¡ä¸å¯ç”¨ï¼Œå®¢æˆ·ç«¯å®é™…ä¸Šä¹Ÿæ— æ³•æ­£å¸¸è¿è¡Œã€‚</li>
</ul>
<p>è™½ç„¶åŒæ­¥é€šä¿¡ä»ç„¶æœ‰å®ƒçš„é€‚ç”¨åœºæ™¯ï¼Œä½†æ˜¯åœ¨å†³å®šåº”ç”¨ç¨‹åºæ›´é€‚åˆå“ªç§é€šä¿¡æœºåˆ¶æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è€ƒé‡ä»¥ä¸Šçš„è¿™äº›ç¼ºç‚¹ã€‚å¦‚æœè¿™äº›é™åˆ¶æ­£æ˜¯ä½ æ‰€æ‹…å¿ƒçš„ï¼Œé‚£ä½ å¯èƒ½å¾ˆæƒ³çŸ¥é“å¼‚æ­¥é€šä¿¡æ˜¯å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜çš„ã€‚</p>
<p>æ— éœ€ç­‰å¾…</p>
<p>å½“ä½¿ç”¨JMSå‘é€æ¶ˆæ¯æ—¶ï¼Œå®¢æˆ·ç«¯ä¸å¿…ç­‰å¾…æ¶ˆæ¯è¢«å¤„ç†ï¼Œç”šè‡³æ˜¯è¢«æŠ•é€’ã€‚å®¢æˆ·ç«¯åªéœ€è¦å°†æ¶ˆæ¯å‘é€ç»™æ¶ˆæ¯ä»£ç†ï¼Œå°±å¯ä»¥ç¡®ä¿¡æ¶ˆæ¯ä¼šè¢«æŠ•é€’ç»™ç›¸åº”çš„ç›®çš„åœ°ã€‚</p>
<p>å› ä¸ºä¸éœ€è¦ç­‰å¾…ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚è¿™ç§æ–¹å¼å¯ä»¥æœ‰æ•ˆåœ°èŠ‚çœæ—¶é—´ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯çš„æ€§èƒ½èƒ½å¤Ÿæå¤§çš„æé«˜ã€‚</p>
<p>é¢å‘æ¶ˆæ¯å’Œè§£è€¦</p>
<p>ä¸é¢å‘æ–¹æ³•è°ƒç”¨çš„RPCé€šä¿¡ä¸åŒï¼Œå‘é€å¼‚æ­¥æ¶ˆæ¯æ˜¯ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ã€‚è¿™æ„å‘³ç€å®¢æˆ·ç«¯å¹¶æ²¡æœ‰ä¸ç‰¹å®šçš„æ–¹æ³•ç­¾åç»‘å®šã€‚ä»»ä½•å¯ä»¥å¤„ç†æ•°æ®çš„é˜Ÿåˆ—æˆ–ä¸»é¢˜è®¢é˜…è€…éƒ½å¯ä»¥å¤„ç†ç”±å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼Œè€Œå®¢æˆ·ç«¯ä¸å¿…äº†è§£è¿œç¨‹æœåŠ¡çš„ä»»ä½•è§„èŒƒã€‚</p>
<p>ä½ç½®ç‹¬ç«‹</p>
<p>åŒæ­¥RPCæœåŠ¡é€šå¸¸éœ€è¦ç½‘ç»œåœ°å€æ¥å®šä½ã€‚è¿™æ„å‘³ç€å®¢æˆ·ç«¯æ— æ³•çµæ´»åœ°é€‚åº”ç½‘ç»œæ‹“æ‰‘çš„æ”¹å˜ã€‚å¦‚æœæœåŠ¡çš„IPåœ°å€æ”¹å˜äº†ï¼Œæˆ–è€…æœåŠ¡è¢«é…ç½®ä¸ºç›‘å¬å…¶ä»–ç«¯å£ï¼Œå®¢æˆ·ç«¯å¿…é¡»è¿›è¡Œç›¸åº”çš„è°ƒæ•´ï¼Œå¦åˆ™æ— æ³•è®¿é—®æœåŠ¡ã€‚</p>
<p>ä¸ä¹‹ç›¸åï¼Œæ¶ˆæ¯å®¢æˆ·ç«¯ä¸å¿…çŸ¥é“è°ä¼šå¤„ç†å®ƒä»¬çš„æ¶ˆæ¯ï¼Œæˆ–è€…æœåŠ¡çš„ä½ç½®åœ¨å“ªé‡Œã€‚å®¢æˆ·ç«¯åªéœ€è¦äº†è§£éœ€è¦é€šè¿‡å“ªä¸ªé˜Ÿåˆ—æˆ–ä¸»é¢˜æ¥å‘é€æ¶ˆæ¯ã€‚å› æ­¤ï¼Œåªè¦æœåŠ¡èƒ½å¤Ÿä»é˜Ÿåˆ—æˆ–ä¸»é¢˜ä¸­è·å–æ¶ˆæ¯å³å¯ï¼Œæ¶ˆæ¯å®¢æˆ·ç«¯æ ¹æœ¬ä¸éœ€è¦å…³æ³¨æœåŠ¡æ¥è‡ªå“ªé‡Œã€‚</p>
<p>åœ¨ç‚¹å¯¹ç‚¹æ¨¡å‹ä¸­ï¼Œå¯ä»¥åˆ©ç”¨è¿™ç§ä½ç½®çš„ç‹¬ç«‹æ€§æ¥åˆ›å»ºæœåŠ¡çš„é›†ç¾¤ã€‚å¦‚æœå®¢æˆ·ç«¯ä¸çŸ¥é“æœåŠ¡çš„ä½ç½®ï¼Œå¹¶ä¸”æœåŠ¡çš„å”¯ä¸€è¦æ±‚å°±æ˜¯å¯ä»¥è®¿é—®æ¶ˆæ¯ä»£ç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é…ç½®å¤šä¸ªæœåŠ¡ä»åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­æ¥æ”¶æ¶ˆæ¯ã€‚å¦‚æœæœåŠ¡è¿‡è½½ï¼Œå¤„ç†èƒ½åŠ›ä¸è¶³ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€äº›æ–°çš„æœåŠ¡å®ä¾‹æ¥ç›‘å¬ç›¸åŒçš„é˜Ÿåˆ—å°±å¯ä»¥äº†ã€‚</p>
<p>åœ¨å‘å¸ƒ-è®¢é˜…æ¨¡å‹ä¸­ï¼Œä½ç½®ç‹¬ç«‹æ€§ä¼šäº§ç”Ÿå¦ä¸€ç§æœ‰è¶£çš„æ•ˆåº”ã€‚å¤šä¸ªæœåŠ¡å¯ä»¥è®¢é˜…åŒä¸€ä¸ªä¸»é¢˜ï¼Œæ¥æ”¶ç›¸åŒæ¶ˆæ¯çš„å‰¯æœ¬ã€‚ä½†æ˜¯æ¯ä¸€ä¸ªæœåŠ¡å¯¹æ¶ˆæ¯çš„å¤„ç†é€»è¾‘å´å¯èƒ½æœ‰æ‰€ä¸åŒã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ç»„æœåŠ¡å¯ä»¥å…±åŒå¤„ç†æè¿°æ–°å‘˜å·¥ä¿¡æ¯çš„æ¶ˆæ¯ã€‚ä¸€ä¸ªæœåŠ¡å¯èƒ½ä¼šåœ¨å·¥èµ„ç³»ç»Ÿä¸­å¢åŠ è¯¥å‘˜å·¥ï¼Œå¦ä¸€ä¸ªæœåŠ¡åˆ™ä¼šå°†æ–°å‘˜å·¥å¢åŠ åˆ°HRé—¨æˆ·ä¸­ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªæœåŠ¡ä¸ºæ–°å‘˜å·¥åˆ†é…å¯è®¿é—®ç³»ç»Ÿçš„æƒé™ã€‚æ¯ä¸€ä¸ªæœåŠ¡éƒ½åŸºäºç›¸åŒçš„æ•°æ®ï¼ˆéƒ½æ˜¯ä»åŒä¸€ä¸ªä¸»é¢˜æ¥æ”¶çš„ï¼‰ï¼Œä½†å„è‡ªè¿›è¡Œç‹¬ç«‹çš„å¤„ç†ã€‚</p>
<p>ç¡®ä¿æŠ•é€’</p>
<p>ä¸ºäº†ä½¿å®¢æˆ·ç«¯å¯ä»¥ä¸åŒæ­¥æœåŠ¡é€šä¿¡ï¼ŒæœåŠ¡å¿…é¡»ç›‘å¬æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ã€‚å¦‚æœæœåŠ¡å´©æºƒäº†ï¼Œæˆ–è€…ç”±äºæŸç§åŸå› æ— æ³•ä½¿ç”¨äº†ï¼Œå®¢æˆ·ç«¯å°†ä¸èƒ½ç»§ç»­å¤„ç†ã€‚</p>
<p>ä½†æ˜¯ï¼Œå½“å‘é€å¼‚æ­¥æ¶ˆæ¯æ—¶ï¼Œå®¢æˆ·ç«¯å®Œå…¨å¯ä»¥ç›¸ä¿¡æ¶ˆæ¯ä¼šè¢«æŠ•é€’ã€‚å³ä½¿åœ¨æ¶ˆæ¯å‘é€æ—¶ï¼ŒæœåŠ¡æ— æ³•ä½¿ç”¨ï¼Œæ¶ˆæ¯ä¹Ÿä¼šè¢«å­˜å‚¨èµ·æ¥ï¼Œç›´åˆ°æœåŠ¡é‡æ–°å¯ä»¥ä½¿ç”¨ä¸ºæ­¢ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å¯¹å¼‚æ­¥æ¶ˆæ¯çš„åŸºç¡€çŸ¥è¯†æœ‰æ‰€äº†è§£ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å¦‚ä½•å°†å…¶ä»˜è¯¸å®æ–½ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨JMSæ¥å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚</p>
<h3 id="ä½¿ç”¨JMSå‘é€æ¶ˆæ¯"><a href="#ä½¿ç”¨JMSå‘é€æ¶ˆæ¯" class="headerlink" title="ä½¿ç”¨JMSå‘é€æ¶ˆæ¯"></a>ä½¿ç”¨JMSå‘é€æ¶ˆæ¯</h3><p>Javaæ¶ˆæ¯æœåŠ¡ï¼ˆJava Message Service ï¼ŒJMSï¼‰æ˜¯ä¸€ä¸ªJavaæ ‡å‡†ï¼Œå®šä¹‰äº†ä½¿ç”¨æ¶ˆæ¯ä»£ç†çš„é€šç”¨APIã€‚åœ¨JMSå‡ºç°ä¹‹å‰ï¼Œæ¯ä¸ªæ¶ˆæ¯ä»£ç†éƒ½æœ‰ç§æœ‰çš„APIï¼Œè¿™å°±ä½¿å¾—ä¸åŒä»£ç†ä¹‹é—´çš„æ¶ˆæ¯ä»£ç å¾ˆéš¾é€šç”¨ã€‚ä½†æ˜¯å€ŸåŠ©JMSï¼Œæ‰€æœ‰éµä»è§„èŒƒçš„å®ç°éƒ½ä½¿ç”¨é€šç”¨çš„æ¥å£ï¼Œè¿™å°±ç±»ä¼¼äºJDBCä¸ºæ•°æ®åº“æ“ä½œæä¾›äº†é€šç”¨çš„æ¥å£ä¸€æ ·ã€‚</p>
<p>Springé€šè¿‡åŸºäºæ¨¡æ¿çš„æŠ½è±¡ä¸ºJMSåŠŸèƒ½æä¾›äº†æ”¯æŒï¼Œè¿™ä¸ªæ¨¡æ¿ä¹Ÿå°±æ˜¯JmsTemplateã€‚ä½¿ç”¨JmsTemplateï¼Œèƒ½å¤Ÿéå¸¸å®¹æ˜“åœ°åœ¨æ¶ˆæ¯ç”Ÿäº§æ–¹å‘é€é˜Ÿåˆ—å’Œä¸»é¢˜æ¶ˆæ¯ï¼Œåœ¨æ¶ˆè´¹æ¶ˆæ¯çš„é‚£ä¸€æ–¹ï¼Œä¹Ÿèƒ½å¤Ÿéå¸¸å®¹æ˜“åœ°æ¥æ”¶è¿™äº›æ¶ˆæ¯ã€‚Springè¿˜æä¾›äº†æ¶ˆæ¯é©±åŠ¨POJOçš„ç†å¿µï¼šè¿™æ˜¯ä¸€ä¸ªç®€å•çš„Javaå¯¹è±¡ï¼Œå®ƒèƒ½å¤Ÿä»¥å¼‚æ­¥çš„æ–¹å¼å“åº”é˜Ÿåˆ—æˆ–ä¸»é¢˜ä¸Šåˆ°è¾¾çš„æ¶ˆæ¯ã€‚</p>
<p>æˆ‘ä»¬å°†ä¼šè®¨è®ºSpringå¯¹JMSçš„æ”¯æŒï¼ŒåŒ…æ‹¬JmsTemplateå’Œæ¶ˆæ¯é©±åŠ¨POJOã€‚ä½†æ˜¯åœ¨å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ä¸€ä¸ªæ¶ˆæ¯ä»£ç†ï¼Œå®ƒèƒ½å¤Ÿåœ¨æ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´ä¼ é€’æ¶ˆæ¯ã€‚å¯¹Spring JMSçš„æ¢ç´¢å°±ä»åœ¨Springä¸­æ­å»ºæ¶ˆæ¯ä»£ç†å¼€å§‹å§ã€‚</p>
<h4 id="åœ¨Springä¸­æ­å»ºæ¶ˆæ¯ä»£ç†"><a href="#åœ¨Springä¸­æ­å»ºæ¶ˆæ¯ä»£ç†" class="headerlink" title="åœ¨Springä¸­æ­å»ºæ¶ˆæ¯ä»£ç†"></a>åœ¨Springä¸­æ­å»ºæ¶ˆæ¯ä»£ç†</h4><p>ActiveMQæ˜¯ä¸€ä¸ªä¼Ÿå¤§çš„å¼€æºæ¶ˆæ¯ä»£ç†äº§å“ï¼Œä¹Ÿæ˜¯ä½¿ç”¨JMSè¿›è¡Œå¼‚æ­¥æ¶ˆæ¯ä¼ é€’çš„æœ€ä½³é€‰æ‹©ã€‚åœ¨æˆ‘ç¼–å†™æœ¬ä¹¦çš„æ—¶å€™ï¼ŒActiveMQçš„æœ€æ–°ç‰ˆæœ¬ä¸º5.9.1ã€‚åœ¨å¼€å§‹ä½¿ç”¨ActiveMQä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä»<a target="_blank" rel="noopener" href="http://activemq.apache.orgä¸‹è½½äºŒè¿›åˆ¶å‘è¡ŒåŒ….ä¸‹è½½å®Œactivemqå,æˆ‘ä»¬å°†å…¶è§£å‹ç¼©åˆ°æœ¬åœ°ç¡¬ç›˜ä¸­.åœ¨è§£å‹ç›®å½•ä¸­,æˆ‘ä»¬ä¼šæ‰¾åˆ°æ–‡ä»¶activemq-core-5.9.1.jar.ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨activemqçš„api,æˆ‘ä»¬éœ€è¦å°†æ­¤jaræ–‡ä»¶æ·»åŠ åˆ°åº”ç”¨ç¨‹åºçš„ç±»è·¯å¾„ä¸­./">http://activemq.apache.orgä¸‹è½½äºŒè¿›åˆ¶å‘è¡ŒåŒ…ã€‚ä¸‹è½½å®ŒActiveMQåï¼Œæˆ‘ä»¬å°†å…¶è§£å‹ç¼©åˆ°æœ¬åœ°ç¡¬ç›˜ä¸­ã€‚åœ¨è§£å‹ç›®å½•ä¸­ï¼Œæˆ‘ä»¬ä¼šæ‰¾åˆ°æ–‡ä»¶activemq-core-5.9.1.jarã€‚ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨ActiveMQçš„APIï¼Œæˆ‘ä»¬éœ€è¦å°†æ­¤JARæ–‡ä»¶æ·»åŠ åˆ°åº”ç”¨ç¨‹åºçš„ç±»è·¯å¾„ä¸­ã€‚</a></p>
<p>åœ¨binç›®å½•ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸ºå„ç§æ“ä½œç³»ç»Ÿæ‰€åˆ›å»ºçš„å¯¹åº”å­ç›®å½•ã€‚åœ¨è¿™äº›å­ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ç”¨äºå¯åŠ¨ActiveMQçš„è„šæœ¬ã€‚ä¾‹å¦‚ï¼Œè¦åœ¨OS Xä¸‹å¯åŠ¨ActiveMQï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨â€œbin/macosxâ€ç›®å½•ä¸‹è¿è¡Œactivemq startã€‚è¿è¡Œè„šæœ¬åï¼ŒActiveMQå°±å‡†å¤‡å¥½äº†ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨å®ƒä½œä¸ºæ¶ˆæ¯ä»£ç†ã€‚</p>
<p>åˆ›å»ºè¿æ¥å·¥å‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•é‡‡ç”¨ä¸åŒçš„æ–¹å¼åœ¨Springä¸­ä½¿ç”¨JMSå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚åœ¨æ‰€æœ‰çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å€ŸåŠ©JMSè¿æ¥å·¥å‚é€šè¿‡æ¶ˆæ¯ä»£ç†å‘é€æ¶ˆæ¯ã€‚å› ä¸ºé€‰æ‹©äº†ActiveMQä½œä¸ºæˆ‘ä»¬çš„æ¶ˆæ¯ä»£ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»é…ç½®JMSè¿æ¥å·¥å‚ï¼Œè®©å®ƒçŸ¥é“å¦‚ä½•è¿æ¥åˆ°ActiveMQã€‚ActiveMQConnectionFactoryæ˜¯ActiveMQè‡ªå¸¦çš„è¿æ¥å·¥å‚ï¼Œåœ¨Springä¸­å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡Œé…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;connectionFactory&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;org.apache.activemq.spring.ActiveMQConnectionFactory&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒActiveMQConnectionFactoryä¼šå‡è®¾ActiveMQä»£ç†ç›‘å¬localhostçš„61616ç«¯å£ã€‚å¯¹äºå¼€å‘ç¯å¢ƒæ¥è¯´ï¼Œè¿™æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼ŒActiveMQå¯èƒ½ä¼šåœ¨ä¸åŒçš„ä¸»æœºå’Œ/ç«¯å£ä¸Šã€‚å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨brokerURLå±æ€§æ¥æŒ‡å®šä»£ç†çš„URLï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;connectionFactory&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;org.apache.activemq.spring.ActiveMQConnectionFactory&quot;</span>      <span class="attr">p:brokerURL</span>=<span class="string">&quot;tcp://localhost:61616&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®è¿æ¥å·¥å‚è¿˜æœ‰å¦å¤–ä¸€ç§æ–¹å¼ï¼Œæ—¢ç„¶æˆ‘ä»¬çŸ¥é“æ­£åœ¨ä¸ActiveMQæ‰“äº¤é“ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ActiveMQè‡ªå·±çš„Springé…ç½®å‘½åç©ºé—´æ¥å£°æ˜è¿æ¥å·¥å‚ï¼ˆé€‚ç”¨äºActiveMQ 4.1ä¹‹åçš„æ‰€æœ‰ç‰ˆæœ¬ï¼‰ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­å£°æ˜äº†amqå‘½åç©ºé—´ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xmlns:jms</span>=<span class="string">&quot;http://www.springframework.org/schema/jms&quot;</span>  <span class="attr">xmlns:amq</span>=<span class="string">&quot;http://activemq.apache.org/schema/core&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;    http://activemq.apache.org/schema/core    http://activemq.apache.org/schema/core/activemq-core.xsd    http://www.springframework.org/schema/jms    http://www.springframework.org/schema/jms/spring-jms.xsd    http://www.springframework.org/schema/beans    http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span> &gt;</span>    ...<span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<code>&lt;amq:connectionFactory&gt;</code>å…ƒç´ å£°æ˜è¿æ¥å·¥å‚ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">amq:connectionFatory</span> <span class="attr">id</span>=<span class="string">&quot;connectionFactory&quot;</span>                      <span class="attr">brokerURL</span>=<span class="string">&quot;tcp://localhost:61616&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œ<code>&lt;amq:connectionFactory&gt;</code>å…ƒç´ å¾ˆæ˜æ˜¾æ˜¯ä¸ºActiveMQæ‰€å‡†å¤‡çš„ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„æ¶ˆæ¯ä»£ç†å®ç°ï¼Œå®ƒä»¬ä¸ä¸€å®šä¼šæä¾›Springé…ç½®å‘½åç©ºé—´ã€‚å¦‚æœæ²¡æœ‰æä¾›çš„è¯ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨<bean>æ¥è£…é…è¿æ¥å·¥å‚ã€‚</bean></p>
<p>åœ¨æœ¬ç« çš„åç»­å†…å®¹ä¸­ï¼Œæˆ‘ä»¬ä¼šå¤šæ¬¡ä½¿ç”¨connectionFactorybeanï¼Œä½†æ˜¯ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡é…ç½®brokerURLå±æ€§æ¥å‘ŠçŸ¥è¿æ¥å·¥å‚æ¶ˆæ¯ä»£ç†çš„ä½ç½®å°±è¶³å¤Ÿäº†ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒbrokerURLå±æ€§ä¸­çš„URLæŒ‡å®šè¿æ¥å·¥å‚è¦è¿æ¥åˆ°æœ¬åœ°æœºå™¨çš„61616ç«¯å£ï¼ˆè¿™ä¸ªç«¯å£æ˜¯ActiveMQç›‘å¬çš„é»˜è®¤ç«¯å£ï¼‰ä¸Šçš„ActiveMQã€‚</p>
<p>å£°æ˜ActiveMQæ¶ˆæ¯ç›®çš„åœ°</p>
<p>é™¤äº†è¿æ¥å·¥å‚å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ¶ˆæ¯ä¼ é€’çš„ç›®çš„åœ°ã€‚ç›®çš„åœ°å¯ä»¥æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªä¸»é¢˜ï¼Œè¿™å–å†³äºåº”ç”¨çš„éœ€æ±‚ã€‚</p>
<p>ä¸è®ºä½¿ç”¨çš„æ˜¯é˜Ÿåˆ—è¿˜æ˜¯ä¸»é¢˜ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»ä½¿ç”¨ç‰¹å®šçš„æ¶ˆæ¯ä»£ç†å®ç°ç±»åœ¨Springä¸­é…ç½®ç›®çš„åœ°beanã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„<code>&lt;bean&gt;</code>å£°æ˜å®šä¹‰äº†ä¸€ä¸ªActiveMQé˜Ÿåˆ—ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;queue&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;org.apache.activemq.command.ActiveMQQueue&quot;</span>      <span class="attr">c:_</span>=<span class="string">&quot;spitter.queue&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>åŒæ ·ï¼Œä¸‹é¢çš„<code>&lt;bean&gt;</code>å£°æ˜å®šä¹‰äº†ä¸€ä¸ªActiveMQä¸»é¢˜ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;queue&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;org.apache.activemq.command.ActiveMQTopic&quot;</span>      <span class="attr">c:_</span>=<span class="string">&quot;spitter.queue&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œæ„é€ å™¨æŒ‡å®šäº†é˜Ÿåˆ—çš„åç§°ï¼Œè¿™æ ·æ¶ˆæ¯ä»£ç†å°±èƒ½è·çŸ¥è¯¥ä¿¡æ¯ï¼Œè€Œåœ¨æ¥ä¸‹æ¥ç¤ºä¾‹ä¸­ï¼Œåç§°åˆ™ä¸ºspitter.topicã€‚</p>
<p>ä¸è¿æ¥å·¥å‚ç›¸ä¼¼çš„æ˜¯ï¼ŒActiveMQå‘½åç©ºé—´æä¾›äº†å¦ä¸€ç§æ–¹å¼æ¥å£°æ˜é˜Ÿåˆ—å’Œä¸»é¢˜ã€‚å¯¹äºé˜Ÿåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a href="amq:quence">amq:quence</a>å…ƒç´ æ¥å£°æ˜ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">amq:queue</span> <span class="attr">id</span>=<span class="string">&quot;spittleQueue&quot;</span> <span class="attr">physicalName</span>=<span class="string">&quot;spittle.alert.queue&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯JMSä¸»é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>&lt;amq:topic&gt;</code>å…ƒç´ æ¥å£°æ˜ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">amq:queue</span> <span class="attr">id</span>=<span class="string">&quot;spittleTopic&quot;</span> <span class="attr">physicalName</span>=<span class="string">&quot;spittle.alert.topic&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡æ˜¯å“ªç§ç±»å‹ï¼Œéƒ½æ˜¯å€ŸåŠ©physicalNameå±æ€§æŒ‡å®šæ¶ˆæ¯é€šé“çš„åç§°ã€‚</p>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•å£°æ˜ä½¿ç”¨JMSæ‰€éœ€çš„ç»„ä»¶ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½å‘é€å’Œæ¥æ”¶æ¶ˆæ¯äº†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Springçš„JmsTemplateâ€”â€”Spring å¯¹JMSæ”¯æŒçš„æ ¸å¿ƒéƒ¨åˆ†ã€‚ä½†æ˜¯é¦–å…ˆï¼Œè®©æˆ‘ä»¬å…ˆçœ‹çœ‹å¦‚æœæ²¡æœ‰JmsTemplateï¼ŒJMSæ˜¯æ€æ ·ä½¿ç”¨çš„ï¼Œä»¥æ­¤äº†è§£JmsTemplateåˆ°åº•æä¾›äº†äº›ä»€ä¹ˆã€‚</p>
<h4 id="ä½¿ç”¨Springçš„JMSæ¨¡æ¿"><a href="#ä½¿ç”¨Springçš„JMSæ¨¡æ¿" class="headerlink" title="ä½¿ç”¨Springçš„JMSæ¨¡æ¿"></a>ä½¿ç”¨Springçš„JMSæ¨¡æ¿</h4><p>æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼ŒJMSä¸ºJavaå¼€å‘è€…æä¾›äº†ä¸æ¶ˆæ¯ä»£ç†è¿›è¡Œäº¤äº’æ¥å‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„æ ‡å‡†APIï¼Œè€Œä¸”å‡ ä¹æ¯ä¸ªæ¶ˆæ¯ä»£ç†å®ç°éƒ½æ”¯æŒJMSï¼Œå› æ­¤æˆ‘ä»¬ä¸å¿…å› ä¸ºä½¿ç”¨ä¸åŒçš„æ¶ˆæ¯ä»£ç†è€Œå­¦ä¹ ç§æœ‰çš„æ¶ˆæ¯APIã€‚</p>
<p>è™½ç„¶JMSä¸ºæ‰€æœ‰çš„æ¶ˆæ¯ä»£ç†æä¾›äº†ç»Ÿä¸€çš„æ¥å£ï¼Œä½†æ˜¯è¿™ç§æ¥å£ç”¨èµ·æ¥å¹¶ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚ä½¿ç”¨JMSå‘é€å’Œæ¥æ”¶æ¶ˆæ¯å¹¶ä¸åƒæ‹¿ä¸€å¼ é‚®ç¥¨å¹¶è´´åœ¨ä¿¡å°ä¸Šé‚£ä¹ˆç®€å•ã€‚æ­£å¦‚æˆ‘ä»¬å°†è¦çœ‹åˆ°çš„ï¼ŒJMSè¿˜è¦æ±‚æˆ‘ä»¬ä¸ºé‚®é€’è½¦åŠ æ²¹ï¼ˆåªæ˜¯æ¯”å–»çš„è¯´æ³•ï¼‰ã€‚</p>
<p>å¤„ç†å¤±æ§çš„JMSä»£ç </p>
<p>åœ¨10.3.1å°èŠ‚ä¸­ï¼Œæˆ‘å‘ä½ å±•ç¤ºäº†ä¼ ç»Ÿçš„JDBCä»£ç åœ¨å¤„ç†è¿æ¥ã€è¯­å¥ã€ç»“æœé›†å’Œå¼‚å¸¸æ—¶æ˜¯å¤šä¹ˆå†—é•¿å’Œç¹æ‚ã€‚é—æ†¾çš„æ˜¯ï¼Œä¼ ç»Ÿçš„JMSä½¿ç”¨äº†ç±»ä¼¼çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºã€‚</p>
<p>ç¨‹åºæ¸…å•17.1ã€€ä½¿ç”¨ä¼ ç»Ÿçš„JMSï¼ˆä¸ä½¿ç”¨Springï¼‰å‘é€æ¶ˆæ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ConnectionFactory cf = <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string">&quot;tcp://localhost:61616&quot;</span>);Connection conn = <span class="keyword">null</span>;Session session = <span class="keyword">null</span>;<span class="keyword">try</span> &#123;  conn = cf.createConnection();  session = conn.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);  Destination destination = <span class="keyword">new</span> ActiveMQQueue(<span class="string">&quot;spitter.queue&quot;</span>);  MessageProducer producer = session.createProducer(destination);  TextMessage message = session.createTextMessage();    message.setText(<span class="string">&quot;Hello world!&quot;</span>);  producer.send(message);&#125; <span class="keyword">catch</span> (JMSException e) &#123;  <span class="comment">// handle exception?&#125; finally &#123;  try &#123;    if (session != null) &#123;      session.close();    &#125;        if (conn != null) &#123;      conn.close();    &#125;  &#125; catch (JMSException ex) &#123;  &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>å†æ¬¡å£°æ˜è¿™æ˜¯ä¸€æ®µå¤±æ§çš„ä»£ç ï¼å°±åƒJDBCç¤ºä¾‹ä¸€æ ·ï¼Œå·®ä¸å¤šä½¿ç”¨äº†20è¡Œä»£ç ï¼Œåªæ˜¯ä¸ºäº†å‘é€ä¸€æ¡â€œHello world!â€æ¶ˆæ¯ã€‚å®é™…ä¸Šï¼Œå…¶ä¸­åªæœ‰å‡ è¡Œä»£ç æ˜¯ç”¨æ¥å‘é€æ¶ˆæ¯çš„ï¼Œå‰©ä¸‹çš„ä»£ç ä»…ä»…æ˜¯ä¸ºäº†å‘é€æ¶ˆæ¯è€Œè¿›è¡Œçš„è®¾ç½®ã€‚</p>
<p>æ¥æ”¶ç«¯ä¹Ÿæ²¡æœ‰å¥½åˆ°å“ªé‡Œå»ï¼Œå¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºã€‚ä¸ç¨‹åºæ¸…å•17.1ä¸€æ ·ï¼Œç¨‹åºæ¸…å•17.2ä¹Ÿæ˜¯ç”¨ä¸€å¤§æ®µä»£ç æ¥å®ç°å¦‚æ­¤ç®€å•çš„äº‹æƒ…ã€‚å¦‚æœæˆ‘ä»¬é€è¡Œåœ°æ¯”è¾ƒï¼Œæˆ‘ä»¬ä¼šå‘ç°å®ƒä»¬å‡ ä¹æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚å¦‚æœæŸ¥çœ‹ä¸Šåƒä¸ªå…¶ä»–çš„JMSä¾‹å­ï¼Œæˆ‘ä»¬ä¼šå‘ç°å®ƒä»¬ä¹Ÿæ˜¯å¾ˆç›¸ä¼¼çš„ã€‚åªä¸è¿‡ï¼Œå…¶ä¸­ä¸€äº›ä¼šä»JNDIä¸­è·å–è¿æ¥å·¥å‚ï¼Œè€Œå¦ä¸€äº›åˆ™æ˜¯ä½¿ç”¨ä¸»é¢˜ä»£æ›¿é˜Ÿåˆ—ã€‚ä½†æ˜¯æ— è®ºå¦‚ä½•ï¼Œå®ƒä»¬éƒ½å¤§è‡´éµå¾ªç›¸åŒçš„æ¨¡å¼ã€‚</p>
<p>ç¨‹åºæ¸…å•17.2ã€€ä½¿ç”¨ä¼ ç»Ÿçš„JMSï¼ˆä¸ä½¿ç”¨Springï¼‰æ¥æ”¶æ¶ˆæ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ConnectionFactory cf = <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string">&quot;tcp://localhost:61616&quot;</span>);Connection conn = <span class="keyword">null</span>;Session session = <span class="keyword">null</span>;<span class="keyword">try</span> &#123;  conn = cf.createConnection();  conn.start();  session = conn.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);  Destination destination = <span class="keyword">new</span> ActiveMQQueue(<span class="string">&quot;spitter.queue&quot;</span>);  MessageConsumer consumer = session.createConsumer(destination);  Message message = consumer.receive();  TextMessage textMessage = (TextMessage) message;  System.out.println(<span class="string">&quot;GOT A MESSAGE: &quot;</span> + textMessage.getText());  conn.start();&#125; <span class="keyword">catch</span> (JMSException e) &#123;  <span class="comment">// handle exception?&#125; finally &#123;  try &#123;    if (session != null) &#123;      session.close();    &#125;        if (con != null) &#123;      conn.close();    &#125;  &#125; catch (JMSException ex) &#123;  &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºè¿™äº›æ ·æ¿å¼ä»£ç ï¼Œæˆ‘ä»¬æ¯æ¬¡ä½¿ç”¨JMSæ—¶éƒ½è¦ä¸æ–­åœ°åšå¾ˆå¤šé‡å¤å·¥ä½œã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œä½ ä¼šå‘ç°æˆ‘ä»¬åœ¨é‡å¤ç¼–å†™å…¶ä»–å¼€å‘è€…çš„JMSä»£ç ã€‚</p>
<p>æˆ‘ä»¬å·²ç»åœ¨ç¬¬10ç« çœ‹åˆ°äº†Springçš„JdbcTemplateæ˜¯å¦‚ä½•å¤„ç†å¤±æ§çš„JDBCæ ·æ¿å¼ä»£ç çš„ã€‚ç°åœ¨ï¼Œè®©æˆ‘æ¥ä»‹ç»ä¸€ä¸‹Springçš„JmsTemplateå¦‚ä½•å¯¹JMSçš„æ ·æ¿å¼ä»£ç å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚</p>
<p>ä½¿ç”¨JMSæ¨¡ç‰ˆ</p>
<p>é’ˆå¯¹å¦‚ä½•æ¶ˆé™¤å†—é•¿å’Œé‡å¤çš„JMSä»£ç ï¼ŒSpringç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯JmsTemplateã€‚JmsTemplateå¯ä»¥åˆ›å»ºè¿æ¥ã€è·å¾—ä¼šè¯ä»¥åŠå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä¸“æ³¨äºæ„å»ºè¦å‘é€çš„æ¶ˆæ¯æˆ–è€…å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚</p>
<p>å¦å¤–ï¼ŒJmsTemplateå¯ä»¥å¤„ç†æ‰€æœ‰æŠ›å‡ºçš„ç¬¨æ‹™çš„JMSExceptionå¼‚å¸¸ã€‚å¦‚æœåœ¨ä½¿ç”¨JmsTemplateæ—¶æŠ›å‡ºJMSExceptionå¼‚å¸¸ï¼ŒJmsTemplateå°†æ•è·è¯¥å¼‚å¸¸ï¼Œç„¶åæŠ›å‡ºä¸€ä¸ªéæ£€æŸ¥å‹å¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸æ˜¯Springè‡ªå¸¦çš„JmsExceptionå¼‚å¸¸çš„å­ç±»ã€‚è¡¨17.1åˆ—å‡ºäº†æ ‡å‡†çš„JMSExceptionå¼‚å¸¸ä¸Springçš„éæ£€æŸ¥å‹å¼‚å¸¸ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚</p>
<p>è¡¨17.1ã€€Springçš„JmsTemplateä¼šæ•è·æ ‡å‡†çš„JMSExceptionå¼‚å¸¸ï¼Œå†ä»¥Springçš„éæ£€æŸ¥å‹å¼‚å¸¸JmsExceptionå­ç±»é‡æ–°æŠ›å‡º</p>
<table>
<thead>
<tr>
<th>Springï¼ˆorg.springframework.jms.*ï¼‰</th>
<th>æ ‡å‡†çš„JMSï¼ˆjavax.jms.*ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>DestinationResolutionException</td>
<td>Springç‰¹æœ‰çš„â€”â€”å½“Springæ— æ³•è§£æç›®çš„åœ°åç§°æ—¶æŠ›å‡º</td>
</tr>
<tr>
<td>IllegalStateException</td>
<td>IllegalStateException</td>
</tr>
<tr>
<td>InvalidClientIDException</td>
<td>InvalidClientIDException</td>
</tr>
<tr>
<td>InvalidDestinationException</td>
<td>InvalidSelectorException</td>
</tr>
<tr>
<td>InvalidSelectorException</td>
<td>InvalidSelectorException</td>
</tr>
<tr>
<td>JmsSecurityException</td>
<td>JmsSecurityException</td>
</tr>
<tr>
<td>ListenerExecutionFailedException</td>
<td>Springç‰¹æœ‰çš„â€”â€”å½“ç›‘å¬å™¨æ–¹æ³•æ‰§è¡Œå¤±è´¥æ—¶æŠ›å‡º</td>
</tr>
<tr>
<td>MessageConversionException</td>
<td>Springç‰¹æœ‰çš„â€”â€”å½“æ¶ˆæ¯è½¬æ¢å¤±è´¥æ—¶æŠ›å‡º</td>
</tr>
<tr>
<td>MessageEOFException</td>
<td>MessageEOFException</td>
</tr>
<tr>
<td>MessageFormatException</td>
<td>MessageFormatException</td>
</tr>
<tr>
<td>MessageNotReadableException</td>
<td>MessageNotReadableException</td>
</tr>
<tr>
<td>MessageNotWriteableException</td>
<td>MessageNotWriteableException</td>
</tr>
<tr>
<td>ResourceAllocationException</td>
<td>ResourceAllocationException</td>
</tr>
<tr>
<td>SynchedLocalTransactionFailedException</td>
<td>Springç‰¹æœ‰çš„â€”â€”å½“åŒæ­¥çš„æœ¬åœ°äº‹åŠ¡ä¸èƒ½å®Œæˆæ—¶æŠ›å‡º</td>
</tr>
<tr>
<td>TransactionInprogressException</td>
<td>TransactionInprogressException</td>
</tr>
<tr>
<td>TransactionRolledBackException</td>
<td>TransactionRolledBackException</td>
</tr>
<tr>
<td>UncategorizedJmsException</td>
<td>Springç‰¹æœ‰çš„â€”â€”å½“æ²¡æœ‰å…¶ä»–å¼‚å¸¸é€‚ç”¨æ—¶æŠ›å‡º</td>
</tr>
</tbody></table>
<p>å¯¹äºJMS APIæ¥è¯´ï¼ŒJMSExceptionçš„ç¡®æä¾›äº†ä¸°å¯Œä¸”å…·æœ‰æè¿°æ€§çš„å­ç±»é›†åˆï¼Œè®©æˆ‘ä»¬æ›´æ¸…æ¥šåœ°çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆé”™è¯¯ã€‚ä¸è¿‡ï¼Œæ‰€æœ‰çš„JMSExceptionå¼‚å¸¸çš„å­ç±»éƒ½æ˜¯æ£€æŸ¥å‹å¼‚å¸¸ï¼Œå› æ­¤å¿…é¡»è¦æ•è·ã€‚JmsTemplateä¸ºæˆ‘ä»¬æ•è·è¿™äº›å¼‚å¸¸ï¼Œå¹¶é‡æ–°æŠ›å‡ºå¯¹åº”éæ£€æŸ¥å‹JMSExceptionå¼‚å¸¸çš„å­ç±»ã€‚</p>
<p>ä¸ºäº†ä½¿ç”¨JmsTemplateï¼Œæˆ‘ä»¬éœ€è¦åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­å°†å®ƒå£°æ˜ä¸ºä¸€ä¸ªbeanã€‚å¦‚ä¸‹çš„XMLå¯ä»¥å®Œæˆè¿™é¡¹å·¥ä½œï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jmsTemplate&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;org.springframework.jms.core.JmsTemplate&quot;</span>      <span class="attr">c:_-ref</span>=<span class="string">&quot;connectionFactory&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºJmsTemplateéœ€è¦çŸ¥é“å¦‚ä½•è¿æ¥åˆ°æ¶ˆæ¯ä»£ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä¸ºconnectionFactoryå±æ€§è®¾ç½®å®ç°äº†JMSçš„ConnectionFactoryæ¥å£çš„beanå¼•ç”¨ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨åœ¨12.2.1å°èŠ‚ä¸­æ‰€å£°æ˜çš„connectionFactorybeanå¼•ç”¨æ¥è£…é…è¯¥å±æ€§ã€‚</p>
<p>è¿™å°±æ˜¯é…ç½®JmsTemplateæ‰€éœ€è¦åšçš„æ‰€æœ‰å·¥ä½œâ€”â€”ç°åœ¨JmsTemplateå·²ç»å‡†å¤‡å¥½äº†ã€‚è®©æˆ‘ä»¬å¼€å§‹å‘é€æ¶ˆæ¯å§ï¼</p>
<p>å‘é€æ¶ˆæ¯</p>
<p>åœ¨æˆ‘ä»¬æƒ³å»ºç«‹çš„Spittråº”ç”¨ç¨‹åºä¸­ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªç‰¹æ€§å°±æ˜¯å½“åˆ›å»ºSpittleçš„æ—¶å€™æé†’å…¶ä»–ç”¨æˆ·ï¼ˆæˆ–è®¸æ˜¯é€šè¿‡E-mailï¼‰ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å¢åŠ Spittleçš„åœ°æ–¹ç›´æ¥å®ç°è¯¥ç‰¹æ€§ã€‚ä½†æ˜¯ææ¸…æ¥šå‘é€æé†’ç»™è°ä»¥åŠå®é™…å‘é€è¿™äº›æé†’å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œè¿™ä¼šå½±å“åˆ°åº”ç”¨çš„æ€§èƒ½ã€‚å½“å¢åŠ ä¸€ä¸ªæ–°çš„Spittleæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›åº”ç”¨æ˜¯æ•æ·çš„ï¼Œèƒ½å¤Ÿå¿«é€Ÿåšå‡ºå“åº”ã€‚</p>
<p>ä¸å…¶åœ¨å¢åŠ Spittleæ—¶æµªè´¹æ—¶é—´å‘é€è¿™äº›ä¿¡æ¯ï¼Œä¸å¦‚å¯¹è¯¥é¡¹å·¥ä½œè¿›è¡Œæ’é˜Ÿï¼Œåœ¨å“åº”è¿”å›ç»™ç”¨æˆ·ä¹‹åå†å¤„ç†å®ƒã€‚ä¸ç›´æ¥å‘é€æ¶ˆæ¯ç»™å…¶ä»–ç”¨æˆ·æ‰€èŠ±è´¹çš„æ—¶é—´ç›¸æ¯”ï¼Œå‘é€æ¶ˆæ¯ç»™é˜Ÿåˆ—æˆ–ä¸»é¢˜æ‰€èŠ±è´¹çš„æ—¶é—´æ˜¯å¾®ä¸è¶³é“çš„ã€‚</p>
<p>ä¸ºäº†åœ¨Spittleåˆ›å»ºçš„æ—¶å€™å¼‚æ­¥å‘é€spittleæé†’ï¼Œè®©æˆ‘ä»¬ä¸ºSpittråº”ç”¨å¼•å…¥AlertServiceï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.alerts;<span class="keyword">import</span> com.habuma.spittr.domain.Spittle;<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AlertService</span> </span>&#123;  <span class="function"><span class="keyword">void</span> <span class="title">sendSpittleAlert</span><span class="params">(Spittle spittle)</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼ŒAlertServiceæ˜¯ä¸€ä¸ªæ¥å£ï¼Œåªå®šä¹‰äº†ä¸€ä¸ªæ“ä½œâ€”â€” sendSpittleAlert()ã€‚</p>
<p>å¦‚ç¨‹åºæ¸…å•17.3æ‰€ç¤ºï¼ŒAlertServiceImplå®ç°äº†AlertServiceæ¥å£ï¼Œå®ƒä½¿ç”¨JmsOperationï¼ˆJmsTemplateæ‰€å®ç°çš„æ¥å£ï¼‰å°†Spittleå¯¹è±¡å‘é€ç»™æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œé˜Ÿåˆ—ä¼šåœ¨ç¨åå¾—åˆ°å¤„ç†ã€‚</p>
<p>ç¨‹åºæ¸…å•17.3ã€€ä½¿ç”¨JmsTemplateå‘é€ä¸€ä¸ªSpittle</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.alerts;<span class="keyword">import</span> javax.jms.JMSException;<span class="keyword">import</span> javax.jms.Message;<span class="keyword">import</span> javax.jms.Session;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.jms.core.JmsOperations;<span class="keyword">import</span> org.springframework.jms.core.MessageCreator;<span class="keyword">import</span> com.habuma.spittr.domain.Spittle;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AlertServicelmpl</span> <span class="keyword">implements</span> <span class="title">AlertService</span> </span>&#123;  <span class="keyword">private</span> JmsOperations jmsOperations;    <span class="meta">@Autowired</span>  <span class="function"><span class="keyword">public</span> <span class="title">AlertServicelmpl</span> <span class="params">(JmsOperations jmsOperatons)</span> </span>&#123;    <span class="keyword">this</span>.jmsOperations = jmsOperations;  &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSpittleAlert</span><span class="params">(<span class="keyword">final</span> Spittle spittle)</span> </span>&#123;    jmsOperations.send(      <span class="string">&quot;spittie.alert.queue&quot;</span>,      <span class="keyword">new</span> MessageCreator() &#123;        <span class="function"><span class="keyword">public</span> Message <span class="title">createMessage</span><span class="params">(Session session)</span><span class="keyword">throws</span> JMSException </span>&#123;          <span class="keyword">return</span> session.createObjectMessage(spittle);        &#125;      &#125;);  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>JmsOperationsçš„send()æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯JMSç›®çš„åœ°åç§°ï¼Œæ ‡è¯†æ¶ˆæ¯å°†å‘é€ç»™è°ã€‚å½“è°ƒç”¨send()æ–¹æ³•æ—¶ï¼ŒJmsTemplateå°†è´Ÿè´£è·å¾—JMSè¿æ¥ã€ä¼šè¯å¹¶ä»£è¡¨å‘é€è€…å‘é€æ¶ˆæ¯ï¼ˆå¦‚å›¾17.5æ‰€ç¤ºï¼‰ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211112091946207.png" alt="image-20211112091946207"></p>
<p>å›¾17.5ã€€JmsTemplateä»£è¡¨å‘é€è€…æ¥è´Ÿè´£å¤„ç†å‘é€æ¶ˆæ¯çš„å¤æ‚è¿‡ç¨‹</p>
<p>æˆ‘ä»¬ä½¿ç”¨MessageCreatorï¼ˆåœ¨è¿™é‡Œçš„å®ç°æ˜¯ä½œä¸ºä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ï¼‰æ¥æ„é€ æ¶ˆæ¯ã€‚åœ¨MessageCreatorçš„createMessage()æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡sessionåˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡æ¶ˆæ¯ï¼šä¼ å…¥ä¸€ä¸ªSpittleå¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡æ¶ˆæ¯ã€‚</p>
<p>å°±æ˜¯è¿™ä¹ˆç®€å•ï¼æ³¨æ„ï¼ŒsendSpittleAlert()æ–¹æ³•ä¸“æ³¨äºç»„è£…å’Œå‘é€æ¶ˆæ¯ã€‚åœ¨è¿™é‡Œæ²¡æœ‰è¿æ¥æˆ–ä¼šè¯ç®¡ç†çš„ä»£ç ï¼ŒJmsTemplateå¸®æˆ‘ä»¬å¤„ç†äº†æ‰€æœ‰çš„ç›¸å…³äº‹é¡¹ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿä¸éœ€è¦æ•è·JMSExceptionå¼‚å¸¸ã€‚JmsTemplateå°†æ•è·æŠ›å‡ºçš„æ‰€æœ‰JMSExceptionå¼‚å¸¸ï¼Œç„¶åé‡æ–°æŠ›å‡ºè¡¨17.1æ‰€åˆ—çš„æŸä¸€ç§éæ£€æŸ¥å‹å¼‚å¸¸ã€‚</p>
<p>è®¾ç½®é»˜è®¤ç›®çš„åœ°</p>
<p>åœ¨ç¨‹åºæ¸…å•17.3ä¸­ï¼Œæˆ‘ä»¬æ˜ç¡®æŒ‡å®šäº†ä¸€ä¸ªç›®çš„åœ°ï¼Œåœ¨send()æ–¹æ³•ä¸­å°†Spittleæ¶ˆæ¯å‘å‘æ­¤ç›®çš„åœ°ã€‚å½“æˆ‘ä»¬å¸Œæœ›é€šè¿‡ç¨‹åºé€‰æ‹©ä¸€ä¸ªç›®çš„åœ°æ—¶ï¼Œè¿™ç§å½¢å¼çš„send()æ–¹æ³•å¾ˆé€‚ç”¨ã€‚ä½†æ˜¯åœ¨AlertServiceImplæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬æ€»æ˜¯å°†Spittleæ¶ˆæ¯å‘ç»™ç›¸åŒçš„ç›®çš„åœ°ï¼Œæ‰€ä»¥è¿™ç§å½¢å¼çš„send()æ–¹æ³•å¹¶ä¸èƒ½å¸¦æ¥æ˜æ˜¾çš„å¥½å¤„ã€‚</p>
<p>ä¸å…¶æ¯æ¬¡å‘é€æ¶ˆæ¯æ—¶éƒ½æŒ‡å®šä¸€ä¸ªç›®çš„åœ°ï¼Œä¸å¦‚æˆ‘ä»¬ä¸ºJmsTemplateè£…é…ä¸€ä¸ªé»˜è®¤çš„ç›®çš„åœ°ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jmsTemplate&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;org.springframework.jms.core.JmsTemplate&quot;</span>      <span class="attr">c:_-ref</span>=<span class="string">&quot;connectionFactory&quot;</span>      <span class="attr">p:defaultDestinationName</span>=<span class="string">&quot;spittle.alert.queue&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œå°†ç›®çš„åœ°çš„åç§°è®¾ç½®ä¸ºspittle.alert.queueï¼Œä½†å®ƒåªæ˜¯ä¸€ä¸ªåç§°ï¼šå®ƒå¹¶æ²¡æœ‰è¯´æ˜ä½ æ‰€å¤„ç†çš„ç›®çš„åœ°æ˜¯ä»€ä¹ˆç±»å‹ã€‚å¦‚æœå·²ç»å­˜åœ¨è¯¥åç§°çš„é˜Ÿåˆ—æˆ–ä¸»é¢˜çš„è¯ï¼Œå°±ä¼šä½¿ç”¨å·²æœ‰çš„ã€‚å¦‚æœå°šæœªå­˜åœ¨çš„è¯ï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç›®çš„åœ°ï¼ˆé€šå¸¸ä¼šæ˜¯é˜Ÿåˆ—ï¼‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³æŒ‡å®šè¦åˆ›å»ºçš„ç›®çš„åœ°ç±»å‹çš„è¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥å°†ä¹‹å‰åˆ›å»ºçš„é˜Ÿåˆ—æˆ–ä¸»é¢˜çš„ç›®çš„åœ°beanè£…é…è¿›æ¥ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jmsTemplate&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;org.springframework.jms.core.JmsTemplate&quot;</span>      <span class="attr">c:_-ref</span>=<span class="string">&quot;connectionFactory&quot;</span>      <span class="attr">p:defaultDestination</span>=<span class="string">&quot;spittleTopic&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œè°ƒç”¨JmsTemplateçš„send()æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å»é™¤ç¬¬ä¸€ä¸ªå‚æ•°äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmsOperations.send(  <span class="keyword">new</span> MessageCreator() &#123;    ...  &#125;);</span><br></pre></td></tr></table></figure>

<p>è¿™ç§å½¢å¼çš„send()æ–¹æ³•åªéœ€è¦ä¼ å…¥ä¸€ä¸ªMessageCreatorã€‚å› ä¸ºå¸Œæœ›æ¶ˆæ¯å‘é€ç»™é»˜è®¤ç›®çš„åœ°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡æœ‰å¿…è¦å†æŒ‡å®šç‰¹å®šçš„ç›®çš„åœ°ã€‚</p>
<p>åœ¨è°ƒç”¨send()æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬ä¸å¿…å†æ˜¾å¼æŒ‡å®šç›®çš„åœ°èƒ½å¤Ÿè®©ä»»åŠ¡å¾—ä»¥ç®€åŒ–ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ¶ˆæ¯è½¬æ¢å™¨çš„è¯ï¼Œå‘é€æ¶ˆæ¯ä¼šæ›´åŠ ç®€å•ã€‚</p>
<p>åœ¨å‘é€æ—¶ï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œè½¬æ¢</p>
<p>é™¤äº†send()æ–¹æ³•ï¼ŒJmsTemplateè¿˜æä¾›äº†convertAndSend()æ–¹æ³•ã€‚ä¸send()æ–¹æ³•ä¸åŒï¼ŒconvertAndSend()æ–¹æ³•å¹¶ä¸éœ€è¦MessageCreatorä½œä¸ºå‚æ•°ã€‚è¿™æ˜¯å› ä¸ºconvertAndSend()ä¼šä½¿ç”¨å†…ç½®çš„æ¶ˆæ¯è½¬æ¢å™¨ï¼ˆmessage converterï¼‰ä¸ºæˆ‘ä»¬åˆ›å»ºæ¶ˆæ¯ã€‚</p>
<p>å½“æˆ‘ä»¬ä½¿ç”¨convertAndSend()æ—¶ï¼ŒsendSpittleAlert()å¯ä»¥å‡å°‘åˆ°æ–¹æ³•ä½“ä¸­åªåŒ…å«ä¸€è¡Œä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSpittleAlert</span><span class="params">(Spittle spittle)</span> </span>&#123;  jmsOperations.convertAndSend(spitlle);&#125;</span><br></pre></td></tr></table></figure>

<p>å°±åƒå˜é­”æœ¯ä¸€æ ·ï¼ŒSpittleä¼šåœ¨å‘é€ä¹‹å‰è½¬æ¢ä¸ºMessageã€‚ä¸è¿‡å°±åƒæ‰€æœ‰çš„é­”æœ¯ä¸€æ ·ï¼ŒJmsTemplateå†…éƒ¨ä¼šè¿›è¡Œä¸€äº›å¤„ç†ã€‚å®ƒä½¿ç”¨ä¸€ä¸ªMessageConverterçš„å®ç°ç±»å°†å¯¹è±¡è½¬æ¢ä¸ºMessageã€‚</p>
<p>MessageConverteræ˜¯Springå®šä¹‰çš„æ¥å£ï¼Œåªæœ‰ä¸¤ä¸ªéœ€è¦å®ç°çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MessageConverter</span> </span>&#123;  <span class="function">Message <span class="title">toMessage</span><span class="params">(Object object, Session session)</span> <span class="keyword">throws</span> JMSException, MessageConversionException</span>;    <span class="function">Object <span class="title">fromMessage</span><span class="params">(Message message)</span> <span class="keyword">throws</span> JMSException, MessageConversionException</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>å°½ç®¡è¿™ä¸ªæ¥å£å®ç°èµ·æ¥å¾ˆç®€å•ï¼Œä½†æˆ‘ä»¬é€šå¸¸å¹¶æ²¡æœ‰å¿…è¦åˆ›å»ºè‡ªå®šä¹‰çš„å®ç°ã€‚Springå·²ç»æä¾›äº†å¤šä¸ªå®ç°ï¼Œå¦‚è¡¨17.2æ‰€ç¤ºã€‚</p>
<p>è¡¨17.2ã€€Springä¸ºé€šç”¨çš„è½¬æ¢ä»»åŠ¡æä¾›äº†å¤šä¸ªæ¶ˆæ¯è½¬æ¢å™¨ï¼ˆæ‰€æœ‰çš„æ¶ˆæ¯è½¬æ¢å™¨éƒ½ä½äºorg.springframework.jms.support.converteråŒ…ä¸­ï¼‰</p>
<table>
<thead>
<tr>
<th>æ¶ˆæ¯è½¬æ¢å™¨</th>
<th>åŠŸã€€ã€€èƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>MappingJacksonMessageConverter</td>
<td>ä½¿ç”¨Jackson JSONåº“å®ç°æ¶ˆæ¯ä¸JSONæ ¼å¼ä¹‹é—´çš„ç›¸äº’è½¬æ¢</td>
</tr>
<tr>
<td>MappingJackson2MessageConverter</td>
<td>ä½¿ç”¨Jackson 2 JSONåº“å®ç°æ¶ˆæ¯ä¸JSONæ ¼å¼ä¹‹é—´çš„ç›¸äº’è½¬æ¢</td>
</tr>
<tr>
<td>MarshallingMessageConverter</td>
<td>ä½¿ç”¨JAXBåº“å®ç°æ¶ˆæ¯ä¸XMLæ ¼å¼ä¹‹é—´çš„ç›¸äº’è½¬æ¢</td>
</tr>
<tr>
<td>SimpleMessageConverter</td>
<td>å®ç°Stringä¸TextMessageä¹‹é—´çš„ç›¸äº’è½¬æ¢ï¼Œå­—èŠ‚æ•°ç»„ä¸BytesMessageä¹‹é—´çš„ç›¸äº’è½¬æ¢ï¼ŒMapä¸MapMessageä¹‹é—´çš„ç›¸äº’è½¬æ¢ä»¥åŠSerializableå¯¹è±¡ä¸ObjectMessageä¹‹é—´çš„ç›¸äº’è½¬æ¢</td>
</tr>
</tbody></table>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒJmsTemplateåœ¨convertAndSend()æ–¹æ³•ä¸­ä¼šä½¿ç”¨SimpleMessage Converterã€‚ä½†æ˜¯é€šè¿‡å°†æ¶ˆæ¯è½¬æ¢å™¨å£°æ˜ä¸ºbeanå¹¶å°†å…¶æ³¨å…¥åˆ°JmsTemplateçš„messageConverterå±æ€§ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™è¿™ç§è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨JSONæ¶ˆæ¯çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥å£°æ˜ä¸€ä¸ªMappingJacksonMessageConverter beanï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;messageConverter&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;org.springframework.jms.support.converter.MappingJacksonMessageConverter&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ³¨å…¥åˆ°JmsTemplateä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jmsTemplate&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;org.springframework.jms.core.JmsTemplate&quot;</span>      <span class="attr">c:_-ref</span>=<span class="string">&quot;connectionFactory&quot;</span>      <span class="attr">p:defaultDestinationName</span>=<span class="string">&quot;spittle.alert.queue&quot;</span>      <span class="attr">p:messageConverter-ref</span>=<span class="string">&quot;messageConverter&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>å„ä¸ªæ¶ˆæ¯è½¬æ¢å™¨å¯èƒ½ä¼šæœ‰é¢å¤–çš„é…ç½®ï¼Œè¿›è€Œå®ç°è½¬æ¢è¿‡ç¨‹çš„ç»†ç²’åº¦æ§åˆ¶ã€‚ä¾‹å¦‚ï¼ŒMappingJacksonMessageConverterèƒ½å¤Ÿè®©æˆ‘ä»¬é…ç½®è½¬ç ä»¥åŠè‡ªå®šä¹‰Jackson ObjectMapperã€‚å¯ä»¥æŸ¥é˜…æ¯ä¸ªæ¶ˆæ¯è½¬æ¢å™¨çš„JavaDocä»¥äº†è§£å¦‚ä½•æ›´åŠ ç»†ç²’åº¦åœ°é…ç½®å®ƒä»¬ã€‚</p>
<p>æ¥æ”¶æ¶ˆæ¯</p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•ä½¿ç”¨JmsTemplateå‘é€æ¶ˆæ¯ã€‚ä½†å¦‚æœæˆ‘ä»¬æ˜¯æ¥æ”¶ç«¯ï¼Œé‚£è¦æ€ä¹ˆåŠå‘¢ï¼ŸJmsTemplateæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥æ¥æ”¶æ¶ˆæ¯å‘¢ï¼Ÿ</p>
<p>æ²¡é”™ï¼Œçš„ç¡®å¯ä»¥ã€‚äº‹å®ä¸Šï¼Œä½¿ç”¨JmsTemplateæ¥æ”¶æ¶ˆæ¯ç”šè‡³æ›´ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨JmsTemplateçš„receive()æ–¹æ³•å³å¯ï¼Œå¦‚ç¨‹åºæ¸…å•12.4æ‰€ç¤ºã€‚</p>
<p>å½“è°ƒç”¨JmsTemplateçš„receive()æ–¹æ³•æ—¶ï¼ŒJmsTemplateä¼šå°è¯•ä»æ¶ˆæ¯ä»£ç†ä¸­è·å–ä¸€ä¸ªæ¶ˆæ¯ã€‚å¦‚æœæ²¡æœ‰å¯ç”¨çš„æ¶ˆæ¯ï¼Œreceive()æ–¹æ³•ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è·å¾—æ¶ˆæ¯ä¸ºæ­¢ã€‚å›¾17.6å±•ç¤ºäº†è¿™ä¸ªäº¤äº’è¿‡ç¨‹ã€‚</p>
<p>ç¨‹åºæ¸…å•17.4ã€€ä½¿ç”¨JmsTemplateæ¥æ”¶æ¶ˆæ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Spittle <span class="title">receiveApittleAlert</span><span class="params">()</span> </span>&#123;  <span class="keyword">try</span> &#123;    ObjectMessage receivedMessage = (ObjectMessage) jmsOperations.receive();    <span class="keyword">return</span> (Spittle) receivedMessage.getObject();  &#125; <span class="keyword">catch</span> (JMSException jmsException) &#123;    <span class="keyword">throws</span> JmsUtils.convertJmsAccessException(jmsException);  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211112092824597.png" alt="image-20211112092824597"></p>
<p>å›¾17.6ã€€ä½¿ç”¨JmsTemplateä»ä¸»é¢˜æˆ–é˜Ÿåˆ—ä¸­æ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™ï¼Œåªéœ€è¦ç®€å•åœ°è°ƒç”¨receive()æ–¹æ³•ã€‚JmsTemplateä¼šå¤„ç†å…¶ä»–çš„äº‹æƒ…</p>
<p>å› ä¸ºæˆ‘ä»¬çŸ¥é“Spittleæ¶ˆæ¯æ˜¯ä½œä¸ºä¸€ä¸ªå¯¹è±¡æ¶ˆæ¯æ¥å‘é€çš„ï¼Œæ‰€ä»¥å®ƒå¯ä»¥åœ¨åˆ°è¾¾åè½¬å‹ä¸ºObjectMessageã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨getObject()æ–¹æ³•æŠŠObjectMessageè½¬æ¢ä¸ºSpittleå¯¹è±¡å¹¶è¿”å›æ­¤å¯¹è±¡ã€‚</p>
<p>ä½†æ˜¯è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸å¾—ä¸å¯¹å¯èƒ½æŠ›å‡ºçš„JMSExceptionè¿›è¡Œå¤„ç†ã€‚æ­£å¦‚æˆ‘å·²ç»æåˆ°çš„ï¼ŒJmsTemplateå¯ä»¥å¾ˆå¥½åœ°å¤„ç†æŠ›å‡ºçš„JmsExceptionæ£€æŸ¥å‹å¼‚å¸¸ï¼Œç„¶åæŠŠå¼‚å¸¸è½¬æ¢ä¸ºSpringéæ£€æŸ¥å‹å¼‚å¸¸JmsExceptionå¹¶é‡æ–°æŠ›å‡ºã€‚ä½†æ˜¯å®ƒåªå¯¹è°ƒç”¨JmsTemplateçš„æ–¹æ³•æ—¶æ‰é€‚ç”¨ã€‚JmsTemplateæ— æ³•å¤„ç†è°ƒç”¨ObjectMessageçš„<br>getObject()æ–¹æ³•æ—¶æ‰€æŠ›å‡ºçš„JMSExceptionå¼‚å¸¸ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬è¦ä¹ˆæ•è·JMSExceptionå¼‚å¸¸ï¼Œè¦ä¹ˆå£°æ˜æœ¬æ–¹æ³•æŠ›å‡ºJMSExceptionå¼‚å¸¸ã€‚ä¸ºäº†éµå¾ªSpringè§„é¿æ£€æŸ¥å‹å¼‚å¸¸çš„è®¾è®¡ç†å¿µï¼Œæˆ‘ä»¬ä¸å»ºè®®æœ¬æ–¹æ³•æŠ›å‡ºJMSExceptionå¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©æ•è·è¯¥å¼‚å¸¸ã€‚åœ¨catchä»£ç å—ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Springä¸­JmsUtilsçš„convertJmsAccessException()æ–¹æ³•æŠŠæ£€æŸ¥å‹å¼‚å¸¸JMSExceptionè½¬æ¢ä¸ºéæ£€æŸ¥å‹å¼‚å¸¸JmsExceptionã€‚è¿™å…¶å®æ˜¯åœ¨å…¶ä»–åœºæ™¯ä¸­ç”±JmsTemplateä¸ºæˆ‘ä»¬åšçš„äº‹æƒ…ã€‚</p>
<p>åœ¨receiveSpittleAlert()æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹å–„çš„ä¸€ç‚¹å°±æ˜¯ä½¿ç”¨æ¶ˆæ¯è½¬æ¢å™¨ã€‚åœ¨convertAndSend()ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•å°†å¯¹è±¡è½¬æ¢ä¸ºMessageã€‚ä¸è¿‡ï¼Œå®ƒä»¬è¿˜å¯ä»¥ç”¨åœ¨æ¥æ”¶ç«¯ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨JmsTemplateçš„receiveAndConvert()ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Spittle <span class="title">retrieveSpittleAlert</span><span class="params">()</span> </span>&#123;  <span class="keyword">return</span> (Spittle) jmsOperation.receiveAndConverter();&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæ²¡æœ‰å¿…è¦å°†Messageè½¬æ¢ä¸ºObjectMessageï¼Œä¹Ÿæ²¡æœ‰å¿…è¦é€šè¿‡è°ƒç”¨getObject()æ¥è·å–Spittleï¼Œæ›´æ— éœ€æ‹…å¿ƒæ£€æŸ¥å‹çš„JMSExceptionå¼‚å¸¸ã€‚è¿™ä¸ªæ–°çš„retrieve SpittleAlert()ç®€æ´äº†è®¸å¤šã€‚ä½†æ˜¯ï¼Œä¾ç„¶è¿˜æœ‰ä¸€ä¸ªå¾ˆå°ä¸”ä¸å®¹æ˜“å¯Ÿè§‰çš„é—®é¢˜ã€‚</p>
<p>ä½¿ç”¨JmsTemplateæ¥æ”¶æ¶ˆæ¯çš„æœ€å¤§ç¼ºç‚¹åœ¨äºreceive()å’ŒreceiveAndConvert()æ–¹æ³•éƒ½æ˜¯åŒæ­¥çš„ã€‚è¿™æ„å‘³ç€æ¥æ”¶è€…å¿…é¡»è€å¿ƒç­‰å¾…æ¶ˆæ¯çš„åˆ°æ¥ï¼Œå› æ­¤è¿™äº›æ–¹æ³•ä¼šä¸€ç›´è¢«é˜»å¡ï¼Œç›´åˆ°æœ‰å¯ç”¨æ¶ˆæ¯ï¼ˆæˆ–è€…ç›´åˆ°è¶…æ—¶ï¼‰ã€‚åŒæ­¥æ¥æ”¶å¼‚æ­¥å‘é€çš„æ¶ˆæ¯ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆæ€ªå¼‚ï¼Ÿ</p>
<p>è¿™å°±æ˜¯æ¶ˆæ¯é©±åŠ¨POJOçš„ç”¨æ­¦ä¹‹å¤„ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨èƒ½å¤Ÿå“åº”æ¶ˆæ¯çš„ç»„ä»¶å¼‚æ­¥æ¥æ”¶æ¶ˆæ¯ï¼Œè€Œä¸æ˜¯ä¸€ç›´ç­‰å¾…æ¶ˆæ¯çš„åˆ°æ¥ã€‚</p>
<h4 id="åˆ›å»ºæ¶ˆæ¯é©±åŠ¨çš„POJO"><a href="#åˆ›å»ºæ¶ˆæ¯é©±åŠ¨çš„POJO" class="headerlink" title="åˆ›å»ºæ¶ˆæ¯é©±åŠ¨çš„POJO"></a>åˆ›å»ºæ¶ˆæ¯é©±åŠ¨çš„POJO</h4><p>åœ¨å­¦æ ¡æ—¶çš„ä¸€ä¸ªæš‘å‡æœŸé—´ï¼Œæˆ‘å¾—åˆ°äº†åœ¨é»„çŸ³å›½å®¶å…¬å›­å·¥ä½œçš„æœºä¼šã€‚è¿™ä¸ªå·¥ä½œå¹¶ä¸æ˜¯å…¬å›­å·¡é€»è€…æˆ–è€…å¼€å…³è€å¿ å®æ³‰ï¼ˆOld Faithfulï¼‰è¿™æ ·çš„é«˜çº§å·¥ä½œï¼Œè€Œæ˜¯åœ¨è€å¿ å®æ³‰é…’åº—è¿›è¡Œæ›´æ¢åºŠå•ã€æ¸…ç†å«ç”Ÿé—´ä»¥åŠæ‰“æ‰«åœ°æ¿ç­‰å®¶åŠ¡å·¥ä½œã€‚è™½ç„¶ä¸æ˜¯å¾ˆå¸å¼•äººï¼Œä½†è‡³å°‘æˆ‘æ˜¯åœ¨è¿™ä¸ªä¸–ç•Œä¸Šæœ€ç¾ä¸½çš„åœ°æ–¹å·¥ä½œã€‚</p>
<p>æ¯å¤©å·¥ä½œä¹‹åï¼Œæˆ‘éƒ½åˆ°å½“åœ°çš„é‚®å±€çœ‹çœ‹æ˜¯å¦æœ‰æˆ‘çš„é‚®ä»¶ã€‚æˆ‘å·²ç»ç¦»å®¶å¥½å‡ ä¸ªæ˜ŸæœŸäº†ï¼Œæ‰€ä»¥èƒ½æ”¶åˆ°å­¦æ ¡æœ‹å‹çš„æ¥ä¿¡æˆ–è€…æ˜ä¿¡ç‰‡æ˜¯ä¸€ä»¶éå¸¸ç¾å¥½çš„äº‹æƒ…ã€‚æˆ‘æ²¡æœ‰è‡ªå·±çš„é‚®ç®±ï¼Œæ‰€ä»¥å¿…é¡»èµ°ç€å»é‚®å±€ï¼Œå¹¶è¯¢é—®ååœ¨æŸœå°åçš„å·¥ä½œäººå‘˜æ˜¯å¦æœ‰æˆ‘çš„é‚®ä»¶ã€‚æ¥ç€å°±æ˜¯å¼€å§‹ç­‰å¾…ã€‚</p>
<p>è¦çŸ¥é“ï¼ŒæŸœå°åçš„é‚£ä¸ªäººå¤§çº¦æœ‰195å²äº†ã€‚åƒä»–è¿™ä¸ªå²æ•°çš„äººï¼Œèµ°åŠ¨èµ·æ¥å¾ˆè´¹æ—¶é—´ã€‚ä»–ä»æ¤…å­ä¸Šç«™èµ·æ¥ï¼Œæ…¢æ…¢èµ°è¿‡åœ°æ¿ï¼Œæ¶ˆå¤±åœ¨éš”å¢™åã€‚è¿‡äº†ä¸€ä¼šå„¿ï¼Œä»–å‡ºç°äº†ï¼Œæ…¢æ…¢å›åˆ°æŸœå°ï¼Œååˆ°æ¤…å­ä¸Šï¼Œç„¶åçœ‹ç€æˆ‘è¯´ï¼šâ€œä»Šå¤©æ²¡æœ‰é‚®ä»¶â€ã€‚</p>
<p>JmsTemplateçš„receive()æ–¹æ³•ä¸è¿™ä¸ªä¸Šäº†å¹´çºªçš„é‚®å±€é›‡å‘˜å¾ˆåƒã€‚å½“æˆ‘ä»¬è°ƒç”¨receive()æ–¹æ³•æ—¶ï¼ŒJmsTemplateä¼šæŸ¥çœ‹é˜Ÿåˆ—æˆ–ä¸»é¢˜ä¸­æ˜¯å¦æœ‰æ¶ˆæ¯ï¼Œç›´åˆ°æ”¶åˆ°æ¶ˆæ¯æˆ–è€…ç­‰å¾…è¶…æ—¶æ‰ä¼šè¿”å›ã€‚è¿™æœŸé—´ï¼Œåº”ç”¨æ— æ³•å¤„ç†ä»»ä½•äº‹æƒ…ï¼Œåªèƒ½ç­‰å¾…æ˜¯å¦æœ‰æ¶ˆæ¯ã€‚å¦‚æœåº”ç”¨èƒ½å¤Ÿç»§ç»­è¿›è¡Œå…¶ä»–ä¸šåŠ¡å¤„ç†ï¼Œå½“æ¶ˆæ¯åˆ°è¾¾æ—¶å†å»é€šçŸ¥å®ƒï¼Œä¸æ˜¯æ›´å¥½å—ï¼Ÿ</p>
<p>EJB2è§„èŒƒçš„ä¸€ä¸ªé‡è¦å†…å®¹æ˜¯å¼•å…¥äº†æ¶ˆæ¯é©±åŠ¨beanï¼ˆmessage-driven beanï¼ŒMDBï¼‰ã€‚MDBæ˜¯å¯ä»¥å¼‚æ­¥å¤„ç†æ¶ˆæ¯çš„EJBã€‚æ¢å¥è¯è¯´ï¼ŒMDBå°†JMSç›®çš„åœ°ä¸­çš„æ¶ˆæ¯ä½œä¸ºäº‹ä»¶ï¼Œå¹¶å¯¹è¿™äº›äº‹ä»¶è¿›è¡Œå“åº”ã€‚è€Œä¸ä¹‹ç›¸åçš„æ˜¯ï¼ŒåŒæ­¥æ¶ˆæ¯æ¥æ”¶è€…åœ¨æ¶ˆæ¯å¯ç”¨å‰ä¼šä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ã€‚</p>
<p>MDBæ˜¯EJBä¸­çš„ä¸€ä¸ªäº®ç‚¹ã€‚å³ä½¿é‚£äº›ç‹‚çƒ­çš„EJBåå¯¹è€…ä¹Ÿè®¤ä¸ºMDBå¯ä»¥ä¼˜é›…åœ°å¤„ç†æ¶ˆæ¯ã€‚EJB 2 MDBçš„å”¯ä¸€ç¼ºç‚¹æ˜¯å®ƒä»¬å¿…é¡»è¦å®ç°java.ejb.MessageDrivenBeanã€‚æ­¤å¤–ï¼Œå®ƒä»¬è¿˜å¿…é¡»å®ç°ä¸€äº›EJBç”Ÿå‘½å‘¨æœŸçš„å›è°ƒæ–¹æ³•ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒEJB 2 MDB ä¸æ˜¯çº¯çš„POJOã€‚</p>
<p>åœ¨EJB 3è§„èŒƒä¸­ï¼ŒMDBè¿›ä¸€æ­¥ç®€åŒ–äº†ï¼Œä½¿å…¶æ›´åƒPOJOã€‚æˆ‘ä»¬ä¸å†éœ€è¦å®ç°MessageDrivenBeanæ¥å£ï¼Œè€Œæ˜¯å®ç°æ›´é€šç”¨çš„javax.jms.MessageListeneræ¥å£ï¼Œå¹¶ä½¿ç”¨@MessageDrivenæ³¨è§£æ ‡æ³¨MDBã€‚</p>
<p>Spring 2.0æä¾›äº†å®ƒè‡ªå·±çš„æ¶ˆæ¯é©±åŠ¨beanæ¥æ»¡è¶³å¼‚æ­¥æ¥æ”¶æ¶ˆæ¯çš„éœ€æ±‚ï¼Œè¿™ç§å½¢å¼ä¸EJB 3çš„MDBå¾ˆç›¸ä¼¼ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ åˆ°Springæ˜¯å¦‚ä½•ä½¿ç”¨æ¶ˆæ¯é©±åŠ¨POJOï¼ˆæˆ‘ä»¬å°†å…¶ç®€ç§°ä¸ºMDPï¼‰æ¥æ”¯æŒå¼‚æ­¥æ¥æ”¶æ¶ˆæ¯çš„ã€‚</p>
<p>åˆ›å»ºæ¶ˆæ¯ç›‘å¬å™¨</p>
<p>å¦‚æœä½¿ç”¨EJBçš„æ¶ˆæ¯é©±åŠ¨æ¨¡å‹æ¥åˆ›å»ºSpittleçš„æé†’å¤„ç†å™¨ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨@MessageDrivenæ³¨è§£è¿›è¡Œæ ‡æ³¨ã€‚å³ä½¿å®ƒä¸æ˜¯ä¸¥æ ¼è¦æ±‚çš„ï¼Œä½†EJBè§„èŒƒè¿˜æ˜¯å»ºè®®MDBå®ç°MessageListeneræ¥å£ã€‚Spittleçš„æé†’å¤„ç†å™¨æœ€ç»ˆå¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MessageDriven(mappedName=&quot;jms/spittle.alert.queue&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpittleAlertHandler</span> <span class="keyword">implements</span> <span class="title">MessageListener</span> </span>&#123;  <span class="meta">@Resource</span>  <span class="keyword">private</span> MessageDrivenContext mdc;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;    ...  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ¶ˆæ¯é©±åŠ¨ç»„ä»¶ä¸éœ€è¦å®ç°MessageListeneræ¥å£ï¼Œä¸–ç•Œå°†æ˜¯å¤šä¹ˆçš„ç®€å•ã€‚åœ¨è¿™é‡Œï¼Œå¤©æ˜¯è”šè“çš„ï¼Œé¸Ÿå„¿å”±ç€æˆ‘ä»¬å–œæ¬¢çš„æ­Œï¼Œæˆ‘ä»¬ä¸å†éœ€è¦å®ç°onMessage()æ–¹æ³•æˆ–è€…æ³¨å…¥MessgeDrivenContextã€‚</p>
<p>å¥½å§ï¼Œå¯èƒ½EJB 3è§„èŒƒæ‰€è¦æ±‚çš„MDBä¹Ÿç®—ä¸ä¸Šå¤ªéº»çƒ¦ã€‚ä½†æ˜¯äº‹å®ä¸Šï¼ŒSpittleAlertHandlerçš„EJB 3å®ç°å¤ªä¾èµ–äºEJBçš„æ¶ˆæ¯é©±åŠ¨APIï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€å¸Œæœ›çš„POJOã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æé†’å¤„ç†å™¨èƒ½å¤Ÿå¤„ç†æ¶ˆæ¯ï¼Œä½†æ˜¯ä¸ç”¨ç¼–ç ï¼Œå°±å¥½åƒå®ƒçŸ¥é“åº”è¯¥åšä»€ä¹ˆã€‚</p>
<p>Springæä¾›äº†ä»¥POJOçš„æ–¹å¼å¤„ç†æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œè¿™äº›æ¶ˆæ¯æ¥è‡ªäºJMSçš„é˜Ÿåˆ—æˆ–ä¸»é¢˜ä¸­ã€‚ä¾‹å¦‚ï¼ŒåŸºäºPOJOå®ç°SpittleAlertHandlerå°±è¶³ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>
<p>ç¨‹åºæ¸…å•17.5ã€€Spring MDPå¼‚æ­¥æ¥æ”¶å’Œå¤„ç†æ¶ˆæ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.alerts;<span class="keyword">import</span> com.habuma.spittr.domain.Spittle;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpittleAlertHandler</span> </span>&#123;  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleSpittleAlert</span><span class="params">(Spittle spittle)</span> </span>&#123;    <span class="comment">// ... implementation goes here ...  &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>è™½ç„¶æ”¹å˜å¤©ç©ºçš„é¢œè‰²å’Œè®­ç»ƒé¸Ÿå„¿æ­Œå”±è¶…å‡ºäº†Springçš„èŒƒå›´ï¼Œä½†ç¨‹åºæ¸…å•17.5æ‰€å±•ç¤ºçš„ç°å®ä¸æˆ‘æç»˜çš„ç†æƒ³ä¸–ç•Œéå¸¸æ¥è¿‘ã€‚æˆ‘ä»¬ç¨åä¼šç¼–å†™handleSpittleAlert()æ–¹æ³•çš„å…·ä½“å†…å®¹ã€‚ç°åœ¨ï¼Œç¨‹åºæ¸…å• 17.5æ‰€å±•ç¤ºçš„SpittleAlertHandleræ²¡æœ‰ä»»ä½•JMSçš„ç—•è¿¹ã€‚ä»ä»»æ„ä¸€ä¸ªè§’åº¦è§‚å¯Ÿï¼Œå®ƒéƒ½æ˜¯ä¸€ä¸ªçº¯ç²¹çš„POJOã€‚å®ƒä»ç„¶å¯ä»¥åƒEJBé‚£æ ·å¤„ç†æ¶ˆæ¯ï¼Œåªä¸è¿‡å®ƒè¿˜éœ€è¦ä¸€äº›Springçš„é…ç½®ã€‚</p>
<p>é…ç½®æ¶ˆæ¯ç›‘å¬å™¨</p>
<p>ä¸ºPOJOèµ‹äºˆæ¶ˆæ¯æ¥æ”¶èƒ½åŠ›çš„è¯€çªæ˜¯åœ¨Springä¸­æŠŠå®ƒé…ç½®ä¸ºæ¶ˆæ¯ç›‘å¬å™¨ã€‚Springçš„jmså‘½åç©ºé—´ä¸ºæˆ‘ä»¬æä¾›äº†æ‰€éœ€è¦çš„ä¸€åˆ‡ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬å…ˆæŠŠå¤„ç†å™¨å£°æ˜ä¸ºbeanï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;spittleHandler&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;com.habuma.spittr.alerts.SpittleAlertHandler&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œä¸ºäº†æŠŠSpittleAlertHandlerè½¬å˜ä¸ºæ¶ˆæ¯é©±åŠ¨çš„POJOï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªbeanå£°æ˜ä¸ºæ¶ˆæ¯ç›‘å¬å™¨ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jms:listener-container</span> <span class="attr">connection-factory</span>=<span class="string">&quot;connectionFactory&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">jms:listener</span> <span class="attr">destination</span>=<span class="string">&quot;spitter.alert.queue&quot;</span>                <span class="attr">ref</span>=<span class="string">&quot;spittleHandler&quot;</span>                <span class="attr">method</span>=<span class="string">&quot;handleSpittleAlert&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">jms:listener-container</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åœ¨æ¶ˆæ¯ç›‘å¬å™¨å®¹å™¨ä¸­åŒ…å«äº†ä¸€ä¸ªæ¶ˆæ¯ç›‘å¬å™¨ã€‚æ¶ˆæ¯ç›‘å¬å™¨å®¹å™¨ï¼ˆmessage listener containerï¼‰æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„beanï¼Œå®ƒå¯ä»¥ç›‘æ§JMSç›®çš„åœ°å¹¶ç­‰å¾…æ¶ˆæ¯åˆ°è¾¾ã€‚ä¸€æ—¦æœ‰æ¶ˆæ¯åˆ°è¾¾ï¼Œå®ƒå–å‡ºæ¶ˆæ¯ï¼Œç„¶åæŠŠæ¶ˆæ¯ä¼ ç»™ä»»æ„ä¸€ä¸ªå¯¹æ­¤æ¶ˆæ¯æ„Ÿå…´è¶£çš„æ¶ˆæ¯ç›‘å¬å™¨ã€‚å¦‚å›¾17.7å±•ç¤ºäº†è¿™ä¸ªäº¤äº’è¿‡ç¨‹ã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211112093717028.png" alt="image-20211112093717028"></p>
<p>å›¾17.7ã€€æ¶ˆæ¯ç›‘å¬å™¨å®¹å™¨ç›‘å¬é˜Ÿåˆ—å’Œä¸»é¢˜ã€‚å½“æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼Œæ¶ˆæ¯å°†è½¬ç»™æ¶ˆæ¯ç›‘å¬å™¨ï¼ˆä¾‹å¦‚æ¶ˆæ¯é©±åŠ¨çš„POJOï¼‰</p>
<p>ä¸ºäº†åœ¨Springä¸­é…ç½®æ¶ˆæ¯ç›‘å¬å™¨å®¹å™¨å’Œæ¶ˆæ¯ç›‘å¬å™¨ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†Spring jmså‘½åç©ºé—´ä¸­çš„ä¸¤ä¸ªå…ƒç´ ã€‚<code>&lt;jms:listener-container&gt;</code>ä¸­åŒ…å«äº†<code>&lt;jms:listener&gt;</code>å…ƒç´ ã€‚è¿™é‡Œçš„connection-factoryå±æ€§é…ç½®äº†å¯¹connectionFactoryçš„å¼•ç”¨ï¼Œå®¹å™¨ä¸­çš„æ¯ä¸ª<code>&lt;jms:listener&gt;</code>éƒ½ä½¿ç”¨è¿™ä¸ªè¿æ¥å·¥å‚è¿›è¡Œæ¶ˆæ¯ç›‘å¬ã€‚åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œconnection-factoryå±æ€§å¯ä»¥ç§»é™¤ï¼Œå› ä¸ºè¯¥å±æ€§çš„é»˜è®¤å€¼å°±æ˜¯connectionFactoryã€‚</p>
<p>å¯¹äº<code>&lt;jms:listener&gt;</code>å…ƒç´ ï¼Œå®ƒç”¨äºæ ‡è¯†ä¸€ä¸ªbeanå’Œä¸€ä¸ªå¯ä»¥å¤„ç†æ¶ˆæ¯çš„æ–¹æ³•ã€‚ä¸ºäº†å¤„ç†Spittleæé†’æ¶ˆæ¯ï¼Œrefå…ƒç´ å¼•ç”¨äº†spittleHandler beanã€‚å½“æ¶ˆæ¯åˆ°è¾¾spitter.alert.queueé˜Ÿåˆ—ï¼ˆé€šè¿‡destinationå±æ€§é…ç½®ï¼‰æ—¶ï¼ŒspittleHandlerbeançš„handleSpittleAlert()æ–¹æ³•ï¼ˆé€šè¿‡methodå±æ€§æŒ‡å®šçš„ï¼‰ä¼šè¢«è§¦å‘ã€‚</p>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœrefå±æ€§æ‰€æ ‡ç¤ºçš„beanå®ç°äº†MessageListenerï¼Œé‚£å°±æ²¡æœ‰å¿…è¦å†æŒ‡å®šmethodå±æ€§äº†ï¼Œé»˜è®¤å°±ä¼šè°ƒç”¨onMessage()æ–¹æ³•ã€‚</p>
<h4 id="ä½¿ç”¨åŸºäºæ¶ˆæ¯çš„RPC"><a href="#ä½¿ç”¨åŸºäºæ¶ˆæ¯çš„RPC" class="headerlink" title="ä½¿ç”¨åŸºäºæ¶ˆæ¯çš„RPC"></a>ä½¿ç”¨åŸºäºæ¶ˆæ¯çš„RPC</h4><p>åœ¨ç¬¬15ç« ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†SpringæŠŠbeançš„æ–¹æ³•æš´éœ²ä¸ºè¿œç¨‹æœåŠ¡ä»¥åŠä»å®¢æˆ·ç«¯å‘è¿™äº›æœåŠ¡å‘èµ·è°ƒç”¨çš„å‡ ç§æ–¹å¼ã€‚åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•é€šè¿‡é˜Ÿåˆ—å’Œä¸»é¢˜åœ¨åº”ç”¨ç¨‹åºä¹‹é—´å‘é€æ¶ˆæ¯ã€‚ç°åœ¨æˆ‘ä»¬å°†äº†è§£ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨JMSä½œä¸ºä¼ è¾“é€šé“æ¥è¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚</p>
<p>ä¸ºäº†æ”¯æŒåŸºäºæ¶ˆæ¯çš„RPCï¼ŒSpringæä¾›äº†JmsInvokerServiceExporterï¼Œå®ƒå¯ä»¥æŠŠbeanå¯¼å‡ºä¸ºåŸºäºæ¶ˆæ¯çš„æœåŠ¡ï¼›ä¸ºå®¢æˆ·ç«¯æä¾›äº†JmsInvokerProxyFactoryBeanæ¥ä½¿ç”¨è¿™äº›æœåŠ¡ã€‚</p>
<p>è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ç¬¬15ç« ï¼ŒSpringæä¾›äº†å¤šç§æ–¹å¼æŠŠbeanå¯¼å‡ºä¸ºè¿œç¨‹æœåŠ¡ã€‚æˆ‘ä»¬ä½¿ç”¨RmiServiceExporteræŠŠbeanå¯¼å‡ºä¸ºRMIæœåŠ¡ï¼Œä½¿ç”¨HessianExporterå’ŒBurlapExporterå¯¼å‡ºä¸ºåŸºäºHTTPçš„Hessianå’ŒBurlapæœåŠ¡ï¼Œè¿˜ä½¿ç”¨HttpInvoker Service Exporteråˆ›å»ºåŸºäºHTTPçš„HTTP invokeræœåŠ¡ã€‚ä½†Springè¿˜æä¾›äº†ä¸€ç§åœ¨ç¬¬15ç« ä¸­æˆ‘ä»¬æœªæ¢è®¨çš„æœåŠ¡å¯¼å‡ºå™¨ã€‚</p>
<p>å¯¼å‡ºåŸºäºJMSçš„æœåŠ¡</p>
<p>JmsInvokerServiceExporterå¾ˆç±»ä¼¼äºå…¶ä»–çš„æœåŠ¡å¯¼å‡ºå™¨ã€‚äº‹å®ä¸Šï¼ŒJmsInvokerServiceExporterä¸HttpInvokerServiceExporteråœ¨åç§°ä¸Šæœ‰æŸç§å¯¹ç§°å‹ã€‚å¦‚æœ<br>HttpInvokerServiceExporterå¯ä»¥å¯¼å‡ºåŸºäºHTTPé€šä¿¡çš„æœåŠ¡ï¼Œé‚£ä¹ˆJmsInvokerServiceExporterå°±åº”è¯¥å¯ä»¥å¯¼å‡ºåŸºäºJMSçš„æœåŠ¡ã€‚</p>
<p>ä¸ºäº†æ¼”ç¤ºJmsInvokerServiceExporteræ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè€ƒè™‘å¦‚ä¸‹çš„AlertServiceImplã€‚</p>
<p>ç¨‹åºæ¸…å•17.6ã€€AlertServiceImplæ˜¯ä¸€ä¸ªå¤„ç†JMSæ¶ˆæ¯çš„POJOï¼Œä½†æ˜¯ä¸ä¾èµ–äºJMS</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.alerts;<span class="keyword">import</span> org.springframework.mail.SimpleMailMessage;<span class="keyword">import</span> org.springframework.mail.javamail.JavaMailSender;<span class="keyword">import</span> org.springframework.stereotype.Component;<span class="keyword">import</span> com.habuma.spittr.domain.Spittle;<span class="meta">@Component(&quot;alertService&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AlertServicelmpl</span> <span class="keyword">implements</span> <span class="title">AlertService</span> </span>&#123;  <span class="keyword">private</span> JavaMailSender mailSender;  <span class="keyword">private</span> String alertEmailAddress;  <span class="function"><span class="keyword">public</span> <span class="title">AlertServicelmpl</span><span class="params">(JavaMailSender mailSender, String alertEmailAddress)</span> </span>&#123;    <span class="keyword">this</span>.mailSender = mailSender;    <span class="keyword">this</span>.alertEmailAddress = alertEmailAddress;  &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSpittleAlert</span><span class="params">(<span class="keyword">final</span> Spittle spittle)</span> </span>&#123;    SimpleMailMessage message = <span class="keyword">new</span> SimpleMailMessage();    String spitterName = spittle.getSpitter().getFullName();    message.setFrom(<span class="string">&quot;noreply@spitter.com&quot;</span>);    message.setTo(alertEmailAddress);    message.setSubject&#123;<span class="string">&quot;New spittle from &quot;</span> + spitterName);    message.setText(spitterName + <span class="string">&quot; says: &quot;</span> + spittle.getText());    mailSender.send(message);  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ç°åœ¨ä¸è¦è¿‡äºå…³æ³¨sendSpittleAlert()æ–¹æ³•çš„ç»†èŠ‚ã€‚åœ¨ç¬¬19ç« ï¼Œæˆ‘ä»¬å°†ä¼šç»§ç»­æ¢è®¨å¦‚ä½•ä½¿ç”¨Springå‘é€E-mailã€‚ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„é‡ç‚¹åœ¨äºAlertServiceImplæ˜¯ä¸€ä¸ªç®€å•çš„POJOï¼Œæ²¡æœ‰ä»»ä½•è¿¹è±¡æ ‡ç¤ºå®ƒè¦ç”¨æ¥å¤„ç†JMSæ¶ˆæ¯ã€‚å®ƒåªæ˜¯å®ç°äº†ç®€å•çš„AlertServiceæ¥å£ï¼Œè¯¥æ¥å£å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.alerts;<span class="keyword">import</span> com.habuma.spittr.domain.Spittle;<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AlertService</span> </span>&#123;  <span class="function"><span class="keyword">void</span> <span class="title">sendSpittleAlert</span><span class="params">(Spittle spittle)</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼ŒAlertServiceImplä½¿ç”¨äº†@Componentæ³¨è§£æ¥æ ‡æ³¨ï¼Œæ‰€ä»¥å®ƒä¼šè¢«Springè‡ªåŠ¨å‘ç°å¹¶æ³¨å†Œä¸ºSpringåº”ç”¨ä¸Šä¸‹æ–‡ä¸­IDä¸ºalertServiceçš„beanã€‚åœ¨é…ç½®JmsInvokerServiceExporteræ—¶ï¼Œæˆ‘ä»¬å°†å¼•ç”¨è¿™ä¸ªbeanï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;alertServiceExporter&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;org.springframework.jms.remoting.JmsInvokerServiceExporter&quot;</span>      <span class="attr">p:service-ref</span>=<span class="string">&quot;alertService&quot;</span>      <span class="attr">p:serviceInterface</span>=<span class="string">&quot;com.habuma.spittr.alerts.AlertService&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªbeançš„å±æ€§æè¿°äº†å¯¼å‡ºçš„æœåŠ¡åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚serviceå±æ€§è®¾ç½®ä¸ºalertServicebeançš„å¼•ç”¨ï¼Œå®ƒæ˜¯è¿œç¨‹æœåŠ¡çš„å®ç°ã€‚åŒæ—¶ï¼ŒserviceInterfaceå±æ€§è®¾ç½®ä¸ºè¿œç¨‹æœåŠ¡å¯¹å¤–æä¾›æ¥å£çš„å…¨é™å®šç±»åã€‚</p>
<p>å¯¼å‡ºå™¨çš„å±æ€§å¹¶æ²¡æœ‰æè¿°æœåŠ¡å¦‚ä½•åŸºäºJMSé€šä¿¡çš„ç»†èŠ‚ã€‚ä½†å¥½æ¶ˆæ¯æ˜¯JmsInvokerServiceExporterå¯ä»¥å……å½“JMSç›‘å¬å™¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>&lt;jms:listenercontainer&gt;</code>å…ƒç´ é…ç½®å®ƒï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;jms:listener-container connection-factory=<span class="string">&quot;connectionFactory&quot;</span>&gt;  &lt;jms:listener destination=<span class="string">&quot;spitter.alert.queue&quot;</span>                ref=<span class="string">&quot;alertServiceExporter&quot;</span> /&gt;&lt;/jms:listener-container&gt;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¸ºJMSç›‘å¬å™¨å®¹å™¨æŒ‡å®šäº†è¿æ¥å·¥å‚ï¼Œæ‰€ä»¥å®ƒèƒ½å¤ŸçŸ¥é“å¦‚ä½•è¿æ¥æ¶ˆæ¯ä»£ç†ï¼Œè€Œ<code>&lt;jms:listener&gt;</code>å£°æ˜æŒ‡å®šäº†è¿œç¨‹æ¶ˆæ¯çš„ç›®çš„åœ°ã€‚</p>
<p>ä½¿ç”¨åŸºäºJMSçš„æœåŠ¡</p>
<p>è¿™æ—¶å€™ï¼ŒåŸºäºJMSçš„æé†’æœåŠ¡å·²ç»å‡†å¤‡å¥½äº†ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­åå­—ä¸ºspitter.alert.queueçš„RPCæ¶ˆæ¯åˆ°è¾¾ã€‚åœ¨å®¢æˆ·ç«¯ï¼ŒJmsInvokerProxyFactoryBeanç”¨æ¥è®¿é—®æœåŠ¡ã€‚<br>JmsInvokerProxyFactoryBeanå¾ˆç±»ä¼¼äºæˆ‘ä»¬åœ¨ç¬¬15ç« ä¸­æ‰€è®¨è®ºçš„å…¶ä»–è¿œç¨‹ä»£ç†å·¥å‚beanã€‚å®ƒéšè—äº†è®¿é—®è¿œç¨‹æœåŠ¡çš„ç»†èŠ‚ï¼Œå¹¶æä¾›ä¸€ä¸ªæ˜“ç”¨çš„æ¥å£ï¼Œé€šè¿‡è¯¥æ¥å£å®¢æˆ·ç«¯ä¸è¿œç¨‹æœåŠ¡è¿›è¡Œäº¤äº’ã€‚ä¸ä»£ç†RMIæœåŠ¡æˆ–HTTPæœåŠ¡çš„æœ€å¤§åŒºåˆ«åœ¨äºï¼ŒJmsInvokerProxyFactoryBeanä»£ç†äº†é€šè¿‡JmsInvokerServiceExporteræ‰€å¯¼å‡ºçš„JMSæœåŠ¡ã€‚</p>
<p>ä¸ºäº†ä½¿ç”¨æé†’æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥åƒä¸‹é¢é‚£æ ·é…ç½®JmsInvokerProxyFactoryBeanï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;alertService&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;org.springframework.jms.remoting.JmsInvokerProxyFactoryBean&quot;</span>      <span class="attr">p:connectionFactory-ref</span>=<span class="string">&quot;connectionFactory&quot;</span>      <span class="attr">p:queueName</span>=<span class="string">&quot;spittle.alert.queue&quot;</span>      <span class="attr">p:serviceInterface</span>=<span class="string">&quot;com.habuma.spittr.alerts.AlertService&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>connectionFactoryå’ŒqueryNameå±æ€§æŒ‡å®šäº†RPCæ¶ˆæ¯å¦‚ä½•è¢«æŠ•é€’â€”â€”åœ¨è¿™é‡Œï¼Œä¹Ÿå°±æ˜¯åœ¨ç»™å®šçš„è¿æ¥å·¥å‚ä¸­ï¼Œæˆ‘ä»¬æ‰€é…ç½®çš„æ¶ˆæ¯ä»£ç†é‡Œé¢åä¸ºspitter.alert.queueçš„é˜Ÿåˆ—ã€‚å¯¹äºserviceInterfaceï¼ŒæŒ‡å®šäº†ä»£ç†åº”è¯¥é€šè¿‡AlertServiceæ¥å£æš´éœ²åŠŸèƒ½ã€‚</p>
<p>å¤šå¹´æ¥ï¼ŒJMSä¸€ç›´æ˜¯Javaåº”ç”¨ä¸­ä¸»æµçš„æ¶ˆæ¯è§£å†³æ–¹æ¡ˆã€‚ä½†æ˜¯å¯¹äºJavaå’ŒSpringå¼€å‘è€…æ¥è¯´ï¼ŒJMSå¹¶ä¸æ˜¯å”¯ä¸€çš„æ¶ˆæ¯å¯é€‰æ–¹æ¡ˆã€‚åœ¨è¿‡å»çš„å‡ å¹´ä¸­ï¼Œé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼ˆAdvanced Message Queuing Protocol ï¼ŒAMQPï¼‰å¾—åˆ°äº†å¹¿æ³›çš„å…³æ³¨ã€‚å› æ­¤ï¼ŒSpringä¹Ÿä¸ºé€šè¿‡AMQPå‘é€æ¶ˆæ¯æä¾›äº†æ”¯æŒï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä¸‹é¢è¦è®²è§£çš„å†…å®¹ã€‚</p>
<h3 id="ä½¿ç”¨AMQPå®ç°æ¶ˆæ¯åŠŸèƒ½"><a href="#ä½¿ç”¨AMQPå®ç°æ¶ˆæ¯åŠŸèƒ½" class="headerlink" title="ä½¿ç”¨AMQPå®ç°æ¶ˆæ¯åŠŸèƒ½"></a>ä½¿ç”¨AMQPå®ç°æ¶ˆæ¯åŠŸèƒ½</h3><p>ä½ å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆè¿˜éœ€è¦å¦å¤–ä¸€ä¸ªæ¶ˆæ¯è§„èŒƒã€‚éš¾é“JMSè¿˜ä¸å¤Ÿå¥½å—ï¼ŸAMQPæä¾›äº†å“ªäº›JMSæ‰€ä¸å…·å¤‡çš„ç‰¹æ€§å‘¢ï¼Ÿå®é™…ä¸Šï¼ŒAMQPå…·æœ‰å¤šé¡¹JMSæ‰€ä¸å…·å¤‡çš„ä¼˜åŠ¿ã€‚é¦–å…ˆï¼ŒAMQPä¸ºæ¶ˆæ¯å®šä¹‰äº†çº¿è·¯å±‚ï¼ˆwire-level protocolï¼‰çš„åè®®ï¼Œè€ŒJMSæ‰€å®šä¹‰çš„æ˜¯APIè§„èŒƒã€‚JMSçš„APIåè®®èƒ½å¤Ÿç¡®ä¿æ‰€æœ‰çš„å®ç°éƒ½èƒ½é€šè¿‡é€šç”¨çš„APIæ¥ä½¿ç”¨ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯æŸä¸ªJMSå®ç°æ‰€å‘é€çš„æ¶ˆæ¯èƒ½å¤Ÿè¢«å¦å¤–ä¸åŒçš„JMSå®ç°æ‰€ä½¿ç”¨ã€‚è€ŒAMQPçš„çº¿è·¯å±‚åè®®è§„èŒƒäº†æ¶ˆæ¯çš„æ ¼å¼ï¼Œæ¶ˆæ¯åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—´ä¼ é€çš„æ—¶å€™ä¼šéµå¾ªè¿™ä¸ªæ ¼å¼ã€‚è¿™æ ·AMQPåœ¨äº’ç›¸åä½œæ–¹é¢å°±è¦ä¼˜äºJMSâ€”â€”å®ƒä¸ä»…èƒ½è·¨ä¸åŒçš„AMQPå®ç°ï¼Œè¿˜èƒ½è·¨è¯­è¨€å’Œå¹³å°ã€‚</p>
<p>ç›¸æ¯”JMSï¼ŒAMQPå¦å¤–ä¸€ä¸ªæ˜æ˜¾çš„ä¼˜åŠ¿åœ¨äºå®ƒå…·æœ‰æ›´åŠ çµæ´»å’Œé€æ˜çš„æ¶ˆæ¯æ¨¡å‹ã€‚ä½¿ç”¨JMSçš„è¯ï¼Œåªæœ‰ä¸¤ç§æ¶ˆæ¯æ¨¡å‹å¯ä¾›é€‰æ‹©ï¼šç‚¹å¯¹ç‚¹å’Œå‘å¸ƒ-è®¢é˜…ã€‚è¿™ä¸¤ç§æ¨¡å‹åœ¨AMQPå½“ç„¶éƒ½æ˜¯å¯ä»¥å®ç°çš„ï¼Œä½†AMQPè¿˜èƒ½å¤Ÿè®©æˆ‘ä»¬ä»¥å…¶ä»–çš„å¤šç§æ–¹å¼æ¥å‘é€æ¶ˆæ¯ï¼Œè¿™æ˜¯é€šè¿‡å°†æ¶ˆæ¯çš„ç”Ÿäº§è€…ä¸å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—è§£è€¦å®ç°çš„ã€‚</p>
<p>Spring AMQPæ˜¯Springæ¡†æ¶çš„æ‰©å±•ï¼Œå®ƒèƒ½å¤Ÿè®©æˆ‘ä»¬åœ¨Springåº”ç”¨ä¸­ä½¿ç”¨AMQPé£æ ¼çš„æ¶ˆæ¯ã€‚ç¨åå¯ä»¥çœ‹åˆ°ï¼ŒSpring AMQPæä¾›äº†ä¸€ä¸ªAPIï¼Œå€ŸåŠ©è¿™ä¸ªAPIï¼Œæˆ‘ä»¬èƒ½å¤Ÿä»¥éå¸¸ç±»ä¼¼äºSpring JMSæŠ½è±¡çš„å½¢å¼æ¥ä½¿ç”¨AMQPã€‚è¿™æ„å‘³ç€ï¼Œæˆ‘ä»¬åœ¨æœ¬ç« ä¹‹å‰æ‰€å­¦ä¹ çš„JMSå†…å®¹èƒ½å¤Ÿå¸®åŠ©ä½ ç†è§£å¦‚ä½•ä½¿ç”¨Spring AMQPæ¥å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚</p>
<p>æˆ‘ä»¬ç¨åå°±ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨Spring AMQPï¼Œä½†æ˜¯åœ¨æ·±å…¥å­¦ä¹ å¦‚ä½•åœ¨Springä¸­å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ä¹‹å‰ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹åˆ°åº•æ˜¯ä»€ä¹ˆè®©AMQPå¦‚æ­¤å¼•äººå…³æ³¨ã€‚</p>
<h4 id="AMQPç®€ä»‹"><a href="#AMQPç®€ä»‹" class="headerlink" title="AMQPç®€ä»‹"></a>AMQPç®€ä»‹</h4><p>ç®€å•å›å¿†ä¸€ä¸‹JMSçš„æ¶ˆæ¯æ¨¡å‹ï¼Œå¯èƒ½ä¼šæœ‰åŠ©äºç†è§£AMQPçš„æ¶ˆæ¯æ¨¡å‹ã€‚åœ¨JMSä¸­ï¼Œæœ‰ä¸‰ä¸ªä¸»è¦çš„å‚ä¸è€…ï¼šæ¶ˆæ¯çš„ç”Ÿäº§è€…ã€æ¶ˆæ¯çš„æ¶ˆè´¹è€…ä»¥åŠåœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´ä¼ é€’æ¶ˆæ¯çš„é€šé“ï¼ˆé˜Ÿåˆ—æˆ–ä¸»é¢˜ï¼‰ã€‚JMSæ¶ˆæ¯æ¨¡å‹ä¸­çš„å…³é”®å…ƒç´ åœ¨å›¾17.3å’Œå›¾17.4ä¸­è¿›è¡Œäº†æè¿°ã€‚</p>
<p>åœ¨JMSä¸­ï¼Œé€šé“æœ‰åŠ©äºè§£è€¦æ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œä½†æ˜¯è¿™ä¸¤è€…ä¾ç„¶ä¼šä¸é€šé“ç›¸è€¦åˆã€‚ç”Ÿäº§è€…ä¼šå°†æ¶ˆæ¯å‘å¸ƒåˆ°ä¸€ä¸ªç‰¹å®šçš„é˜Ÿåˆ—æˆ–ä¸»é¢˜ä¸Šï¼Œæ¶ˆè´¹è€…ä»ç‰¹å®šçš„é˜Ÿåˆ—æˆ–ä¸»é¢˜ä¸Šæ¥æ”¶è¿™äº›æ¶ˆæ¯ã€‚é€šé“å…·æœ‰åŒé‡è´£ä»»ï¼Œä¹Ÿå°±æ˜¯ä¼ é€’æ•°æ®ä»¥åŠç¡®å®šè¿™äº›æ¶ˆæ¯è¯¥å‘é€åˆ°ä»€ä¹ˆåœ°æ–¹ï¼Œé˜Ÿåˆ—çš„è¯ä¼šä½¿ç”¨ç‚¹å¯¹ç‚¹ç®—æ³•å‘é€ï¼Œä¸»é¢˜çš„è¯å°±ä½¿ç”¨å‘å¸ƒ-è®¢é˜…çš„æ–¹å¼ã€‚</p>
<p>ä¸ä¹‹ä¸åŒçš„æ˜¯ï¼ŒAMQPçš„ç”Ÿäº§è€…å¹¶ä¸ä¼šç›´æ¥å°†æ¶ˆæ¯å‘å¸ƒåˆ°é˜Ÿåˆ—ä¸­ã€‚AMQPåœ¨æ¶ˆæ¯çš„ç”Ÿäº§è€…ä»¥åŠä¼ é€’ä¿¡æ¯çš„é˜Ÿåˆ—ä¹‹é—´å¼•å…¥äº†ä¸€ç§é—´æ¥çš„æœºåˆ¶ï¼šExchangeã€‚è¿™ç§å…³ç³»å¦‚å›¾17.8æ‰€ç¤ºã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211112100131206.png" alt="image-20211112100131206"></p>
<p>å›¾17.8ã€€åœ¨AMQPä¸­ï¼Œé€šè¿‡å¼•å…¥å¤„ç†ä¿¡æ¯è·¯ç”±çš„Exchangeï¼Œæ¶ˆæ¯çš„ç”Ÿäº§è€… ä¸æ¶ˆæ¯é˜Ÿåˆ—ä¹‹é—´å®ç°äº†è§£è€¦</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ¶ˆæ¯çš„ç”Ÿäº§è€…å°†ä¿¡æ¯å‘å¸ƒåˆ°ä¸€ä¸ªExchangeã€‚Exchangeä¼šç»‘å®šåˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ä¸Šï¼Œå®ƒè´Ÿè´£å°†ä¿¡æ¯è·¯ç”±åˆ°é˜Ÿåˆ—ä¸Šã€‚ä¿¡æ¯çš„æ¶ˆè´¹è€…ä¼šä»é˜Ÿåˆ—ä¸­æå–æ•°æ®å¹¶è¿›è¡Œå¤„ç†ã€‚</p>
<p>å›¾17.8æ‰€æ²¡æœ‰å±•ç°å‡ºæ¥çš„ä¸€ç‚¹æ˜¯Exchangeä¸æ˜¯ç®€å•åœ°å°†æ¶ˆæ¯ä¼ é€’åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä¸ä»…ä»…æ˜¯ä¸€ç§ç©¿é€ï¼ˆpass-throughï¼‰æœºåˆ¶ã€‚AMQPå®šä¹‰äº†å››ç§ä¸åŒç±»å‹çš„Exchangeï¼Œæ¯ä¸€ç§éƒ½æœ‰ä¸åŒçš„è·¯ç”±ç®—æ³•ï¼Œè¿™äº›ç®—æ³•å†³å®šäº†æ˜¯å¦è¦å°†ä¿¡æ¯æ”¾åˆ°é˜Ÿåˆ—ä¸­ã€‚æ ¹æ®Exchangeçš„ç®—æ³•ä¸åŒï¼Œå®ƒå¯èƒ½ä¼šä½¿ç”¨æ¶ˆæ¯çš„routing keyå’Œ/æˆ–å‚æ•°ï¼Œå¹¶å°†å…¶ä¸Exchangeå’Œé˜Ÿåˆ—ä¹‹é—´bindingçš„routing keyå’Œå‚æ•°è¿›è¡Œå¯¹æ¯”ã€‚ï¼ˆrouting keyå¯ä»¥å¤§è‡´ç†è§£ä¸ºEmailçš„æ”¶ä»¶äººåœ°å€ï¼ŒæŒ‡å®šäº†é¢„æœŸçš„æ¥æ”¶è€…ã€‚ï¼‰å¦‚æœå¯¹æ¯”ç»“æœæ»¡è¶³ç›¸åº”çš„ç®—æ³•ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°†ä¼šè·¯ç”±åˆ°é˜Ÿåˆ—ä¸Šã€‚å¦åˆ™çš„è¯ï¼Œå°†ä¸ä¼šè·¯ç”±åˆ°é˜Ÿåˆ—ä¸Šã€‚</p>
<p>å››ç§æ ‡å‡†çš„AMQP Exchangeå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>Directï¼šå¦‚æœæ¶ˆæ¯çš„routing keyä¸bindingçš„routing keyç›´æ¥åŒ¹é…çš„è¯ï¼Œæ¶ˆæ¯å°†ä¼šè·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ä¸Šï¼›</li>
<li>Topicï¼šå¦‚æœæ¶ˆæ¯çš„routing keyä¸bindingçš„routing keyç¬¦åˆé€šé…ç¬¦åŒ¹é…çš„è¯ï¼Œæ¶ˆæ¯å°†ä¼šè·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ä¸Šï¼›</li>
<li>Headersï¼šå¦‚æœæ¶ˆæ¯å‚æ•°è¡¨ä¸­çš„å¤´ä¿¡æ¯å’Œå€¼éƒ½ä¸bingdingå‚æ•°è¡¨ä¸­ç›¸åŒ¹é…ï¼Œæ¶ˆæ¯å°†ä¼šè·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ä¸Šï¼›</li>
<li>Fanoutï¼šä¸ç®¡æ¶ˆæ¯çš„routing keyå’Œå‚æ•°è¡¨çš„å¤´ä¿¡æ¯/å€¼æ˜¯ä»€ä¹ˆï¼Œæ¶ˆæ¯å°†ä¼šè·¯ç”±åˆ°æ‰€æœ‰é˜Ÿåˆ—ä¸Šã€‚</li>
</ul>
<p>å€ŸåŠ©è¿™å››ç§ç±»å‹çš„Exchangeï¼Œå¾ˆå®¹æ˜“å°±èƒ½æƒ³åˆ°æˆ‘ä»¬å¯ä»¥å®šä¹‰ä»»æ„æ•°é‡çš„è·¯ç”±æ¨¡å¼ï¼Œè€Œä¸å†ä»…é™äºç‚¹å¯¹ç‚¹å’Œå‘å¸ƒ-è®¢é˜…çš„æ–¹å¼ã€‚å¥½æ¶ˆæ¯æ˜¯ï¼Œå½“å‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™ï¼Œæ‰€æ¶‰åŠçš„è·¯ç”±ç®—æ³•å¯¹äºå¦‚ä½•ç¼–å†™æ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¹¶æ²¡æœ‰ä»€ä¹ˆå½±å“ã€‚ç®€å•æ¥è®²ï¼Œç”Ÿäº§è€…å°†ä¿¡æ¯å‘é€ç»™Exchangeå¹¶å¸¦æœ‰ä¸€ä¸ªrouting keyï¼Œæ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ã€‚</p>
<p>æˆ‘ä»¬å·²ç»å¿«é€Ÿäº†è§£äº†AMQPæ¶ˆæ¯çš„åŸºæœ¬çŸ¥è¯†â€”â€”æ­¤æ—¶åº”è¯¥å·²ç»èƒ½å¤Ÿç†è§£æˆ‘ä»¬æ¥ä¸‹æ¥æ‰€è¦ä»‹ç»çš„å¦‚ä½•ä½¿ç”¨Springå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚ä½†æ˜¯ï¼Œæˆ‘å»ºè®®ä½ æ›´æ·±å…¥çš„å­¦ä¹ ä¸€ä¸‹AMQPï¼Œå¯ä»¥é˜…è¯»è§„èŒƒå’Œ<a target="_blank" rel="noopener" href="http://www.amqp.orgç«™ç‚¹ä¸Šçš„å…¶ä»–èµ„æ–™,æˆ–è€…å¯ä»¥é˜…è¯»alvaro/">www.amqp.orgç«™ç‚¹ä¸Šçš„å…¶ä»–èµ„æ–™ï¼Œæˆ–è€…å¯ä»¥é˜…è¯»Alvaro</a> Videlaå’ŒJason J.W. Williamsæ‰€ç¼–å†™çš„ã€ŠRabbitMQ in Actionã€‹ï¼ˆManning, 2012, <a target="_blank" rel="noopener" href="http://www.manning.com/videla/%EF%BC%89%E3%80%82">www.manning.com/videla/ï¼‰ã€‚</a></p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬ç»“æŸå¯¹AMQPçš„æŠ½è±¡è®¨è®ºï¼Œå¼€å§‹ç€æ‰‹ç¼–å†™å€ŸåŠ©Spring AMQPå‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„ä»£ç ã€‚é¦–å…ˆæˆ‘ä»¬å°†çœ‹åˆ°çš„æ˜¯ä¸€äº›é€šç”¨çš„é…ç½®ï¼Œå®ƒä»¬åŒæ—¶é€‚ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚</p>
<h4 id="é…ç½®Springæ”¯æŒAMQPæ¶ˆæ¯"><a href="#é…ç½®Springæ”¯æŒAMQPæ¶ˆæ¯" class="headerlink" title="é…ç½®Springæ”¯æŒAMQPæ¶ˆæ¯"></a>é…ç½®Springæ”¯æŒAMQPæ¶ˆæ¯</h4><p>å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡ä½¿ç”¨Spring JMSæŠ½è±¡çš„æ—¶å€™ï¼Œé¦–å…ˆé…ç½®äº†ä¸€ä¸ªè¿æ¥å·¥å‚ã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œä½¿ç”¨Spring AMQPå‰ä¹Ÿè¦é…ç½®ä¸€ä¸ªè¿æ¥å·¥å‚ã€‚åªä¸è¿‡ï¼Œæ‰€è¦é…ç½®çš„ä¸æ˜¯JMSçš„è¿æ¥å·¥å‚ï¼Œè€Œæ˜¯éœ€è¦é…ç½®AMQPçš„è¿æ¥å·¥å‚ã€‚æ›´å…·ä½“æ¥è®²ï¼Œéœ€è¦é…ç½®RabbitMQè¿æ¥å·¥å‚ã€‚</p>
<p>ä»€ä¹ˆæ˜¯RabbitMQ</p>
<p>RabbitMQæ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æºæ¶ˆæ¯ä»£ç†ï¼Œå®ƒå®ç°äº†AMQPã€‚Spring AMQPä¸ºRabbitMQæä¾›äº†æ”¯æŒï¼ŒåŒ…æ‹¬RabbitMQè¿æ¥å·¥å‚ã€æ¨¡æ¿ä»¥åŠSpringé…ç½®å‘½åç©ºé—´ã€‚</p>
<p>åœ¨ä½¿ç”¨å®ƒå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ä¹‹å‰ï¼Œä½ éœ€è¦é¢„å…ˆå®‰è£…RabbitMQã€‚æˆ‘ä»¬å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="http://www.rabbitmq.com/download.html%E4%B8%8A%E6%89%BE%E5%88%B0%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97%E3%80%82%E6%A0%B9%E6%8D%AE%E4%BD%A0%E6%89%80%E8%BF%90%E8%A1%8C%E7%9A%84OS%E4%B8%8D%E5%90%8C%EF%BC%8C%E8%BF%99%E4%BC%9A%E6%9C%89%E6%89%80%E5%B7%AE%E5%88%AB%EF%BC%8C%E6%89%80%E4%BB%A5%E6%A0%B9%E6%8D%AE%E7%8E%AF%E5%A2%83%E7%9A%84%E4%B8%8D%E5%90%8C%EF%BC%8C%E9%81%B5%E5%BE%AA%E7%9B%B8%E5%BA%94%E6%8C%87%E5%8D%97%E8%BF%9B%E8%A1%8C%E5%AE%89%E8%A3%85%E7%9A%84%E4%BB%BB%E5%8A%A1%E5%B0%B1%E7%95%99%E7%BB%99%E8%AF%BB%E8%80%85%E8%87%AA%E5%B7%B1%E5%AE%8C%E6%88%90%E3%80%82">www.rabbitmq.com/download.htmlä¸Šæ‰¾åˆ°å®‰è£…æŒ‡å—ã€‚æ ¹æ®ä½ æ‰€è¿è¡Œçš„OSä¸åŒï¼Œè¿™ä¼šæœ‰æ‰€å·®åˆ«ï¼Œæ‰€ä»¥æ ¹æ®ç¯å¢ƒçš„ä¸åŒï¼Œéµå¾ªç›¸åº”æŒ‡å—è¿›è¡Œå®‰è£…çš„ä»»åŠ¡å°±ç•™ç»™è¯»è€…è‡ªå·±å®Œæˆã€‚</a></p>
<p>é…ç½®RabbitMQè¿æ¥å·¥å‚æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨Spring AMQPæ‰€æä¾›çš„rabbité…ç½®å‘½åç©ºé—´ã€‚ä¸ºäº†ä½¿ç”¨è¿™é¡¹åŠŸèƒ½ï¼Œéœ€è¦ç¡®ä¿åœ¨Springé…ç½®æ–‡ä»¶ä¸­å·²ç»å£°æ˜äº†è¯¥æ¨¡å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>  <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/rabbit&quot;</span>  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;    http://www.springframework.org/schema/beans    http://www.springframework.org/schema/beans/spring-beans.xsd    http://www.springframework.org/schema/rabbit    http://www.springframework.org/schema/rabbit/spring-rabbit-1.0.xsd&quot;</span> &gt;</span>    ...<span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å°½ç®¡ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æˆ‘è¿˜é€‰æ‹©åœ¨è¿™ä¸ªé…ç½®ä¸­å°†rabbitä½œä¸ºé¦–é€‰çš„å‘½åç©ºé—´ï¼Œå°†beansä½œä¸ºç¬¬äºŒä½çš„å‘½åç©ºé—´ã€‚è¿™æ˜¯å› ä¸ºåœ¨è¿™ä¸ªé…ç½®ä¸­ï¼Œæˆ‘ä¼šæ›´å¤šçš„å£°æ˜rabbitè€Œä¸æ˜¯beanï¼Œè¿™æ ·çš„è¯ï¼Œåªä¼šæœ‰å°‘é‡çš„beanå…ƒç´ ä½¿ç”¨â€œbeans:â€å‰ç¼€ï¼Œè€Œrabbitå…ƒç´ å°±èƒ½å¤Ÿé¿å…ä½¿ç”¨å‰ç¼€äº†ã€‚</p>
<p>rabbitå‘½åç©ºé—´åŒ…å«äº†å¤šä¸ªåœ¨Springä¸­é…ç½®RabbitMQçš„å…ƒç´ ã€‚ä½†æ­¤æ—¶ï¼Œä½ æœ€æ„Ÿå…´è¶£çš„å¯èƒ½å°±æ˜¯<code>&lt;connection-factory&gt;</code>ã€‚æŒ‰ç…§å…¶æœ€ç®€å•çš„å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é…ç½®RabbitMQè¿æ¥å·¥å‚çš„æ—¶å€™æ²¡æœ‰ä»»ä½•å±æ€§ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">connect-factory</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™çš„ç¡®èƒ½å¤Ÿè¿è¡Œèµ·æ¥ï¼Œä½†æ˜¯æ‰€å¯¼è‡´çš„ç»“æœå°±æ˜¯è¿æ¥å·¥å‚beanæ²¡æœ‰å¯ç”¨çš„bean IDï¼Œè¿™æ ·çš„è¯å°±éš¾å°†è¿æ¥å·¥å‚è£…é…åˆ°éœ€è¦å®ƒçš„beanä¸­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›é€šè¿‡idå±æ€§ä¸ºå…¶è®¾ç½®ä¸€ä¸ªbean IDï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">connection-factory</span> <span class="attr">id</span>=<span class="string">&quot;connectionFactory&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿æ¥å·¥å‚ä¼šå‡è®¾RabbitMQæœåŠ¡å™¨ç›‘å¬localhostçš„5672ç«¯å£ï¼Œå¹¶ä¸”ç”¨æˆ·åå’Œå¯†ç å‡ä¸ºguestã€‚å¯¹äºå¼€å‘æ¥è®²ï¼Œè¿™æ˜¯åˆç†çš„é»˜è®¤å€¼ï¼Œä½†æ˜¯å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›ä¿®æ”¹è¿™äº›é»˜è®¤å€¼ã€‚å¦‚ä¸‹<code>&lt;connection-factory&gt;</code>çš„è®¾ç½®é‡å†™äº†é»˜è®¤çš„åšæ³•ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">connection-factory</span> <span class="attr">id</span>=<span class="string">&quot;connectionFactory&quot;</span>                    <span class="attr">host</span>=<span class="string">&quot;$&#123;rabbitmq.host&#125;&quot;</span>                    <span class="attr">username</span>=<span class="string">&quot;$&#123;rabbitmq.username&#125;&quot;</span>                    <span class="attr">password</span>=<span class="string">&quot;$&#123;rabbitmq.password&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä½¿ç”¨å ä½ç¬¦æ¥æŒ‡å®šå€¼ï¼Œè¿™æ ·é…ç½®é¡¹å¯ä»¥åœ¨Springé…ç½®æ–‡ä»¶ä¹‹å¤–è¿›è¡Œç®¡ç†ï¼ˆå¾ˆå¯èƒ½ä½äºå±æ€§æ–‡ä»¶ä¸­ï¼‰ã€‚</p>
<p>é™¤äº†è¿æ¥å·¥å‚ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜è¦è€ƒè™‘ä½¿ç”¨å…¶ä»–çš„å‡ ä¸ªé…ç½®å…ƒç´ ã€‚æ¥ä¸‹æ¥ï¼Œçœ‹ä¸€ä¸‹å¦‚ä½•åˆ›å»ºé˜Ÿåˆ—ã€Exchangeä»¥åŠbindingã€‚</p>
<p>å£°æ˜é˜Ÿåˆ—ã€Exchangeä»¥åŠbinding<br>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p>
<p>åœ¨JMSä¸­ï¼Œé˜Ÿåˆ—å’Œä¸»é¢˜çš„è·¯ç”±è¡Œä¸ºéƒ½æ˜¯é€šè¿‡è§„èŒƒå»ºç«‹çš„ï¼ŒAMQPä¸ä¹‹ä¸åŒï¼Œå®ƒçš„è·¯ç”±æ›´åŠ ä¸°å¯Œå’Œçµæ´»ï¼Œä¾èµ–äºå¦‚ä½•å®šä¹‰é˜Ÿåˆ—å’ŒExchangeä»¥åŠå¦‚ä½•å°†å®ƒä»¬ç»‘å®šåœ¨ä¸€èµ·ã€‚å£°æ˜é˜Ÿåˆ—ã€Exchangeå’Œbindingçš„ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨RabbitMQ Channelæ¥å£çš„å„ç§æ–¹æ³•ã€‚ä½†æ˜¯ç›´æ¥ä½¿ç”¨RabbitMQçš„Channelæ¥å£éå¸¸éº»çƒ¦ã€‚Spring AMQPèƒ½å¦å¸®åŠ©æˆ‘ä»¬å£°æ˜æ¶ˆæ¯è·¯ç”±ç»„ä»¶å‘¢ï¼Ÿ</p>
<p>å¹¸å¥½ï¼Œrabbitå‘½åç©ºé—´åŒ…å«äº†å¤šä¸ªå…ƒç´ ï¼Œå¸®åŠ©æˆ‘ä»¬å£°æ˜é˜Ÿåˆ—ã€Exchangeä»¥åŠå°†å®ƒä»¬ç»“åˆåœ¨ä¸€èµ·çš„bindingã€‚è¡¨17.3ä¸­åˆ—å‡ºäº†è¿™äº›å…ƒç´ ã€‚</p>
<p>è¡¨17.3ã€€Spring AMQPçš„rabbitå‘½åç©ºé—´åŒ…å«äº†å¤šä¸ªå…ƒç´ ï¼Œç”¨æ¥åˆ›å»ºé˜Ÿåˆ—ã€Exchangeä»¥åŠå°†å®ƒä»¬ç»“åˆåœ¨ä¸€èµ·çš„binding</p>
<table>
<thead>
<tr>
<th>å…ƒã€€ã€€ç´ </th>
<th>ä½œã€€ã€€ç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><queue></queue></td>
<td>åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—</td>
</tr>
<tr>
<td><fanout-exchange></fanout-exchange></td>
<td>åˆ›å»ºä¸€ä¸ªfanoutç±»å‹çš„Exchange</td>
</tr>
<tr>
<td><header-exchange></header-exchange></td>
<td>åˆ›å»ºä¸€ä¸ªheaderç±»å‹çš„Exchange</td>
</tr>
<tr>
<td><topic-exchange></topic-exchange></td>
<td>åˆ›å»ºä¸€ä¸ªtopicç±»å‹çš„Exchange</td>
</tr>
<tr>
<td><direct-exchange></direct-exchange></td>
<td>åˆ›å»ºä¸€ä¸ªdirectç±»å‹çš„Exchange</td>
</tr>
<tr>
<td><bindings><binding></binding></bindings></td>
<td>å…ƒç´ å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ çš„é›†åˆã€‚å…ƒç´ åˆ›å»ºExchangeå’Œé˜Ÿåˆ—ä¹‹é—´çš„binding</td>
</tr>
</tbody></table>
<p> è¿™äº›é…ç½®å…ƒç´ è¦ä¸<admin>å…ƒç´ ä¸€èµ·ä½¿ç”¨ã€‚<admin>å…ƒç´ ä¼šåˆ›å»ºä¸€ä¸ªRabbitMQç®¡ç†ç»„ä»¶ï¼ˆadministrative componentï¼‰ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»ºï¼ˆå¦‚æœå®ƒä»¬åœ¨RabbitMQä»£ç†ä¸­å°šæœªå­˜åœ¨çš„è¯)ä¸Šè¿°è¿™äº›å…ƒç´ æ‰€å£°æ˜çš„é˜Ÿåˆ—ã€Exchangeä»¥åŠbindingã€‚</admin></admin></p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœä½ å¸Œæœ›å£°æ˜åä¸ºspittle.alert.queueçš„é˜Ÿåˆ—ï¼Œåªéœ€è¦åœ¨Springé…ç½®ä¸­æ·»åŠ å¦‚ä¸‹çš„ä¸¤ä¸ªå…ƒç´ å³å¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">admin</span> <span class="attr">connection-factory</span>=<span class="string">&quot;connnectionFactory&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">queue</span> <span class="attr">id</span>=<span class="string">&quot;spittleAlertQueue&quot;</span> <span class="attr">name</span>=<span class="string">&quot;spittle.alerts&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯¹äºç®€å•çš„æ¶ˆæ¯æ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€åšè¿™äº›å°±è¶³å¤Ÿäº†ã€‚è¿™æ˜¯å› ä¸ºé»˜è®¤ä¼šæœ‰ä¸€ä¸ªæ²¡æœ‰åç§°çš„direct Exchangeï¼Œæ‰€æœ‰çš„é˜Ÿåˆ—éƒ½ä¼šç»‘å®šåˆ°è¿™ä¸ªExchangeä¸Šï¼Œå¹¶ä¸”routing keyä¸é˜Ÿåˆ—çš„åç§°ç›¸åŒã€‚åœ¨è¿™ä¸ªç®€å•çš„é…ç½®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°è¿™ä¸ªæ²¡æœ‰åç§°çš„Exchangeä¸Šï¼Œå¹¶å°†routing keyè®¾å®šä¸ºspittle.alert.queueï¼Œè¿™æ ·æ¶ˆæ¯å°±ä¼šè·¯ç”±åˆ°è¿™ä¸ªé˜Ÿåˆ—ä¸­ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬é‡æ–°åˆ›å»ºäº†JMSçš„ç‚¹å¯¹ç‚¹æ¨¡å‹ã€‚</p>
<p>ä½†æ˜¯ï¼Œæ›´åŠ æœ‰æ„æ€çš„è·¯ç”±éœ€è¦æˆ‘ä»¬å£°æ˜ä¸€ä¸ªæˆ–æ›´å¤šçš„Exchangeï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°é˜Ÿåˆ—ä¸Šã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¦å°†æ¶ˆæ¯è·¯ç”±åˆ°å¤šä¸ªé˜Ÿåˆ—ä¸­ï¼Œè€Œä¸ç®¡routing keyæ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼é…ç½®ä¸€ä¸ªfanoutä»¥åŠå¤šä¸ªé˜Ÿåˆ—ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">amdin</span> <span class="attr">connection-factory</span>=<span class="string">&quot;connectionFactory&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">queue</span> <span class="attr">name</span>=<span class="string">&quot;spittle.alert.queue.1&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">queue</span> <span class="attr">name</span>=<span class="string">&quot;spittle.alert.queue.2&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">queue</span> <span class="attr">name</span>=<span class="string">&quot;spittle.alert.queue.3&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">fanout-exchange</span> <span class="attr">name</span>=<span class="string">&quot;spittle.fanout&quot;</span> &gt;</span>  <span class="tag">&lt;<span class="name">bindings</span>&gt;</span>    <span class="tag">&lt;<span class="name">binding</span> <span class="attr">queue</span>=<span class="string">&quot;spittle.alert.queue.1&quot;</span> /&gt;</span>    <span class="tag">&lt;<span class="name">binding</span> <span class="attr">queue</span>=<span class="string">&quot;spittle.alert.queue.2&quot;</span> /&gt;</span>    <span class="tag">&lt;<span class="name">binding</span> <span class="attr">queue</span>=<span class="string">&quot;spittle.alert.queue.3&quot;</span> /&gt;</span>  <span class="tag">&lt;<span class="name">bindings</span>&gt;</span><span class="tag">&lt;/<span class="name">fanout-exchange</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å€ŸåŠ©è¡¨17.3ä¸­çš„å…ƒç´ ï¼Œä¼šæœ‰æ— æ•°ç§åœ¨RabbitMQé…ç½®è·¯ç”±çš„æ–¹å¼ï¼Œä½†æ˜¯æˆ‘å´æ²¡æœ‰æ— å°½çš„ç¯‡å¹…æ¥ä¸ºè¯»è€…æè¿°å®ƒä»¬ï¼Œæ‰€ä»¥ä¸ºäº†è®©æˆ‘ä»¬çš„è®¨è®ºä¸è‡³äºåç¦»æ–¹å‘ï¼Œæˆ‘å°†è¿™äº›åˆ›é€ æ€§çš„è·¯ç”±ä½œä¸ºç»ƒä¹ ç•™ç»™è¯»è€…ï¼Œæˆ‘å°†ä¼šç»§ç»­è®¨è®ºå¦‚ä½•å‘é€æ¶ˆæ¯ã€‚</p>
<h4 id="ä½¿ç”¨RabbitTemplateå‘é€æ¶ˆæ¯"><a href="#ä½¿ç”¨RabbitTemplateå‘é€æ¶ˆæ¯" class="headerlink" title="ä½¿ç”¨RabbitTemplateå‘é€æ¶ˆæ¯"></a>ä½¿ç”¨RabbitTemplateå‘é€æ¶ˆæ¯</h4><p>é¡¾åæ€ä¹‰ï¼ŒRabbitMQè¿æ¥å·¥å‚çš„ä½œç”¨æ˜¯åˆ›å»ºåˆ°RabbitMQçš„è¿æ¥ã€‚å¦‚æœä½ å¸Œæœ›é€šè¿‡RabbitMQå‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥å°†connectionFactorybeanæ³¨å…¥åˆ°AlertServiceImplç±»ä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥åˆ›å»ºConnectionï¼Œä½¿ç”¨è¿™ä¸ªConnectionæ¥åˆ›å»ºChannelï¼Œç„¶åä½¿ç”¨è¿™ä¸ªChannelå‘å¸ƒæ¶ˆæ¯åˆ°Exchangeä¸Šã€‚</p>
<p>æ˜¯çš„ï¼Œä½ çš„ç¡®å¯ä»¥è¿™æ ·åšã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™æ ·åšçš„è¯ï¼Œä½ è¦åšè®¸å¤šçš„å·¥ä½œå¹¶ä¸”ä¼šæ¶‰åŠåˆ°å¾ˆå¤šæ ·æ¿å¼ä»£ç ã€‚Springæ‰€è®¨åŒçš„ä¸€ä»¶äº‹æƒ…å°±æ˜¯æ ·æ¿å¼ä»£ç ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°<br>Springæä¾›æ¨¡æ¿æ¥æ¶ˆé™¤æ ·æ¿å¼ä»£ç çš„å¤šä¸ªä¾‹å­â€”â€”åŒ…æ‹¬æœ¬ç« å‰é¢æ‰€ä»‹ç»çš„JmsTemplateï¼Œå®ƒæ¶ˆé™¤äº†JMSçš„æ ·æ¿å¼ä»£ç ã€‚å› æ­¤ï¼ŒSpring AMQPæä¾›RabbitTemplateæ¥æ¶ˆé™¤RabbitMQå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ç›¸å…³çš„æ ·æ¿å¼ä»£ç å°±ä¸€ç‚¹ä¹Ÿä¸è®©äººæ„Ÿè§‰å¥‡æ€ªäº†ã€‚</p>
<p>é…ç½®RabbitTemplateçš„æœ€ç®€å•æ–¹å¼æ˜¯ä½¿ç”¨rabbitå‘½åç©ºé—´çš„<code>&lt;template&gt;</code>å…ƒç´ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;rabbitTemplate&quot;</span> <span class="attr">connection-factory</span>=<span class="string">&quot;connectionFactory&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œè¦å‘é€æ¶ˆæ¯çš„è¯ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ¨¡æ¿beanæ³¨å…¥åˆ°AlertServiceImplä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥å‘é€Spittleã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†ä¸€ä¸ªæ–°ç‰ˆæœ¬çš„AlertServiceImplï¼Œå®ƒä½¿ç”¨RabbitTemplateä»£æ›¿JmsTemplateæ¥å‘é€Spittleæé†’ã€‚</p>
<p>=======<br>åœ¨JMSä¸­ï¼Œé˜Ÿåˆ—å’Œä¸»é¢˜çš„è·¯ç”±è¡Œä¸ºéƒ½æ˜¯é€šè¿‡è§„èŒƒå»ºç«‹çš„ï¼ŒAMQPä¸ä¹‹<br>ä¸åŒï¼Œå®ƒçš„è·¯ç”±æ›´åŠ ä¸°å¯Œå’Œçµæ´»ï¼Œä¾èµ–äºå¦‚ä½•å®šä¹‰é˜Ÿåˆ—å’ŒExchangeä»¥<br>åŠå¦‚ä½•å°†å®ƒä»¬ç»‘å®šåœ¨ä¸€èµ·ã€‚å£°æ˜é˜Ÿåˆ—ã€Exchangeå’Œbindingçš„ä¸€ç§æ–¹å¼<br>æ˜¯ä½¿ç”¨RabbitMQ Channelæ¥å£çš„å„ç§æ–¹æ³•ã€‚ä½†æ˜¯ç›´æ¥ä½¿ç”¨RabbitMQ<br>çš„Channelæ¥å£éå¸¸éº»çƒ¦ã€‚Spring AMQPèƒ½å¦å¸®åŠ©æˆ‘ä»¬å£°æ˜æ¶ˆæ¯è·¯ç”±<br>ç»„ä»¶å‘¢ï¼Ÿ<br>å¹¸å¥½ï¼Œrabbitå‘½åç©ºé—´åŒ…å«äº†å¤šä¸ªå…ƒç´ ï¼Œå¸®åŠ©æˆ‘ä»¬å£°æ˜é˜Ÿåˆ—ã€Exchange<br>ä»¥åŠå°†å®ƒä»¬ç»“åˆåœ¨ä¸€èµ·çš„bindingã€‚è¡¨17.3ä¸­åˆ—å‡ºäº†è¿™äº›å…ƒç´ ã€‚<br>è¡¨17.3ã€€Spring AMQPçš„rabbitå‘½åç©ºé—´åŒ…å«äº†å¤šä¸ªå…ƒç´ ï¼Œç”¨æ¥åˆ›å»ºé˜Ÿåˆ—ã€<br>Exchangeä»¥åŠå°†å®ƒä»¬ç»“åˆåœ¨ä¸€èµ·çš„binding<br>å…ƒã€€ã€€ç´ ä½œã€€ã€€ç”¨<br><queue> åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—<br><fanout-exchange> åˆ›å»ºä¸€ä¸ªfanoutç±»å‹çš„Exchange<br><header-exchange> åˆ›å»ºä¸€ä¸ªheaderç±»å‹çš„Exchange<br><topic-exchange> åˆ›å»ºä¸€ä¸ªtopicç±»å‹çš„Exchange<br><direct-exchange> åˆ›å»ºä¸€ä¸ªdirectç±»å‹çš„Exchange<br><bindings><binding><br></binding></bindings><br>å…ƒç´ å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ çš„é›†åˆã€‚å…ƒç´ åˆ›å»ºExchangeå’Œ<br>é˜Ÿåˆ—ä¹‹é—´çš„binding<br>è¿™äº›é…ç½®å…ƒç´ è¦ä¸<admin>å…ƒç´ ä¸€èµ·ä½¿ç”¨ã€‚<admin>å…ƒç´ ä¼šåˆ›å»ºä¸€<br>ä¸ªRabbitMQç®¡ç†ç»„ä»¶ï¼ˆadministrative componentï¼‰ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»º<br>ï¼ˆå¦‚æœå®ƒä»¬åœ¨RabbitMQä»£ç†ä¸­å°šæœªå­˜åœ¨çš„è¯)ä¸Šè¿°è¿™äº›å…ƒç´ æ‰€å£°æ˜<br>çš„é˜Ÿåˆ—ã€Exchangeä»¥åŠbindingã€‚<br>ä¾‹å¦‚ï¼Œå¦‚æœä½ å¸Œæœ›å£°æ˜åä¸ºspittle.alert.queueçš„é˜Ÿåˆ—ï¼Œåªéœ€<br>è¦åœ¨Springé…ç½®ä¸­æ·»åŠ å¦‚ä¸‹çš„ä¸¤ä¸ªå…ƒç´ å³å¯ï¼š<br>569<br>å¯¹äºç®€å•çš„æ¶ˆæ¯æ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€åšè¿™äº›å°±è¶³å¤Ÿäº†ã€‚è¿™æ˜¯å› ä¸ºé»˜è®¤ä¼šæœ‰<br>ä¸€ä¸ªæ²¡æœ‰åç§°çš„direct Exchangeï¼Œæ‰€æœ‰çš„é˜Ÿåˆ—éƒ½ä¼šç»‘å®šåˆ°è¿™ä¸ªExchange<br>ä¸Šï¼Œå¹¶ä¸”routing keyä¸é˜Ÿåˆ—çš„åç§°ç›¸åŒã€‚åœ¨è¿™ä¸ªç®€å•çš„é…ç½®ä¸­ï¼Œæˆ‘ä»¬<br>å¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°è¿™ä¸ªæ²¡æœ‰åç§°çš„Exchangeä¸Šï¼Œå¹¶å°†routing keyè®¾å®š<br>ä¸ºspittle.alert.queueï¼Œè¿™æ ·æ¶ˆæ¯å°±ä¼šè·¯ç”±åˆ°è¿™ä¸ªé˜Ÿåˆ—ä¸­ã€‚å®<br>é™…ä¸Šï¼Œæˆ‘ä»¬é‡æ–°åˆ›å»ºäº†JMSçš„ç‚¹å¯¹ç‚¹æ¨¡å‹ã€‚<br>ä½†æ˜¯ï¼Œæ›´åŠ æœ‰æ„æ€çš„è·¯ç”±éœ€è¦æˆ‘ä»¬å£°æ˜ä¸€ä¸ªæˆ–æ›´å¤šçš„Exchangeï¼Œå¹¶å°†<br>å…¶ç»‘å®šåˆ°é˜Ÿåˆ—ä¸Šã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¦å°†æ¶ˆæ¯è·¯ç”±åˆ°å¤šä¸ªé˜Ÿåˆ—ä¸­ï¼Œè€Œä¸ç®¡<br>routing keyæ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼é…ç½®ä¸€ä¸ªfanoutä»¥åŠå¤šä¸ª<br>é˜Ÿåˆ—ï¼š<br>å€ŸåŠ©è¡¨17.3ä¸­çš„å…ƒç´ ï¼Œä¼šæœ‰æ— æ•°ç§åœ¨RabbitMQé…ç½®è·¯ç”±çš„æ–¹å¼ï¼Œä½†æ˜¯<br>æˆ‘å´æ²¡æœ‰æ— å°½çš„ç¯‡å¹…æ¥ä¸ºè¯»è€…æè¿°å®ƒä»¬ï¼Œæ‰€ä»¥ä¸ºäº†è®©æˆ‘ä»¬çš„è®¨è®ºä¸è‡³<br>äºåç¦»æ–¹å‘ï¼Œæˆ‘å°†è¿™äº›åˆ›é€ æ€§çš„è·¯ç”±ä½œä¸ºç»ƒä¹ ç•™ç»™è¯»è€…ï¼Œæˆ‘å°†ä¼šç»§ç»­<br>è®¨è®ºå¦‚ä½•å‘é€æ¶ˆæ¯ã€‚<br>17.3.3ã€€ä½¿ç”¨RabbitTemplateå‘é€æ¶ˆæ¯<br>é¡¾åæ€ä¹‰ï¼ŒRabbitMQè¿æ¥å·¥å‚çš„ä½œç”¨æ˜¯åˆ›å»ºåˆ°RabbitMQçš„è¿æ¥ã€‚å¦‚<br>æœä½ å¸Œæœ›é€šè¿‡RabbitMQå‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥<br>å°†connectionFactorybeanæ³¨å…¥åˆ°AlertServiceImplç±»ä¸­ï¼Œå¹¶<br>ä½¿ç”¨å®ƒæ¥åˆ›å»ºConnectionï¼Œä½¿ç”¨è¿™ä¸ªConnectionæ¥åˆ›å»º<br>Channelï¼Œç„¶åä½¿ç”¨è¿™ä¸ªChannelå‘å¸ƒæ¶ˆæ¯åˆ°Exchangeä¸Šã€‚<br>æ˜¯çš„ï¼Œä½ çš„ç¡®å¯ä»¥è¿™æ ·åšã€‚<br>ä½†æ˜¯ï¼Œå¦‚æœè¿™æ ·åšçš„è¯ï¼Œä½ è¦åšè®¸å¤šçš„å·¥ä½œå¹¶ä¸”ä¼šæ¶‰åŠåˆ°å¾ˆå¤šæ ·æ¿å¼<br>ä»£ç ã€‚Springæ‰€è®¨åŒçš„ä¸€ä»¶äº‹æƒ…å°±æ˜¯æ ·æ¿å¼ä»£ç ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°<br>Springæä¾›æ¨¡æ¿æ¥æ¶ˆé™¤æ ·æ¿å¼ä»£ç çš„å¤šä¸ªä¾‹å­â€”â€”åŒ…æ‹¬æœ¬ç« å‰é¢æ‰€ä»‹<br>ç»çš„JmsTemplateï¼Œå®ƒæ¶ˆé™¤äº†JMSçš„æ ·æ¿å¼ä»£ç ã€‚å› æ­¤ï¼ŒSpring<br>AMQPæä¾›RabbitTemplateæ¥æ¶ˆé™¤RabbitMQå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ç›¸å…³<br>570<br>çš„æ ·æ¿å¼ä»£ç å°±ä¸€ç‚¹ä¹Ÿä¸è®©äººæ„Ÿè§‰å¥‡æ€ªäº†ã€‚<br>é…ç½®RabbitTemplateçš„æœ€ç®€å•æ–¹å¼æ˜¯ä½¿ç”¨rabbitå‘½åç©ºé—´çš„</admin></admin></direct-exchange></topic-exchange></header-exchange></fanout-exchange></queue></p>
<p><template>å…ƒç´ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br>ç°åœ¨ï¼Œè¦å‘é€æ¶ˆæ¯çš„è¯ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ¨¡æ¿beanæ³¨å…¥<br>åˆ°AlertServiceImplä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥å‘é€Spittleã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…<br>å•å±•ç°äº†ä¸€ä¸ªæ–°ç‰ˆæœ¬çš„AlertServiceImplï¼Œå®ƒä½¿<br>ç”¨RabbitTemplateä»£æ›¿JmsTemplateæ¥å‘é€Spittleæé†’ã€‚</template></p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>f1aaa068b9ac5f8ec08770544f6994940c9e1eff<br>ç¨‹åºæ¸…å•17.7ã€€ä½¿ç”¨RabbitTemplateæ¥å‘é€Spittle</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spitter.alerts;<span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> com.habuma.spitter.domain.Spittle;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AlertServicelmpl</span> <span class="keyword">implements</span> <span class="title">AlertService</span> </span>&#123;  <span class="keyword">private</span> RabbitTemplate rabbit;    <span class="meta">@Autowired</span>  <span class="function"><span class="keyword">public</span> <span class="title">AlertServicelmpl</span><span class="params">(RabbitTemplate rabbit)</span> </span>&#123;    <span class="keyword">this</span>.rabbit = rabbit;  &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSpittleAlert</span><span class="params">(Spittle spittle)</span> </span>&#123;    rabbit.convertAndSend(<span class="string">&quot;spittle.alert.exchange&quot;</span>, <span class="string">&quot;spittle.alerts&quot;</span>, spittle);  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œç°åœ¨sendSpittleAlert()è°ƒç”¨RabbitTemplateçš„convertAndSend()æ–¹æ³•ï¼Œå…¶ä¸­RabbitTemplateæ˜¯è¢«æ³¨å…¥è¿›æ¥çš„ã€‚å®ƒä¼ å…¥äº†ä¸‰ä¸ªå‚æ•°ï¼šExchangeçš„åç§°ã€routing keyä»¥åŠè¦å‘é€çš„å¯¹è±¡ã€‚æ³¨æ„ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰æŒ‡å®šæ¶ˆæ¯è¯¥è·¯ç”±åˆ°ä½•å¤„ã€è¦å‘é€ç»™å“ªä¸ªé˜Ÿåˆ—ä»¥åŠæœŸæœ›å“ªä¸ªæ¶ˆè´¹è€…æ¥è·å–æ¶ˆæ¯ã€‚</p>
<p>RabbitTemplateæœ‰å¤šä¸ªé‡è½½ç‰ˆæœ¬çš„convertAndSend()æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥ç®€åŒ–å®ƒçš„ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨æŸä¸ªé‡è½½ç‰ˆæœ¬çš„convertAndSend()æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨convertAndSend()çš„æ—¶å€™ï¼Œä¸è®¾ç½®Exchangeçš„åç§°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbit.convertAndSend(<span class="string">&quot;spittle.alerts&quot;</span>, spittle);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æ„¿æ„çš„è¯ï¼Œè¿˜å¯ä»¥åŒæ—¶çœç•¥Exchangeåç§°å’Œrouting keyï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbit.convertAndSend(spittle);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨å‚æ•°åˆ—è¡¨ä¸­çœç•¥Exchangeåç§°ï¼Œæˆ–è€…åŒæ—¶çœç•¥Exchangeåç§°å’Œrouting keyçš„è¯ï¼ŒRabbitTemplateå°†ä¼šä½¿ç”¨é»˜è®¤çš„Exchangeåç§°å’Œrouting keyã€‚æŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„é…ç½®ï¼Œé»˜è®¤çš„Exchangeåç§°ä¸ºç©ºï¼ˆæˆ–è€…è¯´æ˜¯é»˜è®¤æ²¡æœ‰åç§°çš„é‚£ä¸€ä¸ªExchangeï¼‰ï¼Œé»˜è®¤çš„routing keyä¹Ÿä¸ºç©ºã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>&lt;template&gt;</code>å…ƒç´ ä¸Šå€ŸåŠ©exchangeå’Œroutingkeyå±æ€§é…ç½®ä¸åŒçš„é»˜è®¤å€¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;rabbitTemplate&quot;</span>          <span class="attr">connection-factory</span>=<span class="string">&quot;connectionFactory&quot;</span>          <span class="attr">exchange</span>=<span class="string">&quot;spittle.alert.exchange&quot;</span>          <span class="attr">routing-key</span>=<span class="string">&quot;spittle.alerts&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡è®¾ç½®çš„é»˜è®¤å€¼æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬éƒ½å¯ä»¥åœ¨è°ƒç”¨convertAndSend()æ–¹æ³•çš„æ—¶å€™ï¼Œä»¥å‚æ•°çš„å½¢å¼æ˜¾å¼æŒ‡å®šå®ƒä»¬ï¼Œä»è€Œè¦†ç›–æ‰é»˜è®¤å€¼ã€‚</p>
<p>RabbitTemplateè¿˜æœ‰å…¶ä»–çš„æ–¹æ³•æ¥å‘é€æ¶ˆæ¯ï¼Œä½ å¯èƒ½ä¼šå¯¹æ­¤æ„Ÿå…´è¶£ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¾ƒä½ç­‰çº§çš„send()æ–¹æ³•æ¥å‘é€org.springframework.amqp.core.Messageå¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Message helloMessage = <span class="keyword">new</span> Message(<span class="string">&quot;Hello World!&quot;</span>.getBytes(), <span class="keyword">new</span> MessageProperties());rabbit.send(<span class="string">&quot;hello.exchange&quot;</span>, <span class="string">&quot;hello.routing&quot;</span>, helloMessage);</span><br></pre></td></tr></table></figure>

<p>ä¸convertAndSend()æ–¹æ³•ç±»ä¼¼ï¼Œsend()æ–¹æ³•ä¹Ÿæœ‰é‡è½½å½¢å¼ï¼Œå®ƒä»¬ä¸éœ€è¦æä¾›Exchangeåç§°å’Œ/æˆ–routing keyã€‚</p>
<p>ä½¿ç”¨send()æ–¹æ³•çš„æŠ€å·§åœ¨äºæ„é€ è¦å‘é€çš„Messageå¯¹è±¡ã€‚åœ¨è¿™ä¸ªâ€œHello Worldâ€æ ·ä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç»™å®šå­—ç¬¦ä¸²çš„å­—èŠ‚æ•°ç»„æ¥æ„å»ºMessageå®ä¾‹ã€‚å¯¹äºStringå€¼æ¥è¯´ï¼Œè¿™è¶³å¤Ÿäº†ï¼Œä½†æ˜¯å¦‚æœæ¶ˆæ¯çš„è´Ÿè½½æ˜¯å¤æ‚å¯¹è±¡çš„è¯ï¼Œé‚£å®ƒå°±ä¼šå¤æ‚å¾—å¤šã€‚</p>
<p>é‰´äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æœ‰äº†convertAndSend()æ–¹æ³•ï¼Œå®ƒä¼šè‡ªåŠ¨å°†å¯¹è±¡è½¬æ¢ä¸ºMessageã€‚å®ƒéœ€è¦ä¸€ä¸ªæ¶ˆæ¯è½¬æ¢å™¨çš„å¸®åŠ©æ¥å®Œæˆè¯¥ä»»åŠ¡ï¼Œé»˜è®¤çš„æ¶ˆæ¯è½¬æ¢å™¨æ˜¯SimpleMessageConverterï¼Œå®ƒé€‚ç”¨äºStringã€Serializableå®ä¾‹ä»¥åŠå­—èŠ‚æ•°ç»„ã€‚Spring AMQPè¿˜æä¾›äº†å…¶ä»–å‡ ä¸ªæœ‰ç”¨çš„æ¶ˆæ¯è½¬æ¢å™¨ï¼Œå…¶ä¸­åŒ…æ‹¬ä½¿ç”¨JSONå’ŒXMLæ•°æ®çš„æ¶ˆæ¯è½¬æ¢å™¨ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å‘é€äº†æ¶ˆæ¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è½¬å‘å›è¯çš„å¦å¤–ä¸€ç«¯ï¼Œçœ‹ä¸€ä¸‹å¦‚ä½•è·å–æ¶ˆæ¯ã€‚</p>
<h4 id="æ¥æ”¶AMQPæ¶ˆæ¯"><a href="#æ¥æ”¶AMQPæ¶ˆæ¯" class="headerlink" title="æ¥æ”¶AMQPæ¶ˆæ¯"></a>æ¥æ”¶AMQPæ¶ˆæ¯</h4><p>æˆ‘ä»¬å¯ä»¥å›å¿†ä¸€ä¸‹ï¼ŒJMSæä¾›äº†ä¸¤ç§ä»é˜Ÿåˆ—ä¸­è·å–ä¿¡æ¯çš„æ–¹å¼ï¼šä½¿ç”¨JmsTemplateçš„åŒæ­¥æ–¹å¼ä»¥åŠä½¿ç”¨æ¶ˆæ¯é©±åŠ¨POJOçš„å¼‚æ­¥æ–¹å¼ã€‚Spring AMQPæä¾›äº†ç±»ä¼¼çš„æ–¹å¼æ¥è·å–é€šè¿‡AMQPå‘é€çš„æ¶ˆæ¯ã€‚å› ä¸ºæˆ‘ä»¬å·²ç»æœ‰äº†RabbitTemplateï¼Œæ‰€ä»¥é¦–å…ˆçœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨å®ƒåŒæ­¥åœ°ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ã€‚</p>
<p>ä½¿ç”¨RabbitTemplateæ¥æ¥æ”¶æ¶ˆæ¯</p>
<p>RabbitTemplateæä¾›äº†å¤šä¸ªæ¥æ”¶ä¿¡æ¯çš„æ–¹æ³•ã€‚æœ€ç®€å•å°±æ˜¯receive()æ–¹æ³•ï¼Œå®ƒä½äºæ¶ˆæ¯çš„æ¶ˆè´¹è€…ç«¯ï¼Œå¯¹åº”äºRabbitTemplateçš„send()æ–¹æ³•ã€‚å€ŸåŠ©receive()æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä»é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªMessageå¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Message message = rabbit.receive(<span class="string">&quot;spittle.alert.queue&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼Œå¦‚æœæ„¿æ„çš„è¯ï¼Œä½ è¿˜å¯ä»¥é…ç½®è·å–æ¶ˆæ¯çš„é»˜è®¤é˜Ÿåˆ—ï¼Œè¿™æ˜¯é€šè¿‡åœ¨é…ç½®æ¨¡æ¿çš„æ—¶å€™ï¼Œè®¾ç½®queueå±æ€§å®ç°çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;template id=<span class="string">&quot;rabbitTemplate&quot;</span>          connection-factory=<span class="string">&quot;connectionFactory&quot;</span>          exchange=<span class="string">&quot;spittle.alert.exchanges&quot;</span>          routing-key=<span class="string">&quot;spittle.alerts&quot;</span>          queue=<span class="string">&quot;spittle.alert.queue&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨receive()æ–¹æ³•çš„æ—¶å€™ï¼Œä¸éœ€è¦è®¾ç½®ä»»ä½•å‚æ•°å°±èƒ½ä»é»˜è®¤é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Message message = rabbit.receive();</span><br></pre></td></tr></table></figure>

<p>åœ¨è·å–åˆ°Messageå¯¹è±¡ä¹‹åï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å°†å®ƒbodyå±æ€§ä¸­çš„å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºæƒ³è¦çš„å¯¹è±¡ã€‚å°±åƒåœ¨å‘é€çš„æ—¶å€™å°†é¢†åŸŸå¯¹è±¡è½¬æ¢ä¸ºMessageä¸€æ ·ï¼Œå°†æ¥æ”¶åˆ°çš„Messageè½¬æ¢ä¸ºé¢†åŸŸå¯¹è±¡åŒæ ·éå¸¸ç¹çã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨RabbitTemplateçš„receiveAndConvert()æ–¹æ³•ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Spittle spittle = (Spittle) rabbit.receiveAndConvert(<span class="string">&quot;spittle.alert.queue&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥çœç•¥è°ƒç”¨å‚æ•°ä¸­çš„é˜Ÿåˆ—åç§°ï¼Œè¿™æ ·å®ƒå°±ä¼šä½¿ç”¨æ¨¡æ¿çš„é»˜è®¤é˜Ÿåˆ—åç§°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Spittle spittle = (Spittle) rabbit.receiveAndConvert();</span><br></pre></td></tr></table></figure>

<p>receiveAndConvert()æ–¹æ³•ä¼šä½¿ç”¨ä¸sendAndConvert()æ–¹æ³•ç›¸åŒçš„æ¶ˆæ¯è½¬æ¢å™¨ï¼Œå°†Messageå¯¹è±¡è½¬æ¢ä¸ºåŸå§‹çš„ç±»å‹ã€‚</p>
<p>è°ƒç”¨receive()å’ŒreceiveAndConvert()æ–¹æ³•éƒ½ä¼šç«‹å³è¿”å›ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­æ²¡æœ‰ç­‰å¾…çš„æ¶ˆæ¯æ—¶ï¼Œå°†ä¼šå¾—åˆ°nullã€‚è¿™å°±éœ€è¦æˆ‘ä»¬æ¥ç®¡ç†è½®è¯¢ï¼ˆpollingï¼‰ä»¥åŠå¿…è¦çš„çº¿ç¨‹ï¼Œå®ç°é˜Ÿåˆ—çš„ç›‘æ§ã€‚</p>
<p>æˆ‘ä»¬å¹¶éå¿…é¡»åŒæ­¥è½®è¯¢å¹¶ç­‰å¾…æ¶ˆæ¯åˆ°è¾¾ï¼ŒSpring AMQPè¿˜æä¾›äº†æ¶ˆæ¯é©±åŠ¨POJOçš„æ”¯æŒï¼Œè¿™ä¸ç¦ä½¿æˆ‘ä»¬å›å¿†èµ·Spring JMSä¸­çš„ç›¸åŒç‰¹æ€§ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•é€šè¿‡æ¶ˆæ¯é©±åŠ¨AMQP POJOçš„æ–¹å¼æ¥æ¥æ”¶æ¶ˆæ¯ã€‚</p>
<p>å®šä¹‰æ¶ˆæ¯é©±åŠ¨çš„AMQP POJO</p>
<p>å¦‚æœä½ æƒ³åœ¨æ¶ˆæ¯é©±åŠ¨POJOä¸­å¼‚æ­¥åœ°æ¶ˆè´¹ä½¿ç”¨Spittleå¯¹è±¡ï¼Œé¦–å…ˆè¦è§£å†³çš„é—®é¢˜å°±æ˜¯è¿™ä¸ªPOJOæœ¬èº«ã€‚å¦‚ä¸‹çš„SpittleAlertHandleræ‰®æ¼”äº†è¿™ä¸ªè§’è‰²ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.alerts;<span class="keyword">import</span> com.habuma.spittr.domain.Spittle;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpittleAlertHandler</span> </span>&#123;  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleSpittleAlert</span><span class="params">(Spittle spittle)</span> </span>&#123;    <span class="comment">// ... implementation goes here ...  &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œè¿™ä¸ªç±»ä¸å€ŸåŠ©JMSæ¶ˆè´¹Spittleæ—¶æ‰€ç”¨åˆ°SpittleAlertHandlerå®Œå…¨ä¸€è‡´ã€‚æˆ‘ä»¬ä¹‹æ‰€ä»¥èƒ½å¤Ÿé‡ç”¨ç›¸åŒçš„POJOæ˜¯å› ä¸ºè¿™ä¸ªç±»ä¸æ¯«æ²¡æœ‰ä¾èµ–äºJMSæˆ–AMQPï¼Œå¹¶ä¸”ä¸ç®¡é€šè¿‡ä»€ä¹ˆæœºåˆ¶ä¼ é€’è¿‡æ¥Spittleå¯¹è±¡ï¼Œå®ƒéƒ½èƒ½å¤Ÿè¿›è¡Œå¤„ç†ã€‚</p>
<p>æˆ‘ä»¬è¿˜éœ€è¦åœ¨Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­å°†SpittleAlertHandlerå£°æ˜ä¸ºä¸€ä¸ªbeanï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;spittleListener&quot;</span>      <span class="attr">class</span>=<span class="string">&quot;com.habuma.spittr.alert.SpittleAlertHandler&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>åŒæ ·ï¼Œåœ¨ä½¿ç”¨åŸºäºJMSçš„MDPæ—¶ï¼Œæˆ‘ä»¬å·²ç»åšè¿‡ç›¸åŒçš„äº‹æƒ…ï¼Œæ²¡æœ‰ä»€ä¹ˆä¸æ¯«çš„å·®å¼‚ã€‚æœ€åï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜ä¸€ä¸ªç›‘å¬å™¨å®¹å™¨å’Œç›‘å¬å™¨ï¼Œå½“æ¶ˆæ¯åˆ°è¾¾çš„æ—¶å€™ï¼Œèƒ½å¤Ÿè°ƒç”¨SpittleAlertHandlerã€‚åœ¨åŸºäºJMSçš„MDPä¸­ï¼Œæˆ‘ä»¬åšè¿‡ç›¸åŒçš„äº‹æƒ…ï¼Œä½†æ˜¯åŸºäºAMQPçš„MDPåœ¨é…ç½®ä¸Šæœ‰ä¸€ä¸ªç»†å¾®çš„å·®åˆ«ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener-container</span> <span class="attr">connection-factory</span>=<span class="string">&quot;connectionFactory&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">listener</span> <span class="attr">ref</span>=<span class="string">&quot;spittleListener&quot;</span>            <span class="attr">method</span>=<span class="string">&quot;handleSpittleAlert&quot;</span>            <span class="attr">queue-names</span>=<span class="string">&quot;spittle.alert.queue&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">listener-container</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½ çœ‹åˆ°æœ‰ä»€ä¹ˆå·®åˆ«äº†å—ï¼Ÿæˆ‘ä¹ŸåŒæ„è¿™å¹¶ä¸é‚£ä¹ˆæ˜æ˜¾ã€‚<code>&lt;listenercontainer&gt;</code>ä¸<code>&lt;listener&gt;</code>éƒ½ä¸JMSå¯¹åº”çš„å…ƒç´ éå¸¸ç±»ä¼¼ã€‚ä½†æ˜¯ï¼Œè¿™äº›å…ƒç´ æ¥è‡ªrabbitå‘½åç©ºé—´ï¼Œè€Œä¸æ˜¯JMSå‘½åç©ºé—´ã€‚</p>
<p>æˆ‘éƒ½è¯´è¿‡äº†ï¼Œæ²¡é‚£ä¹ˆæ˜æ˜¾ã€‚</p>
<p>å“¦ï¼Œè¿˜æœ‰ä¸€ä¸ªç»†å¾®çš„å·®åˆ«ï¼Œæˆ‘ä»¬ä¸å†é€šè¿‡destinationå±æ€§ï¼ˆJMSä¸­çš„åšæ³•ï¼‰æ¥ç›‘å¬é˜Ÿåˆ—æˆ–ä¸»é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡queue-nameså±æ€§æ¥æŒ‡å®šè¦ç›‘å¬çš„é˜Ÿåˆ—ã€‚ä½†æ˜¯ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒåŸºäºAMQPçš„MDPä¸åŸºäºJMSçš„MDPéƒ½éå¸¸ç±»ä¼¼ã€‚</p>
<p>ä½ å¯èƒ½ä¹Ÿæ„è¯†åˆ°äº†ï¼Œqueue-nameså±æ€§çš„åç§°ä½¿ç”¨äº†å¤æ•°å½¢å¼ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬åªè®¾å®šäº†ä¸€ä¸ªè¦ç›‘å¬çš„é˜Ÿåˆ—ï¼Œä½†æ˜¯å…è®¸è®¾ç½®å¤šä¸ªé˜Ÿåˆ—çš„åç§°ï¼Œç”¨é€—å·åˆ†å‰²å³å¯ã€‚</p>
<p>å¦å¤–ä¸€ç§æŒ‡å®šè¦ç›‘å¬é˜Ÿåˆ—çš„æ–¹æ³•æ˜¯å¼•ç”¨<queue>å…ƒç´ æ‰€å£°æ˜çš„é˜Ÿåˆ—beanã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡queueså±æ€§æ¥è¿›è¡Œè®¾ç½®ï¼š</queue></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener-container</span> <span class="attr">connection-factory</span>=<span class="string">&quot;connectionFactory&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">listener</span> <span class="attr">ref</span>=<span class="string">&quot;spittleListener&quot;</span>            <span class="attr">method</span>=<span class="string">&quot;handleSpittleAlert&quot;</span>            <span class="attr">queue</span>=<span class="string">&quot;spittleAlertQueue&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">listener-container</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åŒæ ·ï¼Œè¿™é‡Œå¯ä»¥æ¥å—é€—å·åˆ†å‰²çš„queue IDåˆ—è¡¨ã€‚å½“ç„¶ï¼Œè¿™éœ€è¦æˆ‘ä»¬åœ¨å£°æ˜é˜Ÿåˆ—çš„æ—¶å€™ï¼Œä¸ºå…¶æŒ‡å®šIDã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹æ˜¯é‡æ–°å®šä¹‰çš„æé†’é˜Ÿåˆ—ï¼Œè¿™æ¬¡æŒ‡å®šäº†IDï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">queue</span> <span class="attr">id</span>=<span class="string">&quot;spittleAlertQueue&quot;</span> <span class="attr">name</span>=<span class="string">&quot;spittle.alert.queue&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œè¿™é‡Œçš„idå±æ€§ç”¨æ¥åœ¨Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­è®¾ç½®é˜Ÿåˆ—çš„bean IDï¼Œè€Œnameå±æ€§æŒ‡å®šäº†RabbitMQä»£ç†ä¸­é˜Ÿåˆ—çš„åç§°ã€‚</p>
<h3 id="å°ç»“-16"><a href="#å°ç»“-16" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å¼‚æ­¥æ¶ˆæ¯é€šä¿¡ä¸åŒæ­¥RPCç›¸æ¯”æœ‰å‡ ä¸ªä¼˜ç‚¹ã€‚é—´æ¥é€šä¿¡å¸¦æ¥äº†åº”ç”¨ä¹‹é—´çš„æ¾æ•£è€¦åˆï¼Œå› æ­¤å‡è½»äº†å…¶ä¸­ä»»æ„ä¸€ä¸ªåº”ç”¨å´©æºƒæ‰€å¸¦æ¥çš„å½±å“ã€‚æ­¤å¤–ï¼Œå› ä¸ºæ¶ˆæ¯è½¬å‘ç»™äº†æ”¶ä»¶äººï¼Œå› æ­¤å‘é€è€…ä¸å¿…ç­‰å¾…å“åº”ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œè¿™ä¼šæé«˜åº”ç”¨çš„æ€§èƒ½ã€‚</p>
<p>è™½ç„¶JMSä¸ºæ‰€æœ‰çš„Javaåº”ç”¨ç¨‹åºæä¾›äº†å¼‚æ­¥é€šä¿¡çš„æ ‡å‡†APIï¼Œä½†æ˜¯å®ƒä½¿ç”¨èµ·æ¥å¾ˆç¹çã€‚Springæ¶ˆé™¤äº†JMSæ ·æ¿å¼ä»£ç å’Œå¼‚å¸¸æ•è·ä»£ç ï¼Œè®©å¼‚æ­¥æ¶ˆæ¯é€šä¿¡æ›´æ˜“äºä½¿ç”¨ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†Springé€šè¿‡æ¶ˆæ¯ä»£ç†å’ŒJMSå»ºç«‹åº”ç”¨ç¨‹åºä¹‹é—´å¼‚æ­¥é€šä¿¡çš„å‡ ç§æ–¹å¼ã€‚Springçš„JMSæ¨¡æ¿æ¶ˆé™¤äº†ä¼ ç»Ÿçš„JMSç¼–ç¨‹æ¨¡å‹æ‰€å¿…éœ€çš„æ ·æ¿å¼ä»£ç ï¼Œè€ŒåŸºäºSpringçš„æ¶ˆæ¯é©±åŠ¨beanå¯ä»¥é€šè¿‡å£°æ˜beançš„æ–¹æ³•å…è®¸æ–¹æ³•å“åº”æ¥è‡ªäºé˜Ÿåˆ—æˆ–ä¸»é¢˜ä¸­çš„æ¶ˆæ¯ã€‚æˆ‘ä»¬åŒæ ·äº†è§£äº†å¦‚ä½•é€šè¿‡Springçš„JMS invokerä¸ºSpring beanæä¾›åŸºäºæ¶ˆæ¯çš„RPCã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•åœ¨åº”ç”¨ç¨‹åºä¹‹é—´ä½¿ç”¨å¼‚æ­¥é€šä¿¡ã€‚åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå»¶ç»­è¿™ä¸€è¯é¢˜ï¼Œäº†è§£å¦‚ä½•å€ŸåŠ©WebSocketåœ¨åŸºäºæµè§ˆå™¨çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®ç°å¼‚æ­¥é€šä¿¡ã€‚</p>
<h2 id="ä½¿ç”¨WebSocketå’ŒSTOMPå®ç°æ¶ˆæ¯åŠŸèƒ½"><a href="#ä½¿ç”¨WebSocketå’ŒSTOMPå®ç°æ¶ˆæ¯åŠŸèƒ½" class="headerlink" title="ä½¿ç”¨WebSocketå’ŒSTOMPå®ç°æ¶ˆæ¯åŠŸèƒ½"></a>ä½¿ç”¨WebSocketå’ŒSTOMPå®ç°æ¶ˆæ¯åŠŸèƒ½</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>åœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´å‘é€æ¶ˆæ¯</li>
<li>åœ¨Spring MVCæ§åˆ¶å™¨ä¸­å¤„ç†æ¶ˆæ¯</li>
<li>ä¸ºç›®æ ‡ç”¨æˆ·å‘é€æ¶ˆæ¯</li>
</ul>
<p>åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨JMSå’ŒAMQPåœ¨åº”ç”¨ç¨‹åºä¹‹é—´å‘é€æ¶ˆæ¯ã€‚å¼‚æ­¥æ¶ˆæ¯æ˜¯åº”ç”¨ç¨‹åºä¹‹é—´é€šç”¨çš„äº¤æµæ–¹å¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœæŸä¸€åº”ç”¨æ˜¯è¿è¡Œåœ¨Webæµè§ˆå™¨ä¸­ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦ä¸€äº›ç¨å¾®ä¸åŒçš„æŠ€å·§äº†ã€‚</p>
<p>WebSocketåè®®æä¾›äº†é€šè¿‡ä¸€ä¸ªå¥—æ¥å­—å®ç°å…¨åŒå·¥é€šä¿¡çš„åŠŸèƒ½ã€‚é™¤äº†å…¶ä»–çš„åŠŸèƒ½ä¹‹å¤–ï¼Œå®ƒèƒ½å¤Ÿå®ç°Webæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å¼‚æ­¥é€šä¿¡ã€‚å…¨åŒå·¥æ„å‘³ç€æœåŠ¡å™¨å¯ä»¥å‘é€æ¶ˆæ¯ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨ä¹Ÿå¯ä»¥å‘é€æ¶ˆæ¯ç»™æœåŠ¡å™¨ã€‚</p>
<ul>
<li>Spring 4.0ä¸ºWebSocketé€šä¿¡æä¾›äº†æ”¯æŒï¼ŒåŒ…æ‹¬ï¼š</li>
<li>å‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„ä½å±‚çº§APIï¼›</li>
<li>å‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„é«˜çº§APIï¼›</li>
<li>ç”¨æ¥å‘é€æ¶ˆæ¯çš„æ¨¡æ¿ï¼›</li>
</ul>
<p>æ”¯æŒSockJSï¼Œç”¨æ¥è§£å†³æµè§ˆå™¨ç«¯ã€æœåŠ¡å™¨ä»¥åŠä»£ç†ä¸æ”¯æŒWebSocketçš„é—®é¢˜ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå­¦ä¹ å€ŸåŠ©Springçš„WebSocketåŠŸèƒ½å®ç°æœåŠ¡å™¨ç«¯å’ŒåŸºäºæµè§ˆå™¨çš„åº”ç”¨ä¹‹é—´å®ç°å¼‚æ­¥é€šä¿¡ã€‚æˆ‘ä»¬é¦–å…ˆä¼šä»å¦‚ä½•ä½¿ç”¨Springçš„ä½å±‚çº§WebSocket APIå¼€å§‹ã€‚</p>
<h3 id="ä½¿ç”¨Springçš„ä½å±‚çº§WebSocket-API"><a href="#ä½¿ç”¨Springçš„ä½å±‚çº§WebSocket-API" class="headerlink" title="ä½¿ç”¨Springçš„ä½å±‚çº§WebSocket API"></a>ä½¿ç”¨Springçš„ä½å±‚çº§WebSocket API</h3><p>æŒ‰ç…§å…¶æœ€ç®€å•çš„å½¢å¼ï¼ŒWebSocketåªæ˜¯ä¸¤ä¸ªåº”ç”¨ä¹‹é—´é€šä¿¡çš„é€šé“ã€‚ä½äºWebSocketä¸€ç«¯çš„åº”ç”¨å‘é€æ¶ˆæ¯ï¼Œå¦å¤–ä¸€ç«¯å¤„ç†æ¶ˆæ¯ã€‚å› ä¸ºå®ƒæ˜¯å…¨åŒå·¥çš„ï¼Œæ‰€ä»¥æ¯ä¸€ç«¯éƒ½å¯ä»¥å‘é€å’Œå¤„ç†æ¶ˆæ¯ã€‚å¦‚å›¾18.1æ‰€ç¤ºã€‚</p>
<p><img src="/2022/01/15/Java/spring/spring-in-action-v4/image-20211114110749065.png" alt="image-20211114110749065"><br>å›¾18.1ã€€WebSocketæ˜¯ä¸¤ä¸ªåº”ç”¨ä¹‹é—´å…¨åŒå·¥çš„é€šä¿¡é€šé“</p>
<p>WebSocketé€šä¿¡å¯ä»¥åº”ç”¨äºä»»ä½•ç±»å‹çš„åº”ç”¨ä¸­ï¼Œä½†æ˜¯WebSocketæœ€å¸¸è§çš„åº”ç”¨åœºæ™¯æ˜¯å®ç°æœåŠ¡å™¨å’ŒåŸºäºæµè§ˆå™¨çš„åº”ç”¨ä¹‹é—´çš„é€šä¿¡ã€‚æµè§ˆå™¨ä¸­çš„JavaScriptå®¢æˆ·ç«¯å¼€å¯ä¸€ä¸ªåˆ°æœåŠ¡å™¨çš„è¿æ¥ï¼ŒæœåŠ¡å™¨é€šè¿‡è¿™ä¸ªè¿æ¥å‘é€æ›´æ–°ç»™æµè§ˆå™¨ã€‚ç›¸æ¯”å†å²ä¸Šè½®è¯¢æœåŠ¡ç«¯ä»¥æŸ¥æ‰¾æ›´æ–°çš„æ–¹æ¡ˆï¼Œè¿™ç§æŠ€æœ¯æ›´åŠ é«˜æ•ˆå’Œè‡ªç„¶ã€‚</p>
<p>ä¸ºäº†é˜è¿°Springä½å±‚çº§çš„WebSocket APIï¼Œè®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç®€å•çš„WebSocketæ ·ä¾‹ï¼ŒåŸºäºJavaScriptçš„å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç©ä¸€ä¸ªæ— ä¼‘æ­¢çš„â€œMarco Poloâ€æ¸¸æˆã€‚æœåŠ¡å™¨ç«¯çš„åº”ç”¨ä¼šå¤„ç†æ–‡æœ¬æ¶ˆæ¯ï¼ˆâ€œMarco!â€ï¼‰ï¼Œç„¶ååœ¨ç›¸åŒçš„è¿æ¥ä¸Šå¾€å›å‘é€æ–‡æœ¬æ¶ˆæ¯ï¼ˆâ€œPolo!â€ï¼‰ã€‚</p>
<p>ä¸ºäº†åœ¨Springä½¿ç”¨è¾ƒä½å±‚çº§çš„APIæ¥å¤„ç†æ¶ˆæ¯ï¼Œæˆ‘ä»¬å¿…é¡»ç¼–å†™ä¸€ä¸ªå®ç°WebSocketHandlerçš„ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">WebSocketHandler</span> </span>&#123;    <span class="function"><span class="keyword">void</span> <span class="title">afterConnectionEstablished</span><span class="params">(WebSocketSession session)</span> <span class="keyword">throws</span> Exception</span>;        <span class="function"><span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(WebSocketSession session, WebSocketMessage&lt;?&gt; message)</span> <span class="keyword">throws</span> Exception</span>;        <span class="function"><span class="keyword">void</span> <span class="title">handleTransportError</span><span class="params">(WebSocketSession session, Throwable exception)</span> <span class="keyword">throws</span> Exception</span>;        <span class="function"><span class="keyword">void</span> <span class="title">afterConnectionClosed</span><span class="params">(WebSocketSession session, CloseStatus closeStatus)</span> <span class="keyword">throws</span> Exception</span>;        <span class="function"><span class="keyword">boolean</span> <span class="title">supportsPartialMessages</span><span class="params">()</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒWebSocketHandleréœ€è¦æˆ‘ä»¬å®ç°äº”ä¸ªæ–¹æ³•ã€‚ç›¸æ¯”ç›´æ¥å®ç°WebSocketHandlerï¼Œæ›´ä¸ºç®€å•çš„æ–¹æ³•æ˜¯æ‰©å±•AbstractWebSocketHandlerï¼Œè¿™æ˜¯WebSocketHandlerçš„ä¸€ä¸ªæŠ½è±¡å®ç°ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†MarcoHandlerï¼Œå®ƒæ˜¯AbstractWebSocketHandlerçš„ä¸€ä¸ªå­ç±»ï¼Œä¼šåœ¨æœåŠ¡å™¨ç«¯å¤„ç†æ¶ˆæ¯ã€‚</p>
<p>ç¨‹åºæ¸…å•18.1ã€€MarcoHandlerå¤„ç†é€šè¿‡WebSocketä¼ é€çš„æ–‡æœ¬æ¶ˆæ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> marcopolo;<span class="keyword">import</span> org.slf4j.Logger;<span class="keyword">import</span> org.slf4j.LoggerFactory;<span class="keyword">import</span> org.springframework.web.socket.TextMessage;<span class="keyword">import</span> org.springframework.web.socket.WebSocketSession;<span class="keyword">import</span> org.springframework.web.socket.handler.AbstractWebSocketHandler;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MarcoHandler</span> <span class="keyword">extends</span> <span class="title">AbstractWebSocketHandler</span> </span>&#123;  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(MarcoHandler.class);	  <span class="meta">@Override</span>  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">handleTextMessage</span><span class="params">(WebSocketSession session, TextMessage message)</span> <span class="keyword">throws</span> Exception </span>&#123;    logger.info(<span class="string">&quot;Received message: &quot;</span> + message.getPayload());	Thread.sleep(<span class="number">2000</span>);	session.sendMessage(<span class="keyword">new</span> TextMessage(<span class="string">&quot;Polo!&quot;</span>));  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å°½ç®¡AbstractWebSocketHandleræ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä½†æ˜¯å®ƒå¹¶ä¸è¦æ±‚æˆ‘ä»¬å¿…é¡»é‡è½½ä»»ä½•ç‰¹å®šçš„æ–¹æ³•ã€‚ç›¸åï¼Œå®ƒè®©æˆ‘ä»¬æ¥å†³å®šè¯¥é‡è½½å“ªä¸€ä¸ªæ–¹æ³•ã€‚é™¤äº†é‡è½½WebSocketHandlerä¸­æ‰€å®šä¹‰çš„äº”ä¸ªæ–¹æ³•ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é‡è½½AbstractWebSocketHandlerä¸­æ‰€å®šä¹‰çš„ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>handleBinaryMessage()</li>
<li>handlePongMessage()</li>
<li>handleTextMessage()</li>
</ul>
<p>è¿™ä¸‰ä¸ªæ–¹æ³•åªæ˜¯handleMessage()æ–¹æ³•çš„å…·ä½“åŒ–ï¼Œæ¯ä¸ªæ–¹æ³•å¯¹åº”äºæŸä¸€ç§ç‰¹å®šç±»å‹çš„æ¶ˆæ¯ã€‚</p>
<p>å› ä¸ºMarcoHandlerå°†ä¼šå¤„ç†æ–‡æœ¬ç±»å‹çš„â€œMarco!â€æ¶ˆæ¯ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥é‡è½½handleTextMessage()æ–¹æ³•ã€‚å½“æœ‰æ–‡æœ¬æ¶ˆæ¯æŠµè¾¾çš„æ—¶å€™ï¼Œæ—¥å¿—ä¼šè®°å½•æ¶ˆæ¯å†…å®¹ï¼Œåœ¨ä¸¤ç§’é’Ÿçš„æ¨¡æ‹Ÿå»¶è¿Ÿä¹‹åï¼Œåœ¨åŒä¸€ä¸ªè¿æ¥ä¸Šè¿”å›å¦å¤–ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯ã€‚</p>
<p>MarcoHandleræ‰€æ²¡æœ‰é‡è½½çš„æ–¹æ³•éƒ½ç”±AbstractWebSocketHandlerä»¥ç©ºæ“ä½œçš„æ–¹å¼ï¼ˆno-opï¼‰è¿›è¡Œäº†å®ç°ã€‚è¿™æ„å‘³ç€MarcoHandlerä¹Ÿèƒ½å¤„ç†äºŒè¿›åˆ¶å’Œpongæ¶ˆæ¯ï¼Œåªæ˜¯å¯¹è¿™äº›æ¶ˆæ¯ä¸è¿›è¡Œä»»ä½•æ“ä½œè€Œå·²ã€‚</p>
<p>å¦å¤–ä¸€ç§æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥æ‰©å±•TextWebSocketHandlerï¼Œä¸å†æ‰©å±•Abstract-WebSocketHandlerï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MarcoHandler</span> <span class="keyword">extends</span> <span class="title">TextWebSocketHandler</span> </span>&#123;  ...&#125;</span><br></pre></td></tr></table></figure>

<p>TextWebSocketHandleræ˜¯AbstractWebSocketHandlerçš„å­ç±»ï¼Œå®ƒä¼šæ‹’ç»å¤„ç†äºŒè¿›åˆ¶æ¶ˆæ¯ã€‚å®ƒé‡è½½äº†handleBinaryMessage()æ–¹æ³•ï¼Œå¦‚æœæ”¶åˆ°äºŒè¿›åˆ¶æ¶ˆæ¯çš„æ—¶å€™ï¼Œå°†ä¼šå…³é—­WebSocketè¿æ¥ã€‚ä¸ä¹‹ç±»ä¼¼ï¼ŒBinaryWebSocketHandlerä¹Ÿæ˜¯AbstractWeb-SocketHandlerçš„å­ç±»ï¼Œå®ƒé‡è½½äº†handleTextMessage()æ–¹æ³•ï¼Œå¦‚æœæ¥æ”¶åˆ°æ–‡æœ¬æ¶ˆæ¯çš„è¯ï¼Œå°†ä¼šå…³é—­è¿æ¥ã€‚</p>
<p>å°½ç®¡ä½ ä¼šå…³å¿ƒå¦‚ä½•å¤„ç†æ–‡æœ¬æ¶ˆæ¯æˆ–äºŒè¿›åˆ¶æ¶ˆæ¯ï¼Œæˆ–è€…äºŒè€…å…¼è€Œæœ‰ä¹‹ï¼Œä½†æ˜¯ä½ å¯èƒ½è¿˜ä¼šå¯¹å»ºç«‹å’Œå…³é—­è¿æ¥æ„Ÿå…´è¶£ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é‡è½½afterConnectionEstablished()å’ŒafterConnectionClosed()ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterConnectionEstablished</span><span class="params">(WebSocketSession session)</span> <span class="keyword">throws</span> Exception </span>&#123;  logger.info(<span class="string">&quot;Connection established&quot;</span>);&#125;<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterConnectionClosed</span><span class="params">(WebSocketSession session, CloseStatus closeStatus)</span> <span class="keyword">throws</span> Exception </span>&#123;  logger.info(<span class="string">&quot;Connection closed. Status: &quot;</span> + status);&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬é€šè¿‡afterConnectionEstablished()å’ŒafterConnectionClosed()æ–¹æ³•è®°å½•äº†è¿æ¥ä¿¡æ¯ã€‚å½“æ–°è¿æ¥å»ºç«‹çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨afterConnectionEstablished()æ–¹æ³•ï¼Œç±»ä¼¼<br>åœ°ï¼Œå½“è¿æ¥å…³é—­æ—¶ï¼Œä¼šè°ƒç”¨afterConnectionClosed()æ–¹æ³•ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¿æ¥äº‹ä»¶ä»…ä»…è®°å½•äº†æ—¥å¿—ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³åœ¨è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸä¸Šå»ºç«‹æˆ–é”€æ¯èµ„æºæ—¶ï¼Œè¿™äº›æ–¹æ³•ä¼šå¾ˆæœ‰ç”¨ã€‚</p>
<p>æ³¨æ„ï¼Œè¿™äº›æ–¹æ³•éƒ½æ˜¯ä»¥â€œafterâ€å¼€å¤´ã€‚è¿™æ„å‘³ç€ï¼Œè¿™äº›äº‹ä»¶åªèƒ½åœ¨äº‹ä»¶å‘ç”Ÿåæ‰äº§ç”Ÿå“åº”ï¼Œå› æ­¤å¹¶ä¸èƒ½æ”¹å˜ç»“æœã€‚</p>
<p>ç°åœ¨ï¼Œå·²ç»æœ‰äº†æ¶ˆæ¯å¤„ç†å™¨ç±»ï¼Œæˆ‘ä»¬å¿…é¡»è¦å¯¹å…¶è¿›è¡Œé…ç½®ï¼Œè¿™æ ·Springæ‰èƒ½å°†æ¶ˆæ¯è½¬å‘ç»™å®ƒã€‚åœ¨Springçš„Javaé…ç½®ä¸­ï¼Œè¿™éœ€è¦åœ¨ä¸€ä¸ªé…ç½®ç±»ä¸Šä½¿ç”¨@EnableWebSocketï¼Œå¹¶å®ç°WebSocketConfigureræ¥å£ï¼Œå¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºã€‚</p>
<p>ç¨‹åºæ¸…å•18.2ã€€åœ¨Javaé…ç½®ä¸­ï¼Œå¯ç”¨WebSocketå¹¶æ˜ å°„æ¶ˆæ¯å¤„ç†å™¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> marcopolo;<span class="keyword">import</span> org.springframework.context.annotation.Bean;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocket;<span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketConfigurer;<span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketHandlerRegistry;<span class="meta">@Configuration</span><span class="meta">@EnableWebSocketpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title">WebSocketConfigurer</span> </span>&#123;  <span class="meta">@Override</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerWebSocketHandlers</span><span class="params">(WebSocketHandlerRegistry registry)</span> </span>&#123;    registry.addHandler(marcoHandler(), <span class="string">&quot;/marco&quot;</span>);  &#125;    <span class="meta">@Bean</span>  <span class="function"><span class="keyword">public</span> MarcoHandler <span class="title">marcoHandler</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> <span class="keyword">new</span> MarcoHandler();  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>registerWebSocketHandlers()æ–¹æ³•æ˜¯æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨çš„å…³é”®ã€‚é€šè¿‡é‡è½½è¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªWebSocketHandlerRegistryå¯¹è±¡ï¼Œé€šè¿‡è¯¥å¯¹è±¡å¯ä»¥è°ƒç”¨addHandler()æ¥æ³¨å†Œä¿¡æ¯å¤„ç†å™¨ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬æ³¨å†Œäº†MarcoHandlerï¼ˆä»¥beançš„æ–¹å¼è¿›è¡Œå£°æ˜ï¼‰å¹¶å°†å…¶ä¸â€œ/marcoâ€è·¯å¾„ç›¸å…³è”ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœä½ æ›´å–œæ¬¢ä½¿ç”¨XMLæ¥é…ç½®Springçš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨websocketå‘½åç©ºé—´ï¼š</p>
<p>ç¨‹åºæ¸…å•18.3ã€€å€ŸåŠ©websocketå‘½åç©ºé—´ä»¥XMLçš„æ–¹å¼é…ç½®WebSocket</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encodings=&quot;UTF-8&quot; ?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>       <span class="attr">xmlns:websocket</span>=<span class="string">&quot;http://www.springframework.org/schema/websocket&quot;</span>       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;         http://www.springframework.org/schema/websocket         http://www.springframework.org/schema/websocket/spring-websocket.xsd         http://www.springframework.org/schema/beans         http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">websocket:handlers</span>&gt;</span>    <span class="tag">&lt;<span class="name">websocket:mapping</span> <span class="attr">handler</span>=<span class="string">&quot;marcoHandler&quot;</span> <span class="attr">paths</span>=<span class="string">&quot;/marco&quot;</span> /&gt;</span>  <span class="tag">&lt;/<span class="name">websocket:handlers</span>&gt;</span>    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;marcoHandler&quot;</span> <span class="attr">class</span>=<span class="string">&quot;marcopolo.MarcoHandler&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡ä½¿ç”¨Javaè¿˜æ˜¯ä½¿ç”¨XMLï¼Œè¿™å°±æ˜¯æ‰€éœ€çš„é…ç½®ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ³¨æ„åŠ›è½¬å‘å®¢æˆ·ç«¯ï¼Œå®ƒä¼šå‘é€â€œMarco!â€æ–‡æœ¬æ¶ˆæ¯åˆ°æœåŠ¡å™¨ï¼Œå¹¶ç›‘å¬æ¥è‡ªæœåŠ¡å™¨çš„æ–‡æœ¬æ¶ˆæ¯ã€‚å¦‚ä¸‹ç¨‹åºæ¸…å•æ‰€å±•ç¤ºçš„JavaScriptä»£ç å¼€å¯äº†ä¸€ä¸ªåŸå§‹çš„WebSocketå¹¶ä½¿ç”¨å®ƒæ¥å‘é€æ¶ˆæ¯ç»™æœåŠ¡å™¨ã€‚</p>
<p>ç¨‹åºæ¸…å•18.4ã€€è¿æ¥åˆ°â€œmarcoâ€ WebSocketçš„JavaScriptå®¢æˆ·ç«¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">&#x27;ws://&#x27;</span> + window.location.host + <span class="string">&#x27;/websocket/marco&#x27;</span>;<span class="keyword">var</span> sock = <span class="keyword">new</span> WebSocket(url);sock.onopen = function() &#123;  console.log(<span class="string">&#x27;Opening&#x27;</span>);  sayMarco();&#125;;sock.onmessage = function(e) &#123;  console.log(<span class="string">&#x27;Received message: &#x27;</span>, e.data);  setTimeout(function()&#123; sayMarco() &#125;, <span class="number">2000</span>);&#125;;sock.onclose = function() &#123;  console.log(<span class="string">&#x27;Closing&#x27;</span>);&#125;;<span class="function">function <span class="title">sayMarco</span><span class="params">()</span> </span>&#123;  console.log(<span class="string">&#x27;Sending Marco!&#x27;</span>);  sock.send&#123;<span class="string">&quot;Marco!&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¨‹åºæ¸…å•18.4çš„ä»£ç ä¸­ï¼Œæ‰€åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯åˆ›å»ºWebSocketå®ä¾‹ã€‚å¯¹äºæ”¯æŒWebSocketçš„æµè§ˆå™¨æ¥è¯´ï¼Œè¿™ä¸ªç±»å‹æ˜¯åŸç”Ÿçš„ã€‚é€šè¿‡åˆ›å»ºWebSocketå®ä¾‹ï¼Œå®é™…ä¸Šæ‰“å¼€äº†åˆ°ç»™å®šURLçš„WebSocketã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒURLä½¿ç”¨äº†â€œws://â€å‰ç¼€ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„WebSocketè¿æ¥ã€‚å¦‚æœæ˜¯å®‰å…¨WebSocketçš„è¯ï¼Œåè®®çš„å‰ç¼€å°†ä¼šæ˜¯â€œwss://â€ã€‚</p>
<p>WebSocketåˆ›å»ºå®Œæ¯•ä¹‹åï¼Œæ¥ä¸‹æ¥çš„ä»£ç å»ºç«‹äº†WebSocketçš„äº‹ä»¶å¤„ç†åŠŸèƒ½ã€‚æ³¨æ„ï¼ŒWebSocketçš„onopenã€onmessageå’Œoncloseäº‹ä»¶å¯¹åº”äºMarcoHandlerçš„afterConnectionEstablished()ã€handleTextMessage()å’ŒafterConnectionClosed()æ–¹æ³•ã€‚åœ¨onopenäº‹ä»¶ä¸­ï¼Œè®¾ç½®äº†ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šè°ƒç”¨sayMarco()æ–¹æ³•ï¼Œåœ¨è¯¥WebSocketä¸Šå‘é€â€œMarco!â€æ¶ˆæ¯ã€‚é€šè¿‡å‘é€â€œMarco!â€ï¼Œè¿™ä¸ªæ— ä¼‘æ­¢çš„Marco Poloæ¸¸æˆå°±å¼€å§‹äº†ï¼Œå› ä¸ºæœåŠ¡å™¨ç«¯çš„MarcoHandlerä½œä¸ºå“åº”ä¼šå°†â€œPolo!â€å‘é€å›æ¥ï¼Œå½“å®¢æˆ·ç«¯æ”¶åˆ°æ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯åï¼Œonmessageäº‹ä»¶ä¼šå‘é€å¦å¤–ä¸€ä¸ªâ€œMarco!â€ç»™æœåŠ¡å™¨ã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´æŒç»­ä¸‹å»ï¼Œç›´åˆ°è¿æ¥å…³é—­ã€‚åœ¨ç¨‹åºæ¸…å•18.4ä¸­æ‰€æ²¡æœ‰å±•ç¤ºçš„æ˜¯å¦‚æœè°ƒç”¨sock.close()çš„è¯ï¼Œå°†ä¼šç»“æŸè¿™ä¸ªç–¯ç‹‚çš„æ¸¸æˆã€‚åœ¨æœåŠ¡ç«¯ä¹Ÿå¯ä»¥å…³é—­è¿æ¥ï¼Œæˆ–è€…æµè§ˆå™¨è½¬å‘å…¶ä»–çš„é¡µé¢ï¼Œéƒ½ä¼šå…³é—­è¿æ¥ã€‚å¦‚æœå‘ç”Ÿä»¥ä¸Šä»»æ„çš„åœºæ™¯ï¼Œåªè¦è¿æ¥å…³é—­ï¼Œéƒ½ä¼šè§¦å‘oncloseäº‹ä»¶ã€‚åœ¨è¿™é‡Œï¼Œå‡ºç°è¿™ç§æƒ…å†µå°†ä¼šåœ¨æ§åˆ¶å°æ—¥å¿—ä¸Šè®°å½•ä¸€æ¡ä¿¡æ¯ã€‚</p>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ç¼–å†™å®Œä½¿ç”¨Springä½å±‚çº§WebSocket APIçš„æ‰€æœ‰ä»£ç ï¼ŒåŒ…æ‹¬æ¥æ”¶å’Œå‘é€æ¶ˆæ¯çš„å¤„ç†å™¨ç±»ï¼Œä»¥åŠåœ¨æµè§ˆå™¨ç«¯å®Œæˆç›¸åŒåŠŸèƒ½çš„JavaScriptå®¢æˆ·ç«¯ã€‚å¦‚æœæˆ‘ä»¬æ„å»ºè¿™äº›ä»£ç å¹¶å°†å…¶éƒ¨ç½²åˆ°Servletå®¹å™¨ä¸­ï¼Œé‚£å®ƒæœ‰å¯èƒ½èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚</p>
<p>ä»æˆ‘é€‰æ‹©â€œå¯èƒ½â€è¿™ä¸ªè¯ï¼Œä½ æ˜¯ä¸æ˜¯èƒ½å¤Ÿæ„Ÿè§‰åˆ°è¿™é‡Œæœ‰ä¸€ç‚¹æ‚²è§‚çš„æƒ…ç»ªï¼Ÿè¿™æ˜¯å› ä¸ºæˆ‘ä¸èƒ½ä¿è¯å®ƒå¯ä»¥æ­£å¸¸è¿è¡Œã€‚å®é™…ä¸Šï¼Œå®ƒå¾ˆæœ‰å¯èƒ½è¿è¡Œä¸èµ·æ¥ã€‚å³ä¾¿æŠŠæ‰€æœ‰çš„äº‹æƒ…éƒ½åšå¯¹äº†ï¼Œè¯¡å¼‚çš„äº‹æƒ…ä¾ç„¶ä¼šå›°æ‰°æˆ‘ä»¬ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹éƒ½æœ‰ä»€ä¹ˆäº‹æƒ…ä¼šé˜»æ­¢WebSocketæ­£å¸¸è¿è¡Œï¼Œå¹¶é‡‡å–ä¸€äº›æªæ–½æé«˜æˆåŠŸçš„å‡ ç‡ã€‚</p>
<h3 id="åº”å¯¹ä¸æ”¯æŒWebSocketçš„åœºæ™¯"><a href="#åº”å¯¹ä¸æ”¯æŒWebSocketçš„åœºæ™¯" class="headerlink" title="åº”å¯¹ä¸æ”¯æŒWebSocketçš„åœºæ™¯"></a>åº”å¯¹ä¸æ”¯æŒWebSocketçš„åœºæ™¯</h3><p>WebSocketæ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒæ–°çš„è§„èŒƒã€‚è™½ç„¶å®ƒæ—©åœ¨2011å¹´åº•å°±å®ç°äº†è§„èŒƒåŒ–ï¼Œä½†å³ä¾¿å¦‚æ­¤ï¼Œåœ¨Webæµè§ˆå™¨å’Œåº”ç”¨æœåŠ¡å™¨ä¸Šä¾ç„¶æ²¡æœ‰å¾—åˆ°ä¸€è‡´çš„æ”¯æŒã€‚Firefoxå’ŒChromeæ—©å°±å·²ç»å®Œæ•´æ”¯æŒWebSocketäº†ï¼Œä½†æ˜¯å…¶ä»–çš„ä¸€äº›æµè§ˆå™¨åˆšåˆšå¼€å§‹æ”¯æŒWebSocketã€‚å¦‚ä¸‹åˆ—å‡ºäº†å‡ ä¸ªæµè¡Œçš„æµè§ˆå™¨æ”¯æŒWebSocketåŠŸèƒ½çš„æœ€ä½ç‰ˆæœ¬ï¼š</p>
<ul>
<li>Internet Explorerï¼š10.0</li>
<li>Firefox: 4.0ï¼ˆéƒ¨åˆ†æ”¯æŒï¼‰ï¼Œ6.0ï¼ˆå®Œæ•´æ”¯æŒï¼‰ã€‚</li>
<li>Chrome: 4.0ï¼ˆéƒ¨åˆ†æ”¯æŒï¼‰ï¼Œ13.0ï¼ˆå®Œæ•´æ”¯æŒï¼‰ã€‚</li>
<li>Safari: 5.0ï¼ˆéƒ¨åˆ†æ”¯æŒï¼‰ï¼Œ6.0ï¼ˆå®Œæ•´æ”¯æŒï¼‰ã€‚</li>
<li>Opera: 11.0ï¼ˆéƒ¨åˆ†æ”¯æŒï¼‰ï¼Œ12.10ï¼ˆå®Œæ•´æ”¯æŒï¼‰ã€‚</li>
<li>iOS Safari: 4.2ï¼ˆéƒ¨åˆ†æ”¯æŒï¼‰ï¼Œ6.0ï¼ˆå®Œæ•´æ”¯æŒï¼‰ã€‚</li>
<li>Android Browser: 4.4ã€‚</li>
</ul>
<p>ä»¤äººé—æ†¾çš„æ˜¯ï¼Œå¾ˆå¤šçš„ç½‘ä¸Šå†²æµªè€…å¹¶æ²¡æœ‰è®¤è¯†åˆ°æˆ–ç†è§£æ–°Webæµè§ˆå™¨çš„ç‰¹æ€§ï¼Œå› æ­¤å‡çº§å¾ˆæ…¢ã€‚å¦å¤–ï¼Œæœ‰çš„å…¬å¸è§„å®šä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„æµè§ˆå™¨ï¼Œè¿™æ ·å®ƒä»¬çš„å‘˜å·¥å¾ˆéš¾ï¼ˆæˆ–ä¸å¯èƒ½ï¼‰ä½¿ç”¨æ›´æ–°çš„æµè§ˆå™¨ã€‚é‰´äºè¿™äº›æƒ…å†µï¼Œå¦‚æœä½ çš„åº”ç”¨ç¨‹åºä½¿ç”¨WebSocketçš„è¯ï¼Œç”¨æˆ·å¯èƒ½ä¼šæ— æ³•ä½¿ç”¨ã€‚</p>
<p>æœåŠ¡å™¨ç«¯å¯¹WebSocketçš„æ”¯æŒä¹Ÿå¥½ä¸åˆ°å“ªé‡Œå»ã€‚GlassFishåœ¨å‡ å¹´å‰å°±å¼€å§‹æ”¯æŒä¸€å®šå½¢å¼çš„WebSocketï¼Œä½†æ˜¯å¾ˆå¤šå…¶ä»–çš„åº”ç”¨æœåŠ¡å™¨åœ¨æœ€è¿‘çš„ç‰ˆæœ¬ä¸­åˆšåˆšå¼€å§‹æ”¯æŒWebSocketã€‚ä¾‹å¦‚ï¼Œæˆ‘åœ¨æµ‹è¯•ä¸Šè¿°ä¾‹å­çš„æ—¶å€™ï¼Œæ‰€ä½¿ç”¨çš„å°±æ˜¯Tomcat 8çš„å‘å¸ƒå€™é€‰æ„å»ºç‰ˆæœ¬ã€‚</p>
<p>å³ä¾¿æµè§ˆå™¨å’Œåº”ç”¨æœåŠ¡å™¨çš„ç‰ˆæœ¬éƒ½ç¬¦åˆè¦æ±‚ï¼Œä¸¤ç«¯éƒ½æ”¯æŒWebSocketï¼Œåœ¨è¿™ä¸¤è€…ä¹‹é—´è¿˜æœ‰å¯èƒ½å‡ºç°é—®é¢˜ã€‚é˜²ç«å¢™ä»£ç†é€šå¸¸ä¼šé™åˆ¶æ‰€æœ‰é™¤HTTPä»¥å¤–çš„æµé‡ã€‚å®ƒä»¬æœ‰å¯èƒ½ä¸æ”¯æŒæˆ–è€…ï¼ˆè¿˜ï¼‰æ²¡æœ‰é…ç½®å…è®¸è¿›è¡ŒWebSocketé€šä¿¡ã€‚</p>
<p>åœ¨å½“å‰çš„WebSocketé¢†åŸŸï¼Œæˆ‘ä¹Ÿè®¸æè¿°äº†ä¸€ä¸ªå¾ˆé˜´æš—çš„å‰æ™¯ã€‚ä½†æ˜¯ï¼Œä¸è¦å› ä¸ºè¿™ä¸€äº›ä¸æ”¯æŒï¼Œä½ å°±åœæ­¢ä½¿ç”¨WebSocketçš„åŠŸèƒ½ã€‚å½“å®ƒèƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨çš„æ—¶å€™ï¼ŒWebSocketæ˜¯ä¸€é¡¹éå¸¸æ£’çš„æŠ€æœ¯ï¼Œä½†æ˜¯å¦‚æœå®ƒæ— æ³•å¾—åˆ°æ”¯æŒçš„è¯ï¼Œæˆ‘ä»¬æ‰€éœ€è¦çš„ä»…ä»…æ˜¯ä¸€ç§å¤‡ç”¨æ–¹æ¡ˆï¼ˆfallback planï¼‰ã€‚</p>
<p>å¹¸å¥½ï¼Œæåˆ°WebSocketçš„å¤‡ç”¨æ–¹æ¡ˆï¼Œè¿™æ°æ˜¯SockJSæ‰€æ“…é•¿çš„ã€‚SockJSæ˜¯WebSocketæŠ€æœ¯çš„ä¸€ç§æ¨¡æ‹Ÿï¼Œåœ¨è¡¨é¢ä¸Šï¼Œå®ƒå°½å¯èƒ½å¯¹åº”WebSocket APIï¼Œä½†æ˜¯åœ¨åº•å±‚å®ƒéå¸¸æ™ºèƒ½ï¼Œå¦‚æœWebSocketæŠ€æœ¯ä¸å¯ç”¨çš„è¯ï¼Œå°±ä¼šé€‰æ‹©å¦å¤–çš„é€šä¿¡æ–¹å¼ã€‚SockJSä¼šä¼˜å…ˆé€‰ç”¨WebSocketï¼Œä½†æ˜¯å¦‚æœWebSocketä¸å¯ç”¨çš„è¯ï¼Œå®ƒå°†ä¼šä»å¦‚ä¸‹çš„æ–¹æ¡ˆä¸­æŒ‘é€‰æœ€ä¼˜çš„å¯è¡Œæ–¹æ¡ˆï¼š</p>
<ul>
<li>XHRæµã€‚</li>
<li>XDRæµã€‚</li>
<li>iFrameäº‹ä»¶æºã€‚</li>
<li>iFrame HTMLæ–‡ä»¶ã€‚</li>
<li>XHRè½®è¯¢ã€‚</li>
<li>XDRè½®è¯¢ã€‚</li>
<li>iFrame XHRè½®è¯¢ã€‚</li>
<li>JSONPè½®è¯¢ã€‚</li>
</ul>
<p>å¥½æ¶ˆæ¯æ˜¯åœ¨ä½¿ç”¨SockJSä¹‹å‰ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å¿…è¦å…¨éƒ¨äº†è§£è¿™äº›æ–¹æ¡ˆã€‚SockJSè®©æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ç»Ÿä¸€çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå°±å¥½åƒåœ¨å„ä¸ªå±‚é¢éƒ½å®Œæ•´æ”¯æŒWebSocketä¸€æ ·ï¼ŒSockJSåœ¨åº•å±‚ä¼šæä¾›å¤‡ç”¨æ–¹æ¡ˆã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸ºäº†åœ¨æœåŠ¡ç«¯å¯ç”¨SockJSé€šä¿¡ï¼Œæˆ‘ä»¬åœ¨Springé…ç½®ä¸­å¯ä»¥å¾ˆç®€å•åœ°è¦æ±‚æ·»åŠ è¯¥åŠŸèƒ½ã€‚é‡æ–°å›é¡¾ä¸€ä¸‹ç¨‹åºæ¸…å•18.2ä¸­çš„registerWebSocketHandlers()æ–¹æ³•ï¼Œç¨å¾®åŠ ä¸€ç‚¹å†…å®¹å°±èƒ½å¯ç”¨SockJSï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overridepublic</span> <span class="function"><span class="keyword">void</span> <span class="title">registerWebSocketHandlers</span><span class="params">(WebSocketHandlerRegistry registry)</span> </span>&#123;  registry.addHandler(marcoHandler(), <span class="string">&quot;/marco&quot;</span>).withSockJS();&#125;</span><br></pre></td></tr></table></figure>

<p>addHandler()æ–¹æ³•ä¼šè¿”å›WebSocketHandlerRegistrationï¼Œé€šè¿‡ç®€å•åœ°è°ƒç”¨å…¶withSockJS()æ–¹æ³•å°±èƒ½å£°æ˜æˆ‘ä»¬æƒ³è¦ä½¿ç”¨SockJSåŠŸèƒ½ï¼Œå¦‚æœWebSocketä¸å¯ç”¨çš„è¯ï¼ŒSockJSçš„å¤‡ç”¨æ–¹æ¡ˆå°±ä¼šå‘æŒ¥ä½œç”¨ã€‚</p>
<p>å¦‚æœä½ ä½¿ç”¨XMLæ¥é…ç½®Springçš„è¯ï¼Œå¯ç”¨SockJSåªéœ€åœ¨é…ç½®ä¸­æ·»åŠ <code>&lt;websocket:sockjs&gt;</code>å…ƒç´ å³å¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">websocket:handlers</span>&gt;</span>  <span class="tag">&lt;<span class="name">websocket:mapping</span> <span class="attr">handler</span>=<span class="string">&quot;marcoHandler&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/marco&quot;</span> /&gt;</span>  <span class="tag">&lt;<span class="name">websocket:sockjs</span> /&gt;</span><span class="tag">&lt;/<span class="name">websocket:handlers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¦åœ¨å®¢æˆ·ç«¯ä½¿ç”¨SockJSï¼Œéœ€è¦ç¡®ä¿åŠ è½½äº†SockJSå®¢æˆ·ç«¯åº“ã€‚å…·ä½“çš„åšæ³•åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºä½¿ç”¨JavaScriptæ¨¡å—åŠ è½½å™¨ï¼ˆå¦‚require.jsæˆ–curl.jsï¼‰è¿˜æ˜¯ç®€å•åœ°ä½¿ç”¨<script>æ ‡ç­¾åŠ è½½JavaScriptåº“ã€‚åŠ è½½SockJSå®¢æˆ·ç«¯åº“çš„æœ€ç®€å•åŠæ³•æ˜¯ä½¿ç”¨<script>æ ‡ç­¾ä»SockJS CDNä¸­è¿›è¡ŒåŠ è½½ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;http://cdn.sockjs.org/sockjs-0.3.min.js&quot;</span> &gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>ç”¨WebJarsè§£æWebèµ„æº</p>
<p>åœ¨æˆ‘çš„æ ·ä¾‹ä»£ç ä¸­ï¼Œä½¿ç”¨äº†WebJarsæ¥è§£æJavaScriptåº“ï¼Œä½¿å…¶ä½œä¸ºé¡¹ç›®Mavenæˆ–Gradleæ„å»ºçš„ä¸€éƒ¨åˆ†ï¼Œå°±åƒå…¶ä»–çš„ä¾èµ–ä¸€æ ·ã€‚ä¸ºäº†æ”¯æŒè¯¥åŠŸèƒ½ï¼Œæˆ‘åœ¨Spring MVCé…ç½®ä¸­æ­å»ºäº†ä¸€ä¸ªèµ„æºå¤„ç†å™¨ï¼Œè®©å®ƒè´Ÿè´£è§£æè·¯å¾„ä»¥â€œ/webjars/**â€å¼€å¤´çš„è¯·æ±‚ï¼Œè¿™ä¹Ÿæ˜¯WebJarsçš„æ ‡å‡†è·¯å¾„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overridepublic</span> <span class="function"><span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;  registry.addResourceHandler(<span class="string">&quot;/webjars&quot;</span>)    .addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªèµ„æºå¤„ç†å™¨å‡†å¤‡å°±ç»ªåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Webé¡µé¢ä¸­ä½¿ç”¨å¦‚ä¸‹çš„<script>æ ‡ç­¾åŠ è½½SockJSåº“ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script th:src=<span class="string">&quot;@&#123;/webjars/sockjs-client/0.3.4/sockjs.min.js&#125;&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œè¿™ä¸ªç‰¹æ®Šçš„<script>æ ‡ç­¾æ¥æºäºä¸€ä¸ªThymeleafæ¨¡æ¿ï¼Œå¹¶ä½¿ç”¨â€œ@{...}â€è¡¨è¾¾å¼æ¥ä¸ºJavaScriptæ–‡ä»¶è®¡ç®—å®Œæ•´çš„ç›¸å¯¹äºä¸Šä¸‹æ–‡çš„URLè·¯å¾„ã€‚</p>
<p>é™¤äº†åŠ è½½SockJSå®¢æˆ·ç«¯åº“ä»¥å¤–ï¼Œåœ¨ç¨‹åºæ¸…å•18.4ä¸­ï¼Œè¦ä½¿ç”¨SockJSåªéœ€ä¿®æ”¹ä¸¤è¡Œä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">&#x27;macro&#x27;</span>;<span class="keyword">var</span> sock = <span class="keyword">new</span> SockJS(url);</span><br></pre></td></tr></table></figure>

<p>æ‰€åšçš„ç¬¬ä¸€ä¸ªä¿®æ”¹å°±æ˜¯URLã€‚SockJSæ‰€å¤„ç†çš„URLæ˜¯â€œhttp://â€æˆ–â€œhttps://â€æ¨¡å¼ï¼Œè€Œä¸æ˜¯â€œws://â€å’Œâ€œwss://â€ã€‚å³ä¾¿å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥ä½¿ç”¨ç›¸å¯¹URLï¼Œé¿å…ä¹¦å†™å®Œæ•´çš„å…¨é™å®šURLã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå¦‚æœåŒ…å«JavaScriptçš„é¡µé¢ä½äºâ€œ<a target="_blank" rel="noopener" href="http://localhost:8080/websocket%E2%80%9D%E8%B7%AF%E5%BE%84%E4%B8%8B%EF%BC%8C%E9%82%A3%E4%B9%88%E7%BB%99%E5%AE%9A%E7%9A%84%E2%80%9Cmarco%E2%80%9D%E8%B7%AF%E5%BE%84%E5%B0%86%E4%BC%9A%E5%BD%A2%E6%88%90%E5%88%B0%E2%80%9Chttp://localhost:8080/websocket/marco%E2%80%9D%E7%9A%84%E8%BF%9E%E6%8E%A5%E3%80%82">http://localhost:8080/websocketâ€è·¯å¾„ä¸‹ï¼Œé‚£ä¹ˆç»™å®šçš„â€œmarcoâ€è·¯å¾„å°†ä¼šå½¢æˆåˆ°â€œhttp://localhost:8080/websocket/marcoâ€çš„è¿æ¥ã€‚</a></p>
<p>ä½†æ˜¯ï¼Œè¿™é‡Œæœ€æ ¸å¿ƒçš„å˜åŒ–æ˜¯åˆ›å»ºSockJSå®ä¾‹æ¥ä»£æ›¿WebSocketã€‚å› ä¸ºSockJSå°½å¯èƒ½åœ°æ¨¡æ‹Ÿäº†WebSocketï¼Œæ‰€ä»¥ç¨‹åºæ¸…å•18.4ä¸­çš„å…¶ä»–ä»£ç å¹¶ä¸éœ€è¦å˜åŒ–ã€‚ç›¸åŒçš„onopenã€onmessageå’Œoncloseäº‹ä»¶å¤„ç†å‡½æ•°ç”¨æ¥å“åº”å¯¹åº”çš„äº‹ä»¶ï¼Œç›¸åŒçš„send()æ–¹æ³•ç”¨æ¥å‘é€â€œMarco!â€åˆ°æœåŠ¡å™¨ç«¯ã€‚</p>
<p>æˆ‘ä»¬å¹¶æ²¡æœ‰æ”¹å˜å¾ˆå¤šçš„ä»£ç ï¼Œä½†æ˜¯å®¢æˆ·ç«¯-æœåŠ¡å™¨ä¹‹é—´é€šä¿¡çš„è¿è¡Œæ–¹å¼å´æœ‰äº†å¾ˆå¤§çš„å˜åŒ–ã€‚æˆ‘ä»¬å¯ä»¥å®Œå…¨ç›¸ä¿¡å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´èƒ½å¤Ÿè¿›è¡Œç±»ä¼¼äºWebSocketè¿™æ ·çš„é€šä¿¡ï¼Œå³ä¾¿æµè§ˆå™¨ã€æœåŠ¡å™¨æˆ–ä½äºä¸­é—´çš„ä»£ç†ä¸æ”¯æŒWebSocketï¼Œæˆ‘ä»¬ä¹Ÿæ— éœ€å†æ‹…å¿ƒäº†ã€‚</p>
<p>WebSocketæä¾›äº†æµè§ˆå™¨-æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ–¹å¼ï¼Œå½“è¿è¡Œç¯å¢ƒä¸æ”¯æŒWebSocketçš„æ—¶å€™ï¼ŒSockJSæä¾›äº†å¤‡ç”¨æ–¹æ¡ˆã€‚ä½†æ˜¯ä¸ç®¡å“ªç§åœºæ™¯ï¼Œå¯¹äºå®é™…åº”ç”¨æ¥è¯´ï¼Œè¿™ç§é€šä¿¡å½¢å¼éƒ½æ˜¾å¾—å±‚çº§è¿‡ä½ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨WebSocketä¹‹ä¸Šä½¿ç”¨STOMPï¼ˆSimple Text Oriented Messaging Protocolï¼‰ï¼Œä¸ºæµè§ˆå™¨-æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å¢åŠ æ°å½“çš„æ¶ˆæ¯è¯­ä¹‰ã€‚</p>
<h3 id="ä½¿ç”¨STOMPæ¶ˆæ¯"><a href="#ä½¿ç”¨STOMPæ¶ˆæ¯" class="headerlink" title="ä½¿ç”¨STOMPæ¶ˆæ¯"></a>ä½¿ç”¨STOMPæ¶ˆæ¯</h3><p>å¦‚æœæˆ‘è¦æ±‚ä½ ç¼–å†™ä¸€ä¸ªWebåº”ç”¨ç¨‹åºï¼Œåœ¨è®¨è®ºéœ€æ±‚ä¹‹å‰ï¼Œä½ å¯èƒ½å¯¹äºè¦é‡‡ç”¨çš„åŸºç¡€æŠ€æœ¯å’Œæ¡†æ¶å°±æœ‰äº†å¾ˆå¥½çš„æƒ³æ³•ã€‚å³ä¾¿æ˜¯ç®€å•çš„â€œHello Worldâ€Webåº”ç”¨ï¼Œä½ å¯èƒ½ä¹Ÿä¼šè€ƒè™‘ä½¿ç”¨Spring MVCæ§åˆ¶å™¨æ¥å¤„ç†è¯·æ±‚ï¼Œå¹¶ä¸ºå“åº”ä½¿ç”¨JSPæˆ–Thymeleafæ¨¡æ¿ã€‚è‡³å°‘ï¼Œä½ ä¹Ÿåº”è¯¥ä¼šåˆ›å»ºä¸€ä¸ªé™æ€çš„HTMLé¡µé¢ï¼Œå¹¶è®©WebæœåŠ¡å™¨å¤„ç†æ¥è‡ªWebæµè§ˆå™¨çš„ç›¸åº”è¯·æ±‚ã€‚æˆ‘ä»¬åº”è¯¥ä¸ä¼šå…³å¿ƒæµè§ˆå™¨å…·ä½“å¦‚ä½•è¯·æ±‚é¡µé¢ä»¥åŠé¡µé¢å¦‚ä½•ä¼ é€’ç»™æµè§ˆå™¨è¿™æ ·çš„äº‹æƒ…ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å‡è®¾HTTPåè®®å¹¶ä¸å­˜åœ¨ï¼Œåªèƒ½ä½¿ç”¨TCPå¥—æ¥å­—æ¥ç¼–å†™Webåº”ç”¨ã€‚ä½ å¯èƒ½è®¤ä¸ºæˆ‘å·²ç»ç–¯æ‰äº†ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿè®¸èƒ½å¤Ÿå®Œæˆè¿™ä¸€å£®ä¸¾ï¼Œä½†æ˜¯è¿™éœ€è¦è‡ªè¡Œè®¾è®¡å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½è®¤å¯çš„åè®®ï¼Œä»è€Œå®ç°æœ‰æ•ˆçš„é€šä¿¡ã€‚ç®€å•æ¥è¯´ï¼Œè¿™ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚</p>
<p>ä¸è¿‡ï¼Œå¹¸å¥½æˆ‘ä»¬æœ‰HTTPï¼Œå®ƒè§£å†³äº†Webæµè§ˆå™¨å‘èµ·è¯·æ±‚ä»¥åŠWebæœåŠ¡å™¨å“åº”è¯·æ±‚çš„ç»†èŠ‚ã€‚è¿™æ ·çš„è¯ï¼Œå¤§å¤šæ•°çš„å¼€å‘äººå‘˜å¹¶ä¸éœ€è¦ç¼–å†™ä½å±‚çº§TCPå¥—æ¥å­—é€šä¿¡ç›¸å…³çš„ä»£ç ã€‚</p>
<p>ç›´æ¥ä½¿ç”¨WebSocketï¼ˆæˆ–SockJSï¼‰å°±å¾ˆç±»ä¼¼äºä½¿ç”¨TCPå¥—æ¥å­—æ¥ç¼–å†™Webåº”ç”¨ã€‚å› ä¸ºæ²¡æœ‰é«˜å±‚çº§çš„çº¿è·¯åè®®ï¼ˆwire protocolï¼‰ï¼Œå› æ­¤å°±éœ€è¦æˆ‘ä»¬å®šä¹‰åº”ç”¨ä¹‹é—´æ‰€å‘é€æ¶ˆæ¯çš„è¯­ä¹‰ï¼Œè¿˜éœ€è¦ç¡®ä¿è¿æ¥çš„ä¸¤ç«¯éƒ½èƒ½éµå¾ªè¿™äº›è¯­ä¹‰ã€‚</p>
<p>ä¸è¿‡ï¼Œå¥½æ¶ˆæ¯æ˜¯æˆ‘ä»¬å¹¶éå¿…é¡»è¦ä½¿ç”¨åŸç”Ÿçš„WebSocketè¿æ¥ã€‚å°±åƒHTTPåœ¨TCPå¥—æ¥å­—ä¹‹ä¸Šæ·»åŠ äº†è¯·æ±‚-å“åº”æ¨¡å‹å±‚ä¸€æ ·ï¼ŒSTOMPåœ¨WebSocketä¹‹ä¸Šæä¾›äº†ä¸€ä¸ªåŸºäºå¸§çš„çº¿è·¯æ ¼å¼ï¼ˆframe-based wire formatï¼‰å±‚ï¼Œç”¨æ¥å®šä¹‰æ¶ˆæ¯çš„è¯­ä¹‰ã€‚</p>
<p>ä¹çœ‹ä¸Šå»ï¼ŒSTOMPçš„æ¶ˆæ¯æ ¼å¼éå¸¸ç±»ä¼¼äºHTTPè¯·æ±‚çš„ç»“æ„ã€‚ä¸HTTPè¯·æ±‚å’Œå“åº”ç±»ä¼¼ï¼ŒSTOMPå¸§ç”±å‘½ä»¤ã€ä¸€ä¸ªæˆ–å¤šä¸ªå¤´ä¿¡æ¯ä»¥åŠè´Ÿè½½æ‰€ç»„æˆã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹å°±æ˜¯å‘é€æ•°æ®çš„ä¸€ä¸ªSTOMPå¸§ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SENDdestination:/app/marcocontent-length:20&#123;\&quot;message\&quot;:\&quot;Marco!\&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªç®€å•çš„æ ·ä¾‹ä¸­ï¼ŒSTOMPå‘½ä»¤æ˜¯sendï¼Œè¡¨æ˜ä¼šå‘é€ä¸€äº›å†…å®¹ã€‚ç´§æ¥ç€æ˜¯ä¸¤ä¸ªå¤´ä¿¡æ¯ï¼šä¸€ä¸ªç”¨æ¥è¡¨ç¤ºæ¶ˆæ¯è¦å‘é€åˆ°å“ªé‡Œçš„ç›®çš„åœ°ï¼Œå¦å¤–ä¸€ä¸ªåˆ™åŒ…å«äº†è´Ÿè½½çš„å¤§å°ã€‚ç„¶åï¼Œç´§æ¥ç€æ˜¯ä¸€ä¸ªç©ºè¡Œï¼ŒSTOMPå¸§çš„æœ€åæ˜¯è´Ÿè½½å†…å®¹ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæ˜¯ä¸€ä¸ªJSONæ¶ˆæ¯ã€‚</p>
<p>STOMPå¸§ä¸­æœ€æœ‰æ„æ€çš„ææ€•å°±æ˜¯destinationå¤´ä¿¡æ¯äº†ã€‚å®ƒè¡¨æ˜STOMPæ˜¯ä¸€ä¸ªæ¶ˆæ¯åè®®ï¼Œç±»ä¼¼äºJMSæˆ–AMQPã€‚æ¶ˆæ¯ä¼šå‘å¸ƒåˆ°æŸä¸ªç›®çš„åœ°ï¼Œè¿™ä¸ªç›®çš„åœ°å®é™…ä¸Šå¯èƒ½çœŸçš„æœ‰æ¶ˆæ¯ä»£ç†ï¼ˆmessage brokerï¼‰ä½œä¸ºæ”¯æ’‘ã€‚å¦ä¸€æ–¹é¢ï¼Œæ¶ˆæ¯å¤„ç†å™¨ï¼ˆmessage handlerï¼‰ä¹Ÿå¯ä»¥ç›‘å¬è¿™äº›ç›®çš„åœ°ï¼Œæ¥æ”¶æ‰€å‘é€è¿‡æ¥çš„æ¶ˆæ¯ã€‚</p>
<p>åœ¨WebSocketé€šä¿¡ä¸­ï¼ŒåŸºäºæµè§ˆå™¨çš„JavaScriptåº”ç”¨å¯èƒ½ä¼šå‘é€æ¶ˆæ¯åˆ°ä¸€ä¸ªç›®çš„åœ°ï¼Œè¿™ä¸ªç›®çš„åœ°ç”±æœåŠ¡å™¨ç«¯çš„ç»„ä»¶æ¥è¿›è¡Œå¤„ç†ã€‚å…¶å®ï¼Œåè¿‡æ¥æ˜¯ä¸€æ ·çš„ï¼ŒæœåŠ¡å™¨ç«¯çš„ç»„ä»¶ä¹Ÿå¯ä»¥å‘å¸ƒæ¶ˆæ¯ï¼Œç”±JavaScriptå®¢æˆ·ç«¯çš„ç›®çš„åœ°æ¥æ¥æ”¶ã€‚</p>
<p>Springä¸ºSTOMPæ¶ˆæ¯æä¾›äº†åŸºäºSpring MVCçš„ç¼–ç¨‹æ¨¡å‹ã€‚ç¨åå°†ä¼šçœ‹åˆ°ï¼Œåœ¨Spring MVCæ§åˆ¶å™¨ä¸­å¤„ç†STOMPæ¶ˆæ¯ä¸å¤„ç†HTTPè¯·æ±‚å¹¶æ²¡æœ‰å¤ªå¤§çš„å·®åˆ«ã€‚ä½†é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦é…ç½®Springå¯ç”¨åŸºäºSTOMPçš„æ¶ˆæ¯ã€‚</p>
<h4 id="å¯ç”¨STOMPæ¶ˆæ¯åŠŸèƒ½"><a href="#å¯ç”¨STOMPæ¶ˆæ¯åŠŸèƒ½" class="headerlink" title="å¯ç”¨STOMPæ¶ˆæ¯åŠŸèƒ½"></a>å¯ç”¨STOMPæ¶ˆæ¯åŠŸèƒ½</h4><p>ç¨åï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•åœ¨Spring MVCä¸­ä¸ºæ§åˆ¶å™¨æ–¹æ³•æ·»åŠ @MessageMappingæ³¨è§£ï¼Œä½¿å…¶å¤„ç†STOMPæ¶ˆæ¯ï¼Œå®ƒä¸å¸¦æœ‰@RequestMappingæ³¨è§£çš„æ–¹æ³•å¤„ç†HTTPè¯·æ±‚çš„æ–¹å¼éå¸¸ç±»ä¼¼ã€‚</p>
<p>ä½†æ˜¯ä¸@RequestMappingä¸åŒçš„æ˜¯ï¼Œ@MessageMappingçš„åŠŸèƒ½æ— æ³•é€šè¿‡@EnableWebMvcå¯ç”¨ã€‚Springçš„Webæ¶ˆæ¯åŠŸèƒ½åŸºäºæ¶ˆæ¯ä»£ç†ï¼ˆmessage brokerï¼‰æ„å»ºï¼Œå› æ­¤é™¤äº†å‘Šè¯‰Springæˆ‘ä»¬æƒ³è¦å¤„ç†æ¶ˆæ¯ä»¥å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„å†…å®¹éœ€è¦é…ç½®ã€‚æˆ‘ä»¬å¿…é¡»è¦é…ç½®ä¸€ä¸ªæ¶ˆæ¯ä»£ç†å’Œå…¶ä»–çš„ä¸€äº›æ¶ˆæ¯ç›®çš„åœ°ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¦‚ä½•é€šè¿‡Javaé…ç½®å¯ç”¨åŸºäºä»£ç†çš„Webæ¶ˆæ¯åŠŸèƒ½ï¼š</p>
<p>ç¨‹åºæ¸…å•18.5ã€€@EnableWebSocketMessageBrokeræ³¨è§£èƒ½å¤Ÿåœ¨WebSocketä¹‹ä¸Šå¯ç”¨STOMP</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> marcopolo;<span class="keyword">import</span> org.springframework.context.annotation.Configuration;<span class="keyword">import</span> org.springframework.messaging.simp.config.MessageBrokerRegistry;<span class="keyword">import</span> org.springframework.web.socket.config.annotation.AbstractWebSocketMessageBrokerConfigurer;<span class="keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;<span class="keyword">import</span> org.springframework.web.socket.config.annotation.StompEndpointRegistry;<span class="meta">@Configuration</span><span class="meta">@EnableWebSocketMessageBrokerpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketStompConfig</span> <span class="keyword">extends</span> <span class="title">AbstractWebSocketMessageBrokerConfigurer</span> </span>&#123;  <span class="meta">@Override</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerStompEndpoints</span><span class="params">(StompEndpointRegistry registry)</span> </span>&#123;    registry.addEndpoint(<span class="string">&quot;/marcopolo&quot;</span>).withSockJS();  &#125;  <span class="meta">@Override</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageBroker</span><span class="params">(MessageBrokerRegistry registry)</span> </span>&#123;    registry.enableSimpleBroker(<span class="string">&quot;/queue&quot;</span>, <span class="string">&quot;/topic&quot;</span>);    registry.setApplicationDestinationPrefixes(<span class="string">&quot;/app&quot;</span>);  &#125;  &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ç¨‹åºæ¸…å•18.2ä¸­çš„é…ç½®è¿›è¡Œå¯¹æ¯”ï¼ŒWebSocketStompConfigä½¿ç”¨äº†@EnableWebSocketMessageBrokeræ³¨è§£ã€‚è¿™è¡¨æ˜è¿™ä¸ªé…ç½®ç±»ä¸ä»…é…ç½®äº†WebSocketï¼Œè¿˜é…ç½®äº†åŸºäºä»£ç†çš„STOMPæ¶ˆæ¯ã€‚å®ƒé‡è½½äº†registerStompEndpoints()æ–¹æ³•ï¼Œå°†â€œ/marcopoloâ€æ³¨å†Œä¸ºSTOMPç«¯ç‚¹ã€‚è¿™ä¸ªè·¯å¾„ä¸ä¹‹å‰å‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„ç›®çš„åœ°è·¯å¾„æœ‰æ‰€ä¸åŒã€‚è¿™æ˜¯ä¸€ä¸ªç«¯ç‚¹ï¼Œå®¢æˆ·ç«¯åœ¨è®¢é˜…æˆ–å‘å¸ƒæ¶ˆæ¯åˆ°ç›®çš„åœ°è·¯å¾„å‰ï¼Œè¦è¿æ¥è¯¥ç«¯ç‚¹ã€‚</p>
<p>WebSocketStompConfigè¿˜é€šè¿‡é‡è½½configureMessageBroker()æ–¹æ³•é…ç½®äº†ä¸€ä¸ªç®€å•çš„æ¶ˆæ¯ä»£ç†ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸é‡è½½å®ƒçš„è¯ï¼Œå°†ä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ªç®€å•çš„å†…å­˜æ¶ˆæ¯ä»£ç†ï¼Œç”¨å®ƒæ¥å¤„ç†ä»¥â€œ/topicâ€ä¸ºå‰ç¼€çš„æ¶ˆæ¯ã€‚ä½†æ˜¯åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬é‡è½½äº†è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥æ¶ˆæ¯ä»£ç†å°†ä¼šå¤„ç†å‰ç¼€ä¸ºâ€œ/topicâ€å’Œâ€œ/queueâ€çš„æ¶ˆæ¯ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå‘å¾€åº”ç”¨ç¨‹åºçš„æ¶ˆæ¯å°†ä¼šå¸¦æœ‰â€œ/appâ€å‰ç¼€ã€‚å›¾18.2å±•ç°äº†è¿™ä¸ªé…ç½®ä¸­çš„æ¶ˆæ¯æµã€‚</p>
<p><img src="spring-in-action-v4/image-20211114113932607.png" alt="image-20211114113932607"></p>
<p>å›¾18.2ã€€Springç®€å•çš„STOMPä»£ç†æ˜¯åŸºäºå†…å­˜çš„ï¼Œå®ƒæ¨¡æ‹Ÿäº†STOMPä»£ç†çš„å¤šé¡¹åŠŸèƒ½</p>
<p>å½“æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼Œç›®çš„åœ°çš„å‰ç¼€å°†ä¼šå†³å®šæ¶ˆæ¯è¯¥å¦‚ä½•å¤„ç†ã€‚åœ¨å›¾18.2ä¸­ï¼Œåº”ç”¨ç¨‹åºçš„ç›®çš„åœ°ä»¥â€œ/appâ€ä½œä¸ºå‰ç¼€ï¼Œè€Œä»£ç†çš„ç›®çš„åœ°ä»¥â€œ/topicâ€å’Œâ€œ/queueâ€ä½œä¸ºå‰ç¼€ã€‚ä»¥åº”ç”¨ç¨‹åºä¸ºç›®çš„åœ°çš„æ¶ˆæ¯å°†ä¼šç›´æ¥è·¯ç”±åˆ°å¸¦æœ‰@MessageMappingæ³¨è§£çš„æ§åˆ¶å™¨æ–¹æ³•ä¸­ã€‚è€Œå‘é€åˆ°ä»£ç†ä¸Šçš„æ¶ˆæ¯ï¼Œå…¶ä¸­ä¹ŸåŒ…æ‹¬@MessageMappingæ³¨è§£æ–¹æ³•çš„è¿”å›å€¼æ‰€å½¢æˆçš„æ¶ˆæ¯ï¼Œå°†ä¼šè·¯ç”±åˆ°ä»£ç†ä¸Šï¼Œå¹¶æœ€ç»ˆå‘é€åˆ°è®¢é˜…è¿™äº›ç›®çš„åœ°çš„å®¢æˆ·ç«¯ã€‚</p>
<p>å¯ç”¨STOMPä»£ç†ä¸­ç»§</p>
<p>å¯¹äºåˆå­¦æ¥è®²ï¼Œç®€å•çš„ä»£ç†æ˜¯å¾ˆä¸é”™çš„ï¼Œä½†æ˜¯å®ƒä¹Ÿæœ‰ä¸€äº›é™åˆ¶ã€‚å°½ç®¡å®ƒæ¨¡æ‹Ÿäº†STOMPæ¶ˆæ¯ä»£ç†ï¼Œä½†æ˜¯å®ƒåªæ”¯æŒSTOMPå‘½ä»¤çš„å­é›†ã€‚å› ä¸ºå®ƒæ˜¯åŸºäºå†…å­˜çš„ï¼Œæ‰€ä»¥å®ƒå¹¶ä¸é€‚åˆé›†ç¾¤ï¼Œå› ä¸ºå¦‚æœé›†ç¾¤çš„è¯ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¹Ÿåªèƒ½ç®¡ç†è‡ªå·±çš„ä»£ç†å’Œè‡ªå·±çš„é‚£éƒ¨åˆ†æ¶ˆæ¯ã€‚</p>
<p>å¯¹äºç”Ÿäº§ç¯å¢ƒä¸‹çš„åº”ç”¨æ¥è¯´ï¼Œä½ å¯èƒ½ä¼šå¸Œæœ›ä½¿ç”¨çœŸæ­£æ”¯æŒSTOMPçš„ä»£ç†æ¥æ”¯æ’‘WebSocketæ¶ˆæ¯ï¼Œå¦‚RabbitMQæˆ–ActiveMQã€‚è¿™æ ·çš„ä»£ç†æä¾›äº†å¯æ‰©å±•æ€§å’Œå¥å£®æ€§æ›´å¥½çš„æ¶ˆæ¯åŠŸèƒ½ï¼Œå½“ç„¶å®ƒä»¬ä¹Ÿä¼šå®Œæ•´æ”¯æŒSTOMPå‘½ä»¤ã€‚æˆ‘ä»¬éœ€è¦æ ¹æ®ç›¸å…³çš„æ–‡æ¡£æ¥ä¸ºSTOMPæ­å»ºä»£ç†ã€‚æ­å»ºå°±ç»ªä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨STOMPä»£ç†æ¥æ›¿æ¢å†…å­˜ä»£ç†äº†ï¼Œåªéœ€æŒ‰ç…§å¦‚ä¸‹æ–¹å¼é‡è½½configureMessageBroker()æ–¹æ³•å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overridepublic</span> <span class="function"><span class="keyword">void</span> <span class="title">configureMessageBroker</span><span class="params">(MessageBrokerRegistry registry)</span> </span>&#123;  registry.enableStompBrokerRelay(<span class="string">&quot;/topic&quot;</span>, <span class="string">&quot;/queue&quot;</span>);  registry.setApplicationDestinationPrefixes(<span class="string">&quot;/app&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°configureMessageBroker()æ–¹æ³•çš„ç¬¬ä¸€è¡Œä»£ç å¯ç”¨äº†STOMPä»£ç†ä¸­ç»§ï¼ˆbroker relayï¼‰åŠŸèƒ½ï¼Œå¹¶å°†å…¶ç›®çš„åœ°å‰ç¼€è®¾ç½®ä¸ºâ€œ/topicâ€å’Œâ€œ/queueâ€ã€‚è¿™æ ·çš„è¯ï¼ŒSpringå°±èƒ½çŸ¥é“æ‰€æœ‰ç›®çš„åœ°å‰ç¼€ä¸ºâ€œ/topicâ€æˆ–â€œ/queueâ€çš„æ¶ˆæ¯éƒ½ä¼šå‘é€åˆ°STOMPä»£ç†ä¸­ã€‚æ ¹æ®ä½ æ‰€é€‰æ‹©çš„STOMPä»£ç†ä¸åŒï¼Œç›®çš„åœ°çš„å¯é€‰å‰ç¼€ä¹Ÿä¼šæœ‰æ‰€é™åˆ¶ã€‚ä¾‹å¦‚ï¼ŒRabbitMQåªå…è®¸ç›®çš„åœ°çš„ç±»å‹ä¸ºâ€œ/tempqueueâ€ã€â€œ/exchangeâ€ã€â€œ/topicâ€ã€â€œ/queueâ€ã€â€œ/amq/queueâ€å’Œâ€œ/replyqueueâ€ã€‚è¯·å‚é˜…ä»£ç†çš„æ–‡æ¡£æ¥äº†è§£æ‰€æ”¯æŒçš„ç›®çš„åœ°ç±»å‹åŠå…¶ä½¿ç”¨åœºæ™¯ã€‚</p>
<p>é™¤äº†ç›®çš„åœ°å‰ç¼€ï¼Œåœ¨ç¬¬äºŒè¡Œçš„configureMessageBroker()æ–¹æ³•ä¸­å°†åº”ç”¨çš„å‰ç¼€è®¾ç½®ä¸ºâ€œ/appâ€ã€‚æ‰€æœ‰ç›®çš„åœ°ä»¥â€œ/appâ€æ‰“å¤´çš„æ¶ˆæ¯éƒ½å°†ä¼šè·¯ç”±åˆ°å¸¦æœ‰@MessageMappingæ³¨è§£çš„æ–¹æ³•ä¸­ï¼Œè€Œä¸ä¼šå‘å¸ƒåˆ°ä»£ç†é˜Ÿåˆ—æˆ–ä¸»é¢˜ä¸­ã€‚</p>
<p>å›¾18.3é˜è¿°äº†ä»£ç†ä¸­ç»§å¦‚ä½•åº”ç”¨äºSpringçš„STOMPæ¶ˆæ¯å¤„ç†ä¹‹ä¸­ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…³é”®çš„åŒºåˆ«åœ¨äºè¿™é‡Œä¸å†æ¨¡æ‹ŸSTOMPä»£ç†çš„åŠŸèƒ½ï¼Œè€Œæ˜¯ç”±ä»£ç†ä¸­ç»§å°†æ¶ˆæ¯ä¼ é€åˆ°ä¸€ä¸ªçœŸæ­£çš„æ¶ˆæ¯ä»£ç†ä¸­æ¥è¿›è¡Œå¤„ç†ã€‚</p>
<p><img src="spring-in-action-v4/image-20211114114242015.png" alt="image-20211114114242015"><br>å›¾18.3ã€€STOMPä»£ç†ä¸­ç»§ä¼šå°†STOMPæ¶ˆæ¯çš„å¤„ç†å§”æ‰˜ç»™ä¸€ä¸ªçœŸæ­£çš„æ¶ˆæ¯ä»£ç†</p>
<p>æ³¨æ„ï¼ŒenableStompBrokerRelay()å’ŒsetApplicationDestinationPrefixes()æ–¹æ³•éƒ½æ¥æ”¶å¯å˜é•¿åº¦çš„Stringå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é…ç½®å¤šä¸ªç›®çš„åœ°å’Œåº”ç”¨å‰ç¼€ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overridepublic</span> <span class="function"><span class="keyword">void</span> <span class="title">configureMessageBroker</span><span class="params">(MessageBrokerRegistry registry)</span> </span>&#123;  registry.enableStompBrokerRelay(<span class="string">&quot;/topic&quot;</span>, <span class="string">&quot;/queue&quot;</span>);  registry.setApplicationDestinationPrefixes(<span class="string">&quot;/app&quot;</span>, <span class="string">&quot;/foo&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSTOMPä»£ç†ä¸­ç»§ä¼šå‡è®¾ä»£ç†ç›‘å¬localhostçš„61613ç«¯å£ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯çš„usernameå’Œpasswordå‡ä¸ºâ€œguestâ€ã€‚å¦‚æœä½ çš„STOMPä»£ç†ä½äºå…¶ä»–çš„æœåŠ¡å™¨ä¸Šï¼Œæˆ–è€…é…ç½®æˆäº†ä¸åŒçš„å®¢æˆ·ç«¯å‡­è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨å¯ç”¨STOMPä»£ç†ä¸­ç»§çš„æ—¶å€™ï¼Œéœ€è¦é…ç½®è¿™äº›ç»†èŠ‚ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overridepublic</span> <span class="function"><span class="keyword">void</span> <span class="title">configureMessageBroker</span><span class="params">(MessageBrokerRegistry registry)</span> </span>&#123;  registry.enableStompBrokerRelay(<span class="string">&quot;/topic&quot;</span>, <span class="string">&quot;/queue&quot;</span>)          .setRelayHost(<span class="string">&quot;rabbit.someotherserver&quot;</span>)          .setRelayPort(<span class="number">62623</span>)          .setClientLogin(<span class="string">&quot;macropolo&quot;</span>)          .setClientPasscode(<span class="string">&quot;lermein01&quot;</span>);  registry.setApplicationDestinationPrefixes(<span class="string">&quot;/app&quot;</span>, <span class="string">&quot;/foo&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šçš„è¿™ä¸ªé…ç½®è°ƒæ•´äº†æœåŠ¡å™¨ã€ç«¯å£ä»¥åŠå‡­è¯ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯å¿…é¡»è¦é…ç½®æ‰€æœ‰çš„è¿™äº›é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åªæƒ³ä¿®æ”¹ä¸­ç»§ç«¯å£ï¼Œé‚£ä¹ˆå¯ä»¥åªè°ƒç”¨setRelayHost()æ–¹æ³•ï¼Œåœ¨é…ç½®ä¸­ä¸å¿…ä½¿ç”¨å…¶ä»–çš„Setteræ–¹æ³•ã€‚</p>
<p>ç°åœ¨ï¼ŒSpringå·²ç»é…ç½®å°±ç»ªï¼Œå¯ä»¥ç”¨æ¥å¤„ç†STOMPæ¶ˆæ¯äº†ã€‚</p>
<h4 id="å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„STOMPæ¶ˆæ¯"><a href="#å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„STOMPæ¶ˆæ¯" class="headerlink" title="å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„STOMPæ¶ˆæ¯"></a>å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„STOMPæ¶ˆæ¯</h4><p>æˆ‘ä»¬åœ¨ç¬¬5ç« å·²ç»å­¦ä¹ è¿‡ï¼ŒSpring MVCä¸ºå¤„ç†HTTP Webè¯·æ±‚æä¾›äº†é¢å‘æ³¨è§£çš„ç¼–ç¨‹æ¨¡å‹ã€‚@RequestMappingæ˜¯Spring MVCä¸­æœ€è‘—åçš„æ³¨è§£ï¼Œå®ƒä¼šå°†HTTPè¯·æ±‚æ˜ å°„åˆ°å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†çš„æ–¹æ³•ä¸Šã€‚åœ¨ç¬¬16ç« ï¼Œæˆ‘ä»¬ä¹Ÿæ›¾ç»çœ‹åˆ°ç›¸åŒçš„ç¼–ç¨‹æ¨¡å‹æ‰©å±•åˆ°äº†RESTfulçš„èµ„æºå¤„ç†ä¸­ã€‚</p>
<p>STOMPå’ŒWebSocketæ›´å¤šçš„æ˜¯å…³äºå¼‚æ­¥æ¶ˆæ¯ï¼Œä¸HTTPçš„è¯·æ±‚-å“åº”æ–¹å¼æœ‰æ‰€ä¸åŒã€‚ä½†æ˜¯ï¼ŒSpringæä¾›äº†éå¸¸ç±»ä¼¼äºSpring MVCçš„ç¼–ç¨‹æ¨¡å‹æ¥å¤„ç†STOMPæ¶ˆæ¯ã€‚å®ƒéå¸¸åœ°ç›¸ä¼¼ï¼Œä»¥è‡³äºå¯¹STOMPæ¶ˆæ¯çš„å¤„ç†å™¨æ–¹æ³•ä¹Ÿä¼šåŒ…å«åœ¨å¸¦æœ‰@Controlleræ³¨è§£çš„ç±»ä¸­ã€‚</p>
<p>Spring 4.0å¼•å…¥äº†@MessageMappingæ³¨è§£ï¼Œå®ƒç”¨äºSTOMPæ¶ˆæ¯çš„å¤„ç†ï¼Œç±»ä¼¼äºSpring MVCçš„@RequestMappingæ³¨è§£ã€‚å½“æ¶ˆæ¯æŠµè¾¾æŸä¸ªç‰¹å®šçš„ç›®çš„åœ°æ—¶ï¼Œå¸¦æœ‰@MessageMappingæ³¨è§£çš„æ–¹æ³•èƒ½å¤Ÿå¤„ç†è¿™äº›æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘å¦‚ä¸‹ç¨‹åºæ¸…å•ä¸­çš„æ§åˆ¶å™¨ç±»ã€‚</p>
<p>ç¨‹åºæ¸…å•18.6ã€€å€ŸåŠ©@MessageMappingæ³¨è§£èƒ½å¤Ÿåœ¨æ§åˆ¶å™¨ä¸­å¤„ç†STOMPæ¶ˆæ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> marcopolo;<span class="keyword">import</span> org.slf4j.Logger;<span class="keyword">import</span> org.slf4j.LoggerFactory;<span class="keyword">import</span> org.springframework.messaging.handler.annotation.MessageMapping;<span class="keyword">import</span> org.springframework.stereotype.Controller;<span class="meta">@Controllerpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">MarcoController</span> </span>&#123;  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory      .getLogger(MarcoController.class);  <span class="meta">@MessageMapping(&quot;/marco&quot;)</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleShout</span><span class="params">(Shout incoming)</span> </span>&#123;    logger.info(<span class="string">&quot;Received message: &quot;</span> + incoming.getMessage());  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹ä¸€çœ‹ä¸Šå»ï¼Œå®ƒéå¸¸ç±»ä¼¼äºå…¶ä»–çš„Spring MVCæ§åˆ¶å™¨ç±»ã€‚å®ƒä½¿ç”¨äº†@Controlleræ³¨è§£ï¼Œæ‰€ä»¥ç»„ä»¶æ‰«æèƒ½å¤Ÿæ‰¾åˆ°å®ƒå¹¶å°†å…¶æ³¨å†Œä¸ºbeanã€‚å°±åƒå…¶ä»–çš„@Controllerç±»ä¸€æ ·ï¼Œå®ƒä¹ŸåŒ…å«äº†å¤„ç†å™¨æ–¹æ³•ã€‚</p>
<p>ä½†æ˜¯è¿™ä¸ªå¤„ç†å™¨æ–¹æ³•ä¸æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„æœ‰ä¸€ç‚¹åŒºåˆ«ã€‚handleShout()æ–¹æ³•æ²¡æœ‰ä½¿ç”¨@RequestMappingæ³¨è§£ï¼Œè€Œæ˜¯ä½¿ç”¨äº†@MessageMappingæ³¨è§£ã€‚è¿™è¡¨ç¤ºhandleShout()æ–¹æ³•èƒ½å¤Ÿå¤„ç†æŒ‡å®šç›®çš„åœ°ä¸Šåˆ°è¾¾çš„æ¶ˆæ¯ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¿™ä¸ªç›®çš„åœ°ä¹Ÿå°±æ˜¯â€œ/app/marcoâ€ï¼ˆâ€œ/appâ€å‰ç¼€æ˜¯éšå«çš„ï¼Œå› ä¸ºæˆ‘ä»¬å°†å…¶é…ç½®ä¸ºåº”ç”¨çš„ç›®<br>çš„åœ°å‰ç¼€ï¼‰ã€‚</p>
<p>å› ä¸ºhandleShout()æ–¹æ³•æ¥æ”¶ä¸€ä¸ªShoutå‚æ•°ï¼Œæ‰€ä»¥Springçš„æŸä¸€ä¸ªæ¶ˆæ¯è½¬æ¢å™¨ä¼šå°†STOMPæ¶ˆæ¯çš„è´Ÿè½½è½¬æ¢ä¸ºShoutå¯¹è±¡ã€‚Shoutç±»éå¸¸ç®€å•ï¼Œå®ƒæ˜¯åªå…·æœ‰ä¸€ä¸ªå±æ€§çš„JavaBeanï¼ŒåŒ…å«äº†æ¶ˆæ¯çš„å†…å®¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> marcopolo;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Shout</span> </span>&#123;  <span class="keyword">private</span> String message;  <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> message;  &#125;  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessage</span><span class="params">(String message)</span> </span>&#123;    <span class="keyword">this</span>.message = message;  &#125;  &#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæˆ‘ä»¬ç°åœ¨å¤„ç†çš„ä¸æ˜¯HTTPï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨Springçš„HttpMessageConverterå®ç°å°†è´Ÿè½½è½¬æ¢ä¸ºShoutå¯¹è±¡ã€‚Spring 4.0æä¾›äº†å‡ ä¸ªæ¶ˆæ¯è½¬æ¢å™¨ï¼Œä½œä¸ºå…¶æ¶ˆæ¯APIçš„ä¸€éƒ¨åˆ†ã€‚è¡¨18.1æè¿°äº†è¿™äº›æ¶ˆæ¯è½¬æ¢å™¨ï¼Œåœ¨å¤„ç†STOMPæ¶ˆæ¯çš„æ—¶å€™å¯èƒ½ä¼šç”¨åˆ°å®ƒä»¬ã€‚</p>
<p>è¡¨18.1ã€€Springèƒ½å¤Ÿä½¿ç”¨æŸä¸€ä¸ªæ¶ˆæ¯è½¬æ¢å™¨å°†æ¶ˆæ¯è´Ÿè½½è½¬æ¢ä¸ºJavaç±»å‹</p>
<table>
<thead>
<tr>
<th>æ¶ˆæ¯è½¬æ¢å™¨</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody><tr>
<td>ByteArrayMessageConverter</td>
<td>å®ç°MIMEç±»å‹ä¸ºâ€œapplication/octetstreamâ€çš„æ¶ˆæ¯ä¸byte[]ä¹‹é—´çš„ç›¸äº’è½¬æ¢</td>
</tr>
<tr>
<td>MappingJackson2MessageConverter</td>
<td>å®ç°MIMEç±»å‹ä¸ºâ€œapplication/jsonâ€çš„æ¶ˆæ¯ä¸Javaå¯¹è±¡ä¹‹é—´çš„ç›¸äº’è½¬æ¢</td>
</tr>
<tr>
<td>StringMessageConverter</td>
<td>å®ç°MIMEç±»å‹ä¸ºâ€œtext/plainâ€çš„æ¶ˆæ¯ä¸Stringä¹‹é—´çš„ç›¸äº’è½¬æ¢</td>
</tr>
</tbody></table>
<p>å‡è®¾handleShout()æ–¹æ³•æ‰€å¤„ç†æ¶ˆæ¯çš„å†…å®¹ç±»å‹ä¸ºâ€œapplication/jsonâ€ï¼ˆè¿™åº”è¯¥æ˜¯ä¸€ä¸ªå®‰å…¨çš„å‡è®¾ï¼Œå› ä¸ºShoutä¸æ˜¯byte[]å’ŒStringï¼‰ï¼ŒMappingJackson2MessageConverterä¼šè´Ÿè´£å°†JSONæ¶ˆæ¯è½¬æ¢ä¸ºShoutå¯¹è±¡ã€‚å°±åƒåœ¨HTTPä¸­å¯¹åº”çš„MappingJackson2HttpMessageConverterä¸€æ ·ï¼ŒMappingJackson2MessageConverterä¼šå°†å…¶ä»»åŠ¡å§”æ‰˜ç»™åº•å±‚çš„Jackson 2 JSONå¤„ç†å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒJacksonä¼šä½¿ç”¨åå°„å°†JSONå±æ€§æ˜ å°„ä¸ºJavaå¯¹è±¡çš„å±æ€§ã€‚å°½ç®¡åœ¨æœ¬ä¾‹ä¸­æ²¡æœ‰å¿…è¦ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨Javaç±»å‹ä¸Šä½¿ç”¨Jacksonæ³¨è§£ï¼Œå½±å“å…·ä½“çš„è½¬æ¢è¡Œä¸ºã€‚</p>
<p>å¤„ç†è®¢é˜…</p>
<p>é™¤äº†@MessagingMappingæ³¨è§£ä»¥å¤–ï¼ŒSpringè¿˜æä¾›äº†@SubscribeMappingæ³¨è§£ã€‚ä¸@MessagingMappingæ³¨è§£æ–¹æ³•ç±»ä¼¼ï¼Œå½“æ”¶åˆ°STOMPè®¢é˜…æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¸¦æœ‰@SubscribeMappingæ³¨è§£çš„æ–¹æ³•å°†ä¼šè§¦å‘ã€‚</p>
<p>å¾ˆé‡è¦çš„ä¸€ç‚¹ï¼Œä¸@MessagingMappingæ–¹æ³•ç±»ä¼¼ï¼Œ@SubscribeMappingæ–¹æ³•ä¹Ÿæ˜¯é€šè¿‡AnnotationMethodMessageHandleræ¥æ”¶æ¶ˆæ¯çš„ï¼ˆå¦‚å›¾18.2å’Œå›¾18.3æ‰€ç¤ºï¼‰ã€‚æŒ‰ç…§ç¨‹åºæ¸…å•18.5çš„é…ç½®ï¼Œè¿™å°±æ„å‘³ç€@SubscribeMappingæ–¹æ³•åªèƒ½å¤„ç†ç›®çš„åœ°ä»¥â€œ/appâ€ä¸ºå‰ç¼€çš„æ¶ˆæ¯ã€‚</p>
<p>è¿™å¯èƒ½çœ‹ä¸Šå»æœ‰äº›è¯¡å¼‚ï¼Œå› ä¸ºåº”ç”¨å‘å‡ºçš„æ¶ˆæ¯éƒ½ä¼šç»è¿‡ä»£ç†ï¼Œç›®çš„åœ°è¦ä»¥â€œ/topicâ€æˆ–â€œ/queueâ€æ‰“å¤´ã€‚å®¢æˆ·ç«¯ä¼šè®¢é˜…è¿™äº›ç›®çš„åœ°ï¼Œè€Œä¸ä¼šè®¢é˜…å‰ç¼€ä¸ºâ€œ/appâ€çš„ç›®çš„åœ°ã€‚å¦‚æœå®¢æˆ·ç«¯è®¢é˜…â€œ/topicâ€å’Œâ€œ/queueâ€è¿™æ ·çš„ç›®çš„åœ°ï¼Œé‚£ä¹ˆ@SubscribeMappingæ–¹æ³•ä¹Ÿå°±æ— æ³•å¤„ç†è¿™æ ·çš„è®¢é˜…äº†ã€‚å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œ@SubscribeMappingæœ‰ä»€ä¹ˆç”¨å¤„å‘¢ï¼Ÿ</p>
<p>@SubscribeMappingçš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯å®ç°è¯·æ±‚-å›åº”æ¨¡å¼ã€‚åœ¨è¯·æ±‚-å›åº”æ¨¡å¼ä¸­ï¼Œå®¢æˆ·ç«¯è®¢é˜…æŸä¸€ä¸ªç›®çš„åœ°ï¼Œç„¶åé¢„æœŸåœ¨è¿™ä¸ªç›®çš„åœ°ä¸Šè·å¾—ä¸€ä¸ªä¸€æ¬¡æ€§çš„å“åº”ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘å¦‚ä¸‹@SubscribeMappingæ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SubscribeMapping(&quot;/marco&quot;)</span><span class="function"><span class="keyword">public</span> Shout <span class="title">handleSubscription</span><span class="params">()</span> </span>&#123;  Shout outgoing = <span class="keyword">new</span> Shout();  outgoing.setMessage(<span class="string">&quot;Polo!&quot;</span>);  <span class="keyword">return</span> outgoing;&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒhandleSubscription()æ–¹æ³•ä½¿ç”¨äº†@SubscribeMappingæ³¨è§£ï¼Œç”¨è¿™ä¸ªæ–¹æ³•æ¥å¤„ç†å¯¹â€œ/app/marcoâ€ç›®çš„åœ°çš„è®¢é˜…ï¼ˆä¸@MessageMappingç±»ï¼Œâ€œ/appâ€æ˜¯éšå«çš„ï¼‰ã€‚å½“å¤„ç†è¿™ä¸ªè®¢é˜…æ—¶ï¼ŒhandleSubscription()æ–¹æ³•ä¼šäº§ç”Ÿä¸€ä¸ªè¾“å‡ºçš„Shoutå¯¹è±¡å¹¶å°†å…¶è¿”å›ã€‚ç„¶åï¼ŒShoutå¯¹è±¡ä¼šè½¬æ¢æˆä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¼šæŒ‰ç…§å®¢æˆ·ç«¯è®¢é˜…æ—¶ç›¸åŒçš„ç›®çš„åœ°å‘é€å›å®¢æˆ·ç«¯ã€‚</p>
<p>å¦‚æœä½ è§‰å¾—è¿™ç§è¯·æ±‚-å›åº”æ¨¡å¼ä¸HTTP GETçš„è¯·æ±‚-å“åº”æ¨¡å¼å¹¶æ²¡æœ‰å¤ªå¤§å·®åˆ«çš„è¯ï¼Œé‚£ä¹ˆä½ åŸºæœ¬ä¸Šæ˜¯æ­£ç¡®çš„ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œçš„å…³é”®åŒºåˆ«åœ¨äºHTTP GETè¯·æ±‚æ˜¯åŒæ­¥çš„ï¼Œè€Œè®¢é˜…çš„è¯·æ±‚-å›åº”æ¨¡å¼åˆ™æ˜¯å¼‚æ­¥çš„ï¼Œè¿™æ ·å®¢æˆ·ç«¯èƒ½å¤Ÿåœ¨å›åº”å¯ç”¨æ—¶å†å»å¤„ç†ï¼Œè€Œä¸å¿…ç­‰å¾…ã€‚</p>
<p>ç¼–å†™JavaScriptå®¢æˆ·ç«¯</p>
<p>handleShout()æ–¹æ³•å·²ç»å¯ä»¥å¤„ç†å‘é€è¿‡æ¥çš„æ¶ˆæ¯äº†ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦çš„å°±æ˜¯å‘é€æ¶ˆæ¯çš„å®¢æˆ·ç«¯ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†ä¸€äº›JavaScriptå®¢æˆ·ç«¯ä»£ç ï¼Œå®ƒä¼šè¿<br>æ¥â€œ/marcopoloâ€ç«¯ç‚¹å¹¶å‘é€â€œMarco!â€æ¶ˆæ¯ã€‚</p>
<p>ç¨‹åºæ¸…å•18.7ã€€å€ŸåŠ©STOMPåº“ï¼Œé€šè¿‡JavaScriptå‘é€æ¶ˆæ¯</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">&#x27;http://&#x27;</span> + <span class="built_in">window</span>.location.host + <span class="string">&#x27;/stomp/marcopolo&#x27;</span>;<span class="keyword">var</span> sock = <span class="keyword">new</span> SockJS(url);<span class="keyword">var</span> stomp = Stomp.over(socke);<span class="keyword">var</span> payload = <span class="built_in">JSON</span>.stringify(&#123; <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Marco!&#x27;</span> &#125;);stomp.connect(<span class="string">&#x27;guest&#x27;</span>, <span class="string">&#x27;guest&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">frame</span>) </span>&#123;  stomp.send(<span class="string">&quot;/marco&quot;</span>, &#123;&#125;, payload);&#125;);</span><br></pre></td></tr></table></figure>

<p>ä¸æˆ‘ä»¬ä¹‹å‰çš„JavaScriptå®¢æˆ·ç«¯æ ·ä¾‹ç±»ä¼¼ï¼Œåœ¨è¿™é‡Œé¦–å…ˆé’ˆå¯¹ç»™å®šçš„URLåˆ›å»ºä¸€ä¸ªSockJSå®ä¾‹ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒURLå¼•ç”¨çš„æ˜¯ç¨‹åºæ¸…å•18.5ä¸­æ‰€é…ç½®çš„STOMPç«¯ç‚¹ï¼ˆä¸åŒ…æ‹¬åº”ç”¨çš„ä¸Šä¸‹æ–‡è·¯å¾„â€œ/stompâ€ï¼‰ã€‚</p>
<p>ä½†æ˜¯ï¼Œè¿™é‡Œçš„åŒºåˆ«åœ¨äºï¼Œæˆ‘ä»¬ä¸å†ç›´æ¥ä½¿ç”¨SockJSï¼Œè€Œæ˜¯é€šè¿‡è°ƒç”¨Stomp.over(sock)åˆ›å»ºäº†ä¸€ä¸ªSTOMPå®¢æˆ·ç«¯å®ä¾‹ã€‚è¿™å®é™…ä¸Šå°è£…äº†SockJSï¼Œè¿™æ ·å°±èƒ½åœ¨WebSocketè¿æ¥ä¸Šå‘é€STOMPæ¶ˆæ¯ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨STOMPè¿›è¡Œè¿æ¥ï¼Œå‡è®¾è¿æ¥æˆåŠŸï¼Œç„¶åå‘é€å¸¦æœ‰JSONè´Ÿè½½çš„æ¶ˆæ¯åˆ°åä¸ºâ€œ/marcoâ€çš„ç›®çš„åœ°ã€‚å¾€send()æ–¹æ³•ä¼ é€’çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¤´ä¿¡æ¯çš„Mapï¼Œå®ƒä¼šåŒ…å«åœ¨STOMPçš„å¸§ä¸­ï¼Œä¸è¿‡åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æä¾›ä»»ä½•å‚æ•°ï¼ŒMapæ˜¯ç©ºçš„ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†èƒ½å¤Ÿå‘é€æ¶ˆæ¯åˆ°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ï¼Œä»¥åŠç”¨æ¥å¤„ç†æ¶ˆæ¯çš„æœåŠ¡ç«¯å¤„ç†å™¨æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªå¥½çš„å¼€ç«¯ï¼Œä½†æ˜¯ä½ å¯èƒ½å·²ç»å‘ç°è¿™éƒ½æ˜¯å•å‘çš„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®©æœåŠ¡å™¨å‘å‡ºçš„å£°éŸ³ï¼Œçœ‹ä¸€ä¸‹å¦‚ä½•å‘é€æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ã€‚</p>
<h4 id="å‘é€æ¶ˆæ¯åˆ°å®¢æˆ·ç«¯"><a href="#å‘é€æ¶ˆæ¯åˆ°å®¢æˆ·ç«¯" class="headerlink" title="å‘é€æ¶ˆæ¯åˆ°å®¢æˆ·ç«¯"></a>å‘é€æ¶ˆæ¯åˆ°å®¢æˆ·ç«¯</h4><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®¢æˆ·ç«¯è´Ÿè´£äº†æ‰€æœ‰çš„æ¶ˆæ¯å‘é€ï¼ŒæœåŠ¡å™¨åªèƒ½ç›‘å¬è¿™äº›æ¶ˆæ¯ã€‚å¯¹äºWebSocketå’ŒSTOMPæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ç§åˆæ³•çš„ç”¨æ³•ï¼Œä½†æ˜¯å½“ä½ è€ƒè™‘ä½¿ç”¨WebSocketçš„æ—¶å€™ï¼Œæ‰€è®¾æƒ³çš„ä½¿ç”¨åœºæ™¯ææ€•å¹¶éå¦‚æ­¤ã€‚</p>
<p>WebSocketé€šå¸¸è§†ä¸ºæœåŠ¡å™¨å‘é€æ•°æ®ç»™æµè§ˆå™¨çš„ä¸€ç§æ–¹å¼ï¼Œé‡‡ç”¨è¿™ç§æ–¹å¼æ‰€å‘é€çš„æ•°æ®ä¸å¿…ä½äºHTTPè¯·æ±‚çš„å“åº”ä¸­ã€‚ä½¿ç”¨Springå’ŒWebSocket/STOMPçš„è¯ï¼Œè¯¥å¦‚ä½•ä¸åŸºäºæµè§ˆå™¨çš„å®¢æˆ·ç«¯é€šä¿¡å‘¢ï¼Ÿ</p>
<p>Springæä¾›äº†ä¸¤ç§å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯çš„æ–¹æ³•ï¼š</p>
<ul>
<li>ä½œä¸ºå¤„ç†æ¶ˆæ¯æˆ–å¤„ç†è®¢é˜…çš„é™„å¸¦ç»“æœï¼›</li>
<li>ä½¿ç”¨æ¶ˆæ¯æ¨¡æ¿ã€‚</li>
</ul>
<p>æˆ‘ä»¬å·²ç»äº†è§£äº†ä¸€äº›å¤„ç†æ¶ˆæ¯å’Œå¤„ç†è®¢é˜…çš„æ–¹æ³•ï¼Œæ‰€ä»¥é¦–å…ˆçœ‹ä¸€ä¸‹å¦‚ä½•é€šè¿‡è¿™äº›æ–¹æ³•å‘é€æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ã€‚ç„¶åï¼Œå†çœ‹ä¸€ä¸‹Springçš„SimpMessagingTemplateï¼Œå®ƒèƒ½å¤Ÿåœ¨åº”ç”¨çš„ä»»ä½•åœ°æ–¹å‘é€æ¶ˆæ¯ã€‚</p>
<p>åœ¨å¤„ç†æ¶ˆæ¯ä¹‹åï¼Œå‘é€æ¶ˆæ¯</p>
<p>ç¨‹åºæ¸…å•18.6ä¸­ï¼ŒhandleShout()åªæ˜¯ç®€å•åœ°è¿”å›voidã€‚å®ƒçš„ä»»åŠ¡å°±æ˜¯å¤„ç†æ¶ˆæ¯ï¼Œå¹¶ä¸éœ€è¦ç»™å®¢æˆ·ç«¯å›åº”ã€‚å¦‚æœä½ æƒ³è¦åœ¨æ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™ï¼ŒåŒæ—¶åœ¨å“åº”ä¸­å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆéœ€è¦åšçš„ä»…ä»…æ˜¯å°†å†…å®¹è¿”å›å°±å¯ä»¥äº†ï¼Œæ–¹æ³•ç­¾åä¸å†æ˜¯ä½¿ç”¨voidã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³å‘é€â€œPolo!â€æ¶ˆæ¯ä½œä¸ºâ€œMarco!â€æ¶ˆæ¯çš„å›åº”ï¼Œé‚£ä¹ˆåªéœ€å°†handleShout()ä¿®æ”¹ä¸ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MessageMapping(&quot;/marco&quot;)</span><span class="function"><span class="keyword">public</span> Shout <span class="title">handleShout</span><span class="params">(Shout incoming)</span> </span>&#123;  logger.info(<span class="string">&quot;Received message: &quot;</span> + incoming.getMessage());    Shout outgoing = <span class="keyword">new</span> Shout();  outgoing.setMessage(<span class="string">&quot;Polo!&quot;</span>);  <span class="keyword">return</span> outgoing;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªæ–°ç‰ˆæœ¬çš„handleShout()æ–¹æ³•ä¸­ï¼Œä¼šè¿”å›ä¸€ä¸ªæ–°çš„Shoutå¯¹è±¡ã€‚é€šè¿‡ç®€å•åœ°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¤„ç†å™¨æ–¹æ³•åŒæ—¶ä¹Ÿå˜æˆäº†å‘é€æ–¹æ³•ã€‚</p>
<p>å½“@MessageMappingæ³¨è§£æ ‡ç¤ºçš„æ–¹æ³•æœ‰è¿”å›å€¼çš„æ—¶å€™ï¼Œè¿”å›çš„å¯¹è±¡å°†ä¼šè¿›è¡Œè½¬æ¢ï¼ˆé€šè¿‡æ¶ˆæ¯è½¬æ¢å™¨ï¼‰å¹¶æ”¾åˆ°STOMPå¸§çš„è´Ÿè½½ä¸­ï¼Œç„¶åå‘é€ç»™æ¶ˆæ¯ä»£ç†ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¸§æ‰€å‘å¾€çš„ç›®çš„åœ°ä¼šä¸è§¦å‘å¤„ç†å™¨æ–¹æ³•çš„ç›®çš„åœ°ç›¸åŒï¼Œåªä¸è¿‡ä¼šæ·»åŠ ä¸Šâ€œ/topicâ€å‰ç¼€ã€‚å°±æœ¬ä¾‹è€Œè¨€ï¼Œè¿™æ„å‘³ç€handleShout()æ–¹æ³•æ‰€è¿”å›çš„Shoutå¯¹è±¡ä¼šå†™å…¥åˆ°STOMPå¸§çš„è´Ÿè½½ä¸­ï¼Œå¹¶å‘å¸ƒåˆ°â€œ/topic/marcoâ€ç›®çš„åœ°ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ºæ–¹æ³•æ·»åŠ @SendToæ³¨è§£ï¼Œé‡è½½ç›®çš„åœ°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MessageMapping(&quot;/marco&quot;)</span><span class="meta">@SendTo(&quot;/topic/shout&quot;)</span><span class="function"><span class="keyword">public</span> Shout <span class="title">handleShout</span><span class="params">(Shout incoming)</span> </span>&#123;  logger.info(<span class="string">&quot;Received message: &quot;</span> + incoming.getMessage());    Shout outgoing = <span class="keyword">new</span> Shout();  outgoing.setMessage(<span class="string">&quot;Polo!&quot;</span>);  <span class="keyword">return</span> outgoing;&#125;</span><br></pre></td></tr></table></figure>

<p>æŒ‰ç…§è¿™ä¸ª@SendToæ³¨è§£ï¼Œæ¶ˆæ¯å°†ä¼šå‘å¸ƒåˆ°â€œ/topic/shoutâ€ã€‚æ‰€æœ‰è®¢é˜…è¿™ä¸ªä¸»é¢˜çš„åº”ç”¨ï¼ˆå¦‚å®¢æˆ·ç«¯ï¼‰éƒ½ä¼šæ”¶åˆ°è¿™æ¡æ¶ˆæ¯ã€‚</p>
<p>è¿™æ ·çš„è¯ï¼ŒhandleShout()åœ¨æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯çš„æ—¶å€™ï¼Œä½œä¸ºå“åº”ä¹Ÿä¼šå‘é€ä¸€æ¡æ¶ˆæ¯ã€‚æŒ‰ç…§ç±»ä¼¼çš„æ–¹å¼ï¼Œ@SubscribeMappingæ³¨è§£æ ‡æ³¨çš„æ–¹å¼ä¹Ÿèƒ½å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œä½œä¸ºè®¢é˜…çš„å›åº”ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ä¸ºæ§åˆ¶å™¨æ·»åŠ å¦‚ä¸‹çš„æ–¹æ³•ï¼Œå½“å®¢æˆ·ç«¯è®¢é˜…çš„æ—¶å€™ï¼Œå°†ä¼šå‘é€ä¸€æ¡Shoutä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SubscribeMapping(&quot;/marco&quot;)</span><span class="function"><span class="keyword">public</span> Shout <span class="title">handleSubscription</span><span class="params">()</span> </span>&#123;  Shout outgoing = <span class="keyword">new</span> Shout();  outgoing.setMessage(<span class="string">&quot;Polo!&quot;</span>);  <span class="keyword">return</span> outgoing;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„@SubscribeMappingæ³¨è§£è¡¨æ˜å½“å®¢æˆ·ç«¯è®¢é˜…â€œ/app/marcoâ€ï¼ˆâ€œ/appâ€æ˜¯åº”ç”¨ç›®çš„åœ°çš„å‰ç¼€ï¼‰ç›®çš„åœ°çš„æ—¶å€™ï¼Œå°†ä¼šè°ƒç”¨handleSubscription()æ–¹æ³•ã€‚å®ƒæ‰€è¿”å›çš„Shoutå¯¹è±¡å°†ä¼šè¿›è¡Œè½¬æ¢å¹¶å‘é€å›å®¢æˆ·ç«¯ã€‚</p>
<p>@SubscribeMappingçš„åŒºåˆ«åœ¨äºè¿™é‡Œçš„Shoutæ¶ˆæ¯å°†ä¼šç›´æ¥å‘é€ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸å¿…ç»è¿‡æ¶ˆæ¯ä»£ç†ã€‚å¦‚æœä½ ä¸ºæ–¹æ³•æ·»åŠ @SendToæ³¨è§£çš„è¯ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°†ä¼šå‘é€åˆ°æŒ‡å®šçš„ç›®çš„åœ°ï¼Œè¿™æ ·ä¼šç»è¿‡ä»£ç†ã€‚</p>
<p>åœ¨åº”ç”¨çš„ä»»æ„åœ°æ–¹å‘é€æ¶ˆæ¯</p>
<p>@MessageMappingå’Œ@SubscribeMappingæä¾›äº†ä¸€ç§å¾ˆç®€å•çš„æ–¹å¼æ¥å‘é€æ¶ˆæ¯ï¼Œè¿™æ˜¯æ¥æ”¶æ¶ˆæ¯æˆ–å¤„ç†è®¢é˜…çš„é™„å¸¦ç»“æœã€‚ä¸è¿‡ï¼ŒSpringçš„SimpMessagingTemplateèƒ½å¤Ÿåœ¨åº”ç”¨çš„ä»»ä½•åœ°æ–¹å‘é€æ¶ˆæ¯ï¼Œç”šè‡³ä¸å¿…ä»¥é¦–å…ˆæ¥æ”¶ä¸€æ¡æ¶ˆæ¯ä½œä¸ºå‰æã€‚</p>
<p>ä½¿ç”¨SimpMessagingTemplateçš„æœ€ç®€å•æ–¹å¼æ˜¯å°†å®ƒï¼ˆæˆ–è€…å…¶æ¥å£SimpMessageSendingOperationsï¼‰è‡ªåŠ¨è£…é…åˆ°æ‰€éœ€çš„å¯¹è±¡ä¸­ã€‚</p>
<p>ä¸ºäº†å°†è¿™ä¸€åˆ‡ä»˜è¯¸å®æ–½ï¼Œæˆ‘ä»¬é‡æ–°çœ‹ä¸€ä¸‹Spittrçš„é¦–é¡µï¼Œä¸ºå…¶æä¾›å®æ—¶çš„Spittle feedåŠŸèƒ½ã€‚æŒ‰ç…§å…¶å½“å‰çš„å†™æ³•ï¼Œæ§åˆ¶å™¨ä¼šå¤„ç†é¦–é¡µçš„è¯·æ±‚ï¼Œå°†æœ€æ–°çš„Spittleåˆ—è¡¨è·å–åˆ°ï¼Œå¹¶å°†å…¶æ”¾åˆ°æ¨¡å‹ä¸­ï¼Œç„¶åæ¸²æŸ“åˆ°ç”¨æˆ·çš„æµè§ˆå™¨ä¸­ã€‚å°½ç®¡è¿™æ ·è¿è¡Œèµ·æ¥ä¹Ÿä¸é”™ï¼Œä½†æ˜¯å®ƒå¹¶æ²¡æœ‰æä¾›Spittleæ›´æ–°çš„å®æ—¶feedã€‚å¦‚æœç”¨æˆ·æƒ³è¦çœ‹ä¸€ä¸ªæ›´æ–°çš„Spittle<br>feedï¼Œé‚£å¿…é¡»è¦åœ¨æµè§ˆå™¨ä¸­åˆ·æ–°é¡µé¢ã€‚</p>
<p>æˆ‘ä»¬ä¸å¿…è¦æ±‚ç”¨æˆ·åˆ·æ–°é¡µé¢ï¼Œè€Œæ˜¯è®©é¦–é¡µè®¢é˜…ä¸€ä¸ªSTOMPä¸»é¢˜ï¼Œåœ¨Spittleåˆ›å»ºçš„æ—¶å€™ï¼Œè¯¥ä¸»é¢˜èƒ½å¤Ÿæ”¶åˆ°Spittleæ›´æ–°çš„å®æ—¶feedã€‚åœ¨é¦–é¡µä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ å¦‚ä¸‹çš„JavaScriptä»£ç å—ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;  <span class="keyword">var</span> sock = <span class="keyword">new</span> SockJS(<span class="string">&#x27;spittr&#x27;</span>);  <span class="keyword">var</span> stomp = Stomp.over(sock);  stomp.connect(<span class="string">&#x27;guest&#x27;</span>, <span class="string">&#x27;guest&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">frame</span>) </span>&#123;    <span class="built_in">console</span>.log(<span class="string">&#x27;Connected&#x27;</span>);    stomp.subscribe(<span class="string">&quot;/topic/spittlefeed&quot;</span>, handleSpittle);  &#125;);    <span class="function"><span class="keyword">function</span> <span class="title">handleSpittle</span>(<span class="params">incoming</span>) </span>&#123;    <span class="keyword">var</span> spittle = <span class="built_in">JSON</span>.parse(incoming.body);    <span class="built_in">console</span>.log(<span class="string">&#x27;Received:&#x27;</span>, spittle);    <span class="keyword">var</span> source = $&#123;<span class="string">&quot;#spittle-template&quot;</span>).html();    <span class="keyword">var</span> template = Handlebars.compile(source);    <span class="keyword">var</span> spittleHtml = template(spittle);    $(<span class="string">&#x27;.spittleList&#x27;</span>).prepend(spittleHtml);  &#125;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸ä¹‹å‰çš„æ ·ä¾‹ä¸€æ ·ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†SockJSå®ä¾‹ï¼Œç„¶ååŸºäºè¯¥SockJSå®ä¾‹åˆ›å»ºäº†Stompå®ä¾‹ã€‚åœ¨è¿æ¥åˆ°STOMPä»£ç†ä¹‹åï¼Œæˆ‘ä»¬è®¢é˜…äº†â€œ/topic/spittlefeedâ€ï¼Œå¹¶æŒ‡å®šå½“æ¶ˆæ¯è¾¾åˆ°çš„æ—¶å€™ï¼Œç”±handleSpittle()å‡½æ•°æ¥å¤„ç†Spittleæ›´æ–°ã€‚handleSpittle()å‡½æ•°ä¼šå°†ä¼ å…¥çš„æ¶ˆæ¯ä½“è§£æä¸ºå¯¹åº”çš„JavaScriptå¯¹è±¡ï¼Œç„¶åä½¿ç”¨Handlebarsåº“å°†Spittleæ•°æ®æ¸²æŸ“ä¸ºHTMLå¹¶æ’å…¥åˆ°åˆ—è¡¨ä¸­ã€‚</p>
<p>Handlebarsæ¨¡æ¿å®šä¹‰åœ¨ä¸€ä¸ªå•ç‹¬çš„<script>æ ‡ç­¾ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script id=<span class="string">&quot;spittle-template&quot;</span> type=<span class="string">&quot;text/x-handlebars-template&quot;</span>&gt;  <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">&quot;preexist&quot;</span>&gt;</span>    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spittleMessage&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>    <span class="tag">&lt;<span class="name">div</span>&gt;</span>      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;spittleTime&quot;</span>&gt;</span>&#123;&#123; time &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;spittleLocation&quot;</span>&gt;</span>(&#123;&#123; latitude &#125;&#125;, &#123;&#123; longitude &#125;&#125;)<span class="tag">&lt;/<span class="name">span</span>&gt;</span>    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>åœ¨æœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨SimpMessagingTemplateå°†æ‰€æœ‰æ–°åˆ›å»ºçš„Spittleä»¥æ¶ˆæ¯çš„å½¢å¼å‘å¸ƒåˆ°â€œ/topic/spittlefeedâ€ä¸»é¢˜ä¸Šã€‚å¦‚ä¸‹ç¨‹åºæ¸…å•å±•ç°çš„SpittleFeedServiceImplå°±æ˜¯å®ç°è¯¥åŠŸèƒ½çš„ç®€å•æœåŠ¡ï¼š</p>
<p>ç¨‹åºæ¸…å•18.8ã€€SimpMessagingTemplateèƒ½å¤Ÿåœ¨åº”ç”¨çš„ä»»ä½•åœ°æ–¹å‘å¸ƒæ¶ˆæ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.messaging.simp.SimpMessagingTemplate;<span class="keyword">import</span> org.springframework.stereotype.Service;<span class="meta">@Servicepublic</span> <span class="class"><span class="keyword">class</span> <span class="title">SpittleFeedServiceImpl</span> <span class="keyword">implements</span> <span class="title">SpittleFeedService</span> </span>&#123;  <span class="keyword">private</span> SimpMessagingTemplate messaging;	  <span class="meta">@Autowired</span>  <span class="function"><span class="keyword">public</span> <span class="title">SpittleFeedServiceImpl</span><span class="params">(SimpMessagingTemplate messaging)</span> </span>&#123;	<span class="keyword">this</span>.messaging = messaging;  &#125;  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">broadcastSpittle</span><span class="params">(Spittle spittle)</span> </span>&#123;	messaging.convertAndSend(<span class="string">&quot;/topic/spittlefeed&quot;</span>, spittle);  &#125;	&#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®Springæ”¯æŒSTOMPçš„ä¸€ä¸ªå‰¯ä½œç”¨å°±æ˜¯åœ¨Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­å·²ç»åŒ…å«äº†SimpMessagingTemplateã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œæ²¡æœ‰å¿…è¦å†åˆ›å»ºæ–°çš„å®ä¾‹ã€‚SpittleFeedServiceImplçš„æ„é€ å™¨ä½¿ç”¨äº†@Autowiredæ³¨è§£ï¼Œè¿™æ ·å½“åˆ›å»ºSpittleFeedServiceImplçš„æ—¶å€™ï¼Œå°±èƒ½æ³¨å…¥SimpMessagingTemplateï¼ˆä»¥<br>SimpMessageSendingOperationsçš„å½¢å¼ï¼‰äº†ã€‚</p>
<p>å‘é€Spittleæ¶ˆæ¯çš„åœ°æ–¹åœ¨broadcastSpittle()æ–¹æ³•ä¸­ã€‚å®ƒåœ¨æ³¨å…¥çš„SimpMessageSendingOperationsä¸Šè°ƒç”¨äº†convertAndSend()æ–¹æ³•ï¼Œå°†Spittleè½¬æ¢ä¸ºæ¶ˆæ¯ï¼Œå¹¶å°†å…¶å‘é€åˆ°â€œ/topic/spittlefeedâ€ä¸»é¢˜ä¸Šã€‚å¦‚æœä½ è§‰å¾—convertAndSend()æ–¹æ³•çœ‹èµ·æ¥å¾ˆçœ¼ç†Ÿçš„è¯ï¼Œé‚£æ˜¯å› ä¸ºå®ƒæ¨¡æ‹Ÿäº†JmsTemplateå’ŒRabbitTemplateæ‰€æä¾›çš„åŒåæ–¹æ³•ã€‚</p>
<p>ä¸ç®¡æˆ‘ä»¬é€šè¿‡convertAndSend()æ–¹æ³•ï¼Œè¿˜æ˜¯å€ŸåŠ©å¤„ç†å™¨æ–¹æ³•çš„ç»“æœï¼Œåœ¨å‘å¸ƒæ¶ˆæ¯ç»™STOMPä¸»é¢˜çš„æ—¶å€™ï¼Œæ‰€æœ‰è®¢é˜…è¯¥ä¸»é¢˜çš„å®¢æˆ·ç«¯éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰€æœ‰çš„å®¢æˆ·ç«¯éƒ½èƒ½åŠæ—¶çœ‹åˆ°å®æ—¶çš„Spittle feedï¼Œè¿™ç§åšæ³•æ˜¯å¾ˆå¥½çš„ã€‚ä½†æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å‘é€æ¶ˆæ¯ç»™æŒ‡å®šçš„ç”¨æˆ·ï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„å®¢æˆ·ç«¯ã€‚</p>
<h3 id="ä¸ºç›®æ ‡ç”¨æˆ·å‘é€æ¶ˆæ¯"><a href="#ä¸ºç›®æ ‡ç”¨æˆ·å‘é€æ¶ˆæ¯" class="headerlink" title="ä¸ºç›®æ ‡ç”¨æˆ·å‘é€æ¶ˆæ¯"></a>ä¸ºç›®æ ‡ç”¨æˆ·å‘é€æ¶ˆæ¯</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰€å‘é€å’Œæ¥æ”¶çš„æ¶ˆæ¯éƒ½æ˜¯å®¢æˆ·ç«¯ï¼ˆåœ¨Webæµè§ˆå™¨ä¸­ï¼‰å’ŒæœåŠ¡å™¨ç«¯ä¹‹é—´çš„ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°å®¢æˆ·ç«¯çš„ç”¨æˆ·ã€‚å½“å¸¦æœ‰@MessageMappingæ³¨è§£çš„æ–¹æ³•è§¦å‘æ—¶ï¼Œæˆ‘ä»¬çŸ¥é“æ”¶åˆ°äº†æ¶ˆæ¯ï¼Œä½†æ˜¯å¹¶ä¸çŸ¥é“æ¶ˆæ¯æ¥æºäºè°ã€‚ç±»ä¼¼åœ°ï¼Œå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“ç”¨æˆ·æ˜¯è°ï¼Œæ‰€ä»¥æ¶ˆæ¯ä¼šå‘é€åˆ°æ‰€æœ‰è®¢é˜…å¯¹åº”ä¸»é¢˜çš„å®¢æˆ·ç«¯ä¸Šï¼Œæ²¡æœ‰åŠæ³•å‘é€æ¶ˆæ¯ç»™æŒ‡å®šç”¨æˆ·ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœä½ çŸ¥é“ç”¨æˆ·æ˜¯è°çš„è¯ï¼Œé‚£ä¹ˆå°±èƒ½å¤„ç†ä¸æŸä¸ªç”¨æˆ·ç›¸å…³çš„æ¶ˆæ¯ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸æ‰€æœ‰å®¢æˆ·ç«¯ç›¸å…³è”ã€‚å¥½æ¶ˆæ¯æ˜¯æˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•è¯†åˆ«ç”¨æˆ·ã€‚é€šè¿‡ä½¿ç”¨ä¸ç¬¬9ç« ç›¸åŒçš„è®¤è¯æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Spring Securityæ¥è®¤è¯ç”¨æˆ·ï¼Œå¹¶ä¸ºç›®æ ‡ç”¨æˆ·å¤„ç†æ¶ˆæ¯ã€‚</p>
<p>åœ¨ä½¿ç”¨Springå’ŒSTOMPæ¶ˆæ¯åŠŸèƒ½çš„æ—¶å€™ï¼Œæˆ‘ä»¬æœ‰ä¸‰ç§æ–¹å¼åˆ©ç”¨è®¤è¯ç”¨æˆ·ï¼š</p>
<ul>
<li>@MessageMappingå’Œ@SubscribeMappingæ ‡æ³¨çš„æ–¹æ³•èƒ½å¤Ÿä½¿ç”¨Principalæ¥è·å–è®¤è¯ç”¨æˆ·ï¼›</li>
<li>@MessageMappingã€@SubscribeMappingå’Œ@MessageExceptionæ–¹æ³•è¿”å›çš„å€¼èƒ½å¤Ÿä»¥æ¶ˆæ¯çš„å½¢å¼å‘é€ç»™è®¤è¯ç”¨æˆ·ï¼›</li>
<li>SimpMessagingTemplateèƒ½å¤Ÿå‘é€æ¶ˆæ¯ç»™ç‰¹å®šç”¨æˆ·ã€‚</li>
</ul>
<p>æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹å‰ä¸¤ç§æ–¹å¼ï¼Œå®ƒä»¬éƒ½èƒ½è®©æ§åˆ¶å™¨çš„æ¶ˆæ¯å¤„ç†æ–¹æ³•ä½¿ç”¨é’ˆå¯¹ç‰¹å®šç”¨æˆ·çš„æ¶ˆæ¯ã€‚</p>
<h4 id="åœ¨æ§åˆ¶å™¨ä¸­å¤„ç†ç”¨æˆ·çš„æ¶ˆæ¯"><a href="#åœ¨æ§åˆ¶å™¨ä¸­å¤„ç†ç”¨æˆ·çš„æ¶ˆæ¯" class="headerlink" title="åœ¨æ§åˆ¶å™¨ä¸­å¤„ç†ç”¨æˆ·çš„æ¶ˆæ¯"></a>åœ¨æ§åˆ¶å™¨ä¸­å¤„ç†ç”¨æˆ·çš„æ¶ˆæ¯</h4><p>å¦‚å‰æ‰€è¿°ï¼Œåœ¨æ§åˆ¶å™¨çš„@MessageMappingæˆ–@SubscribeMappingæ–¹æ³•ä¸­ï¼Œå¤„ç†æ¶ˆæ¯æ—¶æœ‰ä¸¤ç§æ–¹å¼äº†è§£ç”¨æˆ·ä¿¡æ¯ã€‚åœ¨å¤„ç†å™¨æ–¹æ³•ä¸­ï¼Œé€šè¿‡ç®€å•åœ°æ·»åŠ ä¸€ä¸ªPrincipalå‚æ•°ï¼Œè¿™ä¸ªæ–¹æ³•å°±èƒ½çŸ¥é“ç”¨æˆ·æ˜¯è°å¹¶åˆ©ç”¨è¯¥ä¿¡æ¯å…³æ³¨æ­¤ç”¨æˆ·ç›¸å…³çš„æ•°æ®ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¤„ç†å™¨æ–¹æ³•è¿˜å¯ä»¥ä½¿ç”¨@SendToUseræ³¨è§£ï¼Œè¡¨æ˜å®ƒçš„è¿”å›å€¼<br>è¦ä»¥æ¶ˆæ¯çš„å½¢å¼å‘é€ç»™æŸä¸ªè®¤è¯ç”¨æˆ·çš„å®¢æˆ·ç«¯ï¼ˆåªå‘é€ç»™è¯¥å®¢æˆ·ç«¯ï¼‰ã€‚</p>
<p>ä¸ºäº†é˜è¿°è¯¥åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæ§åˆ¶å™¨æ–¹æ³•ï¼Œå®ƒä¼šæ ¹æ®ä¼ å…¥çš„æ¶ˆæ¯åˆ›å»ºæ–°çš„Spittleå¯¹è±¡ï¼Œå¹¶å‘é€ä¸€ä¸ªå›åº”ï¼Œè¡¨æ˜Spittleå·²ç»ä¿å­˜æˆåŠŸã€‚å¦‚æœä½ è§‰å¾—è¿™ä¸ªåœºæ™¯å¾ˆç†Ÿæ‚‰çš„è¯ï¼Œé‚£æ˜¯å› ä¸ºåœ¨ç¬¬16ç« æˆ‘ä»¬ä»¥RESTç«¯ç‚¹çš„å½¢å¼å®ç°äº†å®ƒã€‚ä½†æ˜¯RESTè¯·æ±‚æ˜¯åŒæ­¥çš„ï¼Œå½“æœåŠ¡å™¨å¤„ç†çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯å¿…é¡»è¦ç­‰å¾…ã€‚é€šè¿‡å°†Spittleå‘é€ä¸ºSTOMPæ¶ˆæ¯ï¼Œæˆ‘ä»¬å¯ä»¥å……åˆ†å‘æŒ¥STOMPæ¶ˆæ¯å¼‚æ­¥çš„ä¼˜åŠ¿ã€‚</p>
<p>è€ƒè™‘å¦‚ä¸‹çš„handleSpittle()æ–¹æ³•ï¼Œå®ƒä¼šå¤„ç†ä¼ å…¥çš„æ¶ˆæ¯å¹¶å°†å…¶å­˜å‚¨ä¸ºSpittleï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MessageMapping(&quot;/spittle&quot;)</span><span class="meta">@SendToUser(&quot;/queue/notifications&quot;)</span><span class="function"><span class="keyword">public</span> Notification <span class="title">handleSpittle</span><span class="params">(    Principal principal, SpittleForm form)</span> </span>&#123;  Spittle spittle = <span class="keyword">new</span> Spittle(principal.getName(), form.getText(), <span class="keyword">new</span> Date());  spittleRepo.save(spittle);    <span class="keyword">return</span> <span class="keyword">new</span> Notification(<span class="string">&quot;Saved Spittle&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒhandleSpittle()æ–¹æ³•æ¥å—Principalå¯¹è±¡å’ŒSpittleFormå¯¹è±¡ä½œä¸ºå‚æ•°ã€‚å®ƒä½¿ç”¨è¿™ä¸¤ä¸ªå¯¹è±¡åˆ›å»ºä¸€ä¸ªSpittleå®ä¾‹å¹¶å€ŸåŠ©SpittleRepositoryå°†å®ä¾‹ä¿å­˜èµ·æ¥ã€‚æœ€åï¼Œå®ƒè¿”å›ä¸€ä¸ªæ–°çš„Notificationï¼Œè¡¨æ˜Spittleå·²ç»ä¿å­˜æˆåŠŸã€‚</p>
<p>å½“ç„¶ï¼Œæ¯”èµ·æ–¹æ³•å†…éƒ¨çš„åŠŸèƒ½ï¼Œè¿™ä¸ªæ–¹æ³•ä½“å¤–éƒ¨æ‰€åšäº‹æƒ…ä¹Ÿè®¸æ›´è®©æˆ‘ä»¬æ„Ÿå…´è¶£ã€‚å› ä¸ºè¿™ä¸ªæ–¹æ³•ä½¿ç”¨äº†@MessageMappingæ³¨è§£ï¼Œå› æ­¤å½“æœ‰å‘å¾€â€œ/app/spittleâ€ç›®çš„åœ°çš„æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼Œè¯¥æ–¹æ³•å°±ä¼šè§¦å‘ï¼Œå¹¶ä¸”ä¼šæ ¹æ®æ¶ˆæ¯åˆ›å»ºSpittleFormå¯¹è±¡ï¼Œå¦‚æœç”¨æˆ·å·²ç»è®¤è¯è¿‡çš„è¯ï¼Œå°†ä¼šæ ¹æ®STOMPå¸§ä¸Šçš„å¤´ä¿¡æ¯å¾—åˆ°Principalå¯¹è±¡ã€‚</p>
<p>ä½†æ˜¯ï¼Œéœ€è¦ç‰¹åˆ«å…³æ³¨çš„æ˜¯ï¼Œè¿”å›çš„Notificationåˆ°å“ªé‡Œå»äº†ã€‚@SendToUseræ³¨è§£æŒ‡å®šè¿”å›çš„Notificationè¦ä»¥æ¶ˆæ¯çš„å½¢å¼å‘é€åˆ°â€œ/queue/notificationsâ€ç›®çš„åœ°ä¸Šã€‚åœ¨è¡¨é¢ä¸Šï¼Œâ€œ/queue/notificationsâ€å¹¶æ²¡æœ‰ä¸ç‰¹å®šç”¨æˆ·å…³è”ã€‚ä½†å› ä¸ºè¿™é‡Œä½¿ç”¨çš„æ˜¯@SendToUseræ³¨è§£è€Œä¸æ˜¯@SendToï¼Œæ‰€ä»¥å°±ä¼šå‘ç”Ÿæ›´å¤šçš„äº‹æƒ…äº†ã€‚</p>
<p>ä¸ºäº†ç†è§£Springå¦‚ä½•å‘å¸ƒæ¶ˆæ¯ï¼Œè®©æˆ‘ä»¬å…ˆé€€åä¸€æ­¥ï¼Œçœ‹ä¸€ä¸‹é’ˆå¯¹æ§åˆ¶å™¨æ–¹æ³•å‘å¸ƒNotificationå¯¹è±¡çš„ç›®çš„åœ°ï¼Œå®¢æˆ·ç«¯è¯¥å¦‚ä½•è¿›è¡Œè®¢é˜…ã€‚è€ƒè™‘å¦‚ä¸‹çš„è¿™è¡ŒJavaScriptä»£ç ï¼Œå®ƒè®¢é˜…äº†ä¸€ä¸ªç”¨æˆ·ç‰¹å®šçš„ç›®çš„åœ°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stomp.subscribe(<span class="string">&quot;/user/queue/notifications&quot;</span>, handleNotifications);</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œè¿™ä¸ªç›®çš„åœ°ä½¿ç”¨äº†â€œ/userâ€ä½œä¸ºå‰ç¼€ï¼Œåœ¨å†…éƒ¨ï¼Œä»¥â€œ/userâ€ä½œä¸ºå‰ç¼€çš„ç›®çš„åœ°å°†ä¼šä»¥ç‰¹æ®Šçš„æ–¹å¼è¿›è¡Œå¤„ç†ã€‚è¿™ç§æ¶ˆæ¯ä¸ä¼šé€šè¿‡AnnotationMethodMessageHandlerï¼ˆåƒåº”ç”¨æ¶ˆæ¯é‚£æ ·ï¼‰æ¥å¤„ç†ï¼Œä¹Ÿä¸ä¼šé€šè¿‡SimpleBrokerMessageHandleræˆ–StompBrokerRelayMessageHandlerï¼ˆåƒä»£ç†æ¶ˆæ¯é‚£æ ·ï¼‰æ¥å¤„ç†ï¼Œä»¥â€œ/userâ€ä¸ºå‰ç¼€çš„æ¶ˆæ¯å°†ä¼šé€šè¿‡UserDestinationMessageHandlerè¿›è¡Œå¤„ç†ï¼Œå¦‚å›¾18.4æ‰€ç¤ºã€‚</p>
<p><img src="spring-in-action-v4/image-20211114120726131.png" alt="image-20211114120726131"><br>å›¾18.4ã€€ç”¨æˆ·æ¶ˆæ¯æµä¼šé€šè¿‡UserDestinationMessageHandlerè¿›è¡Œå¤„ç†ï¼Œå®ƒä¼šå°†æ¶ˆæ¯é‡è·¯ç”±åˆ°æŸä¸ªç”¨æˆ·ç‹¬æœ‰çš„ç›®çš„åœ°ä¸Š</p>
<p>UserDestinationMessageHandlerçš„ä¸»è¦ä»»åŠ¡æ˜¯å°†ç”¨æˆ·æ¶ˆæ¯é‡æ–°è·¯ç”±åˆ°æŸä¸ªç”¨æˆ·ç‹¬æœ‰çš„ç›®çš„åœ°ä¸Šã€‚åœ¨å¤„ç†è®¢é˜…çš„æ—¶å€™ï¼Œå®ƒä¼šå°†ç›®æ ‡åœ°å€ä¸­çš„â€œ/userâ€å‰ç¼€å»æ‰ï¼Œå¹¶åŸºäºç”¨æˆ·çš„ä¼šè¯æ·»åŠ ä¸€ä¸ªåç¼€ã€‚ä¾‹å¦‚ï¼Œå¯¹â€œ/user/queue/notificationsâ€çš„è®¢é˜…æœ€åå¯èƒ½è·¯ç”±åˆ°åä¸ºâ€œ/queue/notifications-user6hr83v6tâ€çš„ç›®çš„åœ°ä¸Šã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„æ ·ä¾‹ä¸­ï¼ŒhandleSpittle()æ–¹æ³•ä½¿ç”¨äº†@SendToUser(â€œ/queue/notificationsâ€)æ³¨è§£ã€‚è¿™ä¸ªæ–°çš„ç›®çš„åœ°ä»¥â€œ/queueâ€ä½œä¸ºå‰ç¼€ï¼Œæ ¹æ®é…ç½®ï¼Œè¿™æ˜¯StompBrokerRelayMessageHandlerï¼ˆæˆ–SimpleBrokerMessageHandlerè¦å¤„ç†çš„å‰ç¼€ï¼Œæ‰€ä»¥æ¶ˆæ¯æ¥ä¸‹æ¥ä¼šåˆ°è¾¾è¿™é‡Œã€‚æœ€ç»ˆï¼Œå®¢æˆ·ç«¯ä¼šè®¢é˜…è¿™ä¸ªç›®çš„åœ°ï¼Œå› æ­¤å®¢æˆ·ç«¯ä¼šæ”¶åˆ°Notificationæ¶ˆæ¯ã€‚</p>
<p>åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸­ï¼Œ@SendToUseræ³¨è§£å’ŒPrincipalå‚æ•°æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ä½†æ˜¯åœ¨ç¨‹åºæ¸…å•18.8ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°å€ŸåŠ©æ¶ˆæ¯æ¨¡æ¿ï¼Œå¯ä»¥åœ¨åº”ç”¨çš„ä»»ä½•ä½ç½®å‘é€æ¶ˆæ¯ã€‚æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨SimpMessagingTemplateå°†æ¶ˆæ¯å‘é€ç»™ç‰¹å®šç”¨æˆ·ã€‚</p>
<h4 id="ä¸ºæŒ‡å®šç”¨æˆ·å‘é€æ¶ˆæ¯"><a href="#ä¸ºæŒ‡å®šç”¨æˆ·å‘é€æ¶ˆæ¯" class="headerlink" title="ä¸ºæŒ‡å®šç”¨æˆ·å‘é€æ¶ˆæ¯"></a>ä¸ºæŒ‡å®šç”¨æˆ·å‘é€æ¶ˆæ¯</h4><p>é™¤äº†convertAndSend()ä»¥å¤–ï¼ŒSimpMessagingTemplateè¿˜æä¾›äº†convertAndSendToUser()æ–¹æ³•ã€‚æŒ‰ç…§åå­—å°±å¯ä»¥åˆ¤æ–­å‡ºæ¥ï¼ŒconvertAndSendToUser()æ–¹æ³•èƒ½å¤Ÿè®©æˆ‘ä»¬ç»™ç‰¹å®šç”¨æˆ·å‘é€æ¶ˆæ¯ã€‚</p>
<p>ä¸ºäº†é˜è¿°è¯¥åŠŸèƒ½ï¼Œæˆ‘ä»¬è¦åœ¨Spittråº”ç”¨ä¸­æ·»åŠ ä¸€é¡¹ç‰¹æ€§ï¼Œå½“å…¶ä»–ç”¨æˆ·æäº¤çš„Spittleæåˆ°æŸä¸ªç”¨æˆ·æ—¶ï¼Œå°†ä¼šæé†’è¯¥ç”¨æˆ·ã€‚ä¾‹å¦‚ï¼Œå¦‚æœSpittleæ–‡æœ¬ä¸­åŒ…å«â€œ@jbauerâ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åº”è¯¥å‘é€ä¸€æ¡æ¶ˆæ¯ç»™ä½¿ç”¨â€œjbauerâ€ç”¨æˆ·åç™»å½•çš„å®¢æˆ·ç«¯ã€‚å¦‚ä¸‹ç¨‹åºæ¸…å•ä¸­çš„broadcastSpittle()æ–¹æ³•ä½¿ç”¨äº†convertAndSendToUser()ï¼Œä»è€Œèƒ½å¤Ÿæé†’æ‰€è°ˆè®ºåˆ°çš„ç”¨æˆ·ã€‚</p>
<p>ç¨‹åºæ¸…å•18.9ã€€convertAndSendToUser()èƒ½å¤Ÿå‘é€æ¶ˆæ¯ç»™ç‰¹å®šç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr;<span class="keyword">import</span> java.util.regex.Matcher;<span class="keyword">import</span> java.util.regex.Pattern;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.messaging.simp.SimpMessagingTemplate;<span class="keyword">import</span> org.springframework.stereotype.Service;<span class="meta">@Servicepublic</span> <span class="class"><span class="keyword">class</span> <span class="title">SpittleFeedServiceImpl</span> <span class="keyword">implements</span> <span class="title">SpittleFeedService</span> </span>&#123;  <span class="keyword">private</span> SimpMessagingTemplate messaging;  <span class="keyword">private</span> Pattern pattern = Pattern.compile(<span class="string">&quot;\\@(\\S+)&quot;</span>);	  <span class="meta">@Autowired</span>  <span class="function"><span class="keyword">public</span> <span class="title">SpittleFeedServiceImpl</span><span class="params">(SimpMessagingTemplate messaging)</span> </span>&#123;	<span class="keyword">this</span>.messaging = messaging;  &#125;	  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">broadcastSpittle</span><span class="params">(Spittle spittle)</span> </span>&#123;	messaging.convertAndSend(<span class="string">&quot;/topic/spittlefeed&quot;</span>, spittle);			Matcher matcher = pattern.matcher(spittle.getMessage());	<span class="keyword">if</span> (matcher.find()) &#123;      String username = matcher.group(<span class="number">1</span>);	  messaging.convertAndSendToUser(username, 	    <span class="string">&quot;/queue/notifications&quot;</span>,	    <span class="keyword">new</span> Notification(<span class="string">&quot;You just got mentioned!&quot;</span>));	&#125;  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨broadcastSpittle()ä¸­ï¼Œå¦‚æœç»™å®šSpittleå¯¹è±¡çš„æ¶ˆæ¯ä¸­åŒ…å«äº†ç±»ä¼¼äºç”¨æˆ·åçš„å†…å®¹ï¼ˆä¹Ÿå°±æ˜¯ä»¥â€œ@â€å¼€å¤´çš„æ–‡æœ¬)ï¼Œé‚£ä¹ˆä¸€ä¸ªæ–°çš„Notificationå°†ä¼šå‘é€åˆ°åä¸º â€œ/queue/notificationsâ€çš„ç›®çš„åœ°ä¸Šã€‚å› æ­¤ï¼Œå¦‚æœSpittleä¸­åŒ…å«â€œ@jbauerâ€çš„è¯ï¼ŒNotificationå°†ä¼šå‘é€åˆ°â€œ/user/jbauer/queue/notificationsâ€ç›®çš„åœ°ä¸Šã€‚</p>
<h3 id="å¤„ç†æ¶ˆæ¯å¼‚å¸¸"><a href="#å¤„ç†æ¶ˆæ¯å¼‚å¸¸" class="headerlink" title="å¤„ç†æ¶ˆæ¯å¼‚å¸¸"></a>å¤„ç†æ¶ˆæ¯å¼‚å¸¸</h3><p>æœ‰æ—¶å€™ï¼Œäº‹æƒ…å¹¶ä¸ä¼šæŒ‰ç…§æˆ‘ä»¬é¢„æœŸçš„é‚£æ ·å‘å±•ã€‚åœ¨å¤„ç†æ¶ˆæ¯çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šå‡ºé”™å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚å› ä¸ºSTOMPæ¶ˆæ¯å¼‚æ­¥çš„ç‰¹ç‚¹ï¼Œå‘é€è€…å¯èƒ½æ°¸è¿œä¹Ÿä¸ä¼šçŸ¥é“å‡ºç°äº†é”™è¯¯ã€‚é™¤äº†Springçš„æ—¥å¿—è®°å½•ä»¥å¤–ï¼Œå¼‚å¸¸æœ‰å¯èƒ½ä¼šä¸¢å¤±ï¼Œæ²¡æœ‰èµ„æºæˆ–æœºä¼šæ¢å¤ã€‚</p>
<p>åœ¨Spring MVCä¸­ï¼Œå¦‚æœåœ¨è¯·æ±‚å¤„ç†ä¸­ï¼Œå‡ºç°å¼‚å¸¸çš„è¯ï¼Œ@ExceptionHandleræ–¹æ³•å°†æœ‰æœºä¼šå¤„ç†å¼‚å¸¸ã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æŸä¸ªæ§åˆ¶å™¨æ–¹æ³•ä¸Šæ·»åŠ @MessageExceptionHandleræ³¨è§£ï¼Œè®©å®ƒæ¥å¤„ç†@MessageMappingæ–¹æ³•æ‰€æŠ›å‡ºçš„å¼‚å¸¸ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘å¦‚ä¸‹çš„æ–¹æ³•ï¼Œå®ƒä¼šå¤„ç†æ¶ˆæ¯æ–¹æ³•æ‰€æŠ›å‡ºçš„å¼‚å¸¸ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MessageExceptionHandlerpublic</span> <span class="function"><span class="keyword">void</span> <span class="title">handleExceptions</span><span class="params">(Throwable t)</span> </span>&#123;  logger.error(<span class="string">&quot;Error handling message: &quot;</span> + t.getMessage());&#125;</span><br></pre></td></tr></table></figure>

<p>æŒ‰ç…§æœ€ç®€å•çš„å½¢å¼ï¼Œ@MessageExceptionHandleræ ‡æ³¨çš„æ–¹æ³•èƒ½å¤Ÿå¤„ç†æ¶ˆæ¯æ–¹æ³•ä¸­æ‰€æŠ›å‡ºçš„å¼‚å¸¸ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä»¥å‚æ•°çš„å½¢å¼å£°æ˜å®ƒæ‰€èƒ½å¤„ç†çš„å¼‚å¸¸ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MessageExceptionHandler(SpittleException.class)</span><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleExceptions</span><span class="params">(Throwable t)</span> </span>&#123;  logger.error(<span class="string">&quot;Error handling message: &quot;</span> + t.getMessage());&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼Œä»¥æ•°ç»„å‚æ•°çš„å½¢å¼æŒ‡å®šå¤šä¸ªå¼‚å¸¸ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MessageExceptionHandler(&#123;SpittleException.class, DatabaseException.class&#125;)</span><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleExceptions</span><span class="params">(Throwable t)</span> </span>&#123;  logger.error(<span class="string">&quot;Error handling message: &quot;</span> + t.getMessage());&#125;</span><br></pre></td></tr></table></figure>

<p>å°½ç®¡å®ƒåªæ˜¯ä»¥æ—¥å¿—çš„æ–¹å¼è®°å½•äº†æ‰€å‘ç”Ÿçš„é”™è¯¯ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥å›åº”ä¸€ä¸ªé”™è¯¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MessageExceptionHandler(SpittleException.class)</span><span class="meta">@SendToUser(&quot;/queue/errors&quot;)</span><span class="function"><span class="keyword">public</span> SpittleException <span class="title">handleExceptions</span><span class="params">(SpittleException e)</span> </span>&#123;  logger.error(<span class="string">&quot;Error handling message: &quot;</span> + e.getMessage());  <span class="keyword">return</span> e&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œå¦‚æœæŠ›å‡ºSpittleExceptionçš„è¯ï¼Œå°†ä¼šè®°å½•è¿™ä¸ªå¼‚å¸¸ï¼Œç„¶åå°†å…¶è¿”å›ã€‚åœ¨18.4.1å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»å­¦è¿‡ï¼ŒUserDestinationMessageHandlerä¼šé‡æ–°è·¯ç”±è¿™ä¸ªæ¶ˆæ¯åˆ°ç‰¹å®šç”¨æˆ·æ‰€å¯¹åº”çš„å”¯ä¸€è·¯å¾„ã€‚</p>
<h3 id="å°ç»“-17"><a href="#å°ç»“-17" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å¦‚æœåœ¨åº”ç”¨é—´å‘é€æ¶ˆæ¯çš„è¯ï¼Œé‚£WebSocketæ˜¯ä¸€ç§ä»¤äººå…´å¥‹çš„é€šä¿¡æ–¹å¼ï¼Œå°¤å…¶æ˜¯å¦‚æœå…¶ä¸­æŸä¸ªåº”ç”¨è¿è¡Œåœ¨Webæµè§ˆå™¨ä¸­æ›´æ˜¯å¦‚æ­¤ã€‚å½“ç¼–å†™å­˜åœ¨å¤§é‡äº¤äº’çš„Webåº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒæ˜¯å¾ˆé‡è¦çš„ï¼Œèƒ½å¤Ÿå®ç°ä»æœåŠ¡å™¨æ— ç¼çš„å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚</p>
<p>Springå¯¹WebSocketçš„æ”¯æŒåŒ…æ‹¬ä½å±‚çº§çš„APIï¼Œå®ƒèƒ½å¤Ÿè®©æˆ‘ä»¬ä½¿ç”¨åŸå§‹çš„WebSocketè¿æ¥ã€‚ä½†æ˜¯ï¼ŒWebSocketå¹¶æ²¡æœ‰åœ¨Webæµè§ˆå™¨ã€æœåŠ¡å™¨ä»¥åŠç½‘ç»œä»£ç†ä¸Šå¾—åˆ°å¹¿æ³›æ”¯æŒã€‚å› æ­¤ï¼ŒSpringåŒæ—¶è¿˜æ”¯æŒSockJSï¼Œè¿™ä¸ªåè®®èƒ½å¤Ÿåœ¨WebSocketä¸å¯ç”¨çš„æ—¶å€™æä¾›å¤‡ç”¨çš„é€šä¿¡æ¨¡å¼ã€‚</p>
<p>Springè¿˜æä¾›äº†é«˜çº§çš„ç¼–ç¨‹æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨STOMPçº¿è·¯çº§åè®®æ¥å¤„ç†WebSocketæ¶ˆæ¯ã€‚åœ¨è¿™ä¸ªæ›´é«˜çº§çš„æ¨¡å‹ä¸­ï¼Œèƒ½å¤Ÿåœ¨Spring MVCæ§åˆ¶å™¨ä¸­å¤„ç†STOMPæ¶ˆæ¯ï¼Œç±»ä¼¼äºå¤„ç†HTTPæ¶ˆæ¯çš„æ–¹å¼ã€‚</p>
<p>åœ¨è¿‡å»çš„ä¸¤ç« ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¤šç§åœ¨åº”ç”¨é—´å¼‚æ­¥å‘é€æ¶ˆæ¯çš„æ–¹å¼ã€‚Springè¿˜æœ‰å¦å¤–ä¸€ç§å¤„ç†å¼‚æ­¥æ¶ˆæ¯çš„æ–¹å¼ã€‚åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨Springå‘é€Emailã€‚</p>
<h2 id="ä½¿ç”¨Springå‘é€Email"><a href="#ä½¿ç”¨Springå‘é€Email" class="headerlink" title="ä½¿ç”¨Springå‘é€Email"></a>ä½¿ç”¨Springå‘é€Email</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>é…ç½®Springçš„EmailæŠ½è±¡åŠŸèƒ½</li>
<li>å‘é€ä¸°å¯Œå†…å®¹çš„Emailæ¶ˆæ¯</li>
<li>ä½¿ç”¨æ¨¡æ¿æ„å»ºEmailæ¶ˆæ¯</li>
</ul>
<p>æ¯«æ— ç–‘é—®ï¼ŒEmailå·²ç»æˆä¸ºå¸¸è§çš„é€šä¿¡å½¢å¼ï¼Œå–ä»£äº†å¾ˆå¤šä¼ ç»Ÿçš„é€šä¿¡æ–¹å¼ï¼Œå¦‚é‚®æ”¿é‚®ä»¶ã€ç”µè¯ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿæ›¿ä»£äº†é¢å¯¹é¢çš„äº¤æµã€‚Emailèƒ½å¤Ÿæä¾›äº†ä¸ç¬¬17ç« ä¸­æ‰€è®¨è®ºçš„å¼‚æ­¥æ¶ˆæ¯ç›¸åŒçš„æ”¶ç›Šï¼Œåªä¸è¿‡å‘é€è€…å’Œæ¥æ”¶è€…éƒ½æ˜¯å®é™…çš„äººè€Œå·²ã€‚åªè¦ä½ åœ¨é‚®ä»¶å®¢æˆ·ç«¯ä¸Šç‚¹å‡»â€œå‘é€â€æŒ‰é’®ï¼Œå°±å¯ä»¥è½¬ç§»åˆ°å…¶ä»–çš„ä»»åŠ¡ä¸­äº†ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“æ¥æ”¶è€…æœ€ç»ˆå°†ä¼šæ”¶åˆ°å¹¶é˜…è¯»ï¼ˆå¸Œæœ›å¦‚æ­¤ï¼‰ä½ çš„Emailã€‚</p>
<p>ä½†æ˜¯ï¼ŒEmailçš„å‘é€è€…ä¸ä¸€å®šæ˜¯å®é™…çš„äººã€‚æœ‰æ—¶å€™ï¼ŒEmailæ¶ˆæ¯æ˜¯ç”±åº”ç”¨ç¨‹åºå‘é€ç»™ç”¨æˆ·çš„ã€‚æœ‰å¯èƒ½æ˜¯ç”µå­å•†åŠ¡ç½‘ç«™ä¸Šçš„è®¢å•ç¡®è®¤é‚®ä»¶ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯é“¶è¡Œè´¦æˆ·æŸé¡¹äº¤æ˜“çš„è‡ªåŠ¨æé†’ã€‚ä¸ç®¡é‚®ä»¶çš„ä¸»é¢˜æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬éƒ½å¯èƒ½éœ€è¦å¼€å‘å‘é€Emailæ¶ˆæ¯çš„åº”ç”¨ç¨‹åºã€‚å¹¸å¥½ï¼Œåœ¨è¿™ä¸ªæ–¹é¢ï¼ŒSpringä¼šä¸ºæˆ‘ä»¬æä¾›å¸®åŠ©ã€‚</p>
<p>åœ¨ç¬¬17ç« ä¸­ï¼Œæˆ‘ä»¬å€ŸåŠ©Springå¯¹æ¶ˆæ¯åŠŸèƒ½çš„æ”¯æŒï¼Œä»¥æ’é˜Ÿä»»åŠ¡çš„å½¢å¼å¼‚æ­¥å‘é€Spittleæé†’ç»™Spittrçš„å…¶ä»–ç”¨æˆ·ã€‚ä½†æ˜¯ï¼Œè¿™é¡¹ä»»åŠ¡å¹¶æœªå®Œæˆï¼Œå› ä¸ºæ²¡æœ‰å‘é€Emailæ¶ˆæ¯ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä¼šå®Œæˆè¿™é¡¹ä»»åŠ¡ï¼Œåœ¨æœ¬ç« é¦–å…ˆä¼šçœ‹ä¸€ä¸‹Springæ˜¯å¦‚ä½•æŠ½è±¡é‚®ä»¶å‘é€è¿™ä¸€é—®é¢˜çš„ï¼Œç„¶ååˆ©ç”¨è¿™ä¸€æŠ½è±¡å‘é€åŒ…å«Spittleæé†’çš„Emailæ¶ˆæ¯ã€‚</p>
<h3 id="é…ç½®Springå‘é€é‚®ä»¶"><a href="#é…ç½®Springå‘é€é‚®ä»¶" class="headerlink" title="é…ç½®Springå‘é€é‚®ä»¶"></a>é…ç½®Springå‘é€é‚®ä»¶</h3><p>Spring EmailæŠ½è±¡çš„æ ¸å¿ƒæ˜¯MailSenderæ¥å£ã€‚é¡¾åæ€ä¹‰ï¼ŒMailSenderçš„å®ç°èƒ½å¤Ÿé€šè¿‡è¿æ¥EmailæœåŠ¡å™¨å®ç°é‚®ä»¶å‘é€çš„åŠŸèƒ½ï¼Œå¦‚å›¾19.1æ‰€ç¤ºã€‚</p>
<p><img src="spring-in-action-v4/image-20211114130851853.png" alt="image-20211114130851853"></p>
<p>å›¾19.1ã€€Springçš„MailSenderæ¥å£æ˜¯Spring EmailæŠ½è±¡APIçš„æ ¸å¿ƒç»„ä»¶ã€‚</p>
<p>å®ƒæŠŠEmailå‘é€ç»™é‚®ä»¶æœåŠ¡å™¨ï¼Œç”±æœåŠ¡å™¨è¿›è¡Œé‚®ä»¶æŠ•é€’Springè‡ªå¸¦äº†ä¸€ä¸ªMailSenderçš„å®ç°ä¹Ÿå°±æ˜¯JavaMailSenderImplï¼Œå®ƒä¼šä½¿ç”¨JavaMail APIæ¥å‘é€Emailã€‚Springåº”ç”¨åœ¨å‘é€Emailä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»è¦å°†JavaMailSenderImplè£…é…ä¸ºSpringåº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ä¸€ä¸ªbeanã€‚</p>
<h4 id="é…ç½®é‚®ä»¶å‘é€å™¨"><a href="#é…ç½®é‚®ä»¶å‘é€å™¨" class="headerlink" title="é…ç½®é‚®ä»¶å‘é€å™¨"></a>é…ç½®é‚®ä»¶å‘é€å™¨</h4><p>æŒ‰ç…§æœ€ç®€å•çš„å½¢å¼ï¼Œæˆ‘ä»¬åªéœ€åœ¨@Beanæ–¹æ³•ä¸­ä½¿ç”¨å‡ è¡Œä»£ç å°±èƒ½å°†JavaMailSenderImplé…ç½®ä¸ºä¸€ä¸ªbeanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MailSender <span class="title">mailSender</span><span class="params">(Environment env)</span> </span>&#123;  JavaMailSenderImpl mailSender = <span class="keyword">new</span> JavaMailSenderImpl();  mailSender.setHost(env.getProperty(<span class="string">&quot;mailserver.host&quot;</span>));  <span class="keyword">return</span> mailSender;&#125;</span><br></pre></td></tr></table></figure>

<p>å±æ€§hostæ˜¯å¯é€‰çš„ï¼ˆå®ƒé»˜è®¤æ˜¯åº•å±‚JavaMailä¼šè¯çš„ä¸»æœºï¼‰ï¼Œä½†ä½ å¯èƒ½å¸Œæœ›è®¾ç½®è¯¥å±æ€§ã€‚å®ƒæŒ‡å®šäº†è¦ç”¨æ¥å‘é€Emailçš„é‚®ä»¶æœåŠ¡å™¨ä¸»æœºåã€‚æŒ‰ç…§è¿™é‡Œçš„é…ç½®ï¼Œä¼šä»æ³¨å…¥çš„Environmentä¸­è·å–å€¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½åœ¨Springä¹‹å¤–ç®¡ç†é‚®ä»¶æœåŠ¡å™¨çš„é…ç½®ï¼ˆæ¯”å¦‚åœ¨å±æ€§æ–‡ä»¶ä¸­ï¼‰ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒJavaMailSenderImplå‡è®¾é‚®ä»¶æœåŠ¡å™¨ç›‘å¬25ç«¯å£ï¼ˆæ ‡å‡†çš„SMTPç«¯å£ï¼‰ã€‚å¦‚æœä½ çš„é‚®ä»¶æœåŠ¡å™¨ç›‘å¬ä¸åŒçš„ç«¯å£ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨portå±æ€§æŒ‡å®šæ­£ç¡®çš„ç«¯å£å·ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MailSender <span class="title">mailSender</span><span class="params">(Environment env)</span> </span>&#123;  JavaMailSenderImpl mailSender = <span class="keyword">new</span> JavaMailSenderImpl();  mailSender.setHost(env.getProperty(<span class="string">&quot;mailserver.host&quot;</span>));  mailSender.setPort(env.getProperty(<span class="string">&quot;mailserver.port&quot;</span>));  <span class="keyword">return</span> mailSender;&#125;</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼åœ°ï¼Œå¦‚æœé‚®ä»¶æœåŠ¡å™¨éœ€è¦è®¤è¯çš„è¯ï¼Œä½ è¿˜éœ€è¦è®¾ç½®usernameå’Œpasswordå±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MailSender <span class="title">mailSender</span><span class="params">(Environment env)</span> </span>&#123;  JavaMailSenderImpl mailSender = <span class="keyword">new</span> JavaMailSenderImpl();  mailSender.setHost(env.getProperty(<span class="string">&quot;mailserver.host&quot;</span>));  mailSender.setPort(env.getProperty(<span class="string">&quot;mailserver.port&quot;</span>));  mailSender.setUsername(env.getProperty(<span class="string">&quot;mailserver.username&quot;</span>));  mailSender.setPassword(env.getProperty(<span class="string">&quot;mailserver.password&quot;</span>));  <span class="keyword">return</span> mailSender;&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒJavaMailSenderImplå·²ç»é…ç½®å®Œæˆï¼Œå®ƒå¯ä»¥åˆ›å»ºè‡ªå·±çš„é‚®ä»¶ä¼šè¯ï¼Œä½†æ˜¯ä½ å¯èƒ½å·²ç»åœ¨JNDIä¸­é…ç½®äº†javax.mail.MailSessionï¼ˆä¹Ÿå¯èƒ½æ˜¯ä½ çš„åº”ç”¨æœåŠ¡å™¨æ”¾åœ¨é‚£é‡Œçš„ï¼‰ã€‚å¦‚æœè¿™æ ·çš„è¯ï¼Œé‚£å°±æ²¡æœ‰å¿…è¦ä¸ºJavaMailSenderImplé…ç½®è¯¦ç»†çš„æœåŠ¡å™¨ç»†èŠ‚äº†ã€‚æˆ‘ä»¬å¯ä»¥é…ç½®å®ƒä½¿ç”¨JNDIä¸­å·²å°±ç»ªçš„MailSessionã€‚</p>
<p>å€ŸåŠ©JndiObjectFactoryBeanï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¦‚ä¸‹çš„@Beanæ–¹æ³•ä¸­é…ç½®ä¸€ä¸ªbeanï¼Œå®ƒä¼šä»JNDIä¸­æŸ¥æ‰¾MailSessionï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">JndiObjectFactoryBean <span class="title">mailSession</span><span class="params">()</span> </span>&#123;  JndiObjectFactoryBean jndi = <span class="keyword">new</span> JndiObjectFactoryBean();  jndi.setJndiName(<span class="string">&quot;mail/Session&quot;</span>);  jndi.setProxyInterface(MailSession.class);  jndi.setResourceRef(<span class="keyword">true</span>);  <span class="keyword">return</span> jndi;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å·²ç»çœ‹åˆ°è¿‡å¦‚ä½•ä½¿ç”¨Springçš„<code>&lt;jee:jndi-lookup&gt;</code>å…ƒç´ ä»JNDIä¸­è·å–å¯¹è±¡ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨<code>&lt;jee:jndi-lookup&gt;</code>æ¥åˆ›å»ºä¸€ä¸ªbeanï¼Œå®ƒå¼•ç”¨äº†JNDIä¸­çš„é‚®ä»¶ä¼šè¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;jee:jndi-lookup id=<span class="string">&quot;mailSession&quot;</span>  jndi-name=<span class="string">&quot;mail/Session&quot;</span> resource-ref=<span class="string">&quot;true&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<p>é‚®ä»¶ä¼šè¯å‡†å¤‡å°±ç»ªä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å°†å…¶è£…é…åˆ°mailSender beanä¸­äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MailSender <span class="title">mailSender</span><span class="params">(MailSession mailSession)</span> </span>&#123;  JavaMailSenderImpl mailSender = <span class="keyword">new</span> JavaMailSenderImp();  mailSender.setSession(mailSession);  <span class="keyword">return</span> mailSender;&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡å°†é‚®ä»¶ä¼šè¯è£…é…åˆ°JavaMailSenderImplçš„sessionå±æ€§ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®Œå…¨æ›¿æ¢äº†åŸæ¥çš„æœåŠ¡å™¨ï¼ˆä»¥åŠç”¨æˆ·å/å¯†ç ï¼‰é…ç½®ã€‚ç°åœ¨é‚®ä»¶ä¼šè¯å®Œå…¨é€šè¿‡JNDIè¿›è¡Œé…ç½®å’Œç®¡ç†ã€‚JavaMailSenderImplèƒ½å¤Ÿä¸“æ³¨äºå‘é€é‚®ä»¶è€Œä¸å¿…è‡ªå·±å¤„ç†é‚®ä»¶æœåŠ¡å™¨äº†ã€‚</p>
<h4 id="è£…é…å’Œä½¿ç”¨é‚®ä»¶å‘é€å™¨"><a href="#è£…é…å’Œä½¿ç”¨é‚®ä»¶å‘é€å™¨" class="headerlink" title="è£…é…å’Œä½¿ç”¨é‚®ä»¶å‘é€å™¨"></a>è£…é…å’Œä½¿ç”¨é‚®ä»¶å‘é€å™¨</h4><p>é‚®ä»¶å‘é€å™¨å·²ç»é…ç½®å®Œæˆï¼Œç°åœ¨éœ€è¦å°†å…¶è£…é…åˆ°ä½¿ç”¨å®ƒçš„beanä¸­äº†ã€‚åœ¨Spittråº”ç”¨ç¨‹åºä¸­ï¼Œæœ€é€‚åˆå‘é€Emailçš„æ˜¯SpitterEmailServiceImplç±»ã€‚è¿™ä¸ªç±»æœ‰ä¸€ä¸ªmailSenderå±æ€§ï¼Œå®ƒä½¿ç”¨äº†@Autowiredæ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutowiredJavaMailSender</span> mailSender;</span><br></pre></td></tr></table></figure>

<p>å½“Springå°†SpitterEmailServiceImplåˆ›å»ºä¸ºä¸€ä¸ªbeançš„æ—¶å€™ï¼Œå®ƒå°†æŸ¥æ‰¾å®ç°äº†MailSenderçš„beanï¼Œè¿™æ ·çš„beanå¯ä»¥è£…é…åˆ°mailSenderå±æ€§ä¸­ã€‚å®ƒå°†ä¼šæ‰¾åˆ°æˆ‘ä»¬åœ¨å‰è¾¹é…ç½®çš„mailSenderbeanå¹¶ä½¿ç”¨å®ƒã€‚mailSenderbeanè£…é…å®Œæˆåï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„å»ºå’Œå‘é€Emailäº†ã€‚</p>
<p>æˆ‘ä»¬æƒ³è¦ç»™Spitterç”¨æˆ·å‘é€Emailæç¤ºä»–çš„æœ‹å‹å†™äº†æ–°çš„Spittleï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–¹æ³•æ¥å‘é€Emailï¼Œè¿™ä¸ªæ–¹æ³•è¦æ¥å—Emailåœ°å€å’ŒSpittleå¯¹è±¡ä¿¡æ¯ã€‚å¦‚ä¸‹çš„sendSimpleSpittleEmail()æ–¹æ³•ä½¿ç”¨é‚®ä»¶å‘é€å™¨å®Œæˆäº†è¯¥åŠŸèƒ½ï¼š</p>
<p>ç¨‹åºæ¸…å•19.1ã€€ä½¿ç”¨Springçš„MailSenderå‘é€Email</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSimpleSpittleEmail</span><span class="params">(String to, Spittle spittle)</span> </span>&#123;  SimpleMailMessage message = <span class="keyword">new</span> SimpleMailMessage();  String spitterName = spittle.getSpitter().getFullName();  message.setFrom(<span class="string">&quot;noreply@spitter.com&quot;</span>);  message.setTo(to);  message.setSubject(<span class="string">&quot;New spittle from &quot;</span> + spitterName);  message.setText(spitterName + <span class="string">&quot; says: &quot;</span> + spittle.getText());  mailSender.send(message);&#125;</span><br></pre></td></tr></table></figure>

<p>sendSimpleSpittleEmail()æ–¹æ³•æ‰€åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯æ„é€ SimpleMailMessageå®ä¾‹ã€‚æ­£å¦‚å…¶åç§°æ‰€ç¤ºï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥å¾ˆä¾¿æ·åœ°å‘é€Emailæ¶ˆæ¯ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå°†è®¾ç½®æ¶ˆæ¯çš„ç»†èŠ‚ã€‚é€šè¿‡é‚®ä»¶æ¶ˆæ¯çš„setFrom()å’ŒsetTo()æ–¹æ³•æŒ‡å®šäº†Emailçš„å‘é€è€…å’Œæ¥æ”¶è€…ã€‚åœ¨é€šè¿‡setSubject()æ–¹æ³•è®¾ç½®å®Œä¸»é¢˜åï¼Œè™šæ‹Ÿçš„â€œä¿¡å°â€å·²ç»å®Œæˆäº†ã€‚å‰©ä¸‹çš„å°±æ˜¯è°ƒç”¨setText()æ–¹æ³•æ¥è®¾ç½®æ¶ˆæ¯çš„å†…å®¹ã€‚</p>
<p>æœ€åä¸€æ­¥æ˜¯å°†æ¶ˆæ¯ä¼ é€’ç»™é‚®ä»¶å‘é€å™¨çš„send()æ–¹æ³•ï¼Œè¿™æ ·é‚®ä»¶å°±å‘é€å‡ºå»äº†ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»é…ç½®å¥½äº†é‚®ä»¶å‘é€å™¨å¹¶ä½¿ç”¨å®ƒæ¥å‘é€ç®€å•çš„Emailæ¶ˆæ¯ã€‚å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨Springçš„EmailæŠ½è±¡éå¸¸ç®€å•ã€‚æˆ‘ä»¬å¯ä»¥åˆ°æ­¤ä¸ºæ­¢å¹¶è½¬åˆ°ä¸‹ä¸€ç« ï¼Œä½†æ˜¯å¦‚æœè¿™æ ·çš„è¯å°†ä¼šé”™è¿‡Spring EmailæŠ½è±¡ä¸­å¾ˆæœ‰æ„æ€çš„å†…å®¹ã€‚è®©æˆ‘ä»¬æ›´è¿›ä¸€æ­¥ï¼Œçœ‹ä¸€ä¸‹å¦‚ä½•æ·»åŠ é™„ä»¶å¹¶åˆ›å»ºä¸°å¯Œå†…å®¹çš„Emailæ¶ˆæ¯ã€‚</p>
<h3 id="æ„å»ºä¸°å¯Œå†…å®¹çš„Emailæ¶ˆæ¯"><a href="#æ„å»ºä¸°å¯Œå†…å®¹çš„Emailæ¶ˆæ¯" class="headerlink" title="æ„å»ºä¸°å¯Œå†…å®¹çš„Emailæ¶ˆæ¯"></a>æ„å»ºä¸°å¯Œå†…å®¹çš„Emailæ¶ˆæ¯</h3><p>å¯¹äºç®€å•çš„äº‹æƒ…æ¥è®²ï¼Œçº¯æ–‡æœ¬çš„Emailæ¶ˆæ¯æ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼Œæ¯”å¦‚é‚€è¯·æœ‹å‹å»è§‚çœ‹æ¯”èµ›ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ è¦å‘é€ç…§ç‰‡æˆ–æ–‡æ¡£çš„è¯ï¼Œè¿™ç§æ–¹å¼å°±ä¸é‚£ä¹ˆç†æƒ³äº†ã€‚å¦‚æœä½œä¸ºå¸‚åœºæ¨å¹¿Emailçš„è¯ï¼Œå®ƒä¹Ÿæ— æ³•å¸å¼•æ¥æ”¶è€…çš„æ³¨æ„ã€‚</p>
<p>å¹¸å¥½ï¼ŒSpringçš„EmailåŠŸèƒ½å¹¶ä¸å±€é™äºçº¯æ–‡æœ¬çš„Emailã€‚æˆ‘ä»¬å¯ä»¥æ·»åŠ é™„ä»¶ï¼Œç”šè‡³å¯ä»¥ä½¿ç”¨HTMLæ¥ç¾åŒ–æ¶ˆæ¯ä½“çš„å†…å®¹ã€‚è®©æˆ‘ä»¬é¦–å…ˆä»åŸºæœ¬çš„æ·»åŠ é™„ä»¶å¼€å§‹ï¼Œç„¶åæ›´è¿›ä¸€æ­¥ï¼Œå€ŸåŠ©HTMLä½¿æˆ‘ä»¬çš„Emailæ¶ˆæ¯æ›´åŠ ç¾è§‚ã€‚</p>
<h4 id="æ·»åŠ é™„ä»¶"><a href="#æ·»åŠ é™„ä»¶" class="headerlink" title="æ·»åŠ é™„ä»¶"></a>æ·»åŠ é™„ä»¶</h4><p>å¦‚æœå‘é€å¸¦æœ‰é™„ä»¶çš„Emailï¼Œå…³é”®æŠ€å·§æ˜¯åˆ›å»ºmultipartç±»å‹çš„æ¶ˆæ¯â€”â€”Emailç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†æ˜¯Emailä½“ï¼Œå…¶ä»–éƒ¨åˆ†æ˜¯é™„ä»¶ã€‚</p>
<p>å¯¹äºå‘é€é™„ä»¶è¿™æ ·çš„éœ€æ±‚æ¥è¯´ï¼ŒSimpleMailMessageè¿‡äºç®€å•äº†ã€‚ä¸ºäº†å‘é€multipartç±»å‹çš„Emailï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªMIMEï¼ˆMultipurpose Internet Mail Extensionsï¼‰çš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä»é‚®ä»¶å‘é€å™¨çš„createMimeMessage()æ–¹æ³•å¼€å§‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSimpleSpittleEmail</span><span class="params">(String to, Spittle spittle)</span> </span>&#123;  SimpleMailMessage message = <span class="keyword">new</span> SimpleMailMessage();  String spitterName = spittle.getSpitter().getFullName();  message.setFrom(<span class="string">&quot;noreply@spitter.com&quot;</span>);  message.setTo(to);  message.setSubject(<span class="string">&quot;New spittle from &quot;</span> + spitterName);  message.setText(spitterName + <span class="string">&quot; says: &quot;</span> + spittle.getText());  mailSender.send(message);&#125;</span><br></pre></td></tr></table></figure>

<p>å°±è¿™æ ·ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†è¦ä½¿ç”¨çš„MIMEæ¶ˆæ¯ã€‚çœ‹èµ·æ¥ï¼Œæˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯æŒ‡å®šæ”¶ä»¶äººå’Œå‘ä»¶äººåœ°å€ã€ä¸»é¢˜ã€ä¸€äº›å†…å®¹ä»¥åŠä¸€ä¸ªé™„ä»¶ã€‚å°½ç®¡ç¡®å®æ˜¯è¿™æ ·ï¼Œä½†å¹¶ä¸æ˜¯ä½ æƒ³çš„é‚£ä¹ˆç®€å•ã€‚javax.mail.internet.MimeMessageæœ¬èº«çš„APIæœ‰äº›ç¬¨é‡ã€‚å¥½æ¶ˆæ¯æ˜¯ï¼ŒSpringæä¾›çš„MimeMessageHelperå¯ä»¥å¸®åŠ©æˆ‘ä»¬ã€‚</p>
<p>ä¸ºäº†ä½¿ç”¨MimeMessageHelperï¼Œæˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–å®ƒå¹¶å°†MimeMessageä¼ ç»™å…¶æ„é€ å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(message, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<p>æ„é€ æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œåœ¨è¿™é‡Œæ˜¯ä¸ªå¸ƒå°”å€¼trueï¼Œè¡¨æ˜è¿™ä¸ªæ¶ˆæ¯æ˜¯multipartç±»å‹çš„ã€‚å¾—åˆ°äº†MimeMessageHelperå®ä¾‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»„è£…Emailæ¶ˆæ¯äº†ã€‚è¿™é‡Œæœ€ä¸»è¦åŒºåˆ«åœ¨äºä½¿ç”¨helperçš„æ–¹æ³•æ¥æŒ‡å®šEmailç»†èŠ‚ï¼Œè€Œä¸å†æ˜¯è®¾ç½®æ¶ˆæ¯å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String spitterName = spittle.getSpitter().getFullName();helper.setFrom(<span class="string">&quot;noreply@spitter.com&quot;</span>);helper.setTo(to);helper.setSubject(<span class="string">&quot;New spittle from &quot;</span> + spitterName);helper.setText(spitterName + <span class="string">&quot; says: &quot;</span> + spittle.getText());</span><br></pre></td></tr></table></figure>

<p>åœ¨å‘é€Emailä¹‹å‰ï¼Œä½ å”¯ä¸€è¿˜è¦åšçš„å°±æ˜¯æ·»åŠ é™„ä»¶ï¼šåœ¨æœ¬ä¾‹ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸€å¼ å›¾æ ‡å›¾ç‰‡ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ éœ€è¦åŠ è½½å›¾ç‰‡å¹¶å°†å…¶ä½œä¸ºèµ„æºï¼Œç„¶åå°†è¿™ä¸ªèµ„æºä¼ é€’ç»™helperçš„addAttachmentæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FileSystemResource couponImage = <span class="keyword">new</span> FileSystemResource(<span class="string">&quot;/collateral/coupon.png&quot;</span>);helper.addAttachmentt(<span class="string">&quot;Coupon.png&quot;</span>, couponImage);</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨Springçš„FileSystemResourceæ¥åŠ è½½ä½äºåº”ç”¨ç±»è·¯å¾„ä¸‹çš„coupon.pngã€‚ç„¶åï¼Œè°ƒç”¨addAttachment()ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦æ·»åŠ åˆ°Emailä¸­é™„ä»¶çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å›¾ç‰‡èµ„æºã€‚</p>
<p>multipartç±»å‹çš„Emailå·²ç»æ„å»ºå®Œæˆäº†ï¼Œç°åœ¨å¯ä»¥å‘é€å®ƒäº†ã€‚å®Œæ•´çš„sendSpittleEmailWithAttachment()æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p>ç¨‹åºæ¸…å•19.2ã€€ä½¿ç”¨MimeMessageHelperå‘é€å¸¦æœ‰é™„ä»¶çš„Email</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSpittleEmailWithAttachment</span><span class="params">(    String to, Spittle spittle)</span> <span class="keyword">throws</span> MessagingException </span>&#123;  MimeMessage message = mailSender.createMimeMessage();  MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(message, <span class="keyword">true</span>);  String spitterName = spittle.getSpitter().getFullName();  helper.setFrom(<span class="string">&quot;noreply@spitter.com&quot;</span>);  helper.setTo(to);  helper.setSubject(<span class="string">&quot;New spittle from &quot;</span> + spitterName);  helper.setText(spitterName + <span class="string">&quot; says: &quot;</span> + spittle.getText());  FileSystemResource couponImage = <span class="keyword">new</span> FileSystemResource(<span class="string">&quot;/collateral/coupon.png&quot;</span>);  helper.addAttachment(<span class="string">&quot;Coupon.png&quot;</span>, couponImage);  mailSender.send(message);&#125;</span><br></pre></td></tr></table></figure>

<p>multipartç±»å‹çš„Emailèƒ½å¤Ÿå®ç°å¾ˆå¤šçš„åŠŸèƒ½ï¼Œæ·»åŠ é™„ä»¶åªæ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œé€šè¿‡å°†Emailä½“æŒ‡æ˜ä¸ºHTMLï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆæ¯”ç®€å•æ–‡æœ¬æ›´æ¼‚äº®çš„Emailã€‚æ¥ä¸‹æ¥ï¼Œçœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨MimeMessageHelperæ¥å‘é€æ›´å¸å¼•äººçš„Emailã€‚</p>
<h4 id="å‘é€å¯Œæ–‡æœ¬å†…å®¹çš„Email"><a href="#å‘é€å¯Œæ–‡æœ¬å†…å®¹çš„Email" class="headerlink" title="å‘é€å¯Œæ–‡æœ¬å†…å®¹çš„Email"></a>å‘é€å¯Œæ–‡æœ¬å†…å®¹çš„Email</h4><p>å‘é€å¯Œæ–‡æœ¬çš„Emailä¸å‘é€ç®€å•æ–‡æœ¬çš„Emailå¹¶æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚å…³é”®æ˜¯å°†æ¶ˆæ¯çš„æ–‡æœ¬è®¾ç½®ä¸ºHTMLã€‚è¦åšåˆ°è¿™ä¸€ç‚¹åªéœ€å°†HTMLå­—ç¬¦ä¸²ä¼ é€’ç»™helperçš„setText()æ–¹æ³•ï¼Œå¹¶å°†ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸ºtrueï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSpittleEmailWithAttachment</span><span class="params">(    String to, Spittle spittle)</span> <span class="keyword">throws</span> MessagingException </span>&#123;  MimeMessage message = mailSender.createMimeMessage();  MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(message, <span class="keyword">true</span>);  String spitterName = spittle.getSpitter().getFullName();  helper.setFrom(<span class="string">&quot;noreply@spitter.com&quot;</span>);  helper.setTo(to);  helper.setSubject(<span class="string">&quot;New spittle from &quot;</span> + spitterName);  helper.setText(spitterName + <span class="string">&quot; says: &quot;</span> + spittle.getText());  FileSystemResource couponImage = <span class="keyword">new</span> FileSystemResource(<span class="string">&quot;/collateral/coupon.png&quot;</span>);  helper.addAttachment(<span class="string">&quot;Coupon.png&quot;</span>, couponImage);  mailSender.send(message);&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒä¸ªå‚æ•°è¡¨æ˜ä¼ é€’è¿›æ¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯HTMLï¼Œæ‰€ä»¥éœ€è¦å¯¹æ¶ˆæ¯çš„å†…å®¹ç±»å‹è¿›è¡Œç›¸åº”çš„è®¾ç½®ã€‚</p>
<p>è¦æ³¨æ„çš„æ˜¯ï¼Œä¼ é€’è¿›æ¥çš„HTMLåŒ…å«äº†ä¸€ä¸ª<img>æ ‡ç­¾ï¼Œç”¨æ¥åœ¨Emailä¸­å±•ç°Spittråº”ç”¨ç¨‹åºçš„logoã€‚srcå±æ€§å¯ä»¥è®¾ç½®ä¸ºæ ‡å‡†çš„â€œhttp:â€URLï¼Œä»¥ä¾¿äºä»Webä¸­è·å–Spittrçš„logoã€‚ä½†åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†logoå›¾ç‰‡åµŒå…¥åœ¨äº†Emailä¹‹ä¸­ã€‚å€¼â€œcid:spitterLogoâ€è¡¨æ˜åœ¨æ¶ˆæ¯ä¸­ä¼šæœ‰ä¸€éƒ¨åˆ†æ˜¯å›¾ç‰‡å¹¶ä»¥spitterLogoæ¥è¿›è¡Œæ ‡è¯†ã€‚</p>
<p>ä¸ºæ¶ˆæ¯æ·»åŠ åµŒå…¥å¼çš„å›¾ç‰‡ä¸æ·»åŠ é™„ä»¶å¾ˆç±»ä¼¼ã€‚ä¸è¿‡è¿™æ¬¡ä¸å†ä½¿ç”¨helperçš„addAttachment()æ–¹æ³•ï¼Œè€Œæ˜¯è¦è°ƒç”¨addInline()æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ClassPathResource image = <span class="keyword">new</span> ClassPathResource(<span class="string">&quot;spitter_logo_50.png&quot;</span>);helper.addInline(<span class="string">&quot;spitterLogo&quot;</span>, image);</span><br></pre></td></tr></table></figure>

<p>addInlineçš„ç¬¬ä¸€ä¸ªå‚æ•°è¡¨æ˜å†…è”å›¾ç‰‡çš„æ ‡è¯†ç¬¦â€”â€”ä¸<img>æ ‡ç­¾çš„srcå±æ€§æ‰€æŒ‡å®šçš„ç›¸åŒã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯å›¾ç‰‡çš„èµ„æºå¼•ç”¨ï¼Œè¿™é‡Œä½¿ç”¨ClassPathResourceä»åº”ç”¨ç¨‹åºçš„ç±»è·¯å¾„ä¸­è·å–å›¾ç‰‡ã€‚</p>
<p>é™¤äº†setText()æ–¹æ³•ç¨å¾®ä¸åŒä»¥åŠä½¿ç”¨äº†addInline()æ–¹æ³•ä»¥å¤–ï¼Œå‘é€å«æœ‰å¯Œæ–‡æœ¬å†…å®¹çš„Emailä¸å‘é€å¸¦æœ‰é™„ä»¶çš„æ™®é€šæ–‡æœ¬æ¶ˆæ¯å¾ˆç±»ä¼¼ã€‚ä¸ºäº†è¿›è¡Œå¯¹æ¯”ï¼Œä»¥ä¸‹æ˜¯æ–°çš„sendRichSpitterEmail()æ–¹æ³•ã€‚</p>
<p>ç°åœ¨ä½ å‘é€çš„Emailå¸¦æœ‰å¯Œæ–‡æœ¬å†…å®¹å’ŒåµŒå…¥å¼å›¾ç‰‡äº†ï¼ä½ å¯ä»¥åˆ°æ­¤ä¸ºæ­¢å¹¶å®Œå…¨ç»“æŸä½ çš„Emailä»£ç ã€‚ä½†åˆ›å»ºEmailä½“æ—¶ï¼Œä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥çš„åŠæ³•æ¥æ„å»ºHTMLæ¶ˆæ¯ä¾æ—§è®©æˆ‘è§‰å¾—ç¾ä¸­ä¸è¶³ã€‚åœ¨ç»“æŸEmailè¯é¢˜ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ç”¨æ¨¡æ¿æ¥ä»£æ›¿å­—ç¬¦ä¸²æ‹¼æ¥æ¶ˆæ¯ã€‚</p>
<h3 id="ä½¿ç”¨æ¨¡æ¿ç”ŸæˆEmail"><a href="#ä½¿ç”¨æ¨¡æ¿ç”ŸæˆEmail" class="headerlink" title="ä½¿ç”¨æ¨¡æ¿ç”ŸæˆEmail"></a>ä½¿ç”¨æ¨¡æ¿ç”ŸæˆEmail</h3><p>ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥æ¥æ„å»ºEmailæ¶ˆæ¯çš„é—®é¢˜åœ¨äºEmailæœ€ç»ˆä¼šæ˜¯ä»€ä¹ˆæ ·å­å¹¶ä¸æ¸…æ™°ã€‚åœ¨ä½ çš„å¤§è„‘ä¸­è§£æHTMLæ ‡ç­¾å¹¶æƒ³è±¡å®ƒåœ¨æ¸²æŸ“æ—¶ä¼šæ˜¯ä»€ä¹ˆæ ·å­æ˜¯æŒºå›°éš¾çš„ã€‚è€Œå°†HTMLæ··åˆåœ¨Javaä»£ç ä¸­åˆä¼šä½¿å¾—è¿™ä¸ªé—®é¢˜æ›´åŠ å¤æ‚ã€‚å¦‚æœèƒ½å¤Ÿå°†Emailçš„å¸ƒå±€æŠ½å–åˆ°ä¸€ä¸ªæ¨¡æ¿ä¸­ï¼Œè€Œè¿™ä¸ªæ¨¡æ¿å¯ä»¥ç”±ç¾æœ¯è®¾è®¡å¸ˆï¼ˆå¯èƒ½æ˜¯å¾ˆè®¨åŒJavaä»£ç çš„äººï¼‰æ¥å®Œæˆå°†ä¼šæ˜¯å¾ˆæ£’çš„ä¸€ä»¶äº‹ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦ä¸æœ€ç»ˆHTMLæ¥è¿‘çš„æ–¹å¼æ¥è¡¨è¾¾Emailå¸ƒå±€ï¼Œç„¶åå°†æ¨¡æ¿è½¬æ¢æˆStringå¹¶ä¼ é€’ç»™helperçš„setText()æ–¹æ³•ã€‚åœ¨å°†æ¨¡æ¿è½¬æ¢ä¸ºStringæ—¶ï¼Œæˆ‘ä»¬æœ‰å¤šç§æ¨¡æ¿æ–¹æ¡ˆå¯ä¾›é€‰æ‹©ï¼ŒåŒ…æ‹¬Apache Velocityå’ŒThymeleafã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨è¿™ä¸¤ç§æ–¹æ¡ˆåˆ›å»ºå¯Œæ–‡æœ¬çš„Emailæ¶ˆæ¯ï¼Œå…ˆä»Velocityå¼€å§‹å§ã€‚</p>
<h4 id="ä½¿ç”¨Velocityæ„å»ºEmailæ¶ˆæ¯"><a href="#ä½¿ç”¨Velocityæ„å»ºEmailæ¶ˆæ¯" class="headerlink" title="ä½¿ç”¨Velocityæ„å»ºEmailæ¶ˆæ¯"></a>ä½¿ç”¨Velocityæ„å»ºEmailæ¶ˆæ¯</h4><p>Apache Velocityæ˜¯ç”±Apacheæä¾›çš„é€šç”¨æ¨¡æ¿å¼•æ“ã€‚Velocityæœ‰æŒºé•¿çš„å†å²äº†ï¼Œå¹¶ä¸”å·²ç»åº”ç”¨äºå„ç§ä»»åŠ¡ä¸­ï¼ŒåŒ…æ‹¬ä»£ç ç”Ÿæˆä»¥åŠä»£æ›¿JSPã€‚å®ƒè¿˜èƒ½ç”¨äºæ ¼å¼åŒ–å¯Œæ–‡æœ¬Emailæ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œçš„ç”¨æ³•ã€‚</p>
<p>ä¸ºäº†ä½¿ç”¨Velocityå¯¹Emailè¿›è¡Œå¸ƒå±€ï¼Œæˆ‘ä»¬éœ€è¦å°†VelocityEngineè£…é…åˆ°SpitterEmailServiceImplä¸­ã€‚Springæä¾›äº†ä¸€ä¸ªåä¸ºVelocityEngineFactoryBeançš„å·¥å‚beanï¼Œå®ƒèƒ½å¤Ÿåœ¨Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­å¾ˆä¾¿åˆ©åœ°ç”ŸæˆVelocityEngineã€‚VelocityEngineFactoryBeançš„å£°æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendRichSpitterEmail</span><span class="params">(String to, Spittle spittle)</span> <span class="keyword">throws</span> MessagingException </span>&#123;  MimeMessage message = mailSender.createMimeMessage();  MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(message, <span class="keyword">true</span>);  helper.setFrom(<span class="string">&quot;noreply@spitter.com&quot;</span>);  helper.setTo(<span class="string">&quot;craig@habuma.com&quot;</span>);  helper.setSubject(<span class="string">&quot;New spittle from &quot;</span> + spittle.getSpitter().getFullName());  helper.setText (<span class="string">&quot;&lt;html&gt;&lt;body&gt;&lt;img src=&#x27;cid: spitterLogo&#x27;&gt;&quot;</span> +    <span class="string">&quot;&lt;h4&gt;&quot;</span> + spittle.getSpitter().getFullName() + <span class="string">&quot; says...&lt;/h4&gt;&quot;</span> +    <span class="string">&quot;&lt;i&gt;&quot;</span> + spittle.getText() + <span class="string">&quot;&lt;/i&gt;&quot;</span> +    <span class="string">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>, <span class="keyword">true</span>);  ClassPathResource image = <span class="keyword">new</span> ClassPathResource(<span class="string">&quot;spitter_logo_50.png&quot;</span>);  helper.addlnline(<span class="string">&quot;spitterLogo&quot;</span>, image);  mailSender.send(message);&#125;</span><br></pre></td></tr></table></figure>

<p>VelocityEngineFactoryBeanå”¯ä¸€è¦è®¾ç½®çš„å±æ€§æ˜¯velocityPropertiesã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†å…¶é…ç½®ä¸ºä»ç±»è·¯å¾„ä¸‹åŠ è½½Velocityæ¨¡æ¿ï¼ˆå…³äºé…ç½®Velocityçš„æ›´å¤šç»†èŠ‚ï¼Œè¯·æŸ¥é˜…Velocityæ–‡æ¡£ï¼‰ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†Velocityå¼•æ“è£…é…åˆ°SpitterEmailServiceImplä¸­ã€‚å› ä¸ºSpitterEmailServiceImplæ˜¯ä½¿ç”¨ç»„ä»¶æ‰«æå®ç°è‡ªåŠ¨æ³¨å†Œçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Autowiredæ¥è‡ªåŠ¨è£…é…velocityEngineå±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutowiredVelocityEngine</span> velocityEngine;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼ŒvelocityEngineå±æ€§å¯ç”¨äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒå°†Velocityæ¨¡æ¿è½¬æ¢ä¸ºStringï¼Œå¹¶ä½œä¸ºEmailæ–‡æœ¬è¿›è¡Œå‘é€ã€‚ä¸ºäº†å¸®åŠ©æˆ‘ä»¬å®Œæˆè¿™ä¸€ç‚¹ï¼ŒSpringè‡ªå¸¦äº†VelocityEngineUtilsæ¥ç®€åŒ–å°†Velocityæ¨¡æ¿ä¸æ¨¡å‹æ•°æ®åˆå¹¶æˆStringçš„å·¥ä½œã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬å¯èƒ½çš„ä½¿ç”¨æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, String&gt; model = <span class="keyword">new</span> HashMap&lt;String, String&gt;();model.put(<span class="string">&quot;spitterName&quot;</span>, spitterName);model.put(<span class="string">&quot;spitterText&quot;</span>, spitterText);String mailText = VelocityEngineUtils.mergeTemplateIntoString(  velocityEngine, <span class="string">&quot;emailTemplate.vm&quot;</span>, model);</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†ç»™å¤„ç†æ¨¡æ¿åšå‡†å¤‡ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªMapç”¨æ¥ä¿å­˜æ¨¡æ¿ä½¿ç”¨çš„æ¨¡å‹æ•°æ®ã€‚åœ¨å‰é¢å­—ç¬¦ä¸²æ‹¼æ¥çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬éœ€è¦Spitterçš„å…¨ååŠå…¶Spittleçš„æ–‡æœ¬ï¼Œè¿™é‡Œä¹Ÿæ˜¯ä¸€æ ·ã€‚ä¸ºäº†äº§ç”Ÿåˆå¹¶åçš„Emailæ–‡æœ¬ï¼Œæˆ‘ä»¬åªéœ€è°ƒç”¨VelocityEngineUtilsçš„mergeTemplateIntoString()æ–¹æ³•å¹¶å°†Velocityå¼•æ“ã€æ¨¡æ¿è·¯å¾„ï¼ˆç›¸å¯¹äºç±»è·¯å¾„æ ¹ï¼‰ä»¥åŠæ¨¡å‹Mapä¼ é€’è¿›å»ã€‚</p>
<p>åœ¨Javaä»£ç ä¸­å‰©ä¸‹çš„äº‹æƒ…å°±æ˜¯å¾—åˆ°åˆå¹¶åçš„Emailæ–‡æœ¬ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™helperçš„setText()æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helper.setText(emailText, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<p>æ¨¡æ¿ä½äºç±»è·¯å¾„çš„æ ¹ç›®å½•ä¸‹ï¼Œæ˜¯ä¸€ä¸ªåä¸ºemailTemplate.vmçš„æ–‡ä»¶ï¼Œå®ƒçœ‹èµ·æ¥å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span>  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;cid:spitterLogo&#x27;</span>&gt;</span>  <span class="tag">&lt;<span class="name">h4</span>&gt;</span>$&#123;spitterName&#125; says...<span class="tag">&lt;/<span class="name">h4</span>&gt;</span>  <span class="tag">&lt;<span class="name">i</span>&gt;</span>$&#123;spittleText&#125;<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œæ¨¡æ¿æ–‡ä»¶æ¯”å‰é¢çš„å­—ç¬¦ä¸²æ‹¼æ¥ç‰ˆæœ¬è¯»èµ·æ¥å®¹æ˜“å¤šäº†ã€‚å› æ­¤ï¼Œå®ƒä¹Ÿæ›´å®¹æ˜“ç»´æŠ¤å’Œç¼–è¾‘ã€‚å›¾19.2ç»™å‡ºäº†è¿™ç§ç±»å‹Emailçš„ä¸€ä¸ªç¤ºä¾‹ã€‚</p>
<p>åœ¨çœ‹åˆ°å›¾19.2çš„æ•ˆæœåï¼Œæˆ‘è§‰å¾—æœ‰å¾ˆå¤šåœ°æ–¹å¯ä»¥å¯¹æ¨¡æ¿è¿›è¡Œä¼˜åŒ–ä»è€Œä½¿å¾—Emailçœ‹èµ·æ¥æ›´æ¼‚äº®ã€‚ä½†æ˜¯ï¼Œæˆ‘å°†å®ƒä½œä¸ºç»™è¯»è€…çš„ç»ƒä¹ ã€‚</p>
<p>Velocityä½œä¸ºæ¨¡æ¿å¼•æ“å·²ç»å­˜åœ¨å¥½å¤šå¹´äº†ï¼Œå¹¶ä¸”é€‚ç”¨äºå¾ˆå¤šç§ä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œå¦‚ç¬¬6ç« æ‰€ç¤ºï¼Œä¸€ç§æ–°çš„æ¨¡æ¿æ–¹æ¡ˆæ­£åœ¨å˜å¾—æ—¥ç›Šæµè¡Œã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨Thymeleafæ¥æ„å»ºSpittle Emailæ¶ˆæ¯ã€‚</p>
<p><img src="spring-in-action-v4/image-20211114134451156.png" alt="image-20211114134451156"></p>
<p>å›¾19.2ã€€Velocityæ¨¡æ¿å’ŒåµŒå…¥çš„å›¾ç‰‡èƒ½å¤Ÿè£…æ‰®åŸæœ¬å•è°ƒä¹å‘³çš„Email</p>
<h4 id="ä½¿ç”¨Thymeleafæ„å»ºEmailæ¶ˆæ¯"><a href="#ä½¿ç”¨Thymeleafæ„å»ºEmailæ¶ˆæ¯" class="headerlink" title="ä½¿ç”¨Thymeleafæ„å»ºEmailæ¶ˆæ¯"></a>ä½¿ç”¨Thymeleafæ„å»ºEmailæ¶ˆæ¯</h4><p>å¦‚æˆ‘ä»¬ç¬¬6ç« æ‰€è®¨è®ºçš„é‚£æ ·ï¼ŒThymeleafæ˜¯ä¸€ç§å¾ˆæœ‰å¸å¼•åŠ›çš„HTMLæ¨¡æ¿å¼•æ“ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿåˆ›å»ºWYSIWYGçš„æ¨¡æ¿ã€‚ä¸JSPå’ŒVelocityä¸åŒï¼ŒThymeleafæ¨¡æ¿ä¸åŒ…å«ä»»ä½•ç‰¹æ®Šçš„æ ‡ç­¾åº“å’Œç‰¹æœ‰çš„æ ‡ç­¾ã€‚è¿™æ ·æ¨¡æ¿è®¾è®¡å¸ˆåœ¨å·¥ä½œçš„æ—¶å€™ï¼Œèƒ½å¤Ÿä½¿ç”¨ä»»æ„ä»–ä»¬æ‰€å–œæ¬¢çš„HTMLå·¥å…·ï¼Œè€Œä¸å¿…æ‹…å¿ƒæŸä¸ªå·¥å…·æ— æ³•å¤„ç†ç‰¹å®šçš„æ ‡ç­¾ã€‚</p>
<p>å½“æˆ‘ä»¬å°†Emailæ¨¡æ¿è½¬æ¢ä¸ºThymeleafæ¨¡æ¿æ—¶ï¼ŒThymeleafçš„WYSIWYGç‰¹æ€§ä½“ç°å¾—éå¸¸æ˜æ˜¾ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span>  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;spitterLogo.png&quot;</span> <span class="attr">th:src</span>=<span class="string">&#x27;cid:spitterLogo&#x27;</span>&gt;</span>  <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;spitterName&#125;&quot;</span>&gt;</span>Craig Walls<span class="tag">&lt;/<span class="name">span</span>&gt;</span>says...<span class="tag">&lt;/<span class="name">h4</span>&gt;</span>  <span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;spittleText&#125;&quot;</span>&gt;</span>Hello there!<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œè¿™é‡Œæ²¡æœ‰ä»»ä½•è‡ªå®šä¹‰çš„æ ‡ç­¾ï¼ˆåœ¨JSPä¸­å¯èƒ½ä¼šè§åˆ°è¿™ç§æƒ…å†µï¼‰ã€‚å°½ç®¡æ¨¡å‹å±æ€§æ˜¯é€šè¿‡â€œ${}â€æ ‡è®°çš„ï¼Œä½†æ˜¯å®ƒä»¬ä»…ç”¨äºå±æ€§çš„å€¼ä¸­ï¼Œä¸ä¼šåƒVelocityé‚£æ ·ç”¨åœ¨å¤–è¾¹ã€‚è¿™ç§æ¨¡æ¿å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨Webæµè§ˆå™¨ä¸­æ‰“å¼€ï¼Œå¹¶ä¸”ä»¥å®Œæ•´çš„å½¢å¼è¿›è¡Œå±•ç°ï¼Œä¸å¿…ä¾èµ–äºThymeleafå¼•æ“çš„å¤„ç†ã€‚</p>
<p>ä½¿ç”¨Thymeleafæ¥ç”Ÿæˆå’Œå‘é€Emailæ¶ˆæ¯çš„åšæ³•éå¸¸ç±»ä¼¼äºVelocityï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Context ctx = <span class="keyword">new</span> Context();ctx.setVariable(<span class="string">&quot;spitterName&quot;</span>, spitterName);ctx.setVariable&#123;<span class="string">&quot;spittleText&quot;</span>, spittle.getText());String emailText = thymeleaf.process(<span class="string">&quot;emailTemplate.html&quot;</span>, ctx);helper.setText(emailText, <span class="keyword">true</span>);mailSender.send(message);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œåšçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯åˆ›å»ºThymeleaf Contextå®ä¾‹ï¼Œå¹¶å°†æ¨¡å‹æ•°æ®å¡«å……è¿›å»ã€‚è¿™ä¸æˆ‘ä»¬ä½¿ç”¨Velocityçš„æ—¶å€™ï¼Œå°†æ¨¡å‹æ•°æ®å¡«å……åˆ°Mapä¸­å¾ˆç±»ä¼¼ã€‚ç„¶åï¼Œæˆ‘ä»¬è¦æ±‚Thymeleafå¤„ç†æ¨¡æ¿ï¼Œé€šè¿‡è°ƒç”¨Thymeleafå¼•æ“çš„process()æ–¹æ³•ï¼Œå°†ä¸Šä¸‹æ–‡ä¸­çš„æ¨¡å‹æ•°æ®åˆå¹¶åˆ°æ¨¡æ¿ä¸­ã€‚æœ€åï¼Œæˆ‘ä»¬å°†ç»“æœå½¢æˆçš„æ–‡æœ¬å€ŸåŠ©æ¶ˆæ¯helperè®¾ç½®åˆ°Emailæ¶ˆæ¯ä¸­ï¼Œå¹¶ä½¿ç”¨é‚®ä»¶å‘é€å™¨å°†æ¶ˆæ¯å‘é€å‡ºå»ã€‚</p>
<p>è¿™çœ‹èµ·æ¥å¾ˆç®€å•ã€‚ä½†æ˜¯Thymeleafå¼•æ“ï¼ˆä¹Ÿå°±æ˜¯thymeleafå˜é‡ï¼‰æ˜¯ä»å“ªé‡Œæ¥çš„å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œçš„Thymeleafå¼•æ“ä¸æˆ‘ä»¬åœ¨ç¬¬6ç« æ„å»ºWebè§†å›¾æ—¶æ‰€ä½¿ç”¨çš„SpringTemplateEnginebeanæ˜¯ç›¸åŒçš„ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨æ„é€ å™¨æ³¨å…¥çš„æ–¹å¼å°†å…¶æ³¨å…¥åˆ°SpitterEmailServiceImplä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowiredprivate</span> SpringTemplateEngine thymeleaf;<span class="meta">@Autowiredpublic</span> SpittleEmailServiceImpl(SpringTemplateEngine thymeleaf)&#123;  <span class="keyword">this</span>.engine = engine;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡ï¼Œæˆ‘ä»¬å¿…è¦è¦å¯¹SpringTemplateEnginebeanåšä¸€ç‚¹å°ä¿®æ”¹ã€‚åœ¨ç¬¬6ç« ä¸­ï¼Œå®ƒé…ç½®ä¸ºä»Servletä¸Šä¸‹æ–‡ä¸­è§£ææ¨¡æ¿ï¼Œè€Œæˆ‘ä»¬çš„Emailæ¨¡æ¿éœ€è¦ä»ç±»è·¯å¾„ä¸­è§£æã€‚æ‰€ä»¥ï¼Œé™¤äº†ServletContextTemplateResolverï¼Œè¿˜éœ€è¦ä¸€ä¸ªClassLoaderTemplateResolverï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">ClassLoaderTemplateResolver <span class="title">emailTemplateResolver</span><span class="params">()</span> </span>&#123;  ClassLoaderTemplateResolver resolver = <span class="keyword">new</span> ClassLoaderTemplateResolver();  resolver.setPrefix(<span class="string">&quot;mail/&quot;</span>);  resolver.setTemplateMode(<span class="string">&quot;HTML5&quot;</span>);  resolver.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);  setOrder(<span class="number">1</span>);  <span class="keyword">return</span> resolver;&#125;</span><br></pre></td></tr></table></figure>

<p>å°±å¤§éƒ¨åˆ†è€Œè¨€ï¼Œé…ç½®ClassLoaderTemplateResolver beançš„æ–¹å¼ç±»ä¼¼äºServletContextTemplateResolverã€‚ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬å°†prefixå±æ€§è®¾ç½®ä¸ºâ€œmail/â€ï¼Œè¿™è¡¨æ˜å®ƒä¼šåœ¨ç±»è·¯å¾„æ ¹çš„â€œmailâ€ç›®å½•ä¸‹å¼€å§‹æŸ¥æ‰¾Thymeleafæ¨¡æ¿ã€‚å› æ­¤ï¼ŒEmailæ¨¡æ¿æ–‡ä»¶çš„åå­—å¿…é¡»æ˜¯emailTemplate.htmlï¼Œå¹¶ä¸”ä½äºç±»è·¯å¾„æ ¹çš„â€œmailâ€ç›®å½•ä¸‹ã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬ç°åœ¨æœ‰ä¸¤ä¸ªæ¨¡æ¿è§£æå™¨ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨orderå±æ€§è¡¨æ˜ä¼˜å…ˆä½¿ç”¨å“ªä¸€ä¸ªã€‚ClassLoaderTemplateResolverçš„orderå±æ€§ä¸º1ï¼Œå› æ­¤æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ServletContextTemplateResolverï¼Œå°†å…¶orderå±æ€§è®¾ç½®ä¸º2ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">ClassLoaderTemplateResolver <span class="title">emailTemplateResolver</span><span class="params">()</span> </span>&#123;  ClassLoaderTemplateResolver resolver = <span class="keyword">new</span> ClassLoaderTemplateResolver();  resolver.setPrefix(<span class="string">&quot;mail/&quot;</span>);  resolver.setTemplateMode(<span class="string">&quot;HTML5&quot;</span>);  resolver.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);  setOrder(<span class="number">1</span>);  <span class="keyword">return</span> resolver;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œå‰©ä¸‹çš„ä»»åŠ¡å°±æ˜¯ä¿®æ”¹SpringTemplateEnginebeançš„é…ç½®ï¼Œè®©å®ƒä½¿ç”¨è¿™ä¸¤ä¸ªæ¨¡æ¿è§£æå™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">SpringTemplateEngine <span class="title">templateEngine</span><span class="params">(    Set&lt;ITemplateResolver&gt; resolvers)</span> </span>&#123;  SpringTemplateEngine engine = <span class="keyword">new</span> SpringTemplateEngine();  engine.setTemplateResolvers(resolvers);  <span class="keyword">return</span> engine;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªæ¨¡æ¿è§£æå™¨ï¼Œæ‰€ä»¥å¯ä»¥å°†å…¶æ³¨å…¥åˆ°SpringTemplateEngineçš„templateResolverå±æ€§ä¸­ã€‚ä½†ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸¤ä¸ªæ¨¡æ¿è§£æå™¨ï¼Œæ‰€ä»¥å¿…é¡»å°†å®ƒä»¬ä½œä¸ºSetçš„æˆå‘˜ï¼Œç„¶åå°†è¿™ä¸ªSetæ³¨å…¥åˆ°templateResolversï¼ˆå¤æ•°ï¼‰å±æ€§ä¸­ã€‚</p>
<h3 id="å°ç»“-18"><a href="#å°ç»“-18" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>Emailæ˜¯äººä¸äººä¹‹é—´é€šä¿¡çš„é‡è¦å½¢å¼ï¼Œé€šå¸¸ä¹Ÿæ˜¯åº”ç”¨ä¸äººè¿›è¡Œé€šä¿¡çš„ä¸€ç§å½¢å¼ã€‚SpringåŸºäºJavaæ‰€æä¾›çš„EmailåŠŸèƒ½ï¼ŒæŠ½è±¡äº†JavaMailï¼Œä½¿å¾—åœ¨Springä¸­ä½¿ç”¨å’Œé…ç½®èµ·æ¥éƒ½æ›´åŠ ç®€å•ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨Springçš„EmailæŠ½è±¡åŠŸèƒ½å‘é€ç®€å•çš„Emailæ¶ˆæ¯ï¼Œç„¶åæ›´è¿›ä¸€æ­¥ï¼Œå­¦ä¹ äº†å¦‚ä½•å‘é€åŒ…å«é™„ä»¶å’Œç»è¿‡HTMLæ ¼å¼åŒ–çš„å¯Œæ–‡æœ¬æ¶ˆæ¯ã€‚æˆ‘ä»¬è¿˜çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨åƒVelocityå’ŒThymeleafè¿™æ ·çš„æ¨¡æ¿å¼•æ“ç”Ÿæˆå¯Œæ–‡æœ¬Emailæ–‡æœ¬ï¼Œé¿å…äº†é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥åˆ›å»ºHTMLã€‚</p>
<p>åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå­¦ä¹ å¦‚ä½•å€ŸåŠ©Javaç®¡ç†æ‰©å±•ï¼ˆJava Management Extensionsï¼ŒJMXï¼‰ä¸ºSpring beanæ·»åŠ ç®¡ç†å’Œé€šçŸ¥åŠŸèƒ½ã€‚</p>
<h2 id="ä½¿ç”¨-JMX-ç®¡ç†-Spring-Bean"><a href="#ä½¿ç”¨-JMX-ç®¡ç†-Spring-Bean" class="headerlink" title="ä½¿ç”¨ JMX ç®¡ç† Spring Bean"></a>ä½¿ç”¨ JMX ç®¡ç† Spring Bean</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>å°†Spring beanæš´éœ²ä¸ºMBean</li>
<li>è¿œç¨‹ç®¡ç†Spring Bean</li>
<li>å¤„ç†JMXé€šçŸ¥</li>
</ul>
<p>Springå¯¹DIçš„æ”¯æŒæ˜¯é€šè¿‡åœ¨åº”ç”¨ä¸­é…ç½®beanå±æ€§ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸ä¸é”™çš„æ–¹æ³•ã€‚ä¸è¿‡ï¼Œä¸€æ—¦åº”ç”¨å·²ç»éƒ¨ç½²å¹¶ä¸”æ­£åœ¨è¿è¡Œï¼Œå•ç‹¬ä½¿ç”¨DIå¹¶ä¸èƒ½å¸®åŠ©æˆ‘ä»¬æ”¹å˜åº”ç”¨çš„é…ç½®ã€‚å‡è®¾æˆ‘ä»¬å¸Œæœ›æ·±å…¥äº†è§£æ­£åœ¨è¿è¡Œçš„åº”ç”¨å¹¶è¦åœ¨è¿è¡Œæ—¶æ”¹å˜åº”ç”¨çš„é…ç½®ï¼Œæ­¤æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨Javaç®¡ç†æ‰©å±•ï¼ˆJava Management Extensionsï¼ŒJMXï¼‰äº†ã€‚</p>
<p>JMXè¿™é¡¹æŠ€æœ¯èƒ½å¤Ÿè®©æˆ‘ä»¬ç®¡ç†ã€ç›‘è§†å’Œé…ç½®åº”ç”¨ã€‚è¿™é¡¹æŠ€æœ¯æœ€åˆä½œä¸ºJavaçš„ç‹¬ç«‹æ‰©å±•ï¼Œä»Java 5å¼€å§‹ï¼ŒJMXå·²ç»æˆä¸ºæ ‡å‡†çš„ç»„ä»¶ã€‚ä½¿ç”¨JMXç®¡ç†åº”ç”¨çš„æ ¸å¿ƒç»„ä»¶æ˜¯æ‰˜ç®¡beanï¼ˆmanaged beanï¼ŒMBeanï¼‰ã€‚æ‰€è°“çš„MBeanå°±æ˜¯æš´éœ²ç‰¹å®šæ–¹æ³•çš„JavaBeanï¼Œè¿™äº›æ–¹æ³•å®šä¹‰äº†ç®¡ç†æ¥å£ã€‚JMXè§„èŒƒå®šä¹‰äº†å¦‚ä¸‹4ç§ç±»å‹çš„MBeanï¼š</p>
<ul>
<li>æ ‡å‡†MBeanï¼šæ ‡å‡†MBeançš„ç®¡ç†æ¥å£æ˜¯é€šè¿‡åœ¨å›ºå®šçš„æ¥å£ä¸Šæ‰§è¡Œåå°„ç¡®å®šçš„ï¼Œbeanç±»ä¼šå®ç°è¿™ä¸ªæ¥å£ï¼›</li>
<li>åŠ¨æ€MBeanï¼šåŠ¨æ€MBeançš„ç®¡ç†æ¥å£æ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡è°ƒç”¨DynamicMBeanæ¥å£çš„æ–¹æ³•æ¥ç¡®å®šçš„ã€‚å› ä¸ºç®¡ç†æ¥å£ä¸æ˜¯é€šè¿‡é™æ€æ¥å£å®šä¹‰çš„ï¼Œå› æ­¤å¯ä»¥åœ¨è¿è¡Œæ—¶æ”¹å˜ï¼›</li>
<li>å¼€æ”¾MBeanï¼šå¼€æ”¾MBeanæ˜¯ä¸€ç§ç‰¹æ®Šçš„åŠ¨æ€MBeanï¼Œå…¶å±æ€§å’Œæ–¹æ³•åªé™å®šäºåŸå§‹ç±»å‹ã€åŸå§‹ç±»å‹çš„åŒ…è£…ç±»ä»¥åŠå¯ä»¥åˆ†è§£ä¸ºåŸå§‹ç±»å‹æˆ–åŸå§‹ç±»å‹åŒ…è£…ç±»çš„ä»»æ„ç±»å‹ï¼›</li>
<li>æ¨¡å‹MBeanï¼šæ¨¡å‹MBeanä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„åŠ¨æ€MBeanï¼Œç”¨äºå……å½“ç®¡ç†æ¥å£ä¸å—ç®¡èµ„æºçš„ä¸­ä»‹ã€‚æ¨¡å‹Beanå¹¶ä¸åƒå®ƒä»¬æ‰€å£°æ˜çš„é‚£æ ·æ¥ç¼–å†™ã€‚å®ƒä»¬é€šå¸¸é€šè¿‡å·¥å‚ç”Ÿæˆï¼Œå·¥å‚ä¼šä½¿ç”¨å…ƒä¿¡æ¯æ¥ç»„è£…ç®¡ç†æ¥å£ã€‚</li>
</ul>
<p>Springçš„JMXæ¨¡å—å¯ä»¥è®©æˆ‘ä»¬å°†Spring beanå¯¼å‡ºä¸ºæ¨¡å‹MBeanï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„å†…éƒ¨æƒ…å†µå¹¶ä¸”èƒ½å¤Ÿæ›´æ”¹é…ç½®â€”â€”ç”šè‡³åœ¨åº”ç”¨çš„è¿è¡ŒæœŸã€‚æ¥ä¸‹æ¥ï¼Œå°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨Springå¯¹JMXçš„æ”¯æŒæ¥ç®¡ç†Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„beanã€‚</p>
<h3 id="å°†Spring-beanå¯¼å‡ºä¸ºMBean"><a href="#å°†Spring-beanå¯¼å‡ºä¸ºMBean" class="headerlink" title="å°†Spring beanå¯¼å‡ºä¸ºMBean"></a>å°†Spring beanå¯¼å‡ºä¸ºMBean</h3><p>è¿™é‡Œæœ‰å‡ ç§æ–¹å¼å¯ä»¥è®©æˆ‘ä»¬é€šè¿‡ä½¿ç”¨JMXæ¥ç®¡ç†Spittråº”ç”¨ä¸­çš„beanã€‚ä¸ºäº†è®©äº‹æƒ…å°½é‡ä¿æŒç®€å•ï¼Œæˆ‘ä»¬å¯¹ç¨‹åºæ¸…å•5.10ä¸­SpittleControlleråªåšé€‚åº¦çš„æ”¹å˜ï¼Œå¢åŠ ä¸€ä¸ªæ–°çš„spittlesPerPageå±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_SPITTLES_PER_PAGE = <span class="number">25</span>;<span class="keyword">private</span> <span class="keyword">int</span> spittlesPerPage = DEFAULT_SPITTLES_PER_PAGE;<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSpittlesPerPage</span><span class="params">(<span class="keyword">int</span> spittlesPerPage)</span> </span>&#123;  <span class="keyword">this</span>.spittlesPerPage = spittlesPerPage;&#125;<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSpittlesPerPage</span><span class="params">()</span>	</span>&#123;  <span class="keyword">return</span> spittlesPerPage;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹‹å‰ï¼Œå½“æˆ‘ä»¬è°ƒç”¨SpitterServiceçš„getRecentSpittles()æ–¹æ³•æ—¶ï¼ŒSpittleControllerä¼ å…¥20ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿™ä¼šæŸ¥è¯¢æœ€è¿‘çš„20æ¡Spittleã€‚ç°åœ¨ï¼Œä¸å†æ˜¯åœ¨æ„å»ºåº”ç”¨æ—¶é€šè¿‡ç¡¬ç¼–ç è¿›è¡Œå†³ç­–ï¼Œè€Œæ˜¯é€šè¿‡ä½¿ç”¨JMXåœ¨è¿è¡Œæ—¶è¿›è¡Œå†³ç­–ã€‚æ–°å¢çš„spittlesPerPageå±æ€§åªæ˜¯ç¬¬ä¸€æ­¥è€Œå·²ã€‚</p>
<p>ä½†æ˜¯spittlesPerPageå±æ€§æœ¬èº«å¹¶ä¸èƒ½å®ç°é€šè¿‡å¤–éƒ¨é…ç½®æ¥æ”¹å˜é¡µé¢ä¸Šæ‰€æ˜¾ç¤ºSpittleçš„æ•°é‡ã€‚å®ƒåªæ˜¯beançš„ä¸€ä¸ªå±æ€§ï¼Œè·Ÿbeançš„å…¶ä»–å±æ€§ä¸€æ ·ã€‚æˆ‘ä»¬ä¸‹ä¸€æ­¥éœ€è¦åšçš„æ˜¯æŠŠSpittleControllerbeanæš´éœ²ä¸ºMBeanï¼Œè€ŒspittlePerPageå±æ€§å°†æˆä¸ºMBeançš„æ‰˜ç®¡å±æ€§ï¼ˆmanaged attributeï¼‰ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿è¡Œæ—¶æ”¹å˜è¯¥å±æ€§çš„å€¼ã€‚</p>
<p>Springçš„MBeanExporteræ˜¯å°†Spring Beanè½¬å˜ä¸ºMBeançš„å…³é”®ã€‚MBeanExporterå¯ä»¥æŠŠä¸€ä¸ªæˆ–å¤šä¸ªSpring beanå¯¼å‡ºä¸ºMBeanæœåŠ¡å™¨ï¼ˆMBean serverï¼‰å†…çš„æ¨¡å‹ MBeanã€‚MBeanæœåŠ¡å™¨ï¼ˆæœ‰æ—¶å€™ä¹Ÿè¢«ç§°ä¸ºMBeanä»£ç†ï¼‰æ˜¯MBeanç”Ÿå­˜çš„å®¹å™¨ã€‚å¯¹MBeançš„è®¿é—®ï¼Œä¹Ÿæ˜¯é€šè¿‡MBeanæœåŠ¡å™¨æ¥å®ç°çš„ã€‚</p>
<p>å¦‚å›¾20.1æ‰€ç¤ºï¼Œå°†Spring beanå¯¼å‡ºä¸ºJMX MBeanä¹‹åï¼Œå¯ä»¥ä½¿ç”¨åŸºäºJMXçš„ç®¡ç†å·¥å…·ï¼ˆä¾‹å¦‚JConsoleæˆ–è€…VisualVMï¼‰æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œæ˜¾ç¤ºbeançš„å±æ€§å¹¶è°ƒç”¨beançš„æ–¹æ³•ã€‚</p>
<p><img src="spring-in-action-v4/image-20211114135257054.png" alt="image-20211114135257054"><br>å›¾20.1ã€€Springçš„MBeanExporterå¯ä»¥å°†Spring beançš„å±æ€§å’Œæ–¹æ³•å¯¼å‡ºä¸ºMBeanæœåŠ¡å™¨ä¸­çš„JMXå±æ€§å’Œæ“ä½œã€‚é€šè¿‡JMXæœåŠ¡å™¨ï¼ŒJMXç®¡ç†å·¥å…·ï¼ˆä¾‹å¦‚JConsoleï¼‰å¯ä»¥æŸ¥çœ‹åˆ°æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºçš„å†…éƒ¨æƒ…å†µ</p>
<p>ä¸‹é¢çš„@Beanæ–¹æ³•åœ¨Springä¸­å£°æ˜äº†ä¸€ä¸ªMBeanExporterï¼Œå®ƒä¼šå°†spittleControllerbeanå¯¼å‡ºä¸ºä¸€ä¸ªæ¨¡å‹MBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MBeanExporter <span class="title">mbeanExporter</span><span class="params">(SpittleController spittleController)</span> </span>&#123;  MBeanExporter exporter = <span class="keyword">new</span> MBeanExporter();  Map&lt;String, Object&gt; beans = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();  beans.put(<span class="string">&quot;spitter:name=SpittleController&quot;</span>, spittleController);  exporter.setBeans(beans);  <span class="keyword">return</span> exporter;&#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®MBeanExporterçš„æœ€ç®€å•æ–¹å¼æ˜¯ä¸ºå®ƒçš„beanså±æ€§é…ç½®ä¸€ä¸ªMapé›†åˆï¼Œè¯¥é›†åˆä¸­çš„å…ƒç´ æ˜¯æˆ‘ä»¬å¸Œæœ›æš´éœ²ä¸ºJMX MBeançš„ä¸€ä¸ªæˆ–å¤šä¸ªbeanã€‚æ¯ä¸ªMapæ¡ç›®çš„keyå°±æ˜¯MBeançš„åç§°ï¼ˆç”±ç®¡ç†åŸŸçš„åå­—å’Œä¸€ä¸ªkey-valueå¯¹ç»„æˆï¼Œåœ¨SpittleController MBeanç¤ºä¾‹ä¸­æ˜¯spitter:name=HomeControllerï¼‰ï¼Œè€ŒMapæ¡ç›®çš„å€¼åˆ™æ˜¯éœ€è¦æš´éœ²çš„Spring beanå¼•ç”¨ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è¾“å‡ºspittleControllerbeanï¼Œä»¥ä¾¿å®ƒçš„å±æ€§å¯ä»¥é€šè¿‡JMXåœ¨è¿è¡Œæ—¶è¿›è¡Œç®¡ç†ã€‚</p>
<p>é€šè¿‡MBeanExporterï¼ŒspittleControllerbeanå°†ä½œä¸ºæ¨¡å‹MBeanä»¥SpittleControllerçš„åç§°å¯¼å‡ºåˆ°MBeanæœåŠ¡å™¨ä¸­ï¼Œä»¥å®ç°ç®¡ç†åŠŸèƒ½ã€‚å›¾20.2å±•ç¤ºäº†é€šè¿‡JConsoleæŸ¥çœ‹SpittleControllerMBeanæ—¶çš„æƒ…å†µã€‚</p>
<p><img src="spring-in-action-v4/image-20211114135408542.png" alt="image-20211114135408542"><br>å›¾20.2ã€€SpittleControllerå¯¼å‡ºä¸ºMBeanï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡JConsoleæŸ¥çœ‹</p>
<p>å¦‚å›¾20.2çš„å·¦ä¾§æ‰€ç¤ºï¼ŒSpittleControlleræ‰€æœ‰çš„publicæˆå‘˜éƒ½è¢«å¯¼å‡ºä¸ºMBeançš„æ“ä½œæˆ–å±æ€§ã€‚è¿™å¯èƒ½å¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€å¸Œæœ›çœ‹åˆ°çš„ç»“æœï¼Œæˆ‘ä»¬çœŸæ­£éœ€è¦çš„åªæ˜¯å¯ä»¥é…ç½®spittlesPerPageå±æ€§ã€‚æˆ‘ä»¬ä¸éœ€è¦è°ƒç”¨spittles()æ–¹æ³•æˆ–SpittleControllerä¸­çš„å…¶ä»–æ–¹æ³•æˆ–å±æ€§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–¹å¼æ¥ç­›é€‰æ‰€éœ€è¦çš„å±æ€§æˆ–æ–¹æ³•ã€‚</p>
<p>ä¸ºäº†å¯¹MBeançš„å±æ€§å’Œæ“ä½œè·å¾—æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼ŒSpringæä¾›äº†å‡ ç§é€‰æ‹©ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>é€šè¿‡åç§°æ¥å£°æ˜éœ€è¦æš´éœ²æˆ–å¿½ç•¥çš„beanæ–¹æ³•ï¼›</li>
<li>é€šè¿‡ä¸ºbeanå¢åŠ æ¥å£æ¥é€‰æ‹©è¦æš´éœ²çš„æ–¹æ³•ï¼›</li>
<li>é€šè¿‡æ³¨è§£æ ‡æ³¨beanæ¥æ ‡è¯†æ‰˜ç®¡çš„å±æ€§å’Œæ“ä½œã€‚</li>
</ul>
<p>æˆ‘ä»¬ä¼šå°è¯•æ¯ä¸€ç§æ–¹å¼æ¥å†³å®šå“ªä¸€ç§æœ€é€‚åˆSpittleControllerMBeanã€‚æˆ‘ä»¬é¦–å…ˆé€šè¿‡åç§°æ¥é€‰æ‹©beançš„å“ªäº›æ–¹æ³•éœ€è¦æš´éœ²ã€‚</p>
<p>MBeanæœåŠ¡å™¨ä»ä½•å¤„è€Œæ¥</p>
<p>æ ¹æ®ä»¥ä¸Šé…ç½®ï¼ŒMBeanExporterä¼šå‡è®¾å®ƒæ­£åœ¨ä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨ä¸­ï¼ˆä¾‹å¦‚Tomcatï¼‰æˆ–æä¾›MBeanæœåŠ¡å™¨çš„å…¶ä»–ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚ä½†æ˜¯ï¼Œå¦‚æœSpringåº”ç”¨ç¨‹åºæ˜¯ç‹¬ç«‹çš„åº”ç”¨æˆ–è¿è¡Œçš„å®¹å™¨æ²¡æœ‰æä¾›MBeanæœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨Springä¸Šä¸‹æ–‡ä¸­é…ç½®ä¸€ä¸ªMBeanæœåŠ¡å™¨ã€‚</p>
<p>åœ¨XMLé…ç½®ä¸­ï¼Œ<code>&lt;context:mbean-server&gt;</code>å…ƒç´ å¯ä»¥ä¸ºæˆ‘ä»¬å®ç°è¯¥åŠŸèƒ½ã€‚å¦‚æœä½¿ç”¨Javaé…ç½®çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦æ›´ç›´æ¥çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯é…ç½®ç±»å‹ä¸ºMBeanServerFactoryBeançš„beanï¼ˆè¿™ä¹Ÿæ˜¯åœ¨XMLä¸­<code>&lt;context:mbean-server&gt;</code>å…ƒç´ æ‰€ä½œçš„äº‹æƒ…ï¼‰ã€‚</p>
<p>MBeanServerFactoryBeanä¼šåˆ›å»ºä¸€ä¸ªMBeanæœåŠ¡å™¨ï¼Œå¹¶å°†å…¶ä½œä¸ºSpringåº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„beanã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªbeançš„IDæ˜¯mbeanServerã€‚äº†è§£åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å®ƒè£…é…åˆ°MBeanExporterçš„serverå±æ€§ä¸­ç”¨æ¥æŒ‡å®šMBeanè¦æš´éœ²åˆ°å“ªä¸ªMBeanæœåŠ¡å™¨ä¸­ã€‚</p>
<h4 id="é€šè¿‡åç§°æš´éœ²æ–¹æ³•"><a href="#é€šè¿‡åç§°æš´éœ²æ–¹æ³•" class="headerlink" title="é€šè¿‡åç§°æš´éœ²æ–¹æ³•"></a>é€šè¿‡åç§°æš´éœ²æ–¹æ³•</h4><p>MBeanä¿¡æ¯è£…é…å™¨ï¼ˆMBean info assemblerï¼‰æ˜¯é™åˆ¶å“ªäº›æ–¹æ³•å’Œå±æ€§å°†åœ¨MBeanä¸Šæš´éœ²çš„å…³é”®ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªMBeanä¿¡æ¯è£…é…å™¨æ˜¯MethodNameBasedMBeanInfoAssemblerã€‚è¿™ä¸ªè£…é…å™¨æŒ‡å®šäº†éœ€è¦æš´éœ²ä¸ºMBeanæ“ä½œçš„æ–¹æ³•åç§°åˆ—è¡¨ã€‚å¯¹äºSpittleController beanæ¥è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›æŠŠspittlePerPageæš´éœ²ä¸ºæ‰˜ç®¡å±æ€§ã€‚åŸºäºæ–¹æ³•åçš„è£…é…å™¨å¦‚ä½•å¸®æˆ‘ä»¬å¯¼å‡ºä¸€ä¸ªæ‰˜ç®¡å±æ€§å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å›é¡¾ä¸‹JavaBeançš„è§„åˆ™ï¼ˆè¿™ä¸æ˜¯Spring Beanæ‰€å¿…éœ€çš„ï¼‰ï¼ŒspittlesPerPageå±æ€§éœ€è¦å®šä¹‰å¯¹åº”çš„å­˜å–å™¨ï¼ˆaccessorï¼‰æ–¹æ³•ï¼Œæ–¹æ³•åå¿…é¡»ä¸ºetSpittlesPerPage()å’ŒgetSpittlesPerPage()ã€‚ä¸ºäº†é™åˆ¶MBeanæ‰€æš´éœ²çš„å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰MethodNameBaseMBeanInfoAssemblerä»…åœ¨MBeançš„æ¥å£ä¸­åŒ…å«è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚å¦‚<br>ä¸‹MethodNameBaseMBeanInfoAssemblerçš„beanå£°æ˜å°±é…ç½®äº†è¿™äº›æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MethodNameBasedMBeanlnfoAssembler <span class="title">assembler</span><span class="params">()</span> </span>&#123;  MethodNameBasedMBeanlnfoAssembler assembler = <span class="keyword">new</span> MethodNameBasedMBeanlnfoAssembler();  assembler.setManagedMethods(<span class="keyword">new</span> String[] &#123;    <span class="string">&quot;getSpittlesPerPage&quot;</span>, <span class="string">&quot;setSpittlesPerPage&quot;</span>&#125;);  <span class="keyword">return</span> assembler;&#125;</span><br></pre></td></tr></table></figure>

<p>managedMethodså±æ€§å¯ä»¥æ¥å—ä¸€ä¸ªæ–¹æ³•åç§°çš„åˆ—è¡¨ï¼ŒæŒ‡å®šäº†å“ªäº›æ–¹æ³•å°†æš´éœ²ä¸ºMBeançš„æ“ä½œã€‚å› ä¸ºæœ¬ç¤ºä¾‹æ‰€é…ç½®çš„æ˜¯spittlesPerPageå±æ€§çš„å­˜å–å™¨æ–¹æ³•ï¼Œæ‰€ä»¥spittlesPerPageå±æ€§ä¹Ÿè‡ªç„¶æˆä¸ºäº†MBeançš„æ‰˜ç®¡å±æ€§ã€‚</p>
<p>ä¸ºäº†è®©è¿™ä¸ªè£…é…å™¨èƒ½å¤Ÿç”Ÿæ•ˆï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒè£…é…è¿›MBeanExporterä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MBeanExporter <span class="title">mbeanExporter</span><span class="params">(SpittleControiler spittleControiler, MBeanlnfoAssembler assembler)</span> </span>&#123;  MBeanExporter exporter = <span class="keyword">new</span> MBeanExporter();  Map&lt;String, Object&gt; beans = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();  beans.put(<span class="string">&quot;spitter:name=SpittleController&quot;</span>, spittleControiler);  exporter.setBeans(beans);  exporter.setAssembler(assembler);    <span class="keyword">return</span> exporter;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å¦‚æœæˆ‘ä»¬å¯åŠ¨åº”ç”¨ï¼ŒSpittleControllerçš„spittlesPerPageå°†ä½œä¸ºæœ‰æ•ˆçš„MBeanæ‰˜ç®¡å±æ€§ï¼Œè€Œspittles()æ–¹æ³•å¹¶ä¸ä¼šæš´éœ²ä¸ºMBeançš„æ‰˜ç®¡æ“ä½œã€‚å›¾20.3å±•ç¤ºäº†é€šè¿‡JConsoleæŸ¥çœ‹SpittleControllerçš„æƒ…å†µã€‚</p>
<p><img src="spring-in-action-v4/image-20211114135810011.png" alt="image-20211114135810011"><br>å›¾20.3ã€€å½“æŒ‡å®šäº†å“ªäº›æ–¹æ³•åœ¨SpittleController MBeanä¸Šæš´éœ²åï¼Œspittles()æ–¹æ³•ä¸å†ä½œä¸ºMBeançš„æ‰˜ç®¡æ“ä½œ</p>
<p>å¦ä¸€ä¸ªåŸºäºæ–¹æ³•åç§°çš„è£…é…å™¨æ˜¯MethodExclusionMBeanInfoAssemblerã€‚è¿™ä¸ªMBeanä¿¡æ¯è£…é…å™¨æ˜¯MethodNameBaseMBeanInfoAssemblerçš„åæ“ä½œã€‚å®ƒä¸<br>æ˜¯æŒ‡å®šå“ªäº›æ–¹æ³•éœ€è¦æš´éœ²ä¸ºMBeançš„æ‰˜ç®¡æ“ä½œï¼ŒMethodExclusionMBeanInfoAssembleræŒ‡å®šäº†ä¸éœ€è¦æš´éœ²ä¸ºMBeanæ‰˜ç®¡æ“ä½œçš„æ–¹æ³•åç§°åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨MethodExclusionMBeanInfoAssembleæŒ‡å®šspittles()ä½œä¸ºä¸æš´éœ²çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MethodExclusionMBeanlnfoAssembler <span class="title">assembler</span><span class="params">()</span> </span>&#123;  MethodExclusionMBeanlnfoAssembler assembler = <span class="keyword">new</span> MethodExclusionMBeanlnfoAssembler();  assembler.setIgnoredMethods(<span class="keyword">new</span> String[] &#123; <span class="string">&quot;spittles&quot;</span> &#125; );  <span class="keyword">return</span> assembler;&#125;</span><br></pre></td></tr></table></figure>

<p>åŸºäºæ–¹æ³•åç§°çš„è£…é…å™¨æ˜¯æœ€ç›´æ¥å’Œæ˜“äºä½¿ç”¨çš„ã€‚ä½†æ˜¯å¦‚æœéœ€è¦æŠŠå¤šä¸ªSpring beanå¯¼å‡ºä¸ºMBeanï¼Œæˆ‘ä»¬èƒ½æƒ³è±¡å°†å‡ºç°ä»€ä¹ˆæ ·çš„æƒ…å½¢å—ï¼Ÿä¸ºè£…é…å™¨æ‰€é…ç½®çš„æ–¹æ³•åç§°æ¸…å•å°†ä¼šå˜å¾—éå¸¸åºå¤§ï¼›è€Œä¸”è¿˜æœ‰ä¸€ç§å¯èƒ½ï¼Œæˆ‘ä»¬å¸Œæœ›æš´éœ²ä¸€ä¸ªbeançš„æŸä¸ªæ–¹æ³•ï¼Œä½†ä¸å¸Œæœ›æš´éœ²å¦ä¸€ä¸ªbeançš„åŒåæ–¹æ³•ã€‚</p>
<p>å¾ˆæ˜æ˜¾ï¼Œåœ¨Springé…ç½®æ–¹é¢ï¼Œå½“å¯¼å‡ºå¤šä¸ªMBeanæ—¶ï¼ŒåŸºäºæ–¹æ³•åç§°çš„æ–¹å¼å¹¶ä¸èƒ½å¾ˆå¥½åœ°æ»¡è¶³æ­¤åœºæ™¯ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚æœä½¿ç”¨æ¥å£æš´éœ²MBeançš„æ“ä½œå’Œå±æ€§æ˜¯å¦æ›´ä¸ºåˆé€‚ã€‚</p>
<h4 id="ä½¿ç”¨æ¥å£å®šä¹‰MBeançš„æ“ä½œå’Œå±æ€§"><a href="#ä½¿ç”¨æ¥å£å®šä¹‰MBeançš„æ“ä½œå’Œå±æ€§" class="headerlink" title="ä½¿ç”¨æ¥å£å®šä¹‰MBeançš„æ“ä½œå’Œå±æ€§"></a>ä½¿ç”¨æ¥å£å®šä¹‰MBeançš„æ“ä½œå’Œå±æ€§</h4><p>Springçš„InterfaceBasedMBeanInfoAssembleræ˜¯å¦ä¸€ç§MBeanä¿¡æ¯è£…é…å™¨ï¼Œå¯ä»¥è®©æˆ‘ä»¬é€šè¿‡ä½¿ç”¨æ¥å£æ¥é€‰æ‹©beançš„å“ªäº›æ–¹æ³•éœ€è¦æš´éœ²ä¸ºMBeançš„æ‰˜ç®¡æ“ä½œã€‚InterfaceBasedMBeanInfoAssemblerä¸åŸºäºæ–¹æ³•åç§°çš„è£…é…å™¨å¾ˆç›¸ä¼¼ï¼Œåªä¸è¿‡ä¸å†é€šè¿‡ç½—åˆ—æ–¹æ³•åç§°æ¥ç¡®å®šæš´éœ²å“ªäº›æ–¹æ³•ï¼Œè€Œæ˜¯é€šè¿‡åˆ—å‡ºæ¥å£æ¥å£°æ˜å“ªäº›æ–¹æ³•éœ€è¦æš´éœ²ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºSpittleControllerManagedOperationsçš„æ¥å£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.jmx;<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpittleControllerManagedOperations</span> </span>&#123;  <span class="function"><span class="keyword">int</span> <span class="title">getSpittlePerPage</span><span class="params">()</span></span>;  <span class="function"><span class="keyword">void</span> <span class="title">setSpittlesPerPage</span><span class="params">(<span class="keyword">int</span> spittlesPerPage)</span></span>;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©äº†setSpittlesPerPage()æ–¹æ³•å’ŒgetSpittlesPerPage()æ–¹æ³•ä½œä¸ºéœ€è¦æš´éœ²çš„æ–¹æ³•ã€‚å†æ¬¡æé†’ï¼Œè¿™ä¸€å¯¹å­˜å–å™¨æ–¹æ³•é—´æ¥æš´éœ²äº†spittlesPerPageå±æ€§ä½œä¸ºMBeançš„æ‰˜ç®¡å±æ€§ã€‚ä¸ºäº†åº”ç”¨æ­¤è£…é…å™¨ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨å¦‚ä¸‹çš„assemblerbeanæ›¿æ¢ä¹‹å‰åŸºäºæ–¹æ³•åç§°çš„è£…é…å™¨å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">InterfaceBasedMBeanlnfoAssembler <span class="title">assembler</span><span class="params">()</span> </span>&#123;  InterfaceBasedMBeanlnfoAssembler assembler = <span class="keyword">new</span> InterfaceBasedMBeanlnfoAssembler();  assembler.setManagedlnterfaces( <span class="keyword">new</span> Class&lt;?&gt;[] &#123; SpittleControllerManagedOperations.class &#125;);  <span class="keyword">return</span> assembler;&#125;</span><br></pre></td></tr></table></figure>

<p>managedInterfaceså±æ€§æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ç»„æˆçš„åˆ—è¡¨ä½œä¸ºMBeançš„ç®¡ç†æ¥å£â€”â€”åœ¨æœ¬ç¤ºä¾‹ä¸­ä¸ºSpittleControllerManagedOperationsæ¥å£ã€‚</p>
<p>SpittleControllerå¹¶æ²¡æœ‰æ˜¾å¼å®ç°SpittleControllerManagedOperationsæ¥å£ï¼Œè¿™å¯èƒ½å¹¶ä¸æ˜æ˜¾ï¼Œä½†ç›¸å½“æœ‰è¶£ã€‚è¿™ä¸ªæ¥å£åªæ˜¯ä¸ºäº†æ ‡è¯†å¯¼å‡ºçš„å†…å®¹ï¼Œä½†æˆ‘ä»¬å¹¶ä¸éœ€<br>è¦åœ¨ä»£ç ä¸­ç›´æ¥å®ç°è¯¥æ¥å£ã€‚ä¸è¿‡ï¼ŒSpittleControlleråº”è¯¥å®ç°è¿™ä¸ªæ¥å£ï¼Œå…¶å®ä¹Ÿæ²¡æœ‰å…¶ä»–çš„åŸå› ï¼Œåªæ˜¯åœ¨MBeanå’Œå®ç°ç±»ä¹‹é—´åº”è¯¥æœ‰ä¸€ä¸ªä¸€è‡´çš„åè®®ã€‚</p>
<p>å¦‚æœé€šè¿‡æ¥å£æ¥é€‰æ‹©MBeanæ“ä½œçš„è¯ï¼Œæœ€å¸å¼•äººçš„ä¸€ç‚¹åœ¨äºæˆ‘ä»¬å¯ä»¥æŠŠå¾ˆå¤šæ–¹æ³•æ”¾åœ¨å°‘é‡çš„æ¥å£ä¸­ï¼Œä»è€Œç¡®ä¿InterfaceBasedMBeanInfoAssemblerçš„é…ç½®å°½é‡ç®€æ´ã€‚åœ¨è¾“å‡ºå¤šä¸ªMBeanæ—¶ï¼ŒåŸºäºæ¥å£çš„æ–¹å¼å¯ä»¥å¸®åŠ©ä¿æŒSpringé…ç½®çš„ç®€æ´ã€‚</p>
<p>æœ€ç»ˆï¼Œè¿™äº›æ‰˜ç®¡æ“ä½œå¿…é¡»åœ¨æŸå¤„å£°æ˜ï¼Œæ— è®ºæ˜¯åœ¨Springé…ç½®ä¸­è¿˜æ˜¯åœ¨æŸä¸ªæ¥å£ä¸­ã€‚æ­¤å¤–ï¼Œä»ä»£ç è§’åº¦çœ‹ï¼Œæ‰˜ç®¡æ“ä½œçš„å£°æ˜æ˜¯ä¸€ç§é‡å¤â€”â€”åœ¨æ¥å£ä¸­æˆ–Springä¸Šä¸‹æ–‡ä¸­å£°æ˜çš„æ–¹æ³•åç§°ä¸å®ç°ä¸­æ‰€å£°æ˜çš„æ–¹æ³•åç§°å­˜åœ¨é‡å¤ã€‚ä¹‹æ‰€ä»¥å­˜åœ¨è¿™ç§é‡å¤ï¼Œæ²¡æœ‰å…¶ä»–åŸå› ï¼Œä»…ä»…æ˜¯ä¸ºäº†æ»¡è¶³MBeanExporterçš„éœ€è¦è€Œäº§ç”Ÿçš„ã€‚</p>
<p>Javaæ³¨è§£çš„ä¸€é¡¹å·¥ä½œå°±æ˜¯å¸®åŠ©æ¶ˆé™¤è¿™ç§é‡å¤ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•é€šè¿‡ä½¿ç”¨æ³¨è§£æ ‡æ³¨Springç®¡ç†çš„beanï¼Œä»è€Œå°†å…¶å¯¼å‡ºMBeanã€‚</p>
<h4 id="ä½¿ç”¨æ³¨è§£é©±åŠ¨çš„MBean"><a href="#ä½¿ç”¨æ³¨è§£é©±åŠ¨çš„MBean" class="headerlink" title="ä½¿ç”¨æ³¨è§£é©±åŠ¨çš„MBean"></a>ä½¿ç”¨æ³¨è§£é©±åŠ¨çš„MBean</h4><p>é™¤äº†æˆ‘å‘ä½ å±•ç¤ºçš„MBeanä¿¡æ¯è£…é…å™¨ï¼ŒSpringè¿˜æä¾›äº†å¦ä¸€ç§è£…é…å™¨â€”â€”MetadataMBeanInfoAssemblerï¼Œè¿™ç§è£…é…å™¨å¯ä»¥ä½¿ç”¨æ³¨è§£æ ‡è¯†å“ªäº›beançš„æ–¹æ³•éœ€è¦æš´éœ²ä¸ºMBeançš„æ‰˜ç®¡æ“ä½œå’Œå±æ€§ã€‚æˆ‘å®Œå…¨å¯ä»¥å‘ä½ å±•ç¤ºå¦‚ä½•ä½¿ç”¨è¿™ç§è£…é…å™¨ï¼Œä½†æˆ‘ä¸ä¼šè¿™ä¹ˆåšã€‚è¿™æ˜¯å› ä¸ºæ‰‹å·¥è£…é…å®ƒéå¸¸ç¹æ‚ï¼Œä»…ä»…æ˜¯ä¸ºäº†ä½¿ç”¨æ³¨è§£å¹¶ä¸å€¼å¾—è¿™ä¹ˆåšã€‚ç›¸åï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•ä½¿ç”¨Spring contexté…ç½®å‘½åç©ºé—´ä¸­çš„<code>&lt;context:mbean-export&gt;</code>å…ƒç´ ã€‚è¿™ä¸ªä¾¿æ·çš„å…ƒç´ è£…é…äº†MBeanå¯¼å‡ºå™¨ä»¥åŠä¸ºäº†åœ¨Springå¯ç”¨æ³¨è§£é©±åŠ¨çš„MBeanæ‰€éœ€è¦çš„è£…é…å™¨ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯ä½¿ç”¨å®ƒæ¥æ›¿æ¢æˆ‘ä»¬ä¹‹å‰æ‰€ä½¿ç”¨çš„MBeanExporterbean:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:mbean-export</span> <span class="attr">server</span>=<span class="string">&quot;mbeanServer&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œè¦æŠŠä»»æ„ä¸€ä¸ªSpring beanè½¬å˜ä¸ºMBeanï¼Œæˆ‘ä»¬æ‰€éœ€è¦åšçš„ä»…ä»…æ˜¯ä½¿ç”¨@ManagedResourceæ³¨è§£æ ‡æ³¨beanå¹¶ä½¿ç”¨@ManagedOperationæˆ–@ManagedAttributeæ³¨è§£æ ‡æ³¨beançš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ³¨è§£æŠŠSpittleControllerå¯¼å‡ºä¸ºMBeanã€‚</p>
<p>ç¨‹åºæ¸…å•20.1ã€€é€šè¿‡æ³¨è§£æŠŠHomeControllerè½¬å˜ä¸ºMBean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.mvc;<span class="keyword">import</span> java.util.Map;<span class="keyword">import</span> org.springframework.beans,factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.jmx.export.annotation.ManagedAttribute;<span class="keyword">import</span> org.springframework.jmx.export.annotation.ManagedResource;<span class="keyword">import</span> org.springframework.stereotype.Controller;<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<span class="keyword">import</span> com.habuma.spittr.service.SpittrService;<span class="meta">@Controller</span><span class="meta">@ManagedResource(objectName=&quot;spitter:name=SpittleController&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpittleController</span> </span>&#123;  <span class="meta">@ManagedAttribute</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSpittlesPerPage</span><span class="params">(<span class="keyword">int</span> spittlesPerPage)</span> </span>&#123;    <span class="keyword">this</span>.spittlesPerPage = spittlesPerPage;  &#125;    <span class="meta">@ManagedAttribute</span>  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSpittlesPerPage</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> spittlesPerPage;  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ç±»çº§åˆ«ä½¿ç”¨äº†@ManagedResourceæ³¨è§£æ¥æ ‡è¯†è¿™ä¸ªbeanåº”è¯¥è¢«å¯¼å‡ºä¸ºMBeanã€‚objectNameå±æ€§æ ‡è¯†äº†åŸŸï¼ˆSpitterï¼‰å’ŒMBeançš„åç§°ï¼ˆSpittleControllerï¼‰ã€‚<br>spittlesPerPageå±æ€§çš„å­˜å–å™¨æ–¹æ³•éƒ½ä½¿ç”¨äº†@ManagedAttributeæ³¨è§£æ¥è¿›è¡Œæ ‡æ³¨ï¼Œè¿™è¡¨ç¤ºè¯¥å±æ€§åº”è¯¥æš´éœ²ä¸ºMBeançš„æ‰˜ç®¡å±æ€§ã€‚æ³¨æ„ï¼Œå…¶å®å¹¶ä¸éœ€è¦ä½¿ç”¨æ³¨è§£åŒæ—¶æ ‡æ³¨è¿™ä¸¤ä¸ªå­˜å–å™¨æ–¹æ³•ã€‚å¦‚æœæˆ‘ä»¬é€‰æ‹©ä»…æ ‡æ³¨setSpittlesPerPage()æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬ä»å¯ä»¥é€šè¿‡JMXè®¾ç½®è¯¥å±æ€§ï¼Œä½†è¿™æ ·çš„è¯æˆ‘ä»¬å°†ä¸èƒ½æŸ¥çœ‹è¯¥å±æ€§çš„å€¼ã€‚ç›¸åï¼Œå¦‚æœä»…ä»…æ ‡æ³¨getSpittlesPerPage()æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬å¯ä»¥é€šè¿‡JMXæŸ¥çœ‹è¯¥å±æ€§çš„å€¼ï¼Œä½†æ— æ³•ä¿®æ”¹è¯¥å±æ€§çš„å€¼ã€‚</p>
<p>åŒæ ·éœ€è¦æé†’ä¸€ä¸‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨@ManagedOperationæ³¨è§£æ›¿æ¢@ManagedAttributeæ³¨è§£æ¥æ ‡æ³¨å­˜å–å™¨æ–¹æ³•ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ManagedOperationpublic</span> <span class="function"><span class="keyword">void</span> <span class="title">setSpittlesPerPage</span><span class="params">(<span class="keyword">int</span> spittlesPerPage)</span> </span>&#123;  <span class="keyword">this</span>.spittlesPerPage = spittlesPerPage;&#125;<span class="meta">@ManagedOperationpublic</span> <span class="function"><span class="keyword">int</span> <span class="title">getSpittlesPerPage</span><span class="params">()</span> </span>&#123;  <span class="keyword">return</span> spittlesPerPage;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¼šå°†æ–¹æ³•æš´éœ²ä¸ºMBeançš„æ‰˜ç®¡æ“ä½œï¼Œä½†æ˜¯å¹¶ä¸ä¼šæŠŠspittlesPerPageå±æ€§æš´éœ²ä¸ºMBeançš„æ‰˜ç®¡å±æ€§ã€‚è¿™æ˜¯å› ä¸ºåœ¨æš´éœ²MBeanåŠŸèƒ½æ—¶ï¼Œä½¿ç”¨@ManagedOperationæ³¨è§£æ ‡æ³¨æ–¹æ³•æ˜¯ä¸¥æ ¼é™åˆ¶æ–¹æ³•çš„ï¼Œå¹¶ä¸ä¼šæŠŠå®ƒä½œä¸ºJavaBeançš„å­˜å–å™¨æ–¹æ³•ã€‚å› æ­¤ï¼Œä½¿ç”¨@ManagedOperationå¯ä»¥ç”¨æ¥æŠŠbeançš„æ–¹æ³•æš´éœ²ä¸ºMBeanæ‰˜ç®¡æ“ä½œï¼Œè€Œä½¿ç”¨@ManagedAttributeå¯ä»¥æŠŠbeançš„å±æ€§æš´éœ²ä¸ºMBeanæ‰˜ç®¡å±æ€§ã€‚</p>
<h4 id="å¤„ç†MBeanå†²çª"><a href="#å¤„ç†MBeanå†²çª" class="headerlink" title="å¤„ç†MBeanå†²çª"></a>å¤„ç†MBeanå†²çª</h4><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°å¯ä»¥ä½¿ç”¨å¤šç§æ–¹å¼åœ¨MBeanæœåŠ¡å™¨ä¸­æ³¨å†ŒMBeanã€‚åœ¨æ‰€æœ‰çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸ºMBeanæŒ‡å®šçš„å¯¹è±¡åç§°æ˜¯ç”±ç®¡ç†åŸŸåå’Œkey-valueå¯¹ç»„æˆçš„ã€‚å¦‚æœMBeanæœåŠ¡å™¨ä¸­ä¸å­˜åœ¨ä¸æˆ‘ä»¬MBeanåå­—ç›¸åŒçš„å·²æ³¨å†Œçš„MBeanï¼Œé‚£æˆ‘ä»¬çš„MBeanæ³¨å†Œæ—¶å°±ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ã€‚ä½†æ˜¯å¦‚æœåå­—å†²çªæ—¶ï¼Œå°†ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMBeanExporterå°†æŠ›å‡ºInstanceAlreadyExistsExceptionå¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸è¡¨æ˜MBeanæœåŠ¡å™¨ä¸­å·²ç»å­˜åœ¨ç›¸åŒåå­—çš„MBeanã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡MBeanExporterçš„registrationBehaviorNameå±æ€§æˆ–è€…<code>&lt;context:mbean-export&gt;</code>çš„registrationå±æ€§æŒ‡å®šå†²çªå¤„ç†æœºåˆ¶æ¥æ”¹å˜é»˜è®¤è¡Œä¸ºã€‚</p>
<p>Springæä¾›äº†3ç§å€ŸåŠ©registrationBehaviorNameå±æ€§æ¥å¤„ç†MBeanåå­—å†²çªçš„æœºåˆ¶ï¼š</p>
<ul>
<li>FAIL_ON_EXISTINGï¼šå¦‚æœå·²å­˜åœ¨ç›¸åŒåå­—çš„MBeanï¼Œåˆ™å¤±è´¥ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ï¼›</li>
<li>IGNORE_EXISTINGï¼šå¿½ç•¥å†²çªï¼ŒåŒæ—¶ä¹Ÿä¸æ³¨å†Œæ–°çš„MBeanï¼›</li>
<li>REPLACING_EXISTINGï¼šç”¨æ–°çš„MBeanè¦†ç›–å·²å­˜åœ¨çš„MBeanï¼›</li>
</ul>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨MBeanExporterï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®registration-BehaviorNameå±æ€§ä¸ºRegistrationPolicy.IGNORE_EXISTINGæ¥å¿½ç•¥å†²çªï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MBeanExporter <span class="title">mbeanExporter</span><span class="params">(SpittleControiler spittleControiler, MBeanlnfoAssembler assembler)</span> </span>&#123;  MBeanExporter exporter = <span class="keyword">new</span> MBeanExporter();  Map&lt;String, Object&gt; beans = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();  beans.put(<span class="string">&quot;spitter:name=SpittleController&quot;</span>, spittleController);  exporter.setBeans(beans);  exporter.setAssembler(assembler);  exporter.setRegistrationPolicy(RegistrationPolicy.IGNORE_EXISTING);  <span class="keyword">return</span> exporter;&#125;</span><br></pre></td></tr></table></figure>

<p>registrationBehaviorNameå±æ€§å¯ä»¥æ¥å—RegistrationPolicyä¸­æ‰€å®šä¹‰çš„æšä¸¾å€¼ï¼Œæ¯ä¸€ä¸ªå–å€¼åˆ†åˆ«å¯¹åº”3ç§å†²çªå¤„ç†æœºåˆ¶çš„ä¸€ç§ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å·²ä½¿ç”¨MBeanExporteræ³¨å†Œäº†æˆ‘ä»¬çš„MBeanï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ç§æ–¹å¼æ¥è®¿é—®å®ƒä»¬å¹¶è¿›è¡Œç®¡ç†ã€‚æ­£å¦‚ä¹‹å‰æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¸å¦‚JConsoleä¹‹ç±»çš„å·¥å…·æ¥è®¿é—®æœ¬åœ°çš„MBeanæœåŠ¡å™¨ï¼Œè¿›è€Œæ˜¾ç¤ºå’Œæ“çºµMBeanï¼Œä½†æ˜¯åƒJConsoleä¹‹ç±»çš„å·¥å…·å¹¶ä¸é€‚åˆåœ¨ç¨‹åºä¸­å¯¹MBeanè¿›è¡Œç®¡ç†ã€‚æˆ‘ä»¬å¦‚ä½•åœ¨ä¸€ä¸ªåº”ç”¨ä¸­æ“çºµå¦ä¸€ä¸ªåº”ç”¨ä¸­çš„MBeanå‘¢ï¼Ÿå¹¸è¿çš„æ˜¯ï¼Œè¿˜å­˜åœ¨å¦ä¸€ç§æ–¹å¼å¯ä»¥æŠŠMBeanä½œä¸ºè¿œç¨‹å¯¹è±¡è¿›è¡Œè®¿é—®ã€‚è®©æˆ‘ä»¬è¿›ä¸€æ­¥ç ”ç©¶Springå¯¹è¿œç¨‹MBeançš„æ”¯æŒï¼Œäº†è§£å¦‚ä½•é€šè¿‡è¿œç¨‹æ¥å£ä»¥æ ‡<br>å‡†çš„æ–¹å¼æ¥è®¿é—®MBeanã€‚</p>
<h3 id="è¿œç¨‹MBean"><a href="#è¿œç¨‹MBean" class="headerlink" title="è¿œç¨‹MBean"></a>è¿œç¨‹MBean</h3><p>è™½ç„¶æœ€åˆçš„JMXè§„èŒƒæåŠäº†é€šè¿‡MBeanè¿›è¡Œåº”ç”¨çš„è¿œç¨‹ç®¡ç†ï¼Œä½†æ˜¯å®ƒå¹¶æ²¡æœ‰å®šä¹‰å®é™…çš„è¿œç¨‹è®¿é—®åè®®æˆ–APIã€‚å› æ­¤ï¼Œä¼šç”±JMXä¾›åº”å•†å®šä¹‰è‡ªå·±çš„JMXè¿œç¨‹è®¿é—®è§£å†³æ–¹æ¡ˆï¼Œä½†è¿™é€šå¸¸åˆæ˜¯ä¸“æœ‰çš„ã€‚</p>
<p>ä¸ºäº†æ»¡è¶³ä»¥æ ‡å‡†æ–¹å¼è¿›è¡Œè¿œç¨‹è®¿é—®JMXçš„éœ€æ±‚ï¼ŒJCPï¼ˆJava Community Processï¼‰åˆ¶è®¢äº†JSR-160ï¼šJavaç®¡ç†æ‰©å±•è¿œç¨‹è®¿é—®APIè§„èŒƒï¼ˆJava Management Extensions Remote API Specificationï¼‰ã€‚è¯¥è§„èŒƒå®šä¹‰äº†JMXè¿œç¨‹è®¿é—®çš„æ ‡å‡†ï¼Œè¯¥æ ‡å‡†è‡³å°‘éœ€è¦ç»‘å®šRMIå’Œå¯é€‰çš„JMXæ¶ˆæ¯åè®®ï¼ˆJMX Messaging Protocol ï¼ŒJMXMPï¼‰ã€‚</p>
<p>åœ¨æœ¬å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°Springå¦‚ä½•è¿œç¨‹è®¿é—®MBeanã€‚æˆ‘ä»¬é¦–å…ˆä»é…ç½®SpringæŠŠSpittleControllerå¯¼å‡ºä¸ºè¿œç¨‹MBeanå¼€å§‹ï¼Œç„¶åæˆ‘ä»¬å†äº†è§£å¦‚ä½•ä½¿ç”¨Springè¿œç¨‹æ“çºµMBeanã€‚</p>
<h4 id="æš´éœ²è¿œç¨‹MBean"><a href="#æš´éœ²è¿œç¨‹MBean" class="headerlink" title="æš´éœ²è¿œç¨‹MBean"></a>æš´éœ²è¿œç¨‹MBean</h4><p>ä½¿MBeanæˆä¸ºè¿œç¨‹å¯¹è±¡çš„æœ€ç®€å•æ–¹å¼æ˜¯é…ç½®Springçš„ConnectorServerFactoryBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">ConnectorServerFactoryBean <span class="title">connectorServerFactoryBean</span><span class="params">()</span> </span>&#123;  <span class="keyword">return</span> <span class="keyword">new</span> ConnectorServerFactoryBean();&#125;</span><br></pre></td></tr></table></figure>

<p>ConnectorServerFactoryBeanä¼šåˆ›å»ºå’Œå¯åŠ¨JSR-160JMXConnectorServerã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä½¿ç”¨JMXMPåè®®å¹¶ç›‘å¬ç«¯å£9875â€”â€”å› æ­¤ï¼Œå®ƒå°†ç»‘å®šâ€œservice:jmx:jmxmp://localhost:9875â€ã€‚ä½†æ˜¯æˆ‘ä»¬å¯¼å‡ºMBeançš„å¯é€‰æ–¹æ¡ˆå¹¶ä¸å±€é™äºJMXMPã€‚</p>
<p>æ ¹æ®ä¸åŒJMXçš„å®ç°ï¼Œæˆ‘ä»¬æœ‰å¤šç§è¿œç¨‹è®¿é—®åè®®å¯ä¾›é€‰æ‹©ï¼ŒåŒ…æ‹¬è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆRemote Method Invocationï¼ŒRMIï¼‰ã€SOAPã€Hessian/Burlapå’ŒIIOPï¼ˆInternet InterORB Protocolï¼‰ã€‚ä¸ºMBeanç»‘å®šä¸åŒçš„è¿œç¨‹è®¿é—®åè®®ï¼Œæˆ‘ä»¬ä»…éœ€è¦è®¾ç½®ConnectorServerFactoryBeançš„serviceUrlå±æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨RMIè¿œç¨‹è®¿é—®MBeanï¼Œæˆ‘ä»¬å¯ä»¥åƒä¸‹é¢ç¤ºä¾‹è¿™æ ·é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">ConnectorServerFactoryBean <span class="title">connectorServerFactoryBean</span><span class="params">()</span> </span>&#123;  ConnectorServerFactoryBean cafb = <span class="keyword">new</span> ConnectorServerFactoryBean();  cafb.setServiceUrl(<span class="string">&quot;service:jmx:rmi://localhost/jndi/rmi://localhost:1099/spitter&quot;</span>);  <span class="keyword">return</span> cafb;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ConnectorServerFactoryBeanç»‘å®šåˆ°äº†ä¸€ä¸ªRMIæ³¨å†Œè¡¨ï¼Œè¯¥æ³¨å†Œè¡¨ç›‘å¬æœ¬æœºçš„1099ç«¯å£ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦ä¸€ä¸ªRMIæ³¨å†Œè¡¨è¿è¡Œæ—¶ï¼Œå¹¶ç›‘å¬è¯¥ç«¯å£ã€‚æˆ‘ä»¬å¯ä»¥å›é¡¾ä¸‹ç¬¬15ç« ï¼ŒRmiServiceExporterå¯ä»¥ä¸ºæˆ‘ä»¬è‡ªåŠ¨å¯åŠ¨ä¸€ä¸ªRMIæ³¨å†Œè¡¨ã€‚</p>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬åœ¨æœ¬ç¤ºä¾‹ä¸­ä¸ä½¿ç”¨RmiServiceExporterï¼Œè€Œæ˜¯é€šè¿‡åœ¨Springä¸­å£°æ˜RmiRegistryFactoryBeanæ¥å¯åŠ¨ä¸€ä¸ªRMIæ³¨å†Œè¡¨ï¼Œå¦‚ä¸‹é¢çš„@Beanæ–¹æ³•æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">RmiRegistryFactoryBean <span class="title">rmiRegistry</span><span class="params">()</span> </span>&#123;  RmiRegistryFactoryBean rmiRegistryFB = <span class="keyword">new</span> RmiRegistryFactoryBean();  rmiRegistryFB.setPort(<span class="number">1099</span>);  <span class="keyword">return</span> rmiRegistryFB;&#125;</span><br></pre></td></tr></table></figure>

<p>æ²¡é”™ï¼ç°åœ¨æˆ‘ä»¬çš„MBeanå¯ä»¥é€šè¿‡RMIè¿›è¡Œè¿œç¨‹è®¿é—®äº†ã€‚ä½†æ˜¯å¦‚æœæ²¡æœ‰äººé€šè¿‡RMIè®¿é—®MBeançš„è¯ï¼Œé‚£å°±ä¸å€¼å¾—è¿™ä¹ˆåšã€‚æ‰€ä»¥ç°åœ¨è®©æˆ‘ä»¬æŠŠå…³æ³¨ç‚¹è½¬å‘JMXè¿œç¨‹è®¿é—®çš„å®¢æˆ·ç«¯ï¼Œçœ‹çœ‹å¦‚ä½•åœ¨Springä¸­è£…é…ä¸€ä¸ªè¿œç¨‹MBeanåˆ°JMXå®¢æˆ·ç«¯ä¸­ã€‚</p>
<h4 id="è®¿é—®è¿œç¨‹MBean"><a href="#è®¿é—®è¿œç¨‹MBean" class="headerlink" title="è®¿é—®è¿œç¨‹MBean"></a>è®¿é—®è¿œç¨‹MBean</h4><p>è¦æƒ³è®¿é—®è¿œç¨‹MBeanæœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨Springä¸Šä¸‹æ–‡ä¸­é…ç½®MbeanServerConnectionFactoryBeanã€‚ä¸‹é¢çš„beanå£°æ˜è£…é…äº†ä¸€ä¸ªMbeanServerConnection-FactoryBeanï¼Œè¯¥beanç”¨äºè®¿é—®æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­æ‰€åˆ›å»ºçš„åŸºäºRMIçš„è¿œç¨‹æœåŠ¡å™¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MBeanServerConnectionFactoryBean <span class="title">connectionFactoryBean</span><span class="params">()</span> </span>&#123;  MBeanServerConnectionFactoryBean mbscfb = <span class="keyword">new</span> MBeanServerConnectionFactoryBean();  mbscfb.setServiceUrl(<span class="string">&quot;service:jinx:rmi://localhost/jndi/rmi://localhost:1099/spitter&quot;</span>);  <span class="keyword">return</span> mbscfb;&#125;</span><br></pre></td></tr></table></figure>

<p>é¡¾åæ€ä¹‰ï¼ŒMBeanServerConnectionFactoryBeanæ˜¯ä¸€ä¸ªå¯ç”¨äºåˆ›å»ºMbeanServerConnectionçš„å·¥å‚beanã€‚ç”±MBeanServerConnectionFactoryBeanæ‰€ç”Ÿæˆçš„<br>MBeanServerConnectionå®é™…ä¸Šæ˜¯ä½œä¸ºè¿œç¨‹MBeanæœåŠ¡å™¨çš„æœ¬åœ°ä»£ç†ã€‚å®ƒèƒ½å¤Ÿä»¥MBeanServerConnectionçš„å½¢å¼æ³¨å…¥åˆ°å…¶ä»–beançš„å±æ€§ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">JmxClient <span class="title">jmxClient</span><span class="params">(MBeanServerConnection connection)</span> </span>&#123;  JmxClient jmxClient = <span class="keyword">new</span> JmxClient();  jmxClient.setMbeanServerConnection(connection);  <span class="keyword">return</span> jmxClient;&#125;</span><br></pre></td></tr></table></figure>

<p>MBeanServerConnectionæä¾›äº†å¤šç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›æ–¹æ³•æŸ¥è¯¢è¿œç¨‹MBeanæœåŠ¡å™¨å¹¶è°ƒç”¨MBeanæœåŠ¡å™¨å†…æ‰€æ³¨å†Œçš„MBeançš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›çŸ¥é“åœ¨è¿œç¨‹MBeanæœåŠ¡å™¨ä¸­æœ‰å¤šå°‘å·²æ³¨å†Œçš„MBeanï¼Œå¯ä»¥ç”¨å¦‚ä¸‹çš„ä»£ç ç‰‡æ®µæ‰“å°è¿™äº›ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> mbeanCount = mbeanServerConnection.getMBeanCount();System.out.println(<span class="string">&quot;There are &quot;</span> + mbeanCount + <span class="string">&quot; MBeans&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨queryNames()æ–¹æ³•æŸ¥è¯¢è¿œç¨‹æœåŠ¡å™¨ä¸­æ‰€æœ‰MBeançš„åç§°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.util.Set mbeanNames = mbeanServerConnection.queryNames(<span class="keyword">null</span>, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>

<p>ä¼ é€’ç»™queryNames()æ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°ç”¨äºè¿‡æ»¤æŸ¥è¯¢ç»“æœã€‚å¦‚æœå°†ä¸¤ä¸ªå‚æ•°éƒ½è®¾ç½®ä¸ºnullï¼Œè¾“å‡ºç»“æœä¸ºæ‰€æœ‰å·²æ³¨å†Œçš„MBeançš„åç§°ã€‚</p>
<p>æŸ¥è¯¢è¿œç¨‹MBeanæœåŠ¡å™¨ä¸Šbeançš„æ•°é‡å’Œåç§°è™½ç„¶å¾ˆæœ‰è¶£ï¼Œä¸è¿‡å¹¶ä¸èƒ½å®Œæˆæ›´å¤šçš„å·¥ä½œã€‚è¿œç¨‹è®¿é—® MBeanæœåŠ¡å™¨çš„çœŸæ­£ä»·å€¼åœ¨äºè®¿é—®è¿œç¨‹æœåŠ¡å™¨ä¸Šå·²æ³¨å†ŒMBeançš„å±æ€§ä»¥åŠè°ƒç”¨å®ƒä»¬çš„æ–¹æ³•ã€‚</p>
<p>ä¸ºäº†è®¿é—®MBeanå±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨getAttribute()å’ŒsetAttribute()æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œä¸ºäº†è·å–MBeanå±æ€§çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ–¹æ³•è°ƒç”¨getAttribute()æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String cronExpression = mbeanServerConnection.getAttribute(  <span class="keyword">new</span> ObjectName(<span class="string">&quot;spitter:name=SpittleController&quot;</span>), <span class="string">&quot;spittlesPerPage&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨setAttribute()æ–¹æ³•æ”¹å˜MBeanå±æ€§çš„å€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mbeanServerConnection.setAttribute(  <span class="keyword">new</span> ObjectName(<span class="string">&quot;spitter:name=SpittleController&quot;</span>),  <span class="keyword">new</span> Attribute(<span class="string">&quot;spittlesPerPage&quot;</span>, <span class="number">10</span>));</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå¸Œæœ›è°ƒç”¨MBeançš„æ“ä½œï¼Œé‚£æˆ‘ä»¬éœ€è¦ä½¿ç”¨invoke()æ–¹æ³•ã€‚ä¸‹é¢çš„å†…å®¹æè¿°äº†å¦‚ä½•è°ƒç”¨SpittleController MBeançš„setSpittlesPerPage()æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mbeanServerConnection.invoke(  <span class="keyword">new</span> ObjectName(<span class="string">&quot;spitter:name=SpittleController&quot;</span>),  <span class="string">&quot;spittlesPerPage&quot;</span>,  <span class="keyword">new</span> Object[] &#123; <span class="number">100</span> &#125;,  <span class="keyword">new</span> String[] &#123; <span class="string">&quot;int&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨MBeanServerConnectionçš„æ–¹æ³•å¯¹è¿œç¨‹MBeanåšå¾ˆå¤šå…¶ä»–çš„äº‹æƒ…ã€‚æˆ‘æŠŠå®ƒä½œä¸ºä¸€ä¸ªä»»åŠ¡ç•™ç»™ä½ ã€‚ä¸è¿‡ï¼Œé€šè¿‡MBeanServerConnectionå¯¹è¿œç¨‹MBeanè¿›è¡Œæ–¹æ³•è°ƒç”¨å’Œå±æ€§è®¾ç½®æ˜¯ä¸€ç§å¾ˆç¬¨æ‹™çš„æ–¹æ³•ã€‚è¦æƒ³è°ƒç”¨setSpittlesPerPage()è¿™æ ·ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªObjectNameå®ä¾‹ï¼Œå¹¶å‘invoke()<br>æ–¹æ³•ä¼ é€’å‡ ä¸ªå‚æ•°ã€‚å®ƒå¹¶ä¸æ˜¯ç›´è§‚çš„æ–¹æ³•è°ƒç”¨ã€‚ä¸ºäº†æ›´ç›´æ¥åœ°è°ƒç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦ä»£ç†è¿œç¨‹MBeanã€‚</p>
<h4 id="ä»£ç†MBean"><a href="#ä»£ç†MBean" class="headerlink" title="ä»£ç†MBean"></a>ä»£ç†MBean</h4><p>Springçš„MBeanProxyFactoryBeanæ˜¯ä¸€ä¸ªä»£ç†å·¥å‚beanï¼Œåƒæˆ‘ä»¬åœ¨ç¬¬15ç« ä¸­æ‰€æ¼”ç¤ºçš„è¿œç¨‹ä»£ç†å·¥å‚beanç±»ä¼¼ã€‚åœ¨å‰é¢æ‰€ä»‹ç»çš„å†…å®¹ä¸­ï¼Œå®ƒä»¬ä¼šæä¾›ä»£ç†ï¼Œç”¨æ¥è®¿é—®è¿œç¨‹çš„Springå—ç®¡beanï¼Œä¸ä¹‹ä¸åŒï¼ŒMBcanProxyFactoryBeanå¯ä»¥è®©æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—®è¿œç¨‹çš„MBeanï¼ˆå°±å¦‚åŒé…ç½®åœ¨æœ¬åœ°çš„å…¶ä»–beanä¸€æ ·ï¼‰ã€‚å›¾20.4å±•ç¤ºäº†å®ƒçš„å·¥ä½œåŸç†ã€‚</p>
<p><img src="spring-in-action-v4/image-20211114141311487.png" alt="image-20211114141311487"></p>
<p>å›¾20.4ã€€MBeanFactoryBeanåˆ›å»ºè¿œç¨‹MBeançš„ä»£ç†ã€‚å®¢æˆ·ç«¯é€šè¿‡æ­¤ä»£ç†ä¸è¿œç¨‹MBeanè¿›è¡Œäº¤äº’ï¼Œå°±åƒå®ƒæ˜¯æœ¬åœ°Beanä¸€æ ·</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘å¦‚ä¸‹çš„MBeanProxyFactoryBeanå£°æ˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MBeanProxyFactoryBean <span class="title">remoteSpittleControllerMBean</span><span class="params">(    MBeanServerConnection mbeanServerClient)</span> </span>&#123;  MBeanProxyFactoryBean proxy = <span class="keyword">new</span> MBeanProxyFactoryBean();  proxy.setObjectName(<span class="string">&quot;&quot;</span>);  proxy.setServer(mbeanServerClient);  proxy.setProxyInterface(SpittleControllerManagedOperations.claas);  <span class="keyword">return</span> proxy;&#125;</span><br></pre></td></tr></table></figure>

<p>objectNameå±æ€§æŒ‡å®šäº†è¿œç¨‹MBeançš„å¯¹è±¡åç§°ã€‚åœ¨è¿™é‡Œæ˜¯å¼•ç”¨æˆ‘ä»¬ä¹‹å‰å¯¼å‡ºçš„SpittleControllerMBeanã€‚</p>
<p>serverå±æ€§å¼•ç”¨äº†MBeanServerConnectionï¼Œé€šè¿‡å®ƒå®ç°MBeanæ‰€æœ‰é€šä¿¡çš„è·¯ç”±ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ³¨å…¥äº†ä¹‹å‰é…ç½®çš„MBeanServerConnectionFactoryBeanã€‚</p>
<p>æœ€åï¼ŒproxyInterfaceå±æ€§æŒ‡å®šäº†ä»£ç†éœ€è¦å®ç°çš„æ¥å£ã€‚åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨20.1.2å°èŠ‚æ‰€å®šä¹‰çš„SpittleControllerManagedOperationsæ¥å£ã€‚</p>
<p>å¯¹äºä¸Šé¢å£°æ˜çš„remoteSpittleControllerMBeanï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æŠŠå®ƒæ³¨å…¥åˆ°ç±»å‹ä¸ºSpittleControllerManagedOperationsçš„beanå±æ€§ä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥è®¿é—®è¿œç¨‹çš„MBeanã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨setSpittlesPerPage()å’ŒgetSpittlesPerPage()æ–¹æ³•äº†ã€‚</p>
<p>æˆ‘ä»¬å·²ç»çœ‹åˆ°ä¸MBeané€šä¿¡çš„å‡ ç§æ–¹å¼ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨è¿è¡Œçš„æ—¶å€™æ˜¾ç¤ºå’Œè°ƒæ•´Spring beané…ç½®ã€‚ä½†æ˜¯ç›®å‰ä¸ºæ­¢ï¼Œè¿™éƒ½æ˜¯å•æ–¹é¢çš„ä¼šè¯ã€‚éƒ½æ˜¯æˆ‘ä»¬ä¸MBeanåœ¨æ²Ÿé€šã€‚ç°åœ¨æ˜¯æ—¶å€™é€šè¿‡ç›‘å¬é€šçŸ¥ï¼ˆnotificationï¼‰æ¥å€¾å¬å®ƒä»¬åœ¨è¯´ä»€ä¹ˆã€‚</p>
<h3 id="å¤„ç†é€šçŸ¥"><a href="#å¤„ç†é€šçŸ¥" class="headerlink" title="å¤„ç†é€šçŸ¥"></a>å¤„ç†é€šçŸ¥</h3><p>é€šè¿‡æŸ¥è¯¢MBeanè·å¾—ä¿¡æ¯åªæ˜¯æŸ¥çœ‹åº”ç”¨çŠ¶æ€çš„ä¸€ç§æ–¹æ³•ã€‚ä½†å½“åº”ç”¨å‘ç”Ÿé‡è¦äº‹ä»¶æ—¶ï¼Œå¦‚æœå¸Œæœ›èƒ½å¤ŸåŠæ—¶å‘ŠçŸ¥æˆ‘ä»¬ï¼Œè¿™é€šå¸¸ä¸æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå‡è®¾Spittråº”ç”¨ä¿å­˜äº†å·²å‘å¸ƒçš„Spittleæ•°é‡ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›çŸ¥é“æ¯å‘å¸ƒä¸€ç™¾ä¸‡Spittleæ—¶çš„ç²¾ç¡®æ—¶é—´ï¼ˆä¾‹å¦‚ä¸€ç™¾ä¸‡ã€ä¸¤ç™¾ä¸‡ã€ä¸‰ç™¾ä¸‡ç­‰ï¼‰ã€‚ä¸€ç§è§£å†³æ–¹æ³•æ˜¯ç¼–å†™ä»£ç å®šæœŸæŸ¥è¯¢æ•°æ®åº“ï¼Œè®¡ç®—Spittleçš„æ•°é‡ã€‚ä½†æ˜¯æ‰§è¡Œè¿™ç§æŸ¥è¯¢ä¼šè®©åº”ç”¨å’Œæ•°æ®åº“éƒ½å¾ˆç¹å¿™ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸æ–­çš„æ£€æŸ¥Spittleçš„æ•°é‡ã€‚</p>
<p>ä¸é‡å¤æŸ¥è¯¢æ•°æ®åº“è·å¾—Spittleçš„æ•°é‡ç›¸æ¯”ï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯å½“è¿™ç±»äº‹ä»¶å‘ç”Ÿæ—¶è®©MBeané€šçŸ¥æˆ‘ä»¬ã€‚JMXé€šçŸ¥ï¼ˆJMX notificationï¼Œå¦‚å›¾20.5 æ‰€ç¤ºï¼‰æ˜¯MBeanä¸å¤–éƒ¨ä¸–ç•Œä¸»åŠ¨é€šä¿¡çš„ä¸€ç§æ–¹æ³•ï¼Œè€Œä¸æ˜¯ç­‰å¾…å¤–éƒ¨åº”ç”¨å¯¹MBeanè¿›è¡ŒæŸ¥è¯¢ä»¥è·å¾—ä¿¡æ¯ã€‚</p>
<p><img src="spring-in-action-v4/image-20211114141511375.png" alt="image-20211114141511375"><br>å›¾20.5ã€€JMXé€šçŸ¥ä½¿MBeanä¸å¤–éƒ¨ä¸–ç•Œè¿›è¡Œä¸»åŠ¨é€šä¿¡</p>
<p>Springé€šè¿‡NotificationPublisherAwareæ¥å£æä¾›äº†å‘é€é€šçŸ¥çš„æ”¯æŒã€‚ä»»ä½•å¸Œæœ›å‘é€é€šçŸ¥çš„MBeanéƒ½å¿…é¡»å®ç°è¿™ä¸ªæ¥å£ã€‚ä¾‹å¦‚ï¼Œè¯·æŸ¥çœ‹å¦‚ä¸‹ç¨‹åºæ¸…å•ä¸­çš„SpittleNotifierImplã€‚</p>
<p>ç¨‹åºæ¸…å•20.2ã€€ä½¿ç”¨NotificationPublisheræ¥å‘é€JMXé€šçŸ¥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.jmx;<span class="keyword">import</span> javax.management.Notification;<span class="keyword">import</span> org.springframework.jmx.export.annotation.ManagedNotification;<span class="keyword">import</span> org.springframework.jmx.export.annotation.ManagedResource;<span class="keyword">import</span> org.springframework.jmx.export.notification.NotificationPublisher;<span class="keyword">import</span> org.springframework.jmx.export.notification.NotificationPublisherAware;<span class="keyword">import</span> org.springframework.stereotype.Component;<span class="meta">@Component</span><span class="meta">@ManagedResource</span> (<span class="string">&quot;spitter:name=SpitterNotifier&quot;</span>)<span class="meta">@ManagedNotification(notificationTypes=&quot;SpittleNotifier.OneMillionSpitties&quot;, name=&quot;TODO&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpittleNotifierlmpl</span> <span class="keyword">implements</span> <span class="title">NotificationPublisherAware</span>, <span class="title">SpittleNotifier</span> </span>&#123;  NotificationPublisher notificationPublisher;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNotificationPublisher</span><span class="params">(NotificationPublisher notificationPublisher)</span> </span>&#123;    <span class="keyword">this</span>.notificationPublisher = notificationPublisher;  &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">millionthSpittlePosted</span><span class="params">()</span> </span>&#123;    notificationPublisher.sendNotification(      <span class="keyword">new</span> Notification(<span class="string">&quot;SpittleNotifier.OneMillionSpitties&quot;</span>, <span class="keyword">this</span>, <span class="number">0</span>));  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼ŒSpittleNotifierImplå®ç°äº†NotificationPublisherAwareæ¥å£ã€‚è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªè¦æ±‚è‹›åˆ»çš„æ¥å£ï¼Œå®ƒä»…è¦æ±‚å®ç°ä¸€ä¸ªæ–¹æ³•ï¼šsetNotificationPublisherã€‚</p>
<p>SpittleNotificationImplä¹Ÿå®ç°äº†SpittleNotifieræ¥å£çš„æ–¹æ³•ï¼šmillionthSpittlePosted()ã€‚è¿™ä¸ªæ–¹æ³•ä½¿ç”¨äº†setNotificationPublisher()æ–¹æ³•æ‰€æ³¨å…¥çš„<br>NotificationPublisheræ¥å‘é€é€šçŸ¥ï¼šæˆ‘ä»¬çš„Spittleæ•°é‡åˆåˆ°äº†ä¸€ä¸ªæ–°çš„ç™¾ä¸‡çº§åˆ«ã€‚</p>
<p>ä¸€æ—¦sendNotification()æ–¹æ³•è¢«è°ƒç”¨ï¼Œå°±ä¼šå‘å‡ºé€šçŸ¥ã€‚å—¯â€¦â€¦å¥½åƒæˆ‘ä»¬è¿˜æ²¡å†³å®šè°æ¥æ¥æ”¶è¿™ä¸ªé€šçŸ¥ã€‚é‚£å°±è®©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªé€šçŸ¥ç›‘å¬å™¨æ¥ç›‘å¬å’Œå¤„ç†é€šçŸ¥ã€‚</p>
<h4 id="ç›‘å¬é€šçŸ¥"><a href="#ç›‘å¬é€šçŸ¥" class="headerlink" title="ç›‘å¬é€šçŸ¥"></a>ç›‘å¬é€šçŸ¥</h4><p>æ¥æ”¶MBeané€šçŸ¥çš„æ ‡å‡†æ–¹æ³•æ˜¯å®ç°javax.management.NotificationListeneræ¥å£ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸‹PagingNotificationListenerï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.jmx;<span class="keyword">import</span> javax.management.Notification;<span class="keyword">import</span> javax.management.NotificationListener;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PagingNotificationListener</span> <span class="keyword">implements</span> <span class="title">NotificationListener</span> </span>&#123;  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleNotification</span><span class="params">(Notification notification, Object handback)</span> </span>&#123;    <span class="comment">// ...  &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>PagingNotificationListeneræ˜¯ä¸€ä¸ªå…¸å‹çš„JMXé€šçŸ¥ç›‘å¬å™¨ã€‚å½“æ¥æ”¶åˆ°é€šçŸ¥æ—¶ï¼Œå°†ä¼šè°ƒç”¨handleNotification()æ–¹æ³•å¤„ç†é€šçŸ¥ã€‚å¤§æ¦‚çš„é€»è¾‘å¯èƒ½æ˜¯ï¼ŒPagingNotificationListenerçš„handleNotification()æ–¹æ³•å°†å‘å¯»å‘¼æœºæˆ–æ‰‹æœºä¸Šå‘é€æ¶ˆæ¯æ¥å‘ŠçŸ¥Spittleæ•°é‡åˆåˆ°äº†ä¸€ä¸ªæ–°çš„ç™¾ä¸‡çº§åˆ«ï¼ˆæˆ‘æŠŠå®é™…çš„å®ç°ç•™ç»™è¯»è€…è‡ªå·±<br>å®Œæˆ)ã€‚</p>
<p>å‰©ä¸‹çš„å·¥ä½œåªéœ€è¦ä½¿ç”¨MBeanExporteræ³¨å†ŒPagingNotificationListenerï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">MBeanExporter <span class="title">mbeanExporter</span><span class="params">()</span> </span>&#123;  MBeanExporter exporter = <span class="keyword">new</span> MBeanExporter();  Map&lt;?, NotificationListener&gt; mappings = <span class="keyword">new</span> HashMap&lt;?, NotificationListener&gt;();  mappings.put(<span class="string">&quot;Spitter:name=PagingNotificationListener&quot;</span>, <span class="keyword">new</span> PagingNotificationListener());  exporter.setNotificationListenerMappings(mappings);  <span class="keyword">return</span> exporter;&#125;</span><br></pre></td></tr></table></figure>

<p>MBeanExporterçš„notificationListenerMappingså±æ€§ç”¨äºåœ¨ç›‘å¬å™¨å’Œç›‘å¬å™¨æ‰€å¸Œæœ›ç›‘å¬çš„MBeanä¹‹é—´å»ºç«‹æ˜ å°„ã€‚åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å»ºç«‹äº†PagingNotificationListeneræ¥ç›‘å¬ç”±SpittleNotifier MBeanæ‰€å‘å¸ƒçš„é€šçŸ¥ã€‚</p>
<h3 id="å°ç»“-19"><a href="#å°ç»“-19" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>JMXæ˜¯å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œæ“çºµçš„ä¸€æ‰‡çª—å£ã€‚åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬äº†è§£äº†å¦‚ä½•é…ç½®Springè‡ªåŠ¨åœ°æŠŠSpring beanå¯¼å‡ºä¸ºJMX MBeanï¼Œä»è€Œå¯ä»¥è®©æˆ‘ä»¬é€šè¿‡JMXç®¡ç†å·¥å…·æŸ¥çœ‹å’Œæ“ä½œbeançš„ä¿¡æ¯ã€‚æˆ‘ä»¬ä¹Ÿäº†è§£äº†å½“MBeanå’Œå·¥å…·å½¼æ­¤è·ç¦»å¾ˆè¿œæ—¶ï¼Œå¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨è¿œç¨‹MBeanã€‚æœ€åï¼Œæˆ‘ä»¬è¿˜äº†è§£äº†å¦‚ä½•ä½¿ç”¨Springå‘å¸ƒå’Œç›‘å¬JMXé€šçŸ¥ã€‚</p>
<p>ç°åœ¨ä½ æˆ–è®¸æ³¨æ„åˆ°è¿™æœ¬ä¹¦å‰©ä½™çš„é¡µæ•°è¶Šæ¥è¶Šå°‘ï¼Œæˆ‘ä»¬çš„Springä¹‹æ—…å³å°†ç»“æŸã€‚ä½†æ˜¯åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬æ²¿é€”è¿˜ä¼šç»åœä¸€ç«™ã€‚åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹ä¸€ä¸‹Spring Bootï¼Œè¿™æ˜¯å¼€å‘Springåº”ç”¨çš„ä¸€ç§æ–°æ–¹æ³•ï¼Œå€ŸåŠ©è¿™ç§ä»¤äººæ¿€åŠ¨çš„æ–°æ–¹æ³•æˆ‘ä»¬å¯ä»¥åªä¿ç•™å¾ˆå°‘çš„æ˜¾å¼é…ç½®ï¼Œç”šè‡³å¯èƒ½å®Œå…¨æ²¡æœ‰é…ç½®ã€‚</p>
<h2 id="å€ŸåŠ©-Spring-Boot-ç®€åŒ–-Spring-å¼€å‘"><a href="#å€ŸåŠ©-Spring-Boot-ç®€åŒ–-Spring-å¼€å‘" class="headerlink" title="å€ŸåŠ© Spring Boot ç®€åŒ– Spring å¼€å‘"></a>å€ŸåŠ© Spring Boot ç®€åŒ– Spring å¼€å‘</h2><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>ä½¿ç”¨ Spring Boot Starter æ·»åŠ é¡¹ç›®ä¾èµ–</li>
<li>è‡ªåŠ¨åŒ–çš„ bean é…ç½®</li>
<li>Groovy ä¸ Spring Boot CLI</li>
<li>Spring Boot Actuator</li>
</ul>
<p>åœ¨æˆ‘åˆšå¼€å§‹å­¦ä¹ å¾®ç§¯åˆ†è¯¾ç¨‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å‡½æ•°çš„å¯¼æ•°ã€‚å½“æ—¶æˆ‘ä»¬ä½¿ç”¨éå¸¸å¤æ‚çš„æé™æ¥è®¡ç®—å‡½æ•°çš„å¯¼æ•°ã€‚å³ä¾¿å‡½æ•°éå¸¸ç®€å•ï¼Œè®¡ç®—å¯¼æ•°ç›¸å…³çš„å·¥ä½œä¾ç„¶åƒå™©æ¢¦ä¸€æ ·ã€‚</p>
<p>åœ¨å¸ƒç½®å®Œä½œä¸šã€å»ºç«‹å®Œå­¦ä¹ å°ç»„å¹¶è€ƒå®Œè¯•åï¼Œç­ä¸Šçš„å¤§å¤šæ•°åŒå­¦éƒ½èƒ½å¤Ÿå®Œæˆè¿™é¡¹ä»»åŠ¡äº†ã€‚ä½†æ˜¯å®ƒçš„å•è°ƒæ— è¶£ä¾ç„¶è®©æˆ‘ä»¬æ— æ³•å¿å—ã€‚å¦‚æœâ€œå¾®ç§¯åˆ†ï¼ˆä¸Šï¼‰â€çš„è¯¾ç¨‹å°±è¿™æ ·çš„è¯ï¼Œé‚£åœ¨â€œå¾®ç§¯åˆ†ï¼ˆä¸‹ï¼‰â€ä¸­ï¼Œåˆè¯¥æœ‰æ€æ ·ææ€–çš„æ•°å­¦è®¡ç®—åœ¨ç­‰ç€æˆ‘ä»¬å‘¢ï¼Ÿ</p>
<p>ç„¶åï¼Œè€å¸ˆç»™æˆ‘ä»¬å¼€äº†ä¸€ä¸ªç©ç¬‘ã€‚é€šè¿‡ä½¿ç”¨ä¸€ä¸ªç®€å•çš„å…¬å¼å°±èƒ½å¿«é€Ÿå°†å¯¼æ•°è®¡ç®—å‡ºæ¥ï¼ˆå¦‚æœä½ å­¦ä¹ è¿‡å¾®ç§¯åˆ†çš„è¯ï¼Œä½ åº”è¯¥èƒ½å¤Ÿæ˜ç™½æˆ‘è¯´çš„æ˜¯ä»€ä¹ˆï¼‰ã€‚é€šè¿‡è¿™ç§æ–°æŠ€å·§ï¼Œåœ¨ä»¥å‰è®¡ç®—ä¸€ä¸ªå‡½æ•°å¯¼æ•°çš„æ—¶é—´å†…ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè®¡ç®—å‡ºåå¤šä¸ªå‡½æ•°çš„å¯¼æ•°ã€‚</p>
<p>æ­¤æ—¶ï¼Œä¸€ä½åŒå­¦å‘è€å¸ˆæå‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ¯ä½åŒå­¦æ‰€æƒ³çš„ï¼šâ€œæ‚¨ä¸ºä»€ä¹ˆä¸åœ¨ç¬¬ä¸€å¤©å°±æ•™ä¼šæˆ‘ä»¬è¿™ä¸ªå…¬å¼å‘¢ï¼Ÿï¼â€</p>
<p>è€å¸ˆè¿™æ ·è§£é‡Šï¼Œæ¯”è¾ƒå›°éš¾çš„é‚£ç§æ–¹æ³•èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ç†è§£å¯¼æ•°çš„å«ä¹‰ã€å‘Šè¯‰æˆ‘ä»¬å®ƒçš„ç‰¹æ€§ï¼Œå¹¶è¯´è¿™ç§æ–¹å¼å¯¹æˆ‘ä»¬æœ‰è¿™æ ·é‚£æ ·çš„å¥½å¤„ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬ç”¨æ•´æœ¬ä¹¦çš„ç¯‡å¹…ä»‹ç»äº† Springï¼Œæˆ‘å‘ç°è‡ªå·±å¤„åœ¨ç±»ä¼¼äºå¾®ç§¯åˆ†è€å¸ˆé‚£æ ·çš„ä½ç½®ã€‚å°½ç®¡ Spring å¸¦æ¥çš„ä¸»è¦ç›Šå¤„å°±æ˜¯ç®€åŒ– Java å¼€å‘ï¼Œä½†æœ¬ç« å°†ä¼šä»‹ç» Spring Boot å¦‚ä½•è®©è¿™é¡¹ä»»åŠ¡å˜å¾—æ›´åŠ ç®€å•ã€‚ä» Spring åˆ›å»ºä»¥æ¥ï¼ŒSpring Boot å¤§æ¦‚æ˜¯ Spring é¢†åŸŸä¸­æœ€ä»¤äººå…´å¥‹çš„äº‹æƒ…äº†ã€‚å®ƒåœ¨ Spring ä¹‹ä¸Šï¼Œæ„å»ºäº†å…¨æ–°çš„å¼€å‘æ¨¡å‹ï¼Œç§»é™¤äº†å¼€å‘ Spring åº”ç”¨ä¸­å¾ˆå¤šå•è°ƒä¹å‘³çš„å†…å®¹ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆæ•´ä½“ä¸Šäº†è§£ä¸€ä¸‹ Spring Bootï¼Œçœ‹å®ƒæ˜¯å¦‚ä½•ç®€åŒ– Spring çš„ã€‚åœ¨æœ¬ç« ç»“æŸä¹‹å‰ï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨ Spring Boot æ„å»ºä¸€ä¸ªå®Œæ•´çš„ï¼ˆå°½ç®¡æ¯”è¾ƒç®€å•ï¼‰åº”ç”¨ç¨‹åºã€‚</p>
<h3 id="Spring-Boot-ç®€ä»‹"><a href="#Spring-Boot-ç®€ä»‹" class="headerlink" title="Spring Boot ç®€ä»‹"></a>Spring Boot ç®€ä»‹</h3><p>åœ¨ Spring å®¶æ—ä¸­ï¼ŒSpring Boot æ˜¯ä»¤äººå…´å¥‹ï¼ˆä¹Ÿè®¸æˆ‘æ•¢è¯´å®ƒæ˜¯æ”¹å˜æ¸¸æˆè§„åˆ™çš„ï¼‰çš„æ–°é¡¹ç›®ã€‚å®ƒæä¾›äº†å››ä¸ªä¸»è¦çš„ç‰¹æ€§ï¼Œèƒ½å¤Ÿæ”¹å˜å¼€å‘ Spring åº”ç”¨ç¨‹åºçš„æ–¹å¼ï¼š</p>
<ul>
<li>Spring Boot Starterï¼šå®ƒå°†å¸¸ç”¨çš„ä¾èµ–åˆ†ç»„è¿›è¡Œäº†æ•´åˆï¼Œå°†å…¶åˆå¹¶åˆ°ä¸€ä¸ªä¾èµ–ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥ä¸€æ¬¡æ€§æ·»åŠ åˆ°é¡¹ç›®çš„ Maven æˆ– Gradle æ„å»ºä¸­ï¼›</li>
<li>è‡ªåŠ¨é…ç½®ï¼šSpring Boot çš„è‡ªåŠ¨é…ç½®ç‰¹æ€§åˆ©ç”¨äº† Spring 4 å¯¹æ¡ä»¶åŒ–é…ç½®çš„æ”¯æŒï¼Œåˆç†åœ°æ¨æµ‹åº”ç”¨æ‰€éœ€çš„ bean å¹¶è‡ªåŠ¨åŒ–é…ç½®å®ƒä»¬ï¼›</li>
<li>å‘½ä»¤è¡Œæ¥å£ï¼ˆCommand-line interfaceï¼ŒCLIï¼‰ï¼šSpring Boot çš„ CLI å‘æŒ¥äº† Groovy ç¼–ç¨‹è¯­è¨€çš„ä¼˜åŠ¿ï¼Œå¹¶ç»“åˆè‡ªåŠ¨é…ç½®è¿›ä¸€æ­¥ç®€åŒ– Spring åº”ç”¨çš„å¼€å‘ï¼›</li>
<li>Actuatorï¼šå®ƒä¸º Spring Boot åº”ç”¨æ·»åŠ äº†ä¸€å®šçš„ç®¡ç†ç‰¹æ€§ã€‚</li>
</ul>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨ Spring Boot çš„æ‰€æœ‰ç‰¹æ€§æ„å»ºä¸€ä¸ªå°å‹çš„åº”ç”¨ç¨‹åºã€‚ä½†é¦–å…ˆï¼Œæˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€ä¸‹æ¯é¡¹ç‰¹æ€§ï¼Œæ›´å¥½åœ°ä½“éªŒå®ƒä»¬å¦‚ä½•ç®€åŒ– Spring ç¼–ç¨‹æ¨¡å‹ã€‚</p>
<h4 id="æ·»åŠ -Starter-ä¾èµ–"><a href="#æ·»åŠ -Starter-ä¾èµ–" class="headerlink" title="æ·»åŠ  Starter ä¾èµ–"></a>æ·»åŠ  Starter ä¾èµ–</h4><p>æœ‰ä¸¤ç§çƒ¤åˆ¶è›‹ç³•çš„æ–¹å¼ï¼Œæœ‰çƒ­æƒ…çš„äººä¼šå°†é¢ç²‰ã€é¸¡è›‹ã€ç³–ã€å‘é…µç²‰ã€ç›ã€å¥¶æ²¹ã€é¦™è‰è°ƒæ–™ä»¥åŠç‰›å¥¶æ··åˆåœ¨ä¸€èµ·ï¼Œå’Œæˆç³ŠçŠ¶ã€‚æˆ–è€…ä¹Ÿå¯ä»¥è´­ä¹°é¢„å…ˆæ‰“åŒ…å¥½çš„è›‹ç³•ï¼Œå®ƒåŒ…å«äº†æ‰€éœ€çš„å¤§éƒ¨åˆ†åŸæ–™ï¼Œæˆ‘ä»¬åªéœ€æ·»åŠ ä¸€äº›å«æ°´åˆ†çš„ææ–™å³å¯ï¼Œå¦‚æ°´ã€é¸¡è›‹å’Œæ¤ç‰©æ²¹ã€‚</p>
<p>é¢„å…ˆæ‰“åŒ…å¥½çš„è›‹ç³•å°†åˆ¶ä½œè›‹ç³•è¿‡ç¨‹ä¸­æ‰€éœ€çš„å„ç§ææ–™é›†åˆåœ¨äº†ä¸€èµ·ï¼Œä½œä¸ºä¸€é¡¹ææ–™æ¥ä½¿ç”¨ï¼Œä¸ä¹‹ç±»ä¼¼ï¼ŒSpring Boot Starterå°†åº”ç”¨æ‰€éœ€çš„å„ç§ä¾èµ–èšåˆæˆä¸€é¡¹ä¾èµ–ã€‚</p>
<p>ä¸ºäº†é˜è¿°è¯¥åŠŸèƒ½ï¼Œå‡è®¾æˆ‘ä»¬è¦ä»å¤´å¼€å§‹ç¼–å†™ä¸€ä¸ªæ–°çš„ Spring åº”ç”¨ã€‚è¿™æ˜¯ä¸€ä¸ª Web é¡¹ç›®ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ Spring MVCã€‚åŒæ—¶ï¼Œè¿˜è¦æœ‰ REST API å°†èµ„æºæš´éœ²ä¸º JSONï¼Œæ‰€ä»¥åœ¨æ„å»ºä¸­éœ€è¦åŒ…å« Jackson JSON åº“ã€‚</p>
<p>å› ä¸ºåº”ç”¨éœ€è¦ä½¿ç”¨ JDBC ä»å…³ç³»å‹æ•°æ®åº“ä¸­å­˜å‚¨å’ŒæŸ¥è¯¢æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬å¸Œæœ›ç¡®ä¿åŒ…å«äº† Spring çš„ JDBC æ¨¡å—ï¼ˆä¸ºäº†ä½¿ç”¨ JdbcTemplateï¼‰å’Œ Spring çš„äº‹åŠ¡æ¨¡å—ï¼ˆä¸ºäº†ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡çš„æ”¯æŒï¼‰ã€‚å¯¹äºæ•°æ®åº“æœ¬èº«ï¼ŒH2 æ•°æ®åº“æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p>
<p>å¯¹äº†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨ Thymeleaf æ¥å»ºç«‹ Spring MVC è§†å›¾ã€‚</p>
<p>å¦‚æœä½¿ç”¨ Gradle æ„å»ºé¡¹ç›®çš„è¯ï¼Œåœ¨ build.gradle ä¸­ï¼ˆè‡³å°‘ï¼‰éœ€è¦åŒ…å«å¦‚ä¸‹çš„ä¾èµ–ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">dependencies</span> &#123;  <span class="string">compile(&quot;org.springframework:spring-web:4.0.6.RELEASE&quot;)</span>  <span class="string">compile(&quot;org.springframework:spring-webmvc:4.0.6.RELEASE&quot;)</span>  <span class="string">compile(&quot;com.fasterxml.jackson.core:jackson-databind:2.2.2&quot;)</span>  <span class="string">compile(&quot;org.springframework:spring-jdbc:4.0.6.RELEASE&quot;)</span>  <span class="string">compile(&quot;org.springframework:spring-tx:4.0.6.RELEASE&quot;)</span>  <span class="string">compile</span> <span class="string">(&quot;com.h2database:h2:1.3.174&quot;)</span>  <span class="string">compile(&quot;org.thymeleaf:thymeleaf-spring4:2.1.2.RELEASE&quot;)</span>&#125;</span><br></pre></td></tr></table></figure>

<p>å¹¸å¥½ï¼ŒGradle èƒ½å¤Ÿéå¸¸ç®€æ´åœ°è¡¨è¾¾ä¾èµ–ã€‚ï¼ˆä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä¸å†å±•ç°è¿™ä¸ªä¾èµ–åˆ—è¡¨åœ¨ Maven çš„ pom.xml æ–‡ä»¶æ˜¯ä»€ä¹ˆæ ·å­äº†ã€‚ï¼‰å³ä¾¿å¦‚æ­¤ï¼Œåˆ›å»ºè¿™ä¸ªæ–‡ä»¶è¿˜æ˜¯ç‰µæ‰¯åˆ°è®¸å¤šçš„äº‹æƒ…ï¼Œè€Œå¯¹å®ƒçš„ç»´æŠ¤åˆ™ä¼šæ›´åŠ éº»çƒ¦ã€‚è¿™äº›ä¾èµ–ä¹‹é—´æ˜¯å¦‚ä½•åä½œçš„å‘¢ï¼Ÿå½“åº”ç”¨ç¨‹åºä¸æ–­åœ°æˆé•¿å’Œæ¼”è¿›ï¼Œä¾èµ–ç®¡ç†å°†ä¼šå˜å¾—æ›´åŠ å…·æœ‰æŒ‘æˆ˜æ€§ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ Spring Boot Starer æ‰€æä¾›çš„é¢„æ‰“åŒ…ä¾èµ–çš„è¯ï¼Œé‚£ä¹ˆ Gradle ä¾èµ–åˆ—è¡¨èƒ½å¤Ÿæ›´åŠ ç®€çŸ­ä¸€äº›ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;  compile(<span class="string">&quot;org.springframework.boot:spring-boot-starter-web:1.1.4.RELEASE&quot;</span>)  compile(<span class="string">&quot;org.springframework.boot:spring-boot-starter-jdbc:1.1.4.RELEASE&quot;</span>)  compile (<span class="string">&quot;com.h2database:h2:1.3.174&quot;</span>)  compile(<span class="string">&quot;org.thymeleaf:thymeleaf-spring4:2.1.2.RELEASE&quot;</span>)&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒSpring Boot çš„ Web å’Œ JDBC Starter å–ä»£äº†å‡ ä¸ªæ›´åŠ ç»†ç²’åº¦çš„ä¾èµ–ã€‚æˆ‘ä»¬ä¾ç„¶è¿˜éœ€è¦åŒ…å« H2 å’Œ Thymeleaf çš„ä¾èµ–ï¼Œä¸è¿‡å…¶ä»–çš„ä¾èµ–éƒ½å·²ç»æ”¾åˆ°äº†Starter ä¸­ã€‚é™¤äº†ä¾èµ–åˆ—è¡¨æ›´åŠ ç®€çŸ­ï¼Œæˆ‘ä»¬å¯ä»¥ç›¸ä¿¡ç”± Starter æ‰€æä¾›çš„ä¾èµ–ç‰ˆæœ¬èƒ½å¤Ÿäº’ç›¸å…¼å®¹ã€‚</p>
<p>Spring Boot æä¾›äº†å¤šä¸ª Starterï¼ŒWeb å’Œ JDBC åªæ˜¯å…¶ä¸­çš„ä¸¤ä¸ªã€‚è¡¨ 21.1 åˆ—å‡ºäº†æˆ‘åœ¨ç¼–å†™æœ¬ç« æ—¶ï¼Œæ‰€æœ‰å¯ç”¨çš„ Starterã€‚</p>
<center>è¡¨ 21.1ã€€Spring Boot Starter ä¾èµ–å°†æ‰€éœ€çš„å¸¸è§ä¾èµ–æŒ‰ç»„èšé›†åœ¨ä¸€èµ·ï¼Œå½¢æˆå•æ¡ä¾èµ–</center>

<table>
<thead>
<tr>
<th>Starter</th>
<th>æ‰€æä¾›çš„ä¾èµ–</th>
</tr>
</thead>
<tbody><tr>
<td>spring-boot-starter-actuator</td>
<td>spring-boot-starter ã€spring-boot-actuator ã€spring-core</td>
</tr>
<tr>
<td>spring-boot-starter-amqp</td>
<td>spring-boot-starter ã€spring-boot-rabbit ã€spring-core ã€spring-tx</td>
</tr>
<tr>
<td>spring-boot-starter-aop</td>
<td>spring-boot-starter ã€spring-aop ã€AspectJ Runtime ã€AspectJ Weaver ã€spring-core</td>
</tr>
<tr>
<td>spring-boot-starter-batch</td>
<td>spring-boot-starter ã€HSQLDB ã€spring-jdbc ã€spring-batch-coreã€spring-core</td>
</tr>
<tr>
<td>spring-boot-starter-elasticsearch</td>
<td>spring-boot-starterã€ spring-data-elasticsearchã€ springcoreã€ spring-tx</td>
</tr>
<tr>
<td>spring-boot-starter-gemfire</td>
<td>spring-boot-starterã€ Gemfireã€ spring-coreã€ spring-txã€spring-contextã€ spring-context-supportã€ spring-data-gemfire</td>
</tr>
<tr>
<td>spring-boot-starter-datajpa</td>
<td>spring-boot-starterã€ spring-boot-starter-jdbcã€ spring-bootstarter-aopã€ spring-coreã€ Hibernate EntityManagerã€ springormã€ spring-data-jpaã€ spring-aspects</td>
</tr>
<tr>
<td>spring-boot-starter-datamongodb</td>
<td>spring-boot-starterã€ MongoDB Java é©±åŠ¨ ã€ spring-coreã€spring-txã€ spring-data-mongodb</td>
</tr>
<tr>
<td>spring-boot-starter-datarest</td>
<td>spring-boot-starterã€ spring-boot-starter-webã€ Jackson æ³¨è§£ã€ Jackson æ•°æ®ç»‘å®š ã€ spring-coreã€ spring-txã€ spring-datarest-webmvc</td>
</tr>
<tr>
<td>spring-boot-starter-datasolr</td>
<td>spring-boot-starterã€ Solrjã€ spring-coreã€ spring-txã€spring-data-solrã€ Apache HTTP Mime</td>
</tr>
<tr>
<td>spring-boot-starter-freemarker</td>
<td>spring-boot-starterã€ spring-boot-starter-webã€ Freemarkerã€spring-coreã€ spring-context-support</td>
</tr>
<tr>
<td>spring-boot-starter-groovy-templates</td>
<td>spring-boot-starterã€ spring-boot-starter-webã€ Groovyã€Groovy æ¨¡æ¿ã€spring-core</td>
</tr>
<tr>
<td>spring-boot-starter-hornetq</td>
<td>spring-boot-starterã€ spring-coreã€ spring-jmsã€ Hornet JMS Client</td>
</tr>
<tr>
<td>spring-boot-starter-integration</td>
<td>spring-boot-starterã€ spring-aopã€ spring-txã€ spring-webã€spring-webmvcã€ spring-integration-coreã€ spring-integrationfileã€ spring-integration-httpã€ spring-integration-ipã€spring-integration-stream</td>
</tr>
<tr>
<td>spring-boot-starter-jdbc</td>
<td>spring-boot-starterã€ spring-jdbc ã€tomcat-jdbcã€ spring-tx</td>
</tr>
<tr>
<td>spring-boot-starter-jetty</td>
<td>jetty-webappã€ jetty-jsp</td>
</tr>
<tr>
<td>spring-boot-starter-log4j</td>
<td>jcl-over-slf4jã€ jul-to-slf4j ã€slf4j-log4j12ã€log4j</td>
</tr>
<tr>
<td>spring-boot-starter-logging</td>
<td>jcl-over-slf4jã€ jul-to-slf4j ã€log4j-over-slf4jã€ logbackclassic</td>
</tr>
<tr>
<td>spring-boot-starter-mobile</td>
<td>spring-boot-starterã€ spring-boot-starter-webã€ spring-mobiledevice</td>
</tr>
<tr>
<td>spring-boot-starter-redis</td>
<td>spring-boot-starterã€ spring-data-redisã€ lettuce</td>
</tr>
<tr>
<td>spring-boot-starter-remote-shell</td>
<td>spring-boot-starter-actuatorã€ spring-contextã€ org.crashub.**</td>
</tr>
<tr>
<td>spring-boot-starter-security</td>
<td>spring-boot-starterã€ spring-security-configã€ springsecurity-webã€ spring-aopã€ spring-beansã€ spring-contextã€spring-coreã€ spring-expressionã€ spring-web</td>
</tr>
<tr>
<td>spring-boot-starter-social-facebook</td>
<td>spring-boot-starterã€ spring-boot-starter-webã€ spring-coreã€spring-social-configã€ spring-social-coreã€ spring-socialwebã€ spring-social-facebook</td>
</tr>
<tr>
<td>spring-boot-starter-social-twitter</td>
<td>spring-boot-starterã€ spring-boot-starter-webã€ spring-coreã€spring-social-configã€ spring-social-coreã€ spring-socialwebã€ spring-social-twitter</td>
</tr>
<tr>
<td>spring-boot-starter-social-linkedin</td>
<td>spring-boot-starterã€ spring-boot-starter-webã€ spring-coreã€spring-social-configã€ spring-social-coreã€ spring-socialwebã€ spring-social-linkedin</td>
</tr>
<tr>
<td>spring-boot-starter</td>
<td>spring-bootã€ spring-boot-autoconfigureã€ spring-boot-starterlogging</td>
</tr>
<tr>
<td>spring-boot-starter-test</td>
<td>spring-boot-starter-loggingã€ spring-bootã€ junitã€mockitocoreã€ hamcrest-libraryã€ spring-test</td>
</tr>
<tr>
<td>spring-boot-starter-thymeleaf</td>
<td>spring-boot-starterã€ spring-boot-starter-webã€ spring-coreã€thymeleaf-spring4ã€ thymeleaf-layout-dialect</td>
</tr>
<tr>
<td>spring-boot-starter-tomcat</td>
<td>tomcat-embed-coreã€ tomcat-embed-logging-juli</td>
</tr>
<tr>
<td>spring-boot-starter-web</td>
<td>spring-boot-starterã€ spring-boot-starter-tomcatã€ jacksondatabindã€ spring-webã€ spring-webmvc</td>
</tr>
<tr>
<td>spring-boot-starter-websocket</td>
<td>spring-boot-starter-webã€ spring-websocketã€ tomcat-embedcoreã€ tomcat-embed-logging-juli</td>
</tr>
<tr>
<td>spring-boot-starter-ws</td>
<td>spring-boot-starterã€ spring-boot-starter-webã€ spring-coreã€spring-jmsã€ spring-oxmã€ spring-ws-coreã€ spring-ws-support</td>
</tr>
</tbody></table>
<p>å¦‚æœæŸ¥çœ‹è¿™äº› Starter ä¾èµ–çš„å†…éƒ¨åŸç†ï¼Œä½ ä¼šå‘ç° Starter çš„å·¥ä½œæ–¹å¼ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç¥ç§˜ä¹‹å¤„ã€‚å®ƒä½¿ç”¨äº† Maven å’Œ Gradle çš„ä¾èµ–ä¼ é€’æ–¹æ¡ˆï¼ŒStarter åœ¨è‡ªå·±çš„ pom.xml æ–‡ä»¶ä¸­å£°æ˜äº†å¤šä¸ªä¾èµ–ã€‚å½“æˆ‘ä»¬å°†æŸä¸€ä¸ª Starter ä¾èµ–æ·»åŠ åˆ° Maven æˆ– Gradle æ„å»ºä¸­çš„æ—¶å€™ï¼ŒStarter çš„ä¾èµ–å°†ä¼šè‡ªåŠ¨åœ°ä¼ é€’æ€§è§£æã€‚è¿™äº›ä¾èµ–æœ¬èº«å¯èƒ½ä¹Ÿä¼šæœ‰å…¶ä»–çš„ä¾èµ–ã€‚ä¸€ä¸ª Starter å¯èƒ½ä¼šä¼ é€’æ€§åœ°å¼•å…¥å‡ åä¸ªä¾èµ–ã€‚</p>
<p>éœ€è¦æ³¨æ„ï¼Œå¾ˆå¤š Starter å¼•ç”¨äº†å…¶ä»–çš„ Starterã€‚ä¾‹å¦‚ï¼Œmobile Starter å°±å¼•ç”¨äº† Web Starterï¼Œè€Œåè€…åˆå¼•ç”¨äº† Tomcat Starterã€‚å¤§å¤šæ•°çš„ Starter éƒ½ä¼šå¼•ç”¨ spring-boot-starterï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªåŸºç¡€çš„ Starterï¼ˆå½“ç„¶ï¼Œå®ƒä¹Ÿä¾èµ–äº† logging Starterï¼‰ã€‚ä¾èµ–æ˜¯ä¼ é€’æ€§çš„ï¼Œå°† mobile Starter æ·»åŠ ä¸ºä¾èµ–ä¹‹åï¼Œå°±ç›¸å½“äºæ·»åŠ äº†å®ƒä¸‹é¢çš„æ‰€æœ‰ Starterã€‚</p>
<h4 id="è‡ªåŠ¨é…ç½®"><a href="#è‡ªåŠ¨é…ç½®" class="headerlink" title="è‡ªåŠ¨é…ç½®"></a>è‡ªåŠ¨é…ç½®</h4><p>Spring Boot çš„ Starter å‡å°‘äº†æ„å»ºä¸­ä¾èµ–åˆ—è¡¨çš„é•¿åº¦ï¼Œè€Œ Spring Boot çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½åˆ™å‰Šå‡äº† Spring é…ç½®çš„æ•°é‡ã€‚å®ƒåœ¨å®ç°æ—¶ï¼Œä¼šè€ƒè™‘åº”ç”¨ä¸­çš„å…¶ä»–å› ç´ å¹¶æ¨æ–­ä½ æ‰€éœ€è¦çš„ Spring é…ç½®ã€‚</p>
<p>ä½œä¸ºæ ·ä¾‹ï¼Œè®©æˆ‘ä»¬é‡æ–°å›å¿†ç¬¬ 6 ç« ï¼ˆç¨‹åºæ¸…å• 6.4ï¼‰ï¼Œè¦å°† Thymeleaf æ¨¡æ¿ä½œä¸º Spring MVC çš„è§†å›¾ï¼Œè‡³å°‘éœ€è¦ä¸‰ä¸ª beanï¼šThymeleafViewResolverã€ SpringTemplateEngine å’Œ TemplateResolverã€‚ä½†æ˜¯ï¼Œä½¿ç”¨ Spring Boot è‡ªåŠ¨é…ç½®çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦åšçš„ä»…ä»…æ˜¯å°† Thymeleaf æ·»åŠ åˆ°é¡¹ç›®çš„ç±»è·¯å¾„ä¸­ã€‚å¦‚æœ Spring  Boot æ¢æµ‹åˆ° Thymeleaf ä½äºç±»è·¯å¾„ä¸­ï¼Œå®ƒå°±ä¼šæ¨æ–­æˆ‘ä»¬éœ€è¦ä½¿ç”¨ Thymeleaf å®ç° Spring MVC çš„è§†å›¾åŠŸèƒ½ï¼Œå¹¶è‡ªåŠ¨é…ç½®è¿™äº› beanã€‚</p>
<p>Spring Boot Starter ä¹Ÿä¼šè§¦å‘è‡ªåŠ¨é…ç½®ã€‚ä¾‹å¦‚ï¼Œåœ¨ Spring Boot åº”ç”¨ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä½¿ç”¨ Spring MVC çš„è¯ï¼Œæ‰€éœ€è¦åšçš„ä»…ä»…æ˜¯å°† Web Starter ä½œä¸ºä¾èµ–æ”¾åˆ°æ„å»ºä¹‹ä¸­ã€‚å°† Web Starter ä½œä¸ºä¾èµ–æ”¾åˆ°æ„å»ºä¸­ä»¥åï¼Œå®ƒä¼šè‡ªåŠ¨æ·»åŠ  Spring MVC ä¾èµ–ã€‚å¦‚æœ Spring Boot çš„ Web è‡ªåŠ¨é…ç½®æ¢æµ‹åˆ° Spring MVC ä½äºç±»è·¯å¾„ä¸‹ï¼Œå®ƒå°†ä¼šè‡ªåŠ¨é…ç½®æ”¯æŒ Spring MVC çš„å¤šä¸ª beanï¼ŒåŒ…æ‹¬è§†å›¾è§£æå™¨ã€èµ„æºå¤„ç†å™¨ä»¥åŠæ¶ˆæ¯è½¬æ¢å™¨ï¼ˆç­‰ç­‰ï¼‰ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥éœ€è¦åšçš„å°±æ˜¯ç¼–å†™å¤„ç†è¯·æ±‚çš„æ§åˆ¶å™¨ã€‚</p>
<h4 id="Spring-Boot-CLI"><a href="#Spring-Boot-CLI" class="headerlink" title="Spring Boot CLI"></a>Spring Boot CLI</h4><p>Spring Boot CLI å……åˆ†åˆ©ç”¨äº† Spring Boot Starter å’Œè‡ªåŠ¨é…ç½®çš„é­”åŠ›ï¼Œå¹¶æ·»åŠ äº†ä¸€äº› Groovy çš„åŠŸèƒ½ã€‚å®ƒç®€åŒ–äº† Spring çš„å¼€å‘æµç¨‹ï¼Œé€šè¿‡ CLIï¼Œæˆ‘ä»¬èƒ½å¤Ÿè¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ª Groovy è„šæœ¬ï¼Œå¹¶æŸ¥çœ‹å®ƒæ˜¯å¦‚ä½•è¿è¡Œçš„ã€‚åœ¨åº”ç”¨çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒCLI èƒ½å¤Ÿè‡ªåŠ¨å¯¼å…¥ Spring ç±»å‹å¹¶è§£æä¾èµ–ã€‚</p>
<p>ç”¨æ¥é˜è¿° Spring Boot CLI çš„æœ€æœ‰è¶£çš„ä¾‹å­å°±æ˜¯å¦‚ä¸‹çš„ Groovy è„šæœ¬ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerclass</span> Hi &#123;  <span class="meta">@RequestMapping</span>(<span class="string">&quot;/&quot;</span>)  String hi() &#123;    <span class="string">&quot;Hi!&quot;</span>  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡ä½ æ˜¯å¦ç›¸ä¿¡ï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ï¼ˆå°½ç®¡æ¯”è¾ƒç®€å•ï¼‰Springåº”ç”¨ï¼Œå®ƒå¯ä»¥åœ¨ Spring Boot CLI ä¸­è¿è¡Œã€‚åŒ…æ‹¬ç©ºæ ¼ï¼Œå®ƒçš„é•¿åº¦åªæœ‰ 82 ä¸ªå­—ç¬¦ã€‚ä½ å¯ä»¥å°†å…¶ç²˜è´´åˆ° Twitter å®¢æˆ·ç«¯ï¼Œå¹¶åˆ†äº«ç»™ä½ çš„æœ‹å‹ä»¬ã€‚</p>
<p>å»æ‰ä¸å¿…è¦çš„ç©ºæ ¼ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¾—åˆ°åªæœ‰ 64 ä¸ªå­—ç¬¦çš„ä¸€è¡Œä»£ç ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span> <span class="class"><span class="keyword">class</span> <span class="title">Hi</span>&#123;</span><span class="meta">@RequestMapping</span>(<span class="string">&quot;/&quot;</span>)String hi()&#123;<span class="string">&quot;Hi!&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç‰ˆæœ¬æ›´åŠ ç®€å•ï¼Œåœ¨ä¸€æ¡ Twitter çš„æ¨æ–‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç²˜è´´ä¸¤æ¬¡ã€‚ä½†å®ƒä¾ç„¶æ˜¯ä¸€ä¸ªå®Œæ•´å¯è¿è¡Œçš„ï¼ˆå°½ç®¡ç‰¹æ€§æ¯”è¾ƒç®€é™‹ï¼‰Spring åº”ç”¨ã€‚å¦‚æœä½ å·²ç»å®‰è£…è¿‡ Spring  Boot CLIï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤è¡Œæ¥è¿è¡Œå®ƒï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring run Hi.groovy</span></span><br></pre></td></tr></table></figure>

<p>ä»¥æ¨æ–‡çš„å½¢å¼æ¥å±•ç¤º Spring Boot CLI çš„åŠŸèƒ½æ˜¯å¾ˆæœ‰æ„æ€çš„ï¼Œä½†æ˜¯å®ƒæ‰€èƒ½åšçš„äº‹æƒ…å¹¶ä¸ä»…é™äºæˆ‘ä»¬æ‰€çœ‹åˆ°çš„è¿™äº›ã€‚åœ¨ 21.3 å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨ Groovy å’Œ CLI æ„å»ºæ›´åŠ å®Œæ•´çš„åº”ç”¨ã€‚</p>
<h4 id="Actuator"><a href="#Actuator" class="headerlink" title="Actuator"></a>Actuator</h4><p>Spring Boot Actuator ä¸º Spring Boot é¡¹ç›®å¸¦æ¥äº†å¾ˆå¤šæœ‰ç”¨çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>ç®¡ç†ç«¯ç‚¹ï¼›</li>
<li>åˆç†çš„å¼‚å¸¸å¤„ç†ä»¥åŠé»˜è®¤çš„ â€œ/errorâ€ æ˜ å°„ç«¯ç‚¹ï¼›</li>
<li>è·å–åº”ç”¨ä¿¡æ¯çš„ â€œ/infoâ€ ç«¯ç‚¹ï¼›</li>
<li>å½“å¯ç”¨ Spring Security æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªå®¡è®¡äº‹ä»¶æ¡†æ¶ã€‚</li>
</ul>
<p>è¿™äº›ç‰¹æ€§éƒ½æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œä½†Actuatoræœ€æœ‰ç”¨å’Œæœ€æœ‰æ„æ€çš„ç‰¹æ€§æ˜¯ç®¡ç†ç«¯ç‚¹ã€‚åœ¨ 21.4 å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ° Spring Boot Actuator çš„å‡ ä¸ªæ ·ä¾‹ï¼Œå®ƒå¼€å¯äº†ä¸€æ‰‡çª—ï¼Œèƒ½å¤Ÿè®©æˆ‘ä»¬æ´æ‚‰åº”ç”¨çš„å†…éƒ¨è¿è¡ŒçŠ¶å†µã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯¹ Spring Boot çš„å››ä¸ªä¸»è¦ç‰¹æ€§å·²ç»æœ‰äº†åŸºæœ¬çš„äº†è§£ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†ä½¿ç”¨å®ƒä»¬æ„å»ºä¸€ä¸ªå¾®å°ä½†å®Œæ•´çš„åº”ç”¨ç¨‹åºã€‚</p>
<h3 id="ä½¿ç”¨-Spring-Boot-æ„å»ºåº”ç”¨"><a href="#ä½¿ç”¨-Spring-Boot-æ„å»ºåº”ç”¨" class="headerlink" title="ä½¿ç”¨ Spring Boot æ„å»ºåº”ç”¨"></a>ä½¿ç”¨ Spring Boot æ„å»ºåº”ç”¨</h3><p>åœ¨æœ¬ç« å‰©ä½™çš„å†…å®¹ä¸­ï¼Œæˆ‘å°†ä¼šå‘ä½ å±•ç°å¦‚ä½•ä½¿ç”¨ Spring Boot æ„å»ºå®Œæ•´ä¸”ç¬¦åˆç°å®è¦æ±‚ï¼ˆreal-worldï¼‰çš„åº”ç”¨ç¨‹åºã€‚å½“ç„¶ï¼Œâ€œç¬¦åˆç°å®è¦æ±‚â€çš„å®šä¹‰æ ‡å‡†ä¼šæœ‰äº›äº‰è®®ï¼Œå¯¹å®ƒçš„è®¨è®ºè¶…å‡ºäº†æœ¬ç« çš„èŒƒå›´ã€‚å› æ­¤ï¼Œä¸å…¶åœ¨è¿™é‡Œè¯´æ„å»ºç¬¦åˆç°å®è¦æ±‚çš„åº”ç”¨ï¼Œè¿˜ä¸å¦‚åé€€ä¸€æ­¥ï¼Œè¯´æˆæˆ‘ä»¬æ‰€æ„å»ºçš„åº”ç”¨ç¨‹åºæ¯”ç°å®è¦æ±‚ç¨å·®ä¸€ç‚¹ï¼Œä½†æ˜¯å®ƒèƒ½å¤Ÿä»£è¡¨ä½¿ç”¨ Spring Boot æ‰€æ„å»ºçš„æ›´å¤§å‹åº”ç”¨ã€‚</p>
<p>æˆ‘ä»¬çš„åº”ç”¨æ˜¯ä¸€ä¸ªç®€å•çš„è”ç³»äººåˆ—è¡¨ã€‚å®ƒå…è®¸ç”¨æˆ·è¾“å…¥è”ç³»äººä¿¡æ¯ï¼ˆåå­—ã€ç”µè¯å·ç ä»¥åŠ Email åœ°å€ï¼‰ï¼Œå¹¶ä¸”èƒ½å¤Ÿåˆ—å‡ºç”¨æˆ·ä¹‹å‰è¾“å…¥çš„æ‰€æœ‰è”ç³»äººä¿¡æ¯ã€‚ä½ å¯ä»¥è‡ªç”±é€‰æ‹©ä½¿ç”¨ Maven è¿˜æ˜¯ Gradle æ¥æ„å»ºåº”ç”¨ç¨‹åºï¼Œæˆ‘æ›´å–œæ¬¢ Gradleï¼Œä½†æ˜¯å¦‚æœä½ å–œæ¬¢ Maven çš„è¯ï¼Œæˆ‘ä¹Ÿå°†ä¼šåˆ—å‡ºæ‰€éœ€çš„ Maven ä»£ç ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†èµ·å§‹çš„ build.gradle æ–‡ä»¶ã€‚å¼€å§‹çš„æ—¶å€™ï¼Œä¾èµ–éƒ¨åˆ†æ˜¯ç©ºçš„ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨ä¾èµ–å¡«å……è¿™éƒ¨åˆ†çš„å†…å®¹ã€‚</p>
<center>ç¨‹åºæ¸…å• 21.1ã€€Contacts åº”ç”¨æ‰€éœ€çš„ Gradle æ„å»ºæ–‡ä»¶</center>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;  repositories &#123;    mavenLocal()  &#125;  dependencies &#123;    classpath(<span class="attr">&quot;org.springframework.boot:spring-boot-gradle-plugin:1.1.4.RELEASE&quot;</span>)  &#125;&#125;  apply plugin: &#x27;java&#x27;apply plugin: &#x27;spring-boot&#x27;jar &#123;  baseName = &#x27;contacts&#x27;  version = &#x27;0.1.0&#x27;&#125; repositories &#123;  mavenCentral()&#125;  dependencies &#123;&#125;  task wrapper(type: Wrapper) &#123;  gradleVersion = &#x27;1.8&#x27;&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œæ„å»ºä¸­åŒ…å«å¯¹ Spring Boot Gradle çš„ buildscript ä¾èµ–ã€‚ç¨åå°†ä¼šçœ‹åˆ°ï¼Œè¿™ä¼šå¸®åŠ©æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œçš„è¶…çº§ JAR æ–‡ä»¶ï¼ˆuber-JARï¼‰ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­å°†ä¼šåŒ…å«åº”ç”¨çš„æ‰€æœ‰ä¾èµ–ã€‚</p>
<p>å¦‚æœä½ æ›´å–œæ¬¢ Maven çš„è¯ï¼Œå¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å®Œæ•´çš„ pom.xml æ–‡ä»¶ã€‚</p>
<center>ç¨‹åºæ¸…å• 21.2ã€€Contacts åº”ç”¨æ‰€éœ€çš„ Maven æ„å»ºæ–‡ä»¶</center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml versions&quot;1.0&quot; encodings&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>    <span class="attr">xmlns:xsis</span>&quot;<span class="attr">http:</span>//<span class="attr">www.w3.org</span>/<span class="attr">2001</span>/<span class="attr">XMLSchema-instance</span>&quot;    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;      http://maven.apache.org/POM/4.0.0      http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span>        <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span>    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.habuma<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>contacts<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span>    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span>        <span class="tag">&lt;<span class="name">parent</span>&gt;</span>      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>      <span class="tag">&lt;<span class="name">artifactld</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactld</span>&gt;</span>      <span class="tag">&lt;<span class="name">version</span>&gt;</span>l.1.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span>    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span>        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span>        <span class="tag">&lt;<span class="name">build</span>&gt;</span>      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupld</span>&gt;</span>         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot~maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>       <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>     <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>   <span class="tag">&lt;/<span class="name">build</span>&gt;</span><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ Gradle æ„å»ºç±»ä¼¼ï¼Œè¿™ä¸ª Maven çš„ pom.xml æ–‡ä»¶ä½¿ç”¨äº† Spring Boot Maven æ’ä»¶ã€‚è¿™ä¸ª Maven ä¸­çš„æ’ä»¶å¯¹åº”äº Gradle æ’ä»¶ï¼Œèƒ½å¤Ÿç”Ÿæˆå¯æ‰§è¡Œçš„è¶…çº§ JAR æ–‡ä»¶ã€‚</p>
<p>åŒæ ·éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ Gradle æ„å»ºä¸åŒï¼ŒMaven æ„æ¶æœ‰ä¸€ä¸ª parent é¡¹ç›®ã€‚æˆ‘ä»¬è®©é¡¹ç›®çš„ Maven æ„å»ºåŸºäº Spring Boot starter parentï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±èƒ½å—ç›Šäº Maven çš„ä¾èµ–ç®¡ç†åŠŸèƒ½ï¼Œå¯¹äºé¡¹ç›®ä¸­çš„å¾ˆå¤šä¾èµ–ï¼Œå°±æ²¡æœ‰å¿…è¦æ˜ç¡®å£°æ˜ç‰ˆæœ¬å·äº†ï¼Œå› ä¸ºç‰ˆæœ¬å·ä¼šä» parent ä¸­ç»§æ‰¿å¾—åˆ°ã€‚</p>
<p>æŒ‰ç…§ Maven å’Œ Gradle é¡¹ç›®çš„æ ‡å‡†ç»“æ„ï¼Œå®Œæˆåé¡¹ç›®å°†ä¼šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="spring-in-action-v4/image-20211114144746810.png" alt="image-20211114144746810"></p>
<p>ä¸è¦æ‹…å¿ƒç°åœ¨ç¼ºå¤± Java å’Œå…¶ä»–çš„èµ„æºæ–‡ä»¶ã€‚åœ¨å¼€å‘ Contacts åº”ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨ä¸‹é¢çš„å‡ ä¸ªå°èŠ‚ä¸­åˆ›å»ºè¿™äº›æ–‡ä»¶ï¼Œé¦–å…ˆå°†ä¼šä»æ„å»ºåº”ç”¨çš„ Web å±‚å¼€å§‹ã€‚</p>
<h4 id="å¤„ç†è¯·æ±‚"><a href="#å¤„ç†è¯·æ±‚" class="headerlink" title="å¤„ç†è¯·æ±‚"></a>å¤„ç†è¯·æ±‚</h4><p>å› ä¸ºæˆ‘ä»¬è¦ä½¿ç”¨ Spring MVC æ¥å¼€å‘åº”ç”¨çš„ Web å±‚ï¼Œå› æ­¤éœ€è¦å°† Spring MVC ä½œä¸ºä¾èµ–æ·»åŠ åˆ°æ„å»ºä¸­ã€‚æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡ï¼ŒSpring Boot çš„ Web Starter èƒ½å¤Ÿå°†Spring MVC éœ€è¦çš„æ‰€æœ‰å†…å®¹ä¸€ç«™å¼æ·»åŠ åˆ°æ„å»ºä¸­ã€‚å¦‚ä¸‹æ˜¯æˆ‘ä»¬æ‰€éœ€çš„ Gradle ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile(&quot;org.springframework.boot:spring-boot-starter.web&quot;)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½¿ç”¨ Maven æ¥è¿›è¡Œæ„å»ºçš„è¯ï¼Œé‚£ä¹ˆä¾èµ–å°†ä¼šå¦‚ä¸‹æ‰€ç¤º: </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œå› ä¸º Spring Boot parent é¡¹ç›®å·²ç»æŒ‡å®šäº† Web Starter ä¾èµ–çš„ç‰ˆæœ¬ï¼Œå› æ­¤åœ¨é¡¹ç›®çš„ build.gradle å’Œ pom.xml æ–‡ä»¶ä¸­æ²¡æœ‰å¿…è¦å†æ˜¾å¼æŒ‡å®šç‰ˆæœ¬ä¿¡æ¯ã€‚</p>
<p>Web Starter ä¾èµ–å°±ç»ªä¹‹åï¼Œä½¿ç”¨ Spring MVC éœ€è¦çš„æ‰€æœ‰ä¾èµ–éƒ½ä¼šæ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼–å†™åº”ç”¨æ‰€éœ€çš„æ§åˆ¶å™¨ç±»äº†ã€‚</p>
<p>æ§åˆ¶å™¨ç›¸å¯¹ä¼šéå¸¸ç®€å•ï¼ŒåŒ…å«å±•ç°è”ç³»äººè¡¨å•çš„ HTTP GET è¯·æ±‚ä»¥åŠå¤„ç†è¡¨å•æäº¤çš„ POST è¯·æ±‚ã€‚å®ƒæœ¬èº«å¹¶æ²¡æœ‰åšå¤ªå¤šçš„äº‹æƒ…ï¼Œè€Œæ˜¯å§”æ‰˜ ContactRepositoryï¼ˆç¨åå°±ä¼šåˆ›å»ºå®ƒï¼‰æ¥æŒä¹…åŒ–è”ç³»äººä¿¡æ¯ã€‚ç¨‹åºæ¸…å• 21.3 ä¸­çš„ ContactController å°±èƒ½æ»¡è¶³è¿™äº›éœ€æ±‚ã€‚</p>
<center>ç¨‹åºæ¸…å• 21.3ã€€ContactController ä¸º Contacts åº”ç”¨å¤„ç†åŸºæœ¬çš„ Web è¯·æ±‚</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> contacts;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> java.util.Map;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.stereotype.Controller;<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;<span class="meta">@Controller</span><span class="meta">@RequestMapping(&quot;/&quot;)</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContactController</span> </span>&#123;	<span class="keyword">private</span> ContactRepository contactRepo;	<span class="meta">@Autowired</span>	<span class="function"><span class="keyword">public</span> <span class="title">ContactController</span><span class="params">(ContactRepository contactRepo)</span> </span>&#123;		<span class="keyword">this</span>.contactRepo = contactRepo;	&#125;	<span class="meta">@RequestMapping(method=RequestMethod.GET)</span>	<span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">(Map&lt;String,Object&gt; model)</span> </span>&#123;		List&lt;Contact&gt; contacts = contactRepo.findAll();		model.put(<span class="string">&quot;contacts&quot;</span>, contacts);		<span class="keyword">return</span> <span class="string">&quot;home&quot;</span>;	&#125;	<span class="meta">@RequestMapping(method=RequestMethod.POST)</span>	<span class="function"><span class="keyword">public</span> String <span class="title">submit</span><span class="params">(Contact contact)</span> </span>&#123;		contactRepo.save(contact);		<span class="keyword">return</span> <span class="string">&quot;redirect:/&quot;</span>;	&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ä½ é¦–å…ˆå¯èƒ½ä¼šå‘ç° ContactController å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ Spring MVC æ§åˆ¶å™¨ã€‚å°½ç®¡ Spring Boot ä¼šç®¡ç†æ„å»ºä¾èµ–å¹¶æœ€å°åŒ– Spring é…ç½®ï¼Œä½†æ˜¯åœ¨ç¼–å†™åº”ç”¨é€»è¾‘çš„æ—¶å€™ï¼Œç¼–ç¨‹æ¨¡å‹æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼ŒContactController éµå¾ªäº† Spring MVC æ§åˆ¶å™¨çš„å…¸å‹æ¨¡å¼ï¼Œå®ƒä¼šå±•ç°è¡¨å•å¹¶å¤„ç†è¡¨å•çš„æäº¤ã€‚å…¶ä¸­ home() æ–¹æ³•ä½¿ç”¨æ³¨å…¥çš„ ContactRepository æ¥è·å–æ‰€æœ‰ Contact å¯¹è±¡çš„åˆ—è¡¨ï¼Œå¹¶å°†å®ƒä»¬æ”¾åˆ°æ¨¡å‹ä¸­ï¼Œç„¶åæŠŠè¯·æ±‚è½¬äº¤ç»™ home è§†å›¾ã€‚è¿™ä¸ªè§†å›¾å°†ä¼šå±•ç°è”ç³»äººçš„åˆ—è¡¨ä»¥åŠæ·»åŠ æ–° Contact çš„è¡¨å•ã€‚submit() æ–¹æ³•å°†ä¼šå¤„ç†è¡¨å•æäº¤çš„ POST è¯·æ±‚ï¼Œä¿å­˜ Contactï¼Œå¹¶é‡å®šå‘åˆ°é¦–é¡µã€‚</p>
<p>å› ä¸º ContactController ä½¿ç”¨äº† @Controller æ³¨è§£ï¼Œæ‰€ä»¥ç»„ä»¶æ‰«æå°†ä¼šæ‰¾åˆ°å®ƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ˜ç¡®å°†å…¶å£°æ˜ä¸º beanã€‚è€Œ Contact æ¨¡å‹ç±»æ˜¯ä¸€ä¸ªç®€å•çš„ POJOï¼Œå…·æœ‰ä¸€äº›å±æ€§å’Œå­˜å–å™¨æ–¹æ³•ï¼Œå¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºã€‚</p>
<p>ç¨‹åºæ¸…å•21.4ã€€Contactæ˜¯ä¸€ä¸ªç®€å•çš„é¢†åŸŸç±»å‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> contacts;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Contact</span> </span>&#123;  <span class="keyword">private</span> Long id;  <span class="keyword">private</span> String firstName;  <span class="keyword">private</span> String lastName;  <span class="keyword">private</span> String phoneNumber;  <span class="keyword">private</span> String emailAddress;  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;    <span class="keyword">this</span>.id = id;  &#125;    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> id;  &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstName</span><span class="params">(String firstName)</span> </span>&#123;    <span class="keyword">this</span>.firstName = firstName;  &#125;    <span class="function"><span class="keyword">public</span> String <span class="title">getFirstName</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> firstName;  &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastName</span><span class="params">(String lastName)</span> </span>&#123;    <span class="keyword">this</span>.lastName = lastName;  &#125;    <span class="function"><span class="keyword">public</span> String <span class="title">getLastName</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> lastName;  &#125;  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPhoneNumber</span><span class="params">(String phoneNumber)</span> </span>&#123;    <span class="keyword">this</span>.phoneNumber = phoneNumber;  &#125;  <span class="function"><span class="keyword">public</span> String <span class="title">getPhoneNumber</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> phoneNumber;  &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmailAddress</span><span class="params">(String emailAddress)</span> </span>&#123;    <span class="keyword">this</span>.emailAddress = emailAddress;  &#125;    <span class="function"><span class="keyword">public</span> String <span class="title">getEmailAddress</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> emailAddress;  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>åº”ç”¨ç¨‹åºçš„Webå±‚åŸºæœ¬ä¸Šå·²ç»å®Œæˆäº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯åˆ›å»ºå®šä¹‰homeè§†å›¾çš„Thymeleafæ¨¡æ¿ã€‚</p>
<h4 id="åˆ›å»ºè§†å›¾"><a href="#åˆ›å»ºè§†å›¾" class="headerlink" title="åˆ›å»ºè§†å›¾"></a>åˆ›å»ºè§†å›¾</h4><p>æŒ‰ç…§ä¼ ç»Ÿçš„æ–¹å¼ï¼ŒJava Webåº”ç”¨ä¼šä½¿ç”¨JSPä½œä¸ºè§†å›¾å±‚çš„æŠ€æœ¯ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘åœ¨ç¬¬6ç« æ‰€è¿°ï¼Œåœ¨è¿™ä¸ªé¢†åŸŸæœ‰ä¸€ä¸ªæ–°çš„å‚ä¸è€…ã€‚Thymeleafçš„åŸç”Ÿæ¨¡æ¿æ¯”JSPæ›´åŠ ä¾¿äºä½¿ç”¨ï¼Œè€Œä¸”å®ƒèƒ½å¤Ÿè®©æˆ‘ä»¬ä»¥HTMLçš„å½¢å¼ç¼–å†™æ¨¡æ¿ã€‚é‰´äºæ­¤ï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨Thymeleafæ¥å®šä¹‰Contactsåº”ç”¨çš„homeè§†å›¾ã€‚</p>
<p>é¦–å…ˆï¼Œéœ€è¦å°†Thymeleafæ·»åŠ åˆ°é¡¹ç›®çš„æ„å»ºä¸­ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯Spring 4ï¼Œæ‰€ä»¥éœ€è¦å°†Thymeleafçš„Spring 4æ¨¡å—æ·»åŠ åˆ°æ„å»ºä¹‹ä¸­ã€‚åœ¨Gradleä¸­ï¼Œä¾èµ–å°†ä¼šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile(&quot;org.thymeleaf:thymeleaf-spring4&quot;)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½¿ç”¨Mavençš„è¯ï¼Œæ‰€éœ€çš„ä¾èµ–å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-spring4<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>éœ€è¦è®°ä½çš„æ˜¯ï¼Œåªè¦æˆ‘ä»¬å°†Thymeleafæ·»åŠ åˆ°é¡¹ç›®çš„ç±»è·¯å¾„ä¸‹ï¼Œå°±å¯äº†Spring Bootçš„è‡ªåŠ¨é…ç½®ã€‚å½“åº”ç”¨è¿è¡Œæ—¶ï¼ŒSpring Bootå°†ä¼šæ¢æµ‹åˆ°ç±»è·¯å¾„ä¸­çš„Thymeleafï¼Œç„¶åä¼šè‡ªåŠ¨é…ç½®è§†å›¾è§£æå™¨ã€æ¨¡æ¿è§£æå™¨ä»¥åŠæ¨¡æ¿å¼•æ“ï¼Œè¿™äº›éƒ½æ˜¯åœ¨Spring MVCä¸­ä½¿ç”¨Thymeleafæ‰€éœ€è¦çš„ã€‚å› æ­¤ï¼Œåœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ï¼Œä¸éœ€è¦ä½¿ç”¨æ˜¾å¼Springé…ç½®çš„æ–¹å¼æ¥å®šä¹‰Thymeleafã€‚</p>
<p>é™¤äº†å°†Thymeleafä¾èµ–æ·»åŠ åˆ°æ„å»ºä¸­ï¼Œæˆ‘ä»¬å‰©ä¸‹æ‰€éœ€è¦åšçš„å°±æ˜¯å®šä¹‰è§†å›¾æ¨¡æ¿ã€‚ç¨‹åºæ¸…å•21.5å±•ç°äº†home.htmlï¼Œè¿™æ˜¯å®šä¹‰homeè§†å›¾çš„Thymeleafæ¨¡æ¿ã€‚</p>
<p>ç¨‹åºæ¸…å•21.5ã€€homeè§†å›¾æ¸²æŸ“äº†ä¸€ä¸ªåˆ›å»ºæ–°è”ç³»äººçš„è¡¨å•ä»¥åŠå±•ç°è”ç³»äººçš„åˆ—è¡¨</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">head</span>&gt;</span>    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Spring Boot Contacts<span class="tag">&lt;/<span class="name">title</span>&gt;</span>    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/style.css&#125;&quot;</span> /&gt;</span>  <span class="tag">&lt;/<span class="name">head</span>&gt;</span>  <span class="tag">&lt;<span class="name">body</span>&gt;</span>    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Spring Boot Contacts<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span>      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;firstName&quot;</span>&gt;</span>First Name:<span class="tag">&lt;/<span class="name">label</span>&gt;</span>      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;firstName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;lastName&quot;</span>&gt;</span>Last Name:<span class="tag">&lt;/<span class="name">label</span>&gt;</span>      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;phoneNumber&quot;</span>&gt;</span>Phone #:<span class="tag">&lt;/<span class="name">label</span>&gt;</span>      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;phoneNumber&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;emailAddress&quot;</span>&gt;</span>Email:<span class="tag">&lt;/<span class="name">label</span>&gt;</span>      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;emailAddress&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>    <span class="tag">&lt;/<span class="name">form</span>&gt;</span>    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">th:each</span>=<span class="string">&quot;contact : $&#123;contacts&#125;&quot;</span>&gt;</span>      <span class="tag">&lt;<span class="name">li</span>&gt;</span>        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;contact.firstName&#125;&quot;</span>&gt;</span>First<span class="tag">&lt;/<span class="name">span</span>&gt;</span>        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;contact.lastName&#125;&quot;</span>&gt;</span>Last<span class="tag">&lt;/<span class="name">span</span>&gt;</span> :        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;contact.phoneNumber&#125;&quot;</span>&gt;</span>phoneNumber<span class="tag">&lt;/<span class="name">span</span>&gt;</span>,        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;contact.emailAddress&#125;&quot;</span>&gt;</span>emailAddress<span class="tag">&lt;/<span class="name">span</span>&gt;</span>      <span class="tag">&lt;/<span class="name">li</span>&gt;</span>    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span>  <span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„Thymeleafæ¨¡æ¿ï¼Œåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šä¸€ä¸ªè¡¨å•å’Œä¸€ä¸ªè”ç³»äººçš„åˆ—è¡¨ã€‚è¡¨å•å°†ä¼šPOSTæ•°æ®åˆ°ContactControllerçš„submit()æ–¹æ³•ä¸Šï¼Œç”¨æ¥åˆ›å»ºæ–°çš„Contactã€‚åˆ—è¡¨éƒ¨åˆ†å°†ä¼šå¾ªç¯åˆ—å‡ºæ¨¡å‹ä¸­çš„Contactå¯¹è±¡ã€‚</p>
<p>ä¸ºäº†ä½¿ç”¨è¿™ä¸ªæ¨¡æ¿ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œæ…é‡åœ°å‘½åå¹¶æ”¾åœ¨é¡¹ç›®çš„æ­£ç¡®ä½ç½®ä¸‹ã€‚å› ä¸ºContactControllerä¸­home()æ–¹æ³•æ‰€è¿”å›çš„é€»è¾‘è§†å›¾åä¸ºhomeï¼Œå› æ­¤æ¨¡æ¿æ–‡ä»¶åº”è¯¥å‘½åä¸ºhome.htmlï¼Œè‡ªåŠ¨é…ç½®çš„æ¨¡æ¿è§£æå™¨ä¼šåœ¨æŒ‡å®šçš„ç›®å½•ä¸‹æŸ¥æ‰¾Thymeleafæ¨¡æ¿ï¼Œè¿™ä¸ªç›®å½•ä¹Ÿå°±æ˜¯ç›¸å¯¹äºæ ¹ç±»è·¯å¾„ä¸‹çš„templatesç›®å½•ä¸‹ï¼Œæ‰€ä»¥åœ¨Mavenæˆ–Gradleé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†home.htmlæ”¾åˆ°â€œsrc/main/resources/templatesâ€ä¸­ã€‚</p>
<p>è¿™ä¸ªæ¨¡æ¿è¿˜æœ‰ä¸€ç‚¹å°äº‹æƒ…éœ€è¦å¤„ç†ï¼Œå®ƒæ‰€äº§ç”Ÿçš„HTMLå°†ä¼šå¼•ç”¨åä¸ºstyle.cssçš„æ ·å¼è¡¨ã€‚å› æ­¤ï¼Œéœ€è¦å°†è¿™ä¸ªæ ·å¼è¡¨æ”¾åˆ°é¡¹ç›®ä¸­ã€‚</p>
<h4 id="æ·»åŠ é™æ€å†…å®¹"><a href="#æ·»åŠ é™æ€å†…å®¹" class="headerlink" title="æ·»åŠ é™æ€å†…å®¹"></a>æ·»åŠ é™æ€å†…å®¹</h4><p>æ­£å¸¸æ¥è®²ï¼Œåœ¨ç¼–å†™Springåº”ç”¨æ—¶ï¼Œæˆ‘ä¼šå°½é‡é¿å…è®¨è®ºæ ·å¼å’Œå›¾ç‰‡ã€‚å½“ç„¶ï¼Œè¿™äº›å†…å®¹èƒ½å¤Ÿåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šè®©å„ç§åº”ç”¨ï¼ˆåŒ…æ‹¬Springåº”ç”¨ï¼‰å˜å¾—æ›´åŠ ç¾è§‚ï¼Œä»¤ç”¨æˆ·èµå¿ƒæ‚¦ç›®ã€‚ä½†æ˜¯ï¼Œå¯¹äºç¼–å†™æœåŠ¡å™¨ç«¯çš„Springä»£ç æ¥è¯´ï¼Œè¿™äº›é™æ€å†…å®¹å°±æ²¡æœ‰é‚£ä¹ˆé‡è¦äº†ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨Spring Bootä¸­ï¼Œæœ‰å¿…è¦è®¨è®ºä¸€ä¸‹å®ƒæ˜¯å¦‚ä½•å¤„ç†é™æ€å†…å®¹çš„ã€‚å½“é‡‡ç”¨Spring Bootçš„Webè‡ªåŠ¨é…ç½®æ¥å®šä¹‰Spring MVC beanæ—¶ï¼Œè¿™äº›beanä¸­ä¼šåŒ…å«ä¸€ä¸ªèµ„æºå¤„ç†å™¨ï¼ˆresource handlerï¼‰ï¼Œå®ƒä¼šå°†<code>â€œ/**â€</code>æ˜ å°„åˆ°å‡ ä¸ªèµ„æºè·¯å¾„ä¸­ã€‚è¿™äº›èµ„æºè·¯å¾„åŒ…æ‹¬ï¼ˆç›¸å¯¹äºç±»è·¯å¾„çš„æ ¹ï¼‰ï¼š</p>
<ul>
<li>/META-INF/resources/</li>
<li>/resources/</li>
<li>/static/</li>
<li>/public/</li>
</ul>
<p>åœ¨ä¼ ç»Ÿçš„åŸºäºMaven/Gradleæ„å»ºçš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†é™æ€å†…å®¹æ”¾åœ¨â€œsrc/main/webappâ€ç›®å½•ä¸‹ï¼Œè¿™æ ·åœ¨æ„å»ºæ‰€ç”Ÿæˆçš„WARæ–‡ä»¶é‡Œé¢ï¼Œè¿™äº›å†…å®¹å°±ä¼šä½äºWARæ–‡ä»¶çš„æ ¹ç›®å½•ä¸‹ã€‚å¦‚æœä½¿ç”¨Spring Bootæ„å»ºWARæ–‡ä»¶çš„è¯ï¼Œè¿™ä¾ç„¶æ˜¯å¯é€‰çš„æ–¹æ¡ˆã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†é™æ€å†…å®¹æ”¾åœ¨èµ„æºå¤„ç†å™¨æ‰€æ˜ å°„çš„ä¸Šè¿°å››ä¸ªè·¯å¾„ä¸‹ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸ºäº†æ»¡è¶³Thymeleafæ¨¡æ¿å¯¹â€œ/style.cssâ€æ–‡ä»¶çš„å¼•ç”¨ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªåä¸ºstyle.cssæ–‡ä»¶ï¼Œå¹¶å°†å…¶æ”¾åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„æŸä¸€ä¸ªä½ç½®ä¸­ï¼š</p>
<ul>
<li>/META-INF/resources/style.css</li>
<li>/resources/style.css</li>
<li>/static/style.css</li>
<li>/public/style.css</li>
</ul>
<p>å…·ä½“çš„é€‰æ‹©å®Œå…¨å–å†³äºä½ ï¼Œæˆ‘å€¾å‘äºå°†é™æ€å†…å®¹æ”¾åˆ°â€œ/publicâ€ä¸­ï¼Œä¸è¿‡è¿™å››ä¸ªå¯é€‰æ–¹æ¡ˆæ˜¯ç­‰ä»·çš„ã€‚</p>
<p>å°½ç®¡style.cssæ–‡ä»¶çš„å†…å®¹ä¸è®¨è®ºæ— å…³ï¼Œä½†æ˜¯å¦‚ä¸‹è¿™ä¸ªç®€å•çš„æ ·å¼è¡¨èƒ½å¤Ÿè®©åº”ç”¨çœ‹ä¸Šå»æ›´åŠ æ•´æ´ï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;  backgroud-<span class="attribute">color</span>: <span class="number">#eeeeee</span>;  <span class="attribute">font-family</span>: sans-serif;&#125;<span class="selector-tag">label</span> &#123;  <span class="attribute">display</span>: inline-block;  <span class="attribute">width</span>: <span class="number">120px</span>;  <span class="attribute">text-align</span>: right;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡ä½ æ˜¯å¦ç›¸ä¿¡ï¼Œå¯¹äºè¿™ä¸ªç®€å•çš„Contactsåº”ç”¨æ¥è¯´ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†è¶…è¿‡ä¸€åŠçš„ä»»åŠ¡ï¼Webå±‚å…¨éƒ¨å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åˆ›å»ºContactRepositoryï¼Œç”¨æ¥å¤„ç†Contactå¯¹è±¡çš„æŒä¹…åŒ–ã€‚</p>
<h4 id="æŒä¹…åŒ–æ•°æ®"><a href="#æŒä¹…åŒ–æ•°æ®" class="headerlink" title="æŒä¹…åŒ–æ•°æ®"></a>æŒä¹…åŒ–æ•°æ®</h4><p>åœ¨ Spring åº”ç”¨ä¸­ï¼Œæœ‰å¤šç§ä½¿ç”¨æ•°æ®åº“çš„æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JPA æˆ– Hibernate å°†å¯¹è±¡æ˜ å°„ä¸ºå…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨å’Œåˆ—ã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¹²è„†æ”¾å¼ƒå…³ç³»å‹æ•°æ®åº“ï¼Œä½¿ç”¨å…¶ä»–ç±»å‹çš„æ•°æ®åº“ï¼Œå¦‚ Mongo æˆ– Neo4jã€‚</p>
<p>å¯¹äº Contacts åº”ç”¨æ¥è¯´ï¼Œå…³ç³»å‹æ•°æ®åº“æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚æˆ‘ä»¬å°†ä¼šä½¿ç”¨ H2 æ•°æ®åº“å’Œ JDBCï¼ˆä½¿ç”¨ Spring çš„ JdbcTemplateï¼‰ï¼Œè®©è¿™ä¸ªè¿‡ç¨‹å°½å¯èƒ½åœ°ç®€å•ã€‚</p>
<p>é€‰æ‹©è¿™ç§æ–¹æ¡ˆå°±éœ€è¦åœ¨æ„å»ºä¸­æ·»åŠ ä¸€äº›ä¾èµ–ã€‚JDBC Starter ä¾èµ–ä¼šå°† Spring JdbcTemplate éœ€è¦çš„æ‰€æœ‰å†…å®¹éƒ½å¼•å…¥è¿›æ¥ã€‚ä¸è¿‡ï¼Œè¦ç»“åˆä½¿ç”¨ H2 æ•°æ®åº“çš„è¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ·»åŠ  H2 ä¾èµ–ã€‚å¦‚æœä½¿ç”¨ Gradle çš„è¯ï¼Œåœ¨ dependencies ä»£ç å—æ·»åŠ å¦‚ä¸‹ä¸¤è¡Œä»£ç å°±èƒ½å®Œæˆè¿™é¡¹ä»»åŠ¡ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile(&quot;org.springframework.boot:spring-boot-starter-jdbc&quot;)compile(&quot;com.h2database:h2&quot;)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½¿ç”¨ Maven æ„å»ºçš„è¯ï¼Œæˆ‘ä»¬éœ€è¦å¦‚ä¸‹çš„ä¸¤ä¸ª <code>&lt;dependency&gt;</code> ä»£ç å—ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å°†è¿™ä¸¤é¡¹ä¾èµ–æ·»åŠ åˆ°æ„å»ºä¹‹ä¸­åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼–å†™ Repository ç±»äº†ã€‚å¦‚ä¸‹ç¨‹åºæ¸…å•ä¸­çš„ ContactRepository å°†ä¼šä½¿ç”¨æ³¨å…¥çš„ JdbcTemplate å®ç°åœ¨æ•°æ®åº“ä¸­è¯»å–å’Œå†™å…¥ Contact å¯¹è±¡ã€‚</p>
<center>ç¨‹åºæ¸…å• 21.6ã€€ContactRepository èƒ½å¤Ÿä»æ•°æ®åº“ä¸­å­˜å– Contact</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> contacts;<span class="keyword">import</span> java.util.List;<span class="keyword">import</span> java.sql.ResultSet;<span class="keyword">import</span> java.sql.SQLException;<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;<span class="keyword">import</span> org.springframework.jdbc.core.RowMapper;<span class="keyword">import</span> org.springframework.stereotype.Repository;<span class="meta">@Repositorypublic</span> <span class="class"><span class="keyword">class</span> <span class="title">ContactRepository</span> </span>&#123;  <span class="keyword">private</span> JdbcTemplate jdbc;    <span class="meta">@Autowired</span>  <span class="function"><span class="keyword">public</span> <span class="title">ContactRepository</span><span class="params">(JdbcTemplate jdbc)</span> </span>&#123;      <span class="keyword">this</span>.jdbc = jdbc;  &#125;  <span class="function"><span class="keyword">public</span> List&lt;Contact&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;      <span class="keyword">return</span> jdbc.query(<span class="string">&quot;select id, firstName, lastName, phoneNumber, emailAddress &quot;</span> +                        <span class="string">&quot;from contacts order by lastName&quot;</span>,                        <span class="keyword">new</span> RowMapper&lt;Contact&gt;() &#123;                            <span class="function"><span class="keyword">public</span> Contact <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException </span>&#123;                                Contact contact = <span class="keyword">new</span> Contact();                                contact.setId(rs.getLong(<span class="number">1</span>));                                contact.setFirstName(rs.getString(<span class="number">2</span>));                                contact.setLastName(rs.getString(<span class="number">3</span>));                                contact.setPhoneNumber(rs.getString(<span class="number">4</span>));                                contact.setEmailAddress(rs.getString(<span class="number">5</span>));                                <span class="keyword">return</span> contact;                            &#125;                        &#125;                       );  &#125;  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Contact contact)</span> </span>&#123;          jdbc.update(<span class="string">&quot;insert into contacts &quot;</span> +                  <span class="string">&quot;(firstName, lastName, phoneNumber, emailAddress) &quot;</span> +                  <span class="string">&quot;values (?, ?, ?, ?)&quot;</span>,                  contact.getFirstName(), contact.getLastName(),                  contact.getPhoneNumber(), contact.getEmailAddress());  &#125;  &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ ContactController ç±»ä¼¼ï¼Œè¿™ä¸ª Repository ç±»éå¸¸ç®€å•ã€‚å®ƒä¸ä¼ ç»Ÿ Spring åº”ç”¨ä¸­çš„ Repository ç±»å¹¶æ²¡æœ‰ä»€ä¹ˆå·®åˆ«ã€‚ä»å®ç°ä¸­ï¼Œæ ¹æœ¬æ— æ³•çœ‹å‡ºå®ƒè¦ç”¨äº Spring Boot çš„åº”ç”¨ç¨‹åºä¸­ã€‚findAll() æ–¹æ³•ä½¿ç”¨æ³¨å…¥çš„ JdbcTemplate ä»æ•°æ®åº“ä¸­è·å– Contact å¯¹è±¡ï¼Œsave() æ–¹æ³•ä½¿ç”¨æ³¨å…¥çš„ JdbcTemplate ä¿å­˜æ–°çš„ Contact å¯¹è±¡ã€‚å› ä¸º ContactRepository ä½¿ç”¨äº† @Repository æ³¨è§£ï¼Œå› æ­¤åœ¨ç»„ä»¶æ‰«æçš„æ—¶å€™ï¼Œå®ƒä¼šè¢«å‘ç°å¹¶åˆ›å»ºä¸º Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ beanã€‚</p>
<p>ä½†æ˜¯ï¼ŒJdbcTemplate å‘¢ï¼Ÿæˆ‘ä»¬éš¾é“ä¸éœ€è¦åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­å£°æ˜ JdbcTemplatebean å—ï¼Ÿä¸ºäº†å£°æ˜å®ƒï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯è¿˜è¦å£°æ˜ä¸€ä¸ª H2 DataSourceï¼Ÿ</p>
<p>å¯¹è¿™ä¸¤ä¸ªé—®é¢˜çš„ç®€çŸ­é—®ç­”å°±æ˜¯â€œä¸éœ€è¦â€ã€‚å½“ Spring Boot æ¢æµ‹åˆ° Spring çš„ JDBC æ¨¡å—å’Œ H2 åœ¨ç±»è·¯å¾„ä¸‹çš„æ—¶å€™ï¼Œè‡ªåŠ¨é…ç½®å°±ä¼šå‘æŒ¥ä½œç”¨ï¼Œå°†ä¼šè‡ªåŠ¨é…ç½® JdbcTemplatebean å’Œ H2DataSourcebeanã€‚Spring Boot å†ä¸€æ¬¡ä¸ºæˆ‘ä»¬å¤„ç†äº†æ‰€æœ‰çš„ Spring é…ç½®ã€‚</p>
<p>é‚£æ•°æ®åº“æ¨¡å¼è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæˆ‘ä»¬å¿…é¡»è¦è‡ªå·±æ¥å®šä¹‰åˆ›å»º contacts è¡¨çš„æ¨¡å¼ï¼Œå¯¹ä¸å¯¹ï¼Ÿ</p>
<p>è¿™ç»å¯¹æ˜¯æ­£ç¡®çš„ï¼Spring Boot æ²¡æœ‰åŠæ³•çŒœæµ‹ contacts è¡¨ä¼šæ˜¯ä»€ä¹ˆæ ·å­ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰æ¨¡å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> contacts (  id <span class="keyword">identity</span>,  firstName <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span>,  lastName <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,  phoneNumber <span class="type">varchar</span>(<span class="number">13</span>),  emailAddress <span class="type">varchar</span>(<span class="number">30</span>));</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦æœ‰ä¸€ç§æ–¹å¼åŠ è½½è¿™ä¸ª â€œcreate tableâ€ çš„ SQL å¹¶å°†å…¶åœ¨ H2 æ•°æ®åº“ä¸­æ‰§è¡Œå°±å¯ä»¥äº†ã€‚å¹¸å¥½ï¼ŒSpring Boot ä¹Ÿæ¶µç›–äº†è¿™é¡¹åŠŸèƒ½ã€‚å¦‚æœæˆ‘ä»¬å°†è¿™ä¸ªæ–‡ä»¶å‘½åä¸º schema.sql å¹¶å°†å…¶æ”¾åœ¨ç±»è·¯å¾„æ ¹ä¸‹ï¼ˆä¹Ÿå°±æ˜¯ Maven æˆ– Gradle é¡¹ç›®çš„ â€œsrc/main/resourcesâ€ ç›®å½•ä¸‹ï¼‰ï¼Œå½“åº”ç”¨å¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šæ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶å¹¶è¿›é¡¹æ•°æ®åŠ è½½ã€‚</p>
<h4 id="å°è¯•è¿è¡Œ"><a href="#å°è¯•è¿è¡Œ" class="headerlink" title="å°è¯•è¿è¡Œ"></a>å°è¯•è¿è¡Œ</h4><p>Contacts åº”ç”¨éå¸¸ç®€å•ï¼Œä½†æ˜¯ä¹Ÿç®—å¾—ä¸Šç°å®ä¸­çš„ Spring åº”ç”¨ã€‚å®ƒå…·æœ‰ Spring MVC æ§åˆ¶å™¨å’Œ Thymeleaf æ¨¡æ¿æ‰€å®šä¹‰çš„ Web å±‚ï¼Œå¹¶ä¸”å…·æœ‰ Repository å’Œ Spring  JdbcTemplate æ‰€å®šä¹‰çš„æŒä¹…å±‚ã€‚</p>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ç¼–å†™å®Œäº† Contacts æ‰€éœ€çš„åº”ç”¨çº§åˆ«ä»£ç ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰ç¼–å†™ä»»ä½•å½¢å¼çš„é…ç½®ã€‚æˆ‘ä»¬æ²¡æœ‰ç¼–å†™ä»»ä½• Spring é…ç½®ï¼Œä¹Ÿæ²¡æœ‰åœ¨ web.xml æˆ– Servlet åˆå§‹åŒ–ç±»ä¸­é…ç½® DispatcherServletã€‚</p>
<p>å¦‚æœæˆ‘è¯´ä¸éœ€è¦ç¼–å†™ä»»ä½•çš„é…ç½®ï¼Œä½ ä¼šç›¸ä¿¡å—ï¼Ÿ</p>
<p>è¿™åº”è¯¥åšä¸åˆ°å§ï¼Œæ¯•ç«Ÿåœ¨å¯¹Springçš„æ‰¹è¯„ä¸­ï¼Œäººä»¬éƒ½åœ¨è¯´ Spring å…¨æ˜¯é…ç½®ï¼Œè‚¯å®šæœ‰æˆ‘ä»¬å¿½ç•¥æ‰çš„ XML æ–‡ä»¶æˆ– Java é…ç½®ç±»ã€‚æˆ‘ä»¬æ‰€ç¼–å†™çš„ Spring åº”ç”¨ç¨‹åºæ ¹æœ¬å°±ä¸å¯èƒ½æ²¡æœ‰ä»»ä½•é…ç½®çš„â€¦â€¦é‚£ä¹ˆï¼Œæˆ‘ä»¬åˆ°åº•èƒ½åšåˆ°å—ï¼Ÿ</p>
<p>é€šå¸¸æ¥è®²ï¼ŒSpring Boot çš„è‡ªåŠ¨é…ç½®ç‰¹æ€§æ¶ˆé™¤äº†ç»å¤§éƒ¨åˆ†æˆ–è€…å…¨éƒ¨çš„é…ç½®ã€‚å› æ­¤ï¼Œå®Œå…¨å¯èƒ½ç¼–å†™å‡ºæ²¡æœ‰ä»»ä½•é…ç½®çš„ Spring åº”ç”¨ç¨‹åºã€‚å½“ç„¶ï¼Œè‡ªåŠ¨é…ç½®å¹¶ä¸èƒ½æ¶µç›–æ‰€æœ‰çš„åœºæ™¯ï¼Œå› æ­¤å…¸å‹çš„ Spring Boot åº”ç”¨ç¨‹åºä¾ç„¶ä¼šéœ€è¦ä¸€ç‚¹é…ç½®ã€‚</p>
<p>å…·ä½“åˆ° Contacts åº”ç”¨ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä»»ä½•çš„é…ç½®ã€‚Spring çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½å·²ç»å°†æ‰€æœ‰çš„äº‹æƒ…éƒ½åšå¥½äº†ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸ªç‰¹æ®Šçš„ç±»æ¥å¯åŠ¨ Spring Boot åº”ç”¨ã€‚ Spring æœ¬èº«å¹¶ä¸çŸ¥é“è‡ªåŠ¨é…ç½®çš„ä»»ä½•ä¿¡æ¯ã€‚ç¨‹åºæ¸…å• 21.7 ä¸­çš„ Application ç±»å°±æ˜¯ Spring Boot å¯åŠ¨ç±»çš„å…¸å‹ä¾‹å­ã€‚</p>
<center>ç¨‹åºæ¸…å• 21.7ã€€åˆå§‹åŒ– Spring Boot é…ç½®çš„ç®€å•å¯åŠ¨ç±»</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> contacts;<span class="keyword">import</span> org.springframework.boot.autoconfigure.EnableAutoConfiguration;<span class="keyword">import</span> org.springframework.boot.SpringApplication;<span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;<span class="meta">@ComponentScan</span><span class="meta">@EnableAutoConfigurationpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;    SpringApplication.run (Application, <span class="class"><span class="keyword">class</span>, <span class="title">args</span>)</span>;  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å¥½å§ï¼Œæˆ‘æ‰¿è®¤ Application ä¸­æœ‰é‚£ä¹ˆä¸€ç‚¹é…ç½®ã€‚å®ƒä½¿ç”¨ @ComponentScan æ³¨è§£æ¥å¯ç”¨ç»„ä»¶æ‰«æï¼Œå¦å¤–å®ƒè¿˜ä½¿ç”¨äº† @EnableAutoConfigurationï¼Œè¿™ä¼šå¯ç”¨ Spring Boot çš„è‡ªåŠ¨é…ç½®ç‰¹æ€§ã€‚ä½†æ˜¯ï¼Œä¹Ÿå°±è¿™ä¹ˆå¤šäº†ï¼é™¤äº†è¿™ä¸¤è¡Œä»£ç ä»¥å¤–ï¼ŒContacts å†ä¹Ÿæ²¡æœ‰ä»€ä¹ˆé…ç½®äº†ã€‚</p>
<p>Application ç±»æœ€æœ‰æ„æ€çš„ä¸€ç‚¹åœ¨äºå®ƒå…·æœ‰ä¸€ä¸ª main() æ–¹æ³•ã€‚ç¨åå°†ä¼šçœ‹åˆ°ï¼ŒSpring Boot åº”ç”¨ä¼šä»¥ä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•è¿è¡Œï¼Œæ­£æ˜¯è¿™é‡Œçš„ main() æ–¹æ³•ä½¿è¿™ä¸€åˆ‡æˆä¸ºå¯èƒ½ã€‚åœ¨ main() æ–¹æ³•ä¸­ï¼Œè¿™è¡Œä»£ç ä¼šå‘Šè¯‰ Spring Bootï¼ˆé€šè¿‡ SpringApplication ç±»ï¼‰æ ¹æ® Application ä¸­çš„é…ç½®ä»¥åŠå‘½ä»¤è¡Œä¸­çš„å‚æ•°æ¥è¿è¡Œã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬é©¬ä¸Šå°±å¯ä»¥è¿è¡Œåº”ç”¨äº†ã€‚å‰©ä¸‹å°±æ˜¯è¦è¿›è¡Œæ„å»ºã€‚å¦‚æœä½¿ç”¨ Gradle çš„è¯ï¼Œé‚£ä¹ˆå¦‚ä¸‹çš„å‘½ä»¤è¡Œä¼šå°†é¡¹ç›®æ„å»ºåˆ° â€œbuild/libs/contacts-0.1.0.jarâ€ ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gradle build</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ å–œæ¬¢ Maven çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼æ„å»ºé¡¹ç›®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mvn package</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡ŒMavenæ„å»ºåï¼Œä½ ä¼šåœ¨ target æ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°æ„å»ºå½¢æˆçš„ç»“æœã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œå®ƒäº†ã€‚æŒ‰ç…§ä¼ ç»Ÿçš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€è¦å°†åº”ç”¨çš„ WAR æ–‡ä»¶éƒ¨ç½²åˆ° Servlet å®¹å™¨ä¸­ï¼Œå¦‚ Tomcat æˆ– WebSphereã€‚ä½†æ˜¯åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç”šè‡³æ²¡æœ‰WAR æ–‡ä»¶â€”â€”æ„å»ºå½¢æˆçš„æ˜¯ä¸€ä¸ª JAR æ–‡ä»¶ã€‚</p>
<p>è¿™æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼ä»å‘½ä»¤è¡Œè¿è¡Œå®ƒï¼ˆå¼•ç”¨çš„æ˜¯åŸºäºGradleæ„å»ºçš„JARæ–‡ä»¶ï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> java -jar build/libs/contacts-0.1.0.jar</span></span><br></pre></td></tr></table></figure>

<p>åœ¨å‡ ç§’é’Ÿåï¼Œåº”ç”¨åº”è¯¥å·²ç»å¯åŠ¨å®Œæˆå¹¶ä¸”å¯ä»¥è®¿é—®äº†ã€‚æ‰“å¼€æµè§ˆå™¨è¿›å…¥ <a href="http://localhost:8080ï¼Œä½ å°±åº”è¯¥å¯ä»¥è¾“å…¥è”ç³»äººäº†ã€‚åœ¨è¾“å…¥å‡ ä¸ªè”ç³»äººåï¼Œæµè§ˆå™¨å°†ä¼šå¦‚å›¾">http://localhost:8080ï¼Œä½ å°±åº”è¯¥å¯ä»¥è¾“å…¥è”ç³»äººäº†ã€‚åœ¨è¾“å…¥å‡ ä¸ªè”ç³»äººåï¼Œæµè§ˆå™¨å°†ä¼šå¦‚å›¾</a> 21.1 æ‰€ç¤ºã€‚</p>
<p>ä½ å¯èƒ½è§‰å¾—è¿™å¹¶ä¸ç¬¦åˆ Web åº”ç”¨çš„è¿è¡Œæ–¹å¼ã€‚åƒè¿™æ ·ä»å‘½ä»¤è¡Œè¿è¡Œåº”ç”¨éå¸¸ç®€æ´å’Œæ–¹ä¾¿ï¼Œä½†æ˜¯ï¼Œå¯¹äºä½ æ¥è®²ï¼Œä¹Ÿè®¸è¿™å¹¶ä¸ç†æƒ³ã€‚åœ¨ä½ æ‰€å·¥ä½œçš„ç¯å¢ƒä¸­ï¼Œæœ‰å¯èƒ½éœ€è¦å°† Web åº”ç”¨ä½œä¸º WAR æ–‡ä»¶éƒ¨ç½²åˆ° Web å®¹å™¨ä¸­ã€‚å¦‚æœä¸æäº¤ WAR æ–‡ä»¶çš„è¯ï¼Œå¯èƒ½ä¸æ»¡è¶³å…¬å¸çš„éƒ¨ç½²ç­–ç•¥ã€‚</p>
<p><img src="spring-in-action-v4/image-20211114201133060.png" alt="image-20211114201133060"></p>
<center>å›¾ 21.1ã€€Spring Boot Contacts åº”ç”¨</center>

<p>å¥½çš„ï¼Œé‚£ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚</p>
<p>å³ä¾¿æ˜¯å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œé€šè¿‡å‘½ä»¤è¡Œæ¥è¿è¡Œåº”ç”¨ä¹Ÿæ˜¯åˆç†çš„æ–¹æ¡ˆï¼Œä½†æ˜¯æˆ‘ç†è§£ä½ å¯èƒ½éœ€è¦éµå¾ªå…¬å¸çš„éƒ¨ç½²æµç¨‹ã€‚è¿™æ„å‘³ç€éœ€è¦æ„å»ºå’Œéƒ¨ç½² WAR æ–‡ä»¶ã€‚</p>
<p>å¥½æ¶ˆæ¯æ˜¯ï¼Œå¦‚æœä½ éœ€è¦ WAR æ–‡ä»¶çš„è¯ï¼Œå¹¶æ²¡æœ‰å¿…è¦èˆå¼ƒ Spring Boot çš„ç®€æ´æ€§ã€‚éœ€è¦åšçš„äº‹æƒ…ä»…ä»…æ˜¯ç¨å¾®è°ƒæ•´ä¸€ä¸‹æ„å»ºæ–‡ä»¶ã€‚åœ¨ Gradle æ„å»ºä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ å¦‚ä¸‹è¿™è¡Œä»£ç æ¥åº”ç”¨ â€œwarâ€ æ’ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin &quot;war&quot;</span><br></pre></td></tr></table></figure>

<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦å°† â€œjarâ€ é…ç½®è°ƒæ•´ä¸º â€œwarâ€ã€‚è¿™å®é™…ä¸Šå°±æ˜¯å°† â€œjâ€ æ›¿æ¢ä¸º â€œwâ€ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">war &#123;  baseName = &quot;contacts&quot;  version = &quot;0.1.0&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯ Maven æ„å»ºçš„é¡¹ç›®ï¼Œé‚£ä¼šæ›´åŠ ç®€å•ã€‚åªéœ€å°† packaging ä» â€œjarâ€ æ›¿æ¢ä¸º â€œwarâ€ å³å¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°æ„å»ºé¡¹ç›®ï¼Œç„¶åå°†ä¼šåœ¨æ„å»ºç›®å½•ä¸­æ‰¾åˆ° contacts-0.1.0.war æ–‡ä»¶ã€‚è¿™ä¸ª WAR æ–‡ä»¶æ–‡ä»¶å¯ä»¥éƒ¨ç½²åˆ°ä»»æ„æ”¯æŒ Servlet 3.0 çš„å®¹å™¨ä¸­ã€‚å¦å¤–ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œè¿™ä¸ªåº”ç”¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> java -jar build/libs/contacts-0.1.0.war</span></span><br></pre></td></tr></table></figure>

<p>æ²¡é”™ï¼šè¿™æ˜¯ä¸€ä¸ªå¯è¿è¡Œçš„ WAR æ–‡ä»¶ï¼å¯¹äºä¸¤ç§åœºæ™¯æ¥è¯´ï¼Œè¿™éƒ½æ˜¯æœ€ä½³çš„æ–¹æ¡ˆã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒSpring Boot èƒ½å¤Ÿåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå°½å¯èƒ½ç®€åŒ– Spring åº”ç”¨çš„éƒ¨ç½²ã€‚Spring Boot Stater ç®€åŒ–äº†é¡¹ç›®æ„å»ºçš„ä¾èµ–ï¼Œè‡ªåŠ¨é…ç½®æ¶ˆé™¤äº†æ˜¾å¼çš„ Spring é…ç½®ã€‚ä½†ç¨åä½ ä¼šçœ‹åˆ°ï¼Œå¦‚æœå†ç»“åˆ Groovyï¼Œå®ƒä¼šæ›´åŠ ç®€å•ã€‚</p>
<h3 id="ç»„åˆä½¿ç”¨Groovyä¸Spring-Boot-CLI"><a href="#ç»„åˆä½¿ç”¨Groovyä¸Spring-Boot-CLI" class="headerlink" title="ç»„åˆä½¿ç”¨Groovyä¸Spring Boot CLI"></a>ç»„åˆä½¿ç”¨Groovyä¸Spring Boot CLI</h3><p>Groovyç¼–ç¨‹è¯­è¨€è¦æ¯”Javaç®€å•å¾—å¤šã€‚å®ƒçš„è¯­æ³•å…è®¸æœ‰ä¸€äº›å¿«æ·æ–¹å¼ï¼Œæ¯”å¦‚çœç•¥åˆ†å·å’Œpublicå…³é”®è¯ã€‚åŒæ—¶ï¼ŒGroovyç±»ä¸­çš„å±æ€§ä¸åƒJavaé‚£æ ·éœ€è¦Setterå’ŒGetteræ–¹æ³•ã€‚å½“ç„¶ï¼ŒGroovyè¿˜æœ‰å…¶ä»–çš„ä¸€äº›å±æ€§ï¼Œèƒ½å¤Ÿæ¶ˆé™¤Javaä»£ç ä¸­å¾ˆå¤šçš„ç¹æ–‡ç¼›èŠ‚ã€‚</p>
<p>å¦‚æœä½ æ„¿æ„ä½¿ç”¨Groovyç¼–å†™åº”ç”¨ä»£ç å¹¶é€šè¿‡Spring Boot CLIè¿è¡Œçš„è¯ï¼Œé‚£ä¹ˆSpring Bootèƒ½å¤Ÿå€ŸåŠ©Groovyçš„ç®€æ´æ€§è¿›ä¸€æ­¥ç®€åŒ–Springåº”ç”¨ã€‚ä¸ºäº†é˜è¿°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨Groovyæ¥é‡æ–°ç¼–å†™Contactsåº”ç”¨ç¨‹åºã€‚</p>
<p>ä¸ºä»€ä¹ˆä¸å‘¢ï¼Ÿåœ¨åˆå§‹ç‰ˆæœ¬çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬åªæœ‰å‡ ä¸ªå°çš„Javaç±»ï¼Œå› æ­¤ä½¿ç”¨Groovyè¿›è¡Œé‡å†™ä¹Ÿæ²¡æœ‰å¤ªå¤šçš„å·¥ä½œé‡ã€‚æˆ‘ä»¬å¯ä»¥é‡ç”¨ç›¸åŒçš„Thymeleafæ¨¡æ¿å’Œschema.sqlæ–‡ä»¶ã€‚æ—¢ç„¶æˆ‘å®£ç§°Groovyèƒ½å¤Ÿè¿›ä¸€æ­¥ç®€åŒ–Springï¼Œé‚£é‡å†™åº”ç”¨ä¹Ÿä¸æ˜¯ä»€ä¹ˆå¤§äº‹å„¿ã€‚</p>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜ä¼šç§»é™¤ä¸€äº›ä»£ç ã€‚Spring Boot CLIæœ¬èº«å°±æ˜¯å¯åŠ¨å™¨ï¼Œæ‰€ä»¥ä¸å†éœ€è¦å‰é¢æ‰€åˆ›å»ºçš„Applicationç±»ã€‚Mavenå’ŒGradleæ„å»ºæ–‡ä»¶ä¹Ÿä¸å†éœ€è¦äº†ï¼Œå› ä¸ºæˆ‘ä»¬å°†ä¼šé€šè¿‡CLIè¿è¡Œæœªç¼–è¯‘çš„Groovyæ–‡ä»¶ã€‚å°‘äº†Mavenå’ŒGradleä¹‹åï¼Œé¡¹ç›®çš„æ•´ä½“ç»“æ„å°†ä¼šå˜å¾—æ›´åŠ æ‰å¹³åŒ–ï¼Œæ–°çš„é¡¹ç›®ç»“æ„å°†ä¼šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="spring-in-action-v4/image-20211114201549663.png" alt="image-20211114201549663"></p>
<p>schema.sqlã€style.csså’Œhome.htmlå°†ä¼šä¿æŒåŸæ ·ï¼Œä½†æ˜¯éœ€è¦å°†Javaç±»è½¬æ¢ä¸ºGroovyã€‚æˆ‘ä»¬å…ˆä»ä½¿ç”¨Groovyç¼–å†™Webå±‚å¼€å§‹ã€‚</p>
<h4 id="ç¼–å†™Groovyæ§åˆ¶å™¨"><a href="#ç¼–å†™Groovyæ§åˆ¶å™¨" class="headerlink" title="ç¼–å†™Groovyæ§åˆ¶å™¨"></a>ç¼–å†™Groovyæ§åˆ¶å™¨</h4><p>å¦‚å‰æ‰€è¿°ï¼ŒGroovyä¸åƒJavaé‚£æ ·æœ‰å¾ˆå¤šçš„ç¹æ–‡ç¼›èŠ‚ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬åœ¨ç¼–å†™Groovyä»£ç çš„æ—¶å€™ï¼Œå¯ä»¥çœç•¥å¦‚ä¸‹çš„å†…å®¹ï¼š</p>
<ul>
<li>åˆ†å·ï¼›</li>
<li>åƒpublicå’Œprivateè¿™æ ·çš„ä¿®é¥°ç¬¦ï¼›</li>
<li>å±æ€§çš„Setterå’ŒGetteræ–¹æ³•ï¼›</li>
<li>æ–¹æ³•è¿”å›å€¼çš„returnå…³é”®å­—ã€‚</li>
</ul>
<p>å€ŸåŠ©Groovyæ›´åŠ çµæ´»çš„è¯­æ³•ï¼ˆä»¥åŠSpring Bootçš„é­”åŠ›ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Groovyé‡å†™ContactControllerç±»ï¼Œå¦‚ç¨‹åºæ¸…å•21.8æ‰€ç¤ºã€‚</p>
<p>ç¨‹åºæ¸…å•21.8ã€€ä½¿ç”¨Groovyç¼–å†™çš„ContactControllerè¦æ¯”ä½¿ç”¨Javaæ›´ç®€å•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Grab(&quot;spring-boot-starter-actuator&quot;)</span><span class="meta">@Grab(&quot;thymeleaf-spring4&quot;)</span><span class="meta">@Controller</span><span class="meta">@RequestMapping(&quot;/&quot;)</span><span class="class"><span class="keyword">class</span> <span class="title">ContactController</span> </span>&#123;	<span class="meta">@Autowired</span>	ContactRepository contactRepo	<span class="meta">@RequestMapping(method=RequestMethod.GET)</span>	<span class="function">String <span class="title">home</span><span class="params">(Map&lt;String,Object&gt; model)</span> </span>&#123;		List&lt;Contact&gt; contacts = contactRepo.findAll()		model.putAll([contacts: contacts])		<span class="string">&quot;home&quot;</span>	&#125;	<span class="meta">@RequestMapping(method=RequestMethod.POST)</span>	<span class="function">String <span class="title">submit</span><span class="params">(Contact contact)</span> </span>&#123;		contactRepo.save(contact)		<span class="string">&quot;redirect:/&quot;</span>	&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„ContactControllerè¦æ¯”å¯¹åº”çš„Javaç‰ˆæœ¬æ›´åŠ ç®€æ´ã€‚æ’é™¤æ‰Groovyä¸éœ€è¦çš„å†…å®¹åï¼ŒContactControlleræ›´åŠ ç®€çŸ­ä¹Ÿæ›´æ˜“äºé˜…è¯»ã€‚ç¨‹åºæ¸…å•21.8è¿˜ç§»é™¤äº†ä¸€äº›å†…å®¹ï¼Œä½ å¯èƒ½ä¹Ÿå‘ç°äº†ï¼Œè¿™é‡Œæ²¡æœ‰importä»£ç è¡Œï¼Œåœ¨Javaä»£ç ä¸­è¿™æ˜¯å¾ˆå¸¸è§çš„ã€‚Groovyé»˜è®¤ä¼šå¯¼å…¥ä¸€äº›åŒ…å’Œç±»ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>java.io.java.lang.*</li>
<li>java.math.BigDecimal</li>
<li>java.math.BigInteger</li>
<li>java.net.*</li>
<li>java.util.*</li>
<li>groovy.lang.*</li>
<li>groovy.util.*</li>
</ul>
<p>å› ä¸ºæœ‰äº†è¿™äº›é»˜è®¤çš„å¯¼å…¥ï¼Œæ‰€ä»¥ContactControllerå°±ä¸éœ€è¦å¯¼å…¥Listç±»äº†ã€‚è¿™ä¸ªç±»ä½äºjava.utilåŒ…ä¸­ï¼ŒåŒ…å«åœ¨é»˜è®¤çš„å¯¼å…¥é‡Œé¢ã€‚</p>
<p>ä½†æ˜¯ï¼Œåƒ@Controllerã€@RequestMappingã€@Autowiredä»¥åŠ@RequestMethodè¿™æ ·çš„Springç±»å‹è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿå®ƒä»¬æ²¡æœ‰ä½äºé»˜è®¤çš„å¯¼å…¥ä¸­ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•çœç•¥importä»£ç è¡Œå‘¢ï¼Ÿ</p>
<p>ç¨åï¼Œå½“æˆ‘ä»¬è¿è¡Œåº”ç”¨çš„æ—¶å€™ï¼ŒSpring Boot CLIå°†ä¼šè¯•å›¾ä½¿ç”¨Groovyç¼–è¯‘å™¨ç¼–è¯‘è¿™äº›Groovyç±»ã€‚å› ä¸ºè¿™äº›ç±»å‹æ²¡æœ‰å¯¼å…¥è¿›æ¥ï¼Œæ‰€ä»¥å°†ä¼šå¯¼è‡´ç¼–è¯‘å¤±è´¥ã€‚</p>
<p>ä½†æ˜¯ï¼ŒSpring Boot CLIå´ä¸ä¼šå°±è¿™æ ·è½»æ˜“æ”¾å¼ƒï¼Œåœ¨è¿™é‡ŒCLIå°†è‡ªåŠ¨é…ç½®è¾¾åˆ°äº†ä¸€ä¸ªæ–°é«˜åº¦ã€‚CLIå°†ä¼šè¯†åˆ«å‡ºå¤±è´¥æ˜¯å› ä¸ºç¼ºå°‘Springç±»å‹ï¼Œå®ƒä¼šé‡‡å–ä¸¤ä¸ªæ­¥éª¤æ¥ä¿®æ­£è¿™ä¸ªé—®é¢˜ã€‚é¦–å…ˆä¼šè·å–Spring Boot Web Starterä¾èµ–å¹¶å°†å…¶ä¾èµ–çš„å…¶ä»–å†…å®¹éƒ½æ·»åŠ åˆ°ç±»è·¯å¾„ä¸‹ï¼ˆè¿™æ ·ä¼šä¸‹è½½å¹¶æ·»åŠ JARåˆ°ç±»è·¯å¾„ä¸‹ï¼‰ã€‚ç„¶åï¼Œå®ƒä¼šå°†å¿…è¦çš„åŒ…æ·»åŠ åˆ°Groovyç¼–è¯‘å™¨çš„é»˜è®¤å¯¼å…¥åˆ—è¡¨ä¸­ï¼Œç„¶åé‡æ–°å°è¯•ç¼–è¯‘ä»£ç ã€‚</p>
<p>CLIè¿™ç§è‡ªåŠ¨æ·»åŠ ä¾èµ–/è‡ªåŠ¨å¯¼å…¥çš„ç»“æœå°±æ˜¯æˆ‘ä»¬çš„æ§åˆ¶å™¨ç±»ä¸éœ€è¦ä»»ä½•çš„importè¯­å¥äº†ï¼Œå¹¶ä¸”æˆ‘ä»¬æ²¡æœ‰å¿…è¦å†æ‰‹åŠ¨æˆ–è€…é€šè¿‡Mavenã€Gradleæ¥è§£æSpringåº“ã€‚Spring Boot CLIå°†ä¼šä¸ºæˆ‘ä»¬å®Œæˆæ‰€æœ‰çš„äº‹æƒ…ã€‚</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬åé€€ä¸€æ­¥ï¼Œè€ƒè™‘ä¸€ä¸‹è¿™é‡Œéƒ½å‘ç”Ÿäº†ä»€ä¹ˆã€‚é€šè¿‡åœ¨ä»£ç ä¸­ä½¿ç”¨Spring MVCç±»å‹ï¼Œå¦‚@Controlleræˆ–@RequestMappingï¼ŒCLIå°†ä¼šè‡ªåŠ¨è§£æSpring Boot Web Starterä¾èµ–ã€‚å°†Web Starterçš„ä¾èµ–ä¼ é€’æ·»åŠ åˆ°ç±»è·¯å¾„ä¹‹åï¼ŒSpring Bootçš„è‡ªåŠ¨é…ç½®å°†ä¼šå‘æŒ¥ä½œç”¨ï¼Œå®ƒä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨é…ç½®Spring MVCåŠŸèƒ½æ‰€éœ€çš„beanã€‚ä¸è¿‡ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦åšçš„ä»…ä»…æ˜¯ä½¿ç”¨è¿™äº›ç±»å‹ï¼ŒSpring Bootå°†ä¼šå¤„ç†æ‰€æœ‰çš„äº‹æƒ…ã€‚</p>
<p>å½“ç„¶ï¼ŒCLIçš„åŠŸèƒ½ä¹Ÿä¼šæœ‰ä¸€äº›é™åˆ¶ã€‚å°½ç®¡å®ƒçŸ¥é“å¦‚ä½•è§£æä¼—å¤šçš„Springä¾èµ–ï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªåŠ¨å°†å¾ˆå¤šSpringç±»å‹ï¼ˆä»¥åŠå¾ˆå¤šå…¶ä»–çš„åº“ï¼‰æ·»åŠ åˆ°å¯¼å…¥ä¸­ï¼Œä½†æ˜¯å®ƒä¸èƒ½è‡ªåŠ¨è§£æå’Œå¯¼å…¥æ‰€æœ‰çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨Thymeleafæ¨¡æ¿æ˜¯ä¸€ä¸ªå¯æ›¿æ¢çš„æ–¹æ¡ˆï¼Œæ‰€ä»¥è¦åœ¨ä»£ç ä¸­é€šè¿‡@Grabæ˜¾ç¤ºå£°æ˜ã€‚</p>
<p>è¿˜è¦æ³¨æ„ï¼Œå¾ˆå¤šçš„ä¾èµ–éƒ½æ²¡æœ‰å¿…è¦æŒ‡å®šgroup IDå’Œç‰ˆæœ¬å·ã€‚Spring Bootå°†ä¼šåœ¨è§£æ@Grabä¾èµ–çš„æ—¶å€™å‚ä¸è¿›æ¥ï¼Œå°†ç¼ºå¤±çš„group IDå’Œç‰ˆæœ¬å·æ·»åŠ ä¸Šã€‚</p>
<p>å€ŸåŠ©@Grabæ³¨è§£ï¼Œæˆ‘ä»¬å£°æ˜äº†è¦ä½¿ç”¨Thymeleafï¼Œè¿™ä¼šè§¦å‘è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼Œå°†ä¼šè‡ªåŠ¨é…ç½®åœ¨Spring MVCä¸­æ”¯æŒThymeleafæ¨¡æ¿æ‰€éœ€çš„beanã€‚</p>
<p>å°½ç®¡Contactç±»ä¸Spring Bootæ²¡æœ‰å¤ªå¤§å…³ç³»ï¼Œä½†ä¸ºäº†æ ·ä¾‹çš„å®Œæ•´æ€§ï¼Œæˆ‘è¿˜æ˜¯å°†å®ƒçš„Groovyä»£ç å±•ç°åœ¨äº†ä¸‹é¢ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> &#123;</span>  <span class="keyword">long</span> id  String firstName  String lastName  String phoneNumber  String emailAddress&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒContactä¹Ÿæ›´åŠ ç®€æ´ï¼Œæ²¡æœ‰åˆ†å·ã€å­˜å–å™¨æ–¹æ³•ä»¥åŠåƒpublicå’Œprivateè¿™æ ·çš„ä¿®é¥°ç¬¦ã€‚è¿™å®Œå…¨å½’åŠŸäºGroovyç®€å•çš„è¯­æ³•ï¼Œå…¶å®Spring Bootå¹¶æ²¡æœ‰å‚ä¸ç®€åŒ–Contactç±»ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•å€ŸåŠ©Spring Boot CLIå’ŒGroovyæ¥ç®€åŒ–Repositoryç±»ã€‚</p>
<h4 id="ä½¿ç”¨Groovy-Repositoryå®ç°æ•°æ®æŒä¹…åŒ–"><a href="#ä½¿ç”¨Groovy-Repositoryå®ç°æ•°æ®æŒä¹…åŒ–" class="headerlink" title="ä½¿ç”¨Groovy Repositoryå®ç°æ•°æ®æŒä¹…åŒ–"></a>ä½¿ç”¨Groovy Repositoryå®ç°æ•°æ®æŒä¹…åŒ–</h4><p>ContactControllerä¸­æ‰€ç”¨åˆ°çš„Groovyå’ŒSpring Boot CLIæŠ€å·§éƒ½å¯ä»¥åº”ç”¨åˆ°ContactRepositoryä¸­ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†Groovyç‰ˆæœ¬çš„ContactRepositoryã€‚</p>
<p>ç¨‹åºæ¸…å•21.9ã€€ä½¿ç”¨Groovyç¼–å†™æ—¶ï¼ŒContactRepositoryä¼šæ›´åŠ ç®€æ´é™¤äº†Groovyåœ¨è¯­æ³•æ–¹é¢å¸¦æ¥çš„æ˜æ˜¾æ”¹å–„ï¼Œè¿™ä¸ªæ–°ç‰ˆçš„ContactRepositoryç±»ä½¿ç”¨äº†Spring Boot CLIè‡ªåŠ¨å¯¼å…¥JdbcTemplateå’ŒRowMapperã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå½“CLIå‘ç°æˆ‘ä»¬ä½¿ç”¨è¿™äº›ç±»å‹çš„æ—¶å€™ï¼Œå°†ä¼šè‡ªåŠ¨è§£æJDBC Starterä¾èµ–ã€‚</p>
<p>åªæœ‰ä¸¤ä»¶äº‹æƒ…æ˜¯CLIçš„è‡ªåŠ¨å¯¼å…¥å’Œè‡ªåŠ¨è§£ææ— æ³•å¸®åŠ©æˆ‘ä»¬çš„ã€‚å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¾ç„¶éœ€è¦å¯¼å…¥ResultSetã€‚å¦å¤–ï¼ŒSpring Bootæ— æ³•çŸ¥é“æˆ‘ä»¬ä½¿ç”¨å“ªç§æ•°æ®åº“ï¼Œå› æ­¤å¿…é¡»è¦ä½¿ç”¨@Grabæ³¨è§£æ·»åŠ H2æ•°æ®åº“ã€‚æˆ‘ä»¬å·²ç»å°†æ‰€æœ‰Javaç±»è½¬æ¢æˆäº†Groovyå¹¶åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å‘æŒ¥äº†SpringBootçš„é­”åŠ›ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œåº”ç”¨äº†ã€‚</p>
<h4 id="è¿è¡ŒSpring-Boot-CLI"><a href="#è¿è¡ŒSpring-Boot-CLI" class="headerlink" title="è¿è¡ŒSpring Boot CLI"></a>è¿è¡ŒSpring Boot CLI</h4><p>åœ¨ç¼–è¯‘å®ŒJavaåº”ç”¨ä¹‹åï¼Œæœ‰ä¸¤ç§æ–¹æ³•æ¥è¿è¡Œå®ƒã€‚æˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¯æ‰§è¡ŒJARæˆ–WARæ–‡ä»¶çš„å½¢å¼åœ¨å‘½ä»¤è¡Œè¿è¡Œï¼Œä¹Ÿå¯ä»¥å°†WARæ–‡ä»¶éƒ¨ç½²åˆ°Servletå®¹å™¨ä¸­è¿è¡Œã€‚Spring Boot CLIæä¾›äº†ç¬¬ä¸‰ç§å¯é€‰æ–¹æ¡ˆã€‚</p>
<p>ä»åå­—åº”è¯¥ä¹Ÿèƒ½çŒœå¾—å‡ºæ¥ï¼Œé€šè¿‡Spring Boot CLIè¿è¡Œåº”ç”¨éœ€è¦ä½¿ç”¨å‘½ä»¤è¡Œã€‚ä½†æ˜¯ï¼Œå€ŸåŠ©CLIï¼Œæˆ‘ä»¬ä¸éœ€è¦é¦–å…ˆå°†åº”ç”¨æ„å»ºä¸ºJARæˆ–WARæ–‡ä»¶ã€‚è¿è¡Œåº”ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†Groovyæºç ä¼ ç»™CLIã€‚</p>
<p>å®‰è£…CLI</p>
<p>ä¸ºäº†ä½¿ç”¨Spring Boot CLIï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…å®ƒã€‚æœ‰å¤šç§æ–¹æ¡ˆå¯ä¾›é€‰æ‹©ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>Groovyç¯å¢ƒç®¡ç†å™¨ï¼ˆGroovy Environment Manager ï¼ŒGVMï¼‰ï¼›</li>
<li>Homebrewï¼›</li>
<li>æ‰‹åŠ¨å®‰è£…ã€‚</li>
</ul>
<p>å¦‚æœä½¿ç”¨GVMå®‰è£…CLIçš„è¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gvm install springboot</span></span><br></pre></td></tr></table></figure>

<p>ä½ å¦‚æœä½¿ç”¨OS Xçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Homebrewæ¥å®‰è£…Spring Boot CLIï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brew tap pivotal/tap$ brew install springboot</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æ„¿æ„æ‰‹åŠ¨å®‰è£…Spring Bootçš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥ä¸‹è½½å¹¶æŒ‰ç…§è¯¥ç«™ç‚¹<a target="_blank" rel="noopener" href="http://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/%E7%9A%84%E6%8C%87%E5%8D%97%E8%BF%9B%E8%A1%8C%E5%AE%89%E8%A3%85%E3%80%82">http://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/çš„æŒ‡å—è¿›è¡Œå®‰è£…ã€‚</a></p>
<p>CLIå®‰è£…å®Œæˆä¹‹åï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤æ£€æŸ¥å®‰è£…æƒ…å†µä»¥åŠå½“å‰ä½¿ç”¨çš„æ˜¯å“ªä¸ªç‰ˆæœ¬ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring --version</span></span><br></pre></td></tr></table></figure>

<p>å‡è®¾å®‰è£…æ²¡æœ‰é—®é¢˜çš„è¯ï¼Œé‚£å°±å¯ä»¥è¿è¡ŒContactsåº”ç”¨äº†ã€‚</p>
<p>ä½¿ç”¨CLIè¿è¡ŒContactsåº”ç”¨</p>
<p>è¦ä½¿ç”¨Spring Boot CLIè¿è¡Œåº”ç”¨çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‘½ä»¤è¡Œè¾“å…¥spring runï¼Œç„¶ååé¢å†åŠ ä¸Šè¦é€šè¿‡CLIè¿è¡Œçš„ä¸€ä¸ªæˆ–å¤šä¸ªGroovyæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨åªæœ‰ä¸€ä¸ªGroovyæ–‡ä»¶çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·è¿è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring run Hello.groovy</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±ä¼šé€šè¿‡CLIè¿è¡Œä¸€ä¸ªåä¸ºHello.groovyçš„Groovyç±»ã€‚</p>
<p>å¦‚æœä½ çš„åº”ç”¨æœ‰å¤šä¸ªGroovyç±»æ–‡ä»¶çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡é€šé…ç¬¦æ¥è¿è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤º: </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring run *.groovy</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼Œå¦‚æœè¿™äº›Groovyç±»æ–‡ä»¶ä½äºåŒä¸€ä¸ªæˆ–å¤šä¸ªå­ç›®å½•ä¸‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Anté£æ ¼çš„é€šé…ç¬¦é€’å½’æŸ¥æ‰¾Groovyç±»ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring run **/*.groovy</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºContactsåº”ç”¨æœ‰ä¸‰ä¸ªéœ€è¦è¯»å–çš„Groovyç±»ï¼Œè€Œä¸”å®ƒä»¬éƒ½ä½äºé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œæ‰€ä»¥ä¸Šè¿°çš„åä¸¤ç§æ–¹æ¡ˆéƒ½æ˜¯å¯è¡Œçš„ã€‚åœ¨è¿è¡Œåº”ç”¨ä¹‹åï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿåœ¨æµè§ˆå™¨ä¸­è®¿é—®<a href="http://localhost:8080ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°ä¸ä¹‹å‰ç›¸åŒçš„Contactsåº”ç”¨ã€‚">http://localhost:8080ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°ä¸ä¹‹å‰ç›¸åŒçš„Contactsåº”ç”¨ã€‚</a></p>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»¥ä¸¤ç§æ–¹å¼ç¼–å†™äº†Spring Bootåº”ç”¨ï¼šä¸€ç§ä½¿ç”¨Javaï¼Œå¦ä¸€ç§ä½¿ç”¨Groovyã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸­ï¼ŒSpring Bootåœ¨æœ€å°åŒ–æ¨¡æ¿é…ç½®ä»¥åŠæ„å»ºä¾èµ–æ–¹é¢éƒ½å‘æŒ¥äº†å¾ˆå¤§çš„ä½œç”¨ã€‚Spring Bootè¿˜æœ‰å¦å¤–ä¸€é¡¹åŠŸèƒ½ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•å€ŸåŠ©Spring Boot Actuatorä¸ºWebåº”ç”¨å¼•å…¥ç®¡ç†ç«¯ç‚¹ã€‚</p>
<h3 id="é€šè¿‡Actuatorè·å–äº†è§£åº”ç”¨å†…éƒ¨çŠ¶å†µ"><a href="#é€šè¿‡Actuatorè·å–äº†è§£åº”ç”¨å†…éƒ¨çŠ¶å†µ" class="headerlink" title="é€šè¿‡Actuatorè·å–äº†è§£åº”ç”¨å†…éƒ¨çŠ¶å†µ"></a>é€šè¿‡Actuatorè·å–äº†è§£åº”ç”¨å†…éƒ¨çŠ¶å†µ</h3><p>Spring Boot Actuatoræ‰€å®Œæˆçš„ä¸»è¦åŠŸèƒ½å°±æ˜¯ä¸ºåŸºäºSpring Bootçš„åº”ç”¨æ·»åŠ å¤šä¸ªæœ‰ç”¨çš„ç®¡ç†ç«¯ç‚¹ã€‚è¿™äº›ç«¯ç‚¹åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªå†…å®¹ã€‚</p>
<ul>
<li>GET /autoconfigï¼šæè¿°äº†Spring Bootåœ¨ä½¿ç”¨è‡ªåŠ¨é…ç½®çš„æ—¶å€™ï¼Œæ‰€åšå‡ºçš„å†³ç­–ï¼›</li>
<li>GET /beansï¼šåˆ—å‡ºè¿è¡Œåº”ç”¨æ‰€é…ç½®çš„beanï¼›</li>
<li>GET /configpropsï¼šåˆ—å‡ºåº”ç”¨ä¸­èƒ½å¤Ÿç”¨æ¥é…ç½®beançš„æ‰€æœ‰å±æ€§åŠå…¶å½“å‰çš„å€¼ï¼›</li>
<li>GET /dumpï¼šåˆ—å‡ºåº”ç”¨çš„çº¿ç¨‹ï¼ŒåŒ…æ‹¬æ¯ä¸ªçº¿ç¨‹çš„æ ˆè·Ÿè¸ªä¿¡æ¯ï¼›</li>
<li>GET /envï¼šåˆ—å‡ºåº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰å¯ç”¨çš„ç¯å¢ƒå’Œç³»ç»Ÿå±æ€§å˜é‡ï¼›</li>
<li>GET /env/{name}ï¼šå±•ç°æŸä¸ªç‰¹å®šç¯å¢ƒå˜é‡å’Œå±æ€§å˜é‡çš„å€¼ï¼›</li>
<li>GET /healthï¼šå±•ç°å½“å‰åº”ç”¨çš„å¥åº·çŠ¶å†µï¼›</li>
<li>GET /infoï¼šå±•ç°åº”ç”¨ç‰¹å®šçš„ä¿¡æ¯ï¼›</li>
<li>GET /metricsï¼šåˆ—å‡ºåº”ç”¨ç›¸å…³çš„æŒ‡æ ‡ï¼ŒåŒ…æ‹¬è¯·æ±‚ç‰¹å®šç«¯ç‚¹çš„è¿è¡Œæ¬¡æ•°ï¼›</li>
<li>GET /metrics/{name}ï¼šå±•ç°åº”ç”¨ç‰¹å®šæŒ‡æ ‡é¡¹çš„æŒ‡æ ‡çŠ¶å†µï¼›</li>
<li>POST /shutdownï¼šå¼ºåˆ¶å…³é—­åº”ç”¨ï¼›</li>
<li>GET /traceï¼šåˆ—å‡ºåº”ç”¨æœ€è¿‘è¯·æ±‚ç›¸å…³çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬è¯·æ±‚å’Œå“åº”å¤´ã€‚</li>
</ul>
<p>ä¸ºäº†å¯ç”¨Actuatorï¼Œæˆ‘ä»¬åªéœ€å°†Actuator Starterä¾èµ–æ·»åŠ åˆ°é¡¹ç›®ä¸­å³å¯ã€‚å¦‚æœä½ ä½¿ç”¨Groovyç¼–å†™åº”ç”¨å¹¶é€šè¿‡Spring Boot CLIæ¥è¿è¡Œï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡@Grabæ³¨è§£æ¥æ·»åŠ Actuator Starterï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Grab(&quot;spring-boot-starter-actuator&quot;)</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½¿ç”¨Gradleæ„å»ºJavaåº”ç”¨çš„è¯ï¼Œé‚£ä¹ˆåœ¨build.gradleçš„dependenciesä»£ç å—ä¸­éœ€è¦æ·»åŠ å¦‚ä¸‹çš„ä¾èµ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile(<span class="string">&quot;org.springframework.boot:spring-boot-starter-actuator&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼Œåœ¨é¡¹ç›®çš„Maven pom.xmlæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ å¦‚ä¸‹çš„<dependency>ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ·»åŠ å®ŒSpring Boot Actuatorä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°æ„å»ºå¹¶å¯åŠ¨åº”ç”¨ï¼Œç„¶åæ‰“å¼€æµè§ˆå™¨è®¿é—®ä»¥ä¸Šæ‰€è¿°çš„ç«¯ç‚¹æ¥è·å–æ›´å¤šä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæƒ³è¦æŸ¥çœ‹Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰çš„beanï¼Œé‚£ä¹ˆå¯ä»¥è®¿é—®<a target="_blank" rel="noopener" href="http://localhost:8080/beans%E3%80%82%E5%A6%82%E6%9E%9C%E4%BD%BF%E7%94%A8curl%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E7%9A%84%E8%AF%9D%EF%BC%8C%E6%89%80%E5%BE%97%E5%88%B0%E7%9A%84%E7%BB%93%E6%9E%9C%E5%B0%86%E4%BC%9A%E5%A6%82%E4%B8%8B%E6%89%80%E7%A4%BA%EF%BC%88%E4%B8%BA%E4%BA%86%E4%BE%BF%E4%BA%8E%E9%98%85%E8%AF%BB%EF%BC%8C%E8%BF%9B%E8%A1%8C%E4%BA%86%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%92%8C%E5%88%A0%E5%87%8F%EF%BC%89%EF%BC%9A">http://localhost:8080/beansã€‚å¦‚æœä½¿ç”¨curlå‘½ä»¤è¡Œå·¥å…·çš„è¯ï¼Œæ‰€å¾—åˆ°çš„ç»“æœå°†ä¼šå¦‚ä¸‹æ‰€ç¤ºï¼ˆä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œè¿›è¡Œäº†æ ¼å¼åŒ–å’Œåˆ å‡ï¼‰ï¼š</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl http://localhost:8080/beans[  &#123;    <span class="string">&quot;beans&quot;</span>: [      &#123;        <span class="string">&quot;bean&quot;</span>: <span class="string">&quot;contactController&quot;</span>,        <span class="string">&quot;dependencies&quot;</span>: [          <span class="string">&quot;contactRepository          ],          &quot;</span>resource<span class="string">&quot;: &quot;</span>null<span class="string">&quot;,          &quot;</span>scope<span class="string">&quot;: &quot;</span>singleton<span class="string">&quot;,          &quot;</span><span class="built_in">type</span><span class="string">&quot;:&quot;</span>ContactController<span class="string">&quot;      &#125;,      &#123;        &quot;</span>bean<span class="string">&quot;: &quot;</span>contactRepository<span class="string">&quot;,        &quot;</span>dependencies<span class="string">&quot;: [          &quot;</span>jdbcTemplate<span class="string">&quot;        ],        &quot;</span>resource<span class="string">&quot;: &quot;</span>null<span class="string">&quot;,        &quot;</span>scope<span class="string">&quot;: &quot;</span>singleton<span class="string">&quot;,        &quot;</span><span class="built_in">type</span><span class="string">&quot;:&quot;</span>ContactRepository<span class="string">&quot;      &#125;,      &#123;        &quot;</span>bean<span class="string">&quot;: &quot;</span>jdbcTemplate<span class="string">&quot;,        &quot;</span>dependencies<span class="string">&quot;: [],        &quot;</span>resource<span class="string">&quot;: &quot;</span>class path resource [...]<span class="string">&quot;,        &quot;</span>scope<span class="string">&quot;: &quot;</span>singleton<span class="string">&quot;,        &quot;</span><span class="built_in">type</span><span class="string">&quot;: &quot;</span>org.springframework.jdbc.core.JdbcTemplate<span class="string">&quot;      &#125;,            ...    ]  &#125;]</span></span></span><br></pre></td></tr></table></figure>

<p>ä»è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªIDä¸ºcontactControllerçš„beanï¼Œå®ƒä¾èµ–äºåä¸ºcontactRepositoryçš„beanï¼Œè€ŒcontactRepositoryåˆä¾èµ–äºjdbcTemplatebeanã€‚</p>
<p>å› ä¸ºæˆ‘å¯¹è¾“å‡ºè¿›è¡Œäº†åˆ å‡ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šçš„beanæ²¡æœ‰å±•ç°å‡ºæ¥ï¼Œå®ƒä»¬éƒ½åŒ…å«åœ¨â€œ/beansâ€ç«¯ç‚¹æ‰€äº§ç”Ÿçš„JSONä¸­ã€‚å¯¹äºè‡ªåŠ¨è£…é…å’Œè‡ªåŠ¨é…ç½®æ‰€å½¢æˆçš„ç¥ç§˜ç»“æœï¼Œè¿™é‡Œæä¾›äº†ä¸€ç§äº†è§£å†…éƒ¨å®ç°çš„æ‰‹æ®µã€‚</p>
<p>å¦å¤–ä¸€ä¸ªç«¯ç‚¹ä¹Ÿèƒ½å¸®åŠ©æˆ‘ä»¬äº†è§£Spring Bootè‡ªåŠ¨é…ç½®çš„å†…éƒ¨æƒ…å†µï¼Œè¿™å°±æ˜¯â€œ/autoconfigâ€ã€‚è¿™ä¸ªç«¯ç‚¹æ‰€è¿”å›çš„JSONæè¿°äº†Spring Bootåœ¨è‡ªåŠ¨é…ç½®beançš„æ—¶å€™æ‰€åšå‡ºçš„å†³ç­–ã€‚ä¾‹å¦‚ï¼Œå½“é’ˆå¯¹Contactsåº”ç”¨è°ƒç”¨â€œ/autoconfigâ€ç«¯ç‚¹æ—¶ï¼Œå¦‚ä¸‹å±•ç°äº†åˆ å‡åï¼ˆå¹¶è¿›è¡Œäº†æ ¼å¼åŒ–ï¼‰çš„JSONç»“æœï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl http://localhost:8080/autoconfig&#123;<span class="string">&quot;negativeMatches&quot;</span>: &#123;  <span class="string">&quot;AopAutoConfiguration&quot;</span>: [    &#123;      <span class="string">&quot;condition&quot;</span>: <span class="string">&quot;OnClassCondition&quot;</span>,      <span class="string">&quot;message&quot;</span>: <span class="string">&quot;required @ConditionalOnClass classes not found:        org.aspectj.lang.annotation.Aspect,        org.aspectj.lang.reflect.Advice&quot;</span>    &#125;  ],  <span class="string">&quot;BatchAutoConfiguration&quot;</span>: [    &#123;      <span class="string">&quot;condition&quot;</span>: <span class="string">&quot;OnClassCondition&quot;</span>,      <span class="string">&quot;message&quot;</span>: <span class="string">&quot;required @ConditionalOnClass classes not found:        org.springf ramework.batch.core.launch.JobLauncher&quot;</span>    &#125;  ],    ...&#125;,<span class="string">&quot;positiveMatches&quot;</span>: &#123;  <span class="string">&quot;ThymeleafAutoConfiguration&quot;</span>: [    &#123;      <span class="string">&quot;condition&quot;</span>: <span class="string">&quot;OnClassCondition&quot;</span>,      <span class="string">&quot;message&quot;</span>: <span class="string">&quot;QConditionalOnClass classes found:        org.thymeleaf.spring4.SpringTemplateEngine&quot;</span>    &#125;  ],  <span class="string">&quot;ThymeleafAutoConfiguration.DefaultTemplateResolverConfiguration&quot;</span>: [    &#123;      <span class="string">&quot;condition&quot;</span>: <span class="string">&quot;OnBeanCondition&quot;</span>,      <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Â©ConditionalOnMissingBean        (names: defaultTemplateResolver; SearchStrategy: all)        found no beans&quot;</span>    &#125;  ],  <span class="string">&quot;ThymeleafAutoConfiguration.ThymeleafDefaultConfiguration&quot;</span>: [    &#123;      <span class="string">&quot;condition&quot;</span>: <span class="string">&quot;OnBeanCondition&quot;</span>,      <span class="string">&quot;message&quot;</span>: <span class="string">&quot;OConditionalOnMissingBean (types:        org.thymeleaf.spring4.SpringTemplateEngine;        SearchStrategy: all) found no beans&quot;</span>    &#125;  ],  <span class="string">&quot;ThymeleafAutoConfiguration.ThymeleafViewResolverConfiguration&quot;</span>: [    &#123;      <span class="string">&quot;condition&quot;</span>: <span class="string">&quot;OnClassCondition&quot;</span>,      <span class="string">&quot;message&quot;</span>: <span class="string">&quot;OConditionalOnClass classes found:        javax.servlet.Servlet&quot;</span>    &#125;  ],  <span class="string">&quot;ThymeleafAutoConfiguration.ThymeleafViewResolverConfiguration      #thymeleafViewResolver&quot;</span>: [    &#123;      <span class="string">&quot;condition&quot;</span>: <span class="string">&quot;OnBeanCondition&quot;</span>,      <span class="string">&quot;message&quot;</span>: <span class="string">&quot;@ConditionalOnMissingBean (names:        thymeleafViewResolver; SearchStrategy: all)        found no beans&quot;</span>    &#125;  ],    ...&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæŠ¥å‘ŠåŒ…å«äº†ä¸¤éƒ¨åˆ†ï¼šä¸€éƒ¨åˆ†æ˜¯æ²¡æœ‰åŒ¹é…ä¸Šçš„ï¼ˆnegative matchesï¼‰ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯åŒ¹é…ä¸Šçš„ï¼ˆpositive matchesï¼‰ã€‚åœ¨æ²¡æœ‰åŒ¹é…çš„éƒ¨åˆ†ä¸­ï¼Œè¡¨æ˜æ²¡æœ‰ä½¿ç”¨AOPå’Œè‡ªåŠ¨é…ç½®ï¼Œå› ä¸ºåœ¨ç±»è·¯å¾„ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»ã€‚åœ¨åŒ¹é…ä¸Šçš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå› ä¸ºåœ¨ç±»è·¯å¾„ä¸‹æ‰¾åˆ°äº†SpringTemplateEngineï¼ŒThymeleafè‡ªåŠ¨é…ç½®å°†ä¼šå‘æŒ¥ä½œç”¨ã€‚åŒæ—¶è¿˜å¯ä»¥çœ‹åˆ°ï¼Œé™¤éæ˜ç¡®å£°æ˜äº†é»˜è®¤çš„æ¨¡æ¿è§£æå™¨ã€è§†å›¾è§£æå™¨ä»¥åŠæ¨¡æ¿beanå¦åˆ™çš„è¯ï¼Œè¿™äº›beanä¼šè¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚å¦å¤–ï¼Œåªæœ‰åœ¨ç±»è·¯å¾„ä¸­èƒ½å¤Ÿæ‰¾åˆ°Servletç±»ï¼Œæ‰ä¼šè‡ªåŠ¨é…ç½®é»˜è®¤çš„è§†å›¾è§£æå™¨ã€‚</p>
<p>â€œ/beansâ€å’Œâ€œ/autoconfigâ€ç«¯ç‚¹åªæ˜¯Spring Boot Actuatoræ‰€æä¾›çš„è§‚å¯Ÿåº”ç”¨å†…éƒ¨çŠ¶å†µçš„ä¸¤ä¸ªæ ·ä¾‹ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰è¶³å¤Ÿçš„ç¯‡å¹…è¯¦ç»†è®¨è®ºæ¯ä¸ªç«¯ç‚¹ï¼Œä½†æ˜¯æˆ‘å»ºè®®ä½ è‡ªè¡Œå°è¯•è¿™äº›ç«¯ç‚¹ï¼Œä»¥ä¾¿æŒæ¡Actuatoréƒ½æä¾›äº†å“ªäº›åŠŸèƒ½æ¥å¸®åŠ©æˆ‘ä»¬äº†è§£åº”ç”¨çš„å†…éƒ¨çŠ¶å†µã€‚</p>
<h3 id="å°ç»“-20"><a href="#å°ç»“-20" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>Spring Bootæ˜¯Springå®¶æ—ä¸­ä¸€ä¸ªä»¤äººå…´å¥‹çš„æ–°é¡¹ç›®ã€‚Springè‡´åŠ›äºç®€åŒ–Javaå¼€å‘ï¼Œè€ŒSpring Bootè‡´åŠ›äºè®©Springæœ¬èº«æ›´åŠ ç®€å•ã€‚</p>
<p>Spring Bootç”¨äº†ä¸¤ä¸ªæŠ€å·§æ¥æ¶ˆé™¤Springé¡¹ç›®ä¸­çš„æ ·æ¿å¼é…ç½®ï¼šSpring Boot Starterå’Œè‡ªåŠ¨é…ç½®ã€‚</p>
<p>ä¸€ä¸ªç®€å•çš„Spring Boot Starterä¾èµ–èƒ½å¤Ÿæ›¿æ¢æ‰Mavenæˆ–Gradleæ„å»ºä¸­å¤šä¸ªé€šç”¨çš„ä¾èµ–ã€‚ä¾‹å¦‚ï¼Œåœ¨é¡¹ç›®ä¸­æ·»åŠ Spring Boot Webä¾èµ–åï¼Œå°†ä¼šå¼•å…¥Spring Webå’ŒSpring MVCæ¨¡å—ï¼Œä»¥åŠJackson 2æ•°æ®ç»‘å®šæ¨¡å—ã€‚</p>
<p>è‡ªåŠ¨é…ç½®å……åˆ†åˆ©ç”¨äº†Spring 4.0çš„æ¡ä»¶åŒ–é…ç½®ç‰¹æ€§ï¼Œèƒ½å¤Ÿè‡ªåŠ¨é…ç½®ç‰¹å®šçš„Spring beanï¼Œç”¨æ¥å¯ç”¨æŸé¡¹ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼ŒSpring Bootèƒ½å¤Ÿåœ¨åº”ç”¨çš„ç±»è·¯å¾„ä¸­æ¢æµ‹åˆ°Thymeleafï¼Œç„¶åè‡ªåŠ¨å°†Thymeleafæ¨¡æ¿é…ç½®ä¸ºSpring MVCè§†å›¾çš„beanã€‚</p>
<p>Spring Bootçš„å‘½ä»¤è¡Œæ¥å£ï¼ˆcommand-line interfaceï¼ŒCLIï¼‰ä½¿ç”¨Groovyè¿›ä¸€æ­¥ç®€åŒ–äº†Springé¡¹ç›®ã€‚é€šè¿‡åœ¨Groovyä»£ç ä¸­ç®€å•åœ°å¼•ç”¨Springç»„ä»¶ï¼ŒCLIå°±èƒ½è‡ªåŠ¨æ·»åŠ æ‰€éœ€çš„Starterä¾èµ–ï¼ˆè€Œè¿™åˆä¼šè§¦å‘è‡ªåŠ¨é…ç½®ï¼‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œé€šè¿‡Spring Boot CLIè¿è¡Œæ—¶ï¼Œå¾ˆå¤šçš„Springç±»å‹éƒ½ä¸éœ€è¦åœ¨Groovyä»£ç ä¸­æ˜¾å¼ä½¿ç”¨importè¯­å¥å¯¼å…¥ã€‚</p>
<p>æœ€åï¼ŒSpring Boot Actuatorä¸ºåŸºäºSpring Bootå¼€å‘çš„Webåº”ç”¨æä¾›äº†ä¸€äº›é€šç”¨çš„ç®¡ç†ç‰¹æ€§ï¼ŒåŒ…æ‹¬æŸ¥çœ‹çº¿ç¨‹dumpã€Webè¯·æ±‚å†å²ä»¥åŠSpringåº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„beanã€‚</p>
<p>åœ¨è¯»å®Œæœ¬ç« ä¹‹åï¼Œä½ å¯èƒ½ä¼šæƒ³ä¸ºä»€ä¹ˆè¦å°†åƒSpring Bootè¿™æ ·æœ‰ç”¨çš„è¯é¢˜æ”¾åˆ°ä¹¦çš„ç»“å°¾å‘¢ã€‚ä½ ç”šè‡³å¯èƒ½ä¼šæƒ³ï¼Œå¦‚æœæˆ‘æ—©ä¸€ç‚¹ä»‹ç»Spring Bootçš„è¯ï¼Œé‚£ä¹ˆå¾ˆå¤šä¹‹å‰æ‰€å­¦çš„å†…å®¹å°†ä¼šæ›´åŠ ç®€å•ã€‚ç¡®å®ï¼ŒSpring Bootåœ¨Springä¹‹ä¸Šæä¾›äº†å¾ˆæœ‰æ„æ€çš„ç¼–ç¨‹æ¨¡å‹ï¼Œä¸€æ—¦ç”¨ä¸Šå®ƒä¹‹åï¼Œå¾ˆéš¾æƒ³è±¡å¦‚æœæ²¡æœ‰å®ƒçš„è¯ï¼Œè¯¥å¦‚ä½•ç¼–å†™Springåº”ç”¨ã€‚</p>
<p>æˆ‘å¯ä»¥è¯´ä¹‹æ‰€ä»¥å°†Spring Bootç•™åœ¨æœ€åï¼Œæ˜¯å› ä¸ºæƒ³è®©ä½ å¯¹Springæœ‰æ›´æ·±å…¥çš„ç†è§£ï¼ˆåæ­£å¯¹ä½ æœ‰å¥½å¤„å°±æ˜¯äº†)ã€‚å°½ç®¡å¯ä»¥è¿™ä¹ˆè®²ï¼Œä½†çœŸæ­£çš„åŸå› æ˜¯Spring Bootæ¨å‡ºçš„æ—¶å€™ï¼Œæœ¬ä¹¦çš„å¤§éƒ¨åˆ†å†…å®¹å·²ç»å†™å®Œäº†ã€‚æ‰€ä»¥æˆ‘åªèƒ½å°†å…¶æ”¾åˆ°ä¸€ä¸ªä¸å½±å“æ•´æœ¬ä¹¦çš„åœ°æ–¹ï¼šä¹Ÿå°±æ˜¯ç»“å°¾ã€‚</p>
<p>è°çŸ¥é“å‘¢ï¼Ÿä¹Ÿè®¸åœ¨æœ¬ä¹¦çš„ä¸‹ä¸€ç‰ˆä¸­ï¼Œä»ä¸€å¼€å§‹æˆ‘å°±ä¼šä»‹ç»Spring Bootã€‚</p>
<p>â€‹                   </p>
</script></p>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/java/" rel="tag"># java</a>
              <a href="/tags/spring/" rel="tag"># spring</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/12/20/js/vue-in-action/" rel="prev" title="vue.js å®æˆ˜">
      <i class="fa fa-chevron-left"></i> vue.js å®æˆ˜
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/04/10/js/vue-router/" rel="next" title="vue-router">
      vue-router <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring-%E7%9A%84%E6%A0%B8%E5%BF%83"><span class="nav-number">1.</span> <span class="nav-text">Spring çš„æ ¸å¿ƒ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-%E4%B9%8B%E6%97%85"><span class="nav-number">1.1.</span> <span class="nav-text">Spring ä¹‹æ—…</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8C%96-Java-%E5%BC%80%E5%8F%91"><span class="nav-number">1.1.1.</span> <span class="nav-text">ç®€åŒ– Java å¼€å‘</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BF%80%E5%8F%91-POJO-%E7%9A%84%E6%BD%9C%E8%83%BD"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">æ¿€å‘ POJO çš„æ½œèƒ½</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">ä¾èµ–æ³¨å…¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%88%87%E9%9D%A2"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">åº”ç”¨åˆ‡é¢</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%A8%A1%E6%9D%BF%E6%B6%88%E9%99%A4%E6%A0%B7%E6%9D%BF%E5%BC%8F%E4%BB%A3%E7%A0%81"><span class="nav-number">1.1.1.4.</span> <span class="nav-text">ä½¿ç”¨æ¨¡æ¿æ¶ˆé™¤æ ·æ¿å¼ä»£ç </span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%B9%E7%BA%B3%E4%BD%A0%E7%9A%84-Bean"><span class="nav-number">1.1.2.</span> <span class="nav-text">å®¹çº³ä½ çš„ Bean</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%BA%94%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">ä½¿ç”¨åº”ç”¨ä¸Šä¸‹æ–‡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Bean-%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">Bean çš„ç”Ÿå‘½å‘¨æœŸ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AF%E7%9E%B0-Spring-%E7%9A%84%E9%A3%8E%E6%99%AF%E7%BA%BF"><span class="nav-number">1.1.3.</span> <span class="nav-text">ä¿¯ç° Spring çš„é£æ™¯çº¿</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-%E6%A8%A1%E5%9D%97"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">Spring æ¨¡å—</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-Portfolio"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">Spring Portfolio</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-%E6%96%B0%E5%8A%9F%E8%83%BD"><span class="nav-number">1.1.4.</span> <span class="nav-text">Spring æ–°åŠŸèƒ½</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-3-1-%E6%96%B0%E7%89%B9%E6%80%A7"><span class="nav-number">1.1.4.1.</span> <span class="nav-text">Spring 3.1 æ–°ç‰¹æ€§</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-3-2-%E6%96%B0%E7%89%B9%E6%80%A7"><span class="nav-number">1.1.4.2.</span> <span class="nav-text">Spring 3.2 æ–°ç‰¹æ€§</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-4-0-%E6%96%B0%E7%89%B9%E6%80%A7"><span class="nav-number">1.1.4.3.</span> <span class="nav-text">Spring 4.0 æ–°ç‰¹æ€§</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">1.1.5.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A3%85%E9%85%8D-Bean"><span class="nav-number">1.2.</span> <span class="nav-text">è£…é… Bean</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-%E9%85%8D%E7%BD%AE%E7%9A%84%E5%8F%AF%E9%80%89%E6%96%B9%E6%A1%88"><span class="nav-number">1.2.1.</span> <span class="nav-text">Spring é…ç½®çš„å¯é€‰æ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E8%A3%85%E9%85%8D-Bean"><span class="nav-number">1.2.2.</span> <span class="nav-text">è‡ªåŠ¨åŒ–è£…é… Bean</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%8F%AF%E8%A2%AB%E5%8F%91%E7%8E%B0%E7%9A%84-bean"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">åˆ›å»ºå¯è¢«å‘ç°çš„ bean</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E7%BB%84%E4%BB%B6%E6%89%AB%E6%8F%8F%E7%9A%84-bean-%E5%91%BD%E5%90%8D"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">ä¸ºç»„ä»¶æ‰«æçš„ bean å‘½å</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E7%BB%84%E4%BB%B6%E6%89%AB%E6%8F%8F%E7%9A%84%E5%9F%BA%E7%A1%80%E5%8C%85"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">è®¾ç½®ç»„ä»¶æ‰«æçš„åŸºç¡€åŒ…</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E4%B8%BA-bean-%E6%B7%BB%E5%8A%A0%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D"><span class="nav-number">1.2.2.4.</span> <span class="nav-text">é€šè¿‡ä¸º bean æ·»åŠ æ³¨è§£å®ç°è‡ªåŠ¨è£…é…</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D"><span class="nav-number">1.2.2.5.</span> <span class="nav-text">éªŒè¯è‡ªåŠ¨è£…é…</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87-Java-%E4%BB%A3%E7%A0%81%E8%A3%85%E9%85%8D-bean"><span class="nav-number">1.2.3.</span> <span class="nav-text">é€šè¿‡ Java ä»£ç è£…é… bean</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">åˆ›å»ºé…ç½®ç±»</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A3%B0%E6%98%8E%E7%AE%80%E5%8D%95%E7%9A%84-bean"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">å£°æ˜ç®€å•çš„ bean</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%80%9F%E5%8A%A9-JavaConfig-%E5%AE%9E%E7%8E%B0%E6%B3%A8%E5%85%A5"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">å€ŸåŠ© JavaConfig å®ç°æ³¨å…¥</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87-XML-%E8%A3%85%E9%85%8D-bean"><span class="nav-number">1.2.4.</span> <span class="nav-text">é€šè¿‡ XML è£…é… bean</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-XML-%E9%85%8D%E7%BD%AE%E8%A7%84%E8%8C%83"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">åˆ›å»º XML é…ç½®è§„èŒƒ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84-lt-bean-gt"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">å£°æ˜ä¸€ä¸ªç®€å•çš„ &lt;bean&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%80%9F%E5%8A%A9%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5%E5%88%9D%E5%A7%8B%E5%8C%96-bean"><span class="nav-number">1.2.4.3.</span> <span class="nav-text">å€ŸåŠ©æ„é€ å™¨æ³¨å…¥åˆå§‹åŒ– bean</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%B1%9E%E6%80%A7"><span class="nav-number">1.2.4.4.</span> <span class="nav-text">è®¾ç½®å±æ€§</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E5%92%8C%E6%B7%B7%E5%90%88%E9%85%8D%E7%BD%AE"><span class="nav-number">1.2.5.</span> <span class="nav-text">å¯¼å…¥å’Œæ··åˆé…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8-JavaConfig-%E4%B8%AD%E5%BC%95%E7%94%A8-XML-%E9%85%8D%E7%BD%AE"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">åœ¨ JavaConfig ä¸­å¼•ç”¨ XML é…ç½®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8-XML-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BC%95%E7%94%A8-JavaConfig"><span class="nav-number">1.2.5.2.</span> <span class="nav-text">åœ¨ XML é…ç½®ä¸­å¼•ç”¨ JavaConfig</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-1"><span class="nav-number">1.2.6.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E8%A3%85%E9%85%8D"><span class="nav-number">1.3.</span> <span class="nav-text">é«˜çº§è£…é…</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E4%B8%8E-profile"><span class="nav-number">1.3.1.</span> <span class="nav-text">ç¯å¢ƒä¸ profile</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-profile-bean"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">é…ç½® profile bean</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BF%80%E6%B4%BB-profile"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">æ¿€æ´» profile</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E5%8C%96%E7%9A%84-bean"><span class="nav-number">1.3.2.</span> <span class="nav-text">æ¡ä»¶åŒ–çš„ bean</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E7%9A%84%E6%AD%A7%E4%B9%89%E6%80%A7"><span class="nav-number">1.3.3.</span> <span class="nav-text">å¤„ç†è‡ªåŠ¨è£…é…çš„æ­§ä¹‰æ€§</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%87%E7%A4%BA%E9%A6%96%E9%80%89%E7%9A%84-bean"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">æ ‡ç¤ºé¦–é€‰çš„ bean</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%99%90%E5%AE%9A%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E7%9A%84-bean"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">é™å®šè‡ªåŠ¨è£…é…çš„ bean</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-number">1.3.4.</span> <span class="nav-text">beançš„ä½œç”¨åŸŸ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%BC%9A%E8%AF%9D%E5%92%8C%E8%AF%B7%E6%B1%82%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">ä½¿ç”¨ä¼šè¯å’Œè¯·æ±‚ä½œç”¨åŸŸ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8-XML-%E4%B8%AD%E5%A3%B0%E6%98%8E%E4%BD%9C%E7%94%A8%E5%9F%9F%E4%BB%A3%E7%90%86"><span class="nav-number">1.3.4.2.</span> <span class="nav-text">åœ¨ XML ä¸­å£°æ˜ä½œç”¨åŸŸä»£ç†</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E5%80%BC%E6%B3%A8%E5%85%A5"><span class="nav-number">1.3.5.</span> <span class="nav-text">è¿è¡Œæ—¶å€¼æ³¨å…¥</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E5%85%A5%E5%A4%96%E9%83%A8%E7%9A%84%E5%80%BC"><span class="nav-number">1.3.5.1.</span> <span class="nav-text">æ³¨å…¥å¤–éƒ¨çš„å€¼</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Spring-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%AD%E8%A8%80%E8%BF%9B%E8%A1%8C%E8%A3%85%E9%85%8D"><span class="nav-number">1.3.5.2.</span> <span class="nav-text">ä½¿ç”¨ Spring è¡¨è¾¾å¼è¯­è¨€è¿›è¡Œè£…é…</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-2"><span class="nav-number">1.3.6.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%9A%84-Spring"><span class="nav-number">1.4.</span> <span class="nav-text">é¢å‘åˆ‡é¢çš„ Spring</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B"><span class="nav-number">1.4.1.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-AOP-%E6%9C%AF%E8%AF%AD"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">å®šä¹‰ AOP æœ¯è¯­</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-%E5%AF%B9-AOP-%E7%9A%84%E6%94%AF%E6%8C%81"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">Spring å¯¹ AOP çš„æ”¯æŒ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%88%87%E7%82%B9%E9%80%89%E6%8B%A9%E8%BF%9E%E6%8E%A5%E7%82%B9"><span class="nav-number">1.4.2.</span> <span class="nav-text">ä½¿ç”¨åˆ‡ç‚¹é€‰æ‹©è¿æ¥ç‚¹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E5%88%87%E7%82%B9"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">ç¼–å†™åˆ‡ç‚¹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E5%88%87%E7%82%B9%E4%B8%AD%E9%80%89%E6%8B%A9bean"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">åœ¨åˆ‡ç‚¹ä¸­é€‰æ‹©bean</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%88%9B%E5%BB%BA%E5%88%87%E9%9D%A2"><span class="nav-number">1.4.3.</span> <span class="nav-text">ä½¿ç”¨æ³¨è§£åˆ›å»ºåˆ‡é¢</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E5%88%87%E9%9D%A2"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">å®šä¹‰åˆ‡é¢</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%8E%AF%E7%BB%95%E9%80%9A%E7%9F%A5"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">åˆ›å»ºç¯ç»•é€šçŸ¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E9%80%9A%E7%9F%A5%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0"><span class="nav-number">1.4.3.3.</span> <span class="nav-text">å¤„ç†é€šçŸ¥ä¸­çš„å‚æ•°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E6%B3%A8%E8%A7%A3%E5%BC%95%E5%85%A5%E6%96%B0%E5%8A%9F%E8%83%BD"><span class="nav-number">1.4.3.4.</span> <span class="nav-text">é€šè¿‡æ³¨è§£å¼•å…¥æ–°åŠŸèƒ½</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8-XML-%E4%B8%AD%E5%A3%B0%E6%98%8E%E5%88%87%E9%9D%A2"><span class="nav-number">1.4.4.</span> <span class="nav-text">åœ¨ XML ä¸­å£°æ˜åˆ‡é¢</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A3%B0%E6%98%8E%E5%89%8D%E7%BD%AE%E5%92%8C%E5%90%8E%E7%BD%AE%E9%80%9A%E7%9F%A5"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">å£°æ˜å‰ç½®å’Œåç½®é€šçŸ¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A3%B0%E6%98%8E%E7%8E%AF%E7%BB%95%E9%80%9A%E7%9F%A5"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">å£°æ˜ç¯ç»•é€šçŸ¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E9%80%9A%E7%9F%A5%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0"><span class="nav-number">1.4.4.3.</span> <span class="nav-text">ä¸ºé€šçŸ¥ä¼ é€’å‚æ•°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E5%88%87%E9%9D%A2%E5%BC%95%E5%85%A5%E6%96%B0%E5%8A%9F%E8%83%BD"><span class="nav-number">1.4.4.4.</span> <span class="nav-text">é€šè¿‡åˆ‡é¢å¼•å…¥æ–°åŠŸèƒ½</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E5%85%A5-AspectJ-%E5%88%87%E9%9D%A2"><span class="nav-number">1.4.5.</span> <span class="nav-text">æ³¨å…¥ AspectJ åˆ‡é¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-3"><span class="nav-number">1.4.6.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Web-%E4%B8%AD%E7%9A%84-Spring"><span class="nav-number">2.</span> <span class="nav-text">Web ä¸­çš„ Spring</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA-Spring-Web-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">2.1.</span> <span class="nav-text">æ„å»º Spring Web åº”ç”¨ç¨‹åº</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-MVC-%E8%B5%B7%E6%AD%A5"><span class="nav-number">2.1.1.</span> <span class="nav-text">Spring  MVC  èµ·æ­¥</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B7%9F%E8%B8%AA-Spring-MVC-%E7%9A%84%E8%AF%B7%E6%B1%82"><span class="nav-number">2.1.1.1.</span> <span class="nav-text">è·Ÿè¸ª Spring MVC çš„è¯·æ±‚</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%90%AD%E5%BB%BA-Spring-MVC"><span class="nav-number">2.1.1.2.</span> <span class="nav-text">æ­å»º Spring MVC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spittr-%E5%BA%94%E7%94%A8%E7%AE%80%E4%BB%8B"><span class="nav-number">2.1.1.3.</span> <span class="nav-text">Spittr åº”ç”¨ç®€ä»‹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">2.1.2.</span> <span class="nav-text">ç¼–å†™åŸºæœ¬çš„æ§åˆ¶å™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">2.1.2.1.</span> <span class="nav-text">æµ‹è¯•æ§åˆ¶å™¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E7%B1%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86"><span class="nav-number">2.1.2.2.</span> <span class="nav-text">å®šä¹‰ç±»çº§åˆ«çš„è¯·æ±‚å¤„ç†</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%A0%E9%80%92%E6%A8%A1%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%88%B0%E8%A7%86%E5%9B%BE%E4%B8%AD"><span class="nav-number">2.1.2.3.</span> <span class="nav-text">ä¼ é€’æ¨¡å‹æ•°æ®åˆ°è§†å›¾ä¸­</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E5%8F%97%E8%AF%B7%E6%B1%82%E7%9A%84%E8%BE%93%E5%85%A5"><span class="nav-number">2.1.3.</span> <span class="nav-text">æ¥å—è¯·æ±‚çš„è¾“å…¥</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="nav-number">2.1.3.1.</span> <span class="nav-text">å¤„ç†æŸ¥è¯¢å‚æ•°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0%E6%8E%A5%E5%8F%97%E8%BE%93%E5%85%A5"><span class="nav-number">2.1.3.2.</span> <span class="nav-text">é€šè¿‡è·¯å¾„å‚æ•°æ¥å—è¾“å…¥</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E8%A1%A8%E5%8D%95"><span class="nav-number">2.1.4.</span> <span class="nav-text">å¤„ç†è¡¨å•</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E5%A4%84%E7%90%86%E8%A1%A8%E5%8D%95%E7%9A%84%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">2.1.4.1.</span> <span class="nav-text">ç¼–å†™å¤„ç†è¡¨å•çš„æ§åˆ¶å™¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%A1%E9%AA%8C%E8%A1%A8%E5%8D%95"><span class="nav-number">2.1.4.2.</span> <span class="nav-text">æ ¡éªŒè¡¨å•</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-4"><span class="nav-number">2.1.5.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93Web%E8%A7%86%E5%9B%BE"><span class="nav-number">2.2.</span> <span class="nav-text">æ¸²æŸ“Webè§†å›¾</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%90%86%E8%A7%A3%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90"><span class="nav-number">2.2.1.</span> <span class="nav-text">ç†è§£è§†å›¾è§£æ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-JSP-%E8%A7%86%E5%9B%BE"><span class="nav-number">2.2.2.</span> <span class="nav-text">åˆ›å»º JSP è§†å›¾</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E9%80%82%E7%94%A8%E4%BA%8E-JSP-%E7%9A%84%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">é…ç½®é€‚ç”¨äº JSP çš„è§†å›¾è§£æå™¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Spring-%E7%9A%84-JSP-%E5%BA%93"><span class="nav-number">2.2.2.2.</span> <span class="nav-text">ä½¿ç”¨ Spring çš„ JSP åº“</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Apache-Tiles-%E8%A7%86%E5%9B%BE%E5%AE%9A%E4%B9%89%E5%B8%83%E5%B1%80"><span class="nav-number">2.2.3.</span> <span class="nav-text">ä½¿ç”¨ Apache Tiles è§†å›¾å®šä¹‰å¸ƒå±€</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-Tiles-%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="nav-number">2.2.3.1.</span> <span class="nav-text">é…ç½® Tiles è§†å›¾è§£æå™¨</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Thymeleaf"><span class="nav-number">2.2.4.</span> <span class="nav-text">ä½¿ç”¨  Thymeleaf</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-Thymeleaf-%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="nav-number">2.2.4.1.</span> <span class="nav-text">é…ç½® Thymeleaf è§†å›¾è§£æå™¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-Thymeleaf-%E6%A8%A1%E6%9D%BF"><span class="nav-number">2.2.4.2.</span> <span class="nav-text">å®šä¹‰ Thymeleaf æ¨¡æ¿</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-5"><span class="nav-number">2.2.5.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-MVC-%E7%9A%84%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF"><span class="nav-number">2.3.</span> <span class="nav-text">Spring MVC çš„é«˜çº§æŠ€æœ¯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-MVC-%E9%85%8D%E7%BD%AE%E7%9A%84%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88"><span class="nav-number">2.3.1.</span> <span class="nav-text">Spring MVC  é…ç½®çš„æ›¿ä»£æ–¹æ¡ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-DispatcherServlet-%E9%85%8D%E7%BD%AE"><span class="nav-number">2.3.1.1.</span> <span class="nav-text">è‡ªå®šä¹‰ DispatcherServlet é…ç½®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%85%B6%E4%BB%96%E7%9A%84-Servlet-%E5%92%8C-Filter"><span class="nav-number">2.3.1.2.</span> <span class="nav-text">æ·»åŠ å…¶ä»–çš„ Servlet å’Œ Filter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8-web-xml-%E4%B8%AD%E5%A3%B0%E6%98%8E-DispatcherServlet"><span class="nav-number">2.3.1.3.</span> <span class="nav-text">åœ¨ web.xml ä¸­å£°æ˜ DispatcherServlet</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%84%E7%90%86-multipart-%E5%BD%A2%E5%BC%8F%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-number">2.3.2.</span> <span class="nav-text">å¤„ç† multipart å½¢å¼çš„æ•°æ®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-multipart-%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="nav-number">2.3.2.1.</span> <span class="nav-text">é…ç½® multipart è§£æå™¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%84%E7%90%86-multipart-%E8%AF%B7%E6%B1%82"><span class="nav-number">2.3.2.2.</span> <span class="nav-text">å¤„ç† multipart è¯·æ±‚</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8"><span class="nav-number">2.3.3.</span> <span class="nav-text">å¤„ç†å¼‚å¸¸</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%86%E5%BC%82%E5%B8%B8%E6%98%A0%E5%B0%84%E4%B8%BA-HTTP-%E7%8A%B6%E6%80%81%E7%A0%81"><span class="nav-number">2.3.3.1.</span> <span class="nav-text">å°†å¼‚å¸¸æ˜ å°„ä¸º HTTP çŠ¶æ€ç </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">2.3.3.2.</span> <span class="nav-text">ç¼–å†™å¼‚å¸¸å¤„ç†çš„æ–¹æ³•</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E6%B7%BB%E5%8A%A0%E9%80%9A%E7%9F%A5"><span class="nav-number">2.3.4.</span> <span class="nav-text">ä¸ºæ§åˆ¶å™¨æ·»åŠ é€šçŸ¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%A8%E9%87%8D%E5%AE%9A%E5%90%91%E8%AF%B7%E6%B1%82%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE"><span class="nav-number">2.3.5.</span> <span class="nav-text">è·¨é‡å®šå‘è¯·æ±‚ä¼ é€’æ•°æ®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87-URL-%E6%A8%A1%E6%9D%BF%E8%BF%9B%E8%A1%8C%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-number">2.3.5.1.</span> <span class="nav-text">é€šè¿‡ URL æ¨¡æ¿è¿›è¡Œé‡å®šå‘</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-flash-%E5%B1%9E%E6%80%A7"><span class="nav-number">2.3.5.2.</span> <span class="nav-text">ä½¿ç”¨ flash å±æ€§</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-6"><span class="nav-number">2.3.6.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Spring-Web-Flow"><span class="nav-number">2.4.</span> <span class="nav-text">ä½¿ç”¨Spring Web Flow</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8-Spring-%E4%B8%AD%E9%85%8D%E7%BD%AE-Web-Flow"><span class="nav-number">2.4.1.</span> <span class="nav-text">åœ¨  Spring  ä¸­é…ç½®  Web Flow</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A3%85%E9%85%8D%E6%B5%81%E7%A8%8B%E6%89%A7%E8%A1%8C%E5%99%A8"><span class="nav-number">2.4.1.1.</span> <span class="nav-text">è£…é…æµç¨‹æ‰§è¡Œå™¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B%E6%B3%A8%E5%86%8C%E8%A1%A8"><span class="nav-number">2.4.1.2.</span> <span class="nav-text">é…ç½®æµç¨‹æ³¨å†Œè¡¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%E8%AF%B7%E6%B1%82"><span class="nav-number">2.4.1.3.</span> <span class="nav-text">å¤„ç†æµç¨‹è¯·æ±‚</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E7%9A%84%E7%BB%84%E4%BB%B6"><span class="nav-number">2.4.2.</span> <span class="nav-text">æµç¨‹çš„ç»„ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8A%B6%E6%80%81"><span class="nav-number">2.4.2.1.</span> <span class="nav-text">çŠ¶æ€</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BD%AC%E7%A7%BB"><span class="nav-number">2.4.2.2.</span> <span class="nav-text">è½¬ç§»</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E6%95%B0%E6%8D%AE"><span class="nav-number">2.4.2.3.</span> <span class="nav-text">æµç¨‹æ•°æ®</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E8%B5%B7%E6%9D%A5%EF%BC%9A%E6%8A%AB%E8%90%A8%E6%B5%81%E7%A8%8B"><span class="nav-number">2.4.3.</span> <span class="nav-text">ç»„åˆèµ·æ¥ï¼šæŠ«è¨æµç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B"><span class="nav-number">2.4.3.1.</span> <span class="nav-text">å®šä¹‰åŸºæœ¬æµç¨‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%B6%E9%9B%86%E9%A1%BE%E5%AE%A2%E4%BF%A1%E6%81%AF"><span class="nav-number">2.4.3.2.</span> <span class="nav-text">æ”¶é›†é¡¾å®¢ä¿¡æ¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E8%AE%A2%E5%8D%95"><span class="nav-number">2.4.3.3.</span> <span class="nav-text">æ„å»ºè®¢å•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%AF%E4%BB%98"><span class="nav-number">2.4.3.4.</span> <span class="nav-text">æ”¯ä»˜</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-7"><span class="nav-number">2.4.4.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%9D%E6%8A%A4-Web-%E5%BA%94%E7%94%A8"><span class="nav-number">2.5.</span> <span class="nav-text">ä¿æŠ¤ Web åº”ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Security%E7%AE%80%E4%BB%8B"><span class="nav-number">2.5.1.</span> <span class="nav-text">Spring Securityç®€ä»‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%90%86%E8%A7%A3-Spring-Security-%E7%9A%84%E6%A8%A1%E5%9D%97"><span class="nav-number">2.5.1.1.</span> <span class="nav-text">ç†è§£ Spring Security çš„æ¨¡å—</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4-Web-%E8%AF%B7%E6%B1%82"><span class="nav-number">2.5.1.2.</span> <span class="nav-text">è¿‡æ»¤ Web è¯·æ±‚</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E7%AE%80%E5%8D%95%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E9%85%8D%E7%BD%AE"><span class="nav-number">2.5.1.3.</span> <span class="nav-text">ç¼–å†™ç®€å•çš„å®‰å…¨æ€§é…ç½®</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.5.2.</span> <span class="nav-text">é€‰æ‹©æŸ¥è¯¢ç”¨æˆ·è¯¦ç»†ä¿¡æ¯çš„æœåŠ¡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E7%9A%84%E7%94%A8%E6%88%B7%E5%AD%98%E5%82%A8"><span class="nav-number">2.5.2.1.</span> <span class="nav-text">ä½¿ç”¨åŸºäºå†…å­˜çš„ç”¨æˆ·å­˜å‚¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%BF%9B%E8%A1%8C%E8%AE%A4%E8%AF%81"><span class="nav-number">2.5.2.2.</span> <span class="nav-text">åŸºäºæ•°æ®åº“è¡¨è¿›è¡Œè®¤è¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E-LDAP-%E8%BF%9B%E8%A1%8C%E8%AE%A4%E8%AF%81"><span class="nav-number">2.5.2.3.</span> <span class="nav-text">åŸºäº LDAP è¿›è¡Œè®¤è¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.5.2.4.</span> <span class="nav-text">é…ç½®è‡ªå®šä¹‰çš„ç”¨æˆ·æœåŠ¡</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%A6%E6%88%AA%E8%AF%B7%E6%B1%82"><span class="nav-number">2.5.3.</span> <span class="nav-text">æ‹¦æˆªè¯·æ±‚</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Spring%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%BF%9B%E8%A1%8C%E5%AE%89%E5%85%A8%E4%BF%9D%E6%8A%A4"><span class="nav-number">2.5.3.1.</span> <span class="nav-text">ä½¿ç”¨Springè¡¨è¾¾å¼è¿›è¡Œå®‰å…¨ä¿æŠ¤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%BA%E5%88%B6%E9%80%9A%E9%81%93%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7"><span class="nav-number">2.5.3.2.</span> <span class="nav-text">å¼ºåˆ¶é€šé“çš„å®‰å…¨æ€§</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%98%B2%E6%AD%A2%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0"><span class="nav-number">2.5.3.3.</span> <span class="nav-text">é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ </span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A4%E8%AF%81%E7%94%A8%E6%88%B7"><span class="nav-number">2.5.4.</span> <span class="nav-text">è®¤è¯ç”¨æˆ·</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E7%99%BB%E5%BD%95%E9%A1%B5"><span class="nav-number">2.5.4.1.</span> <span class="nav-text">æ·»åŠ è‡ªå®šä¹‰çš„ç™»å½•é¡µ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E7%94%A8HTTP-Basic%E8%AE%A4%E8%AF%81"><span class="nav-number">2.5.4.2.</span> <span class="nav-text">å¯ç”¨HTTP Basicè®¤è¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E7%94%A8Remember-me%E5%8A%9F%E8%83%BD"><span class="nav-number">2.5.4.3.</span> <span class="nav-text">å¯ç”¨Remember-meåŠŸèƒ½</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%80%E5%87%BA"><span class="nav-number">2.5.4.4.</span> <span class="nav-text">é€€å‡º</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%9D%E6%8A%A4%E8%A7%86%E5%9B%BE"><span class="nav-number">2.5.5.</span> <span class="nav-text">ä¿æŠ¤è§†å›¾</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Spring-Security-%E7%9A%84-JSP-%E6%A0%87%E7%AD%BE%E5%BA%93"><span class="nav-number">2.5.5.1.</span> <span class="nav-text">ä½¿ç”¨ Spring Security çš„ JSP æ ‡ç­¾åº“</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Thymeleaf-%E7%9A%84-Spring-Security-%E6%96%B9%E8%A8%80"><span class="nav-number">2.5.5.2.</span> <span class="nav-text">ä½¿ç”¨ Thymeleaf çš„ Spring Security æ–¹è¨€</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-8"><span class="nav-number">2.5.6.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E7%AB%AF%E4%B8%AD%E7%9A%84-Spring"><span class="nav-number">3.</span> <span class="nav-text">åç«¯ä¸­çš„ Spring</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E8%BF%87-Spring-%E5%92%8C-JDBC-%E5%BE%81%E6%9C%8D%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">3.1.</span> <span class="nav-text">é€šè¿‡ Spring å’Œ JDBC å¾æœæ•°æ®åº“</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-%E7%9A%84%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E5%93%B2%E5%AD%A6"><span class="nav-number">3.1.1.</span> <span class="nav-text">Spring çš„æ•°æ®è®¿é—®å“²å­¦</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%86%E8%A7%A3-Spring-%E7%9A%84%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E5%BC%82%E5%B8%B8%E4%BD%93%E7%B3%BB"><span class="nav-number">3.1.1.1.</span> <span class="nav-text">äº†è§£ Spring çš„æ•°æ®è®¿é—®å¼‚å¸¸ä½“ç³»</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E6%A8%A1%E6%9D%BF%E5%8C%96"><span class="nav-number">3.1.1.2.</span> <span class="nav-text">æ•°æ®è®¿é—®æ¨¡æ¿åŒ–</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-number">3.1.2.</span> <span class="nav-text">é…ç½®æ•°æ®æº</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-JNDI-%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-number">3.1.2.1.</span> <span class="nav-text">ä½¿ç”¨ JNDI æ•°æ®æº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E6%BA%90%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="nav-number">3.1.2.2.</span> <span class="nav-text">ä½¿ç”¨æ•°æ®æºè¿æ¥æ± </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E-JDBC-%E9%A9%B1%E5%8A%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-number">3.1.2.3.</span> <span class="nav-text">åŸºäº JDBC é©±åŠ¨çš„æ•°æ®æº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%9A%84%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-number">3.1.2.4.</span> <span class="nav-text">ä½¿ç”¨åµŒå…¥å¼çš„æ•°æ®æº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-profile-%E9%80%89%E6%8B%A9%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-number">3.1.2.5.</span> <span class="nav-text">ä½¿ç”¨ profile é€‰æ‹©æ•°æ®æº</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8-Spring-%E4%B8%AD%E4%BD%BF%E7%94%A8JDBC"><span class="nav-number">3.1.3.</span> <span class="nav-text">åœ¨ Spring ä¸­ä½¿ç”¨JDBC</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E5%AF%B9%E5%A4%B1%E6%8E%A7%E7%9A%84-JDBC-%E4%BB%A3%E7%A0%81"><span class="nav-number">3.1.3.1.</span> <span class="nav-text">åº”å¯¹å¤±æ§çš„ JDBC ä»£ç </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-JDBC-%E6%A8%A1%E6%9D%BF"><span class="nav-number">3.1.3.2.</span> <span class="nav-text">ä½¿ç”¨ JDBC æ¨¡æ¿</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-9"><span class="nav-number">3.1.4.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%AF%B9%E8%B1%A1-%E5%85%B3%E7%B3%BB%E6%98%A0%E5%B0%84%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE"><span class="nav-number">3.2.</span> <span class="nav-text">ä½¿ç”¨å¯¹è±¡-å…³ç³»æ˜ å°„æŒä¹…åŒ–æ•°æ®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8-Spring-%E4%B8%AD%E9%9B%86%E6%88%90-Hibernate"><span class="nav-number">3.2.1.</span> <span class="nav-text">åœ¨  Spring  ä¸­é›†æˆ  Hibernate</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A3%B0%E6%98%8E-Hibernate-%E7%9A%84-Session-%E5%B7%A5%E5%8E%82"><span class="nav-number">3.2.1.1.</span> <span class="nav-text">å£°æ˜ Hibernate çš„ Session å·¥å‚</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E4%B8%8D%E4%BE%9D%E8%B5%96%E4%BA%8E-Spring-%E7%9A%84-Hibernate-%E4%BB%A3%E7%A0%81"><span class="nav-number">3.2.1.2.</span> <span class="nav-text">æ„å»ºä¸ä¾èµ–äº Spring çš„ Hibernate ä»£ç </span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-%E4%B8%8E-Java-%E6%8C%81%E4%B9%85%E5%8C%96-API"><span class="nav-number">3.2.2.</span> <span class="nav-text">Spring  ä¸  Java  æŒä¹…åŒ– API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%AE%9E%E4%BD%93%E7%AE%A1%E7%90%86%E5%99%A8%E5%B7%A5%E5%8E%82"><span class="nav-number">3.2.2.1.</span> <span class="nav-text">é…ç½®å®ä½“ç®¡ç†å™¨å·¥å‚</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E5%9F%BA%E4%BA%8E-JPA-%E7%9A%84-Repository"><span class="nav-number">3.2.2.2.</span> <span class="nav-text">ç¼–å†™åŸºäº JPA çš„ Repository</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%80%9F%E5%8A%A9-Spring-Data-%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84-JPA-Repository"><span class="nav-number">3.2.3.</span> <span class="nav-text">å€ŸåŠ©  Spring Data  å®ç°è‡ªåŠ¨åŒ–çš„  JPA Repository</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E6%9F%A5%E8%AF%A2%E6%96%B9%E6%B3%95"><span class="nav-number">3.2.3.1.</span> <span class="nav-text">å®šä¹‰æŸ¥è¯¢æ–¹æ³•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A3%B0%E6%98%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.2.3.2.</span> <span class="nav-text">å£°æ˜è‡ªå®šä¹‰æŸ¥è¯¢</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%B7%E5%90%88%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="nav-number">3.2.3.3.</span> <span class="nav-text">æ··åˆè‡ªå®šä¹‰çš„åŠŸèƒ½</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-10"><span class="nav-number">3.2.4.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-NoSQL-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">3.3.</span> <span class="nav-text">ä½¿ç”¨ NoSQL æ•°æ®åº“</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-MongoDB-%E6%8C%81%E4%B9%85%E5%8C%96%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE"><span class="nav-number">3.3.1.</span> <span class="nav-text">ä½¿ç”¨ MongoDB æŒä¹…åŒ–æ–‡æ¡£æ•°æ®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E7%94%A8-MongoDB"><span class="nav-number">3.3.1.1.</span> <span class="nav-text">å¯ç”¨ MongoDB</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E6%A8%A1%E5%9E%8B%E6%B7%BB%E5%8A%A0%E6%B3%A8%E8%A7%A3%EF%BC%8C%E5%AE%9E%E7%8E%B0-MongoDB-%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">3.3.1.2.</span> <span class="nav-text">ä¸ºæ¨¡å‹æ·»åŠ æ³¨è§£ï¼Œå®ç° MongoDB æŒä¹…åŒ–</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-MongoTemplate-%E8%AE%BF%E9%97%AE-MongoDB"><span class="nav-number">3.3.1.3.</span> <span class="nav-text">ä½¿ç”¨ MongoTemplate è®¿é—® MongoDB</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99-MongoDB-Repository"><span class="nav-number">3.3.1.4.</span> <span class="nav-text">ç¼–å†™ MongoDB Repository</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Neo4j-%E6%93%8D%E4%BD%9C%E5%9B%BE%E6%95%B0%E6%8D%AE"><span class="nav-number">3.3.2.</span> <span class="nav-text">ä½¿ç”¨ Neo4j æ“ä½œå›¾æ•°æ®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-Spring-Data-Neo4j"><span class="nav-number">3.3.2.1.</span> <span class="nav-text">é…ç½® Spring Data Neo4j</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E6%A0%87%E6%B3%A8%E5%9B%BE%E5%AE%9E%E4%BD%93"><span class="nav-number">3.3.2.2.</span> <span class="nav-text">ä½¿ç”¨æ³¨è§£æ ‡æ³¨å›¾å®ä½“</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Neo4jTemplate"><span class="nav-number">3.3.2.3.</span> <span class="nav-text">ä½¿ç”¨ Neo4jTemplate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84-Neo4j-Repository"><span class="nav-number">3.3.2.4.</span> <span class="nav-text">åˆ›å»ºè‡ªåŠ¨åŒ–çš„ Neo4j Repository</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Redis-%E6%93%8D%E4%BD%9C-key-value-%E6%95%B0%E6%8D%AE"><span class="nav-number">3.3.3.</span> <span class="nav-text">ä½¿ç”¨ Redis æ“ä½œ key-value æ•°æ®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E5%88%B0Redis"><span class="nav-number">3.3.3.1.</span> <span class="nav-text">è¿æ¥åˆ°Redis</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Redis-Template"><span class="nav-number">3.3.3.2.</span> <span class="nav-text">ä½¿ç”¨ Redis Template</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-key-%E5%92%8C-value-%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8"><span class="nav-number">3.3.3.3.</span> <span class="nav-text">ä½¿ç”¨ key å’Œ value çš„åºåˆ—åŒ–å™¨</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-11"><span class="nav-number">3.3.4.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E6%95%B0%E6%8D%AE"><span class="nav-number">3.4.</span> <span class="nav-text">ç¼“å­˜æ•°æ®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E7%94%A8%E5%AF%B9%E7%BC%93%E5%AD%98%E7%9A%84%E6%94%AF%E6%8C%81"><span class="nav-number">3.4.1.</span> <span class="nav-text">å¯ç”¨å¯¹ç¼“å­˜çš„æ”¯æŒ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%BC%93%E5%AD%98%E7%AE%A1%E7%90%86%E5%99%A8"><span class="nav-number">3.4.1.1.</span> <span class="nav-text">é…ç½®ç¼“å­˜ç®¡ç†å™¨</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E6%96%B9%E6%B3%95%E6%B7%BB%E5%8A%A0%E6%B3%A8%E8%A7%A3%E4%BB%A5%E6%94%AF%E6%8C%81%E7%BC%93%E5%AD%98"><span class="nav-number">3.4.2.</span> <span class="nav-text">ä¸ºæ–¹æ³•æ·»åŠ æ³¨è§£ä»¥æ”¯æŒç¼“å­˜</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A1%AB%E5%85%85%E7%BC%93%E5%AD%98"><span class="nav-number">3.4.2.1.</span> <span class="nav-text">å¡«å……ç¼“å­˜</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A7%BB%E9%99%A4%E7%BC%93%E5%AD%98%E6%9D%A1%E7%9B%AE"><span class="nav-number">3.4.2.2.</span> <span class="nav-text">ç§»é™¤ç¼“å­˜æ¡ç›®</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-XML-%E5%A3%B0%E6%98%8E%E7%BC%93%E5%AD%98"><span class="nav-number">3.4.3.</span> <span class="nav-text">ä½¿ç”¨ XML å£°æ˜ç¼“å­˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-12"><span class="nav-number">3.4.4.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%9D%E6%8A%A4%E6%96%B9%E6%B3%95%E5%BA%94%E7%94%A8"><span class="nav-number">3.5.</span> <span class="nav-text">ä¿æŠ¤æ–¹æ³•åº”ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E4%BF%9D%E6%8A%A4%E6%96%B9%E6%B3%95"><span class="nav-number">3.5.1.</span> <span class="nav-text">ä½¿ç”¨æ³¨è§£ä¿æŠ¤æ–¹æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Secured-%E6%B3%A8%E8%A7%A3%E9%99%90%E5%88%B6%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8"><span class="nav-number">3.5.1.1.</span> <span class="nav-text">ä½¿ç”¨ @Secured æ³¨è§£é™åˆ¶æ–¹æ³•è°ƒç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8-Spring-Security-%E4%B8%AD%E4%BD%BF%E7%94%A8-JSR-250-%E7%9A%84-RolesAllowed-%E6%B3%A8%E8%A7%A3"><span class="nav-number">3.5.1.2.</span> <span class="nav-text">åœ¨ Spring Security ä¸­ä½¿ç”¨ JSR-250 çš„ @RolesAllowed æ³¨è§£</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7"><span class="nav-number">3.5.2.</span> <span class="nav-text">ä½¿ç”¨è¡¨è¾¾å¼å®ç°æ–¹æ³•çº§åˆ«çš„å®‰å…¨æ€§</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E8%BF%B0%E6%96%B9%E6%B3%95%E8%AE%BF%E9%97%AE%E8%A7%84%E5%88%99"><span class="nav-number">3.5.2.1.</span> <span class="nav-text">è¡¨è¿°æ–¹æ³•è®¿é—®è§„åˆ™</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E6%96%B9%E6%B3%95%E7%9A%84%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA"><span class="nav-number">3.5.2.2.</span> <span class="nav-text">è¿‡æ»¤æ–¹æ³•çš„è¾“å…¥å’Œè¾“å‡º</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-13"><span class="nav-number">3.5.3.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring-%E9%9B%86%E6%88%90"><span class="nav-number">4.</span> <span class="nav-text">Spring é›†æˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.1.</span> <span class="nav-text">ä½¿ç”¨è¿œç¨‹æœåŠ¡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E6%A6%82%E8%A7%88"><span class="nav-number">4.1.1.</span> <span class="nav-text">Spring è¿œç¨‹è°ƒç”¨æ¦‚è§ˆ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8RMI"><span class="nav-number">4.1.2.</span> <span class="nav-text">ä½¿ç”¨RMI</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%BC%E5%87%BARMI%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.1.2.1.</span> <span class="nav-text">å¯¼å‡ºRMIæœåŠ¡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A3%85%E9%85%8DRMI%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.1.2.2.</span> <span class="nav-text">è£…é…RMIæœåŠ¡</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Hessian%E5%92%8CBurlap%E5%8F%91%E5%B8%83%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.1.3.</span> <span class="nav-text">ä½¿ç”¨Hessianå’ŒBurlapå‘å¸ƒè¿œç¨‹æœåŠ¡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Hessian%E5%92%8CBurlap%E5%AF%BC%E5%87%BAbean%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="nav-number">4.1.3.1.</span> <span class="nav-text">ä½¿ç”¨Hessianå’ŒBurlapå¯¼å‡ºbeançš„åŠŸèƒ½</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BF%E9%97%AEHessian-Burlap%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.1.3.2.</span> <span class="nav-text">è®¿é—®Hessian&#x2F;BurlapæœåŠ¡</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Spring%E7%9A%84HttpInvoker"><span class="nav-number">4.1.4.</span> <span class="nav-text">ä½¿ç”¨Springçš„HttpInvoker</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%86bean%E5%AF%BC%E5%87%BA%E4%B8%BAHTTP%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.1.4.1.</span> <span class="nav-text">å°†beanå¯¼å‡ºä¸ºHTTPæœåŠ¡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87HTTP%E8%AE%BF%E9%97%AE%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.1.4.2.</span> <span class="nav-text">é€šè¿‡HTTPè®¿é—®æœåŠ¡</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%91%E5%B8%83%E5%92%8C%E4%BD%BF%E7%94%A8Web%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.1.5.</span> <span class="nav-text">å‘å¸ƒå’Œä½¿ç”¨WebæœåŠ¡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%9F%BA%E4%BA%8ESpring%E7%9A%84JAX-WS%E7%AB%AF%E7%82%B9"><span class="nav-number">4.1.5.1.</span> <span class="nav-text">åˆ›å»ºåŸºäºSpringçš„JAX-WSç«¯ç‚¹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%90%86JAX-WS%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.1.5.2.</span> <span class="nav-text">åœ¨å®¢æˆ·ç«¯ä»£ç†JAX-WSæœåŠ¡</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-14"><span class="nav-number">4.1.6.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Spring-MVC-%E5%88%9B%E5%BB%BA-REST-API"><span class="nav-number">4.2.</span> <span class="nav-text">ä½¿ç”¨ Spring MVC åˆ›å»º REST API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%86%E8%A7%A3REST"><span class="nav-number">4.2.1.</span> <span class="nav-text">äº†è§£REST</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#REST%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-number">4.2.1.1.</span> <span class="nav-text">RESTçš„åŸºç¡€çŸ¥è¯†</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring%E6%98%AF%E5%A6%82%E4%BD%95%E6%94%AF%E6%8C%81REST%E7%9A%84"><span class="nav-number">4.2.1.2.</span> <span class="nav-text">Springæ˜¯å¦‚ä½•æ”¯æŒRESTçš„</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AAREST%E7%AB%AF%E7%82%B9"><span class="nav-number">4.2.2.</span> <span class="nav-text">åˆ›å»ºç¬¬ä¸€ä¸ªRESTç«¯ç‚¹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%8F%E5%95%86%E8%B5%84%E6%BA%90%E8%A1%A8%E8%BF%B0"><span class="nav-number">4.2.2.1.</span> <span class="nav-text">åå•†èµ„æºè¡¨è¿°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8HTTP%E4%BF%A1%E6%81%AF%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="nav-number">4.2.2.2.</span> <span class="nav-text">ä½¿ç”¨HTTPä¿¡æ¯è½¬æ¢å™¨</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%90%E4%BE%9B%E8%B5%84%E6%BA%90%E4%B9%8B%E5%A4%96%E7%9A%84%E5%85%B6%E4%BB%96%E5%86%85%E5%AE%B9"><span class="nav-number">4.2.3.</span> <span class="nav-text">æä¾›èµ„æºä¹‹å¤–çš„å…¶ä»–å†…å®¹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E9%80%81%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E5%88%B0%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">4.2.3.1.</span> <span class="nav-text">å‘é€é”™è¯¯ä¿¡æ¯åˆ°å®¢æˆ·ç«¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E5%93%8D%E5%BA%94%E4%B8%AD%E8%AE%BE%E7%BD%AE%E5%A4%B4%E9%83%A8%E4%BF%A1%E6%81%AF"><span class="nav-number">4.2.3.2.</span> <span class="nav-text">åœ¨å“åº”ä¸­è®¾ç½®å¤´éƒ¨ä¿¡æ¯</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E5%86%99REST%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">4.2.4.</span> <span class="nav-text">ç¼–å†™RESTå®¢æˆ·ç«¯</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%86%E8%A7%A3RestTemplate%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="nav-number">4.2.4.1.</span> <span class="nav-text">äº†è§£RestTemplateçš„æ“ä½œ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GET%E8%B5%84%E6%BA%90"><span class="nav-number">4.2.4.2.</span> <span class="nav-text">GETèµ„æº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A3%80%E7%B4%A2%E8%B5%84%E6%BA%90"><span class="nav-number">4.2.4.3.</span> <span class="nav-text">æ£€ç´¢èµ„æº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%BD%E5%8F%96%E5%93%8D%E5%BA%94%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE"><span class="nav-number">4.2.4.4.</span> <span class="nav-text">æŠ½å–å“åº”çš„å…ƒæ•°æ®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PUT%E8%B5%84%E6%BA%90"><span class="nav-number">4.2.4.5.</span> <span class="nav-text">PUTèµ„æº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DELETE%E8%B5%84%E6%BA%90"><span class="nav-number">4.2.4.6.</span> <span class="nav-text">DELETEèµ„æº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#POST%E8%B5%84%E6%BA%90%E6%95%B0%E6%8D%AE"><span class="nav-number">4.2.4.7.</span> <span class="nav-text">POSTèµ„æºæ•°æ®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8POST%E8%AF%B7%E6%B1%82%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%93%8D%E5%BA%94%E5%AF%B9%E8%B1%A1"><span class="nav-number">4.2.4.8.</span> <span class="nav-text">åœ¨POSTè¯·æ±‚ä¸­è·å–å“åº”å¯¹è±¡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8POST%E8%AF%B7%E6%B1%82%E5%90%8E%E8%8E%B7%E5%8F%96%E8%B5%84%E6%BA%90%E4%BD%8D%E7%BD%AE"><span class="nav-number">4.2.4.9.</span> <span class="nav-text">åœ¨POSTè¯·æ±‚åè·å–èµ„æºä½ç½®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%A4%E6%8D%A2%E8%B5%84%E6%BA%90"><span class="nav-number">4.2.4.10.</span> <span class="nav-text">äº¤æ¢èµ„æº</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-15"><span class="nav-number">4.2.5.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-%E6%B6%88%E6%81%AF"><span class="nav-number">4.3.</span> <span class="nav-text">Spring æ¶ˆæ¯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF%E7%AE%80%E4%BB%8B"><span class="nav-number">4.3.1.</span> <span class="nav-text">å¼‚æ­¥æ¶ˆæ¯ç®€ä»‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF"><span class="nav-number">4.3.1.1.</span> <span class="nav-text">å‘é€æ¶ˆæ¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%84%E4%BC%B0%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF%E7%9A%84%E4%BC%98%E7%82%B9"><span class="nav-number">4.3.1.2.</span> <span class="nav-text">è¯„ä¼°å¼‚æ­¥æ¶ˆæ¯çš„ä¼˜ç‚¹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8JMS%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF"><span class="nav-number">4.3.2.</span> <span class="nav-text">ä½¿ç”¨JMSå‘é€æ¶ˆæ¯</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8Spring%E4%B8%AD%E6%90%AD%E5%BB%BA%E6%B6%88%E6%81%AF%E4%BB%A3%E7%90%86"><span class="nav-number">4.3.2.1.</span> <span class="nav-text">åœ¨Springä¸­æ­å»ºæ¶ˆæ¯ä»£ç†</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Spring%E7%9A%84JMS%E6%A8%A1%E6%9D%BF"><span class="nav-number">4.3.2.2.</span> <span class="nav-text">ä½¿ç”¨Springçš„JMSæ¨¡æ¿</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8%E7%9A%84POJO"><span class="nav-number">4.3.2.3.</span> <span class="nav-text">åˆ›å»ºæ¶ˆæ¯é©±åŠ¨çš„POJO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9F%BA%E4%BA%8E%E6%B6%88%E6%81%AF%E7%9A%84RPC"><span class="nav-number">4.3.2.4.</span> <span class="nav-text">ä½¿ç”¨åŸºäºæ¶ˆæ¯çš„RPC</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8AMQP%E5%AE%9E%E7%8E%B0%E6%B6%88%E6%81%AF%E5%8A%9F%E8%83%BD"><span class="nav-number">4.3.3.</span> <span class="nav-text">ä½¿ç”¨AMQPå®ç°æ¶ˆæ¯åŠŸèƒ½</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#AMQP%E7%AE%80%E4%BB%8B"><span class="nav-number">4.3.3.1.</span> <span class="nav-text">AMQPç®€ä»‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AESpring%E6%94%AF%E6%8C%81AMQP%E6%B6%88%E6%81%AF"><span class="nav-number">4.3.3.2.</span> <span class="nav-text">é…ç½®Springæ”¯æŒAMQPæ¶ˆæ¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8RabbitTemplate%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF"><span class="nav-number">4.3.3.3.</span> <span class="nav-text">ä½¿ç”¨RabbitTemplateå‘é€æ¶ˆæ¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A5%E6%94%B6AMQP%E6%B6%88%E6%81%AF"><span class="nav-number">4.3.3.4.</span> <span class="nav-text">æ¥æ”¶AMQPæ¶ˆæ¯</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-16"><span class="nav-number">4.3.4.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8WebSocket%E5%92%8CSTOMP%E5%AE%9E%E7%8E%B0%E6%B6%88%E6%81%AF%E5%8A%9F%E8%83%BD"><span class="nav-number">4.4.</span> <span class="nav-text">ä½¿ç”¨WebSocketå’ŒSTOMPå®ç°æ¶ˆæ¯åŠŸèƒ½</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Spring%E7%9A%84%E4%BD%8E%E5%B1%82%E7%BA%A7WebSocket-API"><span class="nav-number">4.4.1.</span> <span class="nav-text">ä½¿ç”¨Springçš„ä½å±‚çº§WebSocket API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E5%AF%B9%E4%B8%8D%E6%94%AF%E6%8C%81WebSocket%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="nav-number">4.4.2.</span> <span class="nav-text">åº”å¯¹ä¸æ”¯æŒWebSocketçš„åœºæ™¯</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="CHENPENGBLOG"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">CHENPENGBLOG</p>
  <div class="site-description" itemprop="description">å…¨æ ˆæèµ·æ¥ï¼</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">97</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yourname" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yourname@gmail.com" title="E-Mail â†’ mailto:yourname@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/yourname" title="Weibo â†’ https:&#x2F;&#x2F;weibo.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/yourname" title="StackOverflow â†’ https:&#x2F;&#x2F;stackoverflow.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CHENPENGBLOG</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
